# Swift URL クエリ抽出

日付: 2023-09-05

---

## 👤 ユーザー
*2023/9/5 14:56:04*

Swift クエリパラメーターの抽出

---

## 🤖 アシスタント
*2023/9/5 14:56:35*

SwiftでURLからクエリパラメーターを抽出するための基本的な方法は、`URLComponents`クラスを使用することです。以下は、URLからクエリパラメーターを抽出し、それらを辞書として取得する方法を示しています：

```swift
import Foundation

func extractQueryParameters(from urlString: String) -> [String: String]? {
    guard let url = URL(string: urlString), let components = URLComponents(url: url, resolvingAgainstBaseURL: true), let queryItems = components.queryItems else {
        return nil
    }
    
    var parameters: [String: String] = [:]
    for queryItem in queryItems {
        if let value = queryItem.value {
            parameters[queryItem.name] = value
        }
    }
    return parameters
}

let urlString = "https://example.com/page?param1=value1&param2=value2"
if let params = extractQueryParameters(from: urlString) {
    for (key, value) in params {
        print("\(key): \(value)")
    }
}
```

この関数を使用すると、指定されたURL文字列からクエリパラメーターを取得し、それらを辞書形式で返すことができます。例のURL文字列`"https://example.com/page?param1=value1&param2=value2"`から、以下の出力を得ることができます：

```
param1: value1
param2: value2
```

この方法は、URLが正しく形成されていると仮定しています。実際のアプリケーションで使用する際は、さらなるエラーハンドリングが必要な場合があります。

---

## 👤 ユーザー
*2023/9/5 15:11:57*

たとえば、param1がvalue1でありparam2がvalue2であるという正規表現はどうやって書けばいいのか？

---

## 🤖 アシスタント
*2023/9/5 15:12:48*

クエリパラメータの正規表現を書く際には、パラメータ名と値の構造に注目する必要があります。`param1=value1&param2=value2` のような形式をとる場合の正規表現は以下のようになります：

```
(?<param1>param1)=(?<value1>[^&]+)(&(?<param2>param2)=(?<value2>[^&]+))?
```

この正規表現を詳しく解説すると：

1. `(?<param1>param1)`：`param1`という文字列をマッチし、それを`param1`という名前のグループにキャプチャします。
2. `=`：イコール記号をマッチします。
3. `(?<value1>[^&]+)`：アンパーサンド(&)までの任意の文字列をマッチし、それを`value1`という名前のグループにキャプチャします。
4. `(&(?<param2>param2)=(?<value2>[^&]+))?`：この部分は`param2=value2`をマッチするためのものですが、`?`がついているのでオプションです。`param2=value2`がURLに存在しない場合でもマッチします。

以下は、Swiftで上記の正規表現を使用してクエリパラメータを抽出する方法です：

```swift
import Foundation

let urlString = "https://example.com/page?param1=value1&param2=value2"
let pattern = "(?<param1>param1)=(?<value1>[^&]+)(&(?<param2>param2)=(?<value2>[^&]+))?"

if let regex = try? NSRegularExpression(pattern: pattern, options: []) {
    let range = NSRange(urlString.startIndex..<urlString.endIndex, in: urlString)
    if let match = regex.firstMatch(in: urlString, options: [], range: range) {
        let param1Range = match.range(withName: "value1")
        if param1Range.location != NSNotFound, let range = Range(param1Range, in: urlString) {
            let param1Value = String(urlString[range])
            print("param1: \(param1Value)")
        }
        
        let param2Range = match.range(withName: "value2")
        if param2Range.location != NSNotFound, let range = Range(param2Range, in: urlString) {
            let param2Value = String(urlString[range])
            print("param2: \(param2Value)")
        }
    }
}
```

このコードは`param1=value1&param2=value2`の形式のクエリパラメータを抽出するものです。適宜正規表現を変更して、異なる形式のクエリパラメータを抽出することも可能です。

---

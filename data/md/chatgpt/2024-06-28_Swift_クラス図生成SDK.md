# Swift クラス図生成SDK

日付: 2024-06-28

---

## 👤 ユーザー
*2024/6/28 15:33:43*

Swiftのコードを静的解析して、クラス図などを記述したい。よいSDKなどはあるか？

---

## 🤖 アシスタント
*2024/6/28 15:34:09*

Swiftのコードを静的解析してクラス図などを生成するためのツールやSDKはいくつかあります。以下に代表的なものを紹介します。

### 1. **SourceKitten**
SourceKittenは、AppleのSourceKitライブラリをラップしたツールで、Swiftコードの構造を解析するために使用できます。これにより、クラス図を生成するためのデータを抽出することが可能です。

- **GitHub**: [SourceKitten](https://github.com/jpsim/SourceKitten)
- **特徴**: ソースコードのシンタックス解析、ドキュメント生成、コードの構造を理解するのに便利。

### 2. **SwiftLint**
SwiftLintは、Swiftコードのスタイルをチェックし、改善点を提案するツールですが、静的解析の機能も備えています。

- **GitHub**: [SwiftLint](https://github.com/realm/SwiftLint)
- **特徴**: コードの品質を保つために役立ちますが、静的解析結果を利用してクラス図を生成することも可能。

### 3. **Sourcery**
Sourceryは、Swiftのコードジェネレーターで、コード解析とテンプレートベースのコード生成が可能です。これを利用して、クラス図や依存関係図を生成することができます。

- **GitHub**: [Sourcery](https://github.com/krzysztofzablocki/Sourcery)
- **特徴**: カスタムテンプレートを作成して、コードベースから自動的に図を生成できます。

### 4. **Xcode**
Xcode自体も、ある程度の静的解析を行い、インスペクタやアシスタントエディタでコードの構造を視覚化する機能を提供しています。ただし、クラス図の自動生成機能はありません。

### 5. **PlantUML**
PlantUMLは、テキストベースのUML図生成ツールです。上記のツールと組み合わせて、Swiftコードからデータを抽出し、PlantUML形式に変換することでクラス図を生成できます。

- **公式サイト**: [PlantUML](http://plantuml.com/)
- **特徴**: 簡単にUML図を描ける、他のツールと連携して利用可能。

### 例: SourceryとPlantUMLの組み合わせ
Sourceryを使ってSwiftコードからクラスやプロトコル、構造体などの情報を抽出し、PlantUML形式に変換するテンプレートを作成することで、クラス図を自動生成することができます。

```swift
// Sourceryのテンプレートファイル例
{% for type in types.all %}
class {{ type.name }} {
    {% for variable in type.variables %}
    {{ variable.typeName }} {{ variable.name }}
    {% endfor %}
}
{% endfor %}
```

このテンプレートを使って生成されたデータをPlantUMLに渡すことで、クラス図を作成できます。

これらのツールを組み合わせて、プロジェクトに適した静的解析とクラス図の生成を行うことができます。どのツールが最適かは、プロジェクトの規模や要求に依存するため、いくつか試してみると良いでしょう。

---

## 👤 ユーザー
*2024/6/28 15:35:34*

marmaid だったり、UMLもしくはpngを生成してほしい

---

## 🤖 アシスタント
*2024/6/28 15:35:55*

それでは、Swiftのコードを静的解析し、クラス図を生成してMermaid、UML、またはPNG形式で出力する方法を具体的に説明します。

### 手順

#### 1. **SourceKittenを使ったSwiftコードの解析**
SourceKittenを使用してSwiftコードを解析し、クラスやプロトコルの情報を抽出します。

1. **SourceKittenのインストール**
   ```sh
   brew install sourcekitten
   ```

2. **解析の実行**
   ```sh
   sourcekitten structure --file <YourSwiftFile.swift> > structure.json
   ```

#### 2. **解析データの加工**
取得したJSONデータを元に、Mermaid、UML、もしくはPNGの形式に変換するスクリプトを作成します。ここでは、Pythonを使った例を示します。

#### 3. **Mermaid用のスクリプト作成**
以下のPythonスクリプトは、SourceKittenの出力をMermaid形式に変換します。

```python
import json

def generate_mermaid_class_diagram(data):
    classes = []
    for item in data['key.substructure']:
        if item['key.kind'] == 'source.lang.swift.decl.class':
            class_name = item['key.name']
            classes.append(class_name)
            print(f"class {class_name} {{")
            for sub_item in item.get('key.substructure', []):
                if sub_item['key.kind'] == 'source.lang.swift.decl.var.instance':
                    var_name = sub_item['key.name']
                    var_type = sub_item['key.typename']
                    print(f"  {var_name}: {var_type}")
            print("}")
    return classes

def main():
    with open('structure.json') as f:
        data = json.load(f)

    classes = generate_mermaid_class_diagram(data)

    # Create Mermaid diagram
    print("classDiagram")
    for class_name in classes:
        print(f"class {class_name}")

if __name__ == "__main__":
    main()
```

このスクリプトを実行すると、Mermaid形式のクラス図が標準出力に表示されます。

#### 4. **Mermaidを使ったUMLまたはPNGの生成**
次に、生成されたMermaid形式のデータを使ってUMLまたはPNG形式の画像を生成します。MermaidのCLIツールを使用します。

1. **Mermaid CLIのインストール**
   ```sh
   npm install -g @mermaid-js/mermaid-cli
   ```

2. **Mermaidファイルの生成**
   上記スクリプトの出力を`diagram.mmd`ファイルに保存します。

3. **PNGの生成**
   ```sh
   mmdc -i diagram.mmd -o diagram.png
   ```

### まとめ
これらの手順を踏むことで、Swiftコードを静的解析してクラス図をMermaid、UML、もしくはPNG形式で生成することができます。MermaidのCLIツールを使えば、簡単に視覚化されたクラス図を作成できます。

---

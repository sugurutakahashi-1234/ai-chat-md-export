# ãƒªãƒãƒ¼ãƒãƒƒãƒ‰ã§APIç®¡ç†

Date: 2024-12-18

---

## ğŸ‘¤ User
*2024-12-18 15:32:48*

ä»¥ä¸‹ã®ã‚ˆã†ãª api ã‚’ãƒªãƒãƒ¼ãƒãƒƒãƒ‰ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ã£ã¦ä¾¿åˆ©ã«ä½¿ã„ãŸã„ã€‚
ã©ã†ã™ã‚Œã°ã„ã„ã‹ï¼Ÿâ€¨
class GuildApi {
  GuildApi(
    this.dio,
    this.baseUri,
  );

  final Dio dio;

  final Uri baseUri;

  /// Get guild information of requested user[GLD0101]
  /// get: /v1/guilds
  ///
  Future&lt;Response&lt;GuildInfoResponseDto&gt;&gt; guildControllerGetGuildInfo() async {
    final queryParams = &lt;String, dynamic&gt;{};
    final uri = baseUri.replace(
        queryParameters: queryParams, path: baseUri.path + '/v1/guilds');
    final response = await dio.getUri&lt;Map&lt;String, dynamic&gt;&gt;(uri);
    final parsed = GuildInfoResponseDto.fromJson(response.data!);
    return Response&lt;GuildInfoResponseDto&gt;(
      data: parsed,
      headers: response.headers,
      requestOptions: response.requestOptions,
      isRedirect: response.isRedirect,
      statusCode: response.statusCode,
      redirects: response.redirects,
      extra: response.extra,
    );
  }

  /// Create a new guild [GLD0103]
  /// post: /v1/guilds
  ///
  Future&lt;Response&lt;EmptyResponseSchema&gt;&gt; guildControllerCreateGuild(
      CreateGuildRequestDto body) async {
    final queryParams = &lt;String, dynamic&gt;{};
    final uri = baseUri.replace(
        queryParameters: queryParams, path: baseUri.path + '/v1/guilds');
    final response = await dio.postUri&lt;Map&lt;String, dynamic&gt;&gt;(uri, data: body);
    final parsed = EmptyResponseSchema.fromJson(response.data!);
    return Response&lt;EmptyResponseSchema&gt;(
      data: parsed,
      headers: response.headers,
      requestOptions: response.requestOptions,
      isRedirect: response.isRedirect,
      statusCode: response.statusCode,
      redirects: response.redirects,
      extra: response.extra,
    );
  }
}

@freezed
class EmptyResponseSchema with _$EmptyResponseSchema {
  factory EmptyResponseSchema({
    @JsonKey(name: 'code') required num? code,
    @JsonKey(name: 'data') required String? data,
    @JsonKey(name: 'errorMessage') required String? errorMessage,
  }) = _EmptyResponseSchema;

  factory EmptyResponseSchema.fromJson(Map&lt;String, dynamic&gt; jsonMap) =&gt;
      _$EmptyResponseSchemaFromJson(jsonMap);
}



@freezed
class GuildInfoResponseDto with _$GuildInfoResponseDto {
  factory GuildInfoResponseDto({
    @JsonKey(name: 'code') required num? code,
    @JsonKey(name: 'errorMessage') required String? errorMessage,
    @JsonKey(name: 'data') required GuildInfoResponseDtoData? data,
  }) = _GuildInfoResponseDto;

  factory GuildInfoResponseDto.fromJson(Map&lt;String, dynamic&gt; jsonMap) =&gt;
      _$GuildInfoResponseDtoFromJson(jsonMap);
}


{
    "code": 0,
    "data": {
        "guild_id": "4571566835",
        "guild_name": "222222",
        "guild_description": "test",
        "guild_owner": "123e4567-e89b-12d3-a456-426614174000",
        "guild_avatar": null,
        "guild_banner": null,
        "guild_members": [
            {
                "user_id": "123e4567-e89b-12d3-a456-426614174000",
                "role": "OWNER",
                "member_status": "JOINED"
            }
        ]
    }
}

---

## ğŸ¤– Assistant
*2024-12-18 15:33:11*

ãƒªãƒãƒ¼ãƒãƒƒãƒ‰ï¼ˆRiverpodï¼‰ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ `GuildApi` ã‚’ä¾¿åˆ©ã«åˆ©ç”¨ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ‰‹é †ã‚’è¸ã‚€ã¨è‰¯ã„ã§ã™ã€‚

---

### 1. **`GuildApi` ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ã‚’ä½œæˆã™ã‚‹**
ã¾ãšã€`GuildApi` ã‚’ãƒ—ãƒ­ãƒã‚¤ãƒ€ã¨ã—ã¦ç®¡ç†ã—ã¾ã™ã€‚ãƒªãƒãƒ¼ãƒãƒƒãƒ‰ã§ã¯ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ãƒ—ãƒ­ãƒã‚¤ãƒ€ã‚’ç°¡ç•¥åŒ–ã§ãã¾ã™ã€‚

#### ä¾‹:

```dart
import 'package:riverpod_annotation/riverpod_annotation.dart';
import 'package:dio/dio.dart';

part 'guild_api_provider.g.dart'; // è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã®å‡ºåŠ›å…ˆ

@riverpod
GuildApi guildApi(GuildApiRef ref) {
  final dio = Dio(); // å¿…è¦ã«å¿œã˜ã¦ Dio ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
  final baseUri = Uri.parse('https://api.example.com'); // API ã®ãƒ™ãƒ¼ã‚¹ URI
  return GuildApi(dio, baseUri);
}
```

---

### 2. **`GuildApi` ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒªãƒãƒ¼ãƒãƒƒãƒ‰ã§éåŒæœŸãƒ—ãƒ­ãƒã‚¤ãƒ€ã¨ã—ã¦ãƒ©ãƒƒãƒ—ã™ã‚‹**
Riverpod ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã® `@riverpod` ã‚’ä½¿ã„ã€API ãƒ¡ã‚½ãƒƒãƒ‰ã‚’éåŒæœŸãƒ—ãƒ­ãƒã‚¤ãƒ€ã¨ã—ã¦ãƒ©ãƒƒãƒ—ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€éåŒæœŸã®çŠ¶æ…‹ç®¡ç†ãŒè‡ªå‹•åŒ–ã•ã‚Œã¾ã™ã€‚

#### ä¾‹:

```dart
@riverpod
Future<GuildInfoResponseDto> guildInfo(GuildInfoRef ref) async {
  final api = ref.watch(guildApiProvider); // GuildApi ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å–å¾—
  final response = await api.guildControllerGetGuildInfo();
  return response.data!;
}
```

---

### 3. **ãƒ‡ãƒ¼ã‚¿å–å¾—ã®çŠ¶æ…‹ã‚’ UI ã§ç›£è¦–**
ãƒ—ãƒ­ãƒã‚¤ãƒ€ã§ç®¡ç†ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ UI ã«ç°¡å˜ã«ãƒã‚¤ãƒ³ãƒ‰ã§ãã¾ã™ã€‚

#### ä¾‹:

```dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';

class GuildInfoScreen extends ConsumerWidget {
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final guildInfoAsyncValue = ref.watch(guildInfoProvider);

    return Scaffold(
      appBar: AppBar(title: Text('Guild Info')),
      body: guildInfoAsyncValue.when(
        data: (guildInfo) => ListView(
          children: [
            Text('Guild Name: ${guildInfo.data?.guildName}'),
            Text('Description: ${guildInfo.data?.guildDescription}'),
            // ä»–ã®ã‚®ãƒ«ãƒ‰æƒ…å ±ã‚’è¡¨ç¤º
          ],
        ),
        loading: () => Center(child: CircularProgressIndicator()),
        error: (error, stack) => Center(child: Text('Error: $error')),
      ),
    );
  }
}
```

---

### 4. **API ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒå¿…è¦ãªã‚±ãƒ¼ã‚¹ã®å¯¾å¿œ**
ä¾‹ãˆã°ã€`guildControllerCreateGuild` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™å ´åˆã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã‚’å—ã‘å–ã‚‹ã‚ˆã†ã«éåŒæœŸãƒ—ãƒ­ãƒã‚¤ãƒ€ã‚’ä½œæˆã—ã¾ã™ã€‚

#### ä¾‹:

```dart
@riverpod
Future<EmptyResponseSchema> createGuild(
  CreateGuildRef ref, {
  required CreateGuildRequestDto body,
}) async {
  final api = ref.watch(guildApiProvider);
  final response = await api.guildControllerCreateGuild(body);
  return response.data!;
}
```

ä½¿ç”¨ä¾‹:

```dart
final response = await ref.read(createGuildProvider(body: CreateGuildRequestDto(
  guildName: 'New Guild',
  description: 'Guild Description',
)));
```

---

### 5. **è‡ªå‹•ç”Ÿæˆã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡Œ**
`guild_api_provider.dart` ã®è‡ªå‹•ç”Ÿæˆã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```bash
flutter pub run build_runner build --delete-conflicting-outputs
```

---

### å®Œæˆå¾Œã®ãƒ¡ãƒªãƒƒãƒˆ
- **çŠ¶æ…‹ç®¡ç†ã®ç°¡ç•¥åŒ–:** `FutureProvider` ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ API å‘¼ã³å‡ºã—ã®çŠ¶æ…‹ï¼ˆãƒ­ãƒ¼ãƒ‰ä¸­ã€æˆåŠŸã€å¤±æ•—ï¼‰ã‚’ç°¡å˜ã«ç®¡ç†ã§ãã¾ã™ã€‚
- **å†åˆ©ç”¨æ€§:** `GuildApi` ã‚’ä»–ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ã‚„ãƒ“ãƒ¥ãƒ¼ã§ç°¡å˜ã«å†åˆ©ç”¨å¯èƒ½ã€‚
- **ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§å‘ä¸Š:** ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§æ‰‹å‹•ã§ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€è¨­å®šãŒä¸è¦ã€‚

ã“ã‚Œã§ã€`GuildApi` ã‚’ Riverpod ã¨çµ„ã¿åˆã‚ã›ã¦åŠ¹ç‡ã‚ˆãç®¡ç†ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼

---

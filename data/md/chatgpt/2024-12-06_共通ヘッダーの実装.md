# 共通ヘッダーの実装

日付: 2024-12-06

---

## 👤 ユーザー
*2024/12/06 19:22:29*

{
  "content_type": "image_asset_pointer",
  "asset_pointer": "file-service://file-PABnRumW5RDCPqowxhU89u",
  "size_bytes": 138572,
  "width": 248,
  "height": 486,
  "fovea": null,
  "metadata": {
    "dalle": null,
    "gizmo": null,
    "generation": null,
    "container_pixel_height": null,
    "container_pixel_width": null,
    "emu_omit_glimpse_image": null,
    "emu_patches_override": null,
    "sanitized": true,
    "asset_pointer_link": null,
    "watermarked_asset_pointer": null
  }
}
{
  "content_type": "image_asset_pointer",
  "asset_pointer": "file-service://file-B9wGtg154E3aaM2NXza1nT",
  "size_bytes": 30026,
  "width": 281,
  "height": 533,
  "fovea": null,
  "metadata": {
    "dalle": null,
    "gizmo": null,
    "generation": null,
    "container_pixel_height": null,
    "container_pixel_width": null,
    "emu_omit_glimpse_image": null,
    "emu_patches_override": null,
    "sanitized": true,
    "asset_pointer_link": null,
    "watermarked_asset_pointer": null
  }
}
タブが2つあるがヘッダーが共通しているんだけど、このような画面はどう実装すればいいか教えてほしい

import 'package:flutter/material.dart';
import 'package:go_router/go_router.dart';

class TabPage extends StatelessWidget {
  final StatefulNavigationShell navigationShell;

  const TabPage({required this.navigationShell, super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: navigationShell,
      bottomNavigationBar: BottomNavigationBar(
        currentIndex: navigationShell.currentIndex,
        onTap: (index) =&gt; navigationShell.goBranch(index),
        items: const [
          BottomNavigationBarItem(icon: Icon(Icons.map), label: 'Map'),
          BottomNavigationBarItem(icon: Icon(Icons.group), label: 'Guild'),
        ],
      ),
    );
  }
}

import 'package:go_router/go_router.dart';
import 'pages/login_page.dart';
import 'pages/tab_page.dart';
import 'pages/map_page.dart';
import 'pages/guild_page.dart';

final GoRouter router = GoRouter(
  initialLocation: '/login',
  routes: [
    // ログインページ
    GoRoute(
      path: '/login',
      builder: (context, state) =&gt; const LoginPage(),
    ),
    // タブページ
    StatefulShellRoute.indexedStack(
      builder: (context, state, navigationShell) =&gt; TabPage(navigationShell: navigationShell),
      branches: [
        StatefulShellBranch(
          routes: [
            GoRoute(
              path: '/map',
              builder: (context, state) =&gt; const MapPage(),
            ),
          ],
        ),
        StatefulShellBranch(
          routes: [
            GoRoute(
              path: '/guild',
              builder: (context, state) =&gt; const GuildPage(),
            ),
          ],
        ),
      ],
    ),
  ],
);

---

## 🤖 アシスタント
*2024/12/06 19:23:06*

このようなヘッダーが共通するUIを実装するためには、Flutterで「CustomScrollView」を使い、ヘッダー部分を「SliverAppBar」として定義し、各タブのコンテンツを柔軟に切り替えられるように実装する方法があります。また、`StatefulShellRoute`を使ってタブ間の状態を保持しつつ、ヘッダーを共通化する形で進めるのがおすすめです。

以下の実装例を参考にしてください：

### 1. 共通のヘッダーを作成する

```dart
import 'package:flutter/material.dart';

class CommonHeader extends StatelessWidget {
  const CommonHeader({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return SliverAppBar(
      pinned: true,
      expandedHeight: 100.0,
      flexibleSpace: FlexibleSpaceBar(
        title: Row(
          mainAxisAlignment: MainAxisAlignment.spaceBetween,
          children: [
            Text('共通ヘッダー', style: Theme.of(context).textTheme.headline6),
            Row(
              children: const [
                Icon(Icons.notifications),
                SizedBox(width: 8),
                Icon(Icons.person),
              ],
            ),
          ],
        ),
      ),
    );
  }
}
```

### 2. 各タブのコンテンツを実装する

例えば、`MapPage` と `GuildPage` を以下のように更新します。

```dart
import 'package:flutter/material.dart';

class MapPage extends StatelessWidget {
  const MapPage({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return CustomScrollView(
      slivers: [
        const CommonHeader(),
        SliverList(
          delegate: SliverChildBuilderDelegate(
            (context, index) => ListTile(title: Text('Map Item $index')),
            childCount: 20,
          ),
        ),
      ],
    );
  }
}

class GuildPage extends StatelessWidget {
  const GuildPage({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return CustomScrollView(
      slivers: [
        const CommonHeader(),
        SliverList(
          delegate: SliverChildBuilderDelegate(
            (context, index) => ListTile(title: Text('Guild Member $index')),
            childCount: 20,
          ),
        ),
      ],
    );
  }
}
```

### 3. タブ付きのナビゲーションを実装する

あなたのコードにある`TabPage`を利用して、以下のようにヘッダーとタブを統合します。

```dart
import 'package:flutter/material.dart';
import 'package:go_router/go_router.dart';

class TabPage extends StatelessWidget {
  final StatefulNavigationShell navigationShell;

  const TabPage({required this.navigationShell, Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: navigationShell,
      bottomNavigationBar: BottomNavigationBar(
        currentIndex: navigationShell.currentIndex,
        onTap: (index) => navigationShell.goBranch(index),
        items: const [
          BottomNavigationBarItem(icon: Icon(Icons.map), label: 'Map'),
          BottomNavigationBarItem(icon: Icon(Icons.group), label: 'Guild'),
        ],
      ),
    );
  }
}
```

### 4. ルート構造を統合する

`GoRouter` を使って既存のナビゲーションロジックに統合します。

```dart
final GoRouter router = GoRouter(
  initialLocation: '/map',
  routes: [
    // ログインページ
    GoRoute(
      path: '/login',
      builder: (context, state) => const LoginPage(),
    ),
    // タブページ
    StatefulShellRoute.indexedStack(
      builder: (context, state, navigationShell) => TabPage(navigationShell: navigationShell),
      branches: [
        StatefulShellBranch(
          routes: [
            GoRoute(
              path: '/map',
              builder: (context, state) => const MapPage(),
            ),
          ],
        ),
        StatefulShellBranch(
          routes: [
            GoRoute(
              path: '/guild',
              builder: (context, state) => const GuildPage(),
            ),
          ],
        ),
      ],
    ),
  ],
);
```

### ポイント
- **ヘッダー共通化:** 各ページの`CustomScrollView`内で`CommonHeader`を使い回すことで、統一感を保ちながらスクロール可能なレイアウトを実現します。
- **状態保持:** `StatefulShellRoute`を使うことで、各タブ間での状態を維持します。
- **カスタマイズ:** 必要に応じて、ヘッダーの内容をページごとに条件分岐させてもOKです。

これで、ヘッダーが共通したタブ付きのアプリを構築できます。

---

## 👤 ユーザー
*2024/12/06 19:27:21*

CommonHeader ではなくて HomeHeader にしてほしい。
また、空の NotificationListPage と AccountPage を作成してほしい

---

## 🤖 アシスタント
*2024/12/06 19:27:47*

以下はリクエストされた内容に基づいて`HomeHeader`を作成し、空の`NotificationListPage`と`AccountPage`を追加するコードです。

### 1. `HomeHeader` の作成

`HomeHeader`を作成し、各ページで利用できるようにします。

```dart
import 'package:flutter/material.dart';

class HomeHeader extends StatelessWidget {
  const HomeHeader({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return SliverAppBar(
      pinned: true,
      expandedHeight: 100.0,
      flexibleSpace: FlexibleSpaceBar(
        title: Row(
          mainAxisAlignment: MainAxisAlignment.spaceBetween,
          children: [
            Text('Home Header', style: Theme.of(context).textTheme.headline6),
            Row(
              children: const [
                Icon(Icons.notifications),
                SizedBox(width: 8),
                Icon(Icons.person),
              ],
            ),
          ],
        ),
      ),
    );
  }
}
```

### 2. 空の `NotificationListPage` と `AccountPage` の作成

以下は空のページの実装です。

```dart
import 'package:flutter/material.dart';

class NotificationListPage extends StatelessWidget {
  const NotificationListPage({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('Notifications'),
      ),
      body: const Center(
        child: Text('This is the Notification List Page.'),
      ),
    );
  }
}

class AccountPage extends StatelessWidget {
  const AccountPage({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('Account'),
      ),
      body: const Center(
        child: Text('This is the Account Page.'),
      ),
    );
  }
}
```

### 3. `GoRouter` に新しいルートを追加

新しいページをナビゲーションに追加します。

```dart
import 'pages/notification_list_page.dart';
import 'pages/account_page.dart';

final GoRouter router = GoRouter(
  initialLocation: '/map',
  routes: [
    GoRoute(
      path: '/login',
      builder: (context, state) => const LoginPage(),
    ),
    StatefulShellRoute.indexedStack(
      builder: (context, state, navigationShell) => TabPage(navigationShell: navigationShell),
      branches: [
        StatefulShellBranch(
          routes: [
            GoRoute(
              path: '/map',
              builder: (context, state) => const MapPage(),
            ),
          ],
        ),
        StatefulShellBranch(
          routes: [
            GoRoute(
              path: '/guild',
              builder: (context, state) => const GuildPage(),
            ),
          ],
        ),
      ],
    ),
    GoRoute(
      path: '/notifications',
      builder: (context, state) => const NotificationListPage(),
    ),
    GoRoute(
      path: '/account',
      builder: (context, state) => const AccountPage(),
    ),
  ],
);
```

### 4. `MapPage` と `GuildPage` の更新

各ページで `HomeHeader` を利用するようにします。

```dart
import 'package:flutter/material.dart';
import 'home_header.dart';

class MapPage extends StatelessWidget {
  const MapPage({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return CustomScrollView(
      slivers: [
        const HomeHeader(),
        SliverList(
          delegate: SliverChildBuilderDelegate(
            (context, index) => ListTile(title: Text('Map Item $index')),
            childCount: 20,
          ),
        ),
      ],
    );
  }
}

class GuildPage extends StatelessWidget {
  const GuildPage({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return CustomScrollView(
      slivers: [
        const HomeHeader(),
        SliverList(
          delegate: SliverChildBuilderDelegate(
            (context, index) => ListTile(title: Text('Guild Member $index')),
            childCount: 20,
          ),
        ),
      ],
    );
  }
}
```

### 5. アプリの動作確認

- `HomeHeader` はすべてのタブで共通して表示されます。
- `NotificationListPage` と `AccountPage` にアクセスするには、それぞれ `/notifications` または `/account` を指定します。
- `GoRouter` のルート設定により、ページ間のナビゲーションがシームレスに動作します。

これで要求された変更は完了です！

---

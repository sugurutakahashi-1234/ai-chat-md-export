# ISO8601日付フォーマット修正

日付: 2024-10-21

---

## 👤 ユーザー
*2024/10/21 16:48:29*

端末のロケールやタイムゾーンが反映されない

extension ISO8601DateFormatter {
    nonisolated(unsafe) static let sharedWithFractionalSeconds: ISO8601DateFormatter = {
        let formatter = ISO8601DateFormatter()
        formatter.formatOptions = \[.withInternetDateTime, .withFractionalSeconds\]
        formatter.timeZone = .current
        return formatter
    }()
}

extension ISO8601DateFormatter {
    nonisolated(unsafe) static let sharedWithFractionalSecondsAsiaTokyo: ISO8601DateFormatter = {
        let formatter = ISO8601DateFormatter()
        formatter.formatOptions = \[.withInternetDateTime, .withFractionalSeconds\]
        formatter.timeZone = TimeZone(identifier: "Asia/Tokyo")
        return formatter
    }()
}

---

## 🤖 アシスタント
*2024/10/21 16:48:35*

`ISO8601DateFormatter`の`timeZone`プロパティは、意図した通りのタイムゾーンに変換しないことがあります。これは、ISO 8601形式ではタイムゾーンの情報が必ずしも反映されない仕様によるものです。

代わりに、`DateFormatter`を使うとロケールやタイムゾーンがより正確に反映される可能性が高いです。次のように、`DateFormatter`を使用して、フラクショナルセカンドとタイムゾーンを含むフォーマットを実現できます。

```swift
extension DateFormatter {
    static let sharedWithFractionalSeconds: DateFormatter = {
        let formatter = DateFormatter()
        formatter.dateFormat = "yyyy-MM-dd'T'HH:mm:ss.SSSXXXXX"
        formatter.timeZone = .current
        return formatter
    }()

    static let sharedWithFractionalSecondsAsiaTokyo: DateFormatter = {
        let formatter = DateFormatter()
        formatter.dateFormat = "yyyy-MM-dd'T'HH:mm:ss.SSSXXXXX"
        formatter.timeZone = TimeZone(identifier: "Asia/Tokyo")
        return formatter
    }()
}
```

この`DateFormatter`の実装により、指定したタイムゾーンでの日時表現を得られます。

---

# Text修飾子を作成

日付: 2023-05-24

---

## 👤 ユーザー
*2023/5/24 12:42:43*

SwiftでTextにだけ修飾するようなモディファイアの定義を書いて欲しい

---

## 🤖 アシスタント
*2023/5/24 12:43:11*

SwiftUIを使用して、特定のテキスト修飾を適用するカスタムモディファイアを作成することができます。以下に、特定のフォントと色を適用する簡単な例を示します。

```swift
import SwiftUI

struct CustomTextModifier: ViewModifier {
    func body(content: Content) -> some View {
        content
            .font(.system(size: 20))
            .foregroundColor(.red)
    }
}

extension View {
    func customTextModifier() -> some View {
        self.modifier(CustomTextModifier())
    }
}

struct ContentView: View {
    var body: some View {
        Text("Hello, World!")
            .customTextModifier()
    }
}
```

このコードは、`CustomTextModifier`という新しい`ViewModifier`を定義します。これは、任意のビューに対して適用できるもので、そのビューの表示を変更することができます。

しかし、この修飾子をテキストにのみ適用したいという要望がある場合は、以下のようにTextへの拡張を作成すると良いでしょう。

```swift
import SwiftUI

struct CustomTextModifier: ViewModifier {
    func body(content: Content) -> some View {
        content
            .font(.system(size: 20))
            .foregroundColor(.red)
    }
}

extension Text {
    func customTextModifier() -> some View {
        self.modifier(CustomTextModifier())
    }
}

struct ContentView: View {
    var body: some View {
        Text("Hello, World!")
            .customTextModifier()
    }
}
```

この場合、新しい`customTextModifier`メソッドはTextビューにのみ適用できます。

---

## 👤 ユーザー
*2023/5/24 12:43:44*

kerning を設定するように修正してほしい

---

## 🤖 アシスタント
*2023/5/24 12:44:02*

kerning（文字間隔）を設定するために、修飾子を以下のように修正します。

```swift
import SwiftUI

struct CustomTextModifier: ViewModifier {
    var kerningValue: CGFloat

    func body(content: Content) -> some View {
        content
            .font(.system(size: 20))
            .foregroundColor(.red)
            .kerning(kerningValue)
    }
}

extension Text {
    func customTextModifier(kerning: CGFloat) -> some View {
        self.modifier(CustomTextModifier(kerningValue: kerning))
    }
}

struct ContentView: View {
    var body: some View {
        Text("Hello, World!")
            .customTextModifier(kerning: 2.0)
    }
}
```
ここでは`CustomTextModifier`に`kerningValue`という新しいパラメータを追加し、それを`body`メソッド内で`kerning`メソッドに渡しています。その結果、テキストに適用するときにkerning（文字間隔）をカスタマイズすることができます。

---

## 👤 ユーザー
*2023/5/24 12:45:02*

そのコードで`'kerning' is only available in iOS 16.0 or newer` とエラーが出たので対応してほしい

---

## 🤖 アシスタント
*2023/5/24 12:45:30*

kerningはiOS 16.0以降でのみ利用可能な機能です。もしiOS 15.0以前のバージョンもサポートしたい場合は、条件付きでこの修飾子を適用する必要があります。

しかし、残念ながら直接的な条件付きビュー修飾子はSwiftUIではサポートされていません。したがって、この問題を解決する一つの方法は、ビュー自体に条件を設定することです。以下にそのコードを示します：

```swift
import SwiftUI

struct CustomTextModifier: ViewModifier {
    var kerningValue: CGFloat

    func body(content: Content) -> some View {
        content
            .font(.system(size: 20))
            .foregroundColor(.red)
    }
}

extension Text {
    func customTextModifier(kerning: CGFloat) -> some View {
        self.modifier(CustomTextModifier(kerningValue: kerning))
    }
    
    @ViewBuilder
    func applyKerningIfNeeded(_ value: CGFloat) -> some View {
        if #available(iOS 16.0, *) {
            self.kerning(value)
        } else {
            self
        }
    }
}

struct ContentView: View {
    var body: some View {
        Text("Hello, World!")
            .customTextModifier(kerning: 2.0)
            .applyKerningIfNeeded(2.0)
    }
}
```
このコードでは、`applyKerningIfNeeded(_:)`という新しいメソッドを追加しています。このメソッドは、OSがiOS 16.0以上である場合にのみkerningを適用します。それ以外の場合は、Textビューはそのまま返されます。

---

## 👤 ユーザー
*2023/5/24 12:45:55*

OSがiOS 15.0未満でもkerningを設定したい場合はどうすればいい？

---

## 🤖 アシスタント
*2023/5/24 12:46:33*

SwiftUIの`kerning`修飾子はiOS 16.0以降で利用可能ですが、それ以前のバージョンで文字間隔を調整する必要がある場合は、代わりに`NSAttributedString`を使用することができます。

しかし、SwiftUIの`Text`ビューは直接`NSAttributedString`を受け付けません。そのため、UIKitをラップして`NSAttributedString`を表示するカスタムビューを作成する必要があります。以下にその方法を示します。

```swift
import SwiftUI
import UIKit

struct AttributedText: UIViewRepresentable {
    var attributedString: NSAttributedString

    func makeUIView(context: Context) -> UILabel {
        let label = UILabel()
        label.numberOfLines = 0
        return label
    }

    func updateUIView(_ uiView: UILabel, context: Context) {
        uiView.attributedText = attributedString
    }
}

extension Text {
    func customTextModifier(kerning: CGFloat) -> some View {
        let attributedString = NSMutableAttributedString(string: self.storage)
        attributedString.addAttribute(.kern, value: kerning, range: NSRange(location: 0, length: self.storage.count))
        return AttributedText(attributedString: attributedString)
    }
}

struct ContentView: View {
    var body: some View {
        Text("Hello, World!")
            .customTextModifier(kerning: 2.0)
    }
}
```

このコードでは、`UIViewRepresentable`プロトコルを実装した`AttributedText`という新しいビューを作成しています。このビューはUIKitの`UILabel`をラップし、`NSAttributedString`を表示します。そして、`customTextModifier(kerning:)`メソッドは`NSAttributedString`を作成し、そのkerning属性を設定します。

ただし、この方法はSwiftUIの他の特性とは相互運用できない可能性があります。たとえば、この`AttributedText`ビューは直接SwiftUIの修飾子を受け入れません。それらを適用するには、さらなる処理が必要になります。

---

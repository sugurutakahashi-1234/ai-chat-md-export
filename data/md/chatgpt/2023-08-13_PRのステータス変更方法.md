# PRのステータス変更方法

日付: 2023-08-13

---

## 👤 ユーザー
*2023/8/13 12:12:50*

新規に作成したPRをgithubプロジェクトの特定のステータスに変更する方法を教えて欲しい

---

## 🤖 アシスタント
*2023/8/13 12:13:16*

GitHubのプロジェクトに関連付けられたカード（issueやPR）を特定のステータスに変更するためには、手動で操作するか、GitHub Actionsなどを使用して自動化することができます。以下は手動操作と自動化の方法を紹介します。

### 手動操作:

1. GitHubのリポジトリにアクセスします。
2. 「Projects」タブをクリックして対象のプロジェクトボードを開きます。
3. 新規に作成されたPRカードを探し、ドラッグ&ドロップで目的のカラム（ステータス）に移動します。

### 自動化 (GitHub Actionsを利用):

1. リポジトリのルートに `.github/workflows` ディレクトリを作成します。
2. その中にYAMLファイル（例: `project_auto_triage.yml`）を作成します。
3. 以下のサンプルのようにYAMLファイルを設定します：

```yaml
name: Move new PR to specific column in Project

on:
  pull_request:
    types:
      - opened

jobs:
  move-to-column:
    runs-on: ubuntu-latest
    steps:
    - name: Move PR to column
      uses: alex-page/github-project-automation-plus@v0.6.0
      with:
        project: Your project name
        column: Your column name
        repo-token: ${{ secrets.GITHUB_TOKEN }}
```

4. 上記の `Your project name` と `Your column name` を適切に変更します。
5. 変更をコミットし、pushします。これにより、新しいPRが作成されるたびに指定されたカラムに自動的に移動されるようになります。

注意: 上記のGitHub Action（alex-page/github-project-automation-plus）のバージョンや動作が変更される可能性がありますので、公式のドキュメントやリポジトリを参照して最新の情報を確認してください。

---

## 👤 ユーザー
*2023/8/13 12:16:33*

ちなみにプロジェクトは「https://github.com/orgs/Viagate/projects/2」でcolumnは「👁️ In Review（PR）」

---

## 🤖 アシスタント
*2023/8/13 12:16:53*

わかりました。ご提供いただいたURLとカラム名を使ってGitHub Actionsの設定を書き直します。

```yaml
name: Move new PR to "👁️ In Review（PR）" column in Project

on:
  pull_request:
    types:
      - opened

jobs:
  move-to-column:
    runs-on: ubuntu-latest
    steps:
    - name: Move PR to "👁️ In Review（PR）" column
      uses: alex-page/github-project-automation-plus@v0.6.0
      with:
        project: https://github.com/orgs/Viagate/projects/2
        column: 👁️ In Review（PR）
        repo-token: ${{ secrets.GITHUB_TOKEN }}
```

上記の設定を `.github/workflows` ディレクトリ内のYAMLファイルに保存してください。これにより、新しいPRが作成されるたびに自動的に "👁️ In Review（PR）" カラムに移動されるようになります。

ただし、このGitHub Actionはプロジェクトの名前やカラムの名前で動作するように設計されています。プロジェクトのURLを直接使う場合は正しく動作しない可能性があるので、プロジェクトの名前を指定する必要があります。プロジェクトの名前を正確に知っていれば、`project`フィールドの値としてそれを使用してください。

---

## 👤 ユーザー
*2023/8/13 12:17:12*

projectやcolumnを取得する方法を教えて欲しい。

---

## 🤖 アシスタント
*2023/8/13 12:17:42*

GitHub ProjectsのAPIを使用してプロジェクトやカラムの情報を取得することができます。以下の手順では、cURLコマンドを使用してこれらの情報を取得する方法を示します。

### 1. プロジェクトの情報を取得:

組織の全てのプロジェクトの一覧を取得するには以下のcURLコマンドを使用します：

```bash
curl -H "Authorization: token YOUR_GITHUB_TOKEN" \
     -H "Accept: application/vnd.github.inertia-preview+json" \
     https://api.github.com/orgs/Viagate/projects
```

この結果の中から、目的のプロジェクトのIDを見つけることができます。

### 2. カラムの情報を取得:

上で取得したプロジェクトID（例として `PROJECT_ID` とする）を使用して、関連するカラムの情報を取得します：

```bash
curl -H "Authorization: token YOUR_GITHUB_TOKEN" \
     -H "Accept: application/vnd.github.inertia-preview+json" \
     https://api.github.com/projects/PROJECT_ID/columns
```

この結果の中から、目的のカラムのIDと名前を見つけることができます。

注意点：

- `YOUR_GITHUB_TOKEN` は、実際のGitHubアクセストークンに置き換えてください。アクセストークンは、[GitHubの設定](https://github.com/settings/tokens)から生成することができます。このトークンには、`read:org`、`repo`、`read:repo_hook`、`read:user`、`user:email` の権限が必要です。
- このAPIはGitHubの [inertia-preview](https://developer.github.com/v3/repos/projects/) メディアタイプを使用していますので、`Accept` ヘッダにこの値を指定する必要があります。
- APIの利用制限や、トークンの取り扱いに注意してください。公開しないようにし、必要な操作のみを行う権限のあるトークンを生成してください。

---

## 👤 ユーザー
*2023/8/13 12:25:56*

YOUR_GITHUB_TOKEN は、GitHubの設定 をみるとすでに設定されていたみたいだったけど、これは新たに生成したほうがいいの？

---

## 🤖 アシスタント
*2023/8/13 12:26:30*

`YOUR_GITHUB_TOKEN` の指すものは、GitHubでの操作にAPI経由でアクセスするための個人アクセストークンを指します。これは非常に強力なもので、トークンに付与された権限に基づいて、リポジトリの内容の変更や、プライベートリポジトリへのアクセスなどの操作が可能となります。

トークンを新しく生成するかどうかの判断は以下の点を考慮してください：

1. **既存のトークンの権限**: 既存のトークンが持つ権限があなたの必要とする操作のために過度でないか確認してください。例えば、あなたが必要とするのが公開リポジトリへの読み取りアクセスのみである場合、プライベートリポジトリへの完全なアクセス権を持つトークンを使用するのはリスクが高まります。

2. **使用目的**: トークンは特定の目的やタスクのために分離して生成するのがベストプラクティスです。これにより、何らかの理由でトークンが露出した場合のダメージを最小限に抑えることができます。

3. **安全性**: 既存のトークンをどこかで保存している場合、その保存場所の安全性を確認してください。また、トークンを手動で扱う場合やスクリプト内で使用する場合には、誤って公開しないよう注意が必要です。

4. **ローテーション**: セキュリティのベストプラクティスとして、定期的にアクセストークンをローテーション（更新）することを検討してください。

結論として、特定の目的やタスクに合わせて新しいトークンを生成することを推奨します。これにより、各トークンの使用目的を明確にし、セキュリティリスクを最小限に抑えることができます。既存のトークンを使用する場合も、上記の点を確認し、適切な権限が付与されていることを確認してください。

---

## 👤 ユーザー
*2023/8/13 12:33:01*

PROJECT_IDやcolumnの値を取得する方法ってないの？

---

## 🤖 アシスタント
*2023/8/13 12:33:23*

すみません、ご指摘の通り、具体的な手順をお伝えするべきでした。

GitHub APIを使用して、具体的に`PROJECT_ID`や`column`のIDを取得する方法を以下に示します。

### 1. プロジェクトのID (`PROJECT_ID`) を取得:

組織の全てのプロジェクトの一覧を取得します：

```bash
curl -H "Authorization: token YOUR_GITHUB_TOKEN" \
     -H "Accept: application/vnd.github.inertia-preview+json" \
     https://api.github.com/orgs/Viagate/projects
```

この結果の中から、目的のプロジェクトの名前に対応するIDを見つけることができます。`id`フィールドの値が`PROJECT_ID`となります。

### 2. カラムのIDを取得:

上で取得した`PROJECT_ID`を使用して、関連するカラムの情報を取得します：

```bash
curl -H "Authorization: token YOUR_GITHUB_TOKEN" \
     -H "Accept: application/vnd.github.inertia-preview+json" \
     https://api.github.com/projects/PROJECT_ID/columns
```

この結果の中から、目的のカラム（この場合「👁️ In Review（PR）」）の名前に対応するIDを見つけることができます。`id`フィールドの値がカラムのIDとなります。

これらの手順を実行することで、必要な`PROJECT_ID`とカラムのIDを取得できます。これらのIDを使用して、API経由でさまざまな操作を自動化することができます。

---

## 👤 ユーザー
*2023/8/13 12:33:35*

もっと簡単に取得する方法ってないの？

---

## 🤖 アシスタント
*2023/8/13 12:33:55*

GitHubのWeb UIを使用して、`PROJECT_ID`やカラムのIDを比較的簡単に取得する方法があります。

### プロジェクトID (`PROJECT_ID`) の取得:

1. GitHubのWebサイトにログインして、目的のプロジェクトページ（https://github.com/orgs/Viagate/projects/2）にアクセスします。
2. URLの最後の数字がプロジェクトのIDです。この場合、`2`が`PROJECT_ID`となります。

### カラムIDの取得:

1. 上記のプロジェクトページにアクセスします。
2. 「👁️ In Review（PR）」という名前のカラムの部分を右クリックして、「リンクのアドレスをコピー」（ブラウザによっては少し文言が異なる場合があります）を選択します。
3. コピーされたURLをどこかにペーストします。そのURLの末尾の数字部分がカラムのIDです。

これらの手順により、`PROJECT_ID`とカラムIDを比較的簡単に取得することができます。ただし、正確なIDの値はURLやページの構造に依存するため、GitHubのUIが変更されるとこの方法が使用できなくなる可能性があります。

---

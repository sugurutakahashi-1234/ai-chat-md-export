# 正方形表示の修正

日付: 2024-12-17

---

## 👤 ユーザー
*2024/12/17 18:51:14*

これを正方形で表示するようにして欲しい
import 'dart:io';

import 'package:flutter/material.dart';
import 'package:flutter\_hooks/flutter\_hooks.dart';
import 'package:go\_router/go\_router.dart';
import 'package:image\_cropper/image\_cropper.dart';
import 'package:image\_picker/image\_picker.dart';
import 'package:permission\_handler/permission\_handler.dart';

class GuildCreatePage extends HookWidget {
  const GuildCreatePage({super.key});

  @override
  Widget build(BuildContext context) {
    final imageFile = useState&lt;File?&gt;(null);
    final picker = useMemoized(ImagePicker.new);

    /// 写真を選択して円状にクロップする
    Future&lt;void&gt; pickAndCropImage() async {
      final pickedFile = await picker.pickImage(source: ImageSource.gallery);

      if (pickedFile != null) {
        final croppedFile = await ImageCropper().cropImage(
          sourcePath: pickedFile.path,
          aspectRatio: const CropAspectRatio(ratioX: 1, ratioY: 1), // 正方形にクロップ
          uiSettings: \[
            AndroidUiSettings(
              hideBottomControls: true, // ボトムコントロール非表示
              lockAspectRatio: true, // アスペクト比を固定
              // cropStyle: CropStyle.circle, // 円形にクロップ
            ),
            IOSUiSettings(
              aspectRatioLockEnabled: true, // アスペクト比を固定
              // cropStyle: CropStyle.circle, // 円形にクロップ
            ),
          \],
        );

        if (croppedFile != null) {
          imageFile.value = File(croppedFile.path);
        } else {
          debugPrint('クロップがキャンセルされました');
        }
      } else {
        debugPrint('画像選択がキャンセルされました');
      }
    }

    /// 写真を削除
    void deleteImage() {
      imageFile.value = null;
      debugPrint('画像が削除されました');
    }

    return Scaffold(
      appBar: AppBar(title: const Text('GuildCreatePage')),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: \[
            imageFile.value != null
                ? Column(
                    children: \[
                      ClipOval(
                        child: Image.file(
                          imageFile.value!,
                          width: 150,
                          height: 150,
                          fit: BoxFit.cover,
                        ),
                      ),
                      const SizedBox(height: 10),
                      ElevatedButton(
                        onPressed: deleteImage,
                        child: const Text('画像を削除'),
                      ),
                    \],
                  )
                : const Text('画像が選択されていません'),
            const SizedBox(height: 20),
            ElevatedButton(
              onPressed: () async {
                final status = await \_checkPhotoPermission(context);
                if (status == PermissionStatus.granted) {
                  await pickAndCropImage();
                }
              },
              child: const Text('ギルドアイコンを選択'),
            ),
            ElevatedButton(
              onPressed: () {
                context.pop();
              },
              child: const Text('Create'),
            ),
          \],
        ),
      ),
    );
  }

  /// 写真の権限をチェックする
  Future&lt;PermissionStatus&gt; \_checkPhotoPermission(BuildContext context) async {
    final status = await Permission.photos.request();

    if (status.isGranted) {
      // 許可済みの場合
      return status;
    } else if (status.isPermanentlyDenied) {
      // 永久に拒否されている場合
      if (context.mounted) {
        \_showPermissionDialog(context);
      }
    } else {
      // その他のケース（拒否された場合）
      if (context.mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          const SnackBar(content: Text('写真へのアクセスが許可されていません。')),
        );
      }
    }
    return status;
  }

  /// 設定ダイアログを表示
  void \_showPermissionDialog(BuildContext context) {
    showDialog&lt;void&gt;(
      context: context,
      builder: (context) =&gt; AlertDialog(
        title: const Text('写真へのアクセス許可が必要です'),
        content: const Text('写真を選択するには、設定で写真へのアクセス許可をオンにしてください。'),
        actions: \[
          TextButton(
            onPressed: () {
              Navigator.of(context).pop();
            },
            child: const Text('キャンセル'),
          ),
          TextButton(
            onPressed: () async {
              await openAppSettings(); // アプリの設定画面を開く
            },
            child: const Text('設定を開く'),
          ),
        \],
      ),
    );
  }
}

---

## 🤖 アシスタント
*2024/12/17 18:51:27*

クロップ後の画像を**正方形**で表示するように修正するには、以下の箇所を変更します。

### 修正ポイント
1. **`ClipOval`** を **`ClipRect`** に変更します。
2. **表示する画像のウィジェットサイズ**を固定の正方形に設定します。

---

以下は修正後のコードです：

### 変更部分
```dart
// ClipOval → ClipRectに変更し、画像を正方形に表示
ClipRect(
  child: Image.file(
    imageFile.value!,
    width: 150, // 正方形の幅
    height: 150, // 正方形の高さ
    fit: BoxFit.cover,
  ),
),
```

---

### 修正後の該当部分
```dart
imageFile.value != null
    ? Column(
        children: [
          ClipRect(
            child: Image.file(
              imageFile.value!,
              width: 150, // 正方形に表示
              height: 150, // 正方形の高さ
              fit: BoxFit.cover,
            ),
          ),
          const SizedBox(height: 10),
          ElevatedButton(
            onPressed: deleteImage,
            child: const Text('画像を削除'),
          ),
        ],
      )
    : const Text('画像が選択されていません'),
```

---

### 解説
- **`ClipRect`** は矩形で画像をクリップするため、正方形の形で表示されます。
- **`width`** と **`height`** を同じ値（`150`）に設定することで、正方形になります。
- **`BoxFit.cover`** は画像のアスペクト比を保ちつつ、指定のサイズに収まるように調整します。

これで画像は正方形で表示され、円形クリップを外して正方形の形になります。

---

## 👤 ユーザー
*2024/12/17 18:52:10*

ちょっと角丸にしてほしい

ClipRect(
                        child: Image.file(
                          imageFile.value!,
                          width: 150,
                          height: 150,
                          fit: BoxFit.cover,
                        ),
                      ),

---

## 🤖 アシスタント
*2024/12/17 18:52:23*

角丸にするには `ClipRRect` を使用します。`borderRadius` を指定することで、画像の角を丸くできます。

---

### 修正後のコード
```dart
ClipRRect(
  borderRadius: BorderRadius.circular(16), // 角丸の半径を設定
  child: Image.file(
    imageFile.value!,
    width: 150, // 正方形の幅
    height: 150, // 正方形の高さ
    fit: BoxFit.cover,
  ),
),
```

---

### 解説
- **`ClipRRect`**: 角丸の矩形で画像をクリップするウィジェット。
- **`BorderRadius.circular`**: `16` のような値で角の丸み具合を調整します。値を大きくすると丸みが強くなります。
- **`BoxFit.cover`**: 画像を指定サイズ内に収めつつ、アスペクト比を維持します。

---

### 完成形
角丸で正方形に画像が表示されるようになり、自然なデザインになります。角丸のサイズはお好みで調整してください。

---

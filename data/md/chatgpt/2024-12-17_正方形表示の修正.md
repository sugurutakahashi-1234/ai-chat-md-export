# æ­£æ–¹å½¢è¡¨ç¤ºã®ä¿®æ­£

æ—¥ä»˜: 2024-12-17

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/12/17 18:51:14*

ã“ã‚Œã‚’æ­£æ–¹å½¢ã§è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—ã¦æ¬²ã—ã„
import 'dart:io';

import 'package:flutter/material.dart';
import 'package:flutter\_hooks/flutter\_hooks.dart';
import 'package:go\_router/go\_router.dart';
import 'package:image\_cropper/image\_cropper.dart';
import 'package:image\_picker/image\_picker.dart';
import 'package:permission\_handler/permission\_handler.dart';

class GuildCreatePage extends HookWidget {
  const GuildCreatePage({super.key});

  @override
  Widget build(BuildContext context) {
    final imageFile = useState&lt;File?&gt;(null);
    final picker = useMemoized(ImagePicker.new);

    /// å†™çœŸã‚’é¸æŠã—ã¦å††çŠ¶ã«ã‚¯ãƒ­ãƒƒãƒ—ã™ã‚‹
    Future&lt;void&gt; pickAndCropImage() async {
      final pickedFile = await picker.pickImage(source: ImageSource.gallery);

      if (pickedFile != null) {
        final croppedFile = await ImageCropper().cropImage(
          sourcePath: pickedFile.path,
          aspectRatio: const CropAspectRatio(ratioX: 1, ratioY: 1), // æ­£æ–¹å½¢ã«ã‚¯ãƒ­ãƒƒãƒ—
          uiSettings: \[
            AndroidUiSettings(
              hideBottomControls: true, // ãƒœãƒˆãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«éè¡¨ç¤º
              lockAspectRatio: true, // ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‚’å›ºå®š
              // cropStyle: CropStyle.circle, // å††å½¢ã«ã‚¯ãƒ­ãƒƒãƒ—
            ),
            IOSUiSettings(
              aspectRatioLockEnabled: true, // ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‚’å›ºå®š
              // cropStyle: CropStyle.circle, // å††å½¢ã«ã‚¯ãƒ­ãƒƒãƒ—
            ),
          \],
        );

        if (croppedFile != null) {
          imageFile.value = File(croppedFile.path);
        } else {
          debugPrint('ã‚¯ãƒ­ãƒƒãƒ—ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ');
        }
      } else {
        debugPrint('ç”»åƒé¸æŠãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ');
      }
    }

    /// å†™çœŸã‚’å‰Šé™¤
    void deleteImage() {
      imageFile.value = null;
      debugPrint('ç”»åƒãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸ');
    }

    return Scaffold(
      appBar: AppBar(title: const Text('GuildCreatePage')),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: \[
            imageFile.value != null
                ? Column(
                    children: \[
                      ClipOval(
                        child: Image.file(
                          imageFile.value!,
                          width: 150,
                          height: 150,
                          fit: BoxFit.cover,
                        ),
                      ),
                      const SizedBox(height: 10),
                      ElevatedButton(
                        onPressed: deleteImage,
                        child: const Text('ç”»åƒã‚’å‰Šé™¤'),
                      ),
                    \],
                  )
                : const Text('ç”»åƒãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“'),
            const SizedBox(height: 20),
            ElevatedButton(
              onPressed: () async {
                final status = await \_checkPhotoPermission(context);
                if (status == PermissionStatus.granted) {
                  await pickAndCropImage();
                }
              },
              child: const Text('ã‚®ãƒ«ãƒ‰ã‚¢ã‚¤ã‚³ãƒ³ã‚’é¸æŠ'),
            ),
            ElevatedButton(
              onPressed: () {
                context.pop();
              },
              child: const Text('Create'),
            ),
          \],
        ),
      ),
    );
  }

  /// å†™çœŸã®æ¨©é™ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
  Future&lt;PermissionStatus&gt; \_checkPhotoPermission(BuildContext context) async {
    final status = await Permission.photos.request();

    if (status.isGranted) {
      // è¨±å¯æ¸ˆã¿ã®å ´åˆ
      return status;
    } else if (status.isPermanentlyDenied) {
      // æ°¸ä¹…ã«æ‹’å¦ã•ã‚Œã¦ã„ã‚‹å ´åˆ
      if (context.mounted) {
        \_showPermissionDialog(context);
      }
    } else {
      // ãã®ä»–ã®ã‚±ãƒ¼ã‚¹ï¼ˆæ‹’å¦ã•ã‚ŒãŸå ´åˆï¼‰
      if (context.mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          const SnackBar(content: Text('å†™çœŸã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒè¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚')),
        );
      }
    }
    return status;
  }

  /// è¨­å®šãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
  void \_showPermissionDialog(BuildContext context) {
    showDialog&lt;void&gt;(
      context: context,
      builder: (context) =&gt; AlertDialog(
        title: const Text('å†™çœŸã¸ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ãŒå¿…è¦ã§ã™'),
        content: const Text('å†™çœŸã‚’é¸æŠã™ã‚‹ã«ã¯ã€è¨­å®šã§å†™çœŸã¸ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚’ã‚ªãƒ³ã«ã—ã¦ãã ã•ã„ã€‚'),
        actions: \[
          TextButton(
            onPressed: () {
              Navigator.of(context).pop();
            },
            child: const Text('ã‚­ãƒ£ãƒ³ã‚»ãƒ«'),
          ),
          TextButton(
            onPressed: () async {
              await openAppSettings(); // ã‚¢ãƒ—ãƒªã®è¨­å®šç”»é¢ã‚’é–‹ã
            },
            child: const Text('è¨­å®šã‚’é–‹ã'),
          ),
        \],
      ),
    );
  }
}

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/12/17 18:51:27*

ã‚¯ãƒ­ãƒƒãƒ—å¾Œã®ç”»åƒã‚’**æ­£æ–¹å½¢**ã§è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ä¿®æ­£ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®ç®‡æ‰€ã‚’å¤‰æ›´ã—ã¾ã™ã€‚

### ä¿®æ­£ãƒã‚¤ãƒ³ãƒˆ
1. **`ClipOval`** ã‚’ **`ClipRect`** ã«å¤‰æ›´ã—ã¾ã™ã€‚
2. **è¡¨ç¤ºã™ã‚‹ç”»åƒã®ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚µã‚¤ã‚º**ã‚’å›ºå®šã®æ­£æ–¹å½¢ã«è¨­å®šã—ã¾ã™ã€‚

---

ä»¥ä¸‹ã¯ä¿®æ­£å¾Œã®ã‚³ãƒ¼ãƒ‰ã§ã™ï¼š

### å¤‰æ›´éƒ¨åˆ†
```dart
// ClipOval â†’ ClipRectã«å¤‰æ›´ã—ã€ç”»åƒã‚’æ­£æ–¹å½¢ã«è¡¨ç¤º
ClipRect(
  child: Image.file(
    imageFile.value!,
    width: 150, // æ­£æ–¹å½¢ã®å¹…
    height: 150, // æ­£æ–¹å½¢ã®é«˜ã•
    fit: BoxFit.cover,
  ),
),
```

---

### ä¿®æ­£å¾Œã®è©²å½“éƒ¨åˆ†
```dart
imageFile.value != null
    ? Column(
        children: [
          ClipRect(
            child: Image.file(
              imageFile.value!,
              width: 150, // æ­£æ–¹å½¢ã«è¡¨ç¤º
              height: 150, // æ­£æ–¹å½¢ã®é«˜ã•
              fit: BoxFit.cover,
            ),
          ),
          const SizedBox(height: 10),
          ElevatedButton(
            onPressed: deleteImage,
            child: const Text('ç”»åƒã‚’å‰Šé™¤'),
          ),
        ],
      )
    : const Text('ç”»åƒãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“'),
```

---

### è§£èª¬
- **`ClipRect`** ã¯çŸ©å½¢ã§ç”»åƒã‚’ã‚¯ãƒªãƒƒãƒ—ã™ã‚‹ãŸã‚ã€æ­£æ–¹å½¢ã®å½¢ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
- **`width`** ã¨ **`height`** ã‚’åŒã˜å€¤ï¼ˆ`150`ï¼‰ã«è¨­å®šã™ã‚‹ã“ã¨ã§ã€æ­£æ–¹å½¢ã«ãªã‚Šã¾ã™ã€‚
- **`BoxFit.cover`** ã¯ç”»åƒã®ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‚’ä¿ã¡ã¤ã¤ã€æŒ‡å®šã®ã‚µã‚¤ã‚ºã«åã¾ã‚‹ã‚ˆã†ã«èª¿æ•´ã—ã¾ã™ã€‚

ã“ã‚Œã§ç”»åƒã¯æ­£æ–¹å½¢ã§è¡¨ç¤ºã•ã‚Œã€å††å½¢ã‚¯ãƒªãƒƒãƒ—ã‚’å¤–ã—ã¦æ­£æ–¹å½¢ã®å½¢ã«ãªã‚Šã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/12/17 18:52:10*

ã¡ã‚‡ã£ã¨è§’ä¸¸ã«ã—ã¦ã»ã—ã„

ClipRect(
                        child: Image.file(
                          imageFile.value!,
                          width: 150,
                          height: 150,
                          fit: BoxFit.cover,
                        ),
                      ),

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/12/17 18:52:23*

è§’ä¸¸ã«ã™ã‚‹ã«ã¯ `ClipRRect` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚`borderRadius` ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€ç”»åƒã®è§’ã‚’ä¸¸ãã§ãã¾ã™ã€‚

---

### ä¿®æ­£å¾Œã®ã‚³ãƒ¼ãƒ‰
```dart
ClipRRect(
  borderRadius: BorderRadius.circular(16), // è§’ä¸¸ã®åŠå¾„ã‚’è¨­å®š
  child: Image.file(
    imageFile.value!,
    width: 150, // æ­£æ–¹å½¢ã®å¹…
    height: 150, // æ­£æ–¹å½¢ã®é«˜ã•
    fit: BoxFit.cover,
  ),
),
```

---

### è§£èª¬
- **`ClipRRect`**: è§’ä¸¸ã®çŸ©å½¢ã§ç”»åƒã‚’ã‚¯ãƒªãƒƒãƒ—ã™ã‚‹ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã€‚
- **`BorderRadius.circular`**: `16` ã®ã‚ˆã†ãªå€¤ã§è§’ã®ä¸¸ã¿å…·åˆã‚’èª¿æ•´ã—ã¾ã™ã€‚å€¤ã‚’å¤§ããã™ã‚‹ã¨ä¸¸ã¿ãŒå¼·ããªã‚Šã¾ã™ã€‚
- **`BoxFit.cover`**: ç”»åƒã‚’æŒ‡å®šã‚µã‚¤ã‚ºå†…ã«åã‚ã¤ã¤ã€ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‚’ç¶­æŒã—ã¾ã™ã€‚

---

### å®Œæˆå½¢
è§’ä¸¸ã§æ­£æ–¹å½¢ã«ç”»åƒãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã€è‡ªç„¶ãªãƒ‡ã‚¶ã‚¤ãƒ³ã«ãªã‚Šã¾ã™ã€‚è§’ä¸¸ã®ã‚µã‚¤ã‚ºã¯ãŠå¥½ã¿ã§èª¿æ•´ã—ã¦ãã ã•ã„ã€‚

---

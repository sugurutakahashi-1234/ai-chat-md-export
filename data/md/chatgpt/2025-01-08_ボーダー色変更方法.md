# ボーダー色変更方法

日付: 2025-01-08

---

## 👤 ユーザー
*2025/1/8 18:41:33*

CarouselSliderで現在表示中のものについて、ボーダーの色を変えたい。

import 'package:carousel_slider/carousel_slider.dart';
import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:go_router/go_router.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:snpit_guild_app/infrastructure/snapit_guild_api/snapit_guild_api.openapi.dart';
import 'package:snpit_guild_app/presentation/design_token/color_token.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/explorers/get_explorer_info.dart';

class ExplorerListPage extends HookConsumerWidget {
  const ExplorerListPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final explorerState = ref.watch(getExplorerNotifierProvider);

    useEffect(
      () {
        WidgetsBinding.instance.addPostFrameCallback((_) {
          ref.read(getExplorerNotifierProvider.notifier).executeRequest();
        });
        return null;
      },
      [],
    );

    Widget buildExplorerCard(ExplorerDTO explorer) {
      final imageUrl = explorer.explorerImage?.isNotEmpty == true
          ? explorer.explorerImage!
          : null;

      return Card(
        shape: RoundedRectangleBorder(
          borderRadius: BorderRadius.circular(16),
          side: const BorderSide(color: ColorToken.secondary),
        ),
        color: ColorToken.bg,
        elevation: 4,
        child: Padding(
          padding: const EdgeInsets.all(16),
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              Row(
                children: [
                  ClipRRect(
                    borderRadius: BorderRadius.circular(8),
                    child: imageUrl != null
                        ? Image.network(
                            imageUrl,
                            height: 120,
                            width: 120,
                            fit: BoxFit.cover,
                            errorBuilder: (context, error, stackTrace) {
                              return Container(
                                width: 120,
                                height: 120,
                                color: ColorToken.bgDark,
                                child: const Icon(
                                  Icons.broken_image_outlined,
                                  size: 96,
                                  color: ColorToken.text,
                                ),
                              );
                            },
                          )
                        : Container(
                          width: 120,
                          height: 120,
                          color: ColorToken.bgDark,
                          child: const Icon(
                            Icons.hide_image_outlined,
                            size: 96,
                            color: ColorToken.text,
                          ),
                          ),
                  ),
                  Expanded(
                    child: Column(
                      mainAxisSize: MainAxisSize.min,
                      crossAxisAlignment: CrossAxisAlignment.start,
                      children: [
                        const Text(
                          'Life',
                          style: TextStyle(
                            fontSize: 14,
                            color: ColorToken.border,
                          ),
                        ),
                        const SizedBox(height: 4),
                        Flexible(
                          child: LinearProgressIndicator(
                            value: (explorer.energy ?? 0) / 100,
                            valueColor: const AlwaysStoppedAnimation&lt;Color&gt;(
                              ColorToken.primary,
                            ),
                            backgroundColor: ColorToken.bgDark,
                            borderRadius: BorderRadius.circular(8),
                          ),
                        ),
                        const SizedBox(height: 12),
                        const Text(
                          'Search range',
                          style: TextStyle(
                            fontSize: 14,
                            color: ColorToken.border,
                          ),
                        ),
                        const SizedBox(height: 4),
                        Text(
                          '${explorer.range ?? 0}km radius',
                          style: const TextStyle(
                            fontSize: 14,
                          ),
                        ),
                        const SizedBox(height: 12),
                        Text(
                          explorer.explorerDescription ?? 'No description',
                          style: const TextStyle(
                            fontSize: 12,
                          ),
                        ),
                      ],
                    ),
                  ),
                ],
              ),
            ],
          ),
        ),
      );
    }

    return Scaffold(
      appBar: AppBar(
        automaticallyImplyLeading: false,
        title: const Text('Select explorer'),
        actions: [
          IconButton(
            onPressed: () =&gt; context.pop(),
            icon: const Icon(Icons.close),
          ),
        ],
      ),
      body: explorerState.when(
        data: (explorers) {
          if ((explorers ?? []).isEmpty) {
            return const Center(child: Text('No explorers available.'));
          }

          return Column(
            children: [
              Expanded(
                child: CarouselSlider.builder(
                  options: CarouselOptions(),
                  itemCount: explorers?.length ?? 0,
                  itemBuilder: (context, index, realIndex) {
                    final explorer = explorers?[index];
                    return Padding(
                      padding: const EdgeInsets.symmetric(horizontal: 8),
                      child:
                          explorer != null ? buildExplorerCard(explorer) : null,
                    );
                  },
                ),
              ),
            ],
          );
        },
        loading: () =&gt; const Center(child: CircularProgressIndicator()),
        error: (error, _) =&gt; Center(child: Text('Error: $error')),
      ),
      bottomNavigationBar: SafeArea(
        child: Padding(
          padding: const EdgeInsets.all(16),
          child: ElevatedButton(
            onPressed: () {
              context.pop();
            },
            child: const Text('Start explore'),
          ),
        ),
      ),
    );
  }
}

---

## 🤖 アシスタント
*2025/1/8 18:42:00*

`CarouselSlider`で現在表示中の項目のボーダー色を変えるには、現在のインデックスを追跡し、そのインデックスが対応するアイテムに特定のスタイルを適用する必要があります。以下はその実装例です：

### 手順
1. **現在のインデックスを追跡するための状態を定義**：
   `useState`を利用して現在のインデックスを管理します。

2. **`CarouselSlider`の`onPageChanged`コールバックでインデックスを更新**：
   ページ変更イベントをリッスンして状態を更新します。

3. **現在のインデックスと一致する項目のボーダー色を変更**：
   条件に基づいて`BorderSide`を設定します。

以下にコードを修正した例を示します：

```dart
final currentIndex = useState(0); // 現在のインデックスを追跡

return Scaffold(
  appBar: AppBar(
    automaticallyImplyLeading: false,
    title: const Text('Select explorer'),
    actions: [
      IconButton(
        onPressed: () => context.pop(),
        icon: const Icon(Icons.close),
      ),
    ],
  ),
  body: explorerState.when(
    data: (explorers) {
      if ((explorers ?? []).isEmpty) {
        return const Center(child: Text('No explorers available.'));
      }

      return Column(
        children: [
          Expanded(
            child: CarouselSlider.builder(
              options: CarouselOptions(
                onPageChanged: (index, reason) {
                  currentIndex.value = index; // 現在のインデックスを更新
                },
              ),
              itemCount: explorers?.length ?? 0,
              itemBuilder: (context, index, realIndex) {
                final explorer = explorers?[index];
                final isSelected = index == currentIndex.value;

                return Padding(
                  padding: const EdgeInsets.symmetric(horizontal: 8),
                  child: Card(
                    shape: RoundedRectangleBorder(
                      borderRadius: BorderRadius.circular(16),
                      side: BorderSide(
                        color: isSelected
                            ? ColorToken.primary // 選択中の色
                            : ColorToken.secondary, // 通常の色
                        width: isSelected ? 3 : 1, // ボーダーの太さを変更
                      ),
                    ),
                    color: ColorToken.bg,
                    elevation: 4,
                    child: explorer != null
                        ? buildExplorerCard(explorer)
                        : const SizedBox.shrink(),
                  ),
                );
              },
            ),
          ),
        ],
      );
    },
    loading: () => const Center(child: CircularProgressIndicator()),
    error: (error, _) => Center(child: Text('Error: $error')),
  ),
  bottomNavigationBar: SafeArea(
    child: Padding(
      padding: const EdgeInsets.all(16),
      child: ElevatedButton(
        onPressed: () {
          context.pop();
        },
        child: const Text('Start explore'),
      ),
    ),
  ),
);
```

### 変更点
1. **`useState`を使用**：現在のインデックスを管理。
2. **`onPageChanged`コールバックを設定**：スライダーのページ変更時にインデックスを更新。
3. **ボーダー色と太さを条件分岐**：現在選択されている項目に応じて`BorderSide`を変更。

これで、現在表示中の項目のボーダー色が変更され、選択状態を視覚的に強調できます。

---

## 👤 ユーザー
*2025/1/8 18:45:35*

これだと、既存のWidget buildExplorerCard(ExplorerDTO explorer) {でもボーダーを設定しているのでちょうふくしてしまう。また太さは変えなくていいよ

---

## 🤖 アシスタント
*2025/1/8 18:46:19*

既存の `buildExplorerCard` にボーダーが既に設定されているので、ボーダーを重複せずに色だけを変更するよう修正します。この場合、`buildExplorerCard` を少し改造し、色を引数で受け取れるようにする方法が適切です。

以下は修正例です。

### 修正内容

1. **`buildExplorerCard`にボーダーの色を受け取る引数を追加**：
   - デフォルトのボーダー色を指定しつつ、動的に変更可能にします。

2. **現在のインデックスを確認し、選択中のボーダー色を指定**：
   - `CarouselSlider` のインデックスに基づき、`buildExplorerCard` 呼び出し時に色を渡します。

### 修正版コード

```dart
Widget buildExplorerCard(ExplorerDTO explorer, Color borderColor) {
  final imageUrl = explorer.explorerImage?.isNotEmpty == true
      ? explorer.explorerImage!
      : null;

  return Card(
    shape: RoundedRectangleBorder(
      borderRadius: BorderRadius.circular(16),
      side: BorderSide(color: borderColor), // ボーダーの色を引数で受け取る
    ),
    color: ColorToken.bg,
    elevation: 4,
    child: Padding(
      padding: const EdgeInsets.all(16),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          Row(
            children: [
              ClipRRect(
                borderRadius: BorderRadius.circular(8),
                child: imageUrl != null
                    ? Image.network(
                        imageUrl,
                        height: 120,
                        width: 120,
                        fit: BoxFit.cover,
                        errorBuilder: (context, error, stackTrace) {
                          return Container(
                            width: 120,
                            height: 120,
                            color: ColorToken.bgDark,
                            child: const Icon(
                              Icons.broken_image_outlined,
                              size: 96,
                              color: ColorToken.text,
                            ),
                          );
                        },
                      )
                    : Container(
                        width: 120,
                        height: 120,
                        color: ColorToken.bgDark,
                        child: const Icon(
                          Icons.hide_image_outlined,
                          size: 96,
                          color: ColorToken.text,
                        ),
                      ),
              ),
              Expanded(
                child: Column(
                  mainAxisSize: MainAxisSize.min,
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    const Text(
                      'Life',
                      style: TextStyle(
                        fontSize: 14,
                        color: ColorToken.border,
                      ),
                    ),
                    const SizedBox(height: 4),
                    LinearProgressIndicator(
                      value: (explorer.energy ?? 0) / 100,
                      valueColor: const AlwaysStoppedAnimation<Color>(
                        ColorToken.primary,
                      ),
                      backgroundColor: ColorToken.bgDark,
                    ),
                    const SizedBox(height: 12),
                    const Text(
                      'Search range',
                      style: TextStyle(
                        fontSize: 14,
                        color: ColorToken.border,
                      ),
                    ),
                    const SizedBox(height: 4),
                    Text(
                      '${explorer.range ?? 0}km radius',
                      style: const TextStyle(
                        fontSize: 14,
                      ),
                    ),
                    const SizedBox(height: 12),
                    Text(
                      explorer.explorerDescription ?? 'No description',
                      style: const TextStyle(
                        fontSize: 12,
                      ),
                    ),
                  ],
                ),
              ),
            ],
          ),
        ],
      ),
    ),
  );
}
```

### `CarouselSlider`での使用例

```dart
final currentIndex = useState(0);

return Scaffold(
  appBar: AppBar(
    automaticallyImplyLeading: false,
    title: const Text('Select explorer'),
    actions: [
      IconButton(
        onPressed: () => context.pop(),
        icon: const Icon(Icons.close),
      ),
    ],
  ),
  body: explorerState.when(
    data: (explorers) {
      if ((explorers ?? []).isEmpty) {
        return const Center(child: Text('No explorers available.'));
      }

      return Column(
        children: [
          Expanded(
            child: CarouselSlider.builder(
              options: CarouselOptions(
                onPageChanged: (index, reason) {
                  currentIndex.value = index; // インデックスを更新
                },
              ),
              itemCount: explorers?.length ?? 0,
              itemBuilder: (context, index, realIndex) {
                final explorer = explorers?[index];
                final borderColor = index == currentIndex.value
                    ? ColorToken.primary // 選択中のカードの色
                    : ColorToken.secondary; // 通常の色

                return Padding(
                  padding: const EdgeInsets.symmetric(horizontal: 8),
                  child: explorer != null
                      ? buildExplorerCard(explorer, borderColor)
                      : null,
                );
              },
            ),
          ),
        ],
      );
    },
    loading: () => const Center(child: CircularProgressIndicator()),
    error: (error, _) => Center(child: Text('Error: $error')),
  ),
  bottomNavigationBar: SafeArea(
    child: Padding(
      padding: const EdgeInsets.all(16),
      child: ElevatedButton(
        onPressed: () {
          context.pop();
        },
        child: const Text('Start explore'),
      ),
    ),
  ),
);
```

### 主なポイント
1. **`buildExplorerCard`がボーダー色を引数で受け取るよう変更**：
   - 既存の構造を活かしつつ、動的に色を設定できる。

2. **現在のインデックスに基づいて色を切り替え**：
   - `currentIndex` を基に `ColorToken.primary` を設定。

これにより、現在表示中の項目のボーダー色を変更でき、ボーダーの太さはそのまま維持されます。

---

## 👤 ユーザー
*2025/1/8 19:00:51*

それよりかはboolを引数にしたほうがいい気がする

---

## 🤖 アシスタント
*2025/1/8 19:01:50*

確かに、`bool` を引数にして「選択中かどうか」を判断させる方が簡潔で分かりやすいですね。それにより、`buildExplorerCard` の呼び出し元で条件を判定しやすくなります。以下に修正例を示します。

### 修正版コード

#### `buildExplorerCard`の修正
`bool isSelected` を引数に追加し、選択中かどうかでボーダーの色を変更します。

```dart
Widget buildExplorerCard(ExplorerDTO explorer, bool isSelected) {
  final imageUrl = explorer.explorerImage?.isNotEmpty == true
      ? explorer.explorerImage!
      : null;

  return Card(
    shape: RoundedRectangleBorder(
      borderRadius: BorderRadius.circular(16),
      side: BorderSide(
        color: isSelected ? ColorToken.primary : ColorToken.secondary, // 選択状態で色を切り替え
      ),
    ),
    color: ColorToken.bg,
    elevation: 4,
    child: Padding(
      padding: const EdgeInsets.all(16),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          Row(
            children: [
              ClipRRect(
                borderRadius: BorderRadius.circular(8),
                child: imageUrl != null
                    ? Image.network(
                        imageUrl,
                        height: 120,
                        width: 120,
                        fit: BoxFit.cover,
                        errorBuilder: (context, error, stackTrace) {
                          return Container(
                            width: 120,
                            height: 120,
                            color: ColorToken.bgDark,
                            child: const Icon(
                              Icons.broken_image_outlined,
                              size: 96,
                              color: ColorToken.text,
                            ),
                          );
                        },
                      )
                    : Container(
                        width: 120,
                        height: 120,
                        color: ColorToken.bgDark,
                        child: const Icon(
                          Icons.hide_image_outlined,
                          size: 96,
                          color: ColorToken.text,
                        ),
                      ),
              ),
              Expanded(
                child: Column(
                  mainAxisSize: MainAxisSize.min,
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    const Text(
                      'Life',
                      style: TextStyle(
                        fontSize: 14,
                        color: ColorToken.border,
                      ),
                    ),
                    const SizedBox(height: 4),
                    LinearProgressIndicator(
                      value: (explorer.energy ?? 0) / 100,
                      valueColor: const AlwaysStoppedAnimation<Color>(
                        ColorToken.primary,
                      ),
                      backgroundColor: ColorToken.bgDark,
                    ),
                    const SizedBox(height: 12),
                    const Text(
                      'Search range',
                      style: TextStyle(
                        fontSize: 14,
                        color: ColorToken.border,
                      ),
                    ),
                    const SizedBox(height: 4),
                    Text(
                      '${explorer.range ?? 0}km radius',
                      style: const TextStyle(
                        fontSize: 14,
                      ),
                    ),
                    const SizedBox(height: 12),
                    Text(
                      explorer.explorerDescription ?? 'No description',
                      style: const TextStyle(
                        fontSize: 12,
                      ),
                    ),
                  ],
                ),
              ),
            ],
          ),
        ],
      ),
    ),
  );
}
```

---

#### `CarouselSlider`での使用例
`index == currentIndex.value` の結果を `bool` として渡します。

```dart
final currentIndex = useState(0); // 現在のインデックスを追跡

return Scaffold(
  appBar: AppBar(
    automaticallyImplyLeading: false,
    title: const Text('Select explorer'),
    actions: [
      IconButton(
        onPressed: () => context.pop(),
        icon: const Icon(Icons.close),
      ),
    ],
  ),
  body: explorerState.when(
    data: (explorers) {
      if ((explorers ?? []).isEmpty) {
        return const Center(child: Text('No explorers available.'));
      }

      return Column(
        children: [
          Expanded(
            child: CarouselSlider.builder(
              options: CarouselOptions(
                onPageChanged: (index, reason) {
                  currentIndex.value = index; // インデックスを更新
                },
              ),
              itemCount: explorers?.length ?? 0,
              itemBuilder: (context, index, realIndex) {
                final explorer = explorers?[index];
                final isSelected = index == currentIndex.value;

                return Padding(
                  padding: const EdgeInsets.symmetric(horizontal: 8),
                  child: explorer != null
                      ? buildExplorerCard(explorer, isSelected)
                      : null,
                );
              },
            ),
          ),
        ],
      );
    },
    loading: () => const Center(child: CircularProgressIndicator()),
    error: (error, _) => Center(child: Text('Error: $error')),
  ),
  bottomNavigationBar: SafeArea(
    child: Padding(
      padding: const EdgeInsets.all(16),
      child: ElevatedButton(
        onPressed: () {
          context.pop();
        },
        child: const Text('Start explore'),
      ),
    ),
  ),
);
```

---

### 修正のポイント
1. **`bool isSelected`を渡すシンプルな設計**：
   - 呼び出し元での条件分岐が簡潔になる。
   - ボーダー色の切り替えロジックが`buildExplorerCard`内部に隠蔽され、再利用性が高まる。

2. **太さは変更せず、色のみを変更**：
   - デザイン要件に忠実。

これにより、現在表示中の項目のみが視覚的に強調され、コードの見通しも良くなります。

---

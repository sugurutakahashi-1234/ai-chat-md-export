# SwiftUIÊîπÂñÑ: „É¶„Éº„Ç∂„ÉºAPI

Date: 2024-05-29

---

## üë§ User
*2024-05-29 17:41:43*

SwiftUI„Åß getUser() „ÇÑ getUsers() „ÅÆÊåôÂãï„ÇíÁ¢∫Ë™ç„Åô„Çã View „Çí‰Ωú„Çä„Åü„ÅÑ„ÄÅÁâπ„Å´„É™„ÇØ„Ç®„Çπ„Éà„ÇíÂÆüË°å„Åô„ÇãÈÉ®ÂàÜ„ÅåÈÅ©ÂΩì„Å™ÂÆüË£Ö„Å´„Å™„Å£„Å¶„ÅÑ„Çã„ÅÆ„ÅßÊîπÂñÑ„Åó„Åü„ÅÑ„ÄÇ

‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å™„Åì„Å®„Çí„Åó„Åü„ÅÑ

- getUser() or getUsers() „ÅÆ„Å©„Å°„Çâ„ÇíÂÆüÊñΩ„Åô„Çã„Åã„ÇíÈÅ∏„Åπ„ÇãÊ©üËÉΩ
- getUser() „Å™„Å©„ÅÆ„Éë„É©„É°„Éº„Çø„Éº„ÅåÂøÖË¶Å„Å™API„ÅØËá™ÂàÜ„Åß„Éë„É©„É°„Éº„Çø„Éº„ÇíË®≠ÂÆö„Åß„Åç„Çã„Çà„ÅÜ„Å´„Åô„Çã
- „É¨„Çπ„Éù„É≥„Çπ„ÇíÂÖ±Êúâ„Åó„Å¶„ÅÑ„Çã„ÅåÂà•„ÄÖ„Å´„Åô„Çã

import SwiftUI
import OpenAPIURLSession

public struct ContentView: View {
    @State var users: [Components.Schemas.User] = []
    let client: Client

    public init() {
        self.client = Client(
            serverURL: try! Servers.server1(),
            transport: URLSessionTransport()
        )
    }

    public var body: some View {
        VStack {
            ScrollView(.horizontal) {
                HStack {
                    Button {
                        Task {
                            await getUsers()
                        }
                    } label: {
                        VStack {
                            Image(systemName: "globe")
                                .imageScale(.large)
                                .foregroundStyle(.tint)
                            Text("getUsers")
                        }
                        .padding()
                    }
                    
                    Button {
                        Task {
                            await getUser()
                        }
                    } label: {
                        VStack {
                            Image(systemName: "globe")
                                .imageScale(.large)
                                .foregroundStyle(.tint)
                            Text("getUser")
                        }
                        .padding()
                    }
                }
            }

            ResponsePropertyView(objects: users)
        }
    }

    func getUsers() async {
        let response = try! await client.getUsers()
        
        switch response {
        case .ok(let okResponse):
            switch okResponse.body {
            case .json(let users):
                self.users = users
            }
        case .undocumented(statusCode: let statusCode, _):
            print("\(statusCode)")
        }
    }

    func getUser() async {
        let response = try! await client.getUserById(path: .init(id: 1))

        switch response {
        case .ok(let okResponse):
            switch okResponse.body {
            case .json(let user):
                self.users = [user]
            }
        case .undocumented(statusCode: let statusCode, _):
            print("\(statusCode)")
        }
    }
}

#Preview {
    ContentView()
}


import SwiftUI
import SimpleToast

// MARK: - View

struct ResponsePropertyView&lt;T: Encodable&gt;: View {
    @State var showToast: Bool = false
    let objects: [T]
    
    init(objects: [T]) {
        self.objects = objects
    }

    public var body: some View {
        List {
            Section {
                DisclosureGroup {
                    VStack(alignment: .leading) {
                        HStack(alignment: .top) {
                            Spacer()
                            Button {
                                onTapElement(object: objects)
                            } label : {
                                Image(systemName: "doc.on.doc")
                            }
                            .buttonStyle(.borderless)
                        }

                        Text("\(try! jsonString(objects: objects))")
                    }
                } label: {
                    Text("Response")
                }
            }

            ForEach(Array(objects.enumerated()), id: \.offset) { index, object in
                Section {
                    propertyView(object: object)
                } header: {
                    HStack {
                        Text("\(type(of: object))[\(index)]")

                        Spacer()

                        Button {
                            onTapElement(object: object)
                        } label : {
                            Image(systemName: "doc.on.doc")
                        }
                        .buttonStyle(.borderless)
                    }
                }
                .textCase(.none)
            }
        }
        .simpleToast(isPresented: $showToast, options: SimpleToastOptions(
            alignment: .bottom,
            hideAfter: 1
        )) {
            Label {
                Text("Copy")
            } icon: {
                Image(systemName: "checkmark.circle")
            }
            .padding()
            .background(Color.green.opacity(0.8))
            .foregroundColor(Color.white)
            .cornerRadius(12)
            .padding(.top)
        }
    }

    func propertyView(object: Any) -&gt; some View {
        AnyView(ForEach(Array(Mirror(reflecting: object).children.enumerated()), id: \.offset) { index, child in
            if let label = child.label {
                let childMirror = Mirror(reflecting: child.value)
                if childMirror.displayStyle == .struct || childMirror.displayStyle == .class {
                    DisclosureGroup {
                        propertyView(object: child.value)
                    } label: {
                        Text(label)
                    }
                } else if let subObjects = child.value as? [Any] {
                    DisclosureGroup {
                        ForEach(Array(subObjects.enumerated()), id: \.offset) { subIndex, subObject in
                            let subObjectMirror = Mirror(reflecting: subObject)
                            if subObjectMirror.displayStyle == .struct || subObjectMirror.displayStyle == .class {
                                DisclosureGroup {
                                    propertyView(object: subObject)
                                } label: {
                                    HStack(alignment: .top) {
                                        Text("\(type(of: subObject))")
                                            .foregroundStyle(.black)
                                        Spacer()
                                        Text("\(type(of: subObject))[\(subIndex)]")
                                    }
                                }
                            } else {
                                Button {
                                    onTapElement(object: subObject)
                                } label: {
                                    HStack(alignment: .top) {
                                        Text("[\(subIndex)]")
                                            .foregroundStyle(.black)
                                        Spacer()
                                        Text("\(subObject)")
                                    }
                                }
                            }
                        }
                    } label: {
                        HStack(alignment: .top) {
                            Text(label)
                                .foregroundStyle(.black)
                            Spacer()
                            Text("\(Mirror(reflecting: child.value).subjectType)")
                        }
                    }
                } else {
                    Button {
                        onTapElement(object: child.value)
                    } label: {
                        HStack(alignment: .top) {
                            Text(label)
                                .foregroundStyle(.black)
                            Spacer()
                            Text("\(child.value)")
                        }
                    }
                }
            } else {
                Button {
                    onTapElement(object: child.value)
                } label: {
                    HStack(alignment: .top) {
                        Text("[\(index)]")
                            .foregroundStyle(.black)
                        Spacer()
                        Text("\(child.value)")
                    }
                }
            }
        })
    }
    
    func onTapElement(object: Any) {
        UIPasteboard.general.string = {
            do {
                return try jsonString(object: object)
            } catch {
                return "\(object)"
            }
        }()
        
        showToast = true
    }

    func jsonString(object: Any) throws -&gt; String {
        guard let encodableObject = object as? Encodable else {
            throw CancellationError()
        }

        let encoder = JSONEncoder()
        encoder.outputFormatting = .prettyPrinted

        let data = try encoder.encode(encodableObject)
        guard let jsonString = String(data: data, encoding: .utf8) else {
            throw CancellationError()
        }

        return jsonString
    }
    
    func jsonString&lt;U: Encodable&gt;(objects: [U]) throws -&gt; String {
        let encoder = JSONEncoder()
        encoder.outputFormatting = .prettyPrinted

        let data = try encoder.encode(objects)
        guard let jsonString = String(data: data, encoding: .utf8) else {
            throw CancellationError()
        }

        return jsonString
    }
}

// MARK: - Sample Entity

enum CityType: Codable {
    case urban
    case rural
}

struct Address: Codable {
    var city: [String]
    var postalCode: [Int]
    var cityType: CityType
}

struct Person: Codable {
    var name: String
    var age: Int
    var isEmployed: Bool
    var address: [Address]
}

struct Persons: Codable {
    var persons: [Person]
}

// MARK: - Preview

#Preview {
    NavigationStack {
        ResponsePropertyView(objects: [
            Persons(persons: [
                Person(name: "John Doe", age: 30, isEmployed: true, address: [
                    Address(city: ["New Yor„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇk", "„Éà„Éº„Ç≠„Éß„Éº"], postalCode: [10001, 10002], cityType: .urban),
                    Address(city: ["New York", "„Éà„Éº„Ç≠„Éß„Éº"], postalCode:[10001, 10002], cityType: .urban),
                ]),
                Person(name: "John Doe", age: 30, isEmployed: true, address: [
                    Address(city: ["New York", "„Éà„Éº„Ç≠„Éß„Éº"], postalCode: [10001, 10002], cityType: .urban),
                    Address(city: ["New York", "„Éà„Éº„Ç≠„Éß„Éº"], postalCode: [10001, 10002], cityType: .urban),
                ])
            ])
        ])
    }
}

---

## ü§ñ Assistant
*2024-05-29 17:42:12*

‰ª•‰∏ã„ÅÆ„Ç≥„Éº„Éâ„ÅØ„ÄÅSwiftUI„Åß `getUser()` „ÇÑ `getUsers()` „ÅÆÊåôÂãï„ÇíÁ¢∫Ë™ç„Åô„Çã„Åü„ÇÅ„ÅÆ„Éì„É•„Éº„ÇíÂÆüË£Ö„Åó„ÄÅ„Éë„É©„É°„Éº„Çø„Éº„Çí„É¶„Éº„Ç∂„Éº„ÅåË®≠ÂÆö„Åß„Åç„Çã„Çà„ÅÜ„Å´ÊîπÂñÑ„Åó„Åü„ÇÇ„ÅÆ„Åß„Åô„ÄÇ

- `getUser()` „Å® `getUsers()` „ÅÆÂÆüË°å„ÇíÈÅ∏Êäû„Åô„Çã„Åü„ÇÅ„ÅÆ„Éú„Çø„É≥„ÇíÁî®ÊÑè„Åó„Åæ„Åó„Åü„ÄÇ
- `getUser()` „ÅÆ„Éë„É©„É°„Éº„Çø„ÉºÔºà„É¶„Éº„Ç∂„ÉºIDÔºâ„Çí„É¶„Éº„Ç∂„Éº„ÅåÂÖ•Âäõ„Åß„Åç„Çã„Çà„ÅÜ„Å´„Åó„Åæ„Åó„Åü„ÄÇ
- „É¨„Çπ„Éù„É≥„Çπ„ÇíÂÄãÂà•„Å´Ë°®Á§∫„Åô„Çã„Åü„ÇÅ„Å´„ÄÅ`ResponsePropertyView` „Çí‰øÆÊ≠£„Åó„Åæ„Åó„Åü„ÄÇ

```swift
import SwiftUI
import OpenAPIURLSession

public struct ContentView: View {
    @State var users: [Components.Schemas.User] = []
    @State var userId: String = ""
    @State var selectedAPI: APIType = .getUsers
    let client: Client

    enum APIType {
        case getUsers
        case getUser
    }

    public init() {
        self.client = Client(
            serverURL: try! Servers.server1(),
            transport: URLSessionTransport()
        )
    }

    public var body: some View {
        VStack {
            Picker("API", selection: $selectedAPI) {
                Text("getUsers").tag(APIType.getUsers)
                Text("getUser").tag(APIType.getUser)
            }
            .pickerStyle(SegmentedPickerStyle())
            .padding()

            if selectedAPI == .getUser {
                TextField("User ID", text: $userId)
                    .textFieldStyle(RoundedBorderTextFieldStyle())
                    .padding()
            }

            Button {
                Task {
                    await executeSelectedAPI()
                }
            } label: {
                VStack {
                    Image(systemName: "globe")
                        .imageScale(.large)
                        .foregroundStyle(.tint)
                    Text("Execute")
                }
                .padding()
            }

            ResponsePropertyView(objects: users)
        }
    }

    func executeSelectedAPI() async {
        switch selectedAPI {
        case .getUsers:
            await getUsers()
        case .getUser:
            if let id = Int(userId) {
                await getUser(id: id)
            } else {
                print("Invalid User ID")
            }
        }
    }

    func getUsers() async {
        do {
            let response = try await client.getUsers()
            switch response {
            case .ok(let okResponse):
                switch okResponse.body {
                case .json(let users):
                    self.users = users
                }
            case .undocumented(statusCode: let statusCode, _):
                print("\(statusCode)")
            }
        } catch {
            print("Failed to fetch users: \(error)")
        }
    }

    func getUser(id: Int) async {
        do {
            let response = try await client.getUserById(path: .init(id: id))
            switch response {
            case .ok(let okResponse):
                switch okResponse.body {
                case .json(let user):
                    self.users = [user]
                }
            case .undocumented(statusCode: let statusCode, _):
                print("\(statusCode)")
            }
        } catch {
            print("Failed to fetch user: \(error)")
        }
    }
}

#Preview {
    ContentView()
}
```

`ResponsePropertyView` „Å´„Å§„ÅÑ„Å¶„ÅØ„ÄÅÁâπ„Å´‰øÆÊ≠£„ÅØÂøÖË¶Å„ÅÇ„Çä„Åæ„Åõ„Çì„Åå„ÄÅ„ÇÇ„ÅóÁâπÂÆö„ÅÆË°®Á§∫ÊñπÊ≥ï„ÇíÊîπÂñÑ„Åó„Åü„ÅÑÂ†¥Âêà„ÇÑ„ÄÅ„Åï„Çâ„Å´Á¥∞„Åã„ÅèÂà∂Âæ°„Åó„Åü„ÅÑÂ†¥Âêà„ÅØ„ÄÅ„Åù„ÅÆÈÉ®ÂàÜ„ÅÆ„É≠„Ç∏„ÉÉ„ÇØ„ÇíË™øÊï¥„Åô„Çã„Åì„Å®„ÇÇ„Åß„Åç„Åæ„Åô„ÄÇ

‰∏äË®ò„ÅÆ„Ç≥„Éº„Éâ„Å´„Çà„Çä„ÄÅ„É¶„Éº„Ç∂„Éº„Åå `getUsers()` „Åæ„Åü„ÅØ `getUser()` „ÅÆ„Å©„Å°„Çâ„ÅÆAPI„ÇíÂÆüË°å„Åô„Çã„Åã„ÇíÈÅ∏Êäû„Åß„Åç„ÄÅÂøÖË¶Å„Å´Âøú„Åò„Å¶ `getUser()` „ÅÆ„Éë„É©„É°„Éº„Çø„Éº„ÇíÂÖ•Âäõ„Åó„Å¶ÂÆüË°å„Åô„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ

---

# 無タグ対応スクリプト

Date: 2024-05-17

---

## 👤 User
*2024-05-17 09:58:58*

こういうスクリプトがあるんだけどtagがなくても動くようにして欲しい

  # 必要なコミット数だけ履歴を取得する（git rev-list だとうまくいかなかったので、一旦、500 にしておく）
  git fetch --deepen 500

  # 直近のタグを変数に格納
  LATEST_TAG=$(git describe --tags --abbrev=0)

  # フェッチしたコミットから、Merge pull requestのものだけを取得して、見やすいように1行空ける
  git log $LATEST_TAG..HEAD --pretty=format:"[%cs] %s %b" | grep 'Merge pull request' | awk '{print $0 "\n"}' &gt;! $TESTFLIGHT_DIR_PATH/WhatToTest.en-US.txt

---

## 🤖 Assistant
*2024-05-17 09:59:07*

タグがない場合でも動作するようにするには、直近のタグが存在しない場合にはタグを指定せずに`git log`コマンドを実行するように変更する必要があります。以下のようにスクリプトを修正します：

```bash
#!/bin/bash

# 必要なコミット数だけ履歴を取得する（git rev-list だとうまくいかなかったので、一旦、500 にしておく）
git fetch --deepen 500

# 直近のタグを変数に格納
LATEST_TAG=$(git describe --tags --abbrev=0 2>/dev/null)

# 直近のタグが存在しない場合はタグなしでログを取得
if [ -z "$LATEST_TAG" ]; then
  # フェッチしたコミットから、Merge pull requestのものだけを取得して、見やすいように1行空ける
  git log HEAD --pretty=format:"[%cs] %s %b" | grep 'Merge pull request' | awk '{print $0 "\n"}' > $TESTFLIGHT_DIR_PATH/WhatToTest.en-US.txt
else
  # フェッチしたコミットから、Merge pull requestのものだけを取得して、見やすいように1行空ける
  git log $LATEST_TAG..HEAD --pretty=format:"[%cs] %s %b" | grep 'Merge pull request' | awk '{print $0 "\n"}' > $TESTFLIGHT_DIR_PATH/WhatToTest.en-US.txt
fi
```

このスクリプトでは、`git describe --tags --abbrev=0`コマンドの実行結果を`LATEST_TAG`変数に格納し、直近のタグが存在しない場合は`HEAD`からログを取得するようにしています。また、`2>/dev/null`を追加することで、タグが存在しない場合のエラーメッセージを無視します。

---

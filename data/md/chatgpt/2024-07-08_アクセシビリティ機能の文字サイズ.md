# アクセシビリティ機能の文字サイズ

日付: 2024-07-08

---

## 👤 ユーザー
*2024/7/8 17:56:46*

アクセスビリティーの文字サイズの機能をオフにしたアプリを作りたいが、設定をオンにすればシステム設定の文字サイズを反映するようにしたい

---

## 🤖 アシスタント
*2024/7/8 17:57:06*

アプリ内でアクセシビリティの文字サイズ機能をオフにした状態と、システム設定の文字サイズを反映する状態を切り替えるには、以下のようなアプローチが考えられます。

### 1. ユーザーデフォルトでフラグを管理
アクセシビリティの文字サイズ機能をオン・オフするフラグを `UserDefaults` で管理します。

```swift
import SwiftUI

class SettingsViewModel: ObservableObject {
    @Published var isAccessibilityTextSizeEnabled: Bool {
        didSet {
            UserDefaults.standard.set(isAccessibilityTextSizeEnabled, forKey: "isAccessibilityTextSizeEnabled")
        }
    }

    init() {
        self.isAccessibilityTextSizeEnabled = UserDefaults.standard.bool(forKey: "isAccessibilityTextSizeEnabled")
    }
}
```

### 2. 文字サイズの調整
アプリ内の文字サイズを制御するために、カスタム修飾子を作成します。

```swift
import SwiftUI

struct CustomTextModifier: ViewModifier {
    @EnvironmentObject var settingsViewModel: SettingsViewModel
    
    func body(content: Content) -> some View {
        if settingsViewModel.isAccessibilityTextSizeEnabled {
            return content
                .font(.body) // システムのデフォルトフォントを使用
        } else {
            return content
                .font(.system(size: 14)) // 固定サイズのフォントを使用
        }
    }
}

extension View {
    func customTextStyle() -> some View {
        self.modifier(CustomTextModifier())
    }
}
```

### 3. SwiftUIビューでの使用
このカスタム修飾子をSwiftUIビューで使用します。

```swift
struct ContentView: View {
    @EnvironmentObject var settingsViewModel: SettingsViewModel

    var body: some View {
        VStack {
            Text("Hello, World!")
                .customTextStyle()

            Toggle("Accessibility Text Size", isOn: $settingsViewModel.isAccessibilityTextSizeEnabled)
                .padding()
        }
        .padding()
    }
}
```

### 4. アプリ起動時に設定を反映
`App` 構造体で `SettingsViewModel` を環境オブジェクトとして注入します。

```swift
@main
struct MyApp: App {
    @StateObject private var settingsViewModel = SettingsViewModel()

    var body: some Scene {
        WindowGroup {
            ContentView()
                .environmentObject(settingsViewModel)
        }
    }
}
```

この方法により、ユーザーがアプリ内の設定を切り替えることで、文字サイズの変更を反映できるようになります。

---

## 👤 ユーザー
*2024/7/8 17:57:36*

全サイズの文字サイズを用意してほしい

---

## 🤖 アシスタント
*2024/7/8 17:58:03*

全てのサイズの文字サイズを制御できるように、各文字サイズの設定を保持し、それに基づいてフォントサイズを適用するように変更します。

まず、アプリ内で使用する文字サイズのリストを用意し、選択した文字サイズに応じてフォントサイズを適用します。

### 1. ユーザーデフォルトで選択した文字サイズを管理

```swift
import SwiftUI

enum FontSize: String, CaseIterable {
    case small, medium, large, extraLarge
    
    var size: CGFloat {
        switch self {
        case .small:
            return 12
        case .medium:
            return 14
        case .large:
            return 18
        case .extraLarge:
            return 24
        }
    }
}

class SettingsViewModel: ObservableObject {
    @Published var selectedFontSize: FontSize {
        didSet {
            UserDefaults.standard.set(selectedFontSize.rawValue, forKey: "selectedFontSize")
        }
    }
    
    @Published var isAccessibilityTextSizeEnabled: Bool {
        didSet {
            UserDefaults.standard.set(isAccessibilityTextSizeEnabled, forKey: "isAccessibilityTextSizeEnabled")
        }
    }

    init() {
        if let savedFontSize = UserDefaults.standard.string(forKey: "selectedFontSize"),
           let fontSize = FontSize(rawValue: savedFontSize) {
            self.selectedFontSize = fontSize
        } else {
            self.selectedFontSize = .medium
        }
        self.isAccessibilityTextSizeEnabled = UserDefaults.standard.bool(forKey: "isAccessibilityTextSizeEnabled")
    }
}
```

### 2. カスタム修飾子でフォントサイズを設定

```swift
import SwiftUI

struct CustomTextModifier: ViewModifier {
    @EnvironmentObject var settingsViewModel: SettingsViewModel
    
    func body(content: Content) -> some View {
        if settingsViewModel.isAccessibilityTextSizeEnabled {
            return content
                .font(.body) // システムのデフォルトフォントを使用
        } else {
            return content
                .font(.system(size: settingsViewModel.selectedFontSize.size))
        }
    }
}

extension View {
    func customTextStyle() -> some View {
        self.modifier(CustomTextModifier())
    }
}
```

### 3. SwiftUIビューでの使用

```swift
struct ContentView: View {
    @EnvironmentObject var settingsViewModel: SettingsViewModel

    var body: some View {
        VStack {
            Text("Hello, World!")
                .customTextStyle()
            
            Picker("Font Size", selection: $settingsViewModel.selectedFontSize) {
                ForEach(FontSize.allCases, id: \.self) { size in
                    Text(size.rawValue.capitalized).tag(size)
                }
            }
            .pickerStyle(SegmentedPickerStyle())
            .padding()

            Toggle("Accessibility Text Size", isOn: $settingsViewModel.isAccessibilityTextSizeEnabled)
                .padding()
        }
        .padding()
    }
}
```

### 4. アプリ起動時に設定を反映

```swift
@main
struct MyApp: App {
    @StateObject private var settingsViewModel = SettingsViewModel()

    var body: some Scene {
        WindowGroup {
            ContentView()
                .environmentObject(settingsViewModel)
        }
    }
}
```

この実装により、ユーザーは「フォントサイズ」の選択肢から希望のサイズを選ぶことができ、アクセシビリティの文字サイズ機能をオンにするとシステムのデフォルトフォントサイズが適用されるようになります。

---

## 👤 ユーザー
*2024/7/8 17:58:21*

ピッカーではなくてListで全部並べてほしい

---

## 🤖 アシスタント
*2024/7/8 17:58:38*

ピッカーではなく、`List`を使用してフォントサイズの選択肢を並べて表示する方法をご紹介します。

### 1. ユーザーデフォルトで選択した文字サイズを管理
この部分は前述のコードをそのまま使用します。

### 2. カスタム修飾子でフォントサイズを設定
この部分も前述のコードをそのまま使用します。

### 3. SwiftUIビューでの使用（Listを使用）
`List`を使用して、フォントサイズの選択肢を並べます。

```swift
struct ContentView: View {
    @EnvironmentObject var settingsViewModel: SettingsViewModel

    var body: some View {
        VStack {
            Text("Hello, World!")
                .customTextStyle()
                .padding()

            Toggle("Accessibility Text Size", isOn: $settingsViewModel.isAccessibilityTextSizeEnabled)
                .padding()

            List {
                Section(header: Text("Font Sizes")) {
                    ForEach(FontSize.allCases, id: \.self) { size in
                        HStack {
                            Text(size.rawValue.capitalized)
                            Spacer()
                            if settingsViewModel.selectedFontSize == size {
                                Image(systemName: "checkmark")
                            }
                        }
                        .contentShape(Rectangle())
                        .onTapGesture {
                            settingsViewModel.selectedFontSize = size
                        }
                    }
                }
            }
        }
    }
}
```

### 4. アプリ起動時に設定を反映
この部分も前述のコードをそのまま使用します。

```swift
@main
struct MyApp: App {
    @StateObject private var settingsViewModel = SettingsViewModel()

    var body: some Scene {
        WindowGroup {
            ContentView()
                .environmentObject(settingsViewModel)
        }
    }
}
```

この実装により、`List`でフォントサイズの選択肢を並べて表示し、タップすると選択したサイズにフォントが変更されるようになります。選択されたサイズにはチェックマークを表示します。

---

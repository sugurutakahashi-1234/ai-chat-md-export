# Push変更なしの対処方法

Date: 2024-11-14

---

## 👤 User
*2024-11-14 14:41:40*

Gitで変更がない場合にpushしたくない

name: Deploy Mermaid Diagram

on:
  push:
    paths:
      - 'assets/mermaid/finance.mmd'
      - '.github/workflows/*.yml'
      - 'README.md'

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  build:
    runs-on: ubuntu-latest

    permissions:
      contents: write

    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        persist-credentials: false

    - name: Set up Node.js environment
      uses: actions/setup-node@v4
      with:
        node-version: '20'

    - name: Install dependencies
      run: npm install

    - name: Install Japanese font
      run: |
        sudo apt-get update
        sudo apt-get install -y fonts-noto-cjk

    - name: Generate Mermaid Diagram
      run: npm run generate-diagram

    - name: Update README with mermaid diagram
      run: npm run update-readme

    - name: Commit and push updates
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        git add ./docs/diagrams/finance.png README.md
        git commit -m "Update README with latest Mermaid diagram and finance.png"
        git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git
        git push origin HEAD:${{ github.ref }}

  #   - name: Upload to Imgur
  #     uses: devicons/public-upload-to-imgur@v2.2.2
  #     with:
  #       path: './docs/diagrams/finance.png'
  #       client_id: ${{ secrets.IMGUR_CLIENT_ID }}
  #       description: "Images uploaded by public-upload-to-imgur GitHub Action"

  #   - name: Set up GitHub Pages
  #     uses: actions/configure-pages@v5

  #   - name: Upload Pages Artifact
  #     uses: actions/upload-pages-artifact@v3
  #     with:
  #       path: './docs'

  # deploy:
  #   needs: build
  #   runs-on: ubuntu-latest
  #   permissions:
  #     contents: read
  #     pages: write
  #     id-token: write
  #   environment:
  #     name: github-pages
  #   steps:
  #   - name: Deploy to GitHub Pages
  #     uses: actions/deploy-pages@v4

---

## 🤖 Assistant
*2024-11-14 14:41:45*

To avoid pushing if there are no changes, you can modify the "Commit and push updates" step to check if there are any changes before committing and pushing. Here’s how you can adjust that step:

```yaml
    - name: Commit and push updates
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        
        git add ./docs/diagrams/finance.png README.md
        
        # Check for changes and commit if there are any
        if ! git diff --cached --quiet; then
          git commit -m "Update README with latest Mermaid diagram and finance.png"
          git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git
          git push origin HEAD:${{ github.ref }}
        else
          echo "No changes to commit."
        fi
```

### Explanation

- `git add` stages the files you want to commit.
- `git diff --cached --quiet` checks if there are any staged changes. If there are no changes, it exits without committing or pushing.
- If there are changes, it proceeds with the commit and push.

---

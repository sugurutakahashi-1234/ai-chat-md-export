# モデル識別子を取得

日付: 2023-06-24

---

## 👤 ユーザー
*2023/06/24 16:53:14*

SwiftでUIDevice.current.name  ではなくて、Watch1,2 、iPad1,1  などの Identifier名を取得する方法を教えて欲しい

---

## 🤖 アシスタント
*2023/06/24 16:53:44*

Swiftでは、デバイスのモデル識別子を取得するためにはシステム情報にアクセスする必要があります。システム情報にアクセスするためには、低レベルのC APIを使用する必要があります。以下のコードスニペットは、その一例です。

```swift
import UIKit

public extension UIDevice {
    
    var modelIdentifier: String {
        var systemInfo = utsname()
        uname(&systemInfo)
        let machineMirror = Mirror(reflecting: systemInfo.machine)
        let identifier = machineMirror.children.reduce("") { identifier, element in
            guard let value = element.value as? Int8, value != 0 else { return identifier }
            return identifier + String(UnicodeScalar(UInt8(value)))
        }
        
        return identifier
    }
}
```

このコードでは、`uname`関数を使用してシステム情報を取得し、その後で`machine`フィールドからデバイスのモデル識別子を取得します。得られたモデル識別子は、たとえば「iPad1,1」や「Watch1,2」などの形式になります。

使い方は簡単で、以下のように呼び出します：

```swift
let deviceModelIdentifier = UIDevice.current.modelIdentifier
print(deviceModelIdentifier) // モデル識別子が出力されます（例えば "iPad1,1"）
```

ただし、この識別子は技術的なものであり、一般のユーザーにとってはあまり意味がないかもしれません。ユーザーフレンドリーなデバイス名を表示するためには、モデル識別子を適切なデバイス名にマッピングする辞書が必要になります。これは手動で作成するか、あるいはインターネットで見つけることができます。

---

## 👤 ユーザー
*2023/06/24 16:54:05*

UIDevice.current.nameでよくないですか？

---

## 🤖 アシスタント
*2023/06/24 16:54:24*

`UIDevice.current.name`はユーザが自分のデバイスに付けた名前を返します。例えば、ユーザが自分のiPhoneの名前を「John's iPhone」と設定していた場合、`UIDevice.current.name`は「John's iPhone」を返します。

一方、あなたが要求していたものは、デバイスのモデル識別子（たとえば「iPad1,1」や「Watch1,2」など）です。これはハードウェアのモデルを特定する一意の識別子であり、ユーザが自由に名前を変更することはできません。この情報は、特定のデバイスの機能や性能をプログラム的に判断するために有用です。

つまり、`UIDevice.current.name`とモデル識別子は、異なる情報を提供します。どちらを使用するかは、あなたが何を達成したいかによります。ユーザが自分のデバイスに付けた名前が必要ならば、`UIDevice.current.name`を使用します。ハードウェアのモデル情報が必要ならば、先ほど提供したコードスニペットを使用してモデル識別子を取得します。

---

## 👤 ユーザー
*2023/06/24 16:59:42*

シミュレーターではarm64になってしまったけど。

---

## 🤖 アシスタント
*2023/06/24 17:00:08*

実際、シミュレーターではデバイスのモデル識別子を取得する代わりに、実行中のマシンのアーキテクチャ情報（「x86_64」、「arm64」など）が返されます。これは、シミュレーターが物理的なiOSデバイスではなく、ホストマシン（Mac）上でiOSの環境をエミュレートしているためです。

シミュレーターで具体的なデバイスモデルの識別子を取得したい場合、シミュレーターの設定からそれを模倣できます。以下のコードは、シミュレーターが模倣しているデバイスのモデル識別子を返します。

```swift
#if targetEnvironment(simulator)
public extension UIDevice {
    var modelIdentifier: String {
        let identifier = ProcessInfo().environment["SIMULATOR_MODEL_IDENTIFIER"] ?? "unknown"
        return identifier
    }
}
#else
// リアルデバイス用のコード（先ほどのコードスニペットをここに挿入）
#endif
```

このコードは、実行環境がシミュレーターである場合、環境変数「SIMULATOR_MODEL_IDENTIFIER」からデバイスのモデル識別子を取得します。この環境変数はシミュレーターが模倣している具体的なデバイスのモデルに対応します（「iPhone8,1」、「iPad7,3」など）。

---

## 👤 ユーザー
*2023/06/24 17:00:23*

全文書いて欲しい

---

## 🤖 アシスタント
*2023/06/24 17:00:50*

申し訳ありませんが、全体のコードを確認したいとのこと、理解しました。以下に、シミュレーターと実デバイスで動作する全体のコードを提供します。

```swift
import UIKit

public extension UIDevice {
    
    var modelIdentifier: String {
        #if targetEnvironment(simulator)
        let identifier = ProcessInfo().environment["SIMULATOR_MODEL_IDENTIFIER"] ?? "unknown"
        return identifier
        #else
        var systemInfo = utsname()
        uname(&systemInfo)
        let machineMirror = Mirror(reflecting: systemInfo.machine)
        let identifier = machineMirror.children.reduce("") { identifier, element in
            guard let value = element.value as? Int8, value != 0 else { return identifier }
            return identifier + String(UnicodeScalar(UInt8(value)))
        }
        return identifier
        #endif
    }
}
```

このコードは、`UIDevice`の拡張として提供されており、`modelIdentifier`プロパティを呼び出すことでデバイスのモデル識別子を取得できます。

使い方は以下の通りです：

```swift
let deviceModelIdentifier = UIDevice.current.modelIdentifier
print(deviceModelIdentifier) // モデル識別子が出力されます（例えば "iPad1,1"）
```

上記のコードはシミュレーターと実デバイスの両方で動作します。シミュレーターで実行している場合、シミュレーターが模倣しているデバイスのモデル識別子が返されます。実デバイスで実行している場合、そのデバイスのモデル識別子が返されます。

---

## 👤 ユーザー
*2023/06/26 12:13:08*

端末の解像度の情報を管理するのにこのmodelIdentifierとUIDevice.current.name のどっちを使うのが妥当か？案

---

## 🤖 アシスタント
*2023/06/26 12:13:35*

デバイスの解像度やその他の技術的な仕様を管理する場合、通常は`modelIdentifier`を使用します。これは、`modelIdentifier`が各デバイスの特定のハードウェアモデルを一意に識別するためです。同じモデル識別子を持つデバイスは、画面の解像度、プロセッサの性能、メモリ容量などのハードウェア仕様が同じであることが保証されます。

`UIDevice.current.name`はユーザが自由に設定できるデバイス名を返します。ユーザは自分のiPhoneの名前を「John's iPhone」とも、「Super Fast Phone」とも設定できます。この名前はハードウェアの仕様や性能に関する情報を含んでいません。したがって、解像度などのハードウェア特性を管理するためには適していません。

したがって、デバイスの解像度を管理するためには、`modelIdentifier`を使用し、それを解像度情報にマッピングする辞書またはデータベースを作成または利用するのが妥当なアプローチと言えるでしょう。例えば、「iPhone10,3」を「2436x1125」に、「iPad7,3」を「2048x1536」にマッピングするなどです。

---

# „Ç∑„É£„ÉÉ„Çø„ÉºÈü≥„Å®UIÈÖçÁΩÆ

Êó•‰ªò: 2025-01-21

---

## üë§ „É¶„Éº„Ç∂„Éº
*2025/01/22 01:52:01*

{
  "content_type": "image_asset_pointer",
  "asset_pointer": "file-service://file-RbLzzt2AYnSTYLSMfsU3Dn",
  "size_bytes": 213563,
  "width": 309,
  "height": 668,
  "fovea": null,
  "metadata": {
    "dalle": null,
    "gizmo": null,
    "generation": null,
    "container_pixel_height": null,
    "container_pixel_width": null,
    "emu_omit_glimpse_image": null,
    "emu_patches_override": null,
    "sanitized": true,
    "asset_pointer_link": null,
    "watermarked_asset_pointer": null
  }
}
ÂÜôÁúü„ÇíÊíÆ„Å£„Åü„Å®„Åç„Å´„Ç∑„É£„ÉÉ„Çø„ÉºÈü≥„Åå„Åª„Åó„ÅÑ
ÂÜôÁúü„ÇíÊíÆ„Å£„Å¶Âá¶ÁêÜ„ÅåÁµÇ„Çè„Çã„Åæ„Åß„ÄÅ„Ç∑„É£„ÉÉ„Çø„Éº„Éú„Çø„É≥„ÇíÊäº„Åõ„Å™„ÅÑ„Çà„ÅÜ„Å´„Åó„Åü„ÅÑ„ÅÆ„Å®„ÄÅ„É≠„Éº„Éá„Ç£„É≥„Ç∞„Åß„Ç™„Éº„Éê„Éº„É¨„Ç§„Åó„Å¶„Åª„Åó„ÅÑ„ÄÇ

Ê∑ª‰ªò„Åó„ÅüÁîªÂÉè„ÅÆ„Çà„ÅÜ„Å´„Ç´„É°„É©„Éú„Çø„É≥„ÇíÂ∑¶Âè≥„ÅÆ‰∏≠Â§Æ„Å´ÈÖçÁΩÆ„Åó„Å¶„ÄÅ„Åù„ÅÆ68ptÂè≥„Å´„Éê„ÉÑ„Ç¢„Ç§„Ç≥„É≥„ÇíÈÖçÁΩÆ„Åó„Å¶„Åª„Åó„ÅÑ

„Ç≥„Éº„Éâ„Å´„Ç≥„É°„É≥„Éà„ÇíËøΩÂä†„Åó„Å™„ÅÑ„Åß„Åª„Åó„ÅÑ„ÄÇ

import 'package:camera/camera.dart';
import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:go_router/go_router.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:snpit_guild_app/domain/design/color_pallet.dart';
import 'package:snpit_guild_app/domain/design/color_token.dart';
import 'package:snpit_guild_app/domain/screen.dart';
import 'package:snpit_guild_app/presentation/providers/camera_controller_provider.dart';
import 'package:snpit_guild_app/presentation/providers/current_location.dart';
import 'package:snpit_guild_app/presentation/providers/shot_photo.dart';
import 'package:snpit_guild_app/presentation/providers/weave_target_spot.dart';

class ShootingPage extends HookConsumerWidget {
  const ShootingPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final cameraControllerState = ref.watch(cameraControllerProvider);
    final spotState = ref.watch(weaveTargetSpotNotifierProvider);
    final overlayImageUrl = spotState?.photoUrl ?? '';
    final overlayOpacity = useState&lt;double&gt;(0.5);

    Future&lt;void&gt; takePicture() async {
      if (cameraControllerState is AsyncData&lt;CameraController?&gt;) {
        final cameraController = cameraControllerState.value;
        if (cameraController == null) {
          debugPrint('CameraController is null');
          return;
        }

        if (!cameraController.value.isInitialized) {
          debugPrint('CameraController not initialized');
          return;
        }

        try {
          final xFile = await cameraController.takePicture();
          if (xFile.path.isNotEmpty) {
            final location =
                await ref.read(currentLocationNotifierProvider.future);
            ref
                .read(shotPhotoNotifierProvider.notifier)
                .shotPhoto(xFile.path, location);

            if (context.mounted) {
              await context.push(Screen.weaveSpot.path);
            }
          }
        } on CameraException catch (e) {
          debugPrint('takePicture failed: $e');
        }
      } else {
        debugPrint('Camera is not ready to take a picture yet');
      }
    }

    return cameraControllerState.when(
      loading: () =&gt; const Scaffold(
        body: Center(child: CircularProgressIndicator()),
      ),
      error: (err, st) =&gt; Scaffold(
        body: Center(
          child: Text('Failed to initialize the camera: $err'),
        ),
      ),
      data: (cameraController) {
        if (cameraController == null) {
          return const Scaffold(
            body: Center(child: Text('Camera is not available')),
          );
        }

        if (!cameraController.value.isInitialized) {
          return const Scaffold(
            body: Center(child: CircularProgressIndicator()),
          );
        }

        final screenWidth = MediaQuery.of(context).size.width;

        return Scaffold(
          body: SafeArea(
            child: Column(
              children: [
                const SizedBox(height: 100),
                SizedBox(
                  width: screenWidth,
                  height: screenWidth,
                  child: Stack(
                    fit: StackFit.expand,
                    children: [
                      CameraPreview(cameraController),
                      if (overlayImageUrl.isNotEmpty)
                        Opacity(
                          opacity: overlayOpacity.value,
                          child: Image.network(
                            overlayImageUrl,
                            fit: BoxFit.cover,
                          ),
                        ),
                    ],
                  ),
                ),
                Expanded(
                  child: Stack(
                    children: [
                      Container(color: ColorPallet.gray1000),
                      Column(
                        children: [
                          const SizedBox(height: 40),
                          Padding(
                            padding: const EdgeInsets.symmetric(horizontal: 80),
                            child: Slider(
                              activeColor: ColorToken.primary,
                              inactiveColor: ColorToken.secondary,
                              value: overlayOpacity.value,
                              onChanged: (v) =&gt; overlayOpacity.value = v,
                            ),
                          ),
                          const SizedBox(height: 68),
                          Row(
                            mainAxisAlignment: MainAxisAlignment.center,
                            children: [
                              GestureDetector(
                                onTap: takePicture,
                                child: const CircleAvatar(
                                  radius: 36,
                                  backgroundColor: ColorToken.primaryLight,
                                  child: CircleAvatar(
                                    radius: 34,
                                    backgroundColor: ColorToken.primaryDark,
                                    child: Icon(
                                      Icons.camera_alt_outlined,
                                      color: ColorToken.text,
                                      size: 36,
                                    ),
                                  ),
                                ),
                              ),
                              const SizedBox(width: 68),
                              Stack(
                                alignment: Alignment.center,
                                children: [
                                  CircleAvatar(
                                    radius: 18,
                                    backgroundColor: ColorToken.bgWhite
                                        .withValues(alpha: 0.2),
                                  ),
                                  IconButton(
                                    icon: const Icon(
                                      Icons.close,
                                      size: 24,
                                    ),
                                    color: ColorToken.text,
                                    onPressed: () async {
                                      context.pop();
                                    },
                                  ),
                                ],
                              ),
                            ],
                          ),
                        ],
                      ),
                    ],
                  ),
                ),
              ],
            ),
          ),
        );
      },
    );
  }
}

---

## ü§ñ „Ç¢„Ç∑„Çπ„Çø„É≥„Éà
*2025/01/22 01:53:37*

```dart
import 'package:camera/camera.dart';
import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:go_router/go_router.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:audioplayers/audioplayers.dart';
import 'package:snpit_guild_app/domain/design/color_pallet.dart';
import 'package:snpit_guild_app/domain/design/color_token.dart';
import 'package:snpit_guild_app/domain/screen.dart';
import 'package:snpit_guild_app/presentation/providers/camera_controller_provider.dart';
import 'package:snpit_guild_app/presentation/providers/current_location.dart';
import 'package:snpit_guild_app/presentation/providers/shot_photo.dart';
import 'package:snpit_guild_app/presentation/providers/weave_target_spot.dart';

class ShootingPage extends HookConsumerWidget {
  const ShootingPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final cameraControllerState = ref.watch(cameraControllerProvider);
    final spotState = ref.watch(weaveTargetSpotNotifierProvider);
    final overlayImageUrl = spotState?.photoUrl ?? '';
    final overlayOpacity = useState<double>(0.5);
    final isTakingPicture = useState(false);
    final player = useMemoized(() => AudioPlayer());

    Future<void> takePicture() async {
      if (cameraControllerState is AsyncData<CameraController?>) {
        final cameraController = cameraControllerState.value;
        if (cameraController == null) return;
        if (!cameraController.value.isInitialized) return;
        try {
          isTakingPicture.value = true;
          await player.play(AssetSource('sounds/shutter_sound.mp3'));
          final xFile = await cameraController.takePicture();
          if (xFile.path.isNotEmpty) {
            final location = await ref.read(currentLocationNotifierProvider.future);
            ref.read(shotPhotoNotifierProvider.notifier).shotPhoto(xFile.path, location);
            if (context.mounted) {
              await context.push(Screen.weaveSpot.path);
            }
          }
        } on CameraException catch (_) {
        } finally {
          isTakingPicture.value = false;
        }
      }
    }

    return cameraControllerState.when(
      loading: () => Scaffold(
        body: Center(child: CircularProgressIndicator()),
      ),
      error: (err, st) => Scaffold(
        body: Center(child: Text('Failed to initialize the camera: $err')),
      ),
      data: (cameraController) {
        if (cameraController == null) {
          return Scaffold(
            body: Center(child: Text('Camera is not available')),
          );
        }
        if (!cameraController.value.isInitialized) {
          return Scaffold(
            body: Center(child: CircularProgressIndicator()),
          );
        }
        final screenWidth = MediaQuery.of(context).size.width;
        return Scaffold(
          body: SafeArea(
            child: Stack(
              children: [
                Column(
                  children: [
                    SizedBox(height: 100),
                    SizedBox(
                      width: screenWidth,
                      height: screenWidth,
                      child: Stack(
                        fit: StackFit.expand,
                        children: [
                          CameraPreview(cameraController),
                          if (overlayImageUrl.isNotEmpty)
                            Opacity(
                              opacity: overlayOpacity.value,
                              child: Image.network(overlayImageUrl, fit: BoxFit.cover),
                            ),
                        ],
                      ),
                    ),
                    Expanded(
                      child: Stack(
                        children: [
                          Container(color: ColorPallet.gray1000),
                          Column(
                            children: [
                              SizedBox(height: 40),
                              Padding(
                                padding: EdgeInsets.symmetric(horizontal: 80),
                                child: Slider(
                                  activeColor: ColorToken.primary,
                                  inactiveColor: ColorToken.secondary,
                                  value: overlayOpacity.value,
                                  onChanged: (v) => overlayOpacity.value = v,
                                ),
                              ),
                              SizedBox(height: 68),
                              Row(
                                mainAxisAlignment: MainAxisAlignment.center,
                                children: [
                                  GestureDetector(
                                    onTap: () {
                                      if (!isTakingPicture.value) {
                                        takePicture();
                                      }
                                    },
                                    child: CircleAvatar(
                                      radius: 36,
                                      backgroundColor: ColorToken.primaryLight,
                                      child: CircleAvatar(
                                        radius: 34,
                                        backgroundColor: ColorToken.primaryDark,
                                        child: Icon(
                                          Icons.camera_alt_outlined,
                                          color: ColorToken.text,
                                          size: 36,
                                        ),
                                      ),
                                    ),
                                  ),
                                  SizedBox(width: 68),
                                  Stack(
                                    alignment: Alignment.center,
                                    children: [
                                      CircleAvatar(
                                        radius: 18,
                                        backgroundColor: ColorToken.bgWhite.withValues(alpha: 0.2),
                                      ),
                                      IconButton(
                                        icon: Icon(Icons.close, size: 24),
                                        color: ColorToken.text,
                                        onPressed: () {
                                          context.pop();
                                        },
                                      ),
                                    ],
                                  ),
                                ],
                              ),
                            ],
                          ),
                        ],
                      ),
                    ),
                  ],
                ),
                if (isTakingPicture.value)
                  Container(
                    color: Colors.black54,
                    child: Center(
                      child: CircularProgressIndicator(),
                    ),
                  ),
              ],
            ),
          ),
        );
      },
    );
  }
}
```

---

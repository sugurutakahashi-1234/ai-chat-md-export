# Swift MCPã‚µãƒ¼ãƒãƒ¼æ§‹ç¯‰

æ—¥ä»˜: 2025-06-26

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/26 16:10:15*

swiftã§MCPã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¦ã¦ãã®MCPã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹æ–¹æ³•

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/26 16:10:17*

Swiftã§MCPï¼ˆModel Control Protocolï¼‰ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¦ã¦ã€ãã®MCPã‚µãƒ¼ãƒãƒ¼ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚ä»¥ä¸‹ã§ã¯ã€è‡ªä½œã®ç°¡æ˜“MCPã‚µãƒ¼ãƒãƒ¼ã‚’Swiftã§ç«‹ã¦ã¦ã€ãã‚Œã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ä¾‹ã‚’æ§‹æˆã—ã¦ã„ã¾ã™ã€‚

---

## âœ… ç›®çš„
- Swiftã§MCPã®ã‚ˆã†ãªè»½é‡ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¦ã‚‹
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ãã®ã‚µãƒ¼ãƒãƒ¼ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹

â€» MCP ã¯å…¬å¼ãªè¦æ ¼ãŒã¾ã ä¸€èˆ¬çš„ã§ãªã„ãŸã‚ã€ã“ã“ã§ã¯ã€ŒJSONãƒ™ãƒ¼ã‚¹ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’æ‰±ã†ç°¡æ˜“RPCçš„APIã‚µãƒ¼ãƒãƒ¼ã€ã‚’Swiftã§ä½œã‚‹ã¨ã„ã†å½¢ã§é€²ã‚ã¾ã™ã€‚

---

## ğŸ”§ ã‚µãƒ¼ãƒãƒ¼å®Ÿè£…ï¼ˆSwiftNIOä½¿ç”¨ï¼‰

ã¾ãšã€[SwiftNIO](https://github.com/apple/swift-nio)ã‚’ä½¿ã£ã¦HTTPã‚µãƒ¼ãƒãƒ¼ã‚’ä½œã‚Šã¾ã™ã€‚ä»¥ä¸‹ã¯ `Package.swift` ã®ä¾‹ï¼š

```swift
// swift-tools-version:5.7
import PackageDescription

let package = Package(
    name: "SwiftMCPServer",
    platforms: [.macOS(.v13)],
    dependencies: [
        .package(url: "https://github.com/apple/swift-nio.git", from: "2.0.0"),
        .package(url: "https://github.com/apple/swift-nio-http1.git", from: "2.0.0")
    ],
    targets: [
        .executableTarget(
            name: "SwiftMCPServer",
            dependencies: [
                .product(name: "NIO", package: "swift-nio"),
                .product(name: "NIOHTTP1", package: "swift-nio-http1")
            ]
        )
    ]
)
```

### `main.swift`

```swift
import NIO
import NIOHTTP1

final class MCPHandler: ChannelInboundHandler {
    typealias InboundIn = HTTPServerRequestPart
    typealias OutboundOut = HTTPServerResponsePart

    var bodyBuffer: ByteBuffer?

    func channelRead(context: ChannelHandlerContext, data: NIOAny) {
        let reqPart = self.unwrapInboundIn(data)

        switch reqPart {
        case .head(let head):
            print("Received request: \(head.uri)")
        case .body(var body):
            bodyBuffer = body
        case .end:
            let responseJSON = #"{"response": "Hello from Swift MCP"}"#
            var buffer = context.channel.allocator.buffer(string: responseJSON)

            var headers = HTTPHeaders()
            headers.add(name: "Content-Type", value: "application/json")
            headers.add(name: "Content-Length", value: "\(buffer.readableBytes)")

            let head = HTTPResponseHead(version: .init(major: 1, minor: 1),
                                        status: .ok,
                                        headers: headers)

            context.write(self.wrapOutboundOut(.head(head)), promise: nil)
            context.write(self.wrapOutboundOut(.body(.byteBuffer(buffer))), promise: nil)
            context.writeAndFlush(self.wrapOutboundOut(.end(nil)), promise: nil)
        }
    }
}

let group = MultiThreadedEventLoopGroup(numberOfThreads: System.coreCount)
defer { try! group.syncShutdownGracefully() }

let bootstrap = ServerBootstrap(group: group)
    .serverChannelOption(ChannelOptions.backlog, value: 256)
    .childChannelInitializer { channel in
        channel.pipeline.configureHTTPServerPipeline().flatMap {
            channel.pipeline.addHandler(MCPHandler())
        }
    }
    .childChannelOption(ChannelOptions.socketOption(.so_reuseaddr), value: 1)

let channel = try bootstrap.bind(host: "127.0.0.1", port: 8080).wait()
print("MCP Server running on http://127.0.0.1:8080")

try channel.closeFuture.wait()
```

---

## ğŸ“¡ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå®Ÿè£…ï¼ˆURLSessionï¼‰

```swift
import Foundation

struct MCPRequest: Encodable {
    let model: String
    let input: String
}

struct MCPResponse: Decodable {
    let response: String
}

func sendRequest() {
    let url = URL(string: "http://127.0.0.1:8080")!
    var request = URLRequest(url: url)
    request.httpMethod = "POST"

    let body = MCPRequest(model: "echo", input: "ã“ã‚“ã«ã¡ã¯")
    request.httpBody = try? JSONEncoder().encode(body)
    request.setValue("application/json", forHTTPHeaderField: "Content-Type")

    let task = URLSession.shared.dataTask(with: request) { data, _, error in
        guard let data = data, error == nil else {
            print("Error:", error ?? "unknown")
            return
        }

        if let response = try? JSONDecoder().decode(MCPResponse.self, from: data) {
            print("Response from MCP:", response.response)
        } else {
            print("Invalid response")
        }
    }
    task.resume()
}

sendRequest()
RunLoop.main.run()
```

---

## âœ… è£œè¶³

- æœ¬æ ¼çš„ã«MCPãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’æ¨¡å€£ã™ã‚‹å ´åˆã€OpenAIã®[OpenMCP](https://github.com/openmcp/openmcp)ã‚„ [Composio MCP](https://docs.composio.dev/) ã‚’å‚è€ƒã«ã™ã‚‹ã¨è‰¯ã„ã§ã™ã€‚
- Swiftã§ã‚ˆã‚Šé«˜åº¦ãªRPCã‚’ã—ãŸã„å ´åˆã¯ gRPC ã‚„ JSON-RPC ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆä¾‹: [SwiftGRPC](https://github.com/grpc/grpc-swift)ï¼‰ã‚’æ¤œè¨ã™ã‚‹ã®ã‚‚æœ‰åŠ¹ã§ã™ã€‚

---

å¿…è¦ã§ã‚ã‚Œã°ã€`async/await` å¯¾å¿œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚„ JSON-RPC å½¢å¼ã«æ‹¡å¼µã—ãŸä¾‹ã‚‚ä½œæˆã§ãã¾ã™ã€‚å¸Œæœ›ãŒã‚ã‚Œã°ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚

---

# Vitest ãƒ†ã‚¹ãƒˆçµæœå…±æœ‰æ–¹æ³•

æ—¥ä»˜: 2025-06-19

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/19 20:43:27*

vitest ã®ãƒ†ã‚¹ãƒˆçµæœã‚’ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ã«å…±æœ‰ã—ãŸã„ã€‚ ã©ã†ã„ã†é¸æŠè‚¢ãŒã‚ã‚‹ã ã‚ã†ã€‚  

import { coverageConfigDefaults, defineConfig } from "vitest/config";

export default defineConfig({
  test: {
    globals: true,
    environment: "node",
    // css: true, // ãƒ«ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«ã§ã¯CSSå‡¦ç†ã¯ä¸è¦ï¼ˆå„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§è¨­å®šï¼‰

    // ãƒ†ã‚¹ãƒˆç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    globalSetup: \["./vitest.setup.ts"\],

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // â‘ : ãƒ†ã‚¹ãƒˆå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¿ãƒ¼ãƒ³
    //    \*.test.ts / \*.spec.ts ãªã©ã‚’ packages/\*/src ä»¥ä¸‹ã‹ã‚‰æ‹¾ã†
    //    Vitest æ¨™æº–ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆdocs: \*\*/\*.{test,spec}.?(c|m)\[jt\]s?(x)ï¼‰ã‚’
    //    packages/\*/src ã«é™å®šã™ã‚‹ã ã‘ã§ OK
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    include: \["packages/\*/src/\*\*/\*.{test,spec}.?(c|m)\[jt\]s?(x)"\],

    // ãƒ†ã‚¹ãƒˆè‡ªä½“ã‚’å®Ÿè¡Œã—ãªã„ãƒ‘ã‚¹
    // Vitestã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé™¤å¤–è¨­å®šã«è¿½åŠ ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®é™¤å¤–ã‚’æŒ‡å®š
    exclude: \[
      "\*\*/node\_modules/\*\*",
      "\*\*/dist/\*\*",
      "\*\*/cypress/\*\*",
      "\*\*/.{idea,git,cache,output,temp}/\*\*",
      "\*\*/{karma,rollup,webpack,vite,vitest,jest,ava,babel,nyc,cypress,tsup,build}.config.\*",
      "\*\*/\*.manual.test.ts", // æ‰‹å‹•å®Ÿè¡Œç”¨ã®ãƒ†ã‚¹ãƒˆã‚’é™¤å¤–
      "\*\*/e2e/\*\*", // E2Eãƒ†ã‚¹ãƒˆã‚’é™¤å¤–ï¼ˆPlaywrightã§å®Ÿè¡Œï¼‰
      "\*\*/dist-storybook/\*\*", // Storybookãƒ“ãƒ«ãƒ‰æˆæœç‰©ã‚’é™¤å¤–
    \],

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // â‘¡: ã‚«ãƒãƒ¬ãƒƒã‚¸è¨­å®š
    //    test.include ã¨åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ Vitest ãŒè‡ªå‹•ã§é™¤å¤–ã—ã¦ãã‚Œã‚‹
    //    â†’ é‡è¤‡ã™ã‚‹ exclude ã¯ä¸è¦
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    coverage: {
      provider: "v8", // Node 18+ ãªã‚‰ v8 ã§å•é¡Œãªã—
      reporter: \["text", "json", "html", "json-summary"\],
      reportsDirectory: "./coverage",
      exclude: \[
        "\*\*/\*.config.\*", // è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’é™¤å¤–
        "\*\*/src/generated/\*\*", // è‡ªå‹•ç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’é™¤å¤–
        "\*\*/\*.d.ts", // å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é™¤å¤–
        "\*\*/\_\_tests\_\_/\*\*", // ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’é™¤å¤–
        "\*\*/\*.test.ts", // ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’é™¤å¤–
        "\*\*/\*.spec.ts", // ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’é™¤å¤–
        "\*\*/test/\*\*", // ãƒ†ã‚¹ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’é™¤å¤–
        "\*\*/dist/\*\*", // ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã‚’é™¤å¤–
        "\*\*/node\_modules/\*\*", // node\_modulesã‚’é™¤å¤–
        "\*\*/\*.stories.tsx", // Storybookãƒ•ã‚¡ã‚¤ãƒ«ã‚’é™¤å¤–
        "\*\*/dist-storybook/\*\*", // Storybookãƒ“ãƒ«ãƒ‰æˆæœç‰©ã‚’é™¤å¤–
        "packages/\*/scripts/\*\*", // ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’é™¤å¤–
        "packages/database/prisma/\*\*", // Prismaã‚¹ã‚­ãƒ¼ãƒãƒ»ã‚·ãƒ¼ãƒ‰ã‚’é™¤å¤–
        "packages/web-client/src/main.tsx", // ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã‚’é™¤å¤–
        "packages/server/src/index.ts", // ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã‚’é™¤å¤–
        ...coverageConfigDefaults.exclude, // æ—¢å®šã®é™¤å¤–ã‚’ç¶­æŒ
      \],
      thresholds: {
        // ã‚«ãƒãƒ¬ãƒƒã‚¸ã®æœ€ä½åŸºæº–ã‚’è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
        statements: 0, // ç¾åœ¨ã¯0%ã‹ã‚‰å§‹ã‚ã‚‹
        branches: 0,
        functions: 0,
        lines: 0,
      },
    },
  },
});

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/19 20:43:47*

ã€Œã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ã«å…±æœ‰ã™ã‚‹ã€ï¼**â€œãƒ†ã‚¹ãƒˆã‚’å›ã—ãŸã‚‰ã€ã§ãã‚‹ã ã‘æ‰‹é–“ãªããƒãƒ¼ãƒ å…¨å“¡ãŒçµæœã‚’è¦‹ã‚‰ã‚Œã‚‹â€**ã¨ã„ã†è¦³ç‚¹ã§ã€ä»£è¡¨çš„ãªé¸æŠè‚¢ã‚’ 5 ã¤ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«æ•´ç†ã—ã¾ã—ãŸã€‚ã™ã¹ã¦ Vitest ãŒæ¨™æº–ã§å‡ºåŠ›ã§ãã‚‹ãƒ¬ãƒãƒ¼ãƒˆã‚„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«æ²¿ã£ã¦ã„ã‚‹ã®ã§ã€ä»Šã® vitest.config.ts ã« reporterï¼coverage è¨­å®šã‚’å°‘ã—è¶³ã™ã ã‘ã§æ¸ˆã¿ã¾ã™ã€‚

---

### 1. **é™çš„ HTML ãƒ¬ãƒãƒ¼ãƒˆã‚’ãã®ã¾ã¾ç½®ã**  
Vitest ã® `coverage.reporter: "html"` ã‚’æŒ‡å®šã™ã‚‹ã¨ `coverage/index.html` ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚ã“ã‚Œã‚’ GitHub Pagesï¼Vercelï¼Netlify ãªã©ã« push ã—ã¦ãŠã‘ã°ã€URL ã‚’æŠ•ã’ã‚‹ã ã‘ã§å®Œäº†ã€‚CI ã‚’çµ„ã¾ãªãã¦ã‚‚ãƒ­ãƒ¼ã‚«ãƒ« `npx vitest run --coverage` â†’ `open coverage/index.html` ã§å³ç¢ºèªã§ãã¾ã™ã€‚îˆ€citeîˆ‚turn0search2îˆ  

> **å‘ã„ã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹**  
> * å€‹äººé–‹ç™ºã‚„å°‘äººæ•°ãƒãƒ¼ãƒ   
> * CI ãŒã¾ã æ•´ã£ã¦ãŠã‚‰ãš â€œã¨ã‚Šã‚ãˆãš URL ãŒã‚ã‚Œã° OKâ€

---

### 2. **GitHub Actions ã® Step Summaryï¼PR ã‚³ãƒ¡ãƒ³ãƒˆ**  
- **vitest-coverage-report-action**  
  GitHub Actions ã§ãƒ†ã‚¹ãƒˆã‚’å›ã™ã¨ã€Step Summary ã¨ Pull Request ã‚³ãƒ¡ãƒ³ãƒˆã« â€œå…¨ä½“ã‚µãƒãƒªï¼‹ãƒ•ã‚¡ã‚¤ãƒ«åˆ¥ã‚«ãƒãƒ¬ãƒƒã‚¸â€ ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã‚Œã‚‹ Actionã€‚HTML ã‚’åˆ¥é€”ãƒ›ã‚¹ãƒˆã—ãªãã¦ã‚‚ã€PR ç”»é¢ã ã‘ã§ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ç¢ºèªã§ãã¾ã™ã€‚îˆ€citeîˆ‚turn0search1îˆ  
- **vitest-github-actions-summary-reporter**  
  Vitest ã®ã‚«ã‚¹ã‚¿ãƒ  reporter ç‰ˆã€‚`reporters: [new GithubActionsReporter()]` ã¨æ›¸ãã ã‘ã§ã€Actions ã® built-in â€œSummaryâ€ ã«ãƒ†ã‚¹ãƒˆçµæœãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚îˆ€citeîˆ‚turn0search7îˆ  

> **å‘ã„ã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹**  
> * GitHub Flowï¼PR Review ãŒä¸­å¿ƒ  
> * â€œåˆ¥ã‚¿ãƒ–ã‚’é–‹ããŸããªã„â€ ã¨ã„ã†é–‹ç™ºè€…ã«å„ªã—ã„

---

### 3. **Codecov / Coveralls / Trunk ãªã©å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**  
Vitest ã¯ `--reporter=junit` ã§ JUnit XML ã‚’å‡ºåŠ›ã§ãã¾ã™ã€‚  
- **Codecov Test Analytics**ï¼šJUnit ã¨ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ä¸¡æ–¹é£Ÿã‚ã›ã‚‹ã¨ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§æ¨ç§»ã‚’å¯è¦–åŒ–ã€‚îˆ€citeîˆ‚turn0search5îˆ‚turn0search10îˆ  
- **Trunk Flaky Test Analytics**ï¼šJUnit XML ã®ã¿ã§ â€œã©ã®ãƒ†ã‚¹ãƒˆãŒ flaky ã‹â€ ã‚’æ¤œå‡ºã€‚îˆ€citeîˆ‚turn1search5îˆ  

CI ã§ XML ã‚’ artifact ã¨ã—ã¦ã‚¢ãƒƒãƒ— â†’ ã‚µãƒ¼ãƒ“ã‚¹å´ã¸ upload ã‚³ãƒãƒ³ãƒ‰ or GitHub Action ã§é€ã‚‹ã ã‘ãªã®ã§ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¯æ•°è¡Œã§ã™ã€‚  

> **å‘ã„ã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹**  
> * ã‚«ãƒãƒ¬ãƒƒã‚¸æ¨ç§»ã‚’ã‚°ãƒ©ãƒ•ã§è¦‹ãŸã„  
> * Flaky ãƒ†ã‚¹ãƒˆã‚’è‡ªå‹•æ¤œçŸ¥ã—ãŸã„  
> * ãƒªãƒã‚¸ãƒˆãƒªå¤–ã«çµæœã‚’ç½®ã„ã¦ã‚‚ OK

---

### 4. **Slackï¼Teams ãªã©ãƒãƒ£ãƒƒãƒˆé€šçŸ¥**  
- **CTRf Slack Reporter**ï¼ˆ`slack-ctrf`ï¼‰ã¯ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯æ¨ªæ–­å‹ã€‚Vitest ã§ã‚‚ `npx slack-ctrf results vitest-ctrf.json` ã§çµæœã‚’é€ä¿¡ã§ãã¾ã™ã€‚îˆ€citeîˆ‚turn1search1îˆ  
- è‡ªä½œã§ã‚‚ç°¡å˜ã§ã€Vitest ã® `json` ãƒ¬ãƒãƒ¼ãƒˆã‚’ Slack Webhook ã« POST ã™ã‚‹ 20 è¡Œç¨‹åº¦ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ååˆ†ã€‚  

> **å‘ã„ã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹**  
> * ã€Œè½ã¡ãŸã‚‰å³ãƒãƒ¼ãƒ ã«é€šçŸ¥ã€ã€Œæ¯æœçµæœã‚’æµã™ã€ãªã©æƒ…å ±å…±æœ‰ã‚’ãƒãƒ£ãƒƒãƒˆã§å®Œçµã•ã›ãŸã„  
> * CI ã¯ã‚ã‚‹ãŒãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¾ã§ã¯ä¸è¦

---

### 5. **ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ä»˜ããƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹**  
- **TestPig.io**ï¼šnpm `@testpig/vitest-reporter` ã‚’è¿½åŠ ã™ã‚‹ã¨ã€è‡ªå‹•ã§ãƒ†ã‚¹ãƒˆçµæœãŒã‚¯ãƒ©ã‚¦ãƒ‰ã«é€ã‚‰ã‚Œã€Web ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§å±¥æ­´ãƒ»å‚¾å‘ãŒé–²è¦§å¯èƒ½ã€‚îˆ€citeîˆ‚turn0search3îˆ  
- **ReportPortal**ï¼šã‚ˆã‚Šæœ¬æ ¼æ´¾ã®ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã€‚Vitest ç”¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒã‚ã‚Šã€çµæœã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é›†è¨ˆã€‚îˆ€citeîˆ‚turn0search9îˆ  

> **å‘ã„ã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹**  
> * è¤‡æ•°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼å¤§é‡ãƒ†ã‚¹ãƒˆã‚’æ¨ªæ–­ç®¡ç†ã—ãŸã„  
> * ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚„ãƒ­ã‚°ã‚’ã²ã¨ã¾ã¨ã‚ã«æ®‹ã—ãŸã„

---

## ã™ãè©¦ã›ã‚‹æœ€å°æ§‹æˆã‚µãƒ³ãƒ—ãƒ«

```ts
// vitest.config.ts
import { defineConfig } from "vitest/config";
import { GithubActionsReporter } from "vitest-github-actions-summary-reporter";

export default defineConfig({
  test: {
    reporters: [
      "default",
      "junit",               // JUnit XML (Codecov ç­‰ã«æµç”¨)
      new GithubActionsReporter(), // GH Step Summary
    ],
    outputFile: {
      junit: "vitest-report.junit.xml",
    },
    coverage: {
      reporter: ["text", "json", "html"], // HTML ã‚‚æ®‹ã™
    },
  },
});
```

- **HTML** â†’ `coverage/` ã‚’ GitHub Pages ã«ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆæœ€çŸ­ `pnpm gh-pages -d coverage`ï¼‰  
- **GitHub Actions** â†’ å‰è¿°ã® Action ã‹ `cat vitest-report.junit.xml` ã‚’ Codecov Action ã¸æ¸¡ã™ã ã‘  
- **Slack** â†’ ã‚¸ãƒ§ãƒ–ã®æœ€å¾Œã« `npx slack-ctrf results vitest-report.junit.xml --token $SLACK_WEBHOOK`  

---

### ã¾ã¨ã‚

| å…±æœ‰æ–¹æ³• | å°å…¥ã‚³ã‚¹ãƒˆ | è¦–èªæ€§ | ã‚³ãƒ¡ãƒ³ãƒˆ |
|----------|-----------|--------|----------|
| HTML é™çš„ãƒšãƒ¼ã‚¸ | â˜… | â— | URL ãŒã‚ã‚Œã° OK |
| GH Step Summary / PR ã‚³ãƒ¡ãƒ³ãƒˆ | â˜…â˜… | â— | GitHub ã§å®Œçµ |
| Codecov / Coveralls / Trunk | â˜…â˜… | â—‹ | è§£æç³»ã‚‚è±Šå¯Œ |
| Slack é€šçŸ¥ | â˜…â˜… | â—‹ | â€œè½ã¡ãŸã‚‰é³´ã‚‹â€ æ–‡åŒ–å‘ã‘ |
| TestPig.io / ReportPortal | â˜…â˜…â˜… | â— | æ­´å²ãƒ»æ¤œç´¢ãƒ»åˆ†æã¾ã§ |

ã¾ãš **Step Summary + HTML** ã ã‘ã§ã‚‚ååˆ† â€œã‚«ã‚¸ãƒ¥ã‚¢ãƒ«å…±æœ‰â€ ã¯å®Ÿç¾ã§ãã¾ã™ã€‚  
ã•ã‚‰ã«åˆ†æã—ãŸããªã£ãŸã‚‰ Codecov ç­‰ã¸ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€ãƒãƒ¼ãƒ ã®é€šçŸ¥ãƒ•ãƒ­ãƒ¼ã«åˆã‚ã›ã¦ Slack é€£æºã‚’åŠ ãˆã‚‹ã€ã¨ã„ã†æ®µéšçš„ãªæ‹¡å¼µãŒãŠã™ã™ã‚ã§ã™ã€‚

---

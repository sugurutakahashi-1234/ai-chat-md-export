# Makefile コメント調整

日付: 2024-04-04

---

## 👤 ユーザー
*2024/04/04 12:47:06*

```Makefile
PACKAGE_NAME := ./DISampleAppPackage
MOCKOLO_SCAN_PATH := ./$(PACKAGE_NAME)/Sources
MOCKOLO_OUTPUT_PATH := ./$(PACKAGE_NAME)/Sources/Presentation/Domain/Entity/Mocks.swift

.PHONY: help
help:
	@awk 'BEGIN {FS = ":"} /^[a-zA-Z0-9_-]+:/ {if ($$2 == "") print "make " $$1}' Makefile

.PHONY: mint-bootstrap
mint-bootstrap:
	swift run --package-path $(PACKAGE_NAME) mint bootstrap

.PHONY: githooks-setup
githooks-setup:
	git config --local core.hooksPath .githooks

.PHONY: githooks-cleanup
githooks-cleanup:
	git config --local --unset core.hooksPath .githooks

.PHONY: swiftformat-run
swiftformat-run:
	swift run --package-path $(PACKAGE_NAME) mint run swiftformat .

.PHONY: swiftformat-lint
swiftformat-lint:
	swift run --package-path $(PACKAGE_NAME) mint run swiftformat --lint .

.PHONY: mockolo-run
mockolo-run:
	swift run --package-path $(PACKAGE_NAME) mint run mockolo -s $(MOCKOLO_SCAN_PATH) -d $(MOCKOLO_OUTPUT_PATH) --custom-imports DomainLayer Combine -x Images Strings --mock-final

.PHONY: sourcery-presentation-code-gen
sourcery-presentation-code-gen:
	./sourcery/script/presentation_code_gen.sh $(VIEW) $(ROUTER)

.PHONY: presentation-code-gen
presentation-code-gen:
	$(MAKE) sourcery-presentation-code-gen
	$(MAKE) mockolo-run

.PHONY: sourcery-driver-code-gen
sourcery-driver-code-gen:
	./sourcery/script/driver_code_gen.sh $(DRIVER)

.PHONY: driver-code-gen
driver-code-gen:
	$(MAKE) sourcery-driver-code-gen
	$(MAKE) mockolo-run

.PHONY: sourcery-use-case-code-gen
sourcery-use-case-code-gen:
	./sourcery/script/use_case_code_gen.sh $(USECASE)

.PHONY: use-case-code-gen
use-case-code-gen:
	$(MAKE) sourcery-use-case-code-gen
	$(MAKE) mockolo-run

.PHONY: swift-docc-gen
swift-docc-gen:
	./swift_docc/script/docc_gen.sh $(PACKAGE_NAME)

.PHONY: periphery-scan
periphery-scan:
	./periphery/script/periphery_scan.sh $(CURDIR)

.PHONY: spm-dependencies-mermaid-gen
spm-dependencies-mermaid-gen:
	./depermaid/script/spm_dependencies_mermaid_gen.sh

.PHONY: document-update
document-update:
	$(MAKE) swift-docc-gen
	$(MAKE) periphery-scan
	$(MAKE) spm-dependencies-mermaid-gen

.PHONY: setup
setup:
	$(MAKE) mint-bootstrap
	$(MAKE) githooks-setup
	$(MAKE) open

.PHONY: cleanup
cleanup:
	$(MAKE) githooks-cleanup
```

make help を実行すると以下のような出力になる

make help
make mint-bootstrap
make githooks-setup
make githooks-cleanup
make swiftformat-run
make swiftformat-lint
make mockolo-run
make sourcery-presentation-code-gen
make presentation-code-gen
make sourcery-driver-code-gen
make driver-code-gen
make sourcery-use-case-code-gen
make use-case-code-gen
make swift-docc-gen
make periphery-scan
make spm-dependencies-mermaid-gen
make document-update
make setup
make cleanup

さらにMakefileにコメントを加えて、例えば以下のようにコメントを入れた場合に

.PHONY: help #hogehoge

make help               hogehoge

のような出力になるようにしてほしい。
そのときにインデントが揃うようにしてほしい。

---

## 🤖 アシスタント
*2024/04/04 12:47:37*

Makefileを修正して、`make help`を実行した際に各コマンドのコメントを表示できるようにするためには、`awk`コマンドを利用してパースし、各ターゲットの後にコメントを表示するようにします。`awk`の`FS`（フィールドセパレータ）を調整し、`#`以降のコメントを取得して表示するように変更します。また、インデントを揃えるために、出力フォーマットを調整する必要があります。

以下の`help`ターゲットの`awk`コマンドを変更した例を見てみましょう。ここでは、各ターゲットのコメントを取得し、`make`コマンドの出力とともに表示するようにしています。また、インデントの調整には`printf`を使用して、一定のフォーマットに従って出力を整形しています。

```Makefile
.PHONY: help
help:
	@awk 'BEGIN {FS = ":.*?##"; printf "Usage:\n"} /^[a-zA-Z0-9_-]+:.*?##/ { printf "  %-30s %s\n", $$1, $$2 }' $(MAKEFILE_LIST)
```

しかし、上記のスクリプトは`##`をデリミタとして使用しているため、コメントが`##`で始まることを前提としています。Makefile内のコメントが単一の`#`で始まる場合は、これを適切に調整する必要があります。

Makefileのコメントが`#`で始まる場合、以下のように修正してください：

```Makefile
.PHONY: help
help:
	@awk 'BEGIN {FS = ":.*?#"; printf "Usage:\n"} /^[a-zA-Z0-9_-]+:.*?#/ { gsub(/^[ \t]+/, "", $$2); printf "  %-30s %s\n", $$1, $$2 }' $(MAKEFILE_LIST)
```

ここで、`gsub(/^[ \t]+/, "", $$2);`を使用して、コメントの先頭にあるスペースやタブを削除し、インデントを揃えています。また、`printf`関数を使用してフォーマットを整えています。`%-30s`は、コマンド名が30文字の幅を持ち、左揃えで表示されることを意味しており、これによりインデントが揃います。

この修正を適用することで、`make help`を実行した際に各ターゲットのコメントが適切に表示され、インデントも揃うようになります。

---

## 👤 ユーザー
*2024/04/04 12:48:36*

PACKAGE_NAME := ./DISampleAppPackage
MOCKOLO_SCAN_PATH := ./$(PACKAGE_NAME)/Sources
MOCKOLO_OUTPUT_PATH := ./$(PACKAGE_NAME)/Sources/Presentation/Domain/Entity/Mocks.swift

.PHONY: help #hoge
help:
	@awk 'BEGIN {FS = ":.*?#"; printf "Usage:\n"} /^[a-zA-Z0-9_-]+:.*?#/ { gsub(/^[ \t]+/, "", $$2); printf "  %-30s %s\n", $$1, $$2 }' $(MAKEFILE_LIST)

.PHONY: mint-bootstrap #moge
mint-bootstrap:
	swift run --package-path $(PACKAGE_NAME) mint bootstrap
de

---

## 🤖 アシスタント
*2024/04/04 12:48:52*

Your Makefile snippet now includes the adjusted `help` target with an `awk` command designed to parse and display comments next to each target name when `make help` is executed. However, your code snippet seems to end abruptly. Assuming you're looking for a continuation or verification that your approach is correct, here's a clarification:

Your adjusted `help` target with the `awk` script will read through the Makefile, looking for target names followed by comments marked with `#`. It then formats these names and their corresponding comments into a neatly aligned output. This is a smart way to make your Makefile more user-friendly, allowing other developers to quickly understand what each target does.

If you intended to ask how to ensure that this approach correctly formats and displays all your Makefile targets with their comments, it looks like you're on the right path. The key points in your script are:

- **FS = ":.*?#";** This sets the field separator to a pattern that matches a colon followed by any characters and then a `#`, effectively separating target names from their comments.
- **gsub(/^[ \t]+/, "", $$2);** This removes leading whitespace from the comment portion, ensuring that the output is neatly aligned.
- **printf "  %-30s %s\n", $$1, $$2;** This formats

---

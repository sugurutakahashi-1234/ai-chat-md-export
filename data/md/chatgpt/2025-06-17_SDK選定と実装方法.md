# SDKé¸å®šã¨å®Ÿè£…æ–¹æ³•

æ—¥ä»˜: 2025-06-17

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/17 21:17:45*

TypeScriptã®OpenAPIä»•æ§˜ã®YAMLã‹ã‚‰Webã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒä½¿ç”¨ã™ã‚‹APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ã„ã‚‹ã€‚ 
ä»Šã¯@hey-api/openapi-tsã‚’ä½¿ã£ã¦ã„ãŸãŒã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ç·¨é›†ã—ãŸéš›ã«ã€ ãã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ãã‚‚ãã‚‚å®šç¾©ã—ã¦ã„ã‚‹é–¢æ•°ã«åŸ‹ã‚è¾¼ã¾ãªãã‚ƒã„ã‘ãªã„ã“ã¨ãŒç™ºè¦šã—ã¦ã—ã¾ã£ãŸã€‚ 
æ­£ç›´ä½¿ã„ã¥ã‚‰ã„ã€‚ 
ã¾ãŸã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã‚‚åŒæ§˜ã«ä½¿ã„ã¥ã‚‰ã„ã‚ˆã†ãªæ°—ã‚‚ã—ã¦ã„ã‚‹ã€‚ 
ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã¯èªè¨¼ãªã©ã«ä½¿ã†ãŸã‚çµæ§‹é‡è¦ã§ã‚ã‚‹ã€‚
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ç·¨é›†ã¯ãƒ™ãƒ¼ã‚¹ã®URLã‚’ç·¨é›†ã™ã‚‹ã®ã ãŒã€ã“ã‚Œã¯ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ã£ã¦åˆ‡ã‚Šæ›¿ãˆã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€ç”Ÿæˆæ™‚ã®ã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯åŸ‹ã‚è¾¼ã‚ã‚‰ã‚Œã¦ã„ãªã„ã€‚ 
ã“ã†ã„ã£ãŸçŠ¶æ³ã‚’è¸ã¾ãˆã¦ã€ https://github.com/openapi-ts/openapi-typescript ã®SDKã«ä¹—ã‚Šæ›ãˆã‚ˆã†ã¨æ€ã£ã¦ã„ã‚‹ãŒã€ã“ã‚Œã¯å¦¥å½“ãªåˆ¤æ–­ã§ã‚ã‚‹ã‹ã€‚  æ¤œè¨ã—ã¦ã»ã—ã„ã€‚ 

ä»Šæ–°è¦ã«å§‹ã‚ã¦ã„ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãªã®ã§ä¹—ã‚Šæ›ãˆã‚³ã‚¹ãƒˆã¯ã»ã¼ãªã„ã¨æ€ã£ã¦ã„ã„ã€‚ 
ã¾ãŸã‚ˆã‚Šè‰¯ã„é¸æŠè‚¢ãŒã‚ã‚Œã°ãã‚Œã‚‚æ•™ãˆã¦ã»ã—ã„ã€‚ 
ã¾ãŸã§ãã‚Œã°ã€Vitestã‚’ä½¿ã£ãŸMockã®ã™ã‚Šæ›¿ãˆãªã©ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ã§ã®å®Ÿè£…ã®å·¥å¤«ã ã£ãŸã‚Šã€ TanStack Query ã¨ã®çµ„ã¿åˆã‚ã›ã ã£ãŸã‚Šã€ãã†ã„ã£ãŸã¨ã“ã‚ã‚‚ ã©ã‚“ãªã“ã¨ãŒã§ãã‚‹ã‹æ•™ãˆã¦ã»ã—ã„ã€‚ 

ã¾ãŸã€openapi-fetchã‚’ä½¿ã£ãŸå ´åˆã‚„ä½¿ã‚ãªã‹ã£ãŸå ´åˆãªã©ã«ã‚‚è§¦ã‚Œã¦æ¬²ã—ã„ã€‚
ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚‚æ¤œè¨ã—ã¦æ¬²ã—ã„ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/17 21:18:40*

### 1. ä¹—ã‚Šæ›ãˆåˆ¤æ–­ â€• çµè«–å…ˆå‡ºã—  
- **ä»Šã®ä¸æº€ï¼ˆ@hey-api/openapi-tsï¼‰**  
  - ç”Ÿæˆç‰©ã«ç›´æ¥ `baseUrl` ã‚’æ›¸ãè¾¼ã‚€è¨­è¨ˆãªã®ã§ã€ç’°å¢ƒå¤‰æ•°ã”ã¨ã« URL ã‚’å·®ã—æ›¿ãˆã‚‹ã«ã¯ç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ãæ›ãˆã‚‹ã‹ç‹¬è‡ªãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’æ›¸ãå¿…è¦ãŒã‚ã‚‹ã€‚  
  - `client.interceptors.request.use()` ã§ã®èªè¨¼ãƒ˜ãƒƒãƒ€è¿½åŠ ã¯å‡ºæ¥ã‚‹ãŒã€å‘¼ã³å‡ºã—â½…ãŒ Axios ãƒ©ã‚¤ã‚¯ã§ **ç”Ÿæˆ SDK ã®å¤–å´ã«æ›¸ãè¶³ã™ã‚³ãƒ¼ãƒ‰é‡ãŒæ„å¤–ã¨å¤šã„**ã€‚îˆ€citeîˆ‚turn0search6îˆ  
- **openapi-typescript + openapi-fetch ã¸ã®ç§»è¡Œ**  
  - `openapi-typescript` ã¯ **å‹** ã ã‘ã‚’ç”Ÿæˆã—ã€ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã¯ `openapi-fetch`ï¼`openapi-react-query` ç­‰ã§çµ„ã¿åˆã‚ã›ã‚‹æ§‹æˆã€‚URL ã‚„èªè¨¼ã¯ **å®Ÿè¡Œæ™‚ã‚ªãƒ—ã‚·ãƒ§ãƒ³**ã§æ³¨å…¥ã§ãã‚‹ãŸã‚ç”Ÿæˆç‰©ã‚’ç·¨é›†ã™ã‚‹å¿…è¦ãŒãªã„ã€‚îˆ€citeîˆ‚turn4view0îˆ  
  - `openapi-fetch` ã¯ 6 kB ã§ã‚¼ãƒ­ä¾å­˜ãƒ»ã‚¼ãƒ­ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã€`createClient({ baseUrl, fetch, â€¦ })` ã® **ã‚ªãƒ—ã‚·ãƒ§ãƒ³ DI** ã«ã‚ˆã‚Š URLãƒ»ã‚«ã‚¹ã‚¿ãƒ  `fetch`ãƒ»ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼ˆ=Interceptorï¼‰ã‚’ã¾ã¨ã‚ã¦æ³¨å…¥å¯èƒ½ã€‚îˆ€citeîˆ‚turn5view0îˆ  
  - ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¯ `onRequest / onResponse / onError` ã® 3 ãƒ•ãƒƒã‚¯ã§ã€**èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ä»˜ä¸ã‚„ãƒªãƒˆãƒ©ã‚¤** ãŒæ•°è¡Œã§æ›¸ã‘ã‚‹ã€‚îˆ€citeîˆ‚turn7view0îˆ  
> **æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãªã‚‰ç§»è¡Œã‚³ã‚¹ãƒˆâ‰’0**ã€‚ç”Ÿæˆç‰©ã®å¤§ãã•ã‚‚ãƒ“ãƒ«ãƒ‰é€Ÿåº¦ã‚‚æœ‰åˆ©ãªã®ã§ã€ä¹—ã‚Šæ›ãˆã¯å¦¥å½“ã§ã™ã€‚

---

### 2. åŸºæœ¬ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¾‹

```bash
# å‹ã ã‘ã‚’ç”Ÿæˆï¼ˆCI ã§ã‚‚å†ç”Ÿæˆã™ã‚Œã° OKï¼‰
npx openapi-typescript ./api/openapi.yaml -o src/lib/api.d.ts
```

```ts
// apiClient.ts
import createClient from 'openapi-fetch';
import type { paths } from '@/lib/api';   // ç”Ÿæˆã•ã‚ŒãŸå‹

export const api = createClient<paths>({
  baseUrl : import.meta.env.VITE_API_BASE_URL,        // ã“ã“ã§ç’°å¢ƒå¤‰æ•°ã‚’æ³¨å…¥
  // èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
  middleware: [
    {
      async onRequest({ request }) {
        const token = localStorage.getItem('jwt');
        if (token) request.headers.set('Authorization', `Bearer ${token}`);
        return request;
      },
      onError({ error }) {
        // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã‚’çµ±ä¸€ã—ãŸå½¢ã«å¤‰æ›
        return new Error('Network error', { cause: error });
      },
    },
  ],
});
```

---

### 3. TanStack Query ã¨ã®çµ±åˆ

- **openapi-react-query**  
  1 kB ã®ãƒ©ãƒƒãƒ‘ãƒ¼ã§ã€`openapi-fetch` ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ **å‹å®‰å…¨ãª `useQuery/useMutation` ãƒ•ãƒƒã‚¯ã‚’è‡ªå‹•ç”Ÿæˆ**ã€‚îˆ€citeîˆ‚turn3view0îˆ  
  ```ts
  import createFetchClient from 'openapi-fetch';
  import createRQClient from 'openapi-react-query';
  import type { paths } from '@/lib/api';

  const fetchClient = createFetchClient<paths>({ baseUrl: '/api' });
  export const $api = createRQClient(fetchClient);

  // ã©ã“ã‹ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
  const { data, error } = $api.useQuery('get', '/users/{id}', {
    params: { path: { id: '123' } },
  });
  ```
- **openapi-qraft** ãªã©ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£è£½ã®ã‚³ãƒ¼ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã‚‚ã‚ã‚‹ãŒã€æœ€æ–°ãƒ¡ãƒ³ãƒ†çŠ¶æ³ã¨ API ã®ã‚·ãƒ³ãƒ—ãƒ«ã•ã§ `openapi-react-query` ãŒç„¡é›£ã€‚îˆ€citeîˆ‚turn0search7îˆ  

---

### 4. Vitest ã§ã®ãƒ¢ãƒƒã‚¯åˆ‡ã‚Šæ›¿ãˆ

`createClient` ã® `fetch` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ãƒ¢ãƒƒã‚¯ã‚’å·®ã—è¾¼ã‚€ã ã‘ã§ **HTTP ã‚’ä¸€åˆ‡ç™ºç”Ÿã•ã›ãšå‹ãƒã‚§ãƒƒã‚¯ä»˜ãã® API ãƒ†ã‚¹ãƒˆ** ãŒæ›¸ã‘ã‚‹ã€‚îˆ€citeîˆ‚turn8view0îˆ  

```ts
import { vi, expect } from 'vitest';
import createClient from 'openapi-fetch';
import type { paths } from '@/lib/api';

const mockFetch = vi.fn();
const client = createClient<paths>({ baseUrl: '/api', fetch: mockFetch });
await client.POST('/login', { body: { id: 'foo', pw: 'bar' } });

expect(mockFetch).toHaveBeenCalled();     // URL, ãƒ˜ãƒƒãƒ€, body ã‚’æ–­è¨€ã§ãã‚‹
```

MSW ã‚’ä½µç”¨ã™ã‚‹å ´åˆã¯ `globalThis.fetch` ã‚’æ›¸ãæ›ãˆã‚‹ã ã‘ãªã®ã§å·®ã—æ›¿ãˆã‚³ã‚¹ãƒˆã¯ã»ã¼ã‚¼ãƒ­ã§ã™ã€‚îˆ€citeîˆ‚turn8view0îˆ  

---

### 5. openapi-fetch ã‚’ä½¿ã‚ãªã„å ´åˆ

| é¸æŠè‚¢ | ç‰¹å¾´ | interceptors | TanStack Query é€£æº | ã‚³ãƒ¡ãƒ³ãƒˆ|
|---|---|---|---|---|
| **openapi-fetch** | 6 kBã€ã‚¼ãƒ­ä¾å­˜ã€å‹æ¨è«–â— | Middleware API | `openapi-react-query` | ä¸€ç•ªã‚·ãƒ³ãƒ—ãƒ« |
| **openapi-typescript-fetch** | åŒé–‹ç™ºå…ƒã®ãƒŸãƒ‹ãƒãƒ«å®Ÿè£… | Middleware ã‚ã‚Š | æ‰‹å‹•ãƒ©ãƒƒãƒ‘ãƒ¼è¦ | ãƒãƒ³ãƒ‰ãƒ«æ›´ã«å°ã•ã„ |
| **è‡ªå‰ fetch + å‹ã®ã¿** | fetch API ã‚’ç›´æ¥å‘¼ã¶ | è‡ªå‰ã§æ›¸ã | æ‰‹å‹• | ã‚³ãƒ¼ãƒ‰é‡å¢— |
| **openapi-fetch ã‚’ãƒ©ãƒƒãƒ—ã—ãªã„ Axios** | Axios æ©Ÿèƒ½ãƒ•ãƒ«æ´»ç”¨ | Axios interceptors | orval ã§ hook è‡ªå‹•ç”Ÿæˆå¯ | ãƒãƒ³ãƒ‰ãƒ«å¢—ãƒ»å‹æ¨è«–å¼± |

---

### 6. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æŒ‡é‡

1. **HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ â‰  2xx**  
   - `openapi-fetch` ã¯ `{ data?: â€¦; error?: â€¦ }` ã‚’è¿”ã™ã€‚`middleware` ã§ `!response.ok` ãªã‚‰ `throw` ã™ã‚‹ãƒãƒªã‚·ãƒ¼ã«çµ±ä¸€ã™ã‚‹ã¨ TanStack Query ã® `onError` ã«æµã›ã‚‹ã€‚îˆ€citeîˆ‚turn7view0îˆ  
2. **Validation / äºˆæœŸã—ãªã„ shape**  
   - ã‚µãƒ¼ãƒå´ãŒã‚¹ã‚­ãƒ¼ãƒã‚’å®ˆã‚‰ãªã„ã‚±ãƒ¼ã‚¹ã¯ `openapi-zod-client` ã‚„ `zodios` ã® **ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼** ã‚’ä½µç”¨ã€‚  
3. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ»ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**  
   - `onError` ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã§ãƒ©ãƒƒãƒ—ã—ã€`AbortController` ã‚’æ´»ç”¨ã€‚  

---

### 7. ä»–ã®å€™è£œãƒ„ãƒ¼ãƒ«

| ãƒ„ãƒ¼ãƒ« | é•·æ‰€ | çŸ­æ‰€ |
|---|---|---|
| **orval** | Axios/Fetch/React-Query/SWR ãƒ•ãƒƒã‚¯ã‚’ä¸€æ‹¬ç”Ÿæˆã€‚`httpClient` ã‚’ `fetch` ã«åˆ‡æ›¿ãˆå¯îˆ€citeîˆ‚turn1search1îˆ | ç”Ÿæˆé‡å¤šã‚ï¼ˆæ•°ç™¾ kBï¼‰ã€‚CLI è¨­å®šãŒè¤‡é›‘ |
| **openapi-zod-client** | å‹ï¼‹Zod schema ç”Ÿæˆã§ **ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼ä»˜ã** | fetch ãƒ©ãƒƒãƒ‘ãƒ¼ã¯è‡ªå‰ã€ãƒãƒ³ãƒ‰ãƒ«ã‚„ã‚„å¤§ãã„ |
| **openapi-typescript-codegen** | class ãƒ™ãƒ¼ã‚¹ SDK, axios/fetch é¸æŠå¯ | ãƒ•ã‚¡ã‚¤ãƒ«æ•°ãŒå¤šã„ãƒ»tree-shakingå¼± |

---

### 8. æ¨å¥¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¾ã¨ã‚

1. **å‹ç”Ÿæˆ** : `openapi-typescript`  
2. **ãƒ‡ãƒ¼ã‚¿å–å¾—** : `openapi-fetch` + èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢  
3. **React Query** : `openapi-react-query` ã§å‹å®‰å…¨ãƒ•ãƒƒã‚¯è‡ªå‹•ç”Ÿæˆ  
4. **ãƒ†ã‚¹ãƒˆ** : Vitest + `vi.fn()` ã¾ãŸã¯ MSW  
5. **è¿½åŠ è¦ä»¶ (Zod validationã‚„Axiosæ©Ÿèƒ½)** ãŒå¿…è¦ã«ãªã£ãŸã‚‰ã€orval / zod ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å˜ä½ã§ä½µç”¨ã™ã‚‹æ–¹å‘ã§æ¤œè¨ã€‚

æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚ã‚Œã°ã“ã®æ§‹æˆãŒ **æœ€å°ã‚³ãƒ¼ãƒ‰é‡** ã§ **ç’°å¢ƒå·®ã—æ›¿ãˆã¨ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã‚’æŸ”è»Ÿã«ä¿ã¡ã¤ã¤**ã€å‹å®‰å…¨ãƒ»ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ãƒ»ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã®ãƒãƒ©ãƒ³ã‚¹ãŒæœ€ã‚‚è‰¯ã„é¸æŠã§ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/17 21:22:50*

Vitest + vi.fn() ã¾ãŸã¯ MSWã“ã®å·®ãŒã‚ã‹ã£ã¦ã„ãªã„ã€‚ã©ã†ã„ã†ãƒ†ã‚¹ãƒˆã‚’ã—ãŸã„å ´åˆã¯ã©ã¡ã‚‰ãŒã„ã„ã¨ã‹ã€ãã†ã„ã£ãŸå½¢ã§ã¾ã¨ã‚ã¦ã»ã—ã„ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/17 21:22:53*

## Vitest ã§ API å‘¼ã³å‡ºã—ã‚’ãƒ¢ãƒƒã‚¯ã™ã‚‹ 2 ã¤ã®æµå„€

| ç›®çš„/è¦³ç‚¹ | **`vi.fn()` ã§è‡ªå‰ãƒ¢ãƒƒã‚¯ (ã‚¹ã‚¿ãƒ–)** | **MSW (Mock Service Worker)** |
|-----------|-------------------------------------|--------------------------------|
| **ãƒ†ã‚¹ãƒˆç²’åº¦** | *ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ* å‘ã<br>ãƒ»å˜ä¸€é–¢æ•°/ãƒ•ãƒƒã‚¯ã®æˆ»ã‚Šå€¤ã ã‘å·®ã—æ›¿ãˆãŸã„ | *çµ±åˆãƒ†ã‚¹ãƒˆ/æŒ¯ã‚‹èˆã„ãƒ†ã‚¹ãƒˆ* å‘ã<br>ãƒ»UI â†” ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ãƒ¤å…¨ä½“ã‚’æœ¬ç‰©ã«è¿‘ã„é€šä¿¡ã§æ¤œè¨¼ã—ãŸã„ |
| **ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—** | `vi.fn()` ã§ `fetch` ã‚„ API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç½®ãæ›ãˆã‚‹ã ã‘ã€‚æœ€é€Ÿã§æ›¸ã‘ã‚‹ | `setupServer()` / `setupWorker()` ã‚’ä½œæˆã—ã€ãƒãƒ³ãƒ‰ãƒ©ã‚’å®šç¾©ã€‚åˆå›ã«å°‘ã—å„€å¼ãŒå¿…è¦ |
| **åˆ°é”ç¯„å›²** | ç½®ãæ›ãˆãŸé–¢æ•° **ã ã‘** ãŒãƒ¢ãƒƒã‚¯ã•ã‚Œã‚‹<br>ï¼ˆä»–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒå†…éƒ¨ã§ `fetch` ã—ã¦ã‚‚æœ¬ç‰©ãŒå‘¼ã°ã‚Œã‚‹ï¼‰ | **å…¨ã¦ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ I/O** ã‚’ Service Worker ãƒ¬ã‚¤ãƒ¤ã§æ•æ‰ã€‚ä¾å­˜å…ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å†…éƒ¨å‘¼ã³å‡ºã—ã‚‚ãƒ¢ãƒƒã‚¯å¯ |
| **å‹å®‰å…¨æ€§** | `vi.fn<ReturnType>()` ã§æ‰‹å‹•æŒ‡å®šã€‚<br>ãƒ¬ã‚¹ãƒãƒ³ã‚¹ shape ã‚’æ›¸ãé–“é•ãˆã¦ã‚‚å®Ÿè¡Œæ™‚ã¾ã§ã¯æ°—ä»˜ãã«ãã„ | `msw` + `zod` ç­‰ã§ã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼å¯ã€‚å®Ÿéš›ã® HTTP ãƒ¬ãƒ™ãƒ«ã§ JSON ã‚’è¿”ã™ã®ã§ **ã‚µãƒ¼ãƒå®Ÿè£…ã¨åŒã˜å‹** ã‚’å…±æœ‰ã—ã‚„ã™ã„ |
| **ãƒ†ã‚¹ãƒˆé€Ÿåº¦** | è¶…è»½é‡ãƒ»æœ€é€Ÿã€‚ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã»ã¼ã‚¼ãƒ­ | Service Worker èµ·å‹•åˆ†ã‚ãšã‹ã«é…ã„ãŒã€å®Ÿç”¨ä¸Šã¯æ•° ms ç¨‹åº¦ |
| **ã‚·ãƒŠãƒªã‚ªåˆ†å²** | `mockFetch.mockResolvedValueOnce(...)` ã‚’ãƒ†ã‚¹ãƒˆã”ã¨ã«æ›¸ãã€‚ã‚±ãƒ¼ã‚¹ãŒå¤šã„ã¨å†—é•· | `rest.get('/api/users', (req, res, ctx) => â€¦)` ã‚’å®£è¨€çš„ã«åˆ—æŒ™ã€‚**è¤‡æ•°ã‚±ãƒ¼ã‚¹ã®åˆ‡ã‚Šæ›¿ãˆ** ã‚’ `req.url.searchParams` ãªã©ã§åˆ†å²ã—ã‚„ã™ã„ |
| **å®Ÿé‹ç”¨ã«è¿‘ã•** | â€œé–¢æ•°å‘¼ã³å‡ºã—â€ ãŒæˆåŠŸã™ã‚‹ã ã‘ã§ã€HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚„ãƒ˜ãƒƒãƒ€ã®æ‰±ã„ã‚’å¿˜ã‚ŒãŒã¡ | å®Ÿéš›ã« `fetch()` ãŒèµ°ã‚‹ã®ã§ **CORSãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚³ãƒ¼ãƒ‰**ãƒ»`AbortController` ãªã©ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç‰¹æœ‰ã®æŒ™å‹•ã‚‚å†ç¾ |
| **ãƒ‡ãƒãƒƒã‚°ä½“é¨“** | ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ãƒ¢ãƒƒã‚¯é–¢æ•°ã®å‘¼ã³å‡ºã—å›æ•°ã‚’è¿½ã†ç¨‹åº¦ | `MSW` ãŒæœªãƒãƒ³ãƒ‰ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è­¦å‘Šã—ã¦ãã‚Œã‚‹ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ DevTools ã® Network ãƒ‘ãƒãƒ«ã§ **ä»®æƒ³ãƒ¬ã‚¹ãƒãƒ³ã‚¹** ã‚’ç¢ºèªå¯èƒ½ |
| **å­¦ç¿’ã‚³ã‚¹ãƒˆ** | Vitest ã® `vi.fn()` ã ã‘è¦šãˆã‚Œã° OK | MSW ã® APIï¼ˆ`rest.get/post` ãªã©ï¼‰ã¨ã‚µãƒ¼ãƒï¼ãƒ¯ãƒ¼ã‚«ãƒ¼åˆæœŸåŒ–ã‚’è¦šãˆã‚‹å¿…è¦ã‚ã‚Š |

---

### ã©ã¡ã‚‰ã‚’é¸ã¶ï¼Ÿåˆ¤æ–­ãƒ•ãƒ­ãƒ¼

1. **æ¤œè¨¼ã—ãŸã„ç¯„å›²ã¯ â€œé–¢æ•°å˜ä½“â€ ã ã‘ï¼Ÿ**  
   - **YES** â†’ `vi.fn()` ã§ååˆ†ã€‚  
   - **NO**ï¼ˆç”»é¢é·ç§»ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€React Query ã¨ã®çµ„ã¿åˆã‚ã›ãªã© *å®Ÿéš›ã® HTTP* ã‚’ä»‹ã—ãŸæŒ¯ã‚‹èˆã„ã‚’è¦‹ãŸã„ï¼‰â†’ **MSW** ãŒæ¥½ã€‚

2. **å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå†…éƒ¨ã® `fetch` ã‚‚ãƒ¢ãƒƒã‚¯ã—ãŸã„ï¼Ÿ**  
   - **YES** â†’ Service Worker ãŒæ¨ªå–ã‚Šã§ãã‚‹ MSW ä¸€æŠã€‚  
   - **NO** â†’ `vi.stubGlobal('fetch', â€¦)` ã§ã‚‚ä»£æ›¿å¯ã€‚

3. **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚„ã‚¨ãƒ©ãƒ¼å¿œç­”ãƒ»ãƒªãƒˆãƒ©ã‚¤æŒ™å‹•ã‚’ãƒ†ã‚¹ãƒˆã—ãŸã„ï¼Ÿ**  
   - **YES** â†’ MSW ã® `ctx.status(401)` ç­‰ã§ â€œæœ¬ç•ªã«è¿‘ã„â€ å½¢ã‚’è¿”ã™ã¨æ¥½ã€‚  
   - **NO** â†’ æˆåŠŸãƒ‘ã‚¹ä¸­å¿ƒãªã‚‰ `vi.fn().mockResolvedValue({...})` ã§ã‚·ãƒ³ãƒ—ãƒ«ã«ã€‚

---

### æœ€å°ã‚µãƒ³ãƒ—ãƒ«

#### 1. `vi.fn()` ã§ fetch ã‚’å·®ã—æ›¿ãˆã‚‹ï¼ˆãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼‰

```ts
import { describe, it, expect, vi } from 'vitest';
import { login } from '@/lib/auth';      // fetch ã‚’å†…éƒ¨ã§å‘¼ã¶é–¢æ•°

it('æˆåŠŸæ™‚ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¿”ã™', async () => {
  // fetch ã‚’ä¸¸ã”ã¨ã‚¹ã‚¿ãƒ–
  const mockRes = { accessToken: 'abc' };
  vi.stubGlobal('fetch', vi.fn().mockResolvedValue({
    ok: true,
    json: () => Promise.resolve(mockRes),
  } as Response));

  const token = await login('foo', 'bar');
  expect(token).toBe('abc');
});
```

#### 2. MSW ã§ API ã‚’å†ç¾ï¼ˆçµ±åˆãƒ†ã‚¹ãƒˆï¼React Query å‘ãï¼‰

```ts
// tests/setup.ts
import { afterAll, afterEach, beforeAll } from 'vitest';
import { setupServer } from 'msw/node';
import { rest } from 'msw';

export const server = setupServer(
  rest.post('/login', (_req, res, ctx) =>
    res(ctx.status(200), ctx.json({ accessToken: 'abc' }))
  ),
);

beforeAll(() => server.listen({ onUnhandledRequest: 'error' }));
afterEach(() => server.resetHandlers());
afterAll(() => server.close());
```

```ts
// Sample.test.tsx
import { renderHook } from '@testing-library/react';
import { useLogin } from '@/hooks/useLogin';   // TanStack Query ãƒ•ãƒƒã‚¯
import '@/tests/setup';                        // â† ä¸Šã® MSW ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’èª­ã¿è¾¼ã‚€

it('ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒƒã‚¯ãŒãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¿”ã™', async () => {
  const { result } = renderHook(() => useLogin());
  await result.current.mutateAsync({ id: 'foo', pw: 'bar' });
  expect(result.current.data?.accessToken).toBe('abc');
});
```

---

### ç¾å ´ã§ã®â€œè½ã¨ã—ã©ã“ã‚â€

```
â”œâ”€ src/
â”‚   â”œâ”€ lib/        // ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆfetch ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰
â”‚   â””â”€ components/ // React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â””â”€ tests/
    â”œâ”€ unit/       // vi.fn() ã§é–¢æ•°ã‚’é«˜é€Ÿãƒ†ã‚¹ãƒˆ
    â””â”€ integration// MSW ã§ UI ã¨é€šä¿¡ãƒ¬ã‚¤ãƒ¤ã‚’çµåˆãƒ†ã‚¹ãƒˆ
```

- **ãƒ¦ãƒ‹ãƒƒãƒˆ**: fetch ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚„ãƒ‘ãƒ¼ã‚µãªã© **ç´”ç²‹ãªãƒ­ã‚¸ãƒƒã‚¯** ã¯ `vi.fn()` ã§è¶…é«˜é€Ÿã«å›ã™  
- **çµ±åˆ**: React Query, ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¨ãƒ©ãƒ¼ãƒã‚¦ãƒ³ãƒ€ãƒªãªã© **â€œé€šä¿¡ã‚ã‚Šãâ€ ã®æŒ¯ã‚‹èˆã„** ã¯ MSW ã§å†ç¾  
- ã©ã¡ã‚‰ã‚‚ **Vitest ã®ãƒ†ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼** ã§ä¸€å…ƒç®¡ç†ã§ãã€CI ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã€‚

> **ã¾ã¨ã‚**  
> - *ç¯„å›²ãŒç‹­ã„ãƒ»ã‚¹ãƒ”ãƒ¼ãƒ‰é‡è¦–* â†’ `vi.fn()`  
> - *å®Ÿé€šä¿¡ã«è¿‘ã„ E2E ã«å¯„ã›ãŸã„* â†’ MSW  
>   â†’ **ä¸¡æ–¹ã‚’ä½µç”¨** ã™ã‚‹ã¨ã€ãƒ†ã‚¹ãƒˆãŒã€Œé€Ÿã•ã€ã¨ã€Œãƒªã‚¢ãƒªãƒ†ã‚£ã€ã‚’ä¸¡ç«‹ã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/17 21:25:40*

useQuery/useMutationã‚’ä½¿ã†åˆ©ç‚¹ã£ã¦ä½•ãªã‚“ã ã‚ã†ã‹ã€‚ ãƒ•ã‚§ãƒƒãƒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã ã‘ã§ã¯ã„ã‘ãªã„ã®ã‹?
TanStack Query ã‚’è¡Œã£ãŸå ´åˆã¨è¡Œã‚ãªã‹ã£ãŸå ´åˆã®APIã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ãŸã‚‚ã®ã®ç”»é¢ã«åæ˜ ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ä¼ç”»ã—ã¦ã»ã—ã„ã€‚ã™ã”ã„ç°¡å˜ãªå®Ÿè£…ã§ã„ã„ç†ç”±ã‚ˆã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/17 21:25:43*

### ã€ŒTanStack Query ã‚’ä½¿ã† vs ä½¿ã‚ãªã„ã€â”€â”€â€œæœ€å°â€ã‚µãƒ³ãƒ—ãƒ«ã§ä¸¦ã¹ã¦é•ã„ã‚’è¦‹ã‚‹

---

## 1 ï¸âƒ£ ã¾ãšåˆ©ç‚¹ã‚’å…ˆã«ã²ã¨è¨€ã§
| è¦–ç‚¹ | **ãƒ•ã‚§ãƒƒãƒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã ã‘** | **ï¼‹ TanStack Query (`useQuery / useMutation`)** |
|-----|-------------------------------|------------------------------------------------|
| å†åˆ©ç”¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ | è‡ªå‰å®Ÿè£… | **æ¨™æº–è£…å‚™**ï¼ˆã‚­ãƒ¼å˜ä½ã®ãƒ¡ãƒ¢ãƒª/LRUã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰ |
| è‡ªå‹•ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° & ã‚¨ãƒ©ãƒ¼ state | `useState` ã‚’éƒ½åº¦æ›¸ã | `isLoading`, `error` ãŒè¿”ã£ã¦ãã‚‹ |
| ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é‡è¤‡æ’é™¤ | fetch ã‚’å‘¼ã¶ãŸã³ç™ºç”Ÿ | åŒã˜ `queryKey` åŒæœŸä¸­ãªã‚‰ 1 ç™ºã«ã¾ã¨ã‚ã‚‹ |
| èƒŒæ™¯ãƒªãƒ•ã‚§ãƒƒãƒ & ãƒãƒ¼ãƒªãƒ³ã‚° | `setInterval` æ‰‹æ›¸ã | `refetchInterval` 1 è¡Œ |
| ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œï¼å†è©¦è¡Œ | æ‰‹å‹• | `retry`, `networkMode:"offlineFirst"` |
| æ¥½è¦³çš„ UI æ›´æ–° | æ‰‹å‹• | `onMutate`ï¼`optimisticUpdate` |
| DevTools ã§çŠ¶æ…‹å¯è¦–åŒ– | ãªã— | `<ReactQueryDevtools />` ã ã‘ |
| â€œã‚­ãƒ£ãƒƒã‚·ãƒ¥æ›´æ–° â†’ UI è‡ªå‹•å†æç”»â€ | ã‚¤ãƒ™ãƒ³ãƒˆãƒã‚¹ç­‰ãŒå¿…è¦ | `queryClient.invalidateQueries()` 1 è¡Œ |

---

## 2 ï¸âƒ£ ã‚³ãƒ¼ãƒ‰æ¯”è¼ƒï¼ˆ*æœ€å°* ã ã‘ã©å·®ãŒè¦‹ãˆã‚‹ï¼‰

### å…±é€šã®å‹ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆä¾‹ï¼‰
```ts
// api.ts â€“ openapi-fetch ãªã©ã§ç”Ÿæˆæ¸ˆã¨æƒ³å®š
import createClient from 'openapi-fetch';
import type { paths } from '@/lib/api';

export const api = createClient<paths>({
  baseUrl: import.meta.env.VITE_API_BASE_URL,
});
type User = paths['/users']['get']['responses']['200']['content']['application/json'][number];
```

---

### A. **TanStack Query ãªã—** â€” â€œæ‰‹ä½œæ¥­â€ ç‰ˆ
```tsx
// Users.vanilla.tsx
import { useEffect, useState } from 'react';
import { api } from '@/api';

export default function UsersVanilla() {
  const [users, setUsers]   = useState<User[]>([]);
  const [loading, setLoad]  = useState(false);
  const [error, setError]   = useState<Error | null>(null);

  // å–å¾—
  useEffect(() => {
    setLoad(true);
    api.GET('/users')
      .then(r => setUsers(r.data ?? []))
      .catch(setError)
      .finally(() => setLoad(false));
  }, []);

  // è¿½åŠ ï¼ˆPOSTï¼‰
  const addUser = async () => {
    try {
      setLoad(true);
      await api.POST('/users', { body: { name: 'Alice' } });
      // â† ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒç„¡ã„ã®ã§å†ãƒ•ã‚§ãƒƒãƒæ‰‹æ›¸ã
      const fresh = await api.GET('/users');
      setUsers(fresh.data ?? []);
    } catch (e) { setError(e as Error); }
    finally     { setLoad(false); }
  };

  if (loading) return <p>Loadingâ€¦</p>;
  if (error)   return <p>Error: {error.message}</p>;

  return (
    <>
      <button onClick={addUser}>Add</button>
      <ul>{users.map(u => <li key={u.id}>{u.name}</li>)}</ul>
    </>
  );
}
```
**æ›¸ãã“ã¨**  
*ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ•ãƒ©ã‚°ãƒ»ã‚¨ãƒ©ãƒ¼ä¿æŒãƒ»é‡è¤‡é˜²æ­¢ãƒ»å†ãƒ•ã‚§ãƒƒãƒãƒ»ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥* ãªã©å…¨éƒ¨æ‰‹ä½œæ¥­ã€‚

---

### B. **TanStack Query ã‚ã‚Š** â€” ã»ã¼ â€œå®£è¨€çš„â€ ç‰ˆ
```tsx
// App.tsxï¼ˆroot ã§ä¸€åº¦ã ã‘ï¼‰
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
const qc = new QueryClient();
export default () => (
  <QueryClientProvider client={qc}>
    <UsersQuery />
  </QueryClientProvider>
);

// UsersQuery.tsx
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { api } from '@/api';

export default function UsersQuery() {
  const qc = useQueryClient();

  // å–å¾—
  const { data: users = [], isLoading, error } = useQuery({
    queryKey: ['users'],
    queryFn  : () => api.GET('/users').then(r => r.data ?? []),
  });

  // è¿½åŠ 
  const addUser = useMutation({
    mutationFn: () => api.POST('/users', { body: { name: 'Alice' } }),
    onSuccess : () => qc.invalidateQueries({ queryKey: ['users'] }), // ã‚­ãƒ£ãƒƒã‚·ãƒ¥â†’è‡ªå‹•å†ãƒ•ã‚§ãƒƒãƒ
  });

  if (isLoading) return <p>Loadingâ€¦</p>;
  if (error)     return <p>Error: {(error as Error).message}</p>;

  return (
    <>
      <button onClick={() => addUser.mutate()}>Add</button>
      <ul>{users.map(u => <li key={u.id}>{u.name}</li>)}</ul>
    </>
  );
}
```
**æ›¸ãã“ã¨**  
- `useQuery` ã« â€œã©ã†å–ã‚‹ã‹â€ ã‚’æ¸¡ã™ã ã‘ã€‚  
- ã‚¨ãƒ©ãƒ¼ï¼ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¯å¤‰æ•°ã§å—ã‘å–ã‚‹ã€‚  
- POST å¾Œã¯ `invalidateQueries` 1 è¡Œ â†’ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒã‚¯ãƒªã‚¢ã•ã‚Œè‡ªå‹•ãƒªãƒ•ã‚§ãƒƒãƒã€UI ã‚‚è‡ªå‹•æ›´æ–°ã€‚

---

## 3 ï¸âƒ£ ã©ã¡ã‚‰ã‚’æ¡ç”¨ã™ã‚‹ï¼Ÿè¶…ã‚·ãƒ³ãƒ—ãƒ«æŒ‡é‡

| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¦æ¨¡ / è¦ä»¶ | æ¨å¥¨ |
|------------------------|------|
| **â€“** ç”»é¢æ•°ãŒ 1â€“2ã€å†åˆ©ç”¨ã—ãªã„ã€ãƒãƒ¼ãƒªãƒ³ã‚°ã‚„è¤‡é›‘ãªã‚¨ãƒ©ãƒ¼å‡¦ç†ãŒä¸è¦ | ç´ ã® fetch / openapi-fetch ã ã‘ã§ã‚‚å¯ |
| **âœ“** ã‚­ãƒ£ãƒƒã‚·ãƒ¥å…±æœ‰ãƒ»ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ãƒ»ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œãƒ»è¤‡æ•°ç”»é¢ã§åŒã˜ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã† | TanStack Query ã‚’æœ€åˆã‹ã‚‰å…¥ã‚Œã‚‹æ–¹ãŒ*ç·ã‚³ã‚¹ãƒˆå®‰* |
| **?** é€”ä¸­ã§å¿…è¦ã«ãªã‚Šãã†ã ã‘ã©ã¾ã ä¸æ˜ | ãƒ‡ã‚£ãƒšãƒ³ãƒ‡ãƒ³ã‚·ãƒ¼ã¯è»½ã„ï¼ˆ10 kB å‰å¾Œï¼‰ã€‚å¾Œã‹ã‚‰å°å…¥ã—ã¦ã‚‚æ—¢å­˜ fetch å‘¼ã³å‡ºã—ã‚’ queryFn ã«ç§»ã™ã ã‘ãªã®ã§ **æ—©ã‚ã«å…¥ã‚Œã¦æãªã—** |

> **ã¾ã¨ã‚** : æ‰‹æ›¸ã fetch ã§ã‚‚å‹•ããŒã€**ã€Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ»ãƒªãƒˆãƒ©ã‚¤ã€ã‚’æ¯å›è‡ªä½œã™ã‚‹ã‚³ã‚¹ãƒˆ > React Query ã®å­¦ç¿’ã‚³ã‚¹ãƒˆ**ã€‚è¤‡æ•°ç”»é¢ or èªè¨¼ã‚ã‚Š API ãªã‚‰æœ€åˆã‹ã‚‰ `useQuery / useMutation` ã‚’æ¡ç”¨ã—ã¦ãŠãæ–¹ãŒä¿å®ˆãŒæ¥½ã§ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/17 21:27:55*

@tanstack/react-query ã® useQueryã¨openapi-react-queryã®api.useQueryã¯åˆ¥ã®è©±ã§ã™ã‹ã€ãã‚Œã¨ã‚‚å¿œç”¨ã§ãã‚‹è©±ãªã®ã‹ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/17 21:28:18*

### çµè«–ã ã‘å…ˆã«
- **`@tanstack/react-query` ã® `useQuery`ï¼`useMutation` ãŒâ€œæœ¬å®¶â€ã€‚  
- **`openapi-react-query` ã® `$api.useQuery()` ã¯ã€ãã®æœ¬å®¶ã‚’ãƒ©ãƒƒãƒ—ã—ãŸ**è–„ã„ãƒ˜ãƒ«ãƒ‘ãƒ¼ã€‚  
  - å†…éƒ¨ã§ã¯ **ãã®ã¾ã¾ `useQuery()` ã‚’å‘¼ã‚“ã§ã„ã‚‹**ã®ã§ã€React Query ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚„ DevTools ã¯å…±é€šã§å‹•ãã€‚  
  - è¿½åŠ ã•ã‚Œã‚‹ã®ã¯ã€Œãƒ¡ã‚½ãƒƒãƒ‰ï¼‹ãƒ‘ã‚¹ï¼‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ **å‹å®‰å…¨ãª queryKey ã¨ queryFn ã‚’è‡ªå‹•ç”Ÿæˆ**ã™ã‚‹ã€æ©Ÿèƒ½ã ã‘ã€‚îˆ€citeîˆ‚turn1view0îˆ‚turn3view0îˆ  

---

## ã©ã†ä½¿ã„åˆ†ã‘ã‚‹ï¼Ÿ

| ã‚±ãƒ¼ã‚¹ | æ¨å¥¨ãƒ•ãƒƒã‚¯ | ç†ç”± |
|-------|-----------|------|
| **OpenAPI ã§å®šç¾©æ¸ˆã¿ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ** | `$api.useQuery()` / `$api.useMutation()` | URLãƒ»ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’**100%ã‚¹ã‚­ãƒ¼ãƒé€£å‹•ã§å‹æ¤œæŸ»**ã€‚queryKey ã‚‚è‡ªå‹•ã§ä¸€è²«ã€‚ |
| **ã‚¹ã‚­ãƒ¼ãƒã«è¼‰ã£ã¦ã„ãªã„ â€œä¸€æ™‚çš„â€ ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**<br>(ä¾‹: S3 ç›´ç½²åå–å¾—ãªã©) | æœ¬å®¶ `useQuery()` / `useMutation()` | æ‰‹æ›¸ã fetch ã®æ–¹ãŒæ—©ã„ã€‚OpenAPI ã«è¼‰ã›ã‚‹ã»ã©ã§ã‚‚ãªã„å ´åˆã«ç´ ã§æ›¸ãã€‚ |
| **æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¨ã®æ··åœ¨** | ã©ã¡ã‚‰ã§ã‚‚å¯ | åŒã˜ `QueryClient` ã‚’å…±æœ‰ã™ã‚‹ã®ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯è¡çªã—ãªã„ã€‚ |

---

## ã‚³ãƒ¼ãƒ‰ã§è¦‹ã‚‹é•ã„ï¼ˆæœ€å°æ¯”è¼ƒï¼‰

### ğŸ…°ï¸ `$api.useQuery()` â€• å‹å®‰å…¨ï¼†ã‚­ãƒ¼è‡ªå‹•ç”Ÿæˆ
```tsx
// æº–å‚™
import createFetchClient from 'openapi-fetch';
import createClient      from 'openapi-react-query';
import type { paths }    from '@/lib/api';                 // openapi-typescript ç”Ÿæˆç‰©

const $api = createClient(
  createFetchClient<paths>({ baseUrl: '/api' })
);

// ç”»é¢å´
const { data, isLoading, error } = $api.useQuery(
  'get',
  '/users/{id}',
  { params: { path: { id: 1 } } }
);
```
- `queryKey` ã¯ `["get","/users/{id}",{ path:{ id:1 }}]` ã‚’è‡ªå‹•ç”Ÿæˆã€‚  
- `data` ã¯ OpenAPI ã® 200 ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‹ã§ **å®Œå…¨æ¨è«–**ã€‚

---

### ğŸ…±ï¸ æœ¬å®¶ `useQuery()` ã‚’æ‰‹æ›¸ã
```tsx
import { useQuery } from '@tanstack/react-query';
import { api }      from '@/lib/fetch-client';      // openapi-fetch ãªã©

const { data, isLoading, error } = useQuery(
  ['get','/users/{id}',1],                          // ã‚­ãƒ¼ã¯è‡ªå‰ã§æ±ºã‚ã‚‹
  () => api.GET('/users/{id}', { params:{ path:{ id:1 } } })
);
```
- **ã‚­ãƒ¼ã®æ›¸ãé–“é•ã„**ã‚„**å‹ã®é£Ÿã„é•ã„**ã¯ IDE ã§ã¯æ¤œå‡ºä¸å¯ã€‚  
- ãŸã ã— OpenAPI ã«è¼‰ã£ã¦ã„ãªã„ URL ã§ã‚‚è‡ªç”±ã«å‘¼ã¹ã‚‹ã€‚

---

## è¦šãˆã¦ãŠãã¹ããƒã‚¤ãƒ³ãƒˆ

1. **å…±å­˜ã¯å•é¡Œãªã—**  
   `$api.useQuery()` ã‚‚ `useQuery()` ã‚‚ **åŒã˜ QueryClient ã‚’ä½¿ã†**ã®ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚„ `invalidateQueries()` ãŒæ¨ªæ–­çš„ã«åŠ¹ãã€‚  

2. **hook ã«æ¸¡ã›ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯å…±é€š**  
   `$api.useQuery(..., queryOptions)` ã®ç¬¬ 4 å¼•æ•°ã«ãã®ã¾ã¾ React Query ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ¸¡ã›ã‚‹ã€‚retryãƒ»refetchInterval ãªã©å…¨æ©Ÿèƒ½ãŒåˆ©ç”¨å¯ã€‚îˆ€citeîˆ‚turn3view0îˆ  

3. **React Query DevTools ã‚‚ 1 å›ç½®ãã ã‘**  
   è‡ªå‹•ç”Ÿæˆ hook ã‚‚å†…éƒ¨ã§æœ¬å®¶ã‚’å‘¼ã¶ã ã‘ãªã®ã§ã€DevTools ã§é€šä¿¡çŠ¶æ…‹ã‚’ä¸€å…ƒç›£è¦–ã§ãã‚‹ã€‚  

---

### ã¾ã¨ã‚
- **é•ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**ã§ã¯ãªãã€`openapi-react-query` ã¯ **æœ¬å®¶ã‚’â€œå‹å®‰å…¨ã«å‘¼ã³ã‚„ã™ãã™ã‚‹â€ãŸã‚ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚·ãƒ¥ã‚¬ãƒ¼**ã€‚  
- ã€ŒURLãƒ»ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ»å‹ã‚’ã™ã¹ã¦ OpenAPI ã«æƒãˆãŸã„ç®‡æ‰€ã€ã¯ `$api.useQuery()` ã‚’ä½¿ã„ã€  
  ad-hoc ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯æœ¬å®¶ `useQuery()` ã‚’ä½¿ã†â€•â€•**ã“ã®ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãŒä¸€ç•ªæ¥½**ã§ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/17 21:31:08*

openapi-typescriptã¨openapi-fetchã¨openapi-react-queryã¯ã‚»ãƒƒãƒˆã§ä½¿ã†ã¨ã‚ˆã‚ŠãŠå¾—ã¨ã„ã†ã“ã¨ã§ç†è§£ã§ã‚ã£ã¦ã¾ã™ã‹?

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/17 21:31:28*

ã–ã£ãã‚Šè¨€ã†ã¨ **ã€Œã¯ã„ã€3 ã¤ã¾ã¨ã‚ã¦ä½¿ã†ã¨ãƒ¡ãƒªãƒƒãƒˆãŒæƒã£ã¦ç„¡é§„ãŒãªã„ã€** ã¨ã„ã†ç†è§£ã§åˆã£ã¦ã„ã¾ã™ã€‚  
ãŸã ã—å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒç‹¬ç«‹ã—ã¦ã„ã‚‹ã®ã§ã€

*ã€Œå‹ç”Ÿæˆã ã‘å¿…è¦ã€ã€ŒReact ã‚’ä½¿ã‚ãªã„ã€ãªã©è¦ä»¶æ¬¡ç¬¬ã§ä¸€éƒ¨ã ã‘æ¡ç”¨*

ã¨ã„ã†é¸æŠã‚‚ã§ãã¾ã™ã€‚  
ä»¥ä¸‹ã§ â€œå½¹å‰²ãƒ»ã‚·ãƒŠã‚¸ãƒ¼ãƒ»ä»£æ›¿ãƒ‘ã‚¿ãƒ¼ãƒ³â€ ã‚’æ•´ç†ã—ã¾ã™ã€‚

---

## 1. ãã‚Œãã‚Œã®å½¹å‰²

| ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ | ä¸»ãªä»•äº‹ | ã„ã¤å®Ÿè¡Œï¼Ÿ | ãƒ©ãƒ³ã‚¿ã‚¤ãƒ é‡é‡ |
|------------|---------|-----------|---------------|
| **openapi-typescript** | OpenAPI â†’ TypeScript å‹ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ | **ãƒ“ãƒ«ãƒ‰æ™‚**ï¼ˆCI ç­‰ï¼‰ | 0 kBï¼ˆå‹ã ã‘ï¼‰ |
| **openapi-fetch** | `fetch` ãƒ©ãƒƒãƒ‘ãƒ¼ã§ **å‹å®‰å…¨** ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ | **å®Ÿè¡Œæ™‚** | â‰ˆ 6 kB min+gz îˆ€citeîˆ‚turn3view0îˆ |
| **openapi-react-query** | openapi-fetch ã‚’ **@tanstack/react-query** ã«è‡ªå‹•æ¥ç¶šã—ã€`$api.useQuery()` ãªã©ã‚’ç”Ÿæˆ | **å®Ÿè¡Œæ™‚** | â‰ˆ 1 kB min+gz îˆ€citeîˆ‚turn2view0îˆ |

### ã©ã†ç¹‹ãŒã‚‹ã®ã‹

```
OpenAPI YAML
   â”‚ (CLI)          openapi-typescript
   â–¼                 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â†’  paths å‹
src/lib/api.d.ts
   â”‚                                   
   â–¼  (å®Ÿè¡Œæ™‚)   createClient<paths>()          (6 kB)
openapi-fetch â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ å‹ä»˜ã fetch
   â”‚                                   
   â–¼  (å®Ÿè¡Œæ™‚)   createClient(fetchClient)      (1 kB)
openapi-react-query â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ å‹ä»˜ã useQuery/useMutation
```

---

## 2. ã¾ã¨ã‚ã¦ä½¿ã† â€œãŠå¾—ãƒã‚¤ãƒ³ãƒˆâ€

| æ©Ÿèƒ½ | 3 ã¤ä½µç”¨ | ä»®ã«æ¬ ã‘ãŸå ´åˆ |
|------|----------|---------------|
| **URL/ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‹å®‰å…¨** | openapi-typescriptï¼‹fetch ãŒä¿è¨¼ | å‹ã‚’æ›¸ãæã˜ãŸç¬é–“ã« any åœ°ç„ |
| **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»ãƒªãƒˆãƒ©ã‚¤** | react-query ãŒ 1 è¡Œã§å¯¾å¿œ | æ‰‹æ›¸ãã‹ç‹¬è‡ªãƒ©ãƒƒãƒ‘ãƒ¼ãŒå¿…è¦ |
| **ç”Ÿæˆç‰©ã®è»½é‡ã•** | 7 kB å‰å¾Œ | ä¾‹: axios ç”Ÿæˆ SDK ã ã¨æ•°ç™¾ kB |
| **å­¦ç¿’ã‚³ã‚¹ãƒˆ** | React Query ã‚’çŸ¥ã£ã¦ã„ã‚Œã°æœ€å° | ç‹¬è‡ªãƒ•ãƒƒã‚¯ã‚’è‡ªåŠ›å®Ÿè£…ã™ã‚‹ç¾½ç›®ã« |

---

## 3. ã„ã¤ã€Œå…¨éƒ¨ã€ã˜ã‚ƒãªãã¦ã‚‚ã„ã„ï¼Ÿ

| è¦ä»¶ | æ¨å¥¨ã‚»ãƒƒãƒˆ |
|------|-----------|
| **UI ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãªã— / Node.js ã ã‘** | openapi-typescript + openapi-fetch |
| **SSR ã§ã‚‚ CSR ã§ã‚‚ React ã§ API ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ãŸã„** | 3 ã¤å…¨éƒ¨ |
| **å‹ã¯ç”Ÿæˆã—ãŸã„ãŒ axios ãŒå¥½ã** | openapi-typescript + openapi-typescript-fetchï¼ˆ3 kB åˆ¥å®Ÿè£…ï¼‰ |
| **ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼(Zod)ãŒå¿…é ˆ** | openapi-zod-client + react-query ãªã©åˆ¥ç³»çµ± |

---

## 4. ã‚µãƒ³ãƒ—ãƒ« â€”â€” 3 ã¤ä½µç”¨ã®æœ€çŸ­ã‚³ãƒ¼ãƒ‰

```ts
// â‘  å‹ç”Ÿæˆï¼ˆonceï¼‰
// npx openapi-typescript ./openapi.yaml -o src/lib/api.d.ts

// â‘¡ fetch ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
import createFetchClient from 'openapi-fetch';
import type { paths }    from '@/lib/api';

const fetchClient = createFetchClient<paths>({
  baseUrl: import.meta.env.VITE_API_BASE,
});

// â‘¢ React Query ãƒ•ãƒƒã‚¯
import createRQClient from 'openapi-react-query';
export const $api = createRQClient(fetchClient);

// â‘£ ä½¿ç”¨ä¾‹
const { data, error, isLoading } = $api.useQuery(
  'get', '/users/{id}', { params: { path: { id: 1 } } }
);
```

* `data` / `error` / `isLoading` ãªã© React Query ã® state ã¯ãã®ã¾ã¾ä½¿ãˆã¾ã™ã€‚  
* ç”Ÿæˆ Hook ãŒæ°—ã«å…¥ã‚‰ãªã‘ã‚Œã°ã€`useQuery()` æœ¬å®¶ã‚’æ‰‹æ›¸ãã§æ··åœ¨ã•ã›ã¦ã‚‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯å…±é€šã§ã™ã€‚

---

## 5. å‚è€ƒãƒªãƒ³ã‚¯

* openapi-react-query å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: ã€Œopenapi-fetch ã¨ openapi-typescript ã‚’å‰æã«ã—ãŸ 1 kB ãƒ©ãƒƒãƒ‘ãƒ¼ã€îˆ€citeîˆ‚turn2view0îˆ  
* openapi-fetch å…¬å¼: ã€Œ6 kBãƒ»ã‚¼ãƒ­ä¾å­˜ã®å‹å®‰å…¨ fetch ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€îˆ€citeîˆ‚turn3view0îˆ  
* openapi-typescript npm: ã€Œå‹ç”Ÿæˆãƒ„ãƒ¼ãƒ«ã€îˆ€citeîˆ‚turn1search0îˆ  

---

### âœ” ã¾ã¨ã‚

> **æ–°è¦ React ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ â€œå‹å®‰å…¨ + è»½é‡ + ã‚­ãƒ£ãƒƒã‚·ãƒ¥â€ ã‚’ä¸€æ°—ã«å–ã‚ŠãŸã„ãªã‚‰  
> openapi-typescript âœ openapi-fetch âœ openapi-react-query ã‚’ç´ ç›´ã«ä¸‰æ®µé‡ã­ã«ã™ã‚‹ã®ãŒæœ€çŸ­ãƒ«ãƒ¼ãƒˆ**ã€‚  
> è¦ä»¶ãŒå¤‰ã‚ã‚Œã°å€‹åˆ¥ã«å·®ã—æ›¿ãˆã‚‰ã‚Œã‚‹æŸ”è»Ÿæ€§ã‚‚æ®‹ã£ã¦ã„ã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/17 21:32:43*

çµæ§‹æ°—ã«ãªã‚‹ã®ãŒã€ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼ãŒå¿…è¦ãªå ´åˆã£ã¦ã©ã†ã„ã†æ™‚ãŒæŒ™ã’ã‚‰ã‚Œã‚‹ã®ã‹ãªã€‚ ã¡ãªã¿ã«ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã¯ã€ ç‚ã‚¾ãƒƒãƒˆã‚ªãƒ¼ãƒ—ãƒ³APIã‚’ä½¿ã£ã¦ã€ ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼ã—ã¦ã„ã‚‹ã‚ˆã†ãªAPIã«ãªã£ã¦ã„ã‚‹ã€‚ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼ã¯ä¸€èˆ¬çš„ãªã®ã‹ã€ãã‚Œã¨ã‚‚ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã«å¯„ã›ã‚‹ã“ã¨ãŒå¤šã„ã®ã‹ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/17 21:32:46*

## 1. ãã‚‚ãã‚‚â€œãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼â€ã¨ã¯  
**å‹å®£è¨€ã®æ­£ã—ã•ã‚’ _å®Ÿè¡Œæ™‚_ ã«ã‚‚ä¿è¨¼**ã™ã‚‹ã“ã¨ã€‚  
TypeScript ã®å‹ãƒã‚§ãƒƒã‚¯ã¯ãƒ“ãƒ«ãƒ‰ãŒçµ‚ã‚ã‚‹ã¨æ¶ˆãˆã‚‹ãŸã‚ã€æ¬¡ã®ã‚ˆã†ãªâ€œä¸æ­£ JSONâ€ãŒå±Šã„ã¦ã‚‚æ°—ä»˜ã‘ã¾ã›ã‚“ã€‚

```ts
// ä¾‹: openapi-fetch ã§å–å¾—
const res = await api.GET('/user/42');
res.data.name.toUpperCase();   // æ–‡å­—åˆ—ã ã¨ä¿¡ã˜ã¦ã„ã‚‹â€¦
```

ã‚µãƒ¼ãƒãƒ¼ãŒãƒã‚°ã£ã¦ `name: null` ã‚’è¿”ã™ã¨ã€ã“ã“ã§ **å®Ÿè¡Œæ™‚ä¾‹å¤–**ã€‚  
Zod ãªã©ã§ãƒ‘ãƒ¼ã‚¹ã™ã‚‹ã¨ **å³åº§ã«ã‚¨ãƒ©ãƒ¼ã‚’ throw** ã§ãã€å‘¼ã³å‡ºã—å…ƒã§æ¡ã‚Šã¤ã¶ã™ï¼å†è©¦è¡Œã‚’åˆ¤æ–­ã§ãã¾ã™ã€‚

---

## 2. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ã‚‚æ¤œè¨¼ã—ãŸã„ä»£è¡¨ã‚·ãƒŠãƒªã‚ª

| ã‚±ãƒ¼ã‚¹ | å…·ä½“ä¾‹ | æ¬ æãƒ‡ãƒ¼ã‚¿ãŒ UI ã«åŠã¼ã™å½±éŸ¿ |
|--------|-------|-----------------------------|
| **é–‹ç™ºåˆæœŸãƒ»API ãŒæºã‚Œã‚‹** | Î±ç‰ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ä¸¦è¡Œé–‹ç™º | â€œç©ºç”»é¢â€ã‚„è¬ã‚¨ãƒ©ãƒ¼ã®ã¾ã¾ãƒ‡ãƒ¢ã«å‡ºã›ãªã„ |
| **ç¬¬ä¸‰è€… API é€£æº** | Stripe, Firebase, è‡ªç¤¾å¤–ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ | ç›¸æ‰‹éšœå®³æ™‚ã« *å¤±ç¤¼ã®ãªã„* ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºã—ãŸã„ |
| **æ®µéšãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ** | `v1` ã¨ `v1.1` ãŒä¸¦è¡Œ | â€œæ˜”ã®ã‚¢ãƒ—ãƒªâ€ã§ã‚‚ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã›ãšã« fallback è¡¨ç¤º |
| **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼IndexedDB** | ç¦»ç·šæ™‚ã«å¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã‚€ | ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ã§å¤ã„ JSON ãŒä¸æ­£ã«ãªã‚Šå¾—ã‚‹ |
| **Feature Flag ãŒ JSON ã§é£›ã‚“ã§ãã‚‹** | A/B ãƒ†ã‚¹ãƒˆè¨­å®š | Flags ãŒå£Šã‚Œã‚‹ã¨ UX ãŒå¤§è’ã‚Œ |
| **ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å¼ UI** | ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ãŒæ‹¡å¼µã‚’æ›¸ãè¾¼ã‚€ | â€œæ‚ªæ„ã‚ã‚‹ JSONâ€ ã¸ã®é˜²å£ãŒãƒ•ãƒ­ãƒ³ãƒˆå´ã«ã‚‚å¿…è¦ |

> **è¦ã¯ã€Œã‚µãƒ¼ãƒãƒ¼ã‚’ 100 % ä¿¡é ¼ã§ããªã„ or ã—ãŸããªã„ã€çŠ¶æ³ã§ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ¤œè¨¼ãŒä¿é™ºã«ãªã‚‹**ã€‚

---

## 3. ã€Œã‚µãƒ¼ãƒãƒ¼ã§æ¤œè¨¼ã—ã¦ã‚‹ã‹ã‚‰ä¸è¦ã§ã¯ï¼Ÿã€ã¸ã®å›ç­”

| è¦–ç‚¹ | ã‚µãƒ¼ãƒãƒ¼ã®ã¿æ¤œè¨¼ | **ï¼‹ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ¤œè¨¼** |
|------|-----------------|-------------------------|
| **ã‚µãƒ¼ãƒãƒ¼ãƒã‚°** | Web ç”»é¢ãŒå£Šã‚Œã‚‹ã¾ã§æ°—ä»˜ã‹ãªã„ | å—ä¿¡ç›´å¾Œã«æ¤œçŸ¥ãƒ»Sentry é€ä¿¡ |
| **ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·æ”¹ã–ã‚“** | æ°—ä»˜ãã‚ˆã†ãŒãªã„ | JSON ãƒ‘ãƒ¼ã‚¹ã§å¼¾ã‘ã‚‹ |
| **API ãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ‡æ›¿** | æ–°æ—§ã‚¢ãƒ—ãƒªåŒæ™‚ãƒªãƒªãƒ¼ã‚¹æ™‚ã«ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ | â€œunknown fields ã¯æ¨ã¦ã‚‹â€ ãªã©æŸ”è»Ÿã«å¸åå¯ |

---

## 4. ç¾å ´ã®æ¡ç”¨ãƒãƒ©ãƒ³ã‚¹ï¼ˆè‚Œæ„Ÿï¼‰

| ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆè¦æ¨¡ / è¦ä»¶ | å‚¾å‘ |
|----------------------|------|
| **ç¤¾å†…å‘ã‘ãƒ»SPA 1 ç”»é¢ãƒ»API ã‚‚åŒã˜ãƒãƒ¼ãƒ ç®¡ç†** | **ã‚µãƒ¼ãƒãƒ¼æ¤œè¨¼ã ã‘**ã§ååˆ†ãªã“ã¨ãŒå¤šã„<br>ï¼ˆãƒãƒ³ãƒ‰ãƒ«å‰Šæ¸›ï¼†é«˜é€ŸåŒ–ã‚’å„ªå…ˆï¼‰ |
| **SaaS / BtoC / ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒª**<br>è¤‡æ•°ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ or ç¬¬ä¸‰è€… API | **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚‚æ¤œè¨¼**ãŒä¸€èˆ¬çš„<br>â€“ Mç«¯æœ«ã‚¯ãƒ©ãƒƒã‚·ãƒ¥é˜²æ­¢<br>â€“ ã‚¨ãƒ©ãƒ¼åˆ†æå®¹æ˜“åŒ– |
| **SDK æä¾›**ï¼ˆå¤–éƒ¨é–‹ç™ºè€…ãŒå‘¼ã¶ï¼‰ | ã»ã¼å¿…ãšãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼ã‚’å…¥ã‚Œã‚‹ |

---

## 5. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯åˆ¥ã®é¸æŠè‚¢

| ç”¨é€” | ä»£è¡¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ | ç‰¹å¾´ |
|------|--------------|------|
| **openapi + Zod æ¤œè¨¼ã‚’è‡ªå‹•ç”Ÿæˆ** | [`openapi-zod-client`] | å‹ + Zod schema + fetch ãƒ©ãƒƒãƒ‘ãƒ¼åŒæ™‚ç”Ÿæˆ |
| **æ—¢å­˜ openapi-fetch ã« Zod ã ã‘ä¹—ã›ã‚‹** | `zodios`, `openapi-typescript-zod` | queryFn å†…ã§ `schema.parse(await res.json())` |
| **GraphQL** | Apollo Client è‡ªå‹•ç”Ÿæˆ (`__typename` ã§æ¤œè¨¼) | ã‚¹ã‚­ãƒ¼ãƒãŒ 1 ã‚½ãƒ¼ã‚¹ãªã®ã§æ•´åˆæ€§æ‹…ä¿ã—ã‚„ã™ã„ |

---

## 6. å®Ÿè£…ã‚µãƒ³ãƒ—ãƒ«ï¼ˆopenapi-fetch + Zodï¼‰

```ts
import { z } from 'zod';
import { api } from '@/lib/fetch-client';

const User = z.object({
  id  : z.number(),
  name: z.string(),
});

export async function getUser(id: number) {
  const res = await api.GET('/user/{id}', { params: { path: { id } } });
  return User.parse(res.data);          // â† ã“ã“ã§ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼
}
```

- **å‹å´©ã‚Œ** ãªã‚‰å³ `ZodError` â†’ React Query ã® `error` ã¸ã€‚  
- ãƒãƒ³ãƒ‰ãƒ«å¢—ã¯ **Zod â‰ˆ 14 kB gzip**ã€‚å¯è¦³æ¸¬æ€§ã¨ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã§åˆ¤æ–­ã€‚

---

## 7. ã¾ã¨ã‚

1. **ã‚µãƒ¼ãƒãƒ¼æ¤œè¨¼ã¯å¿…é ˆã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ¤œè¨¼ã¯ã€Œäº‹æ•…ã‚’ã©ã“ã§æ­¢ã‚ãŸã„ã‹ã€ã§æ±ºã‚ã‚‹**ã€‚  
2. **ä¿¡é ¼åº¦ãŒä½ã„ãƒ»è¤‡æ•°ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ»ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚­ãƒ£ãƒƒã‚·ãƒ¥**ãŒã‚ã‚‹å ´åˆã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ¤œè¨¼ã‚’è¶³ã™ä¾¡å€¤ãŒé«˜ã„ã€‚  
3. openapi-* ç³»ã‚’ä½¿ã£ã¦ã„ã‚Œã° **Zod ä»˜ã SDK ã‚’å¾Œä»˜ã‘**ã§åˆ‡ã‚Šæ›¿ãˆã‚‹ã®ã‚‚æ¯”è¼ƒçš„å®¹æ˜“ã€‚  

> ã€Œã¨ã‚Šã‚ãˆãšå¾Œã‹ã‚‰å…¥ã‚Œã‚‹ã€ã‚ˆã‚Š **â€œå£Šã‚ŒãŸã‚‰å›°ã‚‹æ‰€ã ã‘æœ€åˆã‹ã‚‰æ¤œè¨¼â€** ãŒæœ€ã‚‚å®Ÿè·µçš„ã§ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/17 21:37:22*

openapi-typescriptã¨openapi-fetchã¨openapi-react-query ã§ã•ã‚‰ã«ã‚¾ãƒƒãƒˆã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å…¥ã‚Œã‚‹ãªã‚‰ã©ã“ã«ãªã‚‹ã¨æ€ã†? å®Ÿè£…ã‚’æ›¸ã„ã¦ã»ã—ã„ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/17 21:37:50*

### ã©ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ Zod ã‚’æŒŸã‚€ã‹ â€• çµè«–  
* **`openapi-fetch` ã® _middleware_ ã« Zod ãƒ‘ãƒ¼ã‚¹ã‚’å…¥ã‚Œã‚‹**ã®ãŒä¸€ç•ªã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã€‚  
  - Â­**å…±é€šåŒ–**ã§ãã‚‹ï¼šGET / POST ã™ã¹ã¦åŒã˜ 1 ç®‡æ‰€ã§æ¤œè¨¼ã€‚  
  - Â­**openapi-react-query ã¨ã®ç›¸æ€§**ã‚‚ãã®ã¾ã¾ â”€ ãƒ•ãƒƒã‚¯ã¯ã€ŒZod æ¸ˆã¿ã®ãƒ‡ãƒ¼ã‚¿ã€ã‚’å—ã‘å–ã‚‹ã ã‘ã€‚  
  - Â­**å‹ç”Ÿæˆ (`openapi-typescript`) ã¯ãã®ã¾ã¾**ã€‚ãƒ“ãƒ«ãƒ‰ã‚µã‚¤ã‚ºã¯ +14 kB (gzip) ç¨‹åº¦ã§æ¸ˆã¿ã¾ã™ã€‚  

---

## 1. ãƒ“ãƒ«ãƒ‰æ™‚ï¼šå‹ ï¼‹ Zod ã‚¹ã‚­ãƒ¼ãƒã‚’ç”Ÿæˆ

```bash
# å‹ (paths) ã¯å¾“æ¥ã©ãŠã‚Š
npx openapi-typescript ./openapi.yaml -o src/lib/api.d.ts

# Zod ã‚¹ã‚­ãƒ¼ãƒã¯ openapi-zod-client ã® â€œschemas-onlyâ€ ãƒ¢ãƒ¼ãƒ‰ã§ç”Ÿæˆ
npx openapi-zod-client ./openapi.yaml \
  --output src/lib/api.schemas.ts \
  --schemas-only          # â† fetch ãƒ©ãƒƒãƒ‘ã¯è¦ã‚‰ãªã„
```
- `openapi-zod-client` ã¯ **OpenAPI â†’ Zod ã‚¹ã‚­ãƒ¼ãƒ** ã‚’åãå‡ºã™ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã€‚  
  ãƒ©ãƒƒãƒ‘ãƒ¼ã‚’ä½¿ã‚ãš _schemas ã ã‘_ ã«çµã‚Œã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚‹ã€‚îˆ€citeîˆ‚turn2search0îˆ  

---

## 2. å®Ÿè¡Œæ™‚ï¼šZod æ¤œè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’æŒŸã‚€

```ts
// apiClient.ts
import createClient, { type Middleware } from 'openapi-fetch';
import type { paths }              from '@/lib/api';           // å‹
import   * as schemas              from '@/lib/api.schemas';   // Zod

/** â‘  ãƒ‘ã‚¹ï¼‹ãƒ¡ã‚½ãƒƒãƒ‰ â†’ ã‚¹ã‚­ãƒ¼ãƒ ã®ç°¡æ˜“ãƒãƒƒãƒ— */
const ZOD_MAP = {
  'GET /users/{id}'      : schemas.GetUserByIdResponse200,
  'POST /users'          : schemas.CreateUserResponse201,
  // ...è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸåå‰ã‚’åˆ—æŒ™
} as const;

/** â‘¡ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ Zod.parse ã™ã‚‹å…±é€šãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ */
const zodValidator: Middleware = {
  async onResponse({ operation, response }) {
    if (!response.ok) return response;                 // HTTP ã‚¨ãƒ©ãƒ¼ã¯ç´ é€šã—
    const key    = `${operation.method.toUpperCase()} ${operation.path}`;
    const schema = (ZOD_MAP as Record<string, any>)[key];
    if (!schema) return response;                      // ã‚¹ã‚­ãƒ¼ãƒæœªå®šç¾©ãªã‚‰æ¤œè¨¼ã—ãªã„

    // clone ã—ã¦ JSON ã‚’å–ã‚Šå‡ºã—ã€Zod ã§æ¤œè¨¼
    const data = await response.clone().json();
    schema.parse(data);                                // å¤±æ•—ã™ã‚Œã°ã“ã“ã§ throw
    return response;                                   // æˆåŠŸãªã‚‰ãã®ã¾ã¾ä¸Šä½ã¸
  },
};

export const fetchClient = createClient<paths>({
  baseUrl   : import.meta.env.VITE_API_BASE_URL,
  middleware: [zodValidator],
});
```
- `onResponse` ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¯å…¬å¼ API ãŒæä¾›ã€‚îˆ€citeîˆ‚turn0search0îˆ‚turn0search1îˆ  
- `response.clone()` ã§ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’è¤‡è£½ã—ã€**æœ¬ä½“ã¯ä¸Šä½ã® openapi-fetch ã«æ®‹ã™**ã®ã§äºŒé‡èª­ã¿å–ã‚Šã«ãªã‚‰ãªã„ã€‚

---

## 3. React å´ï¼šopenapi-react-query ã§å‹å®‰å…¨ãƒ•ãƒƒã‚¯ã‚’ç”Ÿæˆ

```ts
// $api.ts
import createRQClient from 'openapi-react-query';
export const $api = createRQClient(fetchClient);        // 1 kB ã®è–„ã„ãƒ©ãƒƒãƒ‘ãƒ¼
// openapi-react-query ã¯å†…éƒ¨ã§ @tanstack/react-query ã‚’å‘¼ã¶ã ã‘îˆ€citeîˆ‚turn1search0îˆ
```

---

## 4. ç”»é¢ã‹ã‚‰ã®åˆ©ç”¨ä¾‹ï¼ˆZod æ¤œè¨¼æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ãŒå±Šãï¼‰

```tsx
import { QueryClientProvider, QueryClient } from '@tanstack/react-query';
import { $api } from '@/lib/$api';

const qc = new QueryClient();

export default function App() {
  return (
    <QueryClientProvider client={qc}>
      <UserView id={1} />
    </QueryClientProvider>
  );
}

function UserView({ id }: { id: number }) {
  const { data, error, isLoading } = $api.useQuery(        // â† Zod parse æ¸ˆã¿
    'get',
    '/users/{id}',
    { params: { path: { id } } },
  );

  if (isLoading) return <p>Loading...</p>;
  if (error)     return <p>Err: {(error as Error).message}</p>;

  return <h1>{data.name}</h1>;                            // name ã¯ string ä¿è¨¼
}
```

- **ã‚‚ã—ã‚µãƒ¼ãƒãƒ¼ãŒ `name: null` ã‚’è¿”ã—ãŸã‚‰**  
  - `schema.parse()` ãŒ `ZodError` ã‚’ throw â†’ React Query ã® `error` ã«å…¥ã‚Šç”»é¢ã¯ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã›ãšã€‚  
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»ãƒªãƒˆãƒ©ã‚¤ãƒ»DevTools** ãªã© React Query ã®æ©Ÿèƒ½ã¯ãã®ã¾ã¾åˆ©ç”¨å¯ã€‚

---

## 5. â€œã©ã“ã§ Zod ã‚’æŒŸã‚€ã‹â€ æ—©è¦‹è¡¨

| æˆ¦ç•¥                       | ç‰¹å¾´ | ä½¿ã†å ´æ‰€ |
|---------------------------|------|---------|
| **middleware (ä»Šå›)**     | âœ… å…¨ API å…±é€šã®ä¸€æœ¬åŒ–<br>âœ… openapi-react-query ã¨ä½µç”¨â— | `openapi-fetch` |
| queryFn å†…ã§ `schema.parse`| å€‹åˆ¥ãƒ‘ã‚¹ã ã‘æ¤œè¨¼å¯<br>UI ã”ã¨ã«æŸ”è»Ÿ |  `useQuery` ç¬¬ 3/4 å¼•æ•°ãªã© |
| `openapi-zod-client` å…¨ä¹—ã›| SDK è‡ªä½“ãŒ Zodios ãƒ™ãƒ¼ã‚¹<br>React ä¸è¦ã§ã‚‚å¯ | openapi-fetch ã‚’ç½®ãæ›ãˆ |

> **ã¾ã¨ã‚**  
> - **openapi-typescript â†’ å‹**ã€**openapi-zod-client â†’ Zod ã‚¹ã‚­ãƒ¼ãƒ** ã‚’åŒæ™‚ç”Ÿæˆã€‚  
> - **onResponse ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢**ã« Zod.parse ã‚’æŒŸã‚€ã ã‘ã§ _å…¨çµŒè·¯_ ãŒãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼ä»˜ãã«ã€‚  
> - æ—¢å­˜ã® openapi-react-queryï¼React Query ã®æ›¸ãæ–¹ã¯ä¸€åˆ‡å¤‰ãˆãšã« **ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ãªã„ UI** ã‚’å®Ÿç¾ã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/17 21:41:01*

ã‚‚ã—ã“ã‚Œã‚’Hey APIã¨ãã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã‚„ã‚‹ã‚“ã ã£ãŸã‚‰çµæ§‹é›£ã—ã‹ã£ãŸè©±ãªã‚“ã‹ã€‚ ãã†ã§ã‚‚ãªã„ã®ã‹ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/17 21:41:25*

### Hey API ã‚¹ã‚¿ãƒƒã‚¯ã§ã€Œãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼ä»˜ã SDKã€ã‚’ä½œã‚‹é›£åº¦ã¯ï¼Ÿ

> **çµè«–ï¼š** ãœã‚“ãœã‚“é›£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚  
> `zod` ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ `@hey-api/sdk` ã® `validator` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ **2 è¡Œ** è¿½åŠ ã™ã‚‹ã ã‘ã§ã€  
> ç”Ÿæˆ SDK ãŒ **è‡ªå‹•ã§ Zod.parse() ã‚’ã‹ã‘ãŸãƒ‡ãƒ¼ã‚¿** ã‚’è¿”ã—ã¾ã™ã€‚  
> ãŸã ã— Î² ç‰ˆï¼ˆ2025-06 æ™‚ç‚¹ï¼‰ãªã®ã§ **å‡ºåŠ› API ãŒå¤‰ã‚ã‚‹å¯èƒ½æ€§**ã¨  
> **ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå¢—ï¼ˆâ‰ˆ +15 kB gzipï¼‰** ã¯è¦šæ‚Ÿã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚îˆ€citeîˆ‚turn1search1îˆ

---

## 1. `hey-api.config.ts`ï¼ˆæŠœç²‹ï¼‰

```ts
import { defaultPlugins } from '@hey-api/openapi-ts';

export default {
  input : './openapi.yaml',
  output: 'src/client',
  plugins: [
    ...defaultPlugins,         // types.gen.ts + sdk.gen.ts
    'zod',                     // â‘  Zod ã‚¹ã‚­ãƒ¼ãƒç”Ÿæˆãƒ—ãƒ©ã‚°ã‚¤ãƒ³
    {
      name     : '@hey-api/sdk',
      validator: true,         // â‘¡ SDK ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è‡ªå‹• validate
    },
    {
      // run-time config ã‚’ç’°å¢ƒå¤‰æ•°ã«ãƒã‚¤ãƒ³ãƒ‰
      name            : '@hey-api/client-fetch',
      runtimeConfigPath: './src/hey-api-runtime.ts',
    },
    '@tanstack/react-query',   // å¿…è¦ãªã‚‰å‹ä»˜ã useQuery/useMutation ã‚‚ç”Ÿæˆ
  ],
};
```
- `validator: true` ã®ä¸€è¡Œã§ SDK ãŒ **`zResponseSchema.parse(await res.json())`** ã‚’å†…éƒ¨å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«æ›¸ãæ›ã‚ã‚Šã¾ã™ã€‚îˆ€citeîˆ‚turn1search0îˆ  
- Runtime è¨­å®šã¯ **`runtimeConfigPath`** ã«æ›¸ãå‡ºã—ã€ã“ã“ã§ `baseUrl` ã‚„ãƒ˜ãƒƒãƒ€ä»˜ä¸ã‚’è¡Œã„ã¾ã™ã€‚îˆ€citeîˆ‚turn2search0îˆ  

```ts
// src/hey-api-runtime.ts
import type { CreateClientConfig }
  from './client/client.gen';          // â† ç”Ÿæˆç‰©ã®å‹

export const createClientConfig: CreateClientConfig = (defaults) => ({
  ...defaults,
  baseUrl: import.meta.env.VITE_API_BASE_URL,
  headers: {
    ...defaults.headers,
    Authorization: `Bearer ${localStorage.getItem('jwt') ?? ''}`,
  },
});
```

---

## 2. ç”Ÿæˆå¾Œã®ä½¿ç”¨æ„Ÿ

```ts
import { client }          from '@/client/sdk.gen';   // Zod æ¤œè¨¼ä»˜ SDK
import { useQuery }        from '@tanstack/react-query';

export function UserView({ id }: { id: number }) {
  // openapi-react-query ã¨åŒç­‰ã®è‡ªå‹•ç”Ÿæˆãƒ•ãƒƒã‚¯
  const { data, error, isLoading } = client.useQuery('GetUserById', { id });

  if (isLoading) return <p>Loadingâ€¦</p>;
  if (error)     return <p>{error.message}</p>;       // â† ZodError ã‚‚å…¥ã‚‹

  return <h1>{data.name}</h1>;                        // data ã¯æ¤œè¨¼æ¸ˆã¿
}
```
- `sdk.gen.ts` å†…ã®å„ã‚µãƒ¼ãƒ“ã‚¹é–¢æ•°ã‚‚ DevToolsãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯æœ¬å®¶ React Query ã¨å…±é€šã§ã™ã€‚  

---

## 3. **openapi-fetch** æ¡ˆã¨ã®æ¯”è¼ƒ

| è¦³ç‚¹ | **Hey API (+zod, +sdk)** | **openapi-fetch + æ‰‹å‹•ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢** |
|------|--------------------------|--------------------------------------|
| **è¨­å®šé‡** | config ãƒ•ã‚¡ã‚¤ãƒ«ã« 2 è¡Œ | Zod ã‚¹ã‚­ãƒ¼ãƒç”Ÿæˆ + ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢å®Ÿè£… |
| **ãƒãƒ³ãƒ‰ãƒ«** | ç”Ÿæˆ SDK â‰ˆ 50â€“70 kB<br>ï¼‹ Zod 15 kB | fetch 6 kB + Zod 15 kB |
| **Interceptors** | `runtimeConfigPath` ã§<br>ãƒ˜ãƒƒãƒ€ï¼retry ãªã©ä¸Šæ›¸ã | ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢é–¢æ•°ã§å®Œå…¨è‡ªç”± |
| **å‹ â†” ã‚¹ã‚­ãƒ¼ãƒä¹–é›¢ãƒªã‚¹ã‚¯** | ç”ŸæˆãŒ 1 ãƒ‘ã‚¹ãªã®ã§ä½ã„ | ã‚¹ã‚­ãƒ¼ãƒ map ã‚’æ‰‹ã§ä¿å®ˆ |
| **æŸ”è»Ÿæ€§** | fetch ä»¥å¤–ã® HTTP stack ã‚’é¸ã³ã«ãã„ | fetch / axios / ky ä½•ã§ã‚‚å¯ |
| **å®‰å®šåº¦** | Zod ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ Î² ç‰ˆ (API å¤‰å‹•ã‚ã‚Š) | OSS ã® openapi-fetch ã¯å®‰å®š |

**è¦ã™ã‚‹ã«ï¼š**  
- *ã€Œç”Ÿæˆç‰©ã‚’ã„ã˜ã‚‰ãšã€æœ€çŸ­ã§ Zod æ¤œè¨¼ä»˜ã SDK ãŒã»ã—ã„ã€* â†’ **Hey API** ãŒæ¥½ã€‚  
- *ã€ŒãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’ç´°ã‹ãå¼„ã‚ŠãŸã„ãƒ»ãƒãƒ³ãƒ‰ãƒ«ã‚’æ¥µé™ã¾ã§çµã‚ŠãŸã„ã€* â†’ **openapi-fetch æ‰‹çµ„ã¿** ãŒè‡ªç”±ã€‚

---

## 4. ã¾ã¨ã‚

- Hey API ãªã‚‰ **`zod` ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ï¼‹`validator: true` ã® 2 è¡Œè¿½åŠ **ã§å®Œçµã€‚  
- TanStack Query ãƒ•ãƒƒã‚¯ã‚‚å…¬å¼ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒã‚ã‚‹ã®ã§ã€ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼ã¨çŠ¶æ…‹ç®¡ç†ã‚’ **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ã§çµ±åˆ**ã§ãã‚‹ã€‚  
- ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã¯ **Î² ç‰ˆã‚†ãˆã®å°†æ¥äº’æ›æ€§ã¨ã€å¤šå°‘ã®å‡ºåŠ›ã‚µã‚¤ã‚ºå¢—**ã€‚  
- æ‹¡å¼µæ€§ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æœ€å„ªå…ˆã™ã‚‹å ´åˆã¯ã€å‰è¿°ã® **openapi-fetch + ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢æ–¹å¼** ãŒä¾ç„¶æœ‰åŠ›ã€‚

> **ã€Œé›£ã—ã„ï¼Ÿã€â”€â”€ã„ã„ãˆã€Hey API ãªã‚‰ã»ã¼ã‚³ãƒ”ãƒšãƒ¬ãƒ™ãƒ«ã§ã™ã€‚  
> ãŸã ã—é•·æœŸé‹ç”¨ãªã‚‰ Î² æ©Ÿèƒ½ã®å®‰å®šåº¦ã¨ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã‚’å¤©ç§¤ã«ã‹ã‘ã¦é¸ã³ã¾ã—ã‚‡ã†ã€‚**

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/17 21:44:07*

ä½œæˆã—ãŸ createClientConfigã‚’ã©ã“ã§è¨­å®šã™ã‚‹ã®ã‹ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/17 21:44:44*

### ã©ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ `createClientConfig()` ãŒèª­ã¾ã‚Œã‚‹ã®ï¼Ÿ  
1. **`hey-api.config.ts` ã§ `runtimeConfigPath` ã‚’æŒ‡å®š**ã™ã‚‹ã¨ã€  
   ç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ« `client.gen.ts` ã®å…ˆé ­ã«  

   ```ts
   import { createClientConfig } from '../src/hey-api-runtime';   // â† â˜…è‡ªå‹•æŒ¿å…¥
   ```  

   ãŒåŸ‹ã‚è¾¼ã¾ã‚Œã¾ã™ã€‚  
2. `client.gen.ts` ã¯ãã® import ã‚’ä½¿ã£ã¦

   ```ts
   export const client = createClient(createClientConfig(defaults));
   ```

   ã¨è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ãŸã‚ã€**ã‚ãªãŸè‡ªèº«ãŒã©ã“ã‹ã§å‘¼ã³å‡ºã™å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“**ã€‚  
   â€œè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ã„ã¦ãŠãã ã‘â€ã§ã€ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«ä¸€åº¦ã ã‘å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚îˆ€citeîˆ‚turn5view0îˆ

---

## æ‰‹é †ã‚’ã‚‚ã†ä¸€åº¦ã¾ã¨ã‚ã‚‹

| ã‚¹ãƒ†ãƒƒãƒ— | ãƒ•ã‚¡ã‚¤ãƒ« | å½¹å‰² |
|----------|----------|------|
| 1 | `hey-api.config.ts` | ```ts plugins:[{ name:'@hey-api/client-fetch', runtimeConfigPath:'./src/hey-api-runtime.ts' }] ``` |
| 2 | `src/hey-api-runtime.ts` | ```ts import type { CreateClientConfig } from './client/client.gen'; export const createClientConfig:CreateClientConfig = (c)=>({ ...c, baseUrl: import.meta.env.VITE_API_BASE_URL, headers:{ ...c.headers, Authorization:`Bearer ${localStorage.getItem('jwt')??''}` }, }); ``` |
| 3 | `npx @hey-api/openapi-ts â€¦` | ç”Ÿæˆã•ã‚ŒãŸ `client.gen.ts` ãŒ â‘ ã‚’ import ã—ã¦ **è‡ªå‹•çš„ã« `createClientConfig()` ã‚’å‘¼ã¶** |

ã“ã‚Œã§ **å…¨ SDKï¼React-Query ãƒ•ãƒƒã‚¯ãŒç’°å¢ƒå¤‰æ•°ã¤ã URLãƒ»èªè¨¼ãƒ˜ãƒƒãƒ€ãƒ»Zod ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ã**ã§å‹•ãã¾ã™ã€‚  
ã‚‚ã—èµ·å‹•å¾Œã«å‹•çš„ã«å·®ã—æ›¿ãˆãŸã„å ´åˆã¯ã€ç”Ÿæˆæ¸ˆã¿ `client` ã¸

```ts
import { client } from '@/client/client.gen';
client.setConfig({ baseUrl: '/proxy' });
```

ã¨ **`setConfig()`** ã‚’è¿½åŠ ã§å‘¼ã¹ã°ä¸Šæ›¸ãã‚‚å¯èƒ½ã§ã™ï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ã®ã‚‚ã†ä¸€ã¤ã®æ–¹æ³•ï¼‰ã€‚îˆ€citeîˆ‚turn5view0îˆ

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/17 21:46:45*

ãªã‚‹ã»ã©ãã‚‚ãã‚‚ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ä¸Šã§æ›´æ–°ã™ã‚‹ã¨ã„ã†ç™ºæƒ³è‡ªä½“ãŒé–“é•ã£ã¦ã„ã‚‹ã®ã‹ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/17 21:46:49*

ã„ã„ãˆã€**ã€Œãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã§ä¸€åˆ‡æ›´æ–°ã—ã¦ã¯ã„ã‘ãªã„ã€ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“**ã€‚  
ãŸã  `createClientConfig()` ã§æ¸¡ã™ **åˆæœŸè¨­å®š** ã¨ã€å®Ÿè¡Œä¸­ã«å·®ã—æ›¿ãˆã‚‹ **å‹•çš„è¨­å®š** ã‚’æ··åŒã—ã‚„ã™ã„ã ã‘ã§ã™ã€‚  
ãƒã‚¤ãƒ³ãƒˆã¯æ¬¡ã® 2 æ®µéšã«åˆ†ã‘ã¦è€ƒãˆã‚‹ã“ã¨ã§ã™ã€‚

| ãƒ•ã‚§ãƒ¼ã‚º | ä¸»ç›®çš„ | å…¸å‹çš„ãªå†…å®¹ | å¤‰æ›´ã‚¿ã‚¤ãƒŸãƒ³ã‚° |
|---------|--------|--------------|---------------|
| **â‘  åˆæœŸåŒ–æ™‚ (`createClientConfig`)** | â€œã“ã®ãƒ“ãƒ«ãƒ‰ãŒå‹•ãç’°å¢ƒâ€ ã‚’ä¸ãˆã‚‹ | `baseUrl`ãƒ»å…±é€šãƒ˜ãƒƒãƒ€ãƒ»ãƒªãƒˆãƒ©ã‚¤ãƒãƒªã‚·ãƒ¼ | **ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã« 1 å›** |
| **â‘¡ ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ›´æ–° (`client.setConfig` / ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢)** | â€œãã®ç¬é–“ã®ãƒ¦ãƒ¼ã‚¶çŠ¶æ…‹â€ ã‚’åæ˜  | ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã€ãƒ­ã‚±ãƒ¼ãƒ«ã€AB ãƒ†ã‚¹ãƒˆ ID | **ãƒ­ã‚°ã‚¤ãƒ³ï¼è¨­å®šå¤‰æ›´ã®ãŸã³** |

---

### 1. ã„ã¤â€œåˆæœŸåŒ–æ™‚ã ã‘â€ã§ååˆ†ã‹
- **ç’°å¢ƒã§å®Œå…¨ã«æ±ºã¾ã‚‹å€¤**  
  - `VITE_API_BASE_URL`, `X-App-Version` ãªã©  
  - æœ¬ç•ªï¼Stagingï¼ãƒ­ãƒ¼ã‚«ãƒ«ã§å¤‰ãˆã‚‹ã ã‘ãªã‚‰ã€ãƒ“ãƒ«ãƒ‰æ™‚ `env` å¤‰æ•° â†’ `createClientConfig()` ã§ OKã€‚
- **åŒ¿å API ã—ã‹å‘¼ã°ãªã„ SPA**  
  - ãƒˆãƒ¼ã‚¯ãƒ³ãŒç„¡ã„ã®ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã®æ›´æ–°ãŒä¸è¦ã€‚

### 2. â€œãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ›´æ–°â€ ãŒæœ‰ç”¨ãªã‚±ãƒ¼ã‚¹
| ä»£è¡¨ã‚·ãƒŠãƒªã‚ª | å®Ÿè£…ã‚¢ã‚¤ãƒ‡ã‚¢ |
|--------------|-------------|
| **ãƒ­ã‚°ã‚¤ãƒ³å¾Œã« Bearer ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä»˜åŠ ** | ```ts client.setConfig(c => ({ ...c, headers:{ ...c.headers, Authorization:`Bearer ${token}` }})); ``` |
| **ãƒ¦ãƒ¼ã‚¶ãŒè¨€èªã‚’åˆ‡ã‚Šæ›¿ãˆãŸ** | `Accept-Language` ã‚’ `setConfig` ã§æ›´æ–° â†’ React Query ã® `invalidateQueries()` ã§å†ãƒ•ã‚§ãƒƒãƒ |
| **ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼**ï¼šç‰¹å®šãƒªãƒ¼ã‚¸ãƒ§ãƒ³éšœå®³æ™‚ã« BaseURL ã‚’ `/us-east` â†’ `/us-west` ã¸ | ç›£è¦–ãƒ­ã‚¸ãƒƒã‚¯ãŒ `setConfig({ baseUrl: â€¦ })` |
| **ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆ SaaS**ï¼šä¼æ¥­ A / B ã”ã¨ã«ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒé•ã† | ãƒ†ãƒŠãƒ³ãƒˆåˆ‡æ›¿æ™‚ã ã‘ BaseURL ã‚’æ›´æ–° |

### 3. Hey-API ç”Ÿæˆ SDK ã§ã®é¸æŠè‚¢
| æ–¹æ³• | ä½¿ã†ã¨ã | å‚™è€ƒ |
|------|----------|------|
| **`createClientConfig(defaults)`: ä¸€åº¦ã ã‘** | URLãƒ»ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ˜ãƒƒãƒ€ãªã© *ç’°å¢ƒå›ºæœ‰* ã®å€¤ | ç”Ÿæˆ SDK å†…ã§è‡ªå‹•å®Ÿè¡Œã•ã‚Œã‚‹ |
| **`client.setConfig({ â€¦ })`: å…¨é¢ä¸Šæ›¸ã** | ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼ã€ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãªã©å¤§å¹…å¤‰æ›´ | å¤‰æ›´å¾Œã¯ React Query ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ•´ç†ã‚’å¿˜ã‚Œãšã« |
| **ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ (`onRequest`)** | ã»ã¼æ¯å›å¤‰ã‚ã‚‹å€¤ï¼ˆæœ€æ–°ãƒˆãƒ¼ã‚¯ãƒ³ï¼‰ | ä¾‹ï¼šãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ token ã‚’éƒ½åº¦èª­ã¿å–ã‚‹ |

```ts
// æ¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§æ–°ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ³¨å…¥ã™ã‚‹ä¾‹
client.use({
  onRequest({ request }) {
    const jwt = localStorage.getItem('jwt');
    if (jwt) request.headers.set('Authorization', `Bearer ${jwt}`);
    return request;
  },
});
```

---

## âœ” ã¾ã¨ã‚
- **ç’°å¢ƒã§æ±ºã¾ã‚‹å®šæ•°** â†’ `createClientConfig()` ã«é›†ç´„ã—ã¦ â€œèµ·å‹•æ™‚ 1 å›â€ æ¸¡ã™ã€‚  
- **ãƒ¦ãƒ¼ã‚¶æ“ä½œã‚„éšœå®³å¯¾å¿œã§å¤‰ã‚ã‚‹å€¤** â†’ `setConfig()` ã‹ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã§ â€œå¿…è¦ãªç¬é–“ã ã‘â€ ä¸Šæ›¸ãã€‚  
- ã“ã‚Œã‚’åˆ†ã‘ã¦ãŠãã¨ *ã€Œã©ã“ã§å€¤ãŒæ±ºã¾ã‚‹ã‹ã€* ãŒæ˜ç¢ºã«ãªã‚Šã€ä¿å®ˆã‚‚ãƒ†ã‚¹ãƒˆã‚‚ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/17 21:47:41*

ã§ã‚‚ã‚»ãƒƒãƒˆã‚³ãƒ³ãƒ•ã‚£ã‚°ã§å¤‰ãˆãŸã¨ã“ã‚ã§ã€ãã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ã¾ãŸä½¿ãŠã†ã¨ã—ãªã„é™ã‚Šã€ãã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯æ›´æ–°ã•ã‚Œãªã„ã‚“ã ã‚ˆã­ã€‚ã“ã‚Œã£ã¦ã‚·ãƒ³ã‚°ãƒ«ãƒ‰ãƒ³ã‹ä½•ã‹ã§å…±é€šåŒ–ã•ã‚Œã¦ã„ã‚‹ã®?

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/17 21:47:44*

### `client.setConfig()` ãŒåŠ¹ãä»•çµ„ã¿  
- **ç”Ÿæˆ SDK (`client.gen.ts`) ã§ã¯**  
  ```ts
  export const client = createClient(initialConfig);
  ```  
  ãŒ 1 å›ã ã‘å®Ÿè¡Œã•ã‚Œã€ãã® **`client` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ ES-Modules ã®ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³** ã¨ã—ã¦ export ã•ã‚Œã¾ã™ã€‚  
  - ã©ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ `import { client }` ã—ã¦ã‚‚ **åŒã˜å‚ç…§**ã€‚  
  - `setConfig()` ã¯ãã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå†…éƒ¨ã® `config` ã‚’ *mutable* ã«æ›¸ãæ›ãˆã‚‹é–¢æ•°ã§ã™ã€‚  

```mermaid
flowchart LR
  A[Module A] -->|import| C(Client singleton)
  B[Module B] -->|import| C
  C -->|setConfig| C  %% åŒã˜ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãªã®ã§å³å…±æœ‰
```

- ã—ãŸãŒã£ã¦ **ä¸€åº¦ã§ã‚‚ `client.setConfig(...)` ã‚’å‘¼ã¹ã°**  
  *ä»¥é™ã«åŒã˜ `client` ã§è¡Œã†ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ* ã¯æ–°ã—ã„è¨­å®šã‚’å‚ç…§ã—ã¾ã™ã€‚  

---

### ãŸã ã— â€œè‡ªå‹•å†ãƒ•ã‚§ãƒƒãƒâ€ ã¾ã§ã¯ã—ã¦ãã‚Œãªã„

| å‡¦ç† | ä½•ãŒèµ·ã“ã‚‹ï¼Ÿ |
|------|--------------|
| **æ—¢ã«é€ä¿¡ä¸­ã® HTTP** | æ—§è¨­å®šã®ã¾ã¾å®Œèµ°ï¼ˆå½“ç„¶ã‚­ãƒ£ãƒ³ã‚»ãƒ«ä¸å¯ï¼‰ |
| **React Query ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥** | ä½•ã‚‚å¤‰ã‚ã‚‰ãªã„ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ãŒå¤‰ã‚ã£ã¦ã‚‚ UI ã¯æ›´æ–°ã•ã‚Œãªã„ï¼‰ |
| **æ¬¡å›é€ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆ** | æ–°ã—ã„è¨­å®šã§ç™ºç« |

> ğŸ‘‰ **ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°ç›´å¾Œã« UI ã‚’å³æ™‚åˆã‚ã›ãŸã„å ´åˆ**  
> 1. `client.setConfig({ headers: { Authorization: 'Bearer xxx' } })`  
> 2. `queryClient.invalidateQueries()` ã‚„ `refetch()` ã§å†å–å¾—  
>    ï¼ˆTanStack Query ãªã‚‰ 1 è¡Œã§å…¨ãƒ‡ãƒ¼ã‚¿ã®å†ãƒ•ã‚§ãƒƒãƒãŒå¯èƒ½ï¼‰

```ts
// afterLogin.ts
import { client } from '@/client/sdk.gen';
import { queryClient } from '@/app/providers';

export function onLoginSuccess(token: string) {
  client.setConfig(c => ({
    ...c,
    headers: { ...c.headers, Authorization: `Bearer ${token}` },
  }));
  queryClient.invalidateQueries();      // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å…¨ã¦æ–°ãƒˆãƒ¼ã‚¯ãƒ³ã§æ›´æ–°
}
```

---

### ã€Œæ¯å›ãƒˆãƒ¼ã‚¯ãƒ³ãŒå¤‰ã‚ã‚Šå¾—ã‚‹ã€ãªã‚‰ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢æ–¹å¼ãŒæ¥½

```ts
// 1åº¦ã ã‘ä»•è¾¼ã‚“ã§ãŠã
client.use({
  onRequest({ request }) {
    const jwt = sessionStorage.getItem('jwt');          // æœ€æ–°ã‚’éƒ½åº¦å–å¾—
    if (jwt) request.headers.set('Authorization', `Bearer ${jwt}`);
    return request;
  },
});
```
- ã“ã®æ–¹æ³•ãªã‚‰ **ãƒ­ã‚°ã‚¤ãƒ³ï¼ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã®ãŸã³ã« `setConfig()` ã‚’å‘¼ã°ãªãã¦ã‚‚**  
  å¸¸ã«æœ€æ–°ãƒˆãƒ¼ã‚¯ãƒ³ã§é€ä¿¡ã§ãã¾ã™ã€‚  
- `client` ã¯å¤‰ã‚ã‚‰ãªã„ã®ã§ React Query ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ­ã‚¸ãƒƒã‚¯ã¨è¡çªã—ã¾ã›ã‚“ã€‚  

---

### åˆ¥ãƒ†ãƒŠãƒ³ãƒˆãƒ»åˆ¥ BaseURL ã‚’åŒæ™‚ã«æ‰±ã†å ´åˆ

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | å®Ÿè£…æ¡ˆ |
|----------|--------|
| **ã‚¢ãƒ—ãƒªå…¨ä½“ã§ 1 ã¤ã ã‘åˆ‡ã‚Šæ›¿ãˆã‚‹** (ä¾‹: ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼) | `client.setConfig({ baseUrl: '/us-west' })` + `invalidateQueries()` |
| **è¤‡æ•°ãƒ†ãƒŠãƒ³ãƒˆã‚’åŒæ™‚ã«è¡¨ç¤º** (A ã¨ B ã‚’å·¦å³ã«ä¸¦ã¹ã‚‹ UI) | `const tenantA = createClient(cfgA); const tenantB = createClient(cfgB);` â€” *æ–°ã—ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œã‚‹* |

---

## ã¾ã¨ã‚

1. **ç”Ÿæˆã•ã‚ŒãŸ `client` ã¯å®Ÿè³ªã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³**ãªã®ã§ `setConfig()` ã®å¤‰æ›´ã¯å³å…¨ä½“ã¸æ³¢åŠã€‚  
2. **é€²è¡Œä¸­ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯è‡ªå‹•ã§ã¯æ›´æ–°ã•ã‚Œãªã„** â”€ å¿…è¦ãªã‚‰ `invalidateQueries()` ç­‰ã§å†ãƒ•ã‚§ãƒƒãƒã€‚  
3. **å¸¸æ™‚å¤‰å‹•ã™ã‚‹å€¤ï¼ˆJWT ãªã©ï¼‰ã¯ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢æŒ¿å…¥**ã®æ–¹ãŒã‚³ãƒ¼ãƒ‰ãŒæ•£ã‚‰ã°ã‚‰ãšå®‰å…¨ã€‚  
4. **è¤‡æ•° BaseURL ã‚’åŒæ™‚ã«ä½¿ã†**å ´åˆã ã‘ã€`createClient()` ã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’åˆ†ã‘ã‚‹ã€‚

ã“ã®æ•´ç†ã‚’é ­ã«å…¥ã‚Œã¦ãŠã‘ã°ã€ã€Œã©ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ä½•ã‚’æ›´æ–°ã™ã‚Œã° UI ã¨é€šä¿¡ãŒåŒæœŸã™ã‚‹ã‹ã€ãŒè¿·ã‚ãªããªã‚Šã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/17 21:48:33*

ã‚ã‚‹ãªã‚‰ã°ã€Hey APIã®æ–¹ãŒã„ã„æ°—ãŒã™ã‚‹ã‚“ã ã‘ã©ã€ãã†ã§ã‚‚ãªã„ã®?

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/17 21:48:46*

### â€œHey API ãŒè‰¯ã•ãã†â€ã¨æ€ã£ãŸã¨ãã«ç¢ºèªã—ãŸã„ 4 ã¤ã®è»¸

| è¦³ç‚¹ | **Hey API ã‚¹ã‚¿ãƒƒã‚¯**<br>(`openapi-ts` + `@hey-api/client-fetch` + `@hey-api/sdk` + `zod` ãƒ—ãƒ©ã‚°ã‚¤ãƒ³) | **openapi-fetch ã‚¹ã‚¿ãƒƒã‚¯**<br>(`openapi-typescript` + `openapi-fetch` + `openapi-react-query`) |
|------|-------------------------------------------------------------|--------------------------------------------------------------|
| **ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å·¥æ•°** | `hey-api.config.ts` ã«<br>```zod``` ã¨<br>```{ name:'@hey-api/sdk', validator:true }``` ã‚’è¿½è¨˜ã™ã‚‹ã ã‘ã€‚Zod ã‚¹ã‚­ãƒ¼ãƒç”Ÿæˆã¨ **ãƒ¬ã‚¹ãƒãƒ³ã‚¹ parse** ã‚’è‡ªå‹•åŒ–ã€‚îˆ€citeîˆ‚turn0search0îˆ‚turn0search3îˆ | å‹ç”Ÿæˆ â†’ fetch ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä½œæˆ â†’ `onResponse` ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã§ Zod.parse â”€ **3 ã‚¹ãƒ†ãƒƒãƒ—æ‰‹çµ„ã¿** |
| **å®Ÿè¡Œæ™‚ã‚µã‚¤ã‚º** | SDK 50â€“70 kB + Zod 15 kB (gzip ç›®å®‰) â”€ **ã‚„ã‚„é‡ã‚** | fetch 6 kB + Zod 15 kB â”€ **æœ€è»½é‡** |
| **API å®‰å®šåº¦** | Zod ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ **Î² è¡¨è¨˜**ã€‚ãƒ¡ã‚¸ãƒ£ãƒ¼ã‚¢ãƒƒãƒ—æ™‚ã«ç ´å£Šçš„å¤‰æ›´ã®å¯èƒ½æ€§ã‚ã‚Šã€‚îˆ€citeîˆ‚turn0search0îˆ | OSS æœ¬ä½“ã¯ 2022 ã€œ å®‰å®šé‹ç”¨ã€‚API äº’æ›æ€§ã«æ…é‡ã€‚ |
| **æŸ”è»Ÿæ€§ / æ‹¡å¼µ** | HTTP ã‚¹ã‚¿ãƒƒã‚¯ã¯ `client-fetch` ã®ã¿ã€‚Axios/ky ãªã©ã¸ç½®æ›ã—ã«ãã„ã€‚ | fetch/axios/ky ãªã©è‡ªç”±ã€‚ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã§ç´°ç²’åº¦åˆ¶å¾¡å¯ã€‚ |

---

## 1ï¸âƒ£ Hey API ã‚’ã€Œæ¨ã—ã€ã«ã™ã‚‹ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³

| ã“ã‚“ãªæ™‚ | ç†ç”± |
|----------|------|
| **ã¨ã«ã‹ãæ‰‹é–“ã‚’æ¸›ã‚‰ã—ãŸã„** | Zod ã‚‚ React-Query ãƒ•ãƒƒã‚¯ã‚‚ _ãƒ¯ãƒ³ã‚³ãƒãƒ³ãƒ‰ç”Ÿæˆ_ã€‚æ‰‹æ›¸ãã‚³ãƒ¼ãƒ‰ã‚’æœ€å°åŒ–ã€‚ |
| **è¤‡æ•°ãƒ•ãƒ­ãƒ³ãƒˆ (Vue/React/Svelte/â€¦) ã§åŒã˜ SDK ã‚’å…±æœ‰** | Hey API å…¬å¼ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§å„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¸ auto-adapt (TanStack Query ç³»)ã€‚îˆ€citeîˆ‚turn0search1îˆ |
| **éæŠ€è¡“ãƒ¡ãƒ³ãƒãƒ¼ã§ã‚‚ç”Ÿæˆæ‰‹é †ã‚’å›ã™** | è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’æ›¸ãã ã‘ãªã®ã§ CI/CD ã§å†ç”ŸæˆãŒæ¥½ã€‚ |
| **æ¤œè¨¼ã‚³ã‚¹ãƒˆã‚ˆã‚Šâ€œäººä»¶è²»â€ãŒå‹ã¤** | åˆæœŸãƒã‚°ã‚ˆã‚ŠçœåŠ›åŒ–ã‚’å„ªå…ˆã—ãŸã„å ´åˆã€Î² ã§ã‚‚ GUI å¿«é©ã•ãŒé­…åŠ›ã€‚ |

---

## 2ï¸âƒ£ openapi-fetchã‚’é¸ã¶æ–¹ãŒå®‰å…¨ãªå ´é¢

| ã“ã‚“ãªæ™‚ | ç†ç”± |
|----------|------|
| **ãƒãƒ³ãƒ‰ãƒ« 1 byte ã§ã‚‚æ¸›ã‚‰ã—ãŸã„ SPA / Edge** | 6 kB fetch + æ‰‹å‹• Zod = æœ€å°ã€‚ |
| **Axios ã‚„ retry-queue ãªã©ç‹¬è‡ª HTTP ãƒ¬ã‚¤ãƒ¤ã‚’å¿…é ˆ** | `createClient()` ã®ç½®ãæ›ãˆãŒè‡ªç”±ã€‚ |
| **OSS ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã® API å¤‰æ›´ã«æ•æ„Ÿ** | openapi-fetch / typescript ã¯æ­´ãŒé•·ãã‚³ãƒŸãƒƒãƒˆã‚‚å®‰å®šã€‚ |
| **Runtime ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’ç´°ã‹ãå¼„ã‚‹** | `onRequest/onError` ã§ãƒ•ãƒ«ã‚«ã‚¹ã‚¿ãƒ ã€‚token Refreshãƒ»Circuit-Breaker ãªã©ã‚’å¥½ãæ”¾é¡Œã€‚ |

---

## 3ï¸âƒ£ å®Ÿè£…æ„Ÿã®æ¯”è¼ƒï¼ˆ1 ãƒ•ã‚¡ã‚¤ãƒ«ã§å®Œçµç‰ˆï¼‰

### â—† Hey API

```ts
// hey-api.config.ts (æŠœç²‹)
plugins: [
  ...defaultPlugins,
  'zod',
  { name: '@hey-api/sdk', validator: true },
  { name: '@hey-api/client-fetch',
    runtimeConfigPath: './src/hey-api-runtime.ts' },
  '@tanstack/react-query',
]

// src/hey-api-runtime.ts
export const createClientConfig = d => ({
  ...d,
  baseUrl: import.meta.env.VITE_API_BASE,
  headers: { ...d.headers, Authorization: `Bearer ${getJwt()}` },
});
```

â†’ ç”Ÿæˆã•ã‚ŒãŸ `client.useQuery('GetUserById', { id })` ã¯  
**Zod ã§ parse æ¸ˆã¿ã®ãƒ‡ãƒ¼ã‚¿**ã‚’è¿”ã™ã€‚

---

### â—† openapi-fetch

```ts
// å‹ç”Ÿæˆ
npx openapi-typescript openapi.yaml -o src/api.d.ts

// fetch ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ + Zod æ¤œè¨¼ Middleware
import createClient            from 'openapi-fetch';
import * as S                  from './api.schemas';  // openapi-zod-client ã®å‡ºåŠ›
export const api = createClient<paths>({
  baseUrl: import.meta.env.VITE_API_BASE,
  middleware: [{
    async onResponse({ operation, response }) {
      const key = `${operation.method} ${operation.path}`;
      const data = await response.clone().json();
      ZOD_MAP[key]?.parse(data);
      return response;
    },
  }],
});
```

â†’ `openapi-react-query` ã‚’å™›ã¾ã›ã‚Œã°åŒã˜ `useQuery` ä½“é¨“ã‚’æ‰‹çµ„ã¿ã§å®Ÿç¾ã€‚

---

## 4ï¸âƒ£ åˆ¤æ–­ãƒ•ãƒ­ãƒ¼ï¼ˆã¾ã¨ã‚ï¼‰

1. **ç”Ÿæˆã ã‘ã§å®Œçµãƒ»å¤šå°‘ã®Î²ãƒªã‚¹ã‚¯å®¹èª â†’ _Hey API_**  
2. **æœ€å°ã‚µã‚¤ã‚º & ãƒ•ãƒ«ã‚«ã‚¹ã‚¿ãƒ  â†’ _openapi-fetch_**  
3. **é€”ä¸­ã§ä¹—ã‚Šæ›ãˆã‚‹**ã®ã‚‚æ¥½  
   - Hey API ç”Ÿæˆç‰©ã¯ **å¹³å‡¡ãª TypeScript** ãªã®ã§ã€å¾Œã§ `openapi-fetch` or Axios ã«ç§»è¡Œå¯ã€‚  
   - é€†ã«ç¾è¡Œ openapi-fetch ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚‚ã€Hey API ã‚’å°å…¥ã—ã¦ â€œSDK ã ã‘ç½®æ›â€ ã‚‚ OKã€‚

> **çµè«–**  
> - **ã€Œè¨­å®šãƒ•ã‚¡ã‚¤ãƒ« 1 æœ¬ã§å‹ãƒ»SDKãƒ»Zodãƒ»React Queryã¾ã§å…¨éƒ¨ã»ã—ã„ã€**ãªã‚‰ Hey API ãŒæœ€çŸ­è·é›¢ã€‚  
> - **ã€Œè»½ã•ã¨è‡ªç”±åº¦ã‚’æœ€å„ªå…ˆã€**ãªã‚‰ openapi-fetch ã‚¹ã‚¿ãƒƒã‚¯ã«ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã§ Zod ã‚’è¶³ã™ã®ãŒç„¡é›£ã€‚  
>ã©ã¡ã‚‰ã‚’é¸ã‚“ã§ã‚‚ â€œå¾Œã§å·®ã—æ›¿ãˆã‚‰ã‚Œã‚‹â€ ã®ã§ã€ä»Šã®ãƒãƒ¼ãƒ ã®*ãƒ¡ãƒ³ãƒ†èƒ½åŠ›ã¨ç´æœŸ*ã§æ±ºã‚ã‚‹ã®ãŒæœ€é©è§£ã§ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/21 0:16:45*

TanStack Query ã®è‡ªå‹•ç”Ÿæˆã™ã‚‹æ©Ÿèƒ½ãŒã‚ã‚‹ã¨æ€ã†ãŒã€ hey-apiã¨penapi-typescriptã§ä½¿ã„æ–¹ã«å·®ãŒã‚ã‚‹ã ã‚ã†ã‹ã€‚ 

  https://github.com/openapi-ts/openapi-typescript

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/21 0:17:09*

### â€œTanStack Query ãƒ•ãƒƒã‚¯ã®â¾ƒå‹•â½£æˆâ€ã‚’â½è¼ƒã™ã‚‹è¦–ç‚¹

| è¦³ç‚¹ | **Hey API (+ `@tanstack/react-query` ãƒ—ãƒ©ã‚°ã‚¤ãƒ³)** | **openapi-typescript ç³»<br>ï¼ˆ`openapi-fetch` + `openapi-react-query`ï¼‰** |
|---|---|---|
| **å°å…¥** | `hey-api.config.ts` ã® `plugins` ã«<br>```'@tanstack/react-query'``` ã‚’ 1 è¡Œè¿½è¨˜ â†’ ç”Ÿæˆå®Œäº† | â¶ å‹ç”Ÿæˆ `openapi-typescript`<br>â· fetch ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”Ÿæˆ `openapi-fetch`<br>â¸ React Query ãƒ©ãƒƒãƒ‘ãƒ¼ç”Ÿæˆ `openapi-react-query` ã‚’æ‰‹å‹•ã§å‘¼ã³å‡ºã— |
| **ç”Ÿæˆã•ã‚Œã‚‹ API** | - **Options é–¢æ•° + ã‚µãƒˆãƒ©ãƒƒãƒ—**<br>  ```ts   useQuery({ â€¦getPetByIdOptions(params) })```<br>- `getPetByIdQueryKey()` ãªã©ã‚­ãƒ¼é–¢æ•°ã‚‚è‡ªå‹• | - **Hook ç›´æ¥**<br>  ```ts   $api.useQuery('get', '/pets/{id}', { params })```<br>ï¼ˆã‚­ãƒ¼ã¯å†…éƒ¨ã§ `[method, path, params]` ã‚’çµ„ã¿ç«‹ã¦ï¼‰ |
| **å‘½åè¦å‰‡ã‚«ã‚¹ã‚¿ãƒ ** | `queryOptionsNameBuilder` ãªã©å¤šæ•°ã®ãƒ“ãƒ«ãƒ€ãƒ¼é–¢æ•°ã§ãƒªãƒãƒ¼ãƒ å¯ | å¤‰æ›´ä¸å¯ï¼ˆmethod + path å½¢å¼å›ºå®šï¼‰ |
| **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯å¯¾å¿œ** | React / Vue / Svelte / Solid / Angular ã‚’ **åŒä¸€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å**ã§ç”Ÿæˆ | React å°‚ç”¨ï¼ˆReact Query hooks ã®ã¿ï¼‰ |
| **å­¦ç¿’ã‚³ã‚¹ãƒˆ** | â€œSDK â‡„ React Queryâ€ ã‚’æ©‹æ¸¡ã—ã™ã‚‹ **Options é–¢æ•°ãƒ¢ãƒ‡ãƒ«**ã‚’è¦šãˆã‚‹å¿…è¦ã‚ã‚Š | React Query ã‚’æ—¢ã«çŸ¥ã£ã¦ã„ã‚Œã° **ãã®ã¾ã¾ä½¿ãˆã‚‹** |
| **å‡ºåŠ›ã‚µã‚¤ã‚º** | SDK + Options + ã‚­ãƒ¼é–¢æ•° â‡’ **ã‚„ã‚„å¤§ãã„** (æ•° 10 kB) îˆ€citeîˆ‚turn1view0îˆ | fetch 6 kB + ãƒ©ãƒƒãƒ‘ãƒ¼ 1 kB â‡’ **æœ€å°** îˆ€citeîˆ‚turn2view0îˆ |
| **å®‰å®šåº¦** | ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ **Î²** è¡¨è¨˜ã€‚API å¤‰æ›´ã®å¯èƒ½æ€§ã‚ã‚Š îˆ€citeîˆ‚turn1view0îˆ | OSS æœ¬ä½“ã¯ 2022 å¹´ã‹ã‚‰ç¶™ç¶šé–‹ç™ºã€‚æ¯”è¼ƒçš„å®‰å®š |
| **ç”Ÿæˆç‰©ã®ç²’åº¦** | Query/Mutation ã ã‘ã§ãªã **QueryKey é–¢æ•°**ãƒ»**InfiniteQueryOptions** ã‚‚ä¸€ç·’ã«å‡ºåŠ› | Hook ã ã‘ï¼ˆã‚­ãƒ¼é–¢æ•°ã¯è‡ªå‰ã§çµ„ã¿ç«‹ã¦ã‚‹ or å–å¾—ä¸å¯ï¼‰ |

---

## ä½¿ã„â½…ã®ã€Œå‹ã€ã‚¤ãƒ¡ãƒ¼ã‚¸

### 1. Hey API ç‰ˆï¼ˆOptions ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰

```ts
// ç”Ÿæˆç‰©: getPetByIdOptions(), addPetMutation() ãªã©

const { data, error } = useQuery({
  ...getPetByIdOptions({ path: { petId: 1 } }),
});

const addPet = useMutation({
  ...addPetMutation(),
});
addPet.mutate({ body: { name: 'Kitty' } });
```

*Options é–¢æ•°*ãŒ **queryKey, queryFn, meta** ã‚’ä¸€æ‹¬ã§è¿”ã™ãŸã‚  
`useQuery({...options})` ã«ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã™ã‚‹ã ã‘ã§å®Œçµã€‚

---

### 2. openapi-typescript ç‰ˆï¼ˆHook ç›´æ¥å‘¼ã³å‡ºã—ï¼‰

```ts
// æ‰‹å‹•: fetchClient â†’ $api = createClient(fetchClient)

const { data, error } = $api.useQuery(
  'get',
  '/pets/{id}',
  { params: { path: { id: 1 } } }
);

const addPet = $api.useMutation(
  'post',
  '/pets',
  { body: { name: 'Kitty' } }
);
```

method + path ã§è­˜åˆ¥ã™ã‚‹ **ç´ ç›´ãªæ›¸ãæ–¹**ã€‚  
ã‚­ãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å ´åˆã¯ `[method, path, params]` ã‚’å†æ§‹æˆã™ã‚‹ã‹  
`queryKey` ã‚’è‡ªå‰ã§ç®¡ç†ã€‚

---

## ã©ã¡ã‚‰ã‚’é¸ã¶ï¼Ÿã–ã£ãã‚ŠæŒ‡é‡

| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçŠ¶æ³ | ç›¸æ€§ãŒè‰¯ã„ã®ã¯â€¦ |
|------------------|----------------|
| **è¤‡æ•°ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆReact + Vue ãªã©ï¼‰ã¸åŒã˜ SDK ã‚’é…ã‚ŠãŸã„** | **Hey API** â€” åŒã˜è¨­å®šã§åˆ¥ Target ã‚’é‡ç”£ |
| **QueryKey ã‚’ãƒ«ãƒ¼ã‚¿ãƒ¼ Prefetch / ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ“ä½œã«å¤šç”¨** | **Hey API** â€” `*_QueryKey()` ãŒè‡ªå‹•ç”Ÿæˆ |
| **React ã ã‘ & æ—¢ã« React Query ã«æ…£ã‚Œã¦ã„ã‚‹** | **openapi-fetch / openapi-react-query** â€” å­¦ç¿’ã‚¼ãƒ­ã§å°å…¥ |
| **ãƒãƒ³ãƒ‰ãƒ«ã‚’ 1 ãƒã‚¤ãƒˆã§ã‚‚å‰Šã‚ŠãŸã„ / Î² ã‚’é¿ã‘ãŸã„** | **openapi-typescript ç³»** |

---

### è£œè¶³ï¼šä½µç”¨ãƒ»ä¹—ã‚Šæ›ãˆã‚‚å¯èƒ½

- **Hey API ã§ç”Ÿæˆã—ãŸå‹ï¼SDK** ã¯ **ãƒ—ãƒ¬ãƒ¼ãƒ³ TS** ãªã®ã§ã€  
  å¾Œã‹ã‚‰ `openapi-react-query` ã‚’å°å…¥ã—ã¦ *hook ã ã‘* å·®ã—æ›¿ãˆã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚  
- é€†ã« **æ—¢å­˜ openapi-fetch ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**ã« Hey API ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å‡ºåŠ›ã‚’è¿½åŠ ã—ã€  
  â€œQueryKey é–¢æ•°ã ã‘æ‹å€Ÿâ€ ã¨ã„ã£ãŸ **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰**ã‚‚å•é¡Œãªãå‹•ãã¾ã™ã€‚

> **ã¾ã¨ã‚**  
> - **è‡ªå‹•ç”Ÿæˆç‰©ã‚’æœ€å¤§é™æ´»ã‹ã— â€œè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§å®Œçµâ€** ã•ã›ãŸã„ â‡’ Hey APIã€‚  
> - **è»½é‡ãƒ»ã‚·ãƒ³ãƒ—ãƒ«ãƒ»React å°‚â½¤ã§ OK** â‡’ openapi-typescript + openapi-react-queryã€‚  
> ã©ã¡ã‚‰ã‚‚ TanStack Query ã®ã‚³ã‚¢ API ã‚’ç›´æ¥å‘¼ã¶ã‚ã‘ã§ã¯ãªã„ã®ã§ã€**QueryClient / DevTools ã®ä½¿ã„â½…ã¯å…±é€š**ã§ã™ã€‚

---

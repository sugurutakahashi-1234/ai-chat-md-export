# 月単位のスクロール固定

Date: 2024-07-26

---

## 👤 User
*2024-07-26 10:29:17*

SwiftUIのスクロールするような画面で日付を持つstructを月単位にまとめてスクロールする際にその該当月を左上に残し続けたい。

どうすれば良いのか？

---

## 🤖 Assistant
*2024-07-26 10:29:31*

SwiftUIでスクロールする画面において、日付を持つstructを月単位にまとめ、該当月を左上に固定するためには、`ScrollViewReader`と`LazyVStack`を組み合わせて使用すると効果的です。以下はその実装例です。

### 1. データモデルの定義
```swift
struct Event: Identifiable {
    let id = UUID()
    let date: Date
    let description: String
}
```

### 2. 月単位にグループ化するためのヘルパー関数
```swift
extension Date {
    var monthYear: String {
        let dateFormatter = DateFormatter()
        dateFormatter.dateFormat = "MMMM yyyy"
        return dateFormatter.string(from: self)
    }
}

func groupEventsByMonth(events: [Event]) -> [String: [Event]] {
    let grouped = Dictionary(grouping: events) { $0.date.monthYear }
    return grouped
}
```

### 3. ビューの実装
```swift
import SwiftUI

struct ContentView: View {
    let events: [Event] = [
        // Eventの配列をここに定義
    ]
    
    var body: some View {
        let groupedEvents = groupEventsByMonth(events: events)
        
        ScrollViewReader { scrollView in
            ScrollView {
                LazyVStack(alignment: .leading, pinnedViews: [.sectionHeaders]) {
                    ForEach(groupedEvents.keys.sorted(), id: \.self) { month in
                        Section(header: Text(month)
                                    .font(.headline)
                                    .padding()
                                    .background(Color(.systemGray6))
                                    .id(month)) {
                            ForEach(groupedEvents[month]!) { event in
                                Text(event.description)
                                    .padding()
                                    .background(Color(.systemBackground))
                                    .cornerRadius(8)
                                    .shadow(radius: 2)
                                    .padding(.horizontal)
                            }
                        }
                    }
                }
            }
            .onAppear {
                // 初回表示時に特定の月にスクロールする場合の例
                if let firstMonth = groupedEvents.keys.sorted().first {
                    scrollView.scrollTo(firstMonth, anchor: .top)
                }
            }
        }
    }
}
```

### ポイント

1. **`ScrollViewReader`と`ScrollView`の組み合わせ**:
    - `ScrollViewReader`を使うことで、スクロール位置をプログラム的に制御することができます。

2. **`LazyVStack`と`Section`の使用**:
    - `LazyVStack`の`pinnedViews`プロパティに`.sectionHeaders`を設定することで、セクションヘッダー（この場合は月）がスクロールに対して固定されるようになります。

3. **`groupEventsByMonth`関数**:
    - イベントを月単位にグループ化します。

4. **初回表示時に特定の月にスクロール**:
    - `.onAppear`内で`scrollView.scrollTo`を使用して、初回表示時に特定の月にスクロールすることができます。

この実装により、月ごとにイベントをまとめて表示し、該当月のヘッダーを固定しながらスクロールするUIを実現できます。

---

## 👤 User
*2024-07-26 10:59:28*

ScrollViewReader はなんのために使っていますか？

---

## 🤖 Assistant
*2024-07-26 10:59:44*

ご指摘ありがとうございます。この例では、`ScrollViewReader`は特定の月にスクロールするために使っていますが、質問に対する要件を満たすためには必須ではありません。質問では該当月のヘッダーを固定し続けることが求められているため、`ScrollViewReader`は不要です。

以下は、`ScrollViewReader`を使わずに該当月を左上に固定し続ける実装例です。

### 1. データモデルの定義
```swift
struct Event: Identifiable {
    let id = UUID()
    let date: Date
    let description: String
}
```

### 2. 月単位にグループ化するためのヘルパー関数
```swift
extension Date {
    var monthYear: String {
        let dateFormatter = DateFormatter()
        dateFormatter.dateFormat = "MMMM yyyy"
        return dateFormatter.string(from: self)
    }
}

func groupEventsByMonth(events: [Event]) -> [String: [Event]] {
    let grouped = Dictionary(grouping: events) { $0.date.monthYear }
    return grouped
}
```

### 3. ビューの実装
```swift
import SwiftUI

struct ContentView: View {
    let events: [Event] = [
        // Eventの配列をここに定義
    ]
    
    var body: some View {
        let groupedEvents = groupEventsByMonth(events: events)
        
        ScrollView {
            LazyVStack(alignment: .leading, pinnedViews: [.sectionHeaders]) {
                ForEach(groupedEvents.keys.sorted(), id: \.self) { month in
                    Section(header: Text(month)
                                .font(.headline)
                                .padding()
                                .background(Color(.systemGray6))) {
                        ForEach(groupedEvents[month]!) { event in
                            Text(event.description)
                                .padding()
                                .background(Color(.systemBackground))
                                .cornerRadius(8)
                                .shadow(radius: 2)
                                .padding(.horizontal)
                        }
                    }
                }
            }
        }
    }
}
```

### ポイント

1. **`ScrollView`と`LazyVStack`の組み合わせ**:
    - `ScrollView`でコンテンツ全体をスクロール可能にし、`LazyVStack`で効率的にレイアウトします。

2. **`Section`と`pinnedViews`プロパティの使用**:
    - `LazyVStack`の`pinnedViews`プロパティに`.sectionHeaders`を設定することで、各セクションのヘッダー（月）がスクロール時に上部に固定されるようになります。

3. **`groupEventsByMonth`関数**:
    - イベントを月単位にグループ化します。

これにより、月ごとにイベントをまとめて表示し、該当月のヘッダーをスクロール時に左上に固定し続けるUIを実現できます。

---

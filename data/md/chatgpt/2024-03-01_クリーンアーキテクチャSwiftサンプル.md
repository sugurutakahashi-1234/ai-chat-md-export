# ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£Swiftã‚µãƒ³ãƒ—ãƒ«

æ—¥ä»˜: 2024-03-01

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/3/1 13:24:20*

ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ãƒ†ã‚¯ãƒãƒ£ãƒ¼ã® sampleã‚¢ãƒ—ãƒªã‚’Swiftã§è€ƒãˆã¦ã„ã‚‹ã€‚

äºŒã¤ã®ãƒ‰ãƒ©ã‚¤ãƒãƒ¼(ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼)ã‚’ä½¿ã£ãŸUseCaseã®ã‚³ãƒ¼ãƒ‰ã‚’è€ƒãˆã¦ã„ã‚‹ã®ã ã‘ã‚Œã§ã‚‚ã€ã‚·ãƒ³ãƒ—ãƒ«ãªå€™è£œã‚’è€ƒãˆã¦ã»ã—ã„ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/3/1 13:25:17*

ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ãƒ†ã‚¯ãƒãƒ£ãƒ¼ã‚’Swiftã§å®Ÿè£…ã™ã‚‹éš›ã«ã€2ã¤ã®ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ï¼ˆä¾‹ãˆã°ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªUseCaseã®ã‚µãƒ³ãƒ—ãƒ«ã‚’è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã“ã®ä¾‹ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã—ã¦è¡¨ç¤ºã™ã‚‹åŸºæœ¬çš„ãªæ©Ÿèƒ½ã‚’æƒ³å®šã—ã¾ã™ã€‚

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ§‹é€ 

- **Entities**: ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆä¾‹: Userï¼‰
- **Use Cases**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆä¾‹: FetchUserInfoUseCaseï¼‰
- **Interface Adapters**: ãƒ‡ãƒ¼ã‚¿å¤‰æ›ã‚„ãƒ—ãƒ¬ã‚¼ãƒ³ã‚¿ãƒ¼ï¼ˆä¾‹: UserPresenterï¼‰
- **Frameworks & Drivers**: å¤–éƒ¨ã¨ã®é€šä¿¡ã‚„ãƒ‡ãƒ¼ã‚¿ç®¡ç†ï¼ˆä¾‹: DatabaseManager, NetworkManagerï¼‰

### ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—

#### 1. Entitiesã®å®šç¾©

```swift
struct User {
    let id: Int
    let name: String
    let email: String
}
```

#### 2. ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®å®šç¾©

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ“ä½œã®ãŸã‚ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’å®šç¾©ã—ã¾ã™ã€‚

```swift
protocol UserDataRepository {
    func fetchUserFromDB(completion: @escaping (User?) -> Void)
    func fetchUserFromNetwork(completion: @escaping (User?) -> Void)
}
```

#### 3. Use Caseã®å®Ÿè£…

ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã™ã‚‹UseCaseã‚’å®Ÿè£…ã—ã¾ã™ã€‚ã¾ãšã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã—ã€ãã‚ŒãŒå¤±æ•—ã—ãŸå ´åˆã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰å–å¾—ã—ã¾ã™ã€‚

```swift
class FetchUserInfoUseCase {
    private let repository: UserDataRepository
    
    init(repository: UserDataRepository) {
        self.repository = repository
    }
    
    func execute(completion: @escaping (User?) -> Void) {
        repository.fetchUserFromDB { user in
            if let user = user {
                completion(user)
            } else {
                self.repository.fetchUserFromNetwork(completion: completion)
            }
        }
    }
}
```

#### 4. ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã®å®Ÿè£…

`UserDataRepository`ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«å¾“ã£ã¦ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

```swift
class DataManager: UserDataRepository {
    func fetchUserFromDB(completion: @escaping (User?) -> Void) {
        // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯
        // ä¾‹: completion(User(id: 1, name: "John Doe", email: "john@example.com"))
    }
    
    func fetchUserFromNetwork(completion: @escaping (User?) -> Void) {
        // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯
        // ä¾‹: completion(User(id: 1, name: "John Doe", email: "john@example.com"))
    }
}
```

#### 5. Use Caseã®ä½¿ç”¨

æœ€å¾Œã«ã€UseCaseã‚’å®Ÿéš›ã«ä½¿ç”¨ã—ã¦ã¿ã¾ã™ã€‚ä¾‹ãˆã°ã€ã‚ã‚‹ViewControllerã‹ã‚‰ã“ã®UseCaseã‚’å‘¼ã³å‡ºã™å ´åˆã§ã™ã€‚

```swift
class UserViewController: UIViewController {
    var useCase: FetchUserInfoUseCase!
    
    override func viewDidLoad() {
        super.viewDidLoad()
        
        let dataManager = DataManager()
        self.useCase = FetchUserInfoUseCase(repository: dataManager)
        
        useCase.execute { [weak self] user in
            DispatchQueue.main.async {
                // UIã‚’æ›´æ–°ã™ã‚‹
                // ä¾‹: self?.nameLabel.text = user?.name
            }
        }
    }
}
```

ã“ã®ã‚µãƒ³ãƒ—ãƒ«ã¯ã€ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®åŸºæœ¬çš„ãªæ¦‚å¿µã‚’Swiftã§å®Ÿè£…ã—ãŸã‚‚ã®ã§ã™ã€‚å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€éåŒæœŸå‡¦ç†ã®è©³ç´°ã€ä¾å­˜æ€§æ³¨å…¥ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ä½¿ç”¨ãªã©ã€ã•ã‚‰ã«å¤šãã®è€ƒæ…®ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/3/1 13:30:24*

ã„ã„æ¡ˆã ã­ã€‚
SwiftUIã®MVVMã§VMã®ã‚¤ãƒ‹ã‚·ãƒ£ãƒ©ã‚¤ã‚¶ã§
Firebase remote configå–å¾—ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ¤å®šãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’æ¸¡ã—ã¦ã€
å¼·åˆ¶ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆåˆ¤å®šã‚’è¡Œã£ã¦ã»ã—ã„

å„ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¯protocolã‚’ä½œã£ã¦ã»ã—ã„ã€‚
Viewå´ã§ã¯å¼·åˆ¶ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒå¿…è¦ã§ã‚ã‚Œã°å¼·åˆ¶ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒå¿…è¦ã§ã™ã¨ã„ã†æ–‡è¨€ã‚’è¡¨ç¤ºã—ã¦ã€å¿…è¦ã§ãªã‘ã‚Œã°å¼·åˆ¶ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã¯å¿…è¦ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã¨è¡¨ç¤ºã—ã¦ã»ã—ã„ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/3/1 13:31:11*

SwiftUIã¨MVVMã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’ä½¿ç”¨ã—ã¦ã€Firebase Remote Configã¨ã‚¢ãƒ—ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹å¼·åˆ¶ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚ã¾ãšã€Firebase Remote Configå–å¾—ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ¤å®šãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã®ãŸã‚ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’å®šç¾©ã—ã€ãã‚Œã‹ã‚‰ViewModelã§ã“ã‚Œã‚‰ã®ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’ä½¿ç”¨ã—ã¦å¼·åˆ¶ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒå¿…è¦ã‹ã©ã†ã‹ã‚’åˆ¤å®šã—ã¾ã™ã€‚æœ€å¾Œã«ã€Viewå´ã§ã“ã®åˆ¤å®šçµæœã«åŸºã¥ã„ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

### Step 1: ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®å®šç¾©

#### Firebase Remote Configãƒ‰ãƒ©ã‚¤ãƒãƒ¼

```swift
protocol FirebaseRemoteConfigFetching {
    func fetchRemoteConfig(completion: @escaping (Result<String, Error>) -> Void)
}
```

#### ã‚¢ãƒ—ãƒªãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ¤å®šãƒ‰ãƒ©ã‚¤ãƒãƒ¼

```swift
protocol AppVersionChecking {
    func getCurrentAppVersion() -> String
    func getMinimumSupportedVersion(completion: @escaping (String) -> Void)
}
```

### Step 2: ViewModelã®å®Ÿè£…

ViewModelã§ã¯ã€ã“ã‚Œã‚‰ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã—ã¦å¼·åˆ¶ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒå¿…è¦ã‹ã©ã†ã‹ã‚’åˆ¤å®šã—ã¾ã™ã€‚

```swift
import Foundation
import Combine

class UpdateViewModel: ObservableObject {
    @Published var updateMessage: String = ""
    
    private var firebaseRemoteConfigFetcher: FirebaseRemoteConfigFetching
    private var appVersionChecker: AppVersionChecking
    
    init(firebaseRemoteConfigFetcher: FirebaseRemoteConfigFetching, appVersionChecker: AppVersionChecking) {
        self.firebaseRemoteConfigFetcher = firebaseRemoteConfigFetcher
        self.appVersionChecker = appVersionChecker
        checkForForcedUpdate()
    }
    
    private func checkForForcedUpdate() {
        appVersionChecker.getMinimumSupportedVersion { [weak self] minimumVersion in
            let currentVersion = self?.appVersionChecker.getCurrentAppVersion() ?? ""
            if currentVersion.compare(minimumVersion, options: .numeric) == .orderedAscending {
                // ç¾åœ¨ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹æœ€å°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚ˆã‚Šã‚‚å°ã•ã„å ´åˆ
                DispatchQueue.main.async {
                    self?.updateMessage = "å¼·åˆ¶ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒå¿…è¦ã§ã™"
                }
            } else {
                // ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒå¿…è¦ãªã„å ´åˆ
                DispatchQueue.main.async {
                    self?.updateMessage = "å¼·åˆ¶ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã¯å¿…è¦ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚"
                }
            }
        }
    }
}
```

### Step 3: Viewã®å®Ÿè£…

ViewModelã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é©åˆ‡ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

```swift
import SwiftUI

struct UpdateView: View {
    @StateObject var viewModel: UpdateViewModel
    
    var body: some View {
        Text(viewModel.updateMessage)
            .onAppear() {
                // ViewModelã®åˆæœŸåŒ–ã‚„ãã®ä»–ã®ãƒ­ã‚¸ãƒƒã‚¯ãŒå¿…è¦ãªå ´åˆã¯ã“ã“ã«è¨˜è¿°
            }
    }
}
```

### Step 4: ViewModelã¨Viewã®æ¥ç¶š

å®Ÿéš›ã«ViewModelã‚’Viewã«æ¥ç¶šã™ã‚‹ãŸã‚ã«ã€é©åˆ‡ãªãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã®å®Ÿè£…ã‚’æä¾›ã—ã€ViewModelã‚’åˆæœŸåŒ–ã—ã¦Viewã«æ¸¡ã—ã¾ã™ã€‚ã“ã®éƒ¨åˆ†ã¯ã‚¢ãƒ—ãƒªã®èµ·å‹•ãƒ­ã‚¸ãƒƒã‚¯ã‚„ä¾å­˜æ€§æ³¨å…¥ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã«ä¾å­˜ã—ã¾ã™ãŒã€åŸºæœ¬çš„ãªã‚¢ã‚¤ãƒ‡ã‚¢ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```swift
// FirebaseRemoteConfigFetcherã¨AppVersionCheckerã®å…·ä½“çš„ãªå®Ÿè£…ã‚’æä¾›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
let firebaseRemoteConfigFetcher = FirebaseRemoteConfigFetcherImpl()
let appVersionChecker = AppVersionCheckerImpl()

// ViewModelã®åˆæœŸåŒ–
let updateViewModel = UpdateViewModel(firebaseRemoteConfigFetcher: firebaseRemoteConfigFetcher, appVersionChecker: appVersionChecker)

// Viewã®åˆæœŸåŒ–ã¨ViewModelã®æ³¨å…¥
let updateView = UpdateView(viewModel: updateViewModel)
```

ã“ã®ä¾‹ã§ã¯ã€`FirebaseRemoteConfigFetcherImpl`ã¨`AppVersionCheckerImpl`ã¯ã€ãã‚Œãã‚Œ`FirebaseRemoteConfigFetching`ã¨`AppVersionChecking`ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®å…·ä½“çš„ãªå®Ÿè£…ã‚’æä¾›ã™ã‚‹ã‚¯ãƒ©ã‚¹ã§ã™ã€‚ã“ã‚Œã‚‰ã®ã‚¯ãƒ©ã‚¹ã¯Firebase Remote Configã®APIã¨ã‚¢ãƒ—ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã‚’æ‰±ã†ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã‚ˆã‚Šã€SwiftUIã¨MVVMã‚’ä½¿ç”¨ã—ã¦ã€ã‚¢ãƒ—ãƒªå†…ã§å¼·åˆ¶ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã«å®Ÿè£…ã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/3/1 14:12:37*

ã¡ã‚‡ã£ã¨ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒé•ã†ã€‚
ãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ¤å®šãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ¤å®šå‡¦ç†ã®ã¿ã§å–å¾—ã¯ã§ããªã„ã€‚
ã‚€ã—ã‚ãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¯ãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ³ãƒ•ã‚£ã‚°ã®å–å¾—ã—ã‹ã§ããªã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/3/1 14:13:52*

äº†è§£ã—ã¾ã—ãŸã€‚ãã‚Œã§ã¯ã€Firebase Remote Configã‹ã‚‰æœ€å°ã‚µãƒãƒ¼ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å–å¾—ã™ã‚‹ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¨ã€ã‚¢ãƒ—ãƒªã®ç¾åœ¨ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’åˆ¤æ–­ã™ã‚‹ã ã‘ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ¤å®šãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã«åˆ†ã‘ã¦ã€ãã‚Œãã‚Œã®å½¹å‰²ã‚’æ˜ç¢ºã«åˆ†é›¢ã—ã¾ã—ã‚‡ã†ã€‚

### Step 1: ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®å†å®šç¾©

#### Firebase Remote Configãƒ‰ãƒ©ã‚¤ãƒãƒ¼

```swift
protocol FirebaseRemoteConfigFetching {
    func fetchMinimumSupportedVersion(completion: @escaping (Result<String, Error>) -> Void)
}
```

#### ã‚¢ãƒ—ãƒªãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ¤å®šãƒ‰ãƒ©ã‚¤ãƒãƒ¼

```swift
protocol AppVersionChecking {
    func isUpdateRequired(currentVersion: String, minimumSupportedVersion: String) -> Bool
}
```

### Step 2: ViewModelã®å†å®Ÿè£…

ViewModelã§ã€Firebase Remote Configã‹ã‚‰å–å¾—ã—ãŸæœ€å°ã‚µãƒãƒ¼ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ç¾åœ¨ã®ã‚¢ãƒ—ãƒªãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ¯”è¼ƒã—ã¦ã€ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒå¿…è¦ã‹ã©ã†ã‹ã‚’åˆ¤æ–­ã—ã¾ã™ã€‚

```swift
import Foundation
import Combine

class UpdateViewModel: ObservableObject {
    @Published var updateMessage: String = ""
    
    private var firebaseRemoteConfigFetcher: FirebaseRemoteConfigFetching
    private var appVersionChecker: AppVersionChecking
    
    init(firebaseRemoteConfigFetcher: FirebaseRemoteConfigFetching, appVersionChecker: AppVersionChecking) {
        self.firebaseRemoteConfigFetcher = firebaseRemoteConfigFetcher
        self.appVersionChecker = appVersionChecker
        checkForForcedUpdate()
    }
    
    private func checkForForcedUpdate() {
        firebaseRemoteConfigFetcher.fetchMinimumSupportedVersion { [weak self] result in
            switch result {
            case .success(let minimumVersion):
                let currentVersion = Bundle.main.object(forInfoDictionaryKey: "CFBundleShortVersionString") as? String ?? ""
                if self?.appVersionChecker.isUpdateRequired(currentVersion: currentVersion, minimumSupportedVersion: minimumVersion) == true {
                    DispatchQueue.main.async {
                        self?.updateMessage = "å¼·åˆ¶ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒå¿…è¦ã§ã™"
                    }
                } else {
                    DispatchQueue.main.async {
                        self?.updateMessage = "å¼·åˆ¶ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã¯å¿…è¦ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚"
                    }
                }
            case .failure(_):
                DispatchQueue.main.async {
                    self?.updateMessage = "ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚"
                }
            }
        }
    }
}
```

### Step 3: Viewã®å®Ÿè£…

ViewModelã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é©åˆ‡ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

```swift
import SwiftUI

struct UpdateView: View {
    @StateObject var viewModel = UpdateViewModel(
        firebaseRemoteConfigFetcher: FirebaseRemoteConfigFetcherImpl(),
        appVersionChecker: AppVersionCheckerImpl()
    )
    
    var body: some View {
        Text(viewModel.updateMessage)
    }
}
```

### ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã®å…·ä½“çš„ãªå®Ÿè£…

Firebase Remote Configã¨ã‚¢ãƒ—ãƒªãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ¤å®šã®å…·ä½“çš„ãªå®Ÿè£…ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¦ä»¶ã‚„Firebase SDKã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚ˆã£ã¦ç•°ãªã‚Šã¾ã™ã€‚ä»¥ä¸‹ã¯ã€ãã‚Œãã‚Œã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«å¯¾ã™ã‚‹ç°¡å˜ãªå®Ÿè£…ä¾‹ã§ã™ã€‚

#### Firebase Remote Configãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã®å®Ÿè£…ä¾‹

Firebase Remote Configã‹ã‚‰æœ€å°ã‚µãƒãƒ¼ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å–å¾—ã™ã‚‹å®Ÿè£…ã§ã™ã€‚Firebase SDKã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¨Remote Configã®è¨­å®šãŒå¿…è¦ã§ã™ã€‚

```swift
class FirebaseRemoteConfigFetcherImpl: FirebaseRemoteConfigFetching {
    func fetchMinimumSupportedVersion(completion: @escaping (Result<String, Error>) -> Void) {
        // Firebase Remote Configã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¨æœ€å°ã‚µãƒãƒ¼ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®å–å¾—ãƒ­ã‚¸ãƒƒã‚¯
    }
}
```

#### ã‚¢ãƒ—ãƒªãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ¤å®šãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã®å®Ÿè£…ä¾‹

```swift
class AppVersionCheckerImpl: AppVersionChecking {
    func isUpdateRequired(currentVersion: String, minimumSupportedVersion: String) -> Bool {
        return currentVersion.compare(minimumSupportedVersion, options: .numeric) == .orderedAscending
    }
}
```

ã“ã®è¨­è¨ˆã«ã‚ˆã‚Šã€å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è²¬å‹™ãŒæ˜ç¢ºã«åˆ†é›¢ã•ã‚Œã€ãƒ†ã‚¹ãƒˆã‚„ä¿å®ˆãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚ã¾ãŸã€å°†æ¥çš„ã«ç•°ãªã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã‚„è¨­å®šå–å¾—æ–¹æ³•ã«å¤‰æ›´ãŒã‚ã£ãŸå ´åˆã§ã‚‚ã€å½±éŸ¿ç¯„å›²ã‚’æœ€å°é™ã«æŠ‘ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/3/1 16:19:39*

ãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ¤å®šãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¯2ã¤ã®æ–‡å­—åˆ—ã‚’æ¯”è¼ƒã—ã¦ã€ãã‚ŒãŒenumã§å¤§ãã„ å°ã•ã„ åŒã˜ã®3ã¤ã®ç¨®é¡ã‚’è¿”ã™ã‚ˆã†ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã€ã‚‚ã—ãã¯ã‚³ãƒ³ãƒšã‚¢ãƒ–ãƒ«ãªå‹ã«å¤‰æ›ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/3/1 16:20:04*

äº†è§£ã—ã¾ã—ãŸã€‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ¤å®šãƒ‰ãƒ©ã‚¤ãƒãƒ¼ãŒ2ã¤ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ–‡å­—åˆ—ã‚’æ¯”è¼ƒã—ã¦ã€ãã®çµæœã‚’ã€Œå¤§ãã„ã€ã€Œå°ã•ã„ã€ã€ŒåŒã˜ã€ã®3ã¤ã®çŠ¶æ…‹ã‚’æŒã¤enumã§è¿”ã™ã‚ˆã†ã«è¨­è¨ˆã—ç›´ã—ã¾ã—ã‚‡ã†ã€‚ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã‚ˆã‚Šã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ¯”è¼ƒã®çµæœã‚’ã‚ˆã‚Šæ˜ç¢ºã«æ‰±ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

### Step 1: ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ¯”è¼ƒçµæœã®Enumå®šç¾©

ã¾ãšã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ¯”è¼ƒã®çµæœã‚’è¡¨ã™enumã‚’å®šç¾©ã—ã¾ã™ã€‚

```swift
enum VersionComparisonResult {
    case older
    case same
    case newer
}
```

### Step 2: ãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ¤å®šãƒ‰ãƒ©ã‚¤ãƒãƒ¼ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®æ›´æ–°

ãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ¤å®šãƒ‰ãƒ©ã‚¤ãƒãƒ¼ãŒ2ã¤ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ–‡å­—åˆ—ã‚’æ¯”è¼ƒã—ã€`VersionComparisonResult` enumã‚’è¿”ã™ã‚ˆã†ã«ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’æ›´æ–°ã—ã¾ã™ã€‚

```swift
protocol AppVersionChecking {
    func compareVersions(currentVersion: String, minimumSupportedVersion: String) -> VersionComparisonResult
}
```

### Step 3: ãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ¤å®šãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã®å…·ä½“çš„ãªå®Ÿè£…

æ¬¡ã«ã€`AppVersionChecking` ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«å¾“ã£ã¦ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ–‡å­—åˆ—ã‚’æ¯”è¼ƒã™ã‚‹å…·ä½“çš„ãªãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

```swift
class AppVersionCheckerImpl: AppVersionChecking {
    func compareVersions(currentVersion: String, minimumSupportedVersion: String) -> VersionComparisonResult {
        let currentVersionArray = currentVersion.split(separator: ".").compactMap { Int($0) }
        let minimumVersionArray = minimumSupportedVersion.split(separator: ".").compactMap { Int($0) }
        
        for (current, minimum) in zip(currentVersionArray, minimumVersionArray) {
            if current < minimum {
                return .older
            } else if current > minimum {
                return .newer
            }
        }
        
        if currentVersionArray.count < minimumVersionArray.count {
            return .older
        } else if currentVersionArray.count > minimumVersionArray.count {
            return .newer
        }
        
        return .same
    }
}
```

### Step 4: ViewModelã®æ›´æ–°

ViewModelå†…ã§ã€ã“ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ¤å®šãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã€ã‚¢ãƒ—ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒFirebase Remote Configã§è¨­å®šã•ã‚ŒãŸæœ€å°ã‚µãƒãƒ¼ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚ˆã‚Šå¤ã„ã‹ã©ã†ã‹ã‚’åˆ¤æ–­ã—ã€é©åˆ‡ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¡¨ç¤ºã—ã¾ã™ã€‚

```swift
private func checkForForcedUpdate() {
    firebaseRemoteConfigFetcher.fetchMinimumSupportedVersion { [weak self] result in
        switch result {
        case .success(let minimumVersion):
            let currentVersion = Bundle.main.object(forInfoDictionaryKey: "CFBundleShortVersionString") as? String ?? ""
            let comparisonResult = self?.appVersionChecker.compareVersions(currentVersion: currentVersion, minimumSupportedVersion: minimumVersion)
            
            DispatchQueue.main.async {
                switch comparisonResult {
                case .older:
                    self?.updateMessage = "å¼·åˆ¶ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒå¿…è¦ã§ã™"
                case .same, .newer, .none:
                    self?.updateMessage = "å¼·åˆ¶ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã¯å¿…è¦ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚"
                }
            }
        case .failure(_):
            DispatchQueue.main.async {
                self?.updateMessage = "ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚"
            }
        }
    }
}
```

### Step 5: Viewã®å®Ÿè£…

ViewModelã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é©åˆ‡ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚ã“ã®éƒ¨åˆ†ã¯å‰è¿°ã®ä¾‹ã¨åŒæ§˜ã§ã™ã€‚

ã“ã®è¨­è¨ˆã«ã‚ˆã‚Šã€ã‚¢ãƒ—ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒæœ€å°ã‚µãƒãƒ¼ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚ˆã‚Šå¤ã„ã€æ–°ã—ã„ã€ã¾ãŸã¯åŒã˜ã§ã‚ã‚‹ã‹ã‚’ã‚ˆã‚Šæ˜ç¢ºã«åˆ¤æ–­ã§ãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¯¾ã—ã¦é©åˆ‡ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä¿ƒã™ã“ã¨ãŒã§ãã¾ã™ã€‚

---

# ホームバー非表示、セーフエリア無視

Date: 2023-07-02

---

## 👤 User
*2023-07-02 21:13:29*

SwiftUIで動画を表示する画面があるがホームバーを消したいのと、セーフエリアを考慮しないようにしたい。

---

## 🤖 Assistant
*2023-07-02 21:14:08*

SwiftUIを使用してフルスクリーンの動画を表示するには、最初に`AVPlayer`と`AVPlayerLayer`を使用して動画を読み込み、それを表示する`UIViewRepresentable`を作成します。その後、`.edgesIgnoringSafeArea(.all)`を使用してセーフエリアを無視し、`UIApplication.shared.isStatusBarHidden`を使用してステータスバーを隠すことができます。

以下にその例を示します。

```swift
import SwiftUI
import AVKit

struct ContentView: View {
    @State var player: AVPlayer = AVPlayer(url: URL(fileURLWithPath: "path_to_your_video"))
    
    var body: some View {
        VideoPlayer(player: self.player)
            .edgesIgnoringSafeArea(.all)
            .onAppear {
                self.player.play()
                hideHomeIndicator()
            }
    }
    
    func hideHomeIndicator() {
        if let window = UIApplication.shared.windows.first {
            window.rootViewController?.prefersHomeIndicatorAutoHidden = true
            window.rootViewController?.setNeedsUpdateOfHomeIndicatorAutoHidden()
        }
    }
}

struct VideoPlayer: UIViewRepresentable {
    var player: AVPlayer

    func updateUIView(_ uiView: UIView, context: UIViewRepresentableContext<VideoPlayer>) {
        (uiView.layer as! AVPlayerLayer).player = player
    }

    func makeUIView(context: Context) -> UIView {
        let view = UIView()
        let layer = AVPlayerLayer()
        layer.player = player
        layer.videoGravity = .resizeAspectFill
        view.layer.addSublayer(layer)
        layer.frame = view.bounds
        return view
    }
}
```

このコードは動画をフルスクリーンで表示し、ホームバーを隠します。ただし、ビデオが終了したときにプレイヤーを一時停止するなど、プレイヤーの動作を自分で制御する必要があります。

また、以下に示す方法でホームバーを制御するにはiOS 13以降が必要です。それより前のバージョンではホームバーを制御する方法がありません。

注意: 状況により異なるが、ユーザーインターフェース要素を隠すと、ユーザーが混乱する可能性があるため注意が必要です。

---

## 👤 User
*2023-07-02 21:14:40*

Zstackで他にも Viewを重ねているんだ

---

## 🤖 Assistant
*2023-07-02 21:15:21*

ZStackを使って複数のViewを重ねている場合でも、.edgesIgnoringSafeArea(.all) を ZStack 内の個々のViewではなく、ZStack 全体に適用することで、全ての子Viewがセーフエリアを無視します。

また、ホームインジケータを非表示にする設定も影響はZStack全体に適用されます。

以下にその例を示します。

```swift
import SwiftUI
import AVKit

struct ContentView: View {
    @State var player: AVPlayer = AVPlayer(url: URL(fileURLWithPath: "path_to_your_video"))

    var body: some View {
        ZStack {
            VideoPlayer(player: self.player)
            // 他のViewもここに追加できます。例えば:
            // Text("Hello, World!").font(.largeTitle).foregroundColor(.white)
        }
        .edgesIgnoringSafeArea(.all)
        .onAppear {
            self.player.play()
            hideHomeIndicator()
        }
    }

    func hideHomeIndicator() {
        if let window = UIApplication.shared.windows.first {
            window.rootViewController?.prefersHomeIndicatorAutoHidden = true
            window.rootViewController?.setNeedsUpdateOfHomeIndicatorAutoHidden()
        }
    }
}

struct VideoPlayer: UIViewRepresentable {
    var player: AVPlayer

    func updateUIView(_ uiView: UIView, context: UIViewRepresentableContext<VideoPlayer>) {
        (uiView.layer as! AVPlayerLayer).player = player
    }

    func makeUIView(context: Context) -> UIView {
        let view = UIView()
        let layer = AVPlayerLayer()
        layer.player = player
        layer.videoGravity = .resizeAspectFill
        view.layer.addSublayer(layer)
        layer.frame = view.bounds
        return view
    }
}
```

この例では、ZStack内部の全てのViewがセーフエリアを無視し、ホームインジケータも非表示になります。このようにして、動画の上に他のViewを追加することができます。ただし、他のViewが存在する場合、そのViewの位置やサイズを適切に設定する必要があります。

---

## 👤 User
*2023-07-02 21:51:50*

Swiftで横画面にした時のホームインジケータの値を無視したい

---

## 🤖 Assistant
*2023-07-02 21:52:15*

`prefersHomeIndicatorAutoHidden`プロパティは、現在表示されている`UIViewController`に適用されます。これは、その`UIViewController`が画面全体を占めているかどうかに関係なく適用されます。

したがって、横向きの画面でもホームインジケータを無視したい場合は、以下のように`prefersHomeIndicatorAutoHidden`を`true`に設定します。

```swift
if let window = UIApplication.shared.windows.first {
    window.rootViewController?.prefersHomeIndicatorAutoHidden = true
    window.rootViewController?.setNeedsUpdateOfHomeIndicatorAutoHidden()
}
```

この設定を行うと、ホームインジケータは最小化され、ユーザーが画面の下部から上にスワイプすると再度表示されます。これにより、画面全体を利用することが可能になります。

ただし、この設定は一時的なものであり、ユーザーが他のアプリに切り替えたり、画面をロックしたりすると、ホームインジケータは再度表示されるようになります。そのため、アプリがアクティブになるたびにこの設定を再度行う必要があります。これは、`onAppear`メソッドを使用して行うことができます。

---

## 👤 User
*2023-07-02 21:52:37*

.edgesIgnoringSafeArea() でそのような設定をしたいんだ

---

## 🤖 Assistant
*2023-07-02 21:53:05*

SwiftUIで.edgesIgnoringSafeArea()を使用すると、ViewがSafe Areaを無視して全画面表示されます。ですが、ホームインジケータはこの設定では非表示にはできません。ホームインジケータの表示は、システムによって制御されています。これを制御するためにはUIKitのコードを使用する必要があります。

ただし、UIViewControllerRepresentableを使用して、UIViewControllerの設定をSwiftUIで利用するViewを作成することが可能です。以下にその例を示します。

```swift
import SwiftUI

struct ContentView: View {
    var body: some View {
        ZStack {
            // 他のViewをここに追加できます。
            FullScreenViewControllerRepresentable()
        }
        .edgesIgnoringSafeArea(.all)
    }
}

struct FullScreenViewControllerRepresentable: UIViewControllerRepresentable {
    func makeUIViewController(context: Context) -> UIViewController {
        let viewController = UIViewController()
        viewController.view.backgroundColor = .clear
        return viewController
    }
    
    func updateUIViewController(_ uiViewController: UIViewController, context: Context) {
        uiViewController.modalPresentationStyle = .overFullScreen
        uiViewController.prefersHomeIndicatorAutoHidden = true
    }
    
    typealias UIViewControllerType = UIViewController
}
```

この例では、FullScreenViewControllerRepresentableという新しいViewを作成しています。このViewはUIViewControllerRepresentableを適用していて、新しいUIViewControllerを作成し、そのprefersHomeIndicatorAutoHiddenをtrueに設定しています。これにより、このViewが表示されている間はホームインジケータが非表示になります。

---

## 👤 User
*2023-07-02 21:53:35*

ちがくて、セーフエリア領域を無視するのは横向きの画面の時の下側だけにしたい。

---

## 🤖 Assistant
*2023-07-02 21:54:07*

SwiftUIにおいては、横画面時の下側だけセーフエリアを無視するような設定は直接的には提供されていません。ですが、一部のViewのみをセーフエリアから外すといった特定の振る舞いを実現するために、`GeometryReader`と`safeAreaInsets`を使用して自前で計算することが可能です。

以下にその一例を示します：

```swift
import SwiftUI

struct ContentView: View {
    var body: some View {
        GeometryReader { geometry in
            ZStack {
                Color.red
                // Your content here
            }
            .padding(.bottom, geometry.safeAreaInsets.bottom)
        }
        .edgesIgnoringSafeArea(.all)
    }
}
```

この例では、`GeometryReader`が現在のビューのセーフエリアの情報を提供します。これにより、ZStackの下側にパディングを追加することができ、これがセーフエリアの下側を示します。

この方法では、横向きの画面において下側のセーフエリアを無視することができますが、セーフエリアの他の側（上、左、右）は無視されません。

しかし、画面の向きやデバイスの種類によってセーフエリアのサイズが変わるため、この方法は全てのシナリオに対応しているわけではありません。そのため、具体的なUIの設計や要件により適切な方法が異なる場合があります。

---

# Flutter ローカルホスト 接続

Date: 2024-12-19

---

## 👤 User
*2024-12-19 22:47:16*

Android のflutter でローカルホストに繋げる方法

---

## 🤖 Assistant
*2024-12-19 22:47:57*

FlutterでAndroidデバイスからローカルホスト（例えばPCのローカルサーバー）に接続するためには、以下の手順を実行する必要があります。直接「localhost」を使用するのではなく、デバイスやエミュレーターがローカルサーバーと通信できる方法を設定する必要があります。

---

### **1. ローカルホストのIPアドレスを確認**
- ローカルホストのIPアドレス（通常は `192.168.x.x` 形式）を取得します。
  - **Windows**: `ipconfig` コマンドを使用。
  - **macOS/Linux**: `ifconfig` コマンドを使用。

  **例:** `192.168.1.100`

---

### **2. Androidエミュレーターの場合**
Androidエミュレーターには、ホストマシンのローカルホストにアクセスするための特殊なIPアドレスが割り当てられています。

- エミュレーターからホストのローカルホスト（PCの `localhost`）に接続するには、以下を使用します：
  - **10.0.2.2**: Android Virtual Device (AVD) 用。
  - **10.0.3.2**: Genymotion 用。

  例えば、ローカルホストのポートが `3000` の場合、URLは次のようになります：
  ```dart
  final String apiUrl = 'http://10.0.2.2:3000';
  ```

---

### **3. 実機デバイスの場合**
実機から接続する場合は、ローカルホストを直接指定することはできません。その代わり、**ホストマシンのIPアドレス**を使用します。

1. ホストマシンのIPアドレスを取得します（上記手順参照）。
2. 実機が同じWi-Fiネットワークに接続されていることを確認します。
3. 以下のようにホストマシンのIPアドレスとポートを使用します：
   ```dart
   final String apiUrl = 'http://192.168.1.100:3000';
   ```

---

### **4. ネットワークの設定を確認**
- **ファイアウォール**や**アンチウイルスソフト**がサーバーへの接続をブロックしていないか確認します。
- サーバーがポートを開いていることを確認します（通常、開発サーバーはデフォルトで設定済み）。

---

### **5. 開発サーバーの設定を確認**
FlutterアプリがHTTPSを使用する場合、ローカルサーバーをHTTPS対応にする必要があります。HTTPの場合は以下の設定を行います：

- **`AndroidManifest.xml` にネットワークセキュリティ設定を追加**
  ```xml
  <application
      android:usesCleartextTraffic="true"
      ... >
  </application>
  ```

---

### **6. Flutterコード例**
以下は、HTTPリクエストをローカルサーバーに送信する簡単な例です。

```dart
import 'package:http/http.dart' as http;

void fetchData() async {
  final String apiUrl = 'http://192.168.1.100:3000'; // 実際のIPアドレスまたはエミュレーター用のIPを使用
  final response = await http.get(Uri.parse(apiUrl));

  if (response.statusCode == 200) {
    print('データ取得成功: ${response.body}');
  } else {
    print('エラー: ${response.statusCode}');
  }
}
```

---

### **注意点**
- エミュレーターと実機で異なる設定が必要になるため、接続先を動的に切り替えるように実装すると便利です。
- セキュリティ上、本番環境では必ずHTTPSを使用してください。

以上の手順で、AndroidのFlutterアプリをローカルホストに接続できるようになります。

---

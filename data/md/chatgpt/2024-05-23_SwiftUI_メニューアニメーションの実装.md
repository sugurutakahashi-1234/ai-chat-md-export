# SwiftUI メニューアニメーションの実装

日付: 2024-05-23

---

## 👤 ユーザー
*2024/5/23 17:35:05*

SwiftUI でインスタの画像投稿やXのポストの長押しでViewがふわっと表示されて、メニューが表示されるような実装を教えてほしい

---

## 🤖 アシスタント
*2024/5/23 17:35:30*

SwiftUIでインスタの画像投稿やXのポストの長押しでViewがふわっと表示され、メニューが表示されるような実装を行うには、以下のステップを参考にしてください。

1. **ロングプレスジェスチャーの検知**：`LongPressGesture`を使って、ロングプレスを検知します。
2. **アニメーションを使ってViewを表示**：`withAnimation`を使って、ふわっと表示するアニメーションを追加します。
3. **コンテキストメニューの表示**：ロングプレスが検知されたら、カスタムビューを表示してメニューを提供します。

以下に、簡単な実装例を示します。

```swift
import SwiftUI

struct ContentView: View {
    @State private var isShowingMenu = false
    @State private var menuScale: CGFloat = 0.1
    @State private var menuOpacity: Double = 0.0

    var body: some View {
        VStack {
            Image(systemName: "photo")
                .resizable()
                .scaledToFit()
                .frame(width: 100, height: 100)
                .onLongPressGesture {
                    withAnimation(.spring()) {
                        self.isShowingMenu = true
                        self.menuScale = 1.0
                        self.menuOpacity = 1.0
                    }
                }

            if isShowingMenu {
                VStack {
                    Button(action: {
                        print("Edit tapped")
                        self.hideMenu()
                    }) {
                        Text("Edit")
                            .padding()
                            .background(Color.white)
                            .cornerRadius(8)
                            .shadow(radius: 5)
                    }
                    Button(action: {
                        print("Delete tapped")
                        self.hideMenu()
                    }) {
                        Text("Delete")
                            .padding()
                            .background(Color.white)
                            .cornerRadius(8)
                            .shadow(radius: 5)
                    }
                }
                .scaleEffect(menuScale)
                .opacity(menuOpacity)
                .transition(.scale)
                .animation(.easeInOut, value: menuScale)
            }
        }
        .padding()
    }
    
    private func hideMenu() {
        withAnimation(.easeInOut) {
            self.menuScale = 0.1
            self.menuOpacity = 0.0
        }
        DispatchQueue.main.asyncAfter(deadline: .now() + 0.3) {
            self.isShowingMenu = false
        }
    }
}

struct ContentView_Previews: PreviewProvider {
    static var previews: some View {
        ContentView()
    }
}
```

### 説明

1. **LongPressGesture**: `onLongPressGesture`修飾子を使ってロングプレスを検知します。
2. **アニメーション**: `withAnimation`を使って、ロングプレスが検知されたときにメニューがふわっと表示されるアニメーションを追加しています。`scaleEffect`と`opacity`を用いてスケールと透明度を制御しています。
3. **メニューの表示**: `if isShowingMenu`でメニューの表示を制御し、ボタンを配置してメニューを構築しています。

このコードを使って、SwiftUIでインスタやXのようなロングプレスで表示されるメニューを簡単に実装できます。お試しください。

---

## 👤 ユーザー
*2024/5/23 17:36:05*

isShowingMenu で表示されるものはSwiftUI の メニューを使ってほしい

---

## 🤖 アシスタント
*2024/5/23 17:36:20*

なるほど、`isShowingMenu`を使って表示されるメニューをSwiftUIの`ContextMenu`を使って実装する方法を示します。`ContextMenu`を使うことで、長押しした際にメニューが表示されるようになります。

以下に、`ContextMenu`を使った実装例を示します：

```swift
import SwiftUI

struct ContentView: View {
    var body: some View {
        VStack {
            Image(systemName: "photo")
                .resizable()
                .scaledToFit()
                .frame(width: 100, height: 100)
                .contextMenu {
                    Button(action: {
                        print("Edit tapped")
                    }) {
                        Text("Edit")
                        Image(systemName: "pencil")
                    }
                    
                    Button(action: {
                        print("Delete tapped")
                    }) {
                        Text("Delete")
                        Image(systemName: "trash")
                    }
                }
        }
        .padding()
    }
}

struct ContentView_Previews: PreviewProvider {
    static var previews: some View {
        ContentView()
    }
}
```

### 説明

1. **ContextMenu**: `contextMenu`修飾子を使って、コンテキストメニューを設定します。これにより、画像を長押しするとメニューが表示されます。
2. **Button**: `contextMenu`内に`Button`を追加して、各メニュー項目を設定します。各ボタンにアイコンを追加して視覚的にわかりやすくしています。

このコードを使用すると、画像を長押ししたときに、SwiftUIのネイティブなコンテキストメニューが表示されます。各メニュー項目には対応するアクションが設定されており、ユーザーがメニュー項目を選択すると、そのアクションが実行されます。

---

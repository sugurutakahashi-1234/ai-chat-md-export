# Dio タイムアウト設定

日付: 2025-02-13

---

## 👤 ユーザー
*2025/2/13 21:16:07*

Flutterのdioでタイムアウトを設定したい。

---

## 🤖 アシスタント
*2025/2/13 21:16:31*

`dio` でタイムアウトを設定するには、`BaseOptions` を使用して `connectTimeout`、`receiveTimeout`、`sendTimeout` を指定できます。

### 例：
```dart
import 'package:dio/dio.dart';

void main() async {
  final dio = Dio(
    BaseOptions(
      connectTimeout: Duration(seconds: 5), // 接続タイムアウト
      receiveTimeout: Duration(seconds: 5), // データ受信タイムアウト
      sendTimeout: Duration(seconds: 5),    // データ送信タイムアウト
    ),
  );

  try {
    final response = await dio.get('https://httpbin.org/delay/10');
    print(response.data);
  } on DioException catch (e) {
    if (e.type == DioExceptionType.connectionTimeout) {
      print('接続タイムアウト');
    } else if (e.type == DioExceptionType.sendTimeout) {
      print('送信タイムアウト');
    } else if (e.type == DioExceptionType.receiveTimeout) {
      print('受信タイムアウト');
    } else {
      print('その他のエラー: ${e.message}');
    }
  }
}
```

### タイムアウトの設定項目
- `connectTimeout`: サーバーに接続するまでの時間
- `sendTimeout`: リクエストを送信するまでの時間
- `receiveTimeout`: レスポンスを受信するまでの時間

Dart 3 以降では、**`Duration`** 型を使って設定する必要があります（`int` での指定は非推奨）。

このコードを実行すると、10秒以上かかるAPI (`https://httpbin.org/delay/10`) へのリクエストが5秒以内にタイムアウトし、適切なエラーメッセージが表示されます。

---

## 👤 ユーザー
*2025/2/13 21:16:42*

大体どのくらいが一般的かな？

---

## 🤖 アシスタント
*2025/2/13 21:17:09*

一般的なタイムアウト値は、**APIの性質やユースケース**によりますが、以下の設定がよく使われます。

### **一般的なタイムアウト設定**
#### **1. 通常のAPIリクエスト**
- `connectTimeout`: **5秒**
- `sendTimeout`: **5秒**
- `receiveTimeout`: **10秒**
- **理由**: サーバーが安定している場合、5秒以内に接続できないのは異常な状態とみなせる。データ受信は処理内容によっては少し余裕を持たせる。

#### **2. モバイルネットワーク（4G/LTE, 5G）対応**
- `connectTimeout`: **10秒**
- `sendTimeout`: **10秒**
- `receiveTimeout`: **15秒**
- **理由**: モバイル通信ではWi-Fiよりも遅延が発生しやすいため、若干長めに設定する。

#### **3. 大きなファイルのダウンロード**
- `connectTimeout`: **5秒**
- `sendTimeout`: **10秒**
- `receiveTimeout`: **30秒〜60秒**
- **理由**: 接続自体は短時間で確立すべきだが、ファイルのダウンロードには時間がかかるため、受信タイムアウトを長めにする。

#### **4. チャット・リアルタイム通信**
- `connectTimeout`: **3秒**
- `sendTimeout`: **3秒**
- `receiveTimeout`: **5秒**
- **理由**: リアルタイム性が求められるため、素早くタイムアウトを検知し、再試行などの処理に移る。

---

### **まとめ**
基本的には `connectTimeout = 5秒`、`sendTimeout = 5秒`、`receiveTimeout = 10秒` くらいが一般的ですが、アプリの目的に応じて調整するとよいでしょう。  
特に **モバイル環境ではネットワークの遅延を考慮して、少し長めに設定する** ことが重要です。

---

# コード抽象化リファクタリング

日付: 2025-01-17

---

## 👤 ユーザー
*2025/01/17 12:32:05*

抽象化して記述を減らしたい

extension SpotDTORarityX on SpotDTORarity {
  String get label {
    switch (this) {
      case SpotDTORarity.EPIC:
        return 'S';
      case SpotDTORarity.RARE:
        return 'A';
      case SpotDTORarity.UNCOMMON:
        return 'B';
      case SpotDTORarity.COMMON:
        return 'C';
    }
  }

  Color get color {
    switch (this) {
      case SpotDTORarity.EPIC:
        return ColorToken.rarityEpic;
      case SpotDTORarity.RARE:
        return ColorToken.rarityRare;
      case SpotDTORarity.UNCOMMON:
        return ColorToken.rarityUncommon;
      case SpotDTORarity.COMMON:
        return ColorToken.rarityCommon;
    }
  }
}

extension SpotDetailDTORarityX on SpotDetailDTORarity {
  String get label {
    switch (this) {
      case SpotDetailDTORarity.EPIC:
        return 'S';
      case SpotDetailDTORarity.RARE:
        return 'A';
      case SpotDetailDTORarity.UNCOMMON:
        return 'B';
      case SpotDetailDTORarity.COMMON:
        return 'C';
    }
  }

  Color get color {
    switch (this) {
      case SpotDetailDTORarity.EPIC:
        return ColorToken.rarityEpic;
      case SpotDetailDTORarity.RARE:
        return ColorToken.rarityRare;
      case SpotDetailDTORarity.UNCOMMON:
        return ColorToken.rarityUncommon;
      case SpotDetailDTORarity.COMMON:
        return ColorToken.rarityCommon;
    }
  }
}

---

## 🤖 アシスタント
*2025/01/17 12:32:19*

共通する処理を抽象化するために、`Map`を使って`SpotDTORarity`や`SpotDetailDTORarity`のラベルや色を定義することで記述を減らせます。また、汎用的な関数や型を活用することで、コードの再利用性を向上させることができます。

以下はリファクタリング例です。

```dart
// 共通の抽象化処理
extension RarityExtension on Enum {
  String get label {
    final labels = {
      SpotDTORarity.EPIC: 'S',
      SpotDTORarity.RARE: 'A',
      SpotDTORarity.UNCOMMON: 'B',
      SpotDTORarity.COMMON: 'C',
      SpotDetailDTORarity.EPIC: 'S',
      SpotDetailDTORarity.RARE: 'A',
      SpotDetailDTORarity.UNCOMMON: 'B',
      SpotDetailDTORarity.COMMON: 'C',
    };

    return labels[this] ?? 'Unknown';
  }

  Color get color {
    final colors = {
      SpotDTORarity.EPIC: ColorToken.rarityEpic,
      SpotDTORarity.RARE: ColorToken.rarityRare,
      SpotDTORarity.UNCOMMON: ColorToken.rarityUncommon,
      SpotDTORarity.COMMON: ColorToken.rarityCommon,
      SpotDetailDTORarity.EPIC: ColorToken.rarityEpic,
      SpotDetailDTORarity.RARE: ColorToken.rarityRare,
      SpotDetailDTORarity.UNCOMMON: ColorToken.rarityUncommon,
      SpotDetailDTORarity.COMMON: ColorToken.rarityCommon,
    };

    return colors[this] ?? ColorToken.defaultColor;
  }
}
```

### 改善ポイント
1. **共通の`Enum`拡張を作成**:
   - 複数のEnum型で同じラベルやカラーを扱うため、共通の`RarityExtension`を作成しました。
   - ラベルやカラーは`Map`で定義しています。

2. **拡張の柔軟性**:
   - 必要に応じて`labels`や`colors`に新しいEnum型を追加できます。

3. **冗長なコードの削減**:
   - ラベルやカラーごとに同じ処理を記述する必要がなくなりました。

### 利用例
```dart
final rarity = SpotDTORarity.EPIC;
print(rarity.label); // 出力: S
print(rarity.color); // 出力: ColorToken.rarityEpic
```

これにより、コードが簡潔になり、追加のEnum型を処理する場合も最小限の変更で済みます。

---

## 👤 ユーザー
*2025/01/17 12:33:08*

そういうことではなくてSpotDTORarityとSpotDetailDTORarityを SpotRarityを定義して、そことマッピングさせて、そこから label と color にアクセスさせたい

---

## 🤖 アシスタント
*2025/01/17 12:33:27*

以下のように、`SpotRarity`という共通の抽象的なEnumを定義し、それを`SpotDTORarity`や`SpotDetailDTORarity`とマッピングすることで冗長なコードを解消できます。これにより、共通の処理を一元化して`label`や`color`にアクセスできます。

### リファクタリング例

```dart
// 共通のSpotRarity Enumを定義
enum SpotRarity {
  EPIC,
  RARE,
  UNCOMMON,
  COMMON,
}

// SpotRarityの拡張
extension SpotRarityExtension on SpotRarity {
  String get label {
    switch (this) {
      case SpotRarity.EPIC:
        return 'S';
      case SpotRarity.RARE:
        return 'A';
      case SpotRarity.UNCOMMON:
        return 'B';
      case SpotRarity.COMMON:
        return 'C';
    }
  }

  Color get color {
    switch (this) {
      case SpotRarity.EPIC:
        return ColorToken.rarityEpic;
      case SpotRarity.RARE:
        return ColorToken.rarityRare;
      case SpotRarity.UNCOMMON:
        return ColorToken.rarityUncommon;
      case SpotRarity.COMMON:
        return ColorToken.rarityCommon;
    }
  }
}

// SpotDTORarityとSpotDetailDTORarityの変換
extension SpotDTORarityX on SpotDTORarity {
  SpotRarity get spotRarity {
    switch (this) {
      case SpotDTORarity.EPIC:
        return SpotRarity.EPIC;
      case SpotDTORarity.RARE:
        return SpotRarity.RARE;
      case SpotDTORarity.UNCOMMON:
        return SpotRarity.UNCOMMON;
      case SpotDTORarity.COMMON:
        return SpotRarity.COMMON;
    }
  }
}

extension SpotDetailDTORarityX on SpotDetailDTORarity {
  SpotRarity get spotRarity {
    switch (this) {
      case SpotDetailDTORarity.EPIC:
        return SpotRarity.EPIC;
      case SpotDetailDTORarity.RARE:
        return SpotRarity.RARE;
      case SpotDetailDTORarity.UNCOMMON:
        return SpotRarity.UNCOMMON;
      case SpotDetailDTORarity.COMMON:
        return SpotRarity.COMMON;
    }
  }
}

// 利用例
final rarity = SpotDTORarity.EPIC;
print(rarity.spotRarity.label); // 出力: S
print(rarity.spotRarity.color); // 出力: ColorToken.rarityEpic

final detailRarity = SpotDetailDTORarity.COMMON;
print(detailRarity.spotRarity.label); // 出力: C
print(detailRarity.spotRarity.color); // 出力: ColorToken.rarityCommon
```

### 改善ポイント
1. **`SpotRarity`で共通化**:
   - `SpotDTORarity`と`SpotDetailDTORarity`を共通の`SpotRarity`にマッピング。
   - ラベルや色の処理を一元化できます。

2. **拡張で柔軟に対応**:
   - 各DTOのEnumに`spotRarity`を追加することで、共通処理に対応。

3. **コードの簡潔化**:
   - ラベルや色を個別に実装する必要がなく、Enumの新しいケースを追加する際の保守性が向上します。

4. **再利用性の向上**:
   - 今後、他の`Rarity`関連の処理にも簡単に対応できます。

この設計により、`SpotRarity`を中心にした柔軟で再利用性の高いアプローチが実現できます。

---

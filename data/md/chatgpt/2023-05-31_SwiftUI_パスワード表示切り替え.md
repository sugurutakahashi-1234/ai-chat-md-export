# SwiftUI パスワード表示切り替え

日付: 2023-05-31

---

## 👤 ユーザー
*2023/06/01 03:36:20*

SwiftUI でテキストフィールドのセキュリティーアイコンでパスワードを表示/非表示を切り替える方法

---

## 🤖 アシスタント
*2023/06/01 03:37:21*

SwiftUI には現在、セキュリティーアイコン（アイコンをクリックするとパスワードが表示され、再度クリックするとパスワードが非表示になる機能）を直接サポートするビルトインのコンポーネントがありません。ただし、SwiftUI を使ってこのような機能を自作することは可能です。

以下に、パスワードの表示と非表示を切り替えるシンプルなサンプルコードを示します：

```swift
import SwiftUI

struct ContentView: View {
    @State private var password: String = ""
    @State private var isPasswordVisible: Bool = false

    var body: some View {
        VStack {
            HStack {
                if isPasswordVisible {
                    TextField("Password", text: $password)
                        .autocapitalization(.none)
                } else {
                    SecureField("Password", text: $password)
                        .autocapitalization(.none)
                }
                
                Button(action: {
                    isPasswordVisible.toggle()
                }) {
                    Image(systemName: isPasswordVisible ? "eye.slash.fill" : "eye.fill")
                }
            }
            .padding()
        }
    }
}
```

このコードは、`isPasswordVisible`という`@State`変数を使用して、パスワードフィールドが通常のテキストフィールドかセキュアフィールドかを切り替えます。ボタンが押されると、`isPasswordVisible`の状態が切り替わり、結果としてパスワードの表示/非表示が切り替わります。ボタンのアイコンも現在の状態を反映します。

ただし、このアプローチにはいくつかの制約があります。パスワードが表示されるときに、テキストフィールドとセキュアフィールドが切り替わるため、フィールドのフォーカスが失われ、ユーザーが再入力を始める必要があるかもしれません。

これを回避するためには、UIKitのUITextFieldをラップして、SwiftUIで使用する必要があります。これにより、表示/非表示の切り替え機能をより正確に制御することができますが、そのためには少し複雑なコードが必要になります。

---

## 👤 ユーザー
*2023/06/01 08:45:04*

フォーカスの入れ替えとか必要ないの？

---

## 🤖 アシスタント
*2023/06/01 08:45:49*

SwiftUIでは、ビューのフォーカスを明示的に制御する手段が限られています。もしパスワードの表示/非表示を切り替えた際にフォーカスが失われる問題を解決したい場合、UIKitのUITextFieldをラップすることを検討すると良いでしょう。

UIKitを使用することで、表示/非表示の切り替え機能とフォーカス制御をより細かく制御することができますが、これはSwiftUIのデザインパラダイムから外れることを意味します。

以下に、UIKitのUITextFieldをラップしてSwiftUIで使用するサンプルコードを示します。このコードでは、表示/非表示の切り替えとフォーカス制御を実現しています。

```swift
import SwiftUI
import UIKit

struct ContentView: View {
    @State private var password: String = ""
    @State private var isPasswordVisible: Bool = false

    var body: some View {
        VStack {
            TextFieldWithToggle("Password", text: $password, isSecure: $isPasswordVisible)
                .padding()
        }
    }
}

struct TextFieldWithToggle: UIViewRepresentable {
    var placeholder: String
    @Binding var text: String
    @Binding var isSecure: Bool

    func makeUIView(context: Context) -> UITextFieldWithToggle {
        let textField = UITextFieldWithToggle()
        textField.delegate = textField
        textField.setContentHuggingPriority(.defaultHigh, for: .vertical)
        textField.setContentCompressionResistancePriority(.defaultLow, for: .horizontal)
        return textField
    }

    func updateUIView(_ uiView: UITextFieldWithToggle, context: Context) {
        uiView.text = text
        uiView.placeholder = placeholder
        uiView.isSecureTextEntry = !isSecure
    }
}

class UITextFieldWithToggle: UITextField, UITextFieldDelegate {
    var isSecureTextEntryToggle: Bool = false {
        didSet {
            self.isSecureTextEntry = !isSecureTextEntryToggle
            if isFirstResponder {
                _ = becomeFirstResponder()
            }
        }
    }

    override func becomeFirstResponder() -> Bool {
        let result = super.becomeFirstResponder()
        if isSecureTextEntry {
            _ = super.becomeFirstResponder()
        }
        return result
    }

    func textFieldShouldReturn(_ textField: UITextField) -> Bool {
        textField.resignFirstResponder()
    }
}
```

上記のコードでは、SwiftUIビュー`TextFieldWithToggle`がUIKitの`UITextFieldWithToggle`をラップしています。その結果、フォーカスを保持したままパスワードの表示/非表示を切り替えることができます。

しかし、このコードでは、パスワードの表示/非表示を切り替えるためのボタンは含まれていません。必要に応じてボタンを追加し、`isSecure`変数の状態を切り替えることで表示/非表示を切り替えることができます。

注意点として、SwiftUIとUIKitを混在させる

---

# ç”»é¢ãƒãƒ©ã¤ãé˜²æ­¢æ–¹æ³•

æ—¥ä»˜: 2025-02-11

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/02/11 10:03:06*

ä»¥ä¸‹ã®éƒ¨åˆ†ã®æ›´æ–°ã§ç”»é¢ãŒãƒãƒ©ã¤ãã®ã‚’ã‚„ã‚ãŸã„â€¨â€¨final walletDate = data.$1;
            final nftsData = data.$2;
            if (nftsData == null || walletDate == null) {
              return const SizedBox.shrink();
            }
â€¨import 'package:auto_size_text/auto_size_text.dart';
import 'package:flutter/material.dart';
import 'package:flutter/services.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:snpit_guild_app/domain/design/color_pallet.dart';
import 'package:snpit_guild_app/domain/design/color_token.dart';
import 'package:snpit_guild_app/domain/nft.dart';
import 'package:snpit_guild_app/domain/nft_type.dart';
import 'package:snpit_guild_app/gen/assets.gen.dart';
import 'package:snpit_guild_app/infrastructure/snapit_guild_api/snapit_guild_api.openapi.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/users/nfts/get_nfts.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/wallet/get_wallet.dart';
import 'package:snpit_guild_app/presentation/widgets/square_image.dart';
import 'package:snpit_guild_app/utils/snack_bar_utils.dart';

final combinedWalletDataProvider = FutureProvider.autoDispose&lt;
    (
      WalletBalanceResponseDTOData?,
      GetUserNftsResponseDTOData?,
    )&gt;((ref) async {
  final wallet = await ref.watch(getWalletNotifierProvider.future);
  final nfts = await ref.watch(getNftsNotifierProvider.future);

  return (wallet, nfts);
});

class WalletPage extends HookConsumerWidget {
  const WalletPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    Future&lt;void&gt; onTapNft(Nft nft) async {
      // TODO: [ãƒ•ã‚§ãƒ¼ã‚º2] NFT è©³ç´°ç”»é¢ã¸ã®é·ç§»
    }

    Future&lt;void&gt; onTapWalletAddress(String walletAddress) async {
      await Clipboard.setData(ClipboardData(text: walletAddress));

      if (context.mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text('$walletAddress copied to clipboard')),
        );
      }
    }

    Future&lt;void&gt; onRefresh() async {
      try {
        await ref.read(getNftsNotifierProvider.notifier).getNfts();
        await ref.read(getWalletNotifierProvider.notifier).getWallet();
      } on Exception catch (error) {
        if (context.mounted) {
          showErrorSnackBar(context, error);
        }
      }
    }

    final combinedWalletAsyncValue = ref.watch(combinedWalletDataProvider);

    useEffect(
      () {
        Future.microtask(() async {
          await onRefresh();
        });
        return null;
      },
      [],
    );

    return Scaffold(
      appBar: AppBar(title: const Text('Wallet')),
      body: RefreshIndicator(
        onRefresh: () async {
          await onRefresh();
        },
        color: ColorToken.primary,
        backgroundColor: ColorToken.bgLight,
        child: combinedWalletAsyncValue.when(
          data: (data) {
            final walletDate = data.$1;
            final nftsData = data.$2;
            if (nftsData == null || walletDate == null) {
              return const SizedBox.shrink();
            }

            final stpValue = walletDate.stpAmount ?? 0;
            final tmpWalletAddress = walletDate.walletAddress ?? '';
            final walletAddress =
                (tmpWalletAddress.isNotEmpty) ? tmpWalletAddress : 'No Address';

            final explorers = nftsData.explorers ?? [];
            final flags = nftsData.flags ?? [];

            final explorerNfts = explorers.map((explorer) {
              final nameParts = explorer.explorerName?.split(' #') ?? ['', ''];
              final name = nameParts[0];
              final number = nameParts.length &gt; 1 ? '#${nameParts[1]}' : '';

              return Nft(
                nftId: explorer.explorerId ?? '',
                tokenId: explorer.tokenId ?? '',
                name: name,
                number: number,
                imageUrl: explorer.explorerImage ?? '',
                nftType: NftType.explorer,
                explorer: explorer,
              );
            }).toList();

            final flagNfts = flags.map((flag) {
              final nameParts = flag.flagName?.split(' #') ?? ['', ''];
              final name = nameParts[0];
              final number = nameParts.length &gt; 1 ? '#${nameParts[1]}' : '';

              return Nft(
                nftId: flag.flagId ?? '',
                tokenId: flag.tokenId ?? '',
                name: name,
                number: number,
                imageUrl: flag.flagImage ?? '',
                nftType: NftType.flag,
                flag: flag,
              );
            }).toList();

            final allNfts = [
              ...explorerNfts,
              ...flagNfts,
            ];

            return SingleChildScrollView(
              physics: const AlwaysScrollableScrollPhysics(),
              child: Padding(
                padding: const EdgeInsets.all(24),
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    Column(
                      children: [
                        DecoratedBox(
                          decoration: BoxDecoration(
                            color: ColorToken.bg,
                            borderRadius: BorderRadius.circular(8),
                            border: Border.all(
                              color: ColorToken.border,
                            ),
                          ),
                          child: Padding(
                            padding: const EdgeInsets.all(24),
                            child: Column(
                              children: [
                                Image.asset(
                                  Assets.images.stpCoinIcon.path,
                                  width: 32,
                                  height: 32,
                                ),
                                const SizedBox(height: 14),
                                Row(
                                  mainAxisAlignment: MainAxisAlignment.center,
                                  crossAxisAlignment:
                                      CrossAxisAlignment.baseline,
                                  textBaseline: TextBaseline.alphabetic,
                                  children: [
                                    Flexible(
                                      child: AutoSizeText(
                                        stpValue.toString(),
                                        style: const TextStyle(
                                          fontSize: 32,
                                          fontWeight: FontWeight.bold,
                                        ),
                                        maxLines: 1,
                                        minFontSize: 1,
                                        overflow: TextOverflow.ellipsis,
                                      ),
                                    ),
                                    const SizedBox(width: 6),
                                    const Text(
                                      'STP',
                                      style: TextStyle(
                                        fontSize: 16,
                                      ),
                                    ),
                                  ],
                                ),
                                const SizedBox(height: 24),
                                GestureDetector(
                                  onTap: () async {
                                    await onTapWalletAddress(walletAddress);
                                  },
                                  child: Container(
                                    padding: const EdgeInsets.symmetric(
                                      horizontal: 10,
                                      vertical: 5,
                                    ),
                                    decoration: BoxDecoration(
                                      color: ColorPallet.gray800,
                                      borderRadius: BorderRadius.circular(4),
                                    ),
                                    child: Text(
                                      walletAddress,
                                      maxLines: 1,
                                      overflow: TextOverflow.ellipsis,
                                      style: const TextStyle(
                                        fontSize: 13,
                                        color: ColorToken.primaryDark,
                                      ),
                                    ),
                                  ),
                                ),
                              ],
                            ),
                          ),
                        ),
                      ],
                    ),
                    const SizedBox(height: 16),

                    // NFTs
                    const Text(
                      'NFTs',
                      style: TextStyle(
                        fontSize: 16,
                        fontWeight: FontWeight.bold,
                      ),
                    ),
                    const SizedBox(height: 16),

                    if (allNfts.isEmpty)
                      const Center(child: Text('No NFTs owned')),

                    Column(
                      children: allNfts.map((nft) {
                        return Padding(
                          padding: const EdgeInsets.only(bottom: 8),
                          child: ClipRRect(
                            borderRadius: BorderRadius.circular(8),
                            // TODO: [ãƒ•ã‚§ãƒ¼ã‚º2] NFT è©³ç´°ç”»é¢ã¸ã®é·ç§»ï¼ˆãƒªãƒƒãƒ—ãƒ«ã«å¤‰æ›´ã™ã‚‹ï¼‰
                            // child: Ink(
                            child: DecoratedBox(
                              decoration: BoxDecoration(
                                color: ColorToken.bg,
                                borderRadius: BorderRadius.circular(8),
                                border: Border.all(
                                  color: ColorToken.border,
                                ),
                              ),
                              child: InkWell(
                                borderRadius: BorderRadius.circular(8),
                                onTap: () async {
                                  await onTapNft(nft);
                                },
                                child: Padding(
                                  padding: const EdgeInsets.all(16),
                                  child: Row(
                                    children: [
                                      ClipRRect(
                                        borderRadius: BorderRadius.circular(4),
                                        child: SquareImage(
                                          imageUrl: nft.imageUrl,
                                          size: 56,
                                        ),
                                      ),
                                      const SizedBox(width: 16),
                                      Expanded(
                                        child: Column(
                                          crossAxisAlignment:
                                              CrossAxisAlignment.start,
                                          children: [
                                            Row(
                                              children: [
                                                Expanded(
                                                  child: Text(
                                                    nft.name,
                                                    maxLines: 1,
                                                    overflow:
                                                        TextOverflow.ellipsis,
                                                    style: const TextStyle(
                                                      fontSize: 14,
                                                      fontWeight:
                                                          FontWeight.bold,
                                                    ),
                                                  ),
                                                ),
                                                const SizedBox(width: 4),
                                                Text(
                                                  nft.number,
                                                  maxLines: 1,
                                                  overflow:
                                                      TextOverflow.ellipsis,
                                                  style: const TextStyle(
                                                    fontSize: 12,
                                                    fontWeight: FontWeight.bold,
                                                    color: ColorPallet.gray300,
                                                  ),
                                                ),
                                              ],
                                            ),
                                            const SizedBox(height: 12),
                                            Text(
                                              'TokenID: ${nft.tokenId}',
                                              maxLines: 1,
                                              overflow: TextOverflow.ellipsis,
                                              style: const TextStyle(
                                                fontSize: 12,
                                              ),
                                            ),
                                          ],
                                        ),
                                      ),
                                      // TODO: [ãƒ•ã‚§ãƒ¼ã‚º2] NFT è©³ç´°ç”»é¢ã¸ã®é·ç§»
                                      // const Icon(
                                      //   Icons.chevron_right,
                                      //   size: 32,
                                      //   color: ColorToken.text,
                                      // ),
                                    ],
                                  ),
                                ),
                              ),
                            ),
                          ),
                        );
                      }).toList(),
                    ),
                    const SizedBox(height: 24),
                  ],
                ),
              ),
            );
          },
          loading: () {
            return const Center(
              child: CircularProgressIndicator(),
            );
          },
          error: (error, _) {
            return Center(
              child: Text('Error: $error'),
            );
          },
        ),
      ),
    );
  }
}

---

## ğŸ”§ ãƒ„ãƒ¼ãƒ«
*2025/02/11 10:04:08*

**è§£æ±ºç­–ã‚’æ¤œè¨ã™ã‚‹**

ç†ç”±ã‚’æ¢ã‚Šã¤ã¤ã€ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ç›´ã—ã€å°†æ¥ã®åˆ©ç”¨è€…ã®ãŸã‚ã«ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã‚‹ã€‚flutterã®æ§‹é€ ã¨ä½¿ã„æ–¹ã‚’å­¦ã¶è‰¯ã„æ©Ÿä¼šã«ãªã£ã¦ã„ã‚‹ã€‚

**æ–¹æ³•ã‚’æ¨¡ç´¢ä¸­**

ã€ŒFutureProviderã€ã®è‡ªå‹•å»ƒæ£„ã‚’è§£é™¤ã—ã¦ã„ã‚‹ã€‚ãƒ‡ãƒ¼ã‚¿ç¢ºèªã‚’å–ã‚Šé™¤ãã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒ†ãƒ¼ãƒˆã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã—ã¤ã¤ã€æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹é–“ã«æ—§ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã™ã‚‹æ–¹æ³•ã‚’æ¤œè¨ä¸­ã€‚

**ãƒ‡ãƒ¼ã‚¿ã®å–ã‚Šæ‰±ã„ã‚’è¦‹ç›´ã™**

`useEffect`ã®ä½¿ç”¨ãŒã¡ã‚‰ã¤ãã®åŸå› ã‹ã‚‚ã—ã‚Œãªã„ã¨æ„Ÿã˜ã€`AsyncValue`ã‚’ä½¿ã£ã¦ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã‚‹é–“ã«æœ€å¾Œã®ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã™ã‚‹æ–¹æ³•ã‚’æ¤œè¨ä¸­ã€‚

**ãƒ‡ãƒ¼ã‚¿ã®å–ã‚Šæ‰±ã„ã‚’å·¥å¤«ã™ã‚‹**

ãƒ‡ãƒ¼ã‚¿ãŒå¤‰ã‚ã‚‰ãªã„å ´åˆã¯ãƒ¡ãƒ¢ãƒªã«ä¿æŒã—ã€ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ãƒ”ãƒŠãƒ¼ã‚’è¡¨ç¤ºã—ãªã„ãªã©ã®å·¥å¤«ã‚’é€šã˜ã¦ã¡ã‚‰ã¤ãã‚’æœ€å°é™ã«æŠ‘ãˆã¤ã¤ã€ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å¾Œã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’è¦‹ç›´ã—ã¦ã„ã‚‹ã€‚

**æ”¹å–„æ–¹æ³•ã‚’æ¨¡ç´¢ä¸­**

ãƒ‡ãƒ¼ã‚¿ãŒãƒ­ãƒ¼ãƒ‰ä¸­ã«å¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã—ã€æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’éåŒæœŸã§èª­ã¿è¾¼ã‚€`AsyncValueWidget`ã®ä½¿ç”¨ãŒã¡ã‚‰ã¤ãã‚’è»½æ¸›ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’å‘ä¸Šã•ã›ã‚‹åŠ©ã‘ã«ãªã‚‹ã€‚

**æ–°ã—ã„æ–¹æ³•ã‚’æ¨¡ç´¢ä¸­**

å¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’`useState`ã‚„`cacheTime`ã€`keepAlive`å±æ€§ã§ä¿æŒã—ã€ã¡ã‚‰ã¤ãã‚’æ¸›ã‚‰ã™ãŸã‚ã®æ–°ã—ã„æ–¹æ³•ã‚’æ¤œè¨ã—ã¦ã„ã‚‹ã€‚

**çŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹æ–¹æ³•**

`keepAlive: true`ã‚„`autoDispose`ã®`maintainState: true`ã‚’æ´»ç”¨ã—ã¦ã€ã‚¤ãƒ™ãƒ³ãƒˆã‚„ã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã™ã‚‹ã¾ã§ã®çŠ¶æ…‹ã‚’ç¶­æŒã™ã‚‹æ–¹æ³•ã‚’æ¤œè¨ã—ã¦ã„ã‚‹ã€‚

**çŠ¶æ…‹ã‚’ç¶­æŒã™ã‚‹å·¥å¤«**

`useRef`ã‚’ç”¨ã„ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ç¶­æŒã—ã€ãƒ­ãƒ¼ãƒ‰ä¸­ã®UIã‚’å·¥å¤«ã™ã‚‹ã“ã¨ã§ã¡ã‚‰ã¤ãã‚’æ¸›ã‚‰ã—ã¦ã„ã‚‹ã€‚

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¦‹æ¥µã‚ã‚‹**

`autoDispose`ã‚’å¤–ã™ã‹ã€`keepAlive`ã‚’ä½¿ã£ã¦å¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹æ–¹æ³•ã‚’è€ƒãˆã¦ã„ã‚‹ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒªãƒ­ãƒ¼ãƒ‰ä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½“é¨“ãŒæ”¹å–„ã•ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚

**ãƒ‡ãƒ¼ã‚¿ã®å‹•ãã‚’è¿½è·¡**

`useEffect`ã‚’å¤–ã™ã‹ã€ã‚ªãƒ³ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã®å‘¼ã³å‡ºã—ã‚’åˆ¶å¾¡ã™ã‚‹ã“ã¨ã§ã€ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®ãƒ‡ãƒ¼ã‚¿ã®ã¡ã‚‰ã¤ãã‚’æ¸›ã‚‰ã™æ–¹æ³•ã‚’æ¨¡ç´¢ã—ã¦ã„ã‚‹ã€‚

**ã¡ã‚‰ã¤ãã®å›é¿**

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ`asyncValue`ã®`when`ã‚’ä½¿ã£ã¦ã„ã‚‹ã‘ã©ã€å¤ã„ãƒ‡ãƒ¼ã‚¿ãŒãªã„ã‹ã‚‰ã€`maybeWhen`ã®åˆ¥ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ææ¡ˆã—ã¦ã„ã‚‹ã€‚

**ææ¡ˆã‚’ã¾ã¨ã‚ã‚‹**

`autoDispose`ã‚’å¤–ã—ã€`useEffect`ã‚’å–ã‚Šé™¤ã„ã¦ãƒ‡ãƒ¼ã‚¿ã®ã¡ã‚‰ã¤ãã‚’æ¸›ã‚‰ã™æ–¹æ³•ã‚’ææ¡ˆã—ã¦ã„ã‚‹ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ‡ãƒ¼ã‚¿ã®ãƒ­ãƒ¼ãƒ‰ã¨ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã®ç®¡ç†ãŒã‚ˆã‚ŠåŠ¹ç‡çš„ã«ãªã‚‹ã€‚

**ã¡ã‚‰ã¤ãã‚’æŠ‘ãˆã‚‹**

ãƒ‡ãƒ¼ã‚¿ã®ã¡ã‚‰ã¤ãã‚’æŠ‘ãˆã‚‹ãŸã‚ã€`useState`ã‚’æ´»ç”¨ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹å¤‰æ•°ã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã€èª­ã¿è¾¼ã¿ä¸­ã«UIã‚’å·¥å¤«ã™ã‚‹æ–¹æ³•ã‚’ææ¡ˆã—ã¦ã„ã‚‹ã€‚

**ã¡ã‚‰ã¤ãã‚’æŠ‘ãˆã‚‹æ–¹æ³•**

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒUIã®å†æ§‹ç¯‰ãŒåŸå› ã§ã¡ã‚‰ã¤ãã‚’å¿ƒé…ã—ã¦ã„ã‚‹ã“ã¨ã«æ°—ã¥ã„ã¦ã„ã‚‹ã€‚éƒ¨åˆ†å†æ§‹ç¯‰ã‚’ç”¨ã„ã‚‹ã“ã¨ã§ã€ã¡ã‚‰ã¤ãã‚’æ¸›å°‘ã•ã›ã¦ã„ã‚‹ã€‚

**æœŸé™è¨­å®šã‚’è¦‹ç›´ã™**

ã‚¤ãƒ™ãƒ³ãƒˆãŒãƒ¡ã‚¤ã‚¯ã‚¢ãƒƒãƒ—æœŸé–“ã‚’çŸ­ãã—ã¦ã„ã‚‹ã®ã§ã€æœˆæ›œæ—¥ã®æ¬¡ã®é€±ã‚’ç· ã‚åˆ‡ã‚Šæ—¥ã¨ã—ã¦è¨­å®šã™ã‚‹ã“ã¨ã«ã—ã¦ã„ã‚‹ã€‚å¼è­·å£«ã«é€£çµ¡ã—ã¦ã„ã‚‹ã¨ã“ã‚ã ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/02/11 10:04:08*

Riverpodï¼ˆç‰¹ã« `FutureProvider`ï¼‰ã§ç”»é¢ã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã™ã‚‹éš›ã«ã€Œä»¥å‰ã®å€¤ãŒä¸€ç¬æ¶ˆãˆã¦ã‹ã‚‰æ–°ã—ã„å€¤ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€ã„ã‚ã‚†ã‚‹â€œç”»é¢ãƒãƒ©ã¤ãâ€ãŒèµ·ãã‚‹ä¸»ãªåŸå› ã¯ã€**æ–°ã—ã„å€¤ã‚’å–å¾—ã—ã¦ã„ã‚‹æœ€ä¸­ã« `loading` çŠ¶æ…‹ã«ãªã‚Šã€UI ä¸Šã§ä¸€æ™‚çš„ã«ã¾ã£ãŸãä½•ã‚‚è¡¨ç¤ºã—ãªã„ï¼ˆã‚‚ã—ãã¯ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã ã‘è¡¨ç¤ºã™ã‚‹ï¼‰çŠ¶æ…‹ãŒæŒŸã¾ã£ã¦ã—ã¾ã†**ã“ã¨ã§ã™ã€‚

ãã“ã§ã€ãƒãƒ©ã¤ãã‚’é˜²ããŸã‚ã®åŸºæœ¬çš„ãªæ–¹æ³•ã¯ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã€ã‚ã‚‹ã„ã¯è¤‡æ•°ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

1. **autoDispose ã‚’ã‚„ã‚ã‚‹ã‹ã€ã‚‚ã—ãã¯ keepAlive ã‚’ä½¿ã†**  
   - `autoDispose` ã‚’ä½¿ã£ã¦ã„ã‚‹ã¨ã€Widget ãƒ„ãƒªãƒ¼ã‹ã‚‰å¤–ã‚ŒãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ Provider ãŒç ´æ£„ã•ã‚Œã€æˆ»ã£ã¦ããŸã¨ãã«åˆæœŸçŠ¶æ…‹ï¼ˆ`loading`ï¼‰ã«æˆ»ã‚‹ãŸã‚ã€ãƒ‡ãƒ¼ã‚¿ã‚’å†å–å¾—ã—ç›´ã— â†’ UI ãŒä¸€ç¬ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã«åˆ‡ã‚Šæ›¿ã‚ã‚‹ â†’ ãƒãƒ©ã¤ãã®åŸå› ã«ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚  
   - ã‚‚ã—ã€Œãƒšãƒ¼ã‚¸ã‚’é›¢ã‚ŒãŸå¾Œã‚‚å‰å›ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä¿æŒã—ãŸã„ã€ã®ã§ã‚ã‚Œã°ã€`autoDispose` ã‚’å¤–ã™ã€ã¾ãŸã¯ `autoDispose` ã®ã¾ã¾ `keepAlive` ã‚’ä½¿ã£ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä¿æŒã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚

2. **ãƒ­ãƒ¼ãƒ‰ä¸­ã§ã‚‚ä»¥å‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€ç¬ã§ã‚‚è¡¨ç¤ºã—ç¶šã‘ã‚‹ï¼ˆâ€œæ¥½è¦³çš„ UIâ€ï¼‰**  
   - Riverpod ã® `AsyncValue` ã¯æ¨™æº–ã ã¨ `loading` ã«å…¥ã£ãŸæ™‚ç‚¹ã§ã€Œå‰å›ãƒ‡ãƒ¼ã‚¿ã‚’æ¡ã£ã¦ã„ãªã„ã€æ‰±ã„ã«ãªã‚‹ãŸã‚ã€ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ™‚ã« `CircularProgressIndicator` ãªã©ã‚’è¡¨ç¤ºã™ã‚‹ã¨ã€çµæœçš„ã«ä¸€ç¬ç”»é¢ãŒã‚¬ãƒ©ãƒƒã¨å¤‰ã‚ã£ã¦ã—ã¾ã„ã¾ã™ã€‚  
   - å‰å›ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã—ãŸã¾ã¾ã«ã™ã‚‹ã«ã¯ã€`when` ã§ã¯ãªã `maybeWhen` ã‚„ `whenData` ã‚’ä½¿ã£ãŸã‚Šã€ã‚ã‚‹ã„ã¯ `asData?.value` ã‚’ä½¿ã£ã¦ã€Œç¾åœ¨èª­ã¿è¾¼ã¿ä¸­ã§ã‚‚å‰å›ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ãªã‚‰ãã¡ã‚‰ã‚’è¡¨ç¤ºã™ã‚‹ã€å®Ÿè£…ã«ã™ã‚‹æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚

3. **ä¸è¦ãªåˆæœŸãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ï¼ˆuseEffect ãªã©ã§å¼·åˆ¶ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ï¼‰ã‚’é¿ã‘ã‚‹**  
   - åˆå›ãƒ“ãƒ«ãƒ‰æ™‚ã«ã™ã `onRefresh()` ã‚’å‘¼ã‚“ã§ã—ã¾ã†ã¨ã€ã›ã£ã‹ã Provider å´ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦ã„ã¦ã‚‚ã€ã¾ãŸã™ã `loading` â†’ `data` ãŒåˆ‡ã‚Šæ›¿ã‚ã‚Š UI ãŒãƒãƒ©ã¤ãåŸå› ã«ãªã‚Šã¾ã™ã€‚  
   - ãƒšãƒ¼ã‚¸ã«å…¥ã£ãŸã‚‰è‡ªå‹•ã§ãƒ‡ãƒ¼ã‚¿ã‚’æœ€æ–°åŒ–ã—ãŸã„å ´åˆã§ã‚‚ã€ã€Œã™ã§ã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã¨ãã¯ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã«ã¯ã—ãªã„ã€ã¨ã„ã†å·¥å¤«ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚

---

ä»¥ä¸‹ã§ã¯ã€**ã€Œãƒ­ãƒ¼ãƒ‰ä¸­ã‚‚å‰å›ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã—ã¤ã¤ã€å–å¾—å®Œäº†ã—ãŸã‚‰å·®ã—æ›¿ãˆã‚‹ã€** ã¨ã„ã†ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’ç¤ºã—ã¾ã™ã€‚  
- `autoDispose` ã¯æ®‹ã—ãŸã¾ã¾ã§ã€å‰å›ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã†å½¢ã§ã™ã€‚  
- ã‚‚ã—ã€Œç”»é¢ã‚’é›¢ã‚Œã¦æˆ»ã£ãŸã¨ãã«å†èª­è¾¼ã¯ã—ã¦ã»ã—ããªã„ã€ã¨ã„ã†ã®ã§ã‚ã‚Œã°ã€`autoDispose` ã‚’å¤–ã™ã‹ã€`keepAlive` ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚

### 1. ãƒ—ãƒ­ãƒã‚¤ãƒ€å‘¨ã‚Šã®è¨­å®š

```dart
final combinedWalletDataProvider =
    FutureProvider.autoDispose<(WalletBalanceResponseDTOData?, GetUserNftsResponseDTOData?)>(
  (ref) async {
    final wallet = await ref.watch(getWalletNotifierProvider.future);
    final nfts = await ref.watch(getNftsNotifierProvider.future);
    return (wallet, nfts);
  },
);
```

`autoDispose` ä»˜ãã§ã‚‚å•é¡Œã‚ã‚Šã¾ã›ã‚“ãŒã€  
- ã€Œãƒšãƒ¼ã‚¸é›¢è„±å¾Œã‚‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä¿æŒã—ãŸã„ã€ã€Œæˆ»ã£ã¦ã‚‚ãƒãƒ©ã¤ã„ã¦ã»ã—ããªã„ã€  
- ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒšãƒ¼ã‚¸ã‚’é›¢ã‚Œã‚‹ãŸã³ã«å†å–å¾—ã—ãªãã¦ã‚ˆã„ã€  

ã¨ã„ã£ãŸå ´åˆã¯ã€`autoDispose` ã‚’å¤–ã™ã‹ä»¥ä¸‹ã®ã‚ˆã†ã« `keepAlive` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ï¼ˆRiverpod v2 ç³»ã®å ´åˆï¼‰:

```dart
final combinedWalletDataProvider =
    FutureProvider.autoDispose
        .keepAlive()    // â† ã“ã‚Œã‚’ä»˜ã‘ã‚‹
        .<(WalletBalanceResponseDTOData?, GetUserNftsResponseDTOData?)>(
  (ref) async {
    final wallet = await ref.watch(getWalletNotifierProvider.future);
    final nfts = await ref.watch(getNftsNotifierProvider.future);
    return (wallet, nfts);
  },
);
```

### 2. Widget å´ã§ã€Œå‰å›ãƒ‡ãƒ¼ã‚¿ã‚’æ¡ã‚Šç¶šã‘ã‚‹ã€å®Ÿè£…ä¾‹

`build` ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ `ref.watch(combinedWalletDataProvider)` ã—ã¦å—ã‘å–ã‚‹ `AsyncValue` ã‚’ä½¿ã„ã€**ã€Œã™ã§ã«ãƒ‡ãƒ¼ã‚¿ã‚’æŒã£ã¦ã„ãŸã‚‰ãƒ­ãƒ¼ãƒ‰ä¸­ã§ã‚‚å‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã—ç¶šã‘ã‚‹ã€**ã‚ˆã†ã«ã—ã¾ã™ã€‚  
ã‚‚ã£ã¨ã‚‚ç°¡å˜ãªã®ã¯ã€Hook ã® `useState` ã‚„ `useRef` ãªã©ã«å‰å›ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¦ãŠãã€`loading` ã«å…¥ã£ã¦ã‚‚ãã¡ã‚‰ã‚’å‚ç…§ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚

```dart
class WalletPage extends HookConsumerWidget {
  const WalletPage({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    // â‘  Provider ã®çŠ¶æ…‹ã‚’ç›£è¦–
    final combinedWalletAsyncValue = ref.watch(combinedWalletDataProvider);

    // â‘¡ ç›´è¿‘ã®æˆåŠŸãƒ‡ãƒ¼ã‚¿ã‚’ä¿ç®¡ã™ã‚‹ãŸã‚ã® State
    final prevData = useState<(WalletBalanceResponseDTOData?, GetUserNftsResponseDTOData?)?>(null);

    // â‘¢ ç”»é¢ã‚’å¼•ã£å¼µã£ã¦æ›´æ–°ã™ã‚‹å‡¦ç†
    Future<void> onRefresh() async {
      try {
        // ã“ã“ã§ã¯ getNftsNotifierProvider ã¨ getWalletNotifierProvider ã‚’
        // å†åº¦èª­ã¿è¾¼ã‚€å½¢ã§ã™ãŒã€ãã®ã¾ã¾ã§ã‚‚ OKã€‚æ”¹ä¿®ã¯ä»»æ„ã§ã™ã€‚
        await ref.read(getNftsNotifierProvider.notifier).getNfts();
        await ref.read(getWalletNotifierProvider.notifier).getWallet();
      } catch (error) {
        if (context.mounted) {
          showErrorSnackBar(context, error);
        }
      }
    }

    // â‘£ when ã§çŠ¶æ…‹ã«å¿œã˜ã¦ UI ã‚’åˆ†å²
    //    ãƒ­ãƒ¼ãƒ‰ä¸­ã§ã‚‚å‰å›ãƒ‡ãƒ¼ã‚¿ (prevData.value) ãŒã‚ã‚Œã°ãã‚Œã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã™ã‚‹
    Widget child;
    child = combinedWalletAsyncValue.when(
      data: (data) {
        // ãƒ‡ãƒ¼ã‚¿ã‚’æ­£å¸¸ã«å–å¾—ã§ããŸã‚‰ prevData ã«ä¿å­˜
        prevData.value = data;
        return _buildBody(context, ref, data, onRefresh);
      },
      loading: () {
        // ãƒ­ãƒ¼ãƒ‰ä¸­ã ã‘ã©å‰å›ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ãªã‚‰ã€ãã‚Œã‚’ä½¿ã£ã¦ç”»é¢ã‚’æ§‹ç¯‰
        final cached = prevData.value;
        if (cached != null) {
          return _buildBody(context, ref, cached, onRefresh);
        }
        // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚‚ãªã„ãªã‚‰ã€ã¾ã ä¸€åº¦ã‚‚æˆåŠŸãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã£ã¦ã„ãªã„ã¨ã„ã†ã“ã¨ãªã®ã§
        // ã¨ã‚Šã‚ãˆãšãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã ã‘è¡¨ç¤º
        return const Center(child: CircularProgressIndicator());
      },
      error: (error, stackTrace) {
        // ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ã€ã‚‚ã—å‰å›ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Œã°è¡¨ç¤ºã—ç¶šã‘ã¦ã‚‚ã„ã„ã—
        // ã‚ã‚‹ã„ã¯ã‚¨ãƒ©ãƒ¼ç”»é¢ã«å¤‰ãˆã¦ã‚‚ã‚ˆã„
        return Center(child: Text('Error: $error'));
      },
    );

    return Scaffold(
      appBar: AppBar(title: const Text('Wallet')),
      body: RefreshIndicator(
        onRefresh: onRefresh,
        color: ColorToken.primary,
        backgroundColor: ColorToken.bgLight,
        child: child,
      ),
    );
  }

  // å®Ÿéš›ã®æç”»éƒ¨åˆ†ï¼ˆchild ã®ä¸­èº«ï¼‰ã‚’åˆ¥ãƒ¡ã‚½ãƒƒãƒ‰ã«åˆ‡ã‚Šå‡ºã™
  // ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã§ã‚‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã§ã‚‚åŒã˜UIæ§‹ç¯‰æ‰‹æ®µã‚’å‘¼ã¹ã‚‹
  Widget _buildBody(
    BuildContext context,
    WidgetRef ref,
    (
      WalletBalanceResponseDTOData?,
      GetUserNftsResponseDTOData?
    ) data,
    Future<void> Function() onRefresh,
  ) {
    final walletData = data.$1;
    final nftsData = data.$2;

    // ãƒ‡ãƒ¼ã‚¿ãŒ null ãªã‚‰ä½•ã‚‚ã—ãªã„å ´åˆ
    if (walletData == null || nftsData == null) {
      return const SizedBox.shrink();
    }

    // ä»¥ä¸‹ã€å…ƒã®ã‚³ãƒ¼ãƒ‰ã¨åŒæ§˜ã« UI ã‚’ä½œã‚‹
    final stpValue = walletData.stpAmount ?? 0;
    final tmpWalletAddress = walletData.walletAddress ?? '';
    final walletAddress = tmpWalletAddress.isNotEmpty ? tmpWalletAddress : 'No Address';
    final explorers = nftsData.explorers ?? [];
    final flags = nftsData.flags ?? [];

    // ç•¥: explorers, flags ã‚’ Nft ã«å¤‰æ›ã™ã‚‹ã¨ã“ã‚ã¯åŒã˜
    final explorerNfts = explorers.map((explorer) {
      final nameParts = explorer.explorerName?.split(' #') ?? ['', ''];
      final name = nameParts[0];
      final number = nameParts.length > 1 ? '#${nameParts[1]}' : '';
      return Nft(
        nftId: explorer.explorerId ?? '',
        tokenId: explorer.tokenId ?? '',
        name: name,
        number: number,
        imageUrl: explorer.explorerImage ?? '',
        nftType: NftType.explorer,
        explorer: explorer,
      );
    }).toList();

    final flagNfts = flags.map((flag) {
      final nameParts = flag.flagName?.split(' #') ?? ['', ''];
      final name = nameParts[0];
      final number = nameParts.length > 1 ? '#${nameParts[1]}' : '';
      return Nft(
        nftId: flag.flagId ?? '',
        tokenId: flag.tokenId ?? '',
        name: name,
        number: number,
        imageUrl: flag.flagImage ?? '',
        nftType: NftType.flag,
        flag: flag,
      );
    }).toList();

    final allNfts = [
      ...explorerNfts,
      ...flagNfts,
    ];

    return SingleChildScrollView(
      physics: const AlwaysScrollableScrollPhysics(),
      child: Padding(
        padding: const EdgeInsets.all(24),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            // STPæ®‹é«˜è¡¨ç¤º
            DecoratedBox(
              decoration: BoxDecoration(
                color: ColorToken.bg,
                borderRadius: BorderRadius.circular(8),
                border: Border.all(color: ColorToken.border),
              ),
              child: Padding(
                padding: const EdgeInsets.all(24),
                child: Column(
                  children: [
                    Image.asset(
                      Assets.images.stpCoinIcon.path,
                      width: 32,
                      height: 32,
                    ),
                    const SizedBox(height: 14),
                    Row(
                      mainAxisAlignment: MainAxisAlignment.center,
                      crossAxisAlignment: CrossAxisAlignment.baseline,
                      textBaseline: TextBaseline.alphabetic,
                      children: [
                        Flexible(
                          child: AutoSizeText(
                            stpValue.toString(),
                            style: const TextStyle(
                              fontSize: 32,
                              fontWeight: FontWeight.bold,
                            ),
                            maxLines: 1,
                            minFontSize: 1,
                            overflow: TextOverflow.ellipsis,
                          ),
                        ),
                        const SizedBox(width: 6),
                        const Text(
                          'STP',
                          style: TextStyle(fontSize: 16),
                        ),
                      ],
                    ),
                    const SizedBox(height: 24),
                    GestureDetector(
                      onTap: () async {
                        // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã®ã‚³ãƒ”ãƒ¼
                        await Clipboard.setData(ClipboardData(text: walletAddress));
                        if (context.mounted) {
                          ScaffoldMessenger.of(context).showSnackBar(
                            SnackBar(content: Text('$walletAddress copied to clipboard')),
                          );
                        }
                      },
                      child: Container(
                        padding: const EdgeInsets.symmetric(horizontal: 10, vertical: 5),
                        decoration: BoxDecoration(
                          color: ColorPallet.gray800,
                          borderRadius: BorderRadius.circular(4),
                        ),
                        child: Text(
                          walletAddress,
                          maxLines: 1,
                          overflow: TextOverflow.ellipsis,
                          style: const TextStyle(
                            fontSize: 13,
                            color: ColorToken.primaryDark,
                          ),
                        ),
                      ),
                    ),
                  ],
                ),
              ),
            ),

            const SizedBox(height: 16),

            // NFTs
            const Text(
              'NFTs',
              style: TextStyle(
                fontSize: 16,
                fontWeight: FontWeight.bold,
              ),
            ),
            const SizedBox(height: 16),

            if (allNfts.isEmpty) const Center(child: Text('No NFTs owned')),

            Column(
              children: allNfts.map((nft) {
                return Padding(
                  padding: const EdgeInsets.only(bottom: 8),
                  child: ClipRRect(
                    borderRadius: BorderRadius.circular(8),
                    child: DecoratedBox(
                      decoration: BoxDecoration(
                        color: ColorToken.bg,
                        borderRadius: BorderRadius.circular(8),
                        border: Border.all(color: ColorToken.border),
                      ),
                      child: InkWell(
                        borderRadius: BorderRadius.circular(8),
                        onTap: () async {
                          // TODO: [ãƒ•ã‚§ãƒ¼ã‚º2] NFT è©³ç´°ç”»é¢ã¸ã®é·ç§»
                        },
                        child: Padding(
                          padding: const EdgeInsets.all(16),
                          child: Row(
                            children: [
                              ClipRRect(
                                borderRadius: BorderRadius.circular(4),
                                child: SquareImage(
                                  imageUrl: nft.imageUrl,
                                  size: 56,
                                ),
                              ),
                              const SizedBox(width: 16),
                              Expanded(
                                child: Column(
                                  crossAxisAlignment: CrossAxisAlignment.start,
                                  children: [
                                    Row(
                                      children: [
                                        Expanded(
                                          child: Text(
                                            nft.name,
                                            maxLines: 1,
                                            overflow: TextOverflow.ellipsis,
                                            style: const TextStyle(
                                              fontSize: 14,
                                              fontWeight: FontWeight.bold,
                                            ),
                                          ),
                                        ),
                                        const SizedBox(width: 4),
                                        Text(
                                          nft.number,
                                          maxLines: 1,
                                          overflow: TextOverflow.ellipsis,
                                          style: const TextStyle(
                                            fontSize: 12,
                                            fontWeight: FontWeight.bold,
                                            color: ColorPallet.gray300,
                                          ),
                                        ),
                                      ],
                                    ),
                                    const SizedBox(height: 12),
                                    Text(
                                      'TokenID: ${nft.tokenId}',
                                      maxLines: 1,
                                      overflow: TextOverflow.ellipsis,
                                      style: const TextStyle(
                                        fontSize: 12,
                                      ),
                                    ),
                                  ],
                                ),
                              ),
                            ],
                          ),
                        ),
                      ),
                    ),
                  ),
                );
              }).toList(),
            ),
            const SizedBox(height: 24),
          ],
        ),
      ),
    );
  }
}
```

ãƒã‚¤ãƒ³ãƒˆã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚

- `final prevData = useState<(WalletBalanceResponseDTOData?, GetUserNftsResponseDTOData?)?>(null);`
  - **å‰å›æˆåŠŸæ™‚ã®å€¤** ã‚’ä¿æŒã™ã‚‹ãŸã‚ã®ã‚¹ãƒ†ãƒ¼ãƒˆã§ã™ã€‚  
- `combinedWalletAsyncValue.when(â€¦)` ã® `loading` ãƒ–ãƒ­ãƒƒã‚¯ã§ã€  
  - `prevData.value`ï¼ˆå‰å›ã®å€¤ï¼‰ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ã£ã¦ `_buildBody` ã‚’å‘¼ã¶  
  - ãªã‘ã‚Œã°ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹  
- `data` ãŒæ¥ãŸã‚‰ `prevData.value = data;` ã¨ã—ã¦æ›´æ–°

ã“ã†ã™ã‚‹ã¨ã€ã„ã£ãŸã‚“ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ãŸå¾Œã¯**å†åº¦ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãŒã‹ã‹ã£ã¦ `loading` çŠ¶æ…‹ã«ãªã£ã¦ã‚‚**å³åº§ã«å¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã—ç¶šã‘ã‚‹ãŸã‚ã€**ç”»é¢ãŒç©ºã£ã½ã«ãªã£ã¦ã—ã¾ã†ç¬é–“ï¼ˆãƒãƒ©ã¤ãï¼‰** ãŒç„¡ããªã‚Šã¾ã™ã€‚

### 3. åˆå›ãƒã‚¦ãƒ³ãƒˆæ™‚ã« onRefresh() ã‚’å‘¼ã¶ã‹ã©ã†ã‹

è³ªå•æ–‡ã®ã‚³ãƒ¼ãƒ‰ã®ä¸­ã§

```dart
useEffect(
  () {
    Future.microtask(() async {
      await onRefresh();
    });
    return null;
  },
  [],
);
```

ã®ã‚ˆã†ã« **åˆå›ãƒ“ãƒ«ãƒ‰æ™‚ã«å¿…ãšãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã‚’ã‹ã‘ã‚‹** å®Ÿè£…ã«ãªã£ã¦ã„ã‚‹å ´åˆã€  
- Provider ãŒ `loading` â†’ `data` ã¨å¤‰ã‚ã‚‹é–“ã«ç”»é¢ãŒãƒãƒ©ã¤ã  
- ä¸Šè¨˜ã®ã€Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ã†ã€å®Ÿè£…ã‚’ã—ã¦ã„ãªã‘ã‚Œã°ä¸€ç¬ç©ºã®ç”»é¢ã«ãªã‚‹  

ã¨ã„ã†å•é¡ŒãŒèµ·ã“ã‚Šã¾ã™ã€‚  
ä»Šå›ã®ã‚ˆã†ã« **`FutureProvider` ãŒæœ€åˆã«èª­ã¿è¾¼ã¾ã‚ŒãŸæ™‚ç‚¹ã§ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚§ãƒƒãƒ** ã™ã‚‹ãªã‚‰ã€ã‚ã–ã‚ã–åˆå›ã« `onRefresh()` ã‚’å‘¼ã°ãªãã¦ã‚‚å®Ÿè³ªåŒã˜æŒ™å‹•ã«ãªã‚‹ãŸã‚ã€`useEffect` å†…ã® `onRefresh()` å‘¼ã³å‡ºã—ã‚’å‰Šé™¤ã—ã¦ã—ã¾ã£ã¦å•é¡Œãªã„ã‚±ãƒ¼ã‚¹ãŒå¤šã„ã§ã™ã€‚

ã‚‚ã—ã€Œç”»é¢ã«å…¥ã£ãŸã‚‰å¿…ãšæœ€æ–°ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šã«è¡ŒããŸã„ã€ã¨ã„ã†è¦æœ›ãŒã‚ã‚‹ãªã‚‰ã€`FutureProvider` å´ã‚„ Notifier å´ã§ `init` çš„ã«è‡ªå‹•å–å¾—ã™ã‚‹å®Ÿè£…ã‚’ã—ã¦ãŠã‘ã°ã€ã‚ã–ã‚ã–ç”»é¢å´ã§ `onRefresh()` ã‚’å‘¼ã°ãªãã¦ã‚‚åŒç­‰ã®å‹•ãã‚’ã—ã¾ã™ã€‚

---

## ã¾ã¨ã‚

- **ãƒãƒ©ã¤ãã®åŸå› **  
  1) `autoDispose` ã«ã‚ˆã£ã¦ãƒšãƒ¼ã‚¸ã‚’é›¢ã‚Œã‚‹ãŸã³ã«ãƒ—ãƒ­ãƒã‚¤ãƒ€ãŒç ´æ£„ â†’ å†å–å¾—ã§ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º â†’ ãƒãƒ©ã¤ã  
  2) ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ™‚ã«ç”»é¢ã‚’ä¸¸ã”ã¨ç©ºã£ã½ã‚„ `CircularProgressIndicator` ã«åˆ‡ã‚Šæ›¿ãˆã¦ã—ã¾ã„ã€æ—¢å­˜è¡¨ç¤ºãŒæ¶ˆãˆã¦ã„ã‚‹  
  3) åˆå›ãƒã‚¦ãƒ³ãƒˆæ™‚ã«ç„¡é§„ã«ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ï¼ˆå†å–å¾—ï¼‰ã‚’ã‹ã‘ã¦ã„ã‚‹  

- **æ”¹å–„ç­–**  
  - `autoDispose` ã‚’å¤–ã™ã‹ã€`keepAlive` ã‚’ä½¿ã„å¿…è¦ã«å¿œã˜ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ®‹ã™  
  - ãƒ­ãƒ¼ãƒ‰ä¸­ã§ã‚‚å‰å›ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã—ç¶šã‘ã‚‹ (â€œæ¥½è¦³çš„ UIâ€)  
  - åˆå›ã®å¼·åˆ¶ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã‚’ã‚„ã‚ã‚‹ï¼ˆProvider ã‚„ Notifier å´ã§åˆå›ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’ç®¡ç†ï¼‰

ã“ã‚Œã‚‰ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç”»é¢ã«æˆ»ã£ã¦ããŸã¨ãã‚„ãƒ—ãƒ«ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã—ãŸã¨ãã«ã€**å‰å›ã®ãƒ‡ãƒ¼ã‚¿ãŒä¸€ç¬ã§ã‚‚æ¶ˆãˆã‚‹**ã®ã‚’é˜²ãã€ã‚¹ãƒ ãƒ¼ã‚ºã«æ›´æ–°ï¼ˆï¼ãƒãƒ©ã¤ãã®è»½æ¸›ï¼‰ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/02/11 10:07:34*

ãã‚‚ãã‚‚if (nftsData == null || walletDate == null) {ã¨ãªã‚‹æ¡ä»¶ã§dataã‚’æ›´æ–°ã™ã‚‹å¿…è¦ãŒãªã„ã‚“ã 

@Riverpod(keepAlive: true)
class GetWalletNotifier extends _$GetWalletNotifier {
  @override
  Future&lt;WalletBalanceResponseDTOData?&gt; build() async =&gt; null;

  Future&lt;WalletBalanceResponseDTOData&gt; getWallet() async {
    final oldData = state.valueOrNull;
    if (oldData == null) {
      state = const AsyncValue.loading();
    }
    try {
      try {
        final api = await ref.watch(walletApiProvider.future);
        final response = await api.walletControllerGetBalance();
        debugPrint('Response Body: ${response.data}');
        debugPrint('Response Body.data: ${response.data?.data}');
        checkForApiError(response.data);
        final data = response.data?.data;
        if (data == null) {
          throw Exception('No data found');
        }
        state = AsyncValue.data(data);
        return data;
      } on DioException catch (error) {
        debugPrintDioException(error);
        checkForApiError(error.response?.data);
        rethrow;
      } on Exception {
        rethrow;
      }
    } on ApiError catch (error, stackTrace) {
      apiErrorHandling(error, ref);
      state = AsyncValue.error(error, stackTrace);
      rethrow;
    } on Exception catch (error, stackTrace) {
      debugPrint('Error: $error');
      state = AsyncValue.error(error, stackTrace);
      rethrow;
    }
  }
}

@Riverpod(keepAlive: true)
class GetNftsNotifier extends _$GetNftsNotifier {
  @override
  Future&lt;GetUserNftsResponseDTOData?&gt; build() async =&gt; null;

  Future&lt;GetUserNftsResponseDTOData&gt; getNfts() async {
    final oldData = state.valueOrNull;
    if (oldData == null) {
      state = const AsyncValue.loading();
    }
    try {
      try {
        final api = await ref.watch(usersApiProvider.future);
        final response = await api.userControllerGetUserNfts();
        debugPrint('Response Body: ${response.data}');
        debugPrint('Response Body.data: ${response.data?.data}');
        checkForApiError(response.data);
        final data = response.data?.data;
        if (data == null) {
          throw Exception('No data found');
        }
        state = AsyncValue.data(data);
        return data;
      } on DioException catch (error) {
        debugPrintDioException(error);
        checkForApiError(error.response?.data);
        rethrow;
      } on Exception {
        rethrow;
      }
    } on ApiError catch (error, stackTrace) {
      apiErrorHandling(error, ref);
      state = AsyncValue.error(error, stackTrace);
      rethrow;
    } on Exception catch (error, stackTrace) {
      debugPrint('Error: $error');
      state = AsyncValue.error(error, stackTrace);
      rethrow;
    }
  }
}

---

## ğŸ”§ ãƒ„ãƒ¼ãƒ«
*2025/02/11 10:08:04*

UIã®ã¡ã‚‰ã¤ãã‚’æŠ‘ãˆã‚‹ãŸã‚ã€nftsDataã‚„walletDateãŒnullã®ã¨ãã¯UIæ›´æ–°ã‚’çœç•¥ã™ã‚‹å·¥å¤«ãŒå¿…è¦ãªã‚“ã ã€‚è¾°ã®nullãƒã‚§ãƒƒã‚¯ã‚’å¤–ã™æ–¹æ³•ã‚„ã€å¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’ä¿ã¤æ–¹æ³•ã‚‚æ¢ã£ã¦ã„ã‚‹ã€‚

UIã®ã¡ã‚‰ã¤ãã‚’é˜²ããŸã‚ã«ã€nullã®å ´åˆã®è¿”å´ã‚’çœç•¥ã™ã‚‹æ–¹æ³•ã‚’æ¨¡ç´¢ã—ã¦ã„ã‚‹ã‚“ã ã€‚å¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã—ã¤ã¤ã€æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã‚’å¾…ã¤ã®ãŒè‰¯ã•ãã†ã ã­ã€‚

UIã®ã¡ã‚‰ã¤ãã‚’é˜²ããŸã‚ã€ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ãƒ“ãƒ«ãƒ‰æ™‚ã«nullã‚’è¿”ã•ãªã„ã‚ˆã†ã«ã—ã€å¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã—ã¤ã¤æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã‚’å¾…ã¤æ–¹æ³•ã‚’æ¨¡ç´¢ã—ã¦ã„ã‚‹ã€‚

ë„ì €íˆ nullì„ ë°˜í™˜í•˜ì§€ ì•Šê¸° ìœ„í•´ `build` ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë“œ í•˜ê±°ë‚˜ ê¸°ë³¸ ê°ì²´ë¥¼ ë°˜í™˜í•˜ëŠ” ë°©ë²•ì„ ì‚´í´ë³´ë©°, ì¬ê·€ í˜¸ì¶œ ë¬¸ì œë¥¼ í”¼í•˜ê¸° ìœ„í•œ ë‹¤ì–‘í•œ ì ‘ê·¼ ë°©ì‹ì„ ê³ ë¯¼í•˜ê³  ìˆì–´.

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/02/11 10:08:04*

ã¾ãšå¤§å‰æã¨ã—ã¦ã€ä»Šå›ã®ã‚ˆã†ã«

```dart
@override
Future<WalletBalanceResponseDTOData?> build() async => null;
```

ã¨ã„ã†å®Ÿè£…ã‚’ã—ã¦ã„ã‚‹ã¨ã€**ãƒ—ãƒ­ãƒã‚¤ãƒ€åˆæœŸåŒ–æ™‚ã¯å¿…ãš `null`** ãŒè¿”ã‚‹ä»•æ§˜ã«ãªã£ã¦ã„ã¾ã™ã€‚  
ãã®ãŸã‚ã€ç”»é¢ï¼ˆUIï¼‰å´ã§ `ref.watch(...)` ã—ãŸã¨ãã«æœ€åˆã¯ã€Œ`null` ãŒå…¥ã£ã¦ãã‚‹ã€â†’ `if (walletData == null || nftsData == null)` ã¨ã„ã†æ¡ä»¶ã«å…¥ã‚Šã€`SizedBox.shrink()` ç­‰ãŒè¿”ã‚‹å ´åˆãŒã‚ã‚‹ã€ã¨ã„ã†æµã‚Œã«ãªã‚Šã¾ã™ã€‚

---

## ã€Œnull ãƒ‡ãƒ¼ã‚¿ã¯ãã‚‚ãã‚‚ä¸è¦ã€ãªã®ã§ã‚ã‚Œã°

ã‚‚ã—ã€ŒåˆæœŸå€¤ã¨ã—ã¦ `null` ã‚’è¿”ã—ã¦ã€ãã‚Œã‚’ UI ã«åæ˜ ã™ã‚‹å¿…è¦ãŒãªã„ã€ã®ã§ã‚ã‚Œã°ã€**ã‚ã–ã‚ã– `build` ã§ `null` ã‚’è¿”ã•ãªãã¦ã‚‚ã‚ˆã„**ã§ã™ã€‚  
Riverpod ã® `@Riverpod` (Code-gen) ãª Notifier ã§ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè£…ãŒå¯èƒ½ã§ã™ã€‚

### ãƒ‘ã‚¿ãƒ¼ãƒ³A: build() å†…ã§å®Ÿéš›ã«æœ€åˆã®ãƒ•ã‚§ãƒƒãƒå‡¦ç†ã‚’ã™ã‚‹

```dart
@Riverpod(keepAlive: true)
class GetWalletNotifier extends _$GetWalletNotifier {
  @override
  Future<WalletBalanceResponseDTOData?> build() async {
    // buildãŒå‘¼ã°ã‚ŒãŸæ®µéšã§ã€APIã‚’å©ã„ã¦æœ€åˆã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦è¿”ã™
    // null ã«ãªã‚‰ãªã„ã‚ˆã†ã«ã‚¨ãƒ©ãƒ¼å‡¦ç†ã‚‚å…¥ã‚Œã¦ãŠã
    final api = await ref.watch(walletApiProvider.future);
    final response = await api.walletControllerGetBalance();
    checkForApiError(response.data);
    final data = response.data?.data;
    if (data == null) {
      throw Exception('No data found');
    }
    return data;
  }

  /// å†å–å¾—ã—ãŸã„æ™‚ã«å‘¼ã³å‡ºã™ãƒ¡ã‚½ãƒƒãƒ‰
  Future<WalletBalanceResponseDTOData> getWallet() async {
    // â€»ã‚¹ãƒ†ãƒ¼ãƒˆã¯ã™ã§ã« `build()` ã®æ™‚ç‚¹ã§ãƒ‡ãƒ¼ã‚¿æŒã£ã¦ã„ã‚‹
    //   ãŸã ã—å†å–å¾—ã—ãŸã„ã‚±ãƒ¼ã‚¹ã§ã¯æ˜ç¤ºçš„ã«ãƒªãƒ­ãƒ¼ãƒ‰å‡¦ç†ã‚’è¡Œã†
    // ä¾‹: ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã‚„RefreshIndicatorã§ä½¿ç”¨ã™ã‚‹
    state = const AsyncValue.loading();
    try {
      final api = await ref.watch(walletApiProvider.future);
      final response = await api.walletControllerGetBalance();
      checkForApiError(response.data);
      final data = response.data?.data;
      if (data == null) {
        throw Exception('No data found');
      }
      state = AsyncValue.data(data);
      return data;
    } catch (error, stack) {
      state = AsyncValue.error(error, stack);
      rethrow;
    }
  }
}
```

ä¸Šè¨˜ã®ã‚ˆã†ã«ã™ã‚‹ã¨ã€**ãƒ—ãƒ­ãƒã‚¤ãƒ€åˆæœŸåŒ–æ™‚ç‚¹** (ï¼ `build()` ãŒå‘¼ã°ã‚ŒãŸæ™‚ç‚¹) ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ãŸã‚ã€åˆå›ã« `null` ãŒè¿”ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒãªããªã‚Šã¾ã™ã€‚  
UI ã‹ã‚‰ã¿ã‚Œã°ã€åˆæœŸçŠ¶æ…‹ãŒ `AsyncValue.loading()` â†’ å–å¾—æˆåŠŸå¾Œã« `AsyncValue.data(...)` ã¨ãªã‚‹ãŸã‚ã€`nftsData == null` ã¨ã„ã£ãŸæ¡ä»¶åˆ†å²ãŒåŸºæœ¬çš„ã«ã¯ä¸è¦ã«ãªã‚Šã¾ã™ã€‚

&gt; â€» ã©ã†ã—ã¦ã‚‚ã€Œæœ€åˆã¯ã¾ã ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦ãŠã‚‰ãšã€æœ¬å½“ã«å€¤ãŒãªã„ã¨ãã« `null` ã‚’è¿”ã—ãŸã„ã€ã¨ã„ã†ç‰¹æ®Šãªå ´åˆã¯åˆ¥ã§ã™ãŒã€å¤šãã®ã‚±ãƒ¼ã‚¹ã§ã¯ã€Œåˆå›ã‹ã‚‰APIã§ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šã«è¡Œã£ã¦ã»ã—ã„ã€ã“ã¨ãŒå¤šã„ã®ã§ã€`build` ã§ fetch ã™ã‚‹ã»ã†ãŒè‡ªç„¶ã§ã™ã€‚

---

### ãƒ‘ã‚¿ãƒ¼ãƒ³B: build() ã¯ä½¿ã‚ãšã€å¤–éƒ¨ã‹ã‚‰æ˜ç¤ºçš„ã«ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã‚“ã§fetchã™ã‚‹ï¼ˆStateControllerçš„ã«ä½¿ã†ï¼‰

ã‚‚ã—ã€Œãƒ—ãƒ­ãƒã‚¤ãƒ€ç”Ÿæˆæ™‚ã«ã¯å³ãƒ•ã‚§ãƒƒãƒã—ãªã„ã€‚å¿…è¦ã«ãªã£ãŸæ™‚ç‚¹ã§ `getWallet()` ã‚’å‘¼ã³å‡ºã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–ã£ã¦ããŸã„ã€ã¨ã„ã†ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãªã‚‰ã€`build` ã¯ä½¿ã‚ãšã«ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãã“ã¨ã‚‚ã§ãã¾ã™ã€‚

#### 1) Notifier ãƒ¡ã‚½ãƒƒãƒ‰ã ã‘ã‚’å®šç¾©ã™ã‚‹

```dart
@Riverpod(keepAlive: true)
class GetWalletNotifier extends _$GetWalletNotifier {
  /// buildã§ã¯ä½•ã‚‚ã›ãšã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¾ã å€¤ãŒç„¡ã„(=null)çŠ¶æ…‹ã¨ã—ã¦ãŠã
  @override
  FutureOr<WalletBalanceResponseDTOData?> build() async {
    // ã“ã“ã§ã¯ç‰¹ã«åˆæœŸãƒ•ã‚§ãƒƒãƒã‚’è¡Œã‚ãªã„
    return null; 
  }

  /// å®Ÿéš›ã«ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šã«ã„ãå‡¦ç†
  Future<WalletBalanceResponseDTOData> getWallet() async {
    // ã™ã§ã«æŒã£ã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Œã°loadingã«ã—ãªã„ ãªã©ã®åˆ¤å®šã¯è‡ªç”±
    final oldData = state.valueOrNull;
    if (oldData == null) {
      state = const AsyncValue.loading();
    }
    try {
      final api = await ref.watch(walletApiProvider.future);
      final response = await api.walletControllerGetBalance();
      checkForApiError(response.data);
      final data = response.data?.data;
      if (data == null) {
        throw Exception('No data found');
      }
      state = AsyncValue.data(data);
      return data;
    } catch (error, stackTrace) {
      state = AsyncValue.error(error, stackTrace);
      rethrow;
    }
  }
}
```

#### 2) UI å´ã®ä½¿ã„æ–¹

ã“ã†ã™ã‚‹ã¨ã€ã€ŒUI ã§æœ€åˆã«è¡¨ç¤ºã•ã‚ŒãŸæ™‚ç‚¹ã§ã¯ `state.valueOrNull == null`ã€ã§ã™ãŒã€  
ãƒ¦ãƒ¼ã‚¶ãŒç”»é¢ã‚’é–‹ã„ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚„ PullToRefresh ã‚’ã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ãªã©ã€å¿…è¦ãªã¨ãã« `getWallet()` ã‚’å‘¼ã‚“ã§ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚  
ä¾‹ãˆã°

```dart
final walletAsync = ref.watch(getWalletNotifierProvider);

@override
Widget build(BuildContext context, WidgetRef ref) {
  useEffect(() {
    // åˆå›ãƒã‚¦ãƒ³ãƒˆæ™‚ã«ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚ŠãŸã„ãªã‚‰
    Future.microtask(() async {
      await ref.read(getWalletNotifierProvider.notifier).getWallet();
    });
    return null;
  }, []);

  return walletAsync.when(
    data: (walletData) {
      if (walletData == null) {
        // å–å¾—ã—ã¦ã„ãªã„ or å–å¾—å¤±æ•—å¾Œã®ã¾ã¾ ãªã©
        return const Text('No data yet');
      }
      // ã“ã“ã§walletDataã‚’ä½¿ã£ã¦UIã‚’æç”»
      return Text('STP = ${walletData.stpAmount}');
    },
    loading: () => const CircularProgressIndicator(),
    error: (e, st) => Text('Error: $e'),
  );
}
```

ã“ã®ã‚ˆã†ãªä»•çµ„ã¿ã«ã™ã‚Œã°ã€**â€œå¿…è¦ã«ãªã£ãŸã‚‰ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã‚“ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–ã£ã¦ãã‚‹â€** ã¨ã„ã†æµã‚Œã§ã€`null` ã«ãªã£ã¦ã„ã‚‹ã‹ã©ã†ã‹ã¯ã‚ãªãŸã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«æ¬¡ç¬¬ã¨ã„ã†å½¢ã«ãªã‚Šã¾ã™ã€‚

---

## nullãƒã‚§ãƒƒã‚¯ã‚’ã—ãªãã¦æ¸ˆã‚€ã‚ˆã†ã«ã™ã‚‹ã‹ã€ã‚‚ã—ãã¯ã€Œnullãªã‚‰å‰å›ã®å€¤ã‚’ä½¿ã†ã€ã‹

ã„ãšã‚Œã«ã›ã‚ˆã€**UI ã§ã€Œnullã ã£ãŸã‚‰ `SizedBox.shrink()`ã€ã®ã‚ˆã†ã«æ›¸ã„ã¦ã—ã¾ã†ã¨ã€ãã“ãŒãƒãƒ©ã¤ãã®åŸå› ã«ãªã‚‹**ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚  
å¯¾ç­–ã¨ã—ã¦ã¯:

1. **æœ€åˆã‹ã‚‰ `null` ã‚’è¿”ã•ãªã„è¨­è¨ˆã«ã™ã‚‹**  
   - ä¸Šè¨˜ãƒ‘ã‚¿ãƒ¼ãƒ³A ã®ã‚ˆã†ã« `build()` ã§ã¡ã‚ƒã‚“ã¨ fetch ã—ã¦ â€œæœ€åˆã‹ã‚‰å¿…ãš `AsyncValue.data(...)` ã‹ `AsyncValue.error(...)` ã«ãªã‚‹ã‚ˆã†ã«ã™ã‚‹â€  
   - â†’ ã“ã†ã™ã‚‹ã¨ `null` ç”¨ã®åˆ†å²ãŒä¸è¦ã«ãªã‚Šã€ãƒãƒ©ã¤ãã¯æ¸›ã‚Šã¾ã™ã€‚

2. **ãƒ­ãƒ¼ãƒ‰ä¸­ãƒ»ã‚¨ãƒ©ãƒ¼æ™‚ãƒ»ã‚ã‚‹ã„ã¯ `null` ã®å ´åˆã§ã‚‚ã€å‰å›è¡¨ç¤ºã—ã¦ã„ãŸãƒ‡ãƒ¼ã‚¿ã‚’æ®‹ã™**  
   - UI å´ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦ãŠãã€`loading`/`error` ã§ã‚‚ã€Œå¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã†ã€ã‚ˆã†ã«ã™ã‚‹  
   - ã“ã‚Œã«ã‚ˆã‚Šã€Œç”»é¢ãŒã¾ã£ã•ã‚‰ã«æ¶ˆãˆã‚‹ç¬é–“ã€ã‚’ãªãã—ã¾ã™ã€‚  
   - ãŸã¨ãˆã°å‰å›ã®å›ç­”ã®ã‚ˆã†ã«ã€`useState` ãªã©ã§å‰å›ã® `data` ã‚’è¦šãˆã¦ãŠã â†’ ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã«ãªã£ã¦ã‚‚ `prevData` ã‚’è¡¨ç¤ºã™ã‚‹  
   - ãã‚‚ãã‚‚ `build` ã§æ—¢ã«å€¤ã‚’è¿”ã—ã¦ã„ã‚Œã°ã€åˆå›ã‹ã‚‰ãƒ­ãƒ¼ãƒ‰ä¸­ã‚‚å€¤ãŒ `AsyncValue.data` ã®ã¾ã¾ãªã®ã§â€œUIãŒã¾ã£ã•ã‚‰ã«æ¶ˆãˆã‚‹â€ã“ã¨ã¯ãªã„ã€ã¨ã„ã†è¨­è¨ˆã«ã§ãã¾ã™ã€‚

---

## ã¾ã¨ã‚

- ã€Œ`if (nftsData == null || walletDate == null)` ã«ãªã‚‹æ¡ä»¶ãªã‚“ã¦ã€å¿…è¦ãªã„ã—ç™ºç”Ÿã•ã›ãŸããªã„ã€ã¨ã„ã†ã®ã§ã‚ã‚Œã°ã€  
  **Notifier ã®åˆæœŸå®Ÿè£…ï¼ˆ`build()` ã®æˆ»ã‚Šå€¤ï¼‰ã‚’ `null` ã«ã—ãªã„ã‚ˆã†ã«ã™ã‚‹** ã‹ã€**UI å´ã§ã€Œnull ã«ãªã£ãŸã‚‰å‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã†ã€** ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚  
- Riverpod ã® `@Riverpod` Notifier ã¯ã€`build()` ã‚’ä½¿ã£ã¦åˆæœŸãƒ•ã‚§ãƒƒãƒã‚’ã™ã‚‹å®Ÿè£…ãŒç‹é“ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚  
  - ã“ã†ã™ã‚‹ã¨åˆæœŸå€¤ã§ `null` ã‚’è¿”ã™ã“ã¨ãŒãªããªã‚‹ãŸã‚ã€UI ã§ã‚ã–ã‚ã– `null` ãƒã‚§ãƒƒã‚¯ã‚’ã›ãšã«æ¸ˆã‚€å ´é¢ãŒå¢—ãˆã¾ã™ã€‚  

ã€Œ**UI ã§ `null` åˆ¤å®šã™ã‚‹ã®ãŒé¢å€’**ã€ã¨æ„Ÿã˜ã¦ã„ã‚‹ãªã‚‰ã€ã¾ãšã¯ **Notifier å´ã§åˆæœŸãƒ•ã‚§ãƒƒãƒã—ã¦åˆæœŸçŠ¶æ…‹ã‚’ `null` ã«ã—ãªã„** å®Ÿè£…ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã®ãŒæœ€ã‚‚ã‚¹ãƒƒã‚­ãƒªã™ã‚‹æ–¹æ³•ã§ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/02/11 10:10:41*

ã“ã“ã‚’nullè¨±å®¹ã—ãªã„æŠ€ã§å¯¾å¿œã§ããªã„ã‹ï¼Ÿ

final combinedWalletDataProvider = FutureProvider.autoDispose&lt;
    (
      WalletBalanceResponseDTOData?,
      GetUserNftsResponseDTOData?,
    )&gt;((ref) async {
  final wallet = await ref.watch(getWalletNotifierProvider.future);
  final nfts = await ref.watch(getNftsNotifierProvider.future);

  return (wallet, nfts);
});

---

## ğŸ”§ ãƒ„ãƒ¼ãƒ«
*2025/02/11 10:11:05*

ã‚¨ãƒ©ãƒ¼é€šçŸ¥ã®æ–¹æ³•ã‚’æ¤œè¨ã—ã¦ã„ã‚‹ã€‚

ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’è€ƒæ…®ã™ã‚‹

ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ææ¡ˆã‚’æ¤œè¨ä¸­

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/02/11 10:11:05*

çµè«–ã‹ã‚‰è¨€ã†ã¨ã€**ã€ŒcombinedWalletDataProvider ã§ `null` è¨±å®¹ã—ãªã„å½¢ `(WalletBalanceResponseDTOData, GetUserNftsResponseDTOData)` ã‚’è¿”ã—ãŸã„ã€**ã®ã§ã‚ã‚Œã°ã€**ã€Œãã‚‚ãã‚‚ Notifier å´ã§ã‚‚ `null` ã‚’è¿”ã•ãªã„ (ï¼ `throw Exception` ç­‰ã‚’ä½¿ã£ã¦ã‚¨ãƒ©ãƒ¼ã«ã™ã‚‹)ã€**ã¨ã„ã†å®Ÿè£…ã«å¤‰ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

---

# å®Ÿç¾ã®ãŸã‚ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **`GetWalletNotifier` / `GetNftsNotifier` ã®æˆ»ã‚Šå€¤ã‚’ â€œå¿…ãšé nullâ€ ã«ã™ã‚‹**  
   - å…·ä½“çš„ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã« `build()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚„ `getXXX()` ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ã€Œã‚‚ã— `data == null` ãªã‚‰ã‚¨ãƒ©ãƒ¼ã‚’ throwã€ã—ã¦ã€ãã®ã¾ã¾ `WalletBalanceResponseDTOData` / `GetUserNftsResponseDTOData` ã‚’è¿”ã™å½¢ã«ã—ã¾ã™ã€‚  
   - ãã†ã™ã‚‹ã“ã¨ã§ã€Notifier ãŒè¿”ã™å‹ã‚’ `Future<WalletBalanceResponseDTOData>` / `Future<GetUserNftsResponseDTOData>` ã«å¤‰æ›´ã§ãã¾ã™ã€‚

2. **`combinedWalletDataProvider` ã§å—ã‘å–ã‚‹å‹ã‚’ `(WalletBalanceResponseDTOData, GetUserNftsResponseDTOData)` ã«ã™ã‚‹**  
   - ã“ã‚Œã«ã‚ˆã‚Šã€ã€Œ`null` ãŒæ··ã˜ã£ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€ã¨ã„ã†å‰æãŒæ¶ˆãˆã‚‹ãŸã‚ã€UI å´ã® `if (nftsData == null || walletData == null)` ã®ã‚ˆã†ãªåˆ†å²ã‚’ã—ãªãã¦æ¸ˆã¿ã¾ã™ã€‚  
   - ä»£ã‚ã‚Šã«ã€ã‚‚ã— API ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒ `null`ï¼ˆãƒ‡ãƒ¼ã‚¿ç„¡ã—ï¼‰ã ã£ãŸå ´åˆã¯ throw ã•ã‚Œã‚‹ â†’ ã¤ã¾ã‚Š `combinedWalletDataProvider` ã¯ `AsyncValue.error(...)` ã«ãªã‚‹ã‹ã€`AsyncValue.data(...)` ã«ãªã‚‹ã‹ã€ã®ã©ã¡ã‚‰ã‹ã«ãªã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚

---

## å…·ä½“ä¾‹

### 1. `GetWalletNotifier` ã‚’ã€Œå¿…ãšé null ã§è¿”ã™ã€ã‚ˆã†ã«ã™ã‚‹

```dart
@Riverpod(keepAlive: true)
class GetWalletNotifier extends _$GetWalletNotifier {
  // build() ã§åˆæœŸãƒ•ã‚§ãƒƒãƒã‚’è¡Œã†ã‹ã€è¡Œã‚ãªã„ã‹ã¯ãŠå¥½ã¿ã§ã€‚
  // ã“ã“ã§ã¯ä¾‹ã¨ã—ã¦ã€Œbuild()æ™‚ç‚¹ã§å³å–å¾—ã€ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç¤ºã™
  @override
  Future<WalletBalanceResponseDTOData> build() async {
    return _fetchWallet();
  }

  Future<WalletBalanceResponseDTOData> getWallet() async {
    // stateã‚’å†ãƒ­ãƒ¼ãƒ‰ä¸­ã«ã—ãŸã„å ´åˆ
    state = const AsyncValue.loading();
    try {
      final data = await _fetchWallet();
      // å–å¾—ã—ãŸ data ãŒ null ãªã‚‰ throw â†’ ã¤ã¾ã‚Šå¿…ãš non-null ã§è¿”ã™
      state = AsyncValue.data(data);
      return data;
    } catch (error, stackTrace) {
      state = AsyncValue.error(error, stackTrace);
      rethrow;
    }
  }

  Future<WalletBalanceResponseDTOData> _fetchWallet() async {
    // å®Ÿéš›ã® API å‘¼ã³å‡ºã—
    final api = await ref.watch(walletApiProvider.future);
    final response = await api.walletControllerGetBalance();
    checkForApiError(response.data);

    final data = response.data?.data;
    if (data == null) {
      // ã“ã“ã§å¿…ãšä¾‹å¤–ã«ã—ã¦ã„ã‚‹
      throw Exception('No wallet data found');
    }
    return data; // data ã¯ non-null
  }
}
```

#### ãƒã‚¤ãƒ³ãƒˆ
- `WalletBalanceResponseDTOData?` (nullable) ã§ã¯ãªã `WalletBalanceResponseDTOData` (non-nullable) ã‚’æ‰±ã†ã‚ˆã†ã«å¤‰æ›´  
- ã€Œãƒ‡ãƒ¼ã‚¿ãŒ null ã ã£ãŸã‚‰ã©ã†ã™ã‚‹ã‹ã€ã¯ã€**ä¾‹å¤–ã¨ã—ã¦æŠ•ã’ã‚‹ (ï¼å–å¾—å¤±æ•—æ‰±ã„)**  
- ã“ã‚Œã«ã‚ˆã‚Šã€ŒNotifier ã®æˆ»ã‚Šå€¤ã¯çµ¶å¯¾ã«é nullã€ãªã®ã§ã€UI å´ã§ `null` ãƒã‚§ãƒƒã‚¯ã‚’æ›¸ãå¿…è¦ãŒãªããªã‚‹

### 2. `GetNftsNotifier` ã‚‚åŒæ§˜ã«æ›¸ãæ›ãˆã‚‹

```dart
@Riverpod(keepAlive: true)
class GetNftsNotifier extends _$GetNftsNotifier {
  @override
  Future<GetUserNftsResponseDTOData> build() async {
    return _fetchNfts();
  }

  Future<GetUserNftsResponseDTOData> getNfts() async {
    state = const AsyncValue.loading();
    try {
      final data = await _fetchNfts();
      state = AsyncValue.data(data);
      return data;
    } catch (error, stackTrace) {
      state = AsyncValue.error(error, stackTrace);
      rethrow;
    }
  }

  Future<GetUserNftsResponseDTOData> _fetchNfts() async {
    final api = await ref.watch(usersApiProvider.future);
    final response = await api.userControllerGetUserNfts();
    checkForApiError(response.data);

    final data = response.data?.data;
    if (data == null) {
      throw Exception('No user NFT data found');
    }
    return data;
  }
}
```

### 3. `combinedWalletDataProvider` ã‚’é null ã®ã‚¿ãƒ—ãƒ«ã«ã™ã‚‹

Notifier å´ãŒã€Œå¿…ãšé nullã€ã«ãªã£ãŸã®ã§ã€çµåˆã™ã‚‹æ–¹ã§ã‚‚ `?` ã‚’å¤–ã—ã¾ã™ã€‚

```dart
final combinedWalletDataProvider = FutureProvider.autoDispose<
    (WalletBalanceResponseDTOData, GetUserNftsResponseDTOData)
>((ref) async {
  // ã“ã“ã§ãã‚Œãã‚Œ non-null ã«ãªã£ãŸ Notifier ã‚’ .future ã§å¾…ã¡å—ã‘ã‚‹
  final wallet = await ref.watch(getWalletNotifierProvider.future);
  final nfts = await ref.watch(getNftsNotifierProvider.future);
  // ã‚¿ãƒ—ãƒ«ã«ã—ã¦è¿”ã™ãŒã€ã‚‚ã†ä¸¡æ–¹ã¨ã‚‚ non-null
  return (wallet, nfts);
});
```

### 4. UI å´ã§ `null` ãƒã‚§ãƒƒã‚¯ã‚’ã—ãªãã¦æ¸ˆã‚€

```dart
final combinedWalletAsyncValue = ref.watch(combinedWalletDataProvider);

return combinedWalletAsyncValue.when(
  data: (data) {
    // ã™ã§ã« null ã§ã¯ãªã„ã®ã§ã€ã“ã†æ›¸ã‘ã‚‹
    final walletData = data.$1;
    final nftsData = data.$2;

    // ã“ã“ã§ `if (walletData == null || nftsData == null)` ã®åˆ†å²ã¯ä¸è¦
    // ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦UIã‚’æ§‹ç¯‰
    return _buildBody(walletData, nftsData);
  },
  loading: () => const CircularProgressIndicator(),
  error: (e, st) => Text('Error: $e'),
);
```

ã“ã‚Œã§ã€ŒåˆæœŸçŠ¶æ…‹ãŒ null â†’ `SizedBox.shrink()` ã‚’è¿”ã™ã€ã¨ã„ã£ãŸåˆ†å²ã¯å¿…è¦ãªããªã‚Šã¾ã™ã€‚  
ã‚‚ã— API å´ã§ãƒ‡ãƒ¼ã‚¿ãŒå¾—ã‚‰ã‚Œãªã„å ´åˆã¯ `throw Exception('No data found')` ã«ã‚ˆã£ã¦ `AsyncValue.error(...)` ã«ãªã‚Šã€`error` ãƒ–ãƒ­ãƒƒã‚¯ã«å…¥ã‚‹ã ã‘ã§ã™ã€‚

---

# ã¾ã¨ã‚

- **Notifier å´ã§ `WalletBalanceResponseDTOData?` ã‹ã‚‰ `WalletBalanceResponseDTOData` ã«å¤‰ãˆã‚‹**  
  - `data == null` ã®ã¨ãã¯ `throw Exception(...)` ã™ã‚‹  
- **`combinedWalletDataProvider` ã‚‚ `?` ã‚’å¤–ã—ã¦ â€œé null ã‚¿ãƒ—ãƒ«â€ ã«æ›¸ãæ›ãˆã‚‹**  
- ã“ã†ã™ã‚‹ã“ã¨ã§ã€UI å´ã§ã¯ `null` ãƒã‚§ãƒƒã‚¯ã‚’ã—ãªãã¦æ¸ˆã¿ã€`if (nftsData == null || walletData == null)` ã¯ä¸è¦ã«ãªã‚‹  
- ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ããªã‹ã£ãŸã‚Š null ã ã£ãŸå ´åˆã¯ã€Œ**ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**ã€ã•ã‚Œã‚‹ãŸã‚ã€UI å´ã§ã¯ `error:` ãƒ–ãƒ­ãƒƒã‚¯ã«åˆ†å²ãŒé£›ã‚“ã§ãƒãƒ©ã¤ãã«ãããªã‚‹  

ã“ã‚ŒãŒã€Œ**`null` è¨±å®¹ã—ãªã„æŠ€ã§å¯¾å¿œã™ã‚‹**ã€ã®åŸºæœ¬çš„ãªå®Ÿè£…æ–¹é‡ã«ãªã‚Šã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/02/11 10:12:17*

Notifier å´ã§ã¯nullã‚’è¨±å®¹ã—ãŸã„ã‚“ã 

---

## ğŸ”§ ãƒ„ãƒ¼ãƒ«
*2025/02/11 10:12:48*

Ok, let's think this through. The user is considering having `null` on the Notifier side to indicate something not yet loaded. The aim is to avoid UI disruption with a strange "null" screen.

**æ‰±ã†ãƒ‡ãƒ¼ã‚¿ã‚’ç‰¹å®šã™ã‚‹**

`combinedWalletDataProvider`ã¯ã€`WalletBalanceResponseDTOData`ã¨`GetUserNftsResponseDTOData`ã®ã‚¿ãƒ—ãƒ«ã‚’è¿”ã™ã€‚UIã§ã¯ã€nullã®å‡¦ç†ãŒå¿…è¦ã¨ãªã‚‹ãŒã€`maybeWhen`ã‚„énullãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†æ–¹æ³•ã‚’æ¤œè¨ä¸­ã€‚

**çŠ¶æ…‹ã‚’åˆä½µã™ã‚‹**

`getWalletNotifier`ã¨`getNftsNotifier`ã®çŠ¶æ…‹ã‚’çµ±åˆã—ã€nullãƒ‡ãƒ¼ã‚¿ã‚’ç‰¹å®šã€ä¾‹å¤–ã‚’ã‚¹ãƒ­ãƒ¼ã—ã¦ã‚¨ãƒ©ãƒ¼ã‚’é€šçŸ¥ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¦ã„ã‚‹ã€‚

**è¡¨ç¤ºã®èª¿æ•´**

ãƒ‡ãƒ¼ã‚¿ãŒãƒ­ãƒ¼ãƒ‰ä¸­ã‚„ã‚¨ãƒ©ãƒ¼ã®å ´åˆã€çµ±åˆãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã¯ãã‚Œã‚’ç¤ºã™ã€‚ãƒ‡ãƒ¼ã‚¿ãŒnullãªã‚‰ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤ºã€‚Notifierå´ã¯nullã‚’è¨±å®¹ã™ã‚‹ãŒã€çµ±åˆå´ã§ã¯nullã‚’è¨±å®¹ã—ãªã„ã€‚

**çµ±åˆçŠ¶æ…‹ã‚’ç®¡ç†**

`getWalletNotifier`ã¨`getNftsNotifier`ã®çŠ¶æ…‹ã‚’çµ±åˆã—ã€ãƒ­ãƒ¼ãƒ‰ä¸­ã‚„ã‚¨ãƒ©ãƒ¼æ™‚ã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å–ã‚Šã€nullãƒ‡ãƒ¼ã‚¿ã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ã‚’ã‚¹ãƒ­ãƒ¼ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ç¤ºã—ã¦ã„ã‚‹ã€‚

**çŠ¶æ…‹ç®¡ç†ã®å·¥å¤«**

ãƒ‡ãƒ¼ã‚¿ãŒãƒ­ãƒ¼ãƒ‰ä¸­ã€ã‚¨ãƒ©ãƒ¼ã€ã¾ãŸã¯nullã®å ´åˆã«é©åˆ‡ã«å‡¦ç†ã—ã€UIã§è¦–è¦šçš„ã«è¡¨ç¤ºã™ã‚‹æ–¹æ³•ã‚’æ¢ã£ã¦ã„ã‚‹ã€‚Notifierå´ã‚’nullã¨ã—ã¦æ‰±ã†ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ææ¡ˆã—ã¦ã„ã‚‹ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/02/11 10:12:48*

ã€Œ**Notifier å´ã¯ `null` ã‚’è¨±å®¹ã—ãŸã„**ï¼ˆï¼ `build()` ã‚„ `state` ãŒ `null` ã‚’æŒã¤å¯èƒ½æ€§ãŒã‚ã‚‹ï¼‰ã‘ã©ã€**æœ€çµ‚çš„ãªåˆæˆçµæœï¼ˆcombinedWalletDataProviderï¼‰ã§ã¯ `null` ãƒã‚§ãƒƒã‚¯ã‚’ã—ãŸããªã„**ã€ã¨ã„ã†å ´åˆã¯ã€

1. **Notifier å´ã¯ã‚ãã¾ã§ â€œ`AsyncValue<ãƒ‡ãƒ¼ã‚¿?>`â€ ã‚’è¿”ã™**  
2. **åˆæˆç”¨ã® Providerï¼ˆ`combinedWalletDataProvider`ï¼‰ã§ã¯ã€å„ Notifier ã®çŠ¶æ…‹ã‚’ã¾ã¨ã‚ã¦ â€œæœ€çµ‚çš„ã« `null` ãªã—ã® `AsyncValue<data>` ã«å¤‰æ›ã™ã‚‹â€**  

ã¨ã„ã†äºŒæ®µæ§‹ãˆã§å¯¾å¿œã™ã‚‹ã®ãŒã‚¹ãƒƒã‚­ãƒªã—ã¾ã™ã€‚

---

# ã–ã£ãã‚Šã—ãŸä»•çµ„ã¿

Notifier å´:

```dart
@Riverpod(keepAlive: true)
class GetWalletNotifier extends _$GetWalletNotifier {
  /// build() ãŒ null ã‚’è¿”ã™
  @override
  FutureOr<WalletBalanceResponseDTOData?> build() async => null;

  /// ä¾‹: getWallet() å‘¼ã¶ã¨å†…éƒ¨çš„ã« state = AsyncValue<WalletBalanceResponseDTOData?>
  Future<WalletBalanceResponseDTOData?> getWallet() async {
    // çœç•¥
  }
}
```

åˆæˆ Provider å´ (ä¾‹: `combinedWalletDataProvider`):

```dart
/// ã€ŒWallet + Nftsã€ã‚’åˆæˆã—ã¦å¿…ãš non-null ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™ãŸã‚ã® Providerã€‚
/// ãŸã ã—å®Ÿéš›ã¯ `AsyncValue<(WalletBalanceResponseDTOData, GetUserNftsResponseDTOData)>` å‹ã€‚
///
/// ã“ã“ã§ã¯ `Provider<AsyncValue<...>>` ã‹ `FutureProvider<...>` ã®ã„ãšã‚Œã‹ã§è¨­è¨ˆã§ãã¾ã™ãŒã€
/// ã€Œå†…éƒ¨ã§ã¾ã¨ã‚ã¦å…¨éƒ¨å¾…ã£ã¦ã‹ã‚‰è¿”ã™ã€ã‚ˆã‚Šã¯ã€ŒçŠ¶æ…‹ã‚’ãƒãƒ¼ã‚¸ã—ã¦ã‚ã’ã‚‹ã€æ–¹ãŒæŸ”è»Ÿã«æ›¸ã‘ã¾ã™ã€‚
final combinedWalletDataProvider = Provider.autoDispose<
    AsyncValue<(WalletBalanceResponseDTOData, GetUserNftsResponseDTOData)>
>((ref) {
  // 1) Notifier ã®çŠ¶æ…‹ã‚’ãã‚Œãã‚Œå–å¾— (AsyncValue<ãƒ‡ãƒ¼ã‚¿?>)
  final walletAsync = ref.watch(getWalletNotifierProvider);
  final nftsAsync = ref.watch(getNftsNotifierProvider);

  // 2) ãã‚Œã‚‰ã‚’ãƒãƒ¼ã‚¸ã—ã¦ã€æœ€çµ‚çš„ã«
  //    AsyncValue<(WalletBalanceResponseDTOData, GetUserNftsResponseDTOData)> ã‚’ä½œã‚‹

  // -- 2-1) ã©ã¡ã‚‰ã‹ãŒ loading ä¸­ãªã‚‰ loading ã«ã™ã‚‹
  if (walletAsync.isLoading || nftsAsync.isLoading) {
    return const AsyncValue<(WalletBalanceResponseDTOData, GetUserNftsResponseDTOData)>.loading();
  }

  // -- 2-2) ã©ã¡ã‚‰ã‹ãŒ error ãªã‚‰ error ã«ã™ã‚‹
  if (walletAsync.isError) {
    return AsyncValue<(WalletBalanceResponseDTOData, GetUserNftsResponseDTOData)>.error(
      walletAsync.error!,
      walletAsync.stackTrace,
    );
  }
  if (nftsAsync.isError) {
    return AsyncValue<(WalletBalanceResponseDTOData, GetUserNftsResponseDTOData)>.error(
      nftsAsync.error!,
      nftsAsync.stackTrace,
    );
  }

  // -- 2-3) ã“ã“ã¾ã§æ¥ãŸã‚‰ä¸¡æ–¹ã¨ã‚‚ data æ‰±ã„ã€‚
  //         ã—ã‹ã—ä¸­èº«ã¯ã€Œãƒ‡ãƒ¼ã‚¿ or nullã€(WalletBalanceResponseDTOData? / GetUserNftsResponseDTOData?)ã€‚
  final walletData = walletAsync.value;
  final nftsData = nftsAsync.value;

  // -- 2-4) ã“ã“ã§ null ã ã£ãŸå ´åˆã©ã†ã™ã‚‹ã‹ã‚’æ±ºã‚ã‚‹
  if (walletData == null || nftsData == null) {
    // ã€Œnull ã‚’éè¨±å®¹ã«ã—ãŸã„ã€ãªã‚‰ Error æ‰±ã„ã«ã—ã¦ã—ã¾ã†ã‹ã€
    // ã€Œã¾ã ä½•ã‚‚å–å¾—ã—ã¦ã„ãªã„ï¼ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ‰±ã„ã«ã—ãŸã„ã€ãªã‚‰ loading ã«ã—ã¦ã‚‚OKã€‚
    // ä¾‹: Error ã«ã—ã¦ã—ã¾ã†
    return AsyncValue<(WalletBalanceResponseDTOData, GetUserNftsResponseDTOData)>.error(
      Exception('No data found'),
    );
  }

  // -- 2-5) null ã§ãªã„ã“ã¨ãŒä¿è¨¼ã•ã‚ŒãŸã‚‰ã€ãã®ã¾ã¾ data ã¨ã—ã¦è¿”ã™
  return AsyncValue.data((walletData, nftsData));
});
```

ã“ã‚Œã«ã‚ˆã‚Šã€

- **Notifier å´** ã¯ã€ŒåˆæœŸå€¤ã¨ã—ã¦ `null` ã‚’è¿”ã™ / `null` ã‚’è¨±å®¹ã™ã‚‹ã€è¨­è¨ˆã®ã¾ã¾ã§ OKã€‚  
- **åˆæˆ Provider å´** ã§ã¯ã€Œ`null` ã®å ´åˆã¯ `AsyncValue.error(...)` ãªã©ã«ã™ã‚‹ â†’ **UI ã«æ¸¡ã™ã¨ãã«ã¯ `null` ãŒç™»å ´ã—ãªã„**ã€è¨­è¨ˆã«ã™ã‚‹ã€‚  

### UI å´ã§ã®æ›¸ãæ–¹

ãŸã¨ãˆã° `WalletPage` ã§åˆæˆãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã„ãŸã„å ´åˆ:

```dart
class WalletPage extends HookConsumerWidget {
  const WalletPage({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final combinedAsync = ref.watch(combinedWalletDataProvider);

    return Scaffold(
      appBar: AppBar(title: const Text('Wallet')),
      body: combinedAsync.when(
        loading: () => const Center(child: CircularProgressIndicator()),
        error: (err, st) => Center(child: Text('Error: $err')),
        data: (data) {
          // data ã¯ (WalletBalanceResponseDTOData, GetUserNftsResponseDTOData)
          final wallet = data.$1;
          final nfts = data.$2;

          // ã“ã“ã§ã¯ã‚‚ã† null ãƒã‚§ãƒƒã‚¯ä¸è¦ï¼
          // Notifier å´ã§ null ã‚’è¿”ã—ã¦ã„ãŸå ´åˆã§ã‚‚ã€ã“ã“ã«æ¥ã‚‹ã®ã¯ã€Œnull ã˜ã‚ƒãªã„ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ã ã‘

          return Text('STP: ${wallet.stpAmount} / NFTs count: ${nfts.explorers?.length ?? 0}');
        },
      ),
    );
  }
}
```

ã“ã†ã™ã‚‹ã¨ **UI å´** ã§ã¯  
- `null` ãƒã‚§ãƒƒã‚¯ (`if (something == null)`) ã¯ä¸è¦  
- ã€Œã¾ã å–å¾—ã—ã¦ãªã„ã€ã€Œãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ãªã„ã€å ´åˆã¯ **`loading:` ã¾ãŸã¯ `error:`** ã«åˆ†å²ã•ã‚Œã‚‹  
- å®Ÿè³ª `(WalletBalanceResponseDTOData, GetUserNftsResponseDTOData)` ã¨ã—ã¦å®‰å…¨ã«æ‰±ãˆã‚‹  

ã¨ã„ã†æµã‚Œã«ãªã‚Šã¾ã™ã€‚

---

# ãƒã‚¤ãƒ³ãƒˆã¾ã¨ã‚

1. **ã€ŒNotifier å´ã§ null ã‚’è¨±å®¹ã—ãŸã„ã€**  
   - ãŸã¨ãˆã°ã€ã¾ã ä¸€åº¦ã‚‚ãƒ•ã‚§ãƒƒãƒã—ã¦ã„ãªã„ã¨ãã¯ `null` ã«ã—ã¦ãŠãã€ã‚¨ãƒ©ãƒ¼ãŒèµ·ããŸã‚‰å†ã³ `null` ã«æˆ»ã™ etc.  
   - ã“ã‚Œã¯å…¨ãå•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚å¥½ãã« `null` ã‚’æŒã¤è¨­è¨ˆã«ã—ã¦ OKã€‚

2. **ã€ŒUI å´ã§ã¯ã§ãã‚‹ã ã‘ `null` åˆ¤å®šã‚’æ›¸ããŸããªã„ã€**  
   - ã§ã‚ã‚Œã°ã€**åˆæˆæ®µéšã§ â€œæœ€çµ‚çš„ã«é null ã«å¤‰æ›â€** ã—ã¦ã—ã¾ã†æ–¹æ³•ãŒã‚ªã‚¹ã‚¹ãƒ¡ã€‚  
   - ã€Œ`null` ãŒå…¥ã£ã¦ã„ãŸã‚‰ `Exception` ã‚’æŠ•ã’ã¦ `AsyncValue.error` ã«ã™ã‚‹ã€ã€Œã¾ã ãƒ•ã‚§ãƒƒãƒä¸­ãªã‚‰ `AsyncValue.loading` ã«ã™ã‚‹ã€ãªã©ã€**UI ãŒæ‰±ã„ã‚„ã™ã„å½¢ (loading / error / data) ã«æƒãˆã‚‹** ã“ã¨ã§ã€UI ã¯ `when` åˆ†å²ã ã‘ã§å®Œçµã—ã€`null` ãƒã‚§ãƒƒã‚¯ãŒæ¶ˆãˆã¾ã™ã€‚

3. **ã€Œå®Œå…¨ã« null éè¨±å®¹ã«ã™ã‚‹ã€ã‹ã¯ã‚¢ãƒ—ãƒªã®ä»•æ§˜æ¬¡ç¬¬**  
   - åˆæˆ Provider ã§ã¯ã€Œ`null` ãªã‚‰ `AsyncValue.error` ã«ã—ã¡ã‚ƒã†ã€ã§ã‚‚ã„ã„ã§ã™ã—ã€  
   - ã€Œ`null` ãªã‚‰ã¾ã ä½•ã‚‚å–å¾—ã§ãã¦ãªã„ï¼loading æ‰±ã„ã«ã™ã‚‹ã€ã§ã‚‚ OKã€‚  
   - ã„ãšã‚Œã«ã›ã‚ˆã€Œ**UI ã«æ¸¡ã™æœ€çµ‚æ®µéš**ã€ã§ â€œé null or æ˜ç¤ºçš„ã« error/loadingâ€ ã‚’è¡¨ç¾ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã‚ã’ã‚‹ã¨ã€ãƒãƒ©ã¤ãã‚„ç…©é›‘ãª `if (xxx == null)` ãŒãªããªã‚‹ã€ã¨ã„ã†ã‚ã‘ã§ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/02/11 10:16:17*

ä»¥ä¸‹ã‚’keepAliveã«ã—ã¦ã€ãšã£ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æŒã¡ç¶šã‘ã‚‹ã“ã¨ã«ã¯ã§ããªã„ã®ã‹ï¼Ÿ

final combinedWalletDataProvider = FutureProvider&lt;
    (
      WalletBalanceResponseDTOData?,
      GetUserNftsResponseDTOData?,
    )&gt;((ref) async {
  final wallet = await ref.watch(getWalletNotifierProvider.future);
  final nfts = await ref.watch(getNftsNotifierProvider.future);

  return (wallet, nfts);
});

---

## ğŸ”§ ãƒ„ãƒ¼ãƒ«
*2025/02/11 10:16:32*

**ä¿æŒãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ã®ç¢ºå®Ÿæ€§ã‚’é«˜ã‚ã‚‹æ–¹æ³•ã‚’è€ƒãˆã‚‹**

`combinedWalletDataProvider`ã‚’ãƒšãƒ¼ã‚¸å¤‰æ›´æ™‚ã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã—ãªãŒã‚‰å†å®Ÿè¡Œã—ãªã„ã‚ˆã†ä¿ã¤æ–¹æ³•ã‚’æ¤œè¨ä¸­ã€‚`FutureProvider`ã«`.keepAlive()`ã‚’è¿½åŠ ã™ã‚‹ã‹ã€`ref.keepAlive()`ã‚’ä½¿ã†ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’æ¢ã£ã¦ã„ã‚‹ã€‚

**ãƒ‡ãƒ¼ã‚¿ä¿æŒã®æ–¹æ³•ã‚’æ¢ã‚‹**

`autoDispose`ã‚’å¤–ã—ã¦ãã®ã¾ã¾ã«ã™ã‚‹ã€ã¾ãŸã¯`ref.keepAlive()`ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ¡ãƒ¢ãƒªã«ä¿æŒã—ã¦ä¿æŒã—ç¶šã‘ã‚‹æ–¹æ³•ã‚’æ¤œè¨ä¸­ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/02/11 10:16:32*

çµè«–ã‹ã‚‰è¨€ã†ã¨ã€**ã§ãã¾ã™**ã€‚  
`FutureProvider` ã§ã‚‚ã€**autoDispose ã‚’å¤–ã™**ã‹ã€ã‚ã‚‹ã„ã¯ **`autoDispose.keepAlive()`** ã‚’ä½¿ã†ã“ã¨ã§ã€Œãƒ—ãƒ­ãƒã‚¤ãƒ€ãŒå¸¸ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä¿æŒã—ç¶šã‘ã‚‹ã€ã‚ˆã†ã«ã§ãã¾ã™ã€‚

---

## 1. `autoDispose` ã‚’å¤–ã™

ä¸€ç•ªã‚·ãƒ³ãƒ—ãƒ«ãªã®ã¯ã€å˜ã« `autoDispose` ã‚’ä»˜ã‘ãªã„ã“ã¨ã§ã™ã€‚
```dart
final combinedWalletDataProvider = FutureProvider<
  (
    WalletBalanceResponseDTOData?,
    GetUserNftsResponseDTOData?,
  )>((ref) async {
  final wallet = await ref.watch(getWalletNotifierProvider.future);
  final nfts = await ref.watch(getNftsNotifierProvider.future);

  return (wallet, nfts);
});
```

ã“ã‚Œã ã‘ã§ã€Œä¿æŒã—ç¶šã‘ã‚‹ (dispose ã•ã‚Œãªã„)ã€æŒ™å‹•ã«ãªã‚Šã¾ã™ã€‚  
- Riverpod 2.x ã‹ã‚‰ã¯ã€`autoDispose` ãŒæ˜ç¤ºçš„ã«ç„¡ã„å ´åˆã¯ã€Œä½¿ã‚ã‚Œãªããªã£ã¦ã‚‚è‡ªå‹•ç ´æ£„ã—ãªã„ã€(= **keepAlive** åŒæ§˜) ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæŒ™å‹•ã§ã™ã€‚

---

## 2. `autoDispose.keepAlive()` ã‚’ä½¿ã†

ã‚‚ã—ã€ŒåŸºæœ¬ã¯ `autoDispose` ã‚’ä½¿ã„ãŸã„ãŒã€ã“ã® Provider ã¯ä¾‹å¤–çš„ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä¿æŒã—ç¶šã‘ãŸã„ã€ã¨ã„ã†å ´åˆã¯ã€Riverpod 2.x ã®ã€Œãƒ“ãƒ«ãƒ€ãƒ¼æ‹¡å¼µã€æ©Ÿèƒ½ã§ `.autoDispose.keepAlive()` ã‚’ãƒã‚§ãƒ¼ãƒ³ã§ãã¾ã™ã€‚

```dart
final combinedWalletDataProvider = FutureProvider
    .autoDispose
    .keepAlive()
    .<(WalletBalanceResponseDTOData?, GetUserNftsResponseDTOData?)>(
  (ref) async {
    final wallet = await ref.watch(getWalletNotifierProvider.future);
    final nfts = await ref.watch(getNftsNotifierProvider.future);
    return (wallet, nfts);
  },
);
```

- ã“ã‚Œã§ã€Œä¸€å¿œ `autoDispose` ã¨ã—ã¦æ›¸ã„ã¦ã„ã‚‹ãŒã€å®Ÿéš›ã«ã¯ã€ãšã£ã¨ keepAliveã€ã€ã¨ã„ã†æŒ™å‹•ã«ãªã‚Šã¾ã™ã€‚  
- ã¤ã¾ã‚Šã€**autoDispose ã®ç ´æ£„å¯¾è±¡ã«ã¯ãªã‚‰ãš**ã€ãƒ—ãƒ­ãƒã‚¤ãƒ€ã®å€¤ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ç¶šã‘ã¾ã™ã€‚

---

## 3. ãƒ—ãƒ­ã‚°ãƒ©ãƒ ä¸­ã§ `ref.keepAlive()` ã‚’å‘¼ã¶

ã•ã‚‰ã«ç´°ã‹ã„åˆ¶å¾¡ãŒå¿…è¦ãªå ´åˆã¯ã€ãƒ—ãƒ­ãƒã‚¤ãƒ€æœ¬ä½“ã®ãƒ“ãƒ«ãƒ‰ä¸­ã§ `final link = ref.keepAlive();` ã‚’ä½¿ã„ã€**ä»»æ„ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ `link.close()` ã‚’å‘¼ã¶ã¨ dispose ã™ã‚‹**ã€ã¨ã„ã†æ‰‹æ³•ã‚‚ã‚ã‚Šã¾ã™ï¼ˆä½¿ã‚ãªã‘ã‚Œã°æ°¸é ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæ®‹ã‚‹ï¼‰ã€‚

```dart
final combinedWalletDataProvider = FutureProvider.autoDispose<
    (WalletBalanceResponseDTOData?, GetUserNftsResponseDTOData?)>((ref) async {
  // æ˜ç¤ºçš„ã«keepAlive
  final link = ref.keepAlive();

  // ã‚‚ã—ã€Œä½•ã‚‰ã‹ã®æ¡ä»¶ã§ç ´æ£„ã—ãŸã„ã€ãªã‚‰ã€ã‚ã¨ã§ link.close() ã‚’å‘¼ã¶
  // ä¾‹:
  // Future.delayed(const Duration(minutes: 10), () => link.close());

  final wallet = await ref.watch(getWalletNotifierProvider.future);
  final nfts = await ref.watch(getNftsNotifierProvider.future);
  return (wallet, nfts);
});
```

ä¸Šè¨˜ã®ã‚ˆã†ã«æ›¸ã‘ã°ã€**ç‰¹å®šã®ã‚¤ãƒ™ãƒ³ãƒˆã‚„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§æ‰‹å‹• `dispose` ã—ãŸã„**ã¨ã„ã†æŸ”è»Ÿãªå®Ÿè£…ãŒå¯èƒ½ã§ã™ã€‚  
ãã†ã§ãªã‘ã‚Œã°ã€å˜ç´”ã« `.keepAlive()` ã‚’ä»˜ã‘ã‚‹ã ã‘ï¼ˆã¾ãŸã¯ `autoDispose` ã‚’å¤–ã™ã ã‘ï¼‰ã§ OK ã§ã™ã€‚

---

# ã¾ã¨ã‚

- **ãšã£ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æŒã¡ç¶šã‘ãŸã„** â†’ `autoDispose` ã‚’ä»˜ã‘ãªã„ã‹ã€`autoDispose.keepAlive()` ã‚’ä½¿ã†ã€‚  
- å…·ä½“çš„ã«ã¯ã€ä»¥ä¸‹ã„ãšã‚Œã‹ã®æ›¸ãæ–¹ã«ãªã‚Šã¾ã™ã€‚

### ï¼ˆAï¼‰`autoDispose` ã‚’å¤–ã™

```dart
final combinedWalletDataProvider = FutureProvider<
  (
    WalletBalanceResponseDTOData?,
    GetUserNftsResponseDTOData?,
  )>((ref) async {
    final wallet = await ref.watch(getWalletNotifierProvider.future);
    final nfts = await ref.watch(getNftsNotifierProvider.future);
    return (wallet, nfts);
});
```

### ï¼ˆBï¼‰`autoDispose.keepAlive()` ã‚’ä½¿ã†ï¼ˆRiverpod 2.xã®æ›¸ãæ–¹ï¼‰

```dart
final combinedWalletDataProvider = FutureProvider
    .autoDispose
    .keepAlive()
    .<(WalletBalanceResponseDTOData?, GetUserNftsResponseDTOData?)>(
  (ref) async {
    final wallet = await ref.watch(getWalletNotifierProvider.future);
    final nfts = await ref.watch(getNftsNotifierProvider.future);
    return (wallet, nfts);
  },
);
```

ã“ã†ã™ã‚Œã°ã€**ã€Œå¸¸ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸå€¤ã‚’ä¿æŒã€** ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã€  
ç”»é¢ã‚’é›¢ã‚Œã¦æˆ»ã‚‹ãŸã³ã«å†å–å¾—ã—ã¦ãƒãƒ©ã¤ãã‚ˆã†ãªæŒ™å‹•ã‚’é˜²ã’ã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/02/11 10:21:23*

ãƒãƒ©ã¤ã„ã¦ã„ã‚‹åŸå› ãŒã‚ã‹ã£ãŸã€‚ä»¥ä¸‹ã§AsyncValue.loading();ã®çŠ¶æ…‹ã«ãªã£ã¦ã„ã‚‹ã‹ã‚‰ã ã€‚
æœ€åˆã®ä¸€å›ã—ã‹ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã«ãªã‚‰ãªã„æ§˜ã«ã¯ã§ããªã„ã®ã‹ï¼Ÿ

final combinedWalletDataProvider = FutureProvider&lt;
    (
      WalletBalanceResponseDTOData?,
      GetUserNftsResponseDTOData?,
    )&gt;((ref) async {
  final wallet = await ref.watch(getWalletNotifierProvider.future);
  final nfts = await ref.watch(getNftsNotifierProvider.future);

  return (wallet, nfts);
});

---

## ğŸ”§ ãƒ„ãƒ¼ãƒ«
*2025/02/11 10:21:53*

**å¯¾å¿œæ–¹æ³•ã‚’æ¨¡ç´¢ä¸­**

combinedWalletDataProviderãŒgetWalletNotifierProvider.futureã¨getNftsNotifierProvider.futureã«ä¾å­˜ã—ã¦ã„ã‚‹å•é¡Œã‚’è¦‹ã¤ã‘ã¦ã„ã‚‹ã€‚ã“ã‚Œã‚‰ãŒèª­ã¿è¾¼ã¿ä¸­ã«ãªã‚‹ã¨å†èª­ã¿è¾¼ã¿ã‚„å†ä½œæˆãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ã®ã§ã€åˆå›ã®èª­ã¿è¾¼ã¿æ™‚ã«ã®ã¿ãã†ãªã‚‹ã‚ˆã†ã«ã—ãŸã„ã¨è€ƒãˆã¦ã„ã‚‹ã€‚

**æ–°ã—ã„èª­ã¿è¾¼ã¿ã‚’è¦‹é€ã‚‹æ–¹æ³•ã‚’æ¢ã‚‹**

åˆå›ä»¥å¤–ã®èª­ã¿è¾¼ã¿ã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ãŸã‚ã«ã€çŠ¶æ…‹ã‚’ç›£è¦–ã™ã‚‹ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒã‚¤ãƒ€ã‚’å®šç¾©ã—ã€å¤ã„ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã—ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’è¡Œã†æ–¹æ³•ã‚’æ¨¡ç´¢ã—ã¦ã„ã‚‹ã€‚

**ãƒ‡ãƒ¼ã‚¿ã®å–ã‚Šæ‰±ã„ã‚’æ³¨è¦–**

å¤ã„ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã¯èª­ã¿è¾¼ã¿ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã€ãªã„å ´åˆã¯èª­ã¿è¾¼ã¿ã‚’è¡Œã†ã€‚ãŸã ã—ã€äºŒå›ç›®ä»¥é™ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ã§ã¯çŠ¶æ…‹ã‚’èª­ã¿è¾¼ã¿ã«ã—ãªã„æ–¹æ³•ã‚’æ¢ã£ã¦ã„ã¾ã™ã€‚

**å†èµ·å‹•ã‚’åˆ¶å¾¡ã™ã‚‹æ–¹æ³•ã®æ¨¡ç´¢**

æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã¨æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®åˆ©ç”¨ã‚’åˆ¶å¾¡ã—ã€ç¹°ã‚Šè¿”ã—ã®å†èµ·å‹•ã‚’æŠ‘åˆ¶ã™ã‚‹æ–¹æ³•ã‚’æ¢ã£ã¦ã„ã‚‹ã€‚

**åŒæœŸã‚’è¦‹å®ˆã‚‹**

æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ä¸­ã€å¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’ãã®ã¾ã¾ã«ã—ã¦ãŠããŸã‚ã«ã¯ã€çŠ¶æ…‹ã‚’AsyncValueã¨ã—ã¦ç›£è¦–ã—ç›´ã™ã“ã¨ãŒå¿…è¦ã ã­ã€‚

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ç›£è¦–ã¨ãƒ‡ãƒ¼ã‚¿ã®ç¶­æŒ**

é€šè²¨æ®‹é«˜ã¨NFTã®çŠ¶æ…‹ã‚’AsyncValueã§ç›£è¦–ã—ã€ãƒ­ãƒ¼ãƒ‰ä¸­ã§ã‚‚æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’ç¶­æŒã™ã‚‹æ–¹æ³•ã‚’æ¨¡ç´¢ã—ã¦ã„ã‚‹ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/02/11 10:21:53*

ãƒãƒ©ã¤ãã®åŸå› ãŒã€Œå†ãƒ•ã‚§ãƒƒãƒã™ã‚‹éš›ã« `AsyncValue.loading()` çŠ¶æ…‹ã«ãªã‚Šã€UI ä¸Šã§ä¸€ç¬ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã¸åˆ‡ã‚Šæ›¿ã‚ã£ã¦ã—ã¾ã†ã‹ã‚‰ã€ãªã®ã§ã‚ã‚Œã°ã€**ã€Œæ—¢ã«ãƒ‡ãƒ¼ã‚¿ã‚’æŒã£ã¦ã„ã‚‹ã¨ãã¯ã€å†ãƒ•ã‚§ãƒƒãƒä¸­ã‚‚ `loading` ã«ã—ãªã„ã€**ã¨ã„ã†å®Ÿè£…ã«ã™ã‚Œã°ãƒãƒ©ã¤ãã‚’æŠ‘ãˆã‚‰ã‚Œã¾ã™ã€‚

---

## èƒŒæ™¯

`combinedWalletDataProvider` ãŒ

```dart
final combinedWalletDataProvider = FutureProvider<
    (WalletBalanceResponseDTOData?, GetUserNftsResponseDTOData?)>((ref) async {
  final wallet = await ref.watch(getWalletNotifierProvider.future);
  final nfts = await ref.watch(getNftsNotifierProvider.future);
  return (wallet, nfts);
});
```

ã®ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹å ´åˆã€**å†…éƒ¨ã§ `getWalletNotifierProvider.future` / `getNftsNotifierProvider.future` ãŒ â€œå†å–å¾—â€ ã•ã‚Œã‚‹** ã¨ã€  
- `Notifier` å´ã§ `state = AsyncValue.loading();` ã«åˆ‡ã‚Šæ›¿ãˆ â†’  
- `combinedWalletDataProvider` ã‚‚ã€Œä¾å­˜å…ˆãŒ `loading` ã«ãªã£ãŸã€ã¨åˆ¤æ–­ã— `AsyncValue.loading()` â†’  
- UI å´ãŒä¸€ç¬ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã«å¤‰ã‚ã‚‹ï¼ˆãƒãƒ©ã¤ãï¼‰  

ã¨ã„ã†æµã‚Œã«ãªã‚Šã¾ã™ã€‚  

---

## è§£æ±ºç­–ã®æ¦‚è¦

### ãƒã‚¤ãƒ³ãƒˆ1: ã€Œå¤ã„ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ãªã‚‰ `loading` ã«ã—ãªã„ã€

`Notifier` å´ã® `getWallet()` / `getNfts()` ãƒ¡ã‚½ãƒƒãƒ‰ã§ã€

```dart
final oldData = state.valueOrNull;
if (oldData == null) {
  // åˆå›å–å¾—ã®ã¨ãã ã‘ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã«
  state = const AsyncValue.loading();
}
```

ã®ã‚ˆã†ãªåˆ†å²ã‚’å…¥ã‚Œã¦ãŠãã€**ã™ã§ã«ãƒ‡ãƒ¼ã‚¿ã‚’æŒã£ã¦ã„ã‚‹ãªã‚‰ `loading` ã«åˆ‡ã‚Šæ›¿ãˆãªã„** ã‚ˆã†ã«ã™ã‚‹ã€‚  
ã“ã‚Œã«ã‚ˆã‚Šã€Œä¸€åº¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã‹ã‚‰ã¯ã€å†å–å¾—ä¸­ã§ã‚‚ `state` ãŒ `loading` ã«ä¸Šæ›¸ãã•ã‚Œãªã„ã€ãŸã‚ã€**UI å´ã§ã¯ â€œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã—ç¶šã‘ã‚‹â€** ã“ã¨ãŒã§ãã¾ã™ã€‚

#### ä¾‹: `GetWalletNotifier`

```dart
@Riverpod(keepAlive: true)
class GetWalletNotifier extends _$GetWalletNotifier {
  @override
  Future<WalletBalanceResponseDTOData?> build() async => null;

  Future<WalletBalanceResponseDTOData?> getWallet() async {
    // æ—¢ã«ãƒ‡ãƒ¼ã‚¿ã‚’æŒã£ã¦ã„ã‚‹ãªã‚‰ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã«ã—ãªã„
    if (!state.hasValue) {
      state = const AsyncValue.loading();
    }

    try {
      final api = await ref.watch(walletApiProvider.future);
      final response = await api.walletControllerGetBalance();
      checkForApiError(response.data);
      final data = response.data?.data;
      if (data == null) {
        throw Exception('No data found');
      }
      state = AsyncValue.data(data);
      return data;
    } catch (error, stack) {
      state = AsyncValue.error(error, stack);
      rethrow;
    }
  }
}
```

åŒæ§˜ã« `GetNftsNotifier` ã‚‚

```dart
@Riverpod(keepAlive: true)
class GetNftsNotifier extends _$GetNftsNotifier {
  @override
  Future<GetUserNftsResponseDTOData?> build() async => null;

  Future<GetUserNftsResponseDTOData?> getNfts() async {
    // æ—¢ã«ãƒ‡ãƒ¼ã‚¿ã‚’æŒã£ã¦ã„ã‚‹ãªã‚‰ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã«ã—ãªã„
    if (!state.hasValue) {
      state = const AsyncValue.loading();
    }

    try {
      final api = await ref.watch(usersApiProvider.future);
      final response = await api.userControllerGetUserNfts();
      checkForApiError(response.data);
      final data = response.data?.data;
      if (data == null) {
        throw Exception('No data found');
      }
      state = AsyncValue.data(data);
      return data;
    } catch (error, stack) {
      state = AsyncValue.error(error, stack);
      rethrow;
    }
  }
}
```

ã®ã‚ˆã†ã«æ›¸ãã“ã¨ã§ã€**2å›ç›®ä»¥é™ã® `getNfts()` / `getWallet()` å‘¼ã³å‡ºã—ã§ã¯ã€ã™ã§ã« `state` ã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã¯ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã«åˆ‡ã‚Šæ›¿ãˆãªã„** ã‚ˆã†ã«ã§ãã¾ã™ã€‚

---

### ãƒã‚¤ãƒ³ãƒˆ2: `combinedWalletDataProvider` ã‚’ `autoDispose.keepAlive` ã¾ãŸã¯ `autoDispose` ã‚’å¤–ã™

ã‚‚ã—ã€Œç”»é¢ã‚’é›¢ã‚Œã¦æˆ»ã£ã¦ãã¦ã‚‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæ®‹ã£ã¦ã„ã¦ã»ã—ã„ã€ã®ã§ã‚ã‚Œã°ã€

- `autoDispose` ã‚’å¤–ã™ â†’ `FutureProvider`  
- ã‚‚ã—ãã¯ `autoDispose.keepAlive()` ã‚’ä½¿ã† â†’ `FutureProvider.autoDispose.keepAlive()`

ã¨ã™ã‚Œã°ã€**ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒç ´æ£„ã•ã‚Œãš**ã€**å†ãƒ“ãƒ«ãƒ‰æ™‚ã«ã‚‚å‰å›ã®ãƒ‡ãƒ¼ã‚¿ãŒä½¿ã‚ã‚Œã‚‹** ãŸã‚ã€ã•ã‚‰ã«ãƒãƒ©ã¤ããŒæ¸›ã‚Šã¾ã™ã€‚

```dart
final combinedWalletDataProvider = FutureProvider
    .autoDispose
    .keepAlive()
    .<(WalletBalanceResponseDTOData?, GetUserNftsResponseDTOData?)>(
  (ref) async {
    final wallet = await ref.watch(getWalletNotifierProvider.future);
    final nfts = await ref.watch(getNftsNotifierProvider.future);
    return (wallet, nfts);
  },
);
```

ã“ã‚Œã«ã‚ˆã£ã¦ã€Œãƒšãƒ¼ã‚¸ã‹ã‚‰é›¢ã‚Œã¦ã‚‚ãƒ—ãƒ­ãƒã‚¤ãƒ€ã¯ç ´æ£„ã•ã‚Œãªã„ã€æŒ™å‹•ã«ãªã‚Šã€  
æˆ»ã£ã¦ããŸã¨ãã‚‚ç›´å‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã—ã¦ã„ã¾ã™ã€‚

---

### UI ä¾‹: PullToRefresh (onRefresh) ã§å†å–å¾—ã—ã¦ã‚‚ãƒãƒ©ã¤ã‹ãªã„

```dart
class WalletPage extends HookConsumerWidget {
  const WalletPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final combinedValue = ref.watch(combinedWalletDataProvider);

    Future<void> onRefresh() async {
      try {
        // ã“ã“ã§ Notifier ã® getNfts/getWallet ã‚’å‘¼ã³å‡ºã™
        // ä¾‹: pull to refresh
        await ref.read(getNftsNotifierProvider.notifier).getNfts();
        await ref.read(getWalletNotifierProvider.notifier).getWallet();
      } catch (e) {
        if (context.mounted) {
          ScaffoldMessenger.of(context).showSnackBar(SnackBar(
            content: Text('Error: $e'),
          ));
        }
      }
    }

    return Scaffold(
      body: RefreshIndicator(
        onRefresh: onRefresh,
        child: combinedValue.when(
          data: (data) {
            final walletData = data.$1;
            final nftsData = data.$2;
            // ã“ã“ã§ null ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã‹ã©ã†ã‹ã¯ä»•æ§˜æ¬¡ç¬¬ã ãŒã€
            // ã™ã§ã«2ã¤ã® Notifier ãŒã€Œnullã‚ã‚‹ã‹ã‚‚ã€ã¨ã—ã¦ã„ã‚‹ã®ã§ã€åˆ¤å®šã™ã‚‹å ´åˆã‚‚ã€‚
            if (walletData == null || nftsData == null) {
              return const Center(child: Text('No data'));
            }
            // ã“ã“ã§UIæ§‹ç¯‰
            return ListView(...);
          },
          loading: () => const Center(child: CircularProgressIndicator()),
          error: (e, st) => Center(child: Text('Error: $e')),
        ),
      ),
    );
  }
}
```

ã“ã®çŠ¶æ…‹ã§ã€Œæ—¢ã«ä¸€åº¦ãƒ‡ãƒ¼ã‚¿å–å¾—æ¸ˆã¿ã€ã®ã¨ãã« `onRefresh()` ã‚’å‘¼ã‚“ã§ã‚‚ã€  
**Notifier å´ã§ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã«ã—ãªã„ â†’ `combinedWalletDataProvider` ã‚‚ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã«åˆ‡ã‚Šæ›¿ã‚ã‚‰ãªã„ â†’ ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã¯ãã®ã¾ã¾**  
â€¦ã¨ãªã‚‹ãŸã‚ã€**ãƒãƒ©ã¤ãï¼ˆç”»é¢å…¨ä½“ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹ã‚ˆã†ãªæŒ™å‹•ï¼‰** ãŒç™ºç”Ÿã—ãªããªã‚Šã¾ã™ã€‚

---

## æ³¨æ„: ãƒ¦ãƒ¼ã‚¶ä½“é¨“ä¸Šã€æœ¬å½“ã«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’å…¨ãå‡ºã•ãªã„ã®ã‹ï¼Ÿ

- ã€Œå…¨ããƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã‚’å‡ºã•ãªã„ã€ã¨ãªã‚‹ã¨ã€ãƒ¦ãƒ¼ã‚¶ã¯ã€Œå†å–å¾—ä¸­ã‹ã©ã†ã‹ã€åˆ†ã‹ã‚‰ãªã„ã®ã§ã€**ã©ã“ã‹ã« â€œæ›´æ–°ä¸­â€ ã‚’ç¤ºã™ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ã‚’å‡ºã™** ãªã©ã®å·¥å¤«ã‚‚å¿…è¦ãªå ´åˆãŒã‚ã‚Šã¾ã™ã€‚  
- ãŸã¨ãˆã°ã€Œç”»é¢å…¨ä½“ã‚’ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã«ã—ãªã„ã€ã‘ã©ã€**ä¸€éƒ¨ã«ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚„ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¢ã‚¤ã‚³ãƒ³ã‚’é‡ã­ã‚‹** (Shimmer UI ã®ã‚ˆã†ãªå®Ÿè£…) ãªã©ãŒä¸€èˆ¬çš„ã§ã™ã€‚  
- ã‚ã‚‹ã„ã¯ã€ŒPullToRefresh ã®ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ï¼ˆãã‚‹ãã‚‹ï¼‰ãŒå›ã£ã¦ã„ã‚‹é–“ã¯ã€ãƒªã‚¹ãƒˆè‡ªä½“ã¯å‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã—ç¶šã‘ã‚‹ã€ã¨ã„ã†ã‚„ã‚Šæ–¹ã‚‚ã‚ã‚Šã¾ã™ã€‚

**ã€Œãƒãƒ©ã¤ã (ä¸€ç¬ç”»é¢ãŒç™½ã‚„ç©ºã«ãªã‚‹)ã€ã‚’é˜²ã** ã®ã¨ã€**ã€Œå…¨ããƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’å‡ºã•ãšã«éš ã‚ŒãŸã¨ã“ã‚ã§ãƒ•ã‚§ãƒƒãƒã€** ã¯å¾®å¦™ã«ç•°ãªã‚‹ã®ã§ã€ã‚¢ãƒ—ãƒªã®è¦ä»¶ã«ã‚ã‚ã›ã¦åˆ¶å¾¡ã—ã¦ãã ã•ã„ã€‚

---

# ã¾ã¨ã‚

- **ãƒãƒ©ã¤ãã®åŸå› ** â†’ Notifier ãŒã€Œå†ãƒ•ã‚§ãƒƒãƒã®ãŸã³ã« `state = AsyncValue.loading()`ã€â†’ ä¾å­˜ã—ã¦ã„ã‚‹ `combinedWalletDataProvider` ã‚‚ `loading` â†’ UI ãŒãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã«å¤‰ã‚ã‚‹  
- **è§£æ±ºç­–**  
  1. **Notifier ã® `getWallet()/getNfts()` å†…ã§ã€Œæ—¢ã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ãªã‚‰ `loading` ã«ã—ãªã„ã€** å®Ÿè£…ã«ã™ã‚‹  
     ```dart
     if (!state.hasValue) {
       state = const AsyncValue.loading();
     }
     ```  
  2. **`combinedWalletDataProvider` ã‚’ `autoDispose.keepAlive()` ãªã©ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ®‹ã™**  
  3. **UI ã¯ã€Œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã—ç¶šã‘ã‚‹ã€** ã“ã¨ãŒã§ãã‚‹ã®ã§ã€å†å–å¾—ä¸­ã«ç”»é¢ãŒä¸€ç¬æ¶ˆãˆã‚‹ç¾è±¡ï¼ˆãƒãƒ©ã¤ãï¼‰ãŒèµ·ããªããªã‚‹  

ã“ã‚Œã«ã‚ˆã£ã¦ã€**ã€Œæœ€åˆã®ä¸€å›ã ã‘ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¡¨ç¤ºã—ã€2å›ç›®ä»¥é™ã®ãƒ•ã‚§ãƒƒãƒã§ã¯ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¡¨ç¤ºã—ãªã„ã€** æŒ™å‹•ã‚’å®Ÿç¾ã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/02/11 10:23:30*

ãã‚Œã¯ã‚‚ã†ã‚„ã£ã¦ã„ã‚‹ã‚“ã ã€‚
ãªãœã‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒåŠ¹ã‹ãšå¿…ãšãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãŒ2å›èµ°ã£ã¦ã„ã‚‹æ§˜ãªæŒ™å‹•ã«ãªã‚‹ã€‚

import 'package:dio/dio.dart';
import 'package:flutter/foundation.dart';
import 'package:riverpod_annotation/riverpod_annotation.dart';
import 'package:snpit_guild_app/domain/api_error.dart';
import 'package:snpit_guild_app/infrastructure/snapit_guild_api/snapit_guild_api.openapi.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/api_provider.dart';
import 'package:snpit_guild_app/utils/api_handling_utils.dart';

part 'get_nfts.g.dart';

@Riverpod(keepAlive: true)
class GetNftsNotifier extends _$GetNftsNotifier {
  @override
  Future&lt;GetUserNftsResponseDTOData?&gt; build() async =&gt; null;

  Future&lt;GetUserNftsResponseDTOData&gt; getNfts() async {
    final oldData = state.valueOrNull;
    if (oldData == null) {
      state = const AsyncValue.loading();
    }
    try {
      try {
        final api = await ref.watch(usersApiProvider.future);
        final response = await api.userControllerGetUserNfts();
        debugPrint('Response Body: ${response.data}');
        debugPrint('Response Body.data: ${response.data?.data}');
        checkForApiError(response.data);
        final data = response.data?.data;
        if (data == null) {
          throw Exception('No data found');
        }
        state = AsyncValue.data(data);
        return data;
      } on DioException catch (error) {
        debugPrintDioException(error);
        checkForApiError(error.response?.data);
        rethrow;
      } on Exception {
        rethrow;
      }
    } on ApiError catch (error, stackTrace) {
      apiErrorHandling(error, ref);
      state = AsyncValue.error(error, stackTrace);
      rethrow;
    } on Exception catch (error, stackTrace) {
      debugPrint('Error: $error');
      state = AsyncValue.error(error, stackTrace);
      rethrow;
    }
  }
}

import 'package:dio/dio.dart';
import 'package:flutter/foundation.dart';
import 'package:riverpod_annotation/riverpod_annotation.dart';
import 'package:snpit_guild_app/domain/api_error.dart';
import 'package:snpit_guild_app/infrastructure/snapit_guild_api/snapit_guild_api.openapi.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/api_provider.dart';
import 'package:snpit_guild_app/utils/api_handling_utils.dart';

part 'get_wallet.g.dart';

@Riverpod(keepAlive: true)
class GetWalletNotifier extends _$GetWalletNotifier {
  @override
  Future&lt;WalletBalanceResponseDTOData?&gt; build() async =&gt; null;

  Future&lt;WalletBalanceResponseDTOData&gt; getWallet() async {
    final oldData = state.valueOrNull;
    if (oldData == null) {
      state = const AsyncValue.loading();
    }
    try {
      try {
        final api = await ref.watch(walletApiProvider.future);
        final response = await api.walletControllerGetBalance();
        debugPrint('Response Body: ${response.data}');
        debugPrint('Response Body.data: ${response.data?.data}');
        checkForApiError(response.data);
        final data = response.data?.data;
        if (data == null) {
          throw Exception('No data found');
        }
        state = AsyncValue.data(data);
        return data;
      } on DioException catch (error) {
        debugPrintDioException(error);
        checkForApiError(error.response?.data);
        rethrow;
      } on Exception {
        rethrow;
      }
    } on ApiError catch (error, stackTrace) {
      apiErrorHandling(error, ref);
      state = AsyncValue.error(error, stackTrace);
      rethrow;
    } on Exception catch (error, stackTrace) {
      debugPrint('Error: $error');
      state = AsyncValue.error(error, stackTrace);
      rethrow;
    }
  }
}

import 'package:auto_size_text/auto_size_text.dart';
import 'package:flutter/material.dart';
import 'package:flutter/services.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:snpit_guild_app/domain/design/color_pallet.dart';
import 'package:snpit_guild_app/domain/design/color_token.dart';
import 'package:snpit_guild_app/domain/nft.dart';
import 'package:snpit_guild_app/domain/nft_type.dart';
import 'package:snpit_guild_app/gen/assets.gen.dart';
import 'package:snpit_guild_app/infrastructure/snapit_guild_api/snapit_guild_api.openapi.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/users/nfts/get_nfts.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/wallet/get_wallet.dart';
import 'package:snpit_guild_app/presentation/widgets/square_image.dart';
import 'package:snpit_guild_app/utils/snack_bar_utils.dart';

final combinedWalletDataProvider = FutureProvider&lt;
    (
      WalletBalanceResponseDTOData?,
      GetUserNftsResponseDTOData?,
    )&gt;((ref) async {
  final wallet = await ref.watch(getWalletNotifierProvider.future);
  final nfts = await ref.watch(getNftsNotifierProvider.future);

  return (wallet, nfts);
});

class WalletPage extends HookConsumerWidget {
  const WalletPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    Future&lt;void&gt; onTapNft(Nft nft) async {
      // TODO: [ãƒ•ã‚§ãƒ¼ã‚º2] NFT è©³ç´°ç”»é¢ã¸ã®é·ç§»
    }

    Future&lt;void&gt; onTapWalletAddress(String walletAddress) async {
      await Clipboard.setData(ClipboardData(text: walletAddress));

      if (context.mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text('$walletAddress copied to clipboard')),
        );
      }
    }

    Future&lt;void&gt; onRefresh() async {
      try {
        await ref.read(getNftsNotifierProvider.notifier).getNfts();
        await ref.read(getWalletNotifierProvider.notifier).getWallet();
      } on Exception catch (error) {
        if (context.mounted) {
          showErrorSnackBar(context, error);
        }
      }
    }

    final combinedWalletAsyncValue = ref.watch(combinedWalletDataProvider);

    useEffect(
      () {
        Future.microtask(() async {
          await onRefresh();
        });
        return null;
      },
      [],
    );

    return Scaffold(
      appBar: AppBar(title: const Text('Wallet')),
      body: RefreshIndicator(
        onRefresh: () async {
          await onRefresh();
        },
        color: ColorToken.primary,
        backgroundColor: ColorToken.bgLight,
        child: combinedWalletAsyncValue.when(
          data: (data) {
            final walletDate = data.$1;
            final nftsData = data.$2;
            if (nftsData == null || walletDate == null) {
              return const SizedBox.shrink();
            }

            final stpValue = walletDate.stpAmount ?? 0;
            final tmpWalletAddress = walletDate.walletAddress ?? '';
            final walletAddress =
                (tmpWalletAddress.isNotEmpty) ? tmpWalletAddress : 'No Address';

            final explorers = nftsData.explorers ?? [];
            final flags = nftsData.flags ?? [];

            final explorerNfts = explorers.map((explorer) {
              final nameParts = explorer.explorerName?.split(' #') ?? ['', ''];
              final name = nameParts[0];
              final number = nameParts.length &gt; 1 ? '#${nameParts[1]}' : '';

              return Nft(
                nftId: explorer.explorerId ?? '',
                tokenId: explorer.tokenId ?? '',
                name: name,
                number: number,
                imageUrl: explorer.explorerImage ?? '',
                nftType: NftType.explorer,
                explorer: explorer,
              );
            }).toList();

            final flagNfts = flags.map((flag) {
              final nameParts = flag.flagName?.split(' #') ?? ['', ''];
              final name = nameParts[0];
              final number = nameParts.length &gt; 1 ? '#${nameParts[1]}' : '';

              return Nft(
                nftId: flag.flagId ?? '',
                tokenId: flag.tokenId ?? '',
                name: name,
                number: number,
                imageUrl: flag.flagImage ?? '',
                nftType: NftType.flag,
                flag: flag,
              );
            }).toList();

            final allNfts = [
              ...explorerNfts,
              ...flagNfts,
            ];

            return SingleChildScrollView(
              physics: const AlwaysScrollableScrollPhysics(),
              child: Padding(
                padding: const EdgeInsets.all(24),
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    Column(
                      children: [
                        DecoratedBox(
                          decoration: BoxDecoration(
                            color: ColorToken.bg,
                            borderRadius: BorderRadius.circular(8),
                            border: Border.all(
                              color: ColorToken.border,
                            ),
                          ),
                          child: Padding(
                            padding: const EdgeInsets.all(24),
                            child: Column(
                              children: [
                                Image.asset(
                                  Assets.images.stpCoinIcon.path,
                                  width: 32,
                                  height: 32,
                                ),
                                const SizedBox(height: 14),
                                Row(
                                  mainAxisAlignment: MainAxisAlignment.center,
                                  crossAxisAlignment:
                                      CrossAxisAlignment.baseline,
                                  textBaseline: TextBaseline.alphabetic,
                                  children: [
                                    Flexible(
                                      child: AutoSizeText(
                                        stpValue.toString(),
                                        style: const TextStyle(
                                          fontSize: 32,
                                          fontWeight: FontWeight.bold,
                                        ),
                                        maxLines: 1,
                                        minFontSize: 1,
                                        overflow: TextOverflow.ellipsis,
                                      ),
                                    ),
                                    const SizedBox(width: 6),
                                    const Text(
                                      'STP',
                                      style: TextStyle(
                                        fontSize: 16,
                                      ),
                                    ),
                                  ],
                                ),
                                const SizedBox(height: 24),
                                GestureDetector(
                                  onTap: () async {
                                    await onTapWalletAddress(walletAddress);
                                  },
                                  child: Container(
                                    padding: const EdgeInsets.symmetric(
                                      horizontal: 10,
                                      vertical: 5,
                                    ),
                                    decoration: BoxDecoration(
                                      color: ColorPallet.gray800,
                                      borderRadius: BorderRadius.circular(4),
                                    ),
                                    child: Text(
                                      walletAddress,
                                      maxLines: 1,
                                      overflow: TextOverflow.ellipsis,
                                      style: const TextStyle(
                                        fontSize: 13,
                                        color: ColorToken.primaryDark,
                                      ),
                                    ),
                                  ),
                                ),
                              ],
                            ),
                          ),
                        ),
                      ],
                    ),
                    const SizedBox(height: 16),

                    // NFTs
                    const Text(
                      'NFTs',
                      style: TextStyle(
                        fontSize: 16,
                        fontWeight: FontWeight.bold,
                      ),
                    ),
                    const SizedBox(height: 16),

                    if (allNfts.isEmpty)
                      const Center(child: Text('No NFTs owned')),

                    Column(
                      children: allNfts.map((nft) {
                        return Padding(
                          padding: const EdgeInsets.only(bottom: 8),
                          child: ClipRRect(
                            borderRadius: BorderRadius.circular(8),
                            // TODO: [ãƒ•ã‚§ãƒ¼ã‚º2] NFT è©³ç´°ç”»é¢ã¸ã®é·ç§»ï¼ˆãƒªãƒƒãƒ—ãƒ«ã«å¤‰æ›´ã™ã‚‹ï¼‰
                            // child: Ink(
                            child: DecoratedBox(
                              decoration: BoxDecoration(
                                color: ColorToken.bg,
                                borderRadius: BorderRadius.circular(8),
                                border: Border.all(
                                  color: ColorToken.border,
                                ),
                              ),
                              child: InkWell(
                                borderRadius: BorderRadius.circular(8),
                                onTap: () async {
                                  await onTapNft(nft);
                                },
                                child: Padding(
                                  padding: const EdgeInsets.all(16),
                                  child: Row(
                                    children: [
                                      ClipRRect(
                                        borderRadius: BorderRadius.circular(4),
                                        child: SquareImage(
                                          imageUrl: nft.imageUrl,
                                          size: 56,
                                        ),
                                      ),
                                      const SizedBox(width: 16),
                                      Expanded(
                                        child: Column(
                                          crossAxisAlignment:
                                              CrossAxisAlignment.start,
                                          children: [
                                            Row(
                                              children: [
                                                Expanded(
                                                  child: Text(
                                                    nft.name,
                                                    maxLines: 1,
                                                    overflow:
                                                        TextOverflow.ellipsis,
                                                    style: const TextStyle(
                                                      fontSize: 14,
                                                      fontWeight:
                                                          FontWeight.bold,
                                                    ),
                                                  ),
                                                ),
                                                const SizedBox(width: 4),
                                                Text(
                                                  nft.number,
                                                  maxLines: 1,
                                                  overflow:
                                                      TextOverflow.ellipsis,
                                                  style: const TextStyle(
                                                    fontSize: 12,
                                                    fontWeight: FontWeight.bold,
                                                    color: ColorPallet.gray300,
                                                  ),
                                                ),
                                              ],
                                            ),
                                            const SizedBox(height: 12),
                                            Text(
                                              'TokenID: ${nft.tokenId}',
                                              maxLines: 1,
                                              overflow: TextOverflow.ellipsis,
                                              style: const TextStyle(
                                                fontSize: 12,
                                              ),
                                            ),
                                          ],
                                        ),
                                      ),
                                      // TODO: [ãƒ•ã‚§ãƒ¼ã‚º2] NFT è©³ç´°ç”»é¢ã¸ã®é·ç§»
                                      // const Icon(
                                      //   Icons.chevron_right,
                                      //   size: 32,
                                      //   color: ColorToken.text,
                                      // ),
                                    ],
                                  ),
                                ),
                              ),
                            ),
                          ),
                        );
                      }).toList(),
                    ),
                    const SizedBox(height: 24),
                  ],
                ),
              ),
            );
          },
          loading: () {
            return const Center(
              child: CircularProgressIndicator(),
            );
          },
          error: (error, _) {
            return Center(
              child: Text('Error: $error'),
            );
          },
        ),
      ),
    );
  }
}

---

## ğŸ”§ ãƒ„ãƒ¼ãƒ«
*2025/02/11 10:24:26*

**ãƒ‡ãƒ¼ã‚¿å–å¾—ã®å•é¡Œã‚’ç‰¹å®šã™ã‚‹**

2ã¤ã® Notifier ãŒ Future&lt;Dto?&gt; ã‚’è¿”ã—ã€å¸¸ã«èª­ã¿è¾¼ã¿ãŒ2å›è¡¨ç¤ºã•ã‚Œã‚‹å•é¡Œã‚’æŠ±ãˆã¦ã„ã‚‹ã€‚combineProvider ã§ã¯ã€wallet ã¨ nfts ã®FutureProviderã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã€‚ãƒ‡ãƒ¼ã‚¿ãŒæ›´æ–°ã•ã‚Œã‚‹ãŸã³ã«ã€çŠ¶æ…‹ã‚’èª­ã¿è¾¼ã¿ã«è¨­å®šã—ã€fetchã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã—ã¦ã„ã‚‹ã€‚cacheãŒæ­£ã—ãå‹•ä½œã—ã¦ã„ãªã„å¯èƒ½æ€§ãŒé«˜ã„ã€‚

**ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã®å›æ•°ã‚’ç¢ºèª**

`onRefresh`ãŒ`useEffect`ã§å‘¼ã³å‡ºã•ã‚Œã€RefreshIndicatorãŒå¼•ã£å¼µã‚‰ã‚Œã‚‹ã¨ã€ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãŒäºŒé‡ã«ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã ã€‚ã“ã‚ŒãŒ2å›ã®èª­ã¿è¾¼ã¿ã‚’å¼•ãèµ·ã“ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚

**å†å¸°çš„ãªãƒˆãƒªã‚¬ãƒ¼ç¢ºèª**

combinedWalletAsyncValue ãŒ `FutureProvider` ã‹ã‚‰ã® `AsyncValue` ã§ã€`.future` ã‚¦ã‚©ãƒƒãƒãƒ£ãƒ¼ãŒå†å®Ÿè¡Œã•ã‚Œã‚‹ãŸã³ã«æ–°ã—ã„ `Future` ãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¦ã„ã‚‹ã€‚

**ãƒ‡ãƒ¼ã‚¿ä¿æŒã®çŠ¶æ³**

`useEffect`ã‚’ä½¿ã£ã¦`onRefresh()`ãŒå‘¼ã³å‡ºã•ã‚Œã€å†å»ºæ™‚ã«å¿…ãšãƒ‡ãƒ¼ã‚¿ãŒæœ€æ–°ã®çŠ¶æ…‹ã«æ›´æ–°ã•ã‚Œã‚‹ã€‚ãƒ‡ãƒ¼ã‚¿ã¯ä¿æŒã•ã‚Œã¦ã„ã‚‹ã€‚

**ãƒ‡ãƒ¼ã‚¿ã®ç¶­æŒã‚’æ„è­˜ã™ã‚‹**

initial `Notifier`ã¯`AsyncValue.data(null)`ã§ã€`getNfts()`ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹ã¨çŠ¶æ…‹ã¯`loading`ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã€‚

**é‡è¤‡å‘¼ã³å‡ºã—ã®å¯èƒ½æ€§**

`FutureProvider`ã¨æ‰‹å‹•ã§`getNfts`ã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹ãŒã€é‡è¤‡ã—ã¦ã„ã‚‹ã‚ˆã†ã ã€‚2å›ç›®ã®å‘¼ã³å‡ºã—å¾Œã«`loading`çŠ¶æ…‹ã«æˆ»ã‚‹ã“ã¨ã¯ãªã„ã€‚

**ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã¨ãƒ‡ãƒ¼ã‚¿åæ˜ **

`useEffect`ã®`onRefresh()`å‘¼ã³å‡ºã—ã§`getNftsNotifierProvider`ãŒèª­ã¿è¾¼ã¿ã€ãƒ‡ãƒ¼ã‚¿ãŒæˆ»ã‚‹ã¨åŒæ™‚ã«ã€`RefreshIndicator`ã‹ã‚‰å†åº¦`onRefresh()`ãŒæ‰‹å‹•ã§å‘¼ã³å‡ºã•ã‚Œã¦ã„ã‚‹ã€‚

**å†æ§‹ç¯‰ã¨æ‰‹å‹•å‘¼ã³å‡ºã—ã‚’ç–‘ã†**

`getNftsNotifierProvider`ã‚„`getWalletNotifierProvider`ã®å†æ§‹ç¯‰ãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ‰‹å‹•ã§çŠ¶æ…‹ã‚’`loading`ã«è¨­å®šã—ã¦ã„ã‚‹å¯èƒ½æ€§ã‚’æ¢ã£ã¦ã„ã‚‹ã€‚

**åˆæœŸçŠ¶æ…‹ã®æ¤œè¨**

`AsyncValue.data(null)`ã¨`AsyncValue<Dto?>`ã®é•ã„ã‚’è¦‹ã¦ã„ã‚‹ã€‚`oldData`ãŒ`null`ã§ã‚‚`hasValue`ãŒ`true`ãªã‚‰ã€`loading`ã«ã¯ãªã‚‰ãªã„å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚

**ãƒ‡ãƒ¼ã‚¿ã®åˆæœŸåŒ–ã‚’è¦‹æ¥µã‚ã‚‹**

`oldData`ãŒ`null`ã®å ´åˆã¯`loading`ã‚’è¨­å®šã—ã€2å›ç›®ã®å‘¼ã³å‡ºã—æ™‚ã«`oldData`ãŒ`null`ã§ãªã„ã¨ã€`loading`ã¯è¨­å®šã•ã‚Œãªã„ã€‚

**ç¢ºèªã¨ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥**

`useEffect`ã®`onRefresh()`å‘¼ã³å‡ºã—ãŒ`getNftsNotifierProvider`ã®å†å‘¼ã³å‡ºã—ã‚’å¼•ãèµ·ã“ã—ã€ãã‚ŒãŒ`loading`çŠ¶æ…‹ã«åˆ‡ã‚Šæ›¿ã‚ã£ã¦ã„ã‚‹å¯èƒ½æ€§ã‚’æ¢ã£ã¦ã„ã‚‹ã€‚

**ä¸è¦ã®é¸æŠè‚¢ã‚’è¦‹ã¤ã‘ã‚‹**

`useEffect()`å†…ã®`onRefresh()`ã‚’å‰Šé™¤ã™ã‚‹ã‹ã€`getNftsNotifierProvider.future`ã®ç›£è¦–ã‚’å¤–ã™ã“ã¨ã§ã€2å›ç›®ã®`loading`è¨­å®šã‚’é¿ã‘ã‚‹æ–¹æ³•ã‚’æ¢ã£ã¦ã„ã‚‹ã€‚

**æ‰‹å‹•æ›´æ–°ã®é¸æŠè‚¢**

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¼•ãå‡ºã™éš›ã«æ‰‹å‹•ã§æ›´æ–°ã‚’è¡Œã£ã¦ã„ã‚‹ã¨ã€`combinedWalletDataProvider`ãŒ`build()`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã€2ã¤ç›®ã®ã‚¹ãƒ”ãƒŠãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹å¯èƒ½æ€§ã‚’æ¤œè¨ã—ã¦ã„ã‚‹ã€‚

**å˜ä¸€ãƒ‡ãƒ¼ã‚¿å–å¾—ã®æ“ä½œã‚’è€ƒæ…®**

`combinedWalletDataProvider`ãŒãƒ‡ãƒ¼ã‚¿ã®ä¸»è¦ã‚½ãƒ¼ã‚¹ã¨ãªã‚‹ã‚ˆã†ã«ã€`notifiers`ã®`build`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã—ã€å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’`combined provider`ã«ä»»ã›ã‚‹æ–¹æ³•ã‚’æ¤œè¨ã—ã¦ã„ã‚‹ã€‚

**æ‰‹å‹•æ›´æ–°ã®å°å…¥**

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ`combined provider`ã‚’ãƒ‡ãƒ¼ã‚¿ã®ä¸»ãªå–å¾—æºã¨ã—ã€`notifiers`ãŒæ‰‹å‹•ã§`onRefresh()`ã‚’å‘¼ã³å‡ºã—ã¦æ›´æ–°ã™ã‚‹æ–¹æ³•ã‚’ã€å‹•çš„ãªæ›´æ–°ãŒä¸è¦ãªå ´åˆã«é‡è¦–ã—ã¦ã„ã‚‹ã€‚

**æ‰‹å‹•æ›´æ–°ã®ä»•æ§˜å¤‰æ›´**

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‹ãƒ¼ã‚ºã«åˆã†ã‚ˆã†ã€`combined provider`ã®`.future`ã‚’çœãã€`getNftsNotifierProvider`ã¨`getWalletNotifierProvider`ã‚’`AsyncValue`ã¨ã—ã¦ç›£è¦–ã—ã€`when`ã§çµåˆã™ã‚‹æ–¹æ³•ã‚’å–ã‚Šå…¥ã‚Œã¦ã„ã‚‹ã€‚

**ä¾å­˜é–¢ä¿‚ã®è¦‹ç›´ã—**

`useEffect(() => onRefresh())`ã‚’å¤–ã—ã€`combinedWalletDataProvider`ã®è‡ªå‹•å–å¾—ã‚’ãªãã™æ–¹æ³•ãŒã€æœ€é©ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¨ã—ã¦è©•ä¾¡ã•ã‚Œã¦ã„ã‚‹ã€‚

**å›è»¢ç¾è±¡ã®è§£é‡ˆ**

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ`onRefresh()`ã‚’å‘¼ã³å‡ºã™ã¨ã€`getWalletNotifierProvider.notifier.getWallet()`ãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã€`combined provider`ãŒèª­ã¿è¾¼ã¿çŠ¶æ…‹ã«æˆ»ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã¨è€ƒãˆã¦ã„ã‚‹ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/02/11 10:24:26*

æœ€ã‚‚å¤šã„åŸå› ã¨ã—ã¦ã¯ã€**ã€Œ`FutureProvider` å´ã§ä¾å­˜å…ˆã® Notifier ã‚’ `.future` ã§å¾…ã¡å—ã‘ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã€ã¨ã€Œç”»é¢ã®åˆæœŸåŒ–ã‚„ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥æ™‚ã«æ‰‹å‹•ã§ `getNfts()` / `getWallet()` ã‚’å‘¼ã¶ãƒ­ã‚¸ãƒƒã‚¯ã€ã®ä¸¡æ–¹ãŒèµ°ã£ã¦ã„ã‚‹** ã“ã¨ã§ã€ã€ŒäºŒé‡ã«å†ãƒ•ã‚§ãƒƒãƒ â†’ 2å›ç›®ã® `loading` è¡¨ç¤ºã€ãŒç™ºç”Ÿã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã§ã™ã€‚

åŠ ãˆã¦ã€**Notifier ã®åˆæœŸçŠ¶æ…‹ãŒ `AsyncValue.data(null)`** ã§ã‚ã‚‹å ´åˆã€`oldData == null` åˆ¤å®šãŒçœŸã¨ãªã‚Šã€ã¾ãŸ `loading` ã«åˆ‡ã‚Šæ›¿ã‚ã£ã¦ã—ã¾ã†â€•â€•ã¤ã¾ã‚Šã€Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒåŠ¹ã„ã¦ã„ãªã„ã‚ˆã†ã«è¦‹ãˆã‚‹ã€å‹•ãã«ãªã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã«ã€ã‚ˆãã‚ã‚‹ã€ŒäºŒé‡ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãŒèµ·ãã‚‹ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ãã®å¯¾ç­–ã‚’ã¾ã¨ã‚ã¾ã™ã€‚

---

# ãªãœ `loading` ãŒ2å›èµ°ã‚‹ã®ã‹ï¼Ÿ

### 1. `FutureProvider` ãŒã€Œä¾å­˜å…ˆ Notifier ã® Futureã€ã‚’è‡ªå‹•å®Ÿè¡Œã—ã¦ã„ã‚‹

```dart
final combinedWalletDataProvider = FutureProvider<
    (WalletBalanceResponseDTOData?, GetUserNftsResponseDTOData?)>((ref) async {
  // ã“ã‚ŒãŒã€ŒNotfier ã® Futureã€ã‚’å¾…ã¡ã€ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’è‡ªå‹•ãƒˆãƒªã‚¬ãƒ¼ã—ã¦ã„ã‚‹
  final wallet = await ref.watch(getWalletNotifierProvider.future);
  final nfts = await ref.watch(getNftsNotifierProvider.future);

  return (wallet, nfts);
});
```

`ref.watch(XxxNotifierProvider.future)` ã¯ã€Œ`build()` ãŒè¿”ã™ Future ã‚’ `await` ã™ã‚‹ã€ä»•çµ„ã¿ã§ã™ã€‚  
- Notifier ã§ `build() => null;` ã¨ã—ã¦ã„ã‚‹å ´åˆã€**æœ€åˆã¯ â€œnull ã‚’å³åº§ã«è¿”ã™ Futureâ€ â†’ 2å›ã‚ä»¥é™ã« `getNfts()`/`getWallet()` ãŒå‘¼ã°ã‚ŒãŸã¨ãã«ã¾ãŸå¤‰åŒ–** ã¨ã„ã†æŒ™å‹•ã«ãªã‚ŠãŒã¡ã§ã™ã€‚  
- ã“ã‚Œã«åŠ ãˆã¦ **UI å´ã§ `onRefresh()` ã‚’å‘¼ã‚“ã§ `getNfts()` / `getWallet()` ã‚’ã‚‚ã†ä¸€åº¦å®Ÿè¡Œ** ã—ã¦ã„ã‚‹ã¨ã€**2å›åˆ†ã®å†ãƒ•ã‚§ãƒƒãƒ** ãŒèµ°ã£ã¦ã—ã¾ã„ã¾ã™ã€‚

### 2. `useEffect` ã§ç”»é¢åˆæœŸåŒ–æ™‚ã« `onRefresh()` ã‚’å‘¼ã‚“ã§ã„ã‚‹

```dart
useEffect(
  () {
    Future.microtask(() async {
      await onRefresh();
    });
    return null;
  },
  [],
);
```

ã“ã‚ŒãŒã‚ã‚‹ã¨ã€**ç”»é¢ãŒãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸç›´å¾Œã«** `ref.read(getNftsNotifierProvider.notifier).getNfts()` / `ref.read(getWalletNotifierProvider.notifier).getWallet()` ãŒå‘¼ã°ã‚Œã€Notifier å´ã¯ `oldData == null` ã§ã‚ã‚Œã° `loading` ã«ã€‚  
ãã—ã¦åŒã˜ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ `combinedWalletDataProvider` ã‚‚ä¾å­˜å…ˆã® `.future` ã‚’å¾…ã£ã¦ã„ã‚‹ãŸã‚ã€**é‡è¤‡ã—ã¦å†ãƒ•ã‚§ãƒƒãƒãŒèµ°ã‚‹** ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

---

# äºŒé‡ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’é˜²ããŸã‚ã®ä»£è¡¨çš„ãªæ–¹æ³•

## æ–¹æ³•A: **`combinedWalletDataProvider` ã‚’ã€Œåˆæˆç”¨ã®æ™®é€šã® `Provider`ã€ã«å¤‰ãˆã‚‹**  
Notifier ã®å–å¾—ï¼ˆfetchï¼‰ã¯æ‰‹å‹• or Notifier ã®ä¸­ã§è¡Œã„ã€`combinedWalletDataProvider` ã¯ **å˜ã«2ã¤ã® AsyncValue ã‚’ãƒãƒ¼ã‚¸** ã—ã¦è¿”ã™ã ã‘ã«ã™ã‚‹ã€‚  
ã“ã†ã™ã‚Œã° `combinedWalletDataProvider` å´ã§ã¯ **è‡ªå‹•ã§ Future ã‚’èµ°ã‚‰ã›ãªã„** ã®ã§ã€ãƒãƒ©ã¤ããŒæ¸›ã‚Šã¾ã™ã€‚

```dart
/// 1) Notifier ã¯ "å¿…è¦ãªã¨ãã« getNfts()" / "å¿…è¦ãªã¨ãã« getWallet()" ã‚’å‘¼ã¶" ã‚¹ã‚¿ã‚¤ãƒ«
@Riverpod(keepAlive: true)
class GetNftsNotifier extends _$GetNftsNotifier {
  @override
  FutureOr<GetUserNftsResponseDTOData?> build() => null;

  Future<GetUserNftsResponseDTOData?> getNfts() async {
    final oldData = state.valueOrNull;
    // æ—¢ã«ãƒ‡ãƒ¼ã‚¿ã‚’æŒã£ã¦ã„ã‚Œã°loadingã«ã—ãªã„
    if (oldData == null) {
      state = const AsyncValue.loading();
    }
    // ä»¥é™APIå‘¼ã³å‡ºã—
    // ...
  }
}

// åŒæ§˜ã«GetWalletNotifierã‚‚

/// 2) åˆæˆProviderã¯ã€Œ2ã¤ã® AsyncValue ã‚’ watchã€ã—ã¦ã€UIç”¨ã«ã¾ã¨ã‚ã‚‹ã ã‘
final combinedWalletDataProvider = Provider.autoDispose(
  (ref) {
    final walletState = ref.watch(getWalletNotifierProvider);
    final nftsState = ref.watch(getNftsNotifierProvider);

    // ã“ã“ã§ã¾ã¨ã‚ã¦UIãŒæ‰±ã„ã‚„ã™ã„å½¢ã«ã™ã‚‹ (AsyncValue ã§ãƒ©ãƒƒãƒ—ã—ãŸã‚Š)
    // ä¾‹ãˆã°:
    if (walletState.isLoading || nftsState.isLoading) {
      return const AsyncValue<(WalletBalanceResponseDTOData?, GetUserNftsResponseDTOData?)>.loading();
    }
    if (walletState.hasError) {
      return AsyncValue<(WalletBalanceResponseDTOData?, GetUserNftsResponseDTOData?)>.error(
        walletState.error!,
        walletState.stackTrace,
      );
    }
    if (nftsState.hasError) {
      return AsyncValue<(WalletBalanceResponseDTOData?, GetUserNftsResponseDTOData?)>.error(
        nftsState.error!,
        nftsState.stackTrace,
      );
    }

    // dataåŒå£«ãªã‚‰ã‚¿ãƒ—ãƒ«ã§ã¾ã¨ã‚ã‚‹
    return AsyncValue.data(
      (walletState.valueOrNull, nftsState.valueOrNull),
    );
  },
);
```

### UI å´

```dart
final combinedWalletAsyncValue = ref.watch(combinedWalletDataProvider);

Widget build(BuildContext context, WidgetRef ref) {
  useEffect(() {
    // åˆå›ã ã‘ãƒ‡ãƒ¼ã‚¿å–å¾—ã—ãŸã„ãªã‚‰ã“ã“ã§å‘¼ã¶
    Future.microtask(() => onRefresh());
    return null;
  }, []);

  return combinedWalletAsyncValue.when(
    data: (data) {
      final walletData = data.$1;
      final nftsData = data.$2;
      if (walletData == null || nftsData == null) {
        return const SizedBox.shrink();
      }
      // ...
    },
    loading: () => const Center(child: CircularProgressIndicator()),
    error: (e, st) => Center(child: Text('Error: $e')),
  );
}

Future<void> onRefresh() async {
  await ref.read(getNftsNotifierProvider.notifier).getNfts();
  await ref.read(getWalletNotifierProvider.notifier).getWallet();
}
```

ã“ã®å½¢ãªã‚‰ã€**`combinedWalletDataProvider` ã¯ã‚ãã¾ã§ã€ŒçŠ¶æ…‹ã‚’ã¾ã¨ã‚ã‚‹ã ã‘ã€** ã§ **è‡ªå‰ã® Future ã‚’èµ°ã‚‰ã›ãªã„**ã€‚  
ã‚ˆã£ã¦ã€Œç”»é¢åˆæœŸåŒ– or PullToRefresh ã§æ‰‹å‹•å‘¼ã³å‡ºã— â†’ Notifier ãŒå†ãƒ•ã‚§ãƒƒãƒ â†’ state ãŒå¤‰ã‚ã‚‹ â†’ `combinedWalletDataProvider` ãŒãã®çµæœã‚’ãƒãƒ¼ã‚¸ã€ã¨ã„ã†ã‚·ãƒ³ãƒ—ãƒ«ãªå‹•ãã«ãªã‚Šã€**é‡è¤‡ãƒ•ã‚§ãƒƒãƒ** ãŒèµ·ã“ã‚Šã«ãããªã‚Šã¾ã™ã€‚

---

## æ–¹æ³•B: **`combinedWalletDataProvider` ã ã‘ã§å®Œçµã™ã‚‹å®Ÿè£…ã«ã—ã¦ã€UI ã‹ã‚‰ `onRefresh()` ã‚’æ¶ˆã™**

é€†ã«ã€**`combinedWalletDataProvider` ã‚’ `FutureProvider` ã®ã¾ã¾æ´»ã‹ã™** ãªã‚‰ã€**UI ã§æ‰‹å‹• `onRefresh()` ã‚’å‘¼ã‚“ã§ `getNfts()` / `getWallet()` ã‚’å©ãå¿…è¦ã¯åŸºæœ¬çš„ã«ã‚ã‚Šã¾ã›ã‚“**ã€‚  
ãªãœãªã‚‰ `FutureProvider` è‡ªä½“ãŒã€Œãƒ—ãƒ­ãƒã‚¤ãƒ€ãŒåˆã‚ã¦ `watch` ã•ã‚ŒãŸã¨ãã«è‡ªå‹•ã§ Future ã‚’èµ°ã‚‰ã›ã‚‹ã€ä»•çµ„ã¿ã ã‹ã‚‰ã§ã™ã€‚

```dart
final combinedWalletDataProvider = FutureProvider
    .autoDispose
    .keepAlive()
    .<(WalletBalanceResponseDTOData, GetUserNftsResponseDTOData)>(
  (ref) async {
    // ã“ã“ã§ä¸€åº¦ã ã‘ fetch ã—ã¦è¿”ã™
    // é€£ç¶šã§fetchã™ã‚‹ã‚ã‘ã§ã¯ãªãã€æœ¬å½“ã«"1åº¦ã ã‘"ã®ä½¿ã„æ–¹ã‚’ã™ã‚‹ãªã‚‰ã“ã‚Œã§OK
    final apiWallet = await ref.watch(walletApiProvider.future);
    final walletRes = await apiWallet.walletControllerGetBalance();
    final walletData = walletRes.data?.data ?? (throw Exception('No wallet data'));

    final apiNfts = await ref.watch(usersApiProvider.future);
    final nftRes = await apiNfts.userControllerGetUserNfts();
    final nftsData = nftRes.data?.data ?? (throw Exception('No nfts data'));

    return (walletData, nftsData);
  },
);
```

### UI å´

```dart
class WalletPage extends ConsumerWidget {
  const WalletPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final combinedAsync = ref.watch(combinedWalletDataProvider);

    return Scaffold(
      appBar: AppBar(...),
      body: combinedAsync.when(
        data: (data) {
          final (walletData, nftsData) = data;
          // ...
        },
        loading: () => const Center(child: CircularProgressIndicator()),
        error: (e, st) => Center(child: Text('Error: $e')),
      ),
    );
  }
}
```

ã“ã‚Œãªã‚‰ã€Œåˆå›è¡¨ç¤ºæ™‚ã«1å›ã ã‘ API ã‚’å©ã â†’ å–å¾—å®Œäº†ã—ãŸã‚‰ç”»é¢ã«è¡¨ç¤º â†’ ä»¥å¾Œã¯ keepAlive ã•ã‚Œã¦ã„ã‚‹ã®ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæ®‹ã‚‹ã€ãŸã‚ã€**å†ãƒ“ãƒ«ãƒ‰ã—ã¦ã‚‚äºŒé‡ã§ãƒ•ã‚§ãƒƒãƒãŒèµ°ã‚‰ãš** ãƒãƒ©ã¤ãã¯ã»ã¼æ¶ˆãˆã¾ã™ã€‚  
PullToRefresh çš„ãªãƒªãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ãŒæœ¬å½“ã«å¿…è¦ãªã‚‰ã€`combinedWalletDataProvider` ã® `invalidate` ã‚’ä½¿ã†ã‹ã€åˆ¥é€”ã€Œå†å–å¾—ç”¨ã«å†åº¦ `Future` ã‚’èµ°ã‚‰ã›ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã€ã‚’æ›¸ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

---

## æ–¹æ³•C: ã€ŒNotifier å´ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‹å†ãƒ•ã‚§ãƒƒãƒåˆ¶å¾¡ã‚’è¡Œã„ã€`combinedWalletDataProvider` ã¯â€œå¾…ã¤ã ã‘â€ã€ï¼‹ã€ŒUI ã§ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã™ã‚‹ã¨ãã¯ `loading` ã«ã—ãªã„ã€

ä»Šã®æ§‹æˆã®ã¾ã¾äºŒé‡ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’æŠ‘ãˆãŸã„å ´åˆã¯ã€æ¬¡ã®ã‚ˆã†ãªæ‰‹ã‚’ä½¿ã„ã¾ã™:

1. **`combinedWalletDataProvider` ã§ `.future` ã‚’å¾…ãŸãªã„**  
   ä»£ã‚ã‚Šã«æ™®é€šã« `ref.watch(getWalletNotifierProvider)` / `ref.watch(getNftsNotifierProvider)` ã‚’ä½¿ã£ã¦ã€Œãƒ‡ãƒ¼ã‚¿ã‹ `loading` ã‹ `error` ã‹ã€ã‚’åˆæˆã—ã¾ã™ï¼ˆå…ˆè¿°ã®æ–¹æ³•Aã¨ã»ã¼åŒã˜ï¼‰ã€‚  

2. **`Notifier` å´ã§ã€Œæ—¢ã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ãªã‚‰ `loading` ã«ã—ãªã„ã€ã ã‘ã§ãªãã€ã€ŒåˆæœŸçŠ¶æ…‹ã‚‚ `AsyncValue.loading()` ã«ã™ã‚‹ã€**  
   - ãŸã¨ãˆã° `build()` ã§ `return null;` ã§ã¯ãªãã€ã„ããªã‚Š `return await fetch...;` ã®ã‚ˆã†ã«åˆå›ã‹ã‚‰å–å¾—ã™ã‚‹  
   - ãã†ã™ã‚Œã°åˆå›ã ã‘ `loading` â†’ 2å›ç›®ä»¥é™ã¯ `oldData != null` ãªã®ã§ `loading` ã«ã—ãªã„  
   - ã‚‚ã—ãã¯ã€Œ`build()` ã§ `AsyncValue.loading()` ã«ã—ã¦ãŠã„ã¦ã€å¾Œã‹ã‚‰æ‰‹å‹•ã§ fetch ã™ã‚‹ã€ãªã©å·¥å¤«ã™ã‚‹

3. **ç”»é¢å´ã§ `useEffect(() => onRefresh())` ã‚’æ¶ˆã™ã‹ã€`combinedWalletDataProvider` ã«è‡ªå‹•ãƒ•ã‚§ãƒƒãƒã•ã›ãªã„**  
   - ã‚‚ã—ã©ã†ã—ã¦ã‚‚ã€Œåˆå›ãƒã‚¦ãƒ³ãƒˆæ™‚ã«å¼·åˆ¶å†ãƒ•ã‚§ãƒƒãƒã€ã—ãŸã„ãªã‚‰ã€`Notifier` å†…ã® `build()` ã§æœ€åˆã« fetch ã™ã‚‹ã»ã†ãŒè‡ªç„¶ã§ã™ã€‚  
   - ã€Œ`combinedWalletDataProvider` ã§ `.future` ã‚’å‘¼ã‚“ã§ã„ã‚‹ã€ï¼‹ã€Œç”»é¢ãƒã‚¦ãƒ³ãƒˆæ™‚ã« `onRefresh()` ã‚‚å‘¼ã¶ã€ã®ã‚ˆã†ã«äºŒé‡å‘¼ã³å‡ºã—ã™ã‚‹ã¨ã€é«˜ç¢ºç‡ã§å†ãƒ•ã‚§ãƒƒãƒãŒ2å›èµ°ã‚Šã¾ã™ã€‚

---

# ã¾ã¨ã‚

- **äºŒé‡ã§ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãŒèµ°ã‚‹ä¸»è¦å› **  
  1. `FutureProvider` ãŒ `.future` ã‚’ä»‹ã—ã¦ Notifier ã® fetch ã‚’è‡ªå‹•ã§ãƒˆãƒªã‚¬ãƒ¼  
  2. ç”»é¢å´ã® `useEffect(() => onRefresh())` ã‚„ `RefreshIndicator` ã§ã‚‚æ‰‹å‹•ã§ `getNfts()` / `getWallet()` ã‚’å‘¼ã¶  
  3. ã•ã‚‰ã« Notifier ã® `build() => null;` ãŒåŸå› ã§ã€Œæœ€åˆã®çŠ¶æ…‹ãŒ `AsyncValue.data(null)` â†’ `oldData == null` â†’ `loading`ã€ãŒæŒŸã¾ã‚‹  
- **ãƒãƒ©ã¤ãï¼ˆå†ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼‰ã‚’æ¸›ã‚‰ã—ãŸã„**  
  - **Notifier ã§ã€Œãƒ‡ãƒ¼ã‚¿ã‚’æ—¢ã«æŒã£ã¦ã„ã‚‹ã¨ãã¯ `loading` ã«ã—ãªã„ã€**ï¼ˆæ—§ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã—ç¶šã‘ã‚‹ï¼‰  
  - **`useEffect` ã§ã®åˆå›å†ãƒ•ã‚§ãƒƒãƒã¨ `FutureProvider` ã®è‡ªå‹•ãƒ•ã‚§ãƒƒãƒãŒé‡è¤‡ã—ãªã„ã‚ˆã†æ•´ç†ã™ã‚‹**  
    - Notifier/Provider ã©ã¡ã‚‰ã‹ä¸€æ–¹ã§ã€Œæœ€åˆã®APIã‚³ãƒ¼ãƒ«ã€ã‚’è¡Œã„ã€ã‚‚ã†ä¸€æ–¹ã¯ã€Œå¿…è¦æ™‚ã®ã¿ã€ã€‚  
  - **`autoDispose` ã‚’å¤–ã™ or `keepAlive()`** ã«ã—ã¦ã€**å–å¾—æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã‚’ç ´æ£„ã—ãªã„** â†’ æ¬¡å›ãƒ“ãƒ«ãƒ‰æ™‚ã«å†ãƒ•ã‚§ãƒƒãƒã‚’èµ·ã“ã•ãªã„ã€‚  

ç‰¹ã«ã€Œ**`combinedWalletDataProvider` ã¯æ‰‹å‹• `onRefresh()` ã«ä»»ã›ãŸã„**ã€ã®ã§ã‚ã‚Œã°ã€  
- `FutureProvider` ã‚’ã‚„ã‚ã¦æ™®é€šã® `Provider`ï¼ˆor `StateProvider`) ã§ã€Œ2ã¤ã® Notifier ã®çŠ¶æ…‹ã‚’åˆæˆã€ã™ã‚‹ã ã‘ã«ã™ã‚‹  
- ç”»é¢ã§ `onRefresh()` ã‚’å‘¼ã¶ã®ã¯1å›ã ã‘ã«ã—ã¦ã€**`useEffect` ãªã©ã§é‡è¤‡ã‚³ãƒ¼ãƒ«ãŒãªã„ã‚ˆã†ã«ã™ã‚‹**  

ã“ã‚Œã§ã€Œ1å›ã—ã‹ `loading` ã‚’æŒŸã¾ãšã€ä»¥å¾Œã¯å¤ã„ãƒ‡ãƒ¼ã‚¿ãŒå†åˆ©ç”¨ã•ã‚Œã‚‹ã€å‹•ä½œã«ã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/02/11 10:28:01*

ã“ã‚Œã§ã„ã„ã®ã‹ãªï¼Ÿ

final combinedWalletDataProvider = Provider(
  (ref) {
    final walletState = ref.watch(getWalletNotifierProvider);
    final nftsState = ref.watch(getNftsNotifierProvider);

    if (walletState.isLoading || nftsState.isLoading) {
      return const AsyncValue&lt;
          (
            WalletBalanceResponseDTOData?,
            GetUserNftsResponseDTOData?
          )&gt;.loading();
    }
    if (walletState.hasError) {
      return AsyncValue&lt;
          (WalletBalanceResponseDTOData?, GetUserNftsResponseDTOData?)&gt;.error(
        walletState.error ?? Exception('Unknown error'),
        walletState.stackTrace ?? StackTrace.current,
      );
    }
    
    if (nftsState.hasError) {
      return AsyncValue&lt;
          (WalletBalanceResponseDTOData?, GetUserNftsResponseDTOData?)&gt;.error(
        nftsState.error ?? Exception('Unknown error'),
        nftsState.stackTrace ?? StackTrace.current,
      );
    }

    return AsyncValue.data(
      (walletState.valueOrNull, nftsState.valueOrNull),
    );
  },
);

---

## ğŸ”§ ãƒ„ãƒ¼ãƒ«
*2025/02/11 10:28:17*

**ãƒ‡ãƒ¼ã‚¿ã®çµ±åˆã¨ç¢ºèª**

walletStateã¨nftsStateã®çŠ¶æ…‹ã‚’çµåˆã—ã€ãƒ­ãƒ¼ãƒ‰ä¸­ã€ã‚¨ãƒ©ãƒ¼ã€ãƒ‡ãƒ¼ã‚¿ã®å„çŠ¶æ…‹ã‚’å‡¦ç†ã—ã¦ã„ã‚‹ã€‚ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã€æœ€åˆã«è¦‹ã¤ã‹ã£ãŸã‚¨ãƒ©ãƒ¼ã®ã¿ã‚’è¡¨ç¤ºã™ã‚‹ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/02/11 10:28:17*

ã¯ã„ã€ãã®æ›¸ãæ–¹ã§å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚**ã€Œè¤‡æ•°ã® Notifier ã‚’å˜ã«ãƒãƒ¼ã‚¸ã—ã¦ `AsyncValue` ã¨ã—ã¦è¿”ã™ã ã‘ã€** ã¨ã„ã†å…¸å‹çš„ãªå®Ÿè£…ä¾‹ã§ã€ãƒãƒ©ã¤ãã‚’æŠ‘ãˆã‚„ã™ã„æ§‹æˆã«ãªã£ã¦ã„ã¾ã™ã€‚

```dart
final combinedWalletDataProvider = Provider(
  (ref) {
    final walletState = ref.watch(getWalletNotifierProvider);
    final nftsState = ref.watch(getNftsNotifierProvider);

    if (walletState.isLoading || nftsState.isLoading) {
      return const AsyncValue<
          (
            WalletBalanceResponseDTOData?,
            GetUserNftsResponseDTOData?
          )>.loading();
    }
    if (walletState.hasError) {
      return AsyncValue<
          (WalletBalanceResponseDTOData?, GetUserNftsResponseDTOData?)>.error(
        walletState.error ?? Exception('Unknown error'),
        walletState.stackTrace ?? StackTrace.current,
      );
    }
    if (nftsState.hasError) {
      return AsyncValue<
          (WalletBalanceResponseDTOData?, GetUserNftsResponseDTOData?)>.error(
        nftsState.error ?? Exception('Unknown error'),
        nftsState.stackTrace ?? StackTrace.current,
      );
    }

    return AsyncValue.data(
      (walletState.valueOrNull, nftsState.valueOrNull),
    );
  },
);
```

## ã“ã®å®Ÿè£…ã§ã®ãƒã‚¤ãƒ³ãƒˆ

1. **`Provider`ï¼ˆã¾ãŸã¯ `autoDispose` ãªã—/ã‚ã‚Šã® `Provider`ï¼‰ã§2ã¤ã® Notifier ã‚’åˆæˆ**  
   - `walletState` / `nftsState` ã‚’ãã‚Œãã‚Œ `ref.watch(...)` ã—ã¦ã€çŠ¶æ…‹ãŒæƒã£ãŸã‚‰ `AsyncValue.data(...)` ã‚’è¿”ã™  
   - ã©ã¡ã‚‰ã‹ä¸€æ–¹ãŒ `loading` ãªã‚‰åˆæˆçµæœã‚‚ `loading`ã€ã©ã¡ã‚‰ã‹ä¸€æ–¹ãŒ `error` ãªã‚‰åˆæˆçµæœã‚‚ `error` ã¨ã™ã‚‹  
   - ãƒãƒ©ã¤ãã‚’æ¸›ã‚‰ã›ã‚‹å¤§ããªç†ç”±ã¯ã€ã€Œ`combinedWalletDataProvider` è‡ªä½“ãŒ **è‡ªå‹•ã§å†ãƒ•ã‚§ãƒƒãƒã—ãªã„**ã€ã‹ã‚‰ã§ã™ã€‚**ã‚ãã¾ã§ `Notifier` ãŒæ›´æ–°ã•ã‚ŒãŸã¨ãã« UI ã¸çŠ¶æ…‹ã‚’åæ˜ ã™ã‚‹ã ã‘**ã€‚  

2. **Notifier å´ã¯ã€Œãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®ãƒ¡ã‚½ãƒƒãƒ‰ã€ã ã‘ã‚’æŒã¤ï¼ˆãƒ“ãƒ«ãƒ‰æ™‚ã«ãƒ•ã‚§ãƒƒãƒã—ãªã„ï¼‰**  
   - ä¾‹ï¼š `getWallet()` / `getNfts()` ã‚’ã‚³ãƒ¼ãƒ«ã—ã¦åˆã‚ã¦ API å–å¾—ã—ã€çµæœã‚’ `state` ã«åæ˜ ã™ã‚‹ã‚¹ã‚¿ã‚¤ãƒ«  
   - `build()` ã§ã¯åˆæœŸå€¤ã¨ã—ã¦ `null` ã‚’è¿”ã—ã¦ã„ã‚‹ (`=> null;`) ãŸã‚ã€ã€Œè‡ªå‹•ã§ã¯å–å¾—ã—ãªã„ãƒ»ã‚ãã¾ã§æ‰‹å‹•ã§å‘¼ã¶ã€è¨­è¨ˆ  

3. **UI å´ã§ã¯ `combinedWalletDataProvider` ã‚’ç›£è¦–ã—ã¦ç”»é¢ã‚’ä½œã‚Šã€`PullToRefresh` ã‚„ `useEffect` ç­‰ã§ `getWallet()` / `getNfts()` ã‚’å‘¼ã¶**  
   - ã™ã§ã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Œã° `oldData != null` ãªã®ã§ `AsyncValue.loading()` ã«ä¸Šæ›¸ãã—ãªã„ â†’ å‰ã®ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œç¶šã‘ã‚‹  
   - çµæœã¨ã—ã¦ã€ä½•åº¦ç”»é¢ã‚’ rebuild ã—ã¦ã‚‚ã€Œå¿…è¦ä»¥ä¸Šã«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã«ãªã‚‰ãªã„ã€ â†’ ãƒãƒ©ã¤ããŒæ¸›ã‚‹  

---

## è¿½åŠ ã§è€ƒæ…®ã™ã‚‹ã¨è‰¯ã„ç‚¹

- ã€Œä¸¡æ–¹ãŒ `error` ã ã£ãŸå ´åˆã€ã©ã¡ã‚‰ã®ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤ºã•ã›ã‚‹ã‹ï¼Ÿã€  
  - ç¾åœ¨ã®å®Ÿè£…ã§ã¯ã€Œ`walletState` ãŒã‚¨ãƒ©ãƒ¼ãªã‚‰ãã¡ã‚‰ã‚’è¿”ã™ã€‚ãã®ã‚ã¨ã« `nftsState` ã®ã‚¨ãƒ©ãƒ¼ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã€ã¨ã„ã†é †åºãªã®ã§ã€ä¸¡æ–¹åŒæ™‚ã«ã‚¨ãƒ©ãƒ¼ã§ã‚‚å…ˆã«ãƒã‚§ãƒƒã‚¯ã—ãŸã»ã†ã—ã‹è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚  
  - æ°—ã«ãªã‚‰ãªã‘ã‚Œã°ã“ã®ã¾ã¾ã§ã‚‚ OK ã§ã™ãŒã€ã€Œä¸¡æ–¹ã®ã‚¨ãƒ©ãƒ¼ã‚’ã¾ã¨ã‚ã¦è¡¨ç¤ºã—ãŸã„ã€ãªã©ã®è¦æœ›ãŒã‚ã‚Œã°ã€ãã®éƒ¨åˆ†ã ã‘ãƒ­ã‚¸ãƒƒã‚¯ã‚’å·¥å¤«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  

- ã€Œ`hasError` ã ã‘ã©å®Ÿã¯å‰å›ã®ãƒ‡ãƒ¼ã‚¿ãŒæ®‹ã£ã¦ã„ã‚‹ã€ã¨ã„ã†å¯èƒ½æ€§ã‚’è€ƒæ…®ã™ã‚‹ã‹ã©ã†ã‹  
  - ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤±æ•—ã—ã¦ã‚‚ã€Œå‰å›ã®ãƒ‡ãƒ¼ã‚¿ã§ç”»é¢ã‚’ç¶™ç¶šè¡¨ç¤ºã—ãŸã„ã€ã¨ã„ã†å ´åˆã¯ã€`Notifier` å´ã§ `state = AsyncValue.data(oldData!)` ã«æˆ»ã™ãªã©ã®å·¥å¤«ãŒå¿…è¦ã§ã™ã€‚  
  - ã‚‚ã—ãã“ã¾ã§ã—ãªã„ãªã‚‰ã€ä»Šå›ã®å®Ÿè£…ã®ã‚ˆã†ã«å˜ç´”ã«ã€Œ`hasError` â†’ `AsyncValue.error(...)`ã€ã«ã—ã¦ç”»é¢ã«ã‚¨ãƒ©ãƒ¼ã‚’å‡ºã™ã€ã¨ã„ã†å‹•ãã§ååˆ†ã§ã™ã€‚  

ã“ã‚Œã‚‰ã‚’è¸ã¾ãˆã¦ã‚‚ã€**è³ªå•ã®ã‚³ãƒ¼ãƒ‰ã¯ã€Œåˆæˆç”¨ Provider ãƒ‘ã‚¿ãƒ¼ãƒ³ã€ã¨ã—ã¦ã¯ã¾ã£ãŸãå•é¡Œã®ãªã„å®Ÿè£…** ã§ã™ã€‚ã‚ã¨ã¯å®Ÿéš›ã«ä½¿ã„ãªãŒã‚‰å¿…è¦ã«å¿œã˜ã¦å¾®èª¿æ•´ã—ã¦ã„ãå½¢ã«ãªã‚Šã¾ã™ã€‚

---

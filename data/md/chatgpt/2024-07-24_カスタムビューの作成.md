# ã‚«ã‚¹ã‚¿ãƒ ãƒ“ãƒ¥ãƒ¼ã®ä½œæˆ

æ—¥ä»˜: 2024-07-24

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/7/24 17:31:14*

ã“ã®Viewã‚’ä»¥ä¸‹ã®ã¨ã“ã‚ã‚’Viewã«ã§ãã‚‹ã‚ˆã†ãªã‚‚ã®ã«ã—ã¦ã»ã—ã„ã€‚

Button {} label: {
                Text("å†™çœŸã‚’ç™»éŒ²")
            }

struct TestView: View {
    @State private var selectedImage: UIImage?
    @State private var selectedPhotosPickerItem: PhotosPickerItem? = nil

    @State private var showCameraShoot: Bool = false
    @State private var showPhotoPicker: Bool = false
    @State private var showPhotoCrop: Bool = false

    var body: some View {
        Menu {
            Button {
                showCameraShoot = true
            } label: {
                Label {
                    Text("ã‚«ãƒ¡ãƒ©ã§æ’®ã‚‹")
                } icon: {
                    SFSymbols.camera.image
                }
            }
            
            Button {
                showPhotoPicker = true
            } label: {
                Label {
                    Text("å†™çœŸã‚’é¸æŠã™ã‚‹")
                } icon: {
                    SFSymbols.photoOnRectangle.image
                }
            }
        } label: {
            Button {} label: {
                Text("å†™çœŸã‚’ç™»éŒ²")
            }
        }
        .fullScreenCover(isPresented: $showCameraShoot) {
            SimpleCameraShootView(image: $selectedImage)
                .ignoresSafeArea()
        }
        .fullScreenCover(isPresented: $showPhotoCrop) {
            PhotoCropView(selectedImage: $selectedImage)
                .navigationStacked()
        }
        .photosPicker(isPresented: $showPhotoPicker, selection: $selectedPhotosPickerItem, matching: .images)
        .onChange(of: selectedPhotosPickerItem) { newItem in
            if let newItem {
                Task {
                    if let data = try? await newItem.loadTransferable(type: Data.self), let uiImage = UIImage(data: data) {
                        selectedImage = uiImage
                    }
                }
            }
        }
        .onChange(of: selectedImage) { image in
            showPhotoCrop = image != nil
        }
        .onChange(of: showPhotoCrop) { showPhotoCrop in
            if showPhotoCrop {
                selectedPhotosPickerItem = nil
            }
        }
    }
}

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/7/24 17:31:39*

`"å†™çœŸã‚’ç™»éŒ²"` ãƒœã‚¿ãƒ³ã‚’ã‚«ã‚¹ã‚¿ãƒ ãƒ“ãƒ¥ãƒ¼ã¨ã—ã¦å®šç¾©ã—ã€ä½¿ã„ã‚„ã™ãå†åˆ©ç”¨å¯èƒ½ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚

ä»¥ä¸‹ã«ã€ã‚«ã‚¹ã‚¿ãƒ ãƒ“ãƒ¥ãƒ¼ã¨ã—ã¦å®šç¾©ã—ãŸ `PhotoRegisterButton` ã‚’ç¤ºã—ã¾ã™ã€‚

```swift
import SwiftUI
import PhotosUI

struct PhotoRegisterButton: View {
    @Binding var selectedImage: UIImage?
    @State private var selectedPhotosPickerItem: PhotosPickerItem? = nil

    @State private var showCameraShoot: Bool = false
    @State private var showPhotoPicker: Bool = false
    @State private var showPhotoCrop: Bool = false

    var body: some View {
        Menu {
            Button {
                showCameraShoot = true
            } label: {
                Label {
                    Text("ã‚«ãƒ¡ãƒ©ã§æ’®ã‚‹")
                } icon: {
                    SFSymbols.camera.image
                }
            }
            
            Button {
                showPhotoPicker = true
            } label: {
                Label {
                    Text("å†™çœŸã‚’é¸æŠã™ã‚‹")
                } icon: {
                    SFSymbols.photoOnRectangle.image
                }
            }
        } label: {
            Text("å†™çœŸã‚’ç™»éŒ²")
        }
        .fullScreenCover(isPresented: $showCameraShoot) {
            SimpleCameraShootView(image: $selectedImage)
                .ignoresSafeArea()
        }
        .fullScreenCover(isPresented: $showPhotoCrop) {
            PhotoCropView(selectedImage: $selectedImage)
                .navigationStacked()
        }
        .photosPicker(isPresented: $showPhotoPicker, selection: $selectedPhotosPickerItem, matching: .images)
        .onChange(of: selectedPhotosPickerItem) { newItem in
            if let newItem {
                Task {
                    if let data = try? await newItem.loadTransferable(type: Data.self), let uiImage = UIImage(data: data) {
                        selectedImage = uiImage
                    }
                }
            }
        }
        .onChange(of: selectedImage) { image in
            showPhotoCrop = image != nil
        }
        .onChange(of: showPhotoCrop) { showPhotoCrop in
            if showPhotoCrop {
                selectedPhotosPickerItem = nil
            }
        }
    }
}

struct TestView: View {
    @State private var selectedImage: UIImage?

    var body: some View {
        VStack {
            // ä»–ã®ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
            PhotoRegisterButton(selectedImage: $selectedImage)
        }
    }
}
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€`PhotoRegisterButton` ã‚’ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦å®šç¾©ã—ã€`TestView` ã®ä¸€éƒ¨ã¨ã—ã¦ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€`"å†™çœŸã‚’ç™»éŒ²"` ãƒœã‚¿ãƒ³ã‚’ä»–ã®ãƒ“ãƒ¥ãƒ¼ã§ã‚‚ç°¡å˜ã«å†åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/7/24 17:32:18*

Text("å†™çœŸã‚’ç™»éŒ²") ã®éƒ¨åˆ†ã‚’ä»»æ„ãªViewã‚’ä¸ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ã»ã—ã„ã‚“ã ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/7/24 17:32:47*

`PhotoRegisterButton` ã«ä»»æ„ã®ãƒ©ãƒ™ãƒ«ãƒ“ãƒ¥ãƒ¼ã‚’æ¸¡ã›ã‚‹ã‚ˆã†ã«æ±ç”¨åŒ–ã™ã‚‹ãŸã‚ã«ã¯ã€ã‚«ã‚¹ã‚¿ãƒ ãƒ©ãƒ™ãƒ«ã‚’å—ã‘å–ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ ã—ã¾ã™ã€‚ä»¥ä¸‹ã¯ãã®å®Ÿè£…ã§ã™ã€‚

```swift
import SwiftUI
import PhotosUI

struct PhotoRegisterButton<Label: View>: View {
    @Binding var selectedImage: UIImage?
    @State private var selectedPhotosPickerItem: PhotosPickerItem? = nil

    @State private var showCameraShoot: Bool = false
    @State private var showPhotoPicker: Bool = false
    @State private var showPhotoCrop: Bool = false
    
    let label: () -> Label

    var body: some View {
        Menu {
            Button {
                showCameraShoot = true
            } label: {
                Label {
                    Text("ã‚«ãƒ¡ãƒ©ã§æ’®ã‚‹")
                } icon: {
                    SFSymbols.camera.image
                }
            }
            
            Button {
                showPhotoPicker = true
            } label: {
                Label {
                    Text("å†™çœŸã‚’é¸æŠã™ã‚‹")
                } icon: {
                    SFSymbols.photoOnRectangle.image
                }
            }
        } label: {
            label()
        }
        .fullScreenCover(isPresented: $showCameraShoot) {
            SimpleCameraShootView(image: $selectedImage)
                .ignoresSafeArea()
        }
        .fullScreenCover(isPresented: $showPhotoCrop) {
            PhotoCropView(selectedImage: $selectedImage)
                .navigationStacked()
        }
        .photosPicker(isPresented: $showPhotoPicker, selection: $selectedPhotosPickerItem, matching: .images)
        .onChange(of: selectedPhotosPickerItem) { newItem in
            if let newItem {
                Task {
                    if let data = try? await newItem.loadTransferable(type: Data.self), let uiImage = UIImage(data: data) {
                        selectedImage = uiImage
                    }
                }
            }
        }
        .onChange(of: selectedImage) { image in
            showPhotoCrop = image != nil
        }
        .onChange(of: showPhotoCrop) { showPhotoCrop in
            if showPhotoCrop {
                selectedPhotosPickerItem = nil
            }
        }
    }
}

struct TestView: View {
    @State private var selectedImage: UIImage?

    var body: some View {
        VStack {
            // ä»–ã®ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
            PhotoRegisterButton(selectedImage: $selectedImage) {
                Text("ã‚«ã‚¹ã‚¿ãƒ å†™çœŸç™»éŒ²")
                    .padding()
                    .background(Color.blue)
                    .foregroundColor(.white)
                    .cornerRadius(8)
            }
        }
    }
}
```

ã“ã®å®Ÿè£…ã§ã¯ã€`PhotoRegisterButton` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã« `Label` ã®å‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ ã—ã€`label` ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã‚’é€šã˜ã¦ä»»æ„ã®ãƒ©ãƒ™ãƒ«ãƒ“ãƒ¥ãƒ¼ã‚’å—ã‘å–ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Šã€`TestView` å†…ã§ `PhotoRegisterButton` ã«ä»»æ„ã®ãƒ“ãƒ¥ãƒ¼ã‚’æ¸¡ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/7/24 17:33:51*

ã¡ãªã¿ã«ã€PhotoCrop ã™ã‚‹ã‹ã—ãªã„ã‹ã‚’é¸æŠã§ãã‚‹ã‚ˆã†ãªãƒ•ãƒ©ã‚°ã‚’æ¸¡ã—ãŸã„ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/7/24 17:34:22*

`PhotoRegisterButton` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã€PhotoCrop ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã‹ã©ã†ã‹ã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã®ãƒ•ãƒ©ã‚°ã‚’è¿½åŠ ã—ã¾ã™ã€‚ã“ã®ãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨ã—ã¦ã€PhotoCrop ã®è¡¨ç¤ºã‚’åˆ¶å¾¡ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ä»¥ä¸‹ãŒãã®å®Ÿè£…ã§ã™ã€‚

```swift
import SwiftUI
import PhotosUI

struct PhotoRegisterButton<Label: View>: View {
    @Binding var selectedImage: UIImage?
    @State private var selectedPhotosPickerItem: PhotosPickerItem? = nil

    @State private var showCameraShoot: Bool = false
    @State private var showPhotoPicker: Bool = false
    @State private var showPhotoCrop: Bool = false
    
    let label: () -> Label
    let enablePhotoCrop: Bool

    var body: some View {
        Menu {
            Button {
                showCameraShoot = true
            } label: {
                Label {
                    Text("ã‚«ãƒ¡ãƒ©ã§æ’®ã‚‹")
                } icon: {
                    SFSymbols.camera.image
                }
            }
            
            Button {
                showPhotoPicker = true
            } label: {
                Label {
                    Text("å†™çœŸã‚’é¸æŠã™ã‚‹")
                } icon: {
                    SFSymbols.photoOnRectangle.image
                }
            }
        } label: {
            label()
        }
        .fullScreenCover(isPresented: $showCameraShoot) {
            SimpleCameraShootView(image: $selectedImage)
                .ignoresSafeArea()
        }
        .fullScreenCover(isPresented: $showPhotoCrop) {
            if enablePhotoCrop {
                PhotoCropView(selectedImage: $selectedImage)
                    .navigationStacked()
            }
        }
        .photosPicker(isPresented: $showPhotoPicker, selection: $selectedPhotosPickerItem, matching: .images)
        .onChange(of: selectedPhotosPickerItem) { newItem in
            if let newItem {
                Task {
                    if let data = try? await newItem.loadTransferable(type: Data.self), let uiImage = UIImage(data: data) {
                        selectedImage = uiImage
                    }
                }
            }
        }
        .onChange(of: selectedImage) { image in
            if enablePhotoCrop {
                showPhotoCrop = image != nil
            } else {
                // ã“ã“ã§è¿½åŠ ã®å‡¦ç†ã‚’è¡Œã†ã“ã¨ã‚‚å¯èƒ½ã§ã™
                showPhotoCrop = false
            }
        }
        .onChange(of: showPhotoCrop) { showPhotoCrop in
            if showPhotoCrop {
                selectedPhotosPickerItem = nil
            }
        }
    }
}

struct TestView: View {
    @State private var selectedImage: UIImage?

    var body: some View {
        VStack {
            // ä»–ã®ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
            PhotoRegisterButton(selectedImage: $selectedImage, enablePhotoCrop: true) {
                Text("ã‚«ã‚¹ã‚¿ãƒ å†™çœŸç™»éŒ²")
                    .padding()
                    .background(Color.blue)
                    .foregroundColor(.white)
                    .cornerRadius(8)
            }
        }
    }
}
```

ã“ã®å®Ÿè£…ã§ã¯ã€`PhotoRegisterButton` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã« `enablePhotoCrop` ãƒ•ãƒ©ã‚°ã‚’è¿½åŠ ã—ã€ã“ã®ãƒ•ãƒ©ã‚°ã«ã‚ˆã£ã¦ PhotoCrop ã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’åˆ¶å¾¡ã—ã¾ã™ã€‚`TestView` ã§ `PhotoRegisterButton` ã‚’ä½¿ç”¨ã™ã‚‹éš›ã«ã€`enablePhotoCrop` ã‚’ `true` ã¾ãŸã¯ `false` ã«è¨­å®šã™ã‚‹ã“ã¨ã§ã€PhotoCrop ã‚’æœ‰åŠ¹ã¾ãŸã¯ç„¡åŠ¹ã«ã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/7/24 17:35:54*

Label: View ãŒLabelã¨ã‹ã¶ã£ã¦ã„ã‚‹

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/7/24 17:36:24*

`Label` ã¨åå‰ãŒé‡è¤‡ã—ã¦ã„ã‚‹å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«ã€å‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®åå‰ã‚’å¤‰æ›´ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€`Content` ã¨ã„ã†åå‰ã«å¤‰æ›´ã—ã¾ã™ã€‚

ä»¥ä¸‹ã¯ãã®ä¿®æ­£ã§ã™ã€‚

```swift
import SwiftUI
import PhotosUI

struct PhotoRegisterButton<Content: View>: View {
    @Binding var selectedImage: UIImage?
    @State private var selectedPhotosPickerItem: PhotosPickerItem? = nil

    @State private var showCameraShoot: Bool = false
    @State private var showPhotoPicker: Bool = false
    @State private var showPhotoCrop: Bool = false
    
    let label: () -> Content
    let enablePhotoCrop: Bool

    var body: some View {
        Menu {
            Button {
                showCameraShoot = true
            } label: {
                Label {
                    Text("ã‚«ãƒ¡ãƒ©ã§æ’®ã‚‹")
                } icon: {
                    SFSymbols.camera.image
                }
            }
            
            Button {
                showPhotoPicker = true
            } label: {
                Label {
                    Text("å†™çœŸã‚’é¸æŠã™ã‚‹")
                } icon: {
                    SFSymbols.photoOnRectangle.image
                }
            }
        } label: {
            label()
        }
        .fullScreenCover(isPresented: $showCameraShoot) {
            SimpleCameraShootView(image: $selectedImage)
                .ignoresSafeArea()
        }
        .fullScreenCover(isPresented: $showPhotoCrop) {
            if enablePhotoCrop {
                PhotoCropView(selectedImage: $selectedImage)
                    .navigationStacked()
            }
        }
        .photosPicker(isPresented: $showPhotoPicker, selection: $selectedPhotosPickerItem, matching: .images)
        .onChange(of: selectedPhotosPickerItem) { newItem in
            if let newItem {
                Task {
                    if let data = try? await newItem.loadTransferable(type: Data.self), let uiImage = UIImage(data: data) {
                        selectedImage = uiImage
                    }
                }
            }
        }
        .onChange(of: selectedImage) { image in
            if enablePhotoCrop {
                showPhotoCrop = image != nil
            } else {
                // ã“ã“ã§è¿½åŠ ã®å‡¦ç†ã‚’è¡Œã†ã“ã¨ã‚‚å¯èƒ½ã§ã™
                showPhotoCrop = false
            }
        }
        .onChange(of: showPhotoCrop) { showPhotoCrop in
            if showPhotoCrop {
                selectedPhotosPickerItem = nil
            }
        }
    }
}

struct TestView: View {
    @State private var selectedImage: UIImage?

    var body: some View {
        VStack {
            // ä»–ã®ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
            PhotoRegisterButton(selectedImage: $selectedImage, enablePhotoCrop: true) {
                Text("ã‚«ã‚¹ã‚¿ãƒ å†™çœŸç™»éŒ²")
                    .padding()
                    .background(Color.blue)
                    .foregroundColor(.white)
                    .cornerRadius(8)
            }
        }
    }
}
```

ã“ã®ä¿®æ­£ã«ã‚ˆã‚Šã€`Content` ã¨ã„ã†åå‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€å‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®åå‰ã¨ `Label` ã¨ã®è¡çªã‚’é¿ã‘ã¦ã„ã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/7/24 17:46:19*

ã“ã‚Œã®2ãƒ‘ã‚¿ãƒ¼ãƒ³ã®previewç”»é¢ã‚’å®Ÿè£…ã—ã¦ã»ã—ã„#Previewã‚’ä½¿ã£ã¦ã»ã—ã„iOS18ä»¥é™ã§ã‚ã‚‹

struct PhotoRegisterButton&lt;Content: View&gt;: View {
    @Binding var selectedImage: UIImage?
    let enablePhotoCrop: Bool
    let label: () -&gt; Content

    @State private var selectedPhotosPickerItem: PhotosPickerItem? = nil
    @State private var showCameraShoot: Bool = false
    @State private var showPhotoPicker: Bool = false
    @State private var showPhotoCrop: Bool = false

    var body: some View {
        Menu {
            Button {
                showCameraShoot = true
            } label: {
                Label {
                    Text("ã‚«ãƒ¡ãƒ©ã§æ’®ã‚‹")
                } icon: {
                    SFSymbols.camera.image
                }
            }
            
            Button {
                showPhotoPicker = true
            } label: {
                Label {
                    Text("å†™çœŸã‚’é¸æŠã™ã‚‹")
                } icon: {
                    SFSymbols.photoOnRectangle.image
                }
            }
        } label: {
            label()
        }
        .fullScreenCover(isPresented: $showCameraShoot) {
            SimpleCameraShootView(image: $selectedImage)
                .ignoresSafeArea()
        }
        .fullScreenCover(isPresented: $showPhotoCrop) {
            PhotoCropView(selectedImage: $selectedImage)
                .navigationStacked()
        }
        .photosPicker(isPresented: $showPhotoPicker, selection: $selectedPhotosPickerItem, matching: .images)
        .onChange(of: selectedPhotosPickerItem) { newItem in
            if let newItem {
                Task {
                    if let data = try? await newItem.loadTransferable(type: Data.self), let uiImage = UIImage(data: data) {
                        selectedImage = uiImage
                    }
                }
            }
        }
        .onChange(of: selectedImage) { image in
            if enablePhotoCrop {
                showPhotoCrop = image != nil
            } else {
                showPhotoCrop = false
            }
        }
        .onChange(of: showPhotoCrop) { showPhotoCrop in
            if showPhotoCrop {
                selectedPhotosPickerItem = nil
            }
        }
    }
}

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/7/24 17:46:47*

`PhotoRegisterButton` ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’2ãƒ‘ã‚¿ãƒ¼ãƒ³å®Ÿè£…ã™ã‚‹ãŸã‚ã«ã€iOS 18 ä»¥é™ã§åˆ©ç”¨ã§ãã‚‹ `#Preview` ã‚’ä½¿ç”¨ã—ã¦ã€ç•°ãªã‚‹ `enablePhotoCrop` è¨­å®šã‚’æŒã¤ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚

ä»¥ä¸‹ã¯ãã®ã‚³ãƒ¼ãƒ‰ã§ã™ï¼š

```swift
import SwiftUI
import PhotosUI

struct PhotoRegisterButton<Content: View>: View {
    @Binding var selectedImage: UIImage?
    let enablePhotoCrop: Bool
    let label: () -> Content

    @State private var selectedPhotosPickerItem: PhotosPickerItem? = nil
    @State private var showCameraShoot: Bool = false
    @State private var showPhotoPicker: Bool = false
    @State private var showPhotoCrop: Bool = false

    var body: some View {
        Menu {
            Button {
                showCameraShoot = true
            } label: {
                Label {
                    Text("ã‚«ãƒ¡ãƒ©ã§æ’®ã‚‹")
                } icon: {
                    SFSymbols.camera.image
                }
            }
            
            Button {
                showPhotoPicker = true
            } label: {
                Label {
                    Text("å†™çœŸã‚’é¸æŠã™ã‚‹")
                } icon: {
                    SFSymbols.photoOnRectangle.image
                }
            }
        } label: {
            label()
        }
        .fullScreenCover(isPresented: $showCameraShoot) {
            SimpleCameraShootView(image: $selectedImage)
                .ignoresSafeArea()
        }
        .fullScreenCover(isPresented: $showPhotoCrop) {
            if enablePhotoCrop {
                PhotoCropView(selectedImage: $selectedImage)
                    .navigationStacked()
            }
        }
        .photosPicker(isPresented: $showPhotoPicker, selection: $selectedPhotosPickerItem, matching: .images)
        .onChange(of: selectedPhotosPickerItem) { newItem in
            if let newItem {
                Task {
                    if let data = try? await newItem.loadTransferable(type: Data.self), let uiImage = UIImage(data: data) {
                        selectedImage = uiImage
                    }
                }
            }
        }
        .onChange(of: selectedImage) { image in
            if enablePhotoCrop {
                showPhotoCrop = image != nil
            } else {
                showPhotoCrop = false
            }
        }
        .onChange(of: showPhotoCrop) { showPhotoCrop in
            if showPhotoCrop {
                selectedPhotosPickerItem = nil
            }
        }
    }
}

#Preview("PhotoRegisterButton with PhotoCrop enabled") {
    @State var selectedImage: UIImage? = nil
    return PhotoRegisterButton(selectedImage: $selectedImage, enablePhotoCrop: true) {
        Text("å†™çœŸã‚’ç™»éŒ²")
            .padding()
            .background(Color.blue)
            .foregroundColor(.white)
            .cornerRadius(8)
    }
}

#Preview("PhotoRegisterButton with PhotoCrop disabled") {
    @State var selectedImage: UIImage? = nil
    return PhotoRegisterButton(selectedImage: $selectedImage, enablePhotoCrop: false) {
        Text("å†™çœŸã‚’ç™»éŒ²")
            .padding()
            .background(Color.green)
            .foregroundColor(.white)
            .cornerRadius(8)
    }
}
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€`PhotoRegisterButton` ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ `#Preview` ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦2ã¤ä½œæˆã—ã¦ã„ã¾ã™ã€‚1ã¤ã¯ `enablePhotoCrop` ãŒ `true` ã®å ´åˆã€ã‚‚ã†1ã¤ã¯ `enablePhotoCrop` ãŒ `false` ã®å ´åˆã§ã™ã€‚ãã‚Œãã‚Œã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ã¯ã€ãƒ©ãƒ™ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç•°ãªã‚‹è‰²ã§ç¤ºã—ã¦ã„ã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/7/24 17:49:15*

VStackã§ç™»éŒ²ã—ãŸç”»åƒã‚’ä¸Šã«è¡¨ç¤ºã—ã¦ã»ã—ã„

@available(iOS 18.0, *)
#Preview("PhotoCrop enabled") {
    @Previewable @State var selectedImage: UIImage? = nil

    return PhotoRegisterButton(selectedImage: $selectedImage, enablePhotoCrop: true) {
        Text("å†™çœŸã‚’ç™»éŒ²")
            .padding()
            .background(Color.blue)
            .foregroundColor(.white)
            .cornerRadius(8)
    }
}

@available(iOS 18.0, *)
#Preview("PhotoCrop disabled") {
    @Previewable @State var selectedImage: UIImage? = nil

    return PhotoRegisterButton(selectedImage: $selectedImage, enablePhotoCrop: false) {
        Text("å†™çœŸã‚’ç™»éŒ²")
            .padding()
            .background(Color.green)
            .foregroundColor(.white)
            .cornerRadius(8)
    }
}

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/7/24 17:49:52*

`VStack` ã‚’ä½¿ç”¨ã—ã¦ã€ç™»éŒ²ã—ãŸç”»åƒã‚’ä¸Šéƒ¨ã«è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã« `PhotoRegisterButton` ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¾ã™ã€‚ä»¥ä¸‹ã«ãã®å®Ÿè£…ã‚’ç¤ºã—ã¾ã™ã€‚

```swift
import SwiftUI
import PhotosUI

struct PhotoRegisterButton<Content: View>: View {
    @Binding var selectedImage: UIImage?
    let enablePhotoCrop: Bool
    let label: () -> Content

    @State private var selectedPhotosPickerItem: PhotosPickerItem? = nil
    @State private var showCameraShoot: Bool = false
    @State private var showPhotoPicker: Bool = false
    @State private var showPhotoCrop: Bool = false

    var body: some View {
        Menu {
            Button {
                showCameraShoot = true
            } label: {
                Label {
                    Text("ã‚«ãƒ¡ãƒ©ã§æ’®ã‚‹")
                } icon: {
                    SFSymbols.camera.image
                }
            }
            
            Button {
                showPhotoPicker = true
            } label: {
                Label {
                    Text("å†™çœŸã‚’é¸æŠã™ã‚‹")
                } icon: {
                    SFSymbols.photoOnRectangle.image
                }
            }
        } label: {
            label()
        }
        .fullScreenCover(isPresented: $showCameraShoot) {
            SimpleCameraShootView(image: $selectedImage)
                .ignoresSafeArea()
        }
        .fullScreenCover(isPresented: $showPhotoCrop) {
            if enablePhotoCrop {
                PhotoCropView(selectedImage: $selectedImage)
                    .navigationStacked()
            }
        }
        .photosPicker(isPresented: $showPhotoPicker, selection: $selectedPhotosPickerItem, matching: .images)
        .onChange(of: selectedPhotosPickerItem) { newItem in
            if let newItem {
                Task {
                    if let data = try? await newItem.loadTransferable(type: Data.self), let uiImage = UIImage(data: data) {
                        selectedImage = uiImage
                    }
                }
            }
        }
        .onChange(of: selectedImage) { image in
            if enablePhotoCrop {
                showPhotoCrop = image != nil
            } else {
                showPhotoCrop = false
            }
        }
        .onChange(of: showPhotoCrop) { showPhotoCrop in
            if showPhotoCrop {
                selectedPhotosPickerItem = nil
            }
        }
    }
}

@available(iOS 18.0, *)
#Preview("PhotoCrop enabled") {
    @Previewable @State var selectedImage: UIImage? = nil

    return VStack {
        if let selectedImage {
            Image(uiImage: selectedImage)
                .resizable()
                .scaledToFit()
                .frame(height: 200)
                .padding()
        }
        PhotoRegisterButton(selectedImage: $selectedImage, enablePhotoCrop: true) {
            Text("å†™çœŸã‚’ç™»éŒ²")
                .padding()
                .background(Color.blue)
                .foregroundColor(.white)
                .cornerRadius(8)
        }
    }
}

@available(iOS 18.0, *)
#Preview("PhotoCrop disabled") {
    @Previewable @State var selectedImage: UIImage? = nil

    return VStack {
        if let selectedImage {
            Image(uiImage: selectedImage)
                .resizable()
                .scaledToFit()
                .frame(height: 200)
                .padding()
        }
        PhotoRegisterButton(selectedImage: $selectedImage, enablePhotoCrop: false) {
            Text("å†™çœŸã‚’ç™»éŒ²")
                .padding()
                .background(Color.green)
                .foregroundColor(.white)
                .cornerRadius(8)
        }
    }
}
```

ã“ã®å®Ÿè£…ã§ã¯ã€`VStack` ã‚’ä½¿ç”¨ã—ã¦ã€é¸æŠã•ã‚ŒãŸç”»åƒãŒå­˜åœ¨ã™ã‚‹å ´åˆã«ã¯ãã®ç”»åƒã‚’ä¸Šéƒ¨ã«è¡¨ç¤ºã—ã€ãã®ä¸‹ã« `PhotoRegisterButton` ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€é¸æŠã•ã‚ŒãŸç”»åƒãŒè¦‹ã‚„ã™ããªã‚Šã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/7/24 17:53:43*

å†™çœŸãŒæ¨ªé•·ã®ç”»é¢ã§ã‚‚ å††ã®ã‚µãƒ¼ã‚¯ãƒ«ãŒã¯ã¿å‡ºãªã„ã‚ˆã†ã«ã—ã¦ã»ã—ã„

struct PhotoCropView: View {
    @Binding var selectedImage: UIImage?
    @Environment(\.dismiss) private var dismiss

    var body: some View {
        VStack {
            if let selectedImage {
                GeometryReader { geometry in
                    let size = min(geometry.size.width, geometry.size.height)

                    ZStack {
                        Image(uiImage: selectedImage)
                            .resizable()
                            .scaledToFit()
                            .frame(width: geometry.size.width, height: geometry.size.height)
                            .clipped()
                        
                        // åŠé€æ˜ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤
                        Rectangle()
                            .fill(Color.black.opacity(0.5))
                            .mask(
                                ZStack {
                                    Rectangle()
                                        .fill(Color.white)
                                    Circle()
                                        .frame(width: size * 0.8, height: size * 0.8)
                                        .blendMode(.destinationOut)
                                }
                            )
                            .compositingGroup()
                            .frame(width: geometry.size.width, height: geometry.size.height)
                        
                        Text("TODO: ã‚¯ãƒªãƒƒãƒ—æ©Ÿèƒ½ã‚„æ‹¡å¤§ç¸®å°æ©Ÿèƒ½ã¯æœªå®Ÿè£…")
                            .foregroundColor(.white)
                    }
                }
            } else {
                Text("No Image Selected")
                    .foregroundColor(.white)
            }
        }
        .frame(maxWidth: .infinity, maxHeight: .infinity)
        .background(Color.black)
        .ignoresSafeArea()
        .toolbar {
            ToolbarItem(placement: .topBarLeading) {
                Button {
                    selectedImage = nil
                    dismiss.callAsFunction()
                } label: {
                    Text("ã‚­ãƒ£ãƒ³ã‚»ãƒ«")
                        .foregroundStyle(.white)
                }
            }

            ToolbarItem(placement: .topBarTrailing) {
                Button {
                    dismiss.callAsFunction()
                } label: {
                    Text("é©ç”¨")
                        .foregroundStyle(.white)
                }
            }
        }
    }
}

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/7/24 17:54:08*

`PhotoCropView` ã®å††å½¢ã‚µãƒ¼ã‚¯ãƒ«ãŒç”»é¢ã‹ã‚‰ã¯ã¿å‡ºãªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã€`GeometryReader` ã®ã‚µã‚¤ã‚ºã«åŸºã¥ã„ã¦ã‚µãƒ¼ã‚¯ãƒ«ã®ã‚µã‚¤ã‚ºã‚’èª¿æ•´ã—ã€å¸¸ã«ä¸­å¤®ã«é…ç½®ã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ã¾ãŸã€å††å½¢ã‚µãƒ¼ã‚¯ãƒ«ã®å¤–å´ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚‚é©åˆ‡ã«èª¿æ•´ã—ã¾ã™ã€‚

ä»¥ä¸‹ã«ä¿®æ­£ã—ãŸã‚³ãƒ¼ãƒ‰ã‚’ç¤ºã—ã¾ã™ï¼š

```swift
import SwiftUI

struct PhotoCropView: View {
    @Binding var selectedImage: UIImage?
    @Environment(\.dismiss) private var dismiss

    var body: some View {
        VStack {
            if let selectedImage {
                GeometryReader { geometry in
                    let size = min(geometry.size.width, geometry.size.height)
                    let circleSize = size * 0.8

                    ZStack {
                        Image(uiImage: selectedImage)
                            .resizable()
                            .scaledToFit()
                            .frame(width: geometry.size.width, height: geometry.size.height)
                            .clipped()
                        
                        // åŠé€æ˜ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤
                        Rectangle()
                            .fill(Color.black.opacity(0.5))
                            .mask(
                                ZStack {
                                    Rectangle()
                                        .fill(Color.white)
                                    Circle()
                                        .frame(width: circleSize, height: circleSize)
                                        .blendMode(.destinationOut)
                                        .position(x: geometry.size.width / 2, y: geometry.size.height / 2)
                                }
                            )
                            .compositingGroup()
                            .frame(width: geometry.size.width, height: geometry.size.height)
                        
                        Text("TODO: ã‚¯ãƒªãƒƒãƒ—æ©Ÿèƒ½ã‚„æ‹¡å¤§ç¸®å°æ©Ÿèƒ½ã¯æœªå®Ÿè£…")
                            .foregroundColor(.white)
                            .position(x: geometry.size.width / 2, y: geometry.size.height / 2)
                    }
                }
            } else {
                Text("No Image Selected")
                    .foregroundColor(.white)
            }
        }
        .frame(maxWidth: .infinity, maxHeight: .infinity)
        .background(Color.black)
        .ignoresSafeArea()
        .toolbar {
            ToolbarItem(placement: .topBarLeading) {
                Button {
                    selectedImage = nil
                    dismiss.callAsFunction()
                } label: {
                    Text("ã‚­ãƒ£ãƒ³ã‚»ãƒ«")
                        .foregroundStyle(.white)
                }
            }

            ToolbarItem(placement: .topBarTrailing) {
                Button {
                    dismiss.callAsFunction()
                } label: {
                    Text("é©ç”¨")
                        .foregroundStyle(.white)
                }
            }
        }
    }
}
```

ã“ã®ä¿®æ­£ã§ã¯ã€`Circle` ã‚’ `GeometryReader` ã®ä¸­å¿ƒã«é…ç½®ã—ã€ãã®ã‚µã‚¤ã‚ºã‚’ `geometry.size.width` ã¾ãŸã¯ `geometry.size.height` ã®æœ€å°å€¤ã® 80% ã«è¨­å®šã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å††å½¢ã‚µãƒ¼ã‚¯ãƒ«ãŒå¸¸ã«ç”»é¢å†…ã«åã¾ã‚Šã€ã¯ã¿å‡ºã™ã“ã¨ãŒãªããªã‚Šã¾ã™ã€‚ã¾ãŸã€`Text` è¦ç´ ã‚‚ä¸­å¤®ã«é…ç½®ã—ã¦ã„ã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/7/24 17:59:06*

{
  "content_type": "image_asset_pointer",
  "asset_pointer": "file-service://file-XokltJVsxPh9zHbas0wuJxgw",
  "size_bytes": 369335,
  "width": 545,
  "height": 962,
  "fovea": null,
  "metadata": {
    "dalle": null,
    "gizmo": null,
    "generation": null,
    "container_pixel_height": null,
    "container_pixel_width": null,
    "emu_omit_glimpse_image": null,
    "emu_patches_override": null,
    "sanitized": true,
    "asset_pointer_link": null,
    "watermarked_asset_pointer": null
  }
}
ã“ã®ã‚ˆã†ã«ã¡ã‚‡ã£ã¨å††ãŒã¯ã¿å‡ºã—ã¦ã„ã‚‹ã‚“ã ã‚ˆã­

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/7/24 17:59:33*

å††ãŒç”»é¢ã‹ã‚‰ã¯ã¿å‡ºã•ãªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã€`Circle` ã®ã‚µã‚¤ã‚ºã‚’èª¿æ•´ã—ã€ç”»é¢ã®çŸ­è¾ºã«åˆã‚ã›ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ä»¥ä¸‹ã«ä¿®æ­£ã—ãŸã‚³ãƒ¼ãƒ‰ã‚’ç¤ºã—ã¾ã™ï¼š

```swift
import SwiftUI

struct PhotoCropView: View {
    @Binding var selectedImage: UIImage?
    @Environment(\.dismiss) private var dismiss

    var body: some View {
        VStack {
            if let selectedImage {
                GeometryReader { geometry in
                    let circleSize = min(geometry.size.width, geometry.size.height) * 0.8

                    ZStack {
                        Image(uiImage: selectedImage)
                            .resizable()
                            .scaledToFit()
                            .frame(width: geometry.size.width, height: geometry.size.height)
                            .clipped()
                        
                        // åŠé€æ˜ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤
                        Rectangle()
                            .fill(Color.black.opacity(0.5))
                            .mask(
                                ZStack {
                                    Rectangle()
                                        .fill(Color.white)
                                    Circle()
                                        .frame(width: circleSize, height: circleSize)
                                        .blendMode(.destinationOut)
                                        .position(x: geometry.size.width / 2, y: geometry.size.height / 2)
                                }
                            )
                            .compositingGroup()
                            .frame(width: geometry.size.width, height: geometry.size.height)
                        
                        Text("TODO: ã‚¯ãƒªãƒƒãƒ—æ©Ÿèƒ½ã‚„æ‹¡å¤§ç¸®å°æ©Ÿèƒ½ã¯æœªå®Ÿè£…")
                            .foregroundColor(.white)
                            .position(x: geometry.size.width / 2, y: geometry.size.height / 2)
                    }
                }
            } else {
                Text("No Image Selected")
                    .foregroundColor(.white)
            }
        }
        .frame(maxWidth: .infinity, maxHeight: .infinity)
        .background(Color.black)
        .ignoresSafeArea()
        .toolbar {
            ToolbarItem(placement: .topBarLeading) {
                Button {
                    selectedImage = nil
                    dismiss.callAsFunction()
                } label: {
                    Text("ã‚­ãƒ£ãƒ³ã‚»ãƒ«")
                        .foregroundStyle(.white)
                }
            }

            ToolbarItem(placement: .topBarTrailing) {
                Button {
                    dismiss.callAsFunction()
                } label: {
                    Text("é©ç”¨")
                        .foregroundStyle(.white)
                }
            }
        }
    }
}
```

ã“ã®ä¿®æ­£ã§ã¯ã€`circleSize` ã‚’ `geometry.size.width` ã¨ `geometry.size.height` ã®æœ€å°å€¤ã® 80% ã«è¨­å®šã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å††ãŒç”»é¢ã®çŸ­è¾ºã«åˆã‚ã›ã¦ç¸®å°ã•ã‚Œã€ã¯ã¿å‡ºã™ã“ã¨ãŒãªããªã‚Šã¾ã™ã€‚

---

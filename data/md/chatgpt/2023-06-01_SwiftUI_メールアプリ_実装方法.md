# SwiftUI メールアプリ 実装方法

Date: 2023-06-01

---

## 👤 User
*2023-06-01 16:38:36*

SwiftUI でメールアプリに飛ばさせたいのだけれどもどうやって実装すればいいか教えて欲しい

---

## 🤖 Assistant
*2023-06-01 16:39:21*

SwiftUIでは現在、直接メールクライアントを開くAPIがありませんが、UIApplicationのopenURLメソッドを利用して、メールクライアントを開くことができます。

以下に、SwiftUIでメールクライアントを開くためのコード例を示します。

まず、UIApplicationを使えるようにするためのUIKitのインポートが必要です。

```swift
import SwiftUI
import UIKit
```

次に、UIApplicationのopenURLメソッドを呼び出すためのメソッドを定義します。

```swift
func sendEmail() {
    if let url = URL(string: "mailto:info@example.com") {
        if UIApplication.shared.canOpenURL(url) {
            UIApplication.shared.open(url, options: [:], completionHandler: nil)
        }
    }
}
```

この関数は、"mailto:"スキームを使用して、メールクライアントに飛ぶURLを作成します。ここではメールアドレスは"info@example.com"にしていますが、適宜変更してください。

そして、SwiftUIのビュー内からこのメソッドを呼び出します。

```swift
struct ContentView: View {
    var body: some View {
        Button(action: {
            sendEmail()
        }) {
            Text("Send Email")
        }
    }
}
```

この例では、ボタンが押されたときにsendEmailメソッドが呼び出され、メールクライアントが開きます。

ただし、この方法には制限があります。ユーザーがメールアプリを設定していない場合や、"mailto:"スキームに対応していないメールアプリを使用している場合、期待通りに動作しない可能性があります。そのため、通常はMFMailComposeViewControllerを使用してメール送信UIを提供するのが一般的ですが、残念ながらこれは現在のSwiftUIでは直接サポートされていません。

それを補うためには、UIKitとSwiftUIをブリッジする方法がありますが、それはさらに複雑な実装が必要となります。

---

## 👤 User
*2023-06-01 16:39:50*

なるべく簡単な方法がいい。ちなみに件名やタイトルは設定できるの？

---

## 🤖 Assistant
*2023-06-01 16:40:33*

はい、メールの件名や本文を設定することも可能です。"mailto:" URLスキームでは、件名や本文など、メールのいくつかのフィールドを設定するためのパラメータを提供しています。

以下のようにしてパラメータを追加することができます：

```swift
func sendEmail() {
    if let url = URL(string: "mailto:info@example.com?subject=Hello&body=World") {
        if UIApplication.shared.canOpenURL(url) {
            UIApplication.shared.open(url, options: [:], completionHandler: nil)
        }
    }
}
```

この例では、"subject"パラメータに"Hello"を、"body"パラメータに"World"を設定しています。ただし、これらのパラメータはURLエンコードする必要があることを覚えておいてください。つまり、スペースや特殊文字を含む文字列をパラメータとして使用する場合は、それらをURLエンコードする必要があります。

また、送信先が複数ある場合は、メールアドレスをカンマで区切ることで設定できます：

```swift
func sendEmail() {
    if let url = URL(string: "mailto:info1@example.com,info2@example.com?subject=Hello&body=World") {
        if UIApplication.shared.canOpenURL(url) {
            UIApplication.shared.open(url, options: [:], completionHandler: nil)
        }
    }
}
```

以上の方法で、簡易的なメール送信機能をSwiftUIで実装することができます。ただし、上記にも述べたように、この方法にはいくつか制限があります。全てのユーザーのデバイスで正常に動作するわけではないことを理解しておいてください。

---

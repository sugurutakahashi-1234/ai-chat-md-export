# tsconfig 設定の最適化

Date: 2025-06-05

---

## 👤 User
*2025-06-05 18:24:18*

"build": "tsc -p . && cp -r src/generated dist/", このようなコピーをしているのだけれどもやってもいいものなのか？

TypeScriptコンパイラは基本的に.tsファイルを.jsと.d.tsにコンパイルしますが、src/generated/ディレク
  トリ内のファイルは元々がJavaScriptファイル（Prismaとzod-prisma-typesが生成したファイル）なので、TypeScriptコ
  ンパイラがそれらをdist/にコピーしてくれません。


tsconfig.json とかを変えた方がいいのか？

---

## 🤖 Assistant
*2025-06-05 18:25:04*

### 結論
`cp -r src/generated dist/` で手動コピーする方法は **動作上は問題ありません** が、長期運用では **tsconfig を調整して `tsc` 自身にコピーさせる** ほうが安全で可搬性も高くなります。

---

## 1. tsconfig で解決する（推奨）

```json
{
  "compilerOptions": {
    "rootDir": "src",
    "outDir": "dist",
    "allowJs": true,      // JS を入力として扱う
    "checkJs": false,     // 型チェック不要なら false
    "declaration": true   // 必要なら .d.ts も生成
  },
  "include": [
    "src/**/*.ts",
    "src/generated/**/*.js"   // 生成済み JS を明示的に含める
  ]
}
```

* `allowJs` を付けると `.js` ファイルが **そのまま `outDir` に出力** されます。 TypeScript 5.x でも仕様は変わっていません。citeturn0search8turn0search7  
* `tsc --watch` でも自動で同期され、追加のコピーコマンドは不要。  
* 生成 JS に型チェックを掛けたい場合は `checkJs: true` に。

---

## 2. ビルドツールを使う

esbuild や tsup なら

```bash
tsup src/index.ts src/generated/**/*.js --dts --out-dir dist
```

のように **JS と TS をまとめてバンドル／コピー** できます。  
一つのバイナリに束ねたり、Tree-Shaking したい場合はこちらが便利。

---

## 3. 今のまま `cp` を続ける

```json
"build": "tsc -p . && cp -r src/generated dist/"
```

* **最も手軽**。  
* ただし `cp` は Unix 系専用なので **Windows 互換がない**。クロスプラットフォームにしたいなら `cpy-cli` などを使うか、シェルごと分ける必要があります。  
* ウォッチや増分ビルドでは余分なコピーが走りがち。  
  議論でも「一行コピーで済ませる派」は一定数いるものの、運用規模が大きくなると見直されるケースが多いです。citeturn0search1

---

### 比較表

| 方法 | 学習コスト | watch 対応 | OS 互換 | 主なメリット | 主なデメリット |
|------|-----------|-----------|---------|--------------|----------------|
| tsconfig + `allowJs` | 低 | ◎ | ◎ | 設定だけで自動コピー・型チェックも可能 | JS が多いとビルド時間微増 |
| esbuild/tsup 等 | 中 | ◎ | ◎ | まとめてバンドル・最適化 | 依存追加・設定が必要 |
| 手動 `cp` | 低 | △ | × | すぐ動く・設定不要 | OS 依存・漏れやすい |

---

## まとめ
* **小規模／試験的なプロジェクト** → 今の `cp` でも可。  
* **中〜大規模で継続的開発** → tsconfig に `allowJs` を追加して `tsc` に任せるのが最もシンプルで安全。  
* **バンドルや最適化、単一ファイル配布が必要** → esbuild や tsup を検討。

プロジェクトの規模と将来の CI／クロスプラットフォーム要件に合わせて選択してください。

---

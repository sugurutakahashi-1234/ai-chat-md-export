# SwiftUI カウントダウン タイマー

日付: 2024-07-22

---

## 👤 ユーザー
*2024/7/22 17:16:49*

SwiftUI で 60秒からカウントっダウンする

---

## 🤖 アシスタント
*2024/7/22 17:16:59*

SwiftUIで60秒からカウントダウンするには、`Timer`を使って時間を更新し、`@State`プロパティで現在の秒数を管理します。以下はその実装例です。

```swift
import SwiftUI

struct CountdownView: View {
    @State private var secondsRemaining = 60
    @State private var timer: Timer? = nil
    
    var body: some View {
        VStack {
            Text("\(secondsRemaining)")
                .font(.largeTitle)
                .padding()
            
            if secondsRemaining > 0 {
                Button(action: startTimer) {
                    Text("Start Countdown")
                        .padding()
                        .background(Color.blue)
                        .foregroundColor(.white)
                        .cornerRadius(10)
                }
            } else {
                Text("Time's up!")
                    .font(.title)
                    .padding()
            }
        }
    }
    
    func startTimer() {
        timer?.invalidate()
        timer = Timer.scheduledTimer(withTimeInterval: 1.0, repeats: true) { _ in
            if secondsRemaining > 0 {
                secondsRemaining -= 1
            } else {
                timer?.invalidate()
            }
        }
    }
}

struct CountdownView_Previews: PreviewProvider {
    static var previews: some View {
        CountdownView()
    }
}
```

### 解説
1. `@State private var secondsRemaining = 60`:
    - カウントダウンの秒数を管理するための状態変数です。初期値を60秒に設定します。

2. `@State private var timer: Timer? = nil`:
    - `Timer`オブジェクトを保持するための状態変数です。タイマーを開始・停止するために使用します。

3. `VStack`:
    - 垂直スタックにカウントダウンの秒数とボタンを配置します。

4. `Text("\(secondsRemaining)")`:
    - 現在の秒数を表示します。

5. `Button(action: startTimer)`:
    - タイマーを開始するボタンです。カウントダウンが終わったら「Time's up!」のメッセージを表示します。

6. `startTimer()`:
    - タイマーを開始する関数です。1秒ごとに秒数を1ずつ減らし、0になったらタイマーを停止します。

このコードを使って、60秒からのカウントダウンを簡単に実装できます。UIのデザインや機能を追加することで、アプリケーションの要件に合わせてカスタマイズできます。

---

## 👤 ユーザー
*2024/7/22 17:17:26*

Timer.publish(every: 1, on: .main, in: .common).autoconnect() とどっちがいいの？

---

## 🤖 アシスタント
*2024/7/22 17:18:00*

`Timer.publish(every: 1, on: .main, in: .common).autoconnect()` を使うと、SwiftUI のビューが更新されるたびにタイマーを簡単に管理できます。この方法は、ビューが画面から消えたときに自動的にタイマーを停止するため、メモリ管理やパフォーマンスに優れています。

以下は、`Timer.publish` を使ったカウントダウンの例です。

```swift
import SwiftUI
import Combine

struct CountdownView: View {
    @State private var secondsRemaining = 60
    private let timer = Timer.publish(every: 1, on: .main, in: .common).autoconnect()
    
    var body: some View {
        VStack {
            Text("\(secondsRemaining)")
                .font(.largeTitle)
                .padding()
            
            if secondsRemaining > 0 {
                Button(action: startCountdown) {
                    Text("Start Countdown")
                        .padding()
                        .background(Color.blue)
                        .foregroundColor(.white)
                        .cornerRadius(10)
                }
            } else {
                Text("Time's up!")
                    .font(.title)
                    .padding()
            }
        }
        .onReceive(timer) { _ in
            if secondsRemaining > 0 {
                secondsRemaining -= 1
            }
        }
    }
    
    func startCountdown() {
        secondsRemaining = 60
    }
}

struct CountdownView_Previews: PreviewProvider {
    static var previews: some View {
        CountdownView()
    }
}
```

### 解説
1. `Timer.publish(every: 1, on: .main, in: .common).autoconnect()`:
    - 1秒ごとに発行されるタイマーを定義し、`.autoconnect()` で自動的に接続します。これにより、タイマーはビューが表示されている間だけ動作します。

2. `@State private var secondsRemaining = 60`:
    - カウントダウンの秒数を管理するための状態変数です。初期値を60秒に設定します。

3. `@State private var timer: Timer? = nil`:
    - `Timer`オブジェクトを保持するための状態変数です。タイマーを開始・停止するために使用します。

4. `Text("\(secondsRemaining)")`:
    - 現在の秒数を表示します。

5. `Button(action: startCountdown)`:
    - タイマーを開始するボタンです。カウントダウンが終わったら「Time's up!」のメッセージを表示します。

6. `.onReceive(timer)`:
    - タイマーからのイベントを受け取り、秒数を減らします。秒数が0になったらタイマーを停止します。

### 比較
- **`Timer.scheduledTimer` を使用する方法**: より直接的で簡単にカスタマイズ可能ですが、メモリ管理に注意が必要です。ビューが画面から消えてもタイマーが動作し続ける可能性があります。
- **`Timer.publish` を使用する方法**: ビューのライフサイクルに合わせてタイマーが自動的に管理されるため、メモリ管理やパフォーマンスが向上します。

`Timer.publish` を使う方が、SwiftUI のライフサイクルに沿った適切なタイマー管理ができるため、おすすめです。

---

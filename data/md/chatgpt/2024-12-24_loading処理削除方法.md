# loading処理削除方法

日付: 2024-12-24

---

## 👤 ユーザー
*2024/12/24 16:28:40*

loading の処理はいらない

ref.listen&lt;AsyncValue&lt;String?&gt;&gt;(
      deleteGuildNotifierProvider,
      (previous, next) {
        next.when(
          data: (data) {
            if (data == null) {
              return;
            }
            ScaffoldMessenger.of(context).showSnackBar(
              SnackBar(content: Text('Guild deleted successfully: $data')),
            );
            context.pop();
          },
          error: (e, stackTrace) {
            ScaffoldMessenger.of(context).showSnackBar(
              SnackBar(content: Text('Error deleting guild: $e')),
            );
          },
          loading: () {
            ScaffoldMessenger.of(context).showSnackBar(
              const SnackBar(content: Text('Deleting guild...')),
            );
          },
        );
      },
    );

---

## 🤖 アシスタント
*2024/12/24 16:28:52*

`loading` の処理が不要であれば、以下のように `when` の処理から `loading` ケースを削除できます。`loading` を削除しても `when` の構文的に問題ありません。

### 修正版コード
```dart
ref.listen<AsyncValue<String?>>(
  deleteGuildNotifierProvider,
  (previous, next) {
    next.when(
      data: (data) {
        if (data == null) {
          return;
        }
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text('Guild deleted successfully: $data')),
        );
        context.pop();
      },
      error: (e, stackTrace) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text('Error deleting guild: $e')),
        );
      },
      loading: null, // この部分を削除するか、単に指定しない
    );
  },
);
```

または `when` を使わずに `map` を使って処理を簡略化することもできます（`loading` を無視する場合）。

```dart
ref.listen<AsyncValue<String?>>(
  deleteGuildNotifierProvider,
  (previous, next) {
    next.map(
      data: (data) {
        if (data.value == null) {
          return;
        }
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text('Guild deleted successfully: ${data.value}')),
        );
        context.pop();
      },
      error: (error) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text('Error deleting guild: ${error.error}')),
        );
      },
      loading: (_) {},
    );
  },
);
```

どちらの方法でも、`loading` の処理を無効化できます。最終的にはプロジェクトのコードスタイルや要件に応じて選んでください。

---

## 👤 ユーザー
*2024/12/24 16:30:52*

これもwhenで書き直したい

    ref.listen&lt;AsyncValue&lt;GuildInfoResponseDtoData?&gt;&gt;(
      getMyGuildNotifierProvider,
      (previous, next) {
        if (next is AsyncData) {
          if (next.value == null) {
            return;
          }
          if (context.mounted) {
            context.push(Screen.guildRequest.path);
          }
        } else if (next is AsyncError) {
          if (context.mounted) {
            ScaffoldMessenger.of(context).showSnackBar(
              SnackBar(
                content: Text('Error: ${next.error}'),
              ),
            );
          }
        }
      },
    );

---

## 🤖 アシスタント
*2024/12/24 16:31:06*

`when` を使用して書き直すと、以下のように `next` の `AsyncData` や `AsyncError` の処理を分かりやすく記述できます。

### `when` を使用したコード

```dart
ref.listen<AsyncValue<GuildInfoResponseDtoData?>>(
  getMyGuildNotifierProvider,
  (previous, next) {
    next.when(
      data: (data) {
        if (data == null) {
          return;
        }
        if (context.mounted) {
          context.push(Screen.guildRequest.path);
        }
      },
      error: (e, stackTrace) {
        if (context.mounted) {
          ScaffoldMessenger.of(context).showSnackBar(
            SnackBar(
              content: Text('Error: $e'),
            ),
          );
        }
      },
      loading: () {
        // `loading` の処理が不要であれば空にするか、削除可能です。
      },
    );
  },
);
```

### 修正ポイント
1. **`when` を使用**:
   - `AsyncValue` の状態 (`data`, `error`, `loading`) をスッキリ分岐できます。

2. **`loading` の処理**:
   - 必要ない場合は `loading` に空のラムダ式 `{}` を記述するか、省略可能です。

3. **`context.mounted` チェック**:
   - 安全に画面遷移や UI 更新を行うために `context.mounted` を保持。

`when` を使うことでコードの構造が統一され、読みやすさが向上します。

---

## 👤 ユーザー
*2024/12/24 16:31:33*

これも

    ref.listen&lt;AsyncValue&lt;String?&gt;&gt;(createGuildNotifierProvider,
        (previous, next) {
      if (next is AsyncData) {
        if (next.value == null) {
          return;
        }
        if (context.mounted) {
          ScaffoldMessenger.of(context).showSnackBar(
            const SnackBar(content: Text('ギルドが作成されました！')),
          );
          ref.read(onCreatedGuildNotifierProvider.notifier).trigger();
          context.pop();
        }
      } else if (next is AsyncError) {
        if (context.mounted) {
          ScaffoldMessenger.of(context).showSnackBar(
            SnackBar(content: Text('ギルドの作成に失敗しました: ${next.error}')),
          );
        }
      }
    });

---

## 🤖 アシスタント
*2024/12/24 16:31:43*

`when` を使用してリファクタリングすると、以下のようにコードを整理できます。

### `when` を使用したリファクタリング後のコード

```dart
ref.listen<AsyncValue<String?>>(createGuildNotifierProvider, (previous, next) {
  next.when(
    data: (data) {
      if (data == null) {
        return;
      }
      if (context.mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          const SnackBar(content: Text('ギルドが作成されました！')),
        );
        ref.read(onCreatedGuildNotifierProvider.notifier).trigger();
        context.pop();
      }
    },
    error: (error, stackTrace) {
      if (context.mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text('ギルドの作成に失敗しました: $error')),
        );
      }
    },
    loading: () {
      // `loading` の処理が必要でなければ空でOK
    },
  );
});
```

### 修正ポイント
1. **`when` を使用して分岐を明確化**:
   - `AsyncData` は `data` に、`AsyncError` は `error` に簡潔に対応できます。

2. **`loading` の処理**:
   - 必要であれば記述し、不要であれば空にするか省略可能です。

3. **`context.mounted` チェック**:
   - 画面遷移や UI 更新前に安全性を確保。

### メリット
- `if` 文のネストが減り、コードが読みやすくなります。
- `when` を利用することで、`AsyncValue` のすべての状態を網羅的に扱うことが明確になります。

---

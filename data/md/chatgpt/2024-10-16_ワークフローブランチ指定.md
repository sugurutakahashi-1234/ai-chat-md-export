# ワークフローブランチ指定

Date: 2024-10-16

---

## 👤 User
*2024-10-16 19:00:30*

workflow_dispatch のワークフローにJobsIOSOpenAPIの任意のブランチを指定したい。


name: Import OpenAPI

on:
  workflow_dispatch:
  # Allows external webhook trigger
  repository_dispatch:
   types:
      - import_openapi

jobs:
  import:
    runs-on: ubuntu-latest
    steps:
      # dependencies
      - uses: actions/setup-node@v3
      - uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '11'
      - run: npm i -g @openapitools/openapi-generator-cli
      - run: openapi-generator-cli version-manager set 7.4.0

      # main
      - name: Checkout jobsAppApi repo
        uses: actions/checkout@v3
        with:
          repository: progrit/jobsAppApi
          token: ${{secrets.SWAGGER_CHECKOUT_GITHUB_TOKEN}}
          path: jobsAppApi
          ref: develop

      - name: Checkout JobsIOSOpenAPI repo
        uses: actions/checkout@v3
        with:
          path: JobsIOSOpenAPI
          ref: main

      - name: Remove the generated legacy openAPI code
        run: |
              rm -rf JobsIOSOpenAPI/OpenAPIClient
              rm -rf JobsIOSOpenAPI/docs
      - name: Generate openAPI client
        run: |
              openapi-generator-cli generate \
              -i jobsAppApi/openapi/index.yml \
              -g swift5 \
              -o JobsIOSOpenAPI \
              --additional-properties=projectName=JobsIOSOpenAPI,responseAs=AsyncAwait \
              --skip-validate-spec \
              --model-name-suffix=DTO
      - name: Commit & push
        run: |
              cd JobsIOSOpenAPI
              git config --local user.email "import-openapi-bot@progrit.co.jp"
              git config --local user.name "import-openapi-bot"
              git add -A
              git commit -m "chore: generated with swagger specs ${{github.event.client_payload.ref}}" || echo "Skip commit."
              git push

---

## 🤖 Assistant
*2024-10-16 19:00:56*

`workflow_dispatch` で任意のブランチを指定するには、ワークフロー入力としてブランチ名を指定することができます。`on.workflow_dispatch.inputs` の設定でブランチ名を入力として受け取り、そのブランチを `Checkout JobsIOSOpenAPI repo` ステップで利用するように変更します。

以下の修正を行います。

1. `on.workflow_dispatch.inputs` にブランチ名を追加。
2. `Checkout JobsIOSOpenAPI repo` の `ref` 部分に入力されたブランチ名を使用。

```yaml
name: Import OpenAPI

on:
  workflow_dispatch:
    inputs:
      branch:
        description: 'Branch to checkout in JobsIOSOpenAPI'
        required: false
        default: 'main'
  repository_dispatch:
    types:
      - import_openapi

jobs:
  import:
    runs-on: ubuntu-latest
    steps:
      # dependencies
      - uses: actions/setup-node@v3
      - uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '11'
      - run: npm i -g @openapitools/openapi-generator-cli
      - run: openapi-generator-cli version-manager set 7.4.0

      # main
      - name: Checkout jobsAppApi repo
        uses: actions/checkout@v3
        with:
          repository: progrit/jobsAppApi
          token: ${{secrets.SWAGGER_CHECKOUT_GITHUB_TOKEN}}
          path: jobsAppApi
          ref: develop

      - name: Checkout JobsIOSOpenAPI repo
        uses: actions/checkout@v3
        with:
          path: JobsIOSOpenAPI
          ref: ${{ github.event.inputs.branch }}

      - name: Remove the generated legacy openAPI code
        run: |
              rm -rf JobsIOSOpenAPI/OpenAPIClient
              rm -rf JobsIOSOpenAPI/docs
      - name: Generate openAPI client
        run: |
              openapi-generator-cli generate \
              -i jobsAppApi/openapi/index.yml \
              -g swift5 \
              -o JobsIOSOpenAPI \
              --additional-properties=projectName=JobsIOSOpenAPI,responseAs=AsyncAwait \
              --skip-validate-spec \
              --model-name-suffix=DTO
      - name: Commit & push
        run: |
              cd JobsIOSOpenAPI
              git config --local user.email "import-openapi-bot@progrit.co.jp"
              git config --local user.name "import-openapi-bot"
              git add -A
              git commit -m "chore: generated with swagger specs ${{github.event.client_payload.ref}}" || echo "Skip commit."
              git push
```

これにより、`workflow_dispatch` を手動で実行する際に任意のブランチを指定できるようになります。指定がない場合は、デフォルトで `main` ブランチが使われます。

---

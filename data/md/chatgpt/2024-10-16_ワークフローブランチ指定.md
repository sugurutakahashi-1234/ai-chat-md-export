# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ–ãƒ©ãƒ³ãƒæŒ‡å®š

Date: 2024-10-16

---

## ğŸ‘¤ User
*2024-10-16 19:00:30*

workflow_dispatch ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«JobsIOSOpenAPIã®ä»»æ„ã®ãƒ–ãƒ©ãƒ³ãƒã‚’æŒ‡å®šã—ãŸã„ã€‚


name: Import OpenAPI

on:
  workflow_dispatch:
  # Allows external webhook trigger
  repository_dispatch:
   types:
      - import_openapi

jobs:
  import:
    runs-on: ubuntu-latest
    steps:
      # dependencies
      - uses: actions/setup-node@v3
      - uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '11'
      - run: npm i -g @openapitools/openapi-generator-cli
      - run: openapi-generator-cli version-manager set 7.4.0

      # main
      - name: Checkout jobsAppApi repo
        uses: actions/checkout@v3
        with:
          repository: progrit/jobsAppApi
          token: ${{secrets.SWAGGER_CHECKOUT_GITHUB_TOKEN}}
          path: jobsAppApi
          ref: develop

      - name: Checkout JobsIOSOpenAPI repo
        uses: actions/checkout@v3
        with:
          path: JobsIOSOpenAPI
          ref: main

      - name: Remove the generated legacy openAPI code
        run: |
              rm -rf JobsIOSOpenAPI/OpenAPIClient
              rm -rf JobsIOSOpenAPI/docs
      - name: Generate openAPI client
        run: |
              openapi-generator-cli generate \
              -i jobsAppApi/openapi/index.yml \
              -g swift5 \
              -o JobsIOSOpenAPI \
              --additional-properties=projectName=JobsIOSOpenAPI,responseAs=AsyncAwait \
              --skip-validate-spec \
              --model-name-suffix=DTO
      - name: Commit & push
        run: |
              cd JobsIOSOpenAPI
              git config --local user.email "import-openapi-bot@progrit.co.jp"
              git config --local user.name "import-openapi-bot"
              git add -A
              git commit -m "chore: generated with swagger specs ${{github.event.client_payload.ref}}" || echo "Skip commit."
              git push

---

## ğŸ¤– Assistant
*2024-10-16 19:00:56*

`workflow_dispatch` ã§ä»»æ„ã®ãƒ–ãƒ©ãƒ³ãƒã‚’æŒ‡å®šã™ã‚‹ã«ã¯ã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å…¥åŠ›ã¨ã—ã¦ãƒ–ãƒ©ãƒ³ãƒåã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚`on.workflow_dispatch.inputs` ã®è¨­å®šã§ãƒ–ãƒ©ãƒ³ãƒåã‚’å…¥åŠ›ã¨ã—ã¦å—ã‘å–ã‚Šã€ãã®ãƒ–ãƒ©ãƒ³ãƒã‚’ `Checkout JobsIOSOpenAPI repo` ã‚¹ãƒ†ãƒƒãƒ—ã§åˆ©ç”¨ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚

ä»¥ä¸‹ã®ä¿®æ­£ã‚’è¡Œã„ã¾ã™ã€‚

1. `on.workflow_dispatch.inputs` ã«ãƒ–ãƒ©ãƒ³ãƒåã‚’è¿½åŠ ã€‚
2. `Checkout JobsIOSOpenAPI repo` ã® `ref` éƒ¨åˆ†ã«å…¥åŠ›ã•ã‚ŒãŸãƒ–ãƒ©ãƒ³ãƒåã‚’ä½¿ç”¨ã€‚

```yaml
name: Import OpenAPI

on:
  workflow_dispatch:
    inputs:
      branch:
        description: 'Branch to checkout in JobsIOSOpenAPI'
        required: false
        default: 'main'
  repository_dispatch:
    types:
      - import_openapi

jobs:
  import:
    runs-on: ubuntu-latest
    steps:
      # dependencies
      - uses: actions/setup-node@v3
      - uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '11'
      - run: npm i -g @openapitools/openapi-generator-cli
      - run: openapi-generator-cli version-manager set 7.4.0

      # main
      - name: Checkout jobsAppApi repo
        uses: actions/checkout@v3
        with:
          repository: progrit/jobsAppApi
          token: ${{secrets.SWAGGER_CHECKOUT_GITHUB_TOKEN}}
          path: jobsAppApi
          ref: develop

      - name: Checkout JobsIOSOpenAPI repo
        uses: actions/checkout@v3
        with:
          path: JobsIOSOpenAPI
          ref: ${{ github.event.inputs.branch }}

      - name: Remove the generated legacy openAPI code
        run: |
              rm -rf JobsIOSOpenAPI/OpenAPIClient
              rm -rf JobsIOSOpenAPI/docs
      - name: Generate openAPI client
        run: |
              openapi-generator-cli generate \
              -i jobsAppApi/openapi/index.yml \
              -g swift5 \
              -o JobsIOSOpenAPI \
              --additional-properties=projectName=JobsIOSOpenAPI,responseAs=AsyncAwait \
              --skip-validate-spec \
              --model-name-suffix=DTO
      - name: Commit & push
        run: |
              cd JobsIOSOpenAPI
              git config --local user.email "import-openapi-bot@progrit.co.jp"
              git config --local user.name "import-openapi-bot"
              git add -A
              git commit -m "chore: generated with swagger specs ${{github.event.client_payload.ref}}" || echo "Skip commit."
              git push
```

ã“ã‚Œã«ã‚ˆã‚Šã€`workflow_dispatch` ã‚’æ‰‹å‹•ã§å®Ÿè¡Œã™ã‚‹éš›ã«ä»»æ„ã®ãƒ–ãƒ©ãƒ³ãƒã‚’æŒ‡å®šã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚æŒ‡å®šãŒãªã„å ´åˆã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ `main` ãƒ–ãƒ©ãƒ³ãƒãŒä½¿ã‚ã‚Œã¾ã™ã€‚

---

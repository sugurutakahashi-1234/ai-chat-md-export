# SwiftUI 画面向き制御

Date: 2023-05-23

---

## 👤 User
*2023-05-23 10:01:12*

SwiftUIで画面横向きと縦向きをコードで変更したい

---

## 🤖 Assistant
*2023-05-23 10:01:37*

SwiftUIでは直接的なデバイスの向き（横向きまたは縦向き）を変更する方法は提供されていません。画面の向きを制御するためのAPIはUIKitで提供されており、そのためには`UIDevice`の`setValue`メソッドを使います。SwiftUIとUIKitのブリッジが必要になります。

ただし、この方法は推奨されません。なぜなら、ユーザーのデバイス設定やユーザーの期待に反する可能性があるからです。デバイスの向きを強制的に変更する代わりに、アプリケーションが異なる向きをサポートするようにデザインすることを強くお勧めします。

なお、SwiftUIでは`@Environment(\.horizontalSizeClass)`と`@Environment(\.verticalSizeClass)`を使用してデバイスの向きを検出し、それに応じてUIを更新することができます。

以下はSwiftUIでデバイスの向きに基づいて異なるビューを表示する例です。

```swift
struct ContentView: View {
    @Environment(\.horizontalSizeClass) var horizontalSizeClass
    @Environment(\.verticalSizeClass) var verticalSizeClass

    var body: some View {
        Group {
            if horizontalSizeClass == .compact && verticalSizeClass == .regular {
                // 縦向きのときのビュー
                Text("Portrait")
            } else {
                // 横向きのときのビュー
                Text("Landscape")
            }
        }
    }
}
```

この方法では、アプリのUIはデバイスの向きを自動的に認識し、適切にレイアウトを調整します。

---

## 👤 User
*2023-05-23 11:33:34*

@Environment(\.horizontalSizeClass)と@Environment(\.verticalSizeClass)について詳しく教えて

---

## 🤖 Assistant
*2023-05-23 11:34:11*

SwiftUIの`@Environment`プロパティラッパーは、ビューの環境設定にアクセスします。環境設定には、使用中のデバイスの幅と高さのサイズクラス、デバイスの向き、システムの色スキーム、ロケール、アクセシビリティ設定などが含まれます。

`horizontalSizeClass`と`verticalSizeClass`は、デバイスの幅と高さのサイズクラスを表します。これらは、UIがデバイスのスクリーンサイズと向きにどのように適応するかを制御するための方法です。

それぞれのサイズクラスは、`.compact`または`.regular`の2つの値をとり得ます。たとえば、iPhoneのポートレートモード（縦向き）では、`horizontalSizeClass`は`.compact`で、`verticalSizeClass`は`.regular`になります。それに対して、iPhoneのランドスケープモード（横向き）では、ほとんどのモデルで`horizontalSizeClass`と`verticalSizeClass`の両方が`.compact`になります。

これらの値を使って、デバイスの向きやスクリーンサイズに適応したUIを作ることができます。

以下は、サイズクラスを使った簡単な例です：

```swift
struct ContentView: View {
    @Environment(\.horizontalSizeClass) var horizontalSizeClass

    var body: some View {
        if horizontalSizeClass == .compact {
            // コンパクトな幅の場合のビュー
            VStack {
                Text("View 1")
                Text("View 2")
            }
        } else {
            // それ以外の幅の場合のビュー
            HStack {
                Text("View 1")
                Text("View 2")
            }
        }
    }
}
```

この例では、デバイスの幅がコンパクトな場合（つまりiPhoneのポートレートモードなど）、ビューは垂直スタックに配置されます。それ以外の場合（つまりiPadまたはiPhoneのランドスケープモードなど）、ビューは水平スタックに配置されます。

---

## 👤 User
*2023-05-23 11:34:55*

なるほど。

ちなみに基本縦画面で使っている画面を縦向きと横向きを動的に変えることはできるのかな？

---

## 🤖 Assistant
*2023-05-23 11:35:40*

SwiftUIでは、アプリケーションのビューが自動的にデバイスの向きの変更に対応することが前提となっています。しかし、その向きをプログラム的に制御する方法は直接提供されていません。画面の向きを制御するためのAPIはUIKitで提供されています。

具体的には、プロジェクトのInfo.plistファイルでデバイスの向き（横向きおよび縦向き）を許可し、`UIDevice`クラスを使用してプログラム的に向きを変更することができます。

ただし、このような方法は推奨されていません。これはユーザーのデバイス設定やユーザーの期待に反する可能性があるからです。また、向きを強制的に変更すると、その変更がすぐには反映されないこともあります。デバイスの向きを強制的に変更する代わりに、アプリケーションが異なる向きをサポートするようにデザインすることを強く推奨します。

アプリケーションが異なる向きをサポートするようにデザインするためには、SwiftUIの`@Environment`プロパティラッパーを使用してデバイスの向きを検出し、それに応じてUIを更新します。例えば、以下のようなコードが考えられます。

```swift
struct ContentView: View {
    @Environment(\.horizontalSizeClass) var horizontalSizeClass
    @Environment(\.verticalSizeClass) var verticalSizeClass

    var body: some View {
        Group {
            if horizontalSizeClass == .compact && verticalSizeClass == .regular {
                // 縦向きのときのビュー
                Text("Portrait")
            } else {
                // 横向きのときのビュー
                Text("Landscape")
            }
        }
    }
}
```

この方法を使用すれば、アプリのUIはデバイスの向きを自動的に認識し、適切にレイアウトを調整します。

---

## 👤 User
*2023-05-23 11:35:59*

ごめん、そういうことではなくて、ボタンを押すと横画面と縦画面が切り替わって欲しいんだ

---

## 🤖 Assistant
*2023-05-23 11:36:35*

SwiftUIでは、ビューの向きをプログラムで直接制御するAPIは提供されていません。向きの制御はUIKitの一部であり、そのためには`UIDevice`の`setValue`メソッドを使用することになります。

以下のコードは、SwiftUIとUIKitを組み合わせてボタンを押すことで画面の向きを切り替える例を示しています。

```swift
import SwiftUI
import UIKit

struct ContentView: View {
    var body: some View {
        Button(action: {
            let orientation = UIDevice.current.orientation
            switch orientation {
            case .portrait, .portraitUpsideDown:
                UIDevice.current.setValue(UIInterfaceOrientation.landscapeRight.rawValue, forKey: "orientation")
                UIViewController.attemptRotationToDeviceOrientation()
            default:
                UIDevice.current.setValue(UIInterfaceOrientation.portrait.rawValue, forKey: "orientation")
                UIViewController.attemptRotationToDeviceOrientation()
            }
        }) {
            Text("Rotate Screen")
        }
    }
}
```

この例では、`UIDevice.current.orientation`で現在のデバイスの向きを取得しています。そして、それがポートレート（縦）であればランドスケープ（横）に、それ以外であればポートレートに向きを変更しています。

ただし、この方法はUIKitの内部の詳細を使っており、Appleの公式ドキュメンテーションでは明示的にはサポートされていません。また、これはユーザーのデバイス設定やユーザーの期待を無視する可能性があるため、慎重に使用する必要があります。

最後に、画面の向きを切り替えるためには、アプリの設定（`Info.plist`ファイル）で該当する向きをサポートするように設定しておく必要があります。

---

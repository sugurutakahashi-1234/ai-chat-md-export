# 正方形アイテムを作成

Date: 2024-05-24

---

## 👤 User
*2024-05-24 11:08:08*

{
  "content_type": "image_asset_pointer",
  "asset_pointer": "file-service://file-d9AU0dCFHqLwSA9DEuFrOuCH",
  "size_bytes": 110493,
  "width": 778,
  "height": 1254,
  "fovea": null,
  "metadata": {
    "dalle": null,
    "gizmo": null,
    "generation": null,
    "container_pixel_height": null,
    "container_pixel_width": null,
    "emu_omit_glimpse_image": null,
    "emu_patches_override": null,
    "sanitized": true,
    "asset_pointer_link": null,
    "watermarked_asset_pointer": null
  }
}
あていむを正方形にしたい。デバイスサイズに合わせていい感じにしたい。
aspectRatioのモディファイアが使えるかもしれない

import SwiftUI

@MainActor
struct TalkBoxListView: View {
    @StateObject private var presenter: TalkBoxListPresenter
    private let lazyVGridColumns: [GridItem] = Array(repeating: GridItem(.flexible()), count: 2)
    
    init() {
        _presenter = .init(wrappedValue: .init())
    }

    var body: some View {
        ScrollView {
            LazyVGrid(columns: lazyVGridColumns) {
                ForEach(presenter.talkBoxes) { talkBox in
                    ZStack(alignment: .bottom) {
                        AsyncImage(url: talkBox.imageUrl) { image in
                            image
                                .resizable()
                                .scaledToFit()
                        } placeholder: {
                            ProgressView()
                        }
                        
                        Text("Order: \(talkBox.order)")
                        
                        Text("ピン留め: \(talkBox.isPinned ? "Yes" : "No")")
                    }
                    .cornerRadius(8)
                    .contextMenu {
                        Button {
                            Task {
                                await presenter.onTapStar(talkBox: talkBox)
                            }
                        } label: {
                            Label {
                                Text(talkBox.isPinned ? "お気に入りを解除" : "お気に入り")
                            } icon: {
                                (talkBox.isPinned ? SFSymbols.starSlash.image : SFSymbols.star.image)
                            }
                        }
                        
                        Divider()
                        
                        Button(role: .destructive) {
                            Task {
                                await presenter.onTapEscape(talkBox: talkBox)
                            }
                        } label: {
                            Label {
                                Text("ボックスから抜ける")
                            } icon: {
                                SFSymbols.escape.image
                            }
                        }
                    }
                }
            }
            .animation(.default, value: presenter.talkBoxes)
            .padding()
        }
        .refreshable {
            Task {
                await presenter.onRefresh()
            }
        }
        .toolbar {
            ToolbarItem(placement: .topBarTrailing) {
                Button {
                    Task {
                        await presenter.onTapPlus()
                    }
                } label: {
                    SFSymbols.plus.image
                }
            }
        }
        .navigationBarTitleDisplayMode(.inline)
        .navigationTitle("Small Talk")
        .sensoryFeedbackSuccess(trigger: presenter.shouldfeedbackSuccess)
        .task {
            await presenter.onAppear()
        }
    }
}

#Preview {
    TalkBoxListView()
        .navigationStacked()
}

private extension View {
    @ViewBuilder
    func sensoryFeedbackSuccess(trigger: Bool) -&gt; some View {
        if #available(iOS 17, *) {
            sensoryFeedback(.success, trigger: trigger)
        } else {
            self
        }
    }
}

---

## 🤖 Assistant
*2024-05-24 11:08:34*

To achieve square items that adapt to the device size, you can use the `aspectRatio` modifier along with some layout adjustments. Here's how you can modify your `TalkBoxListView` to ensure the items are square and adapt well to the device size:

```swift
import SwiftUI

@MainActor
struct TalkBoxListView: View {
    @StateObject private var presenter: TalkBoxListPresenter
    private let lazyVGridColumns: [GridItem] = Array(repeating: GridItem(.flexible()), count: 2)
    
    init() {
        _presenter = .init(wrappedValue: .init())
    }

    var body: some View {
        ScrollView {
            LazyVGrid(columns: lazyVGridColumns, spacing: 16) {
                ForEach(presenter.talkBoxes) { talkBox in
                    ZStack(alignment: .bottom) {
                        AsyncImage(url: talkBox.imageUrl) { image in
                            image
                                .resizable()
                                .scaledToFill()
                                .frame(width: 150, height: 150)
                                .clipped()
                        } placeholder: {
                            ProgressView()
                                .frame(width: 150, height: 150)
                        }
                        
                        VStack {
                            Text("Order: \(talkBox.order)")
                            Text("ピン留め: \(talkBox.isPinned ? "Yes" : "No")")
                        }
                        .padding(4)
                        .background(Color.black.opacity(0.7))
                        .cornerRadius(8)
                        .foregroundColor(.white)
                    }
                    .aspectRatio(1, contentMode: .fit)
                    .cornerRadius(8)
                    .contextMenu {
                        Button {
                            Task {
                                await presenter.onTapStar(talkBox: talkBox)
                            }
                        } label: {
                            Label {
                                Text(talkBox.isPinned ? "お気に入りを解除" : "お気に入り")
                            } icon: {
                                (talkBox.isPinned ? SFSymbols.starSlash.image : SFSymbols.star.image)
                            }
                        }
                        
                        Divider()
                        
                        Button(role: .destructive) {
                            Task {
                                await presenter.onTapEscape(talkBox: talkBox)
                            }
                        } label: {
                            Label {
                                Text("ボックスから抜ける")
                            } icon: {
                                SFSymbols.escape.image
                            }
                        }
                    }
                }
            }
            .animation(.default, value: presenter.talkBoxes)
            .padding()
        }
        .refreshable {
            Task {
                await presenter.onRefresh()
            }
        }
        .toolbar {
            ToolbarItem(placement: .topBarTrailing) {
                Button {
                    Task {
                        await presenter.onTapPlus()
                    }
                } label: {
                    SFSymbols.plus.image
                }
            }
        }
        .navigationBarTitleDisplayMode(.inline)
        .navigationTitle("Small Talk")
        .sensoryFeedbackSuccess(trigger: presenter.shouldfeedbackSuccess)
        .task {
            await presenter.onAppear()
        }
    }
}

#Preview {
    TalkBoxListView()
        .navigationStacked()
}

private extension View {
    @ViewBuilder
    func sensoryFeedbackSuccess(trigger: Bool) -> some View {
        if #available(iOS 17, *) {
            sensoryFeedback(.success, trigger: trigger)
        } else {
            self
        }
    }
}
```

In this updated code:

1. I added the `aspectRatio(1, contentMode: .fit)` modifier to ensure each item is a square.
2. Set a fixed width and height for the `AsyncImage` and `ProgressView` to ensure they fill the square space properly.
3. Added spacing between grid items for better visual separation.

This approach will create square grid items that adjust nicely to the device size, providing a consistent look across different screen sizes.

---

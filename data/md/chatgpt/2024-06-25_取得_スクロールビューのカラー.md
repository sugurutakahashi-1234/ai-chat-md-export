# å–å¾—:ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ“ãƒ¥ãƒ¼ã®ã‚«ãƒ©ãƒ¼

æ—¥ä»˜: 2024-06-25

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/6/25 9:54:13*

ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ“ãƒ¥ãƒ¼ã§ä»Šç”»é¢ã«è¡¨ç¤ºã—ã¦ã„ã‚‹ã‚«ãƒ©ãƒ¼åã‚’å–å¾—ã—ãŸã„ã€‚

public struct SimpleScrollDesignView: View {
    let items: [ScrollDesignViewItem]

    public var body: some View {
        GeometryReader { geometry in
            ScrollView(.horizontal) {
                LazyHStack(spacing: 15) {
                    ForEach(items) { item in
                        RoundedRectangle(cornerRadius: 16)
                            .fill(item.color.gradient)
                            .frame(width: geometry.size.width - 60)
                    }
                }
                .padding(.horizontal, 32)
            }
            .scrollIndicators(.hidden)
        }
        .frame(height: 100)
    }
}


struct ScrollDesignViewItem: Identifiable, Hashable {
    let id: String = UUID().uuidString
    let color: Color
}

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/6/25 9:54:37*

ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‚«ãƒ©ãƒ¼åã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ã¯ã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ“ãƒ¥ãƒ¼ã®è¡¨ç¤ºç¯„å›²ã‚’ç›£è¦–ã—ã€è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‚¢ã‚¤ãƒ†ãƒ ã‚’ç‰¹å®šã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã« `onAppear` ã¨ `onChange` ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢ã‚’ä½¿ã£ã¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’ç›£è¦–ã—ã€è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‚«ãƒ©ãƒ¼åã‚’å–å¾—ã§ãã¾ã™ã€‚

```swift
import SwiftUI

public struct SimpleScrollDesignView: View {
    let items: [ScrollDesignViewItem]

    @State private var visibleColorNames: [String] = []

    public var body: some View {
        GeometryReader { geometry in
            ScrollView(.horizontal) {
                LazyHStack(spacing: 15) {
                    ForEach(items) { item in
                        RoundedRectangle(cornerRadius: 16)
                            .fill(item.color.gradient)
                            .frame(width: geometry.size.width - 60)
                            .background(
                                GeometryReader { itemGeometry in
                                    Color.clear
                                        .preference(key: ViewOffsetKey.self, value: itemGeometry.frame(in: .global))
                                }
                            )
                    }
                }
                .padding(.horizontal, 32)
            }
            .scrollIndicators(.hidden)
            .onPreferenceChange(ViewOffsetKey.self) { preferences in
                updateVisibleColors(with: preferences, in: geometry.frame(in: .global).minX...geometry.frame(in: .global).maxX)
            }
        }
        .frame(height: 100)
        .overlay(
            Text("Visible Colors: \(visibleColorNames.joined(separator: ", "))")
                .foregroundColor(.black)
                .padding()
                .background(Color.white.opacity(0.7))
                .cornerRadius(10)
                .padding()
                , alignment: .top
        )
    }

    private func updateVisibleColors(with preferences: [CGRect], in scrollRange: ClosedRange<CGFloat>) {
        let visibleItems = items.enumerated().filter { index, _ in
            let frame = preferences[index]
            return frame.minX < scrollRange.upperBound && frame.maxX > scrollRange.lowerBound
        }
        visibleColorNames = visibleItems.map { $0.element.color.description }
    }
}

struct ScrollDesignViewItem: Identifiable, Hashable {
    let id: String = UUID().uuidString
    let color: Color
}

// Custom preference key to store frame data
struct ViewOffsetKey: PreferenceKey {
    typealias Value = [CGRect]

    static var defaultValue: [CGRect] = []

    static func reduce(value: inout [CGRect], nextValue: () -> [CGRect]) {
        value.append(contentsOf: nextValue())
    }
}
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€å„ `RoundedRectangle` ã®èƒŒæ™¯ã«é€æ˜ãª `GeometryReader` ã‚’é…ç½®ã—ã€ãã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ã‚«ã‚¹ã‚¿ãƒ  `PreferenceKey` ã‚’ä½¿ã£ã¦åé›†ã—ã¾ã™ã€‚ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ“ãƒ¥ãƒ¼ã®ä½ç½®ãŒå¤‰ã‚ã‚‹ãŸã³ã« `onPreferenceChange` ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢ã§ãƒ•ãƒ¬ãƒ¼ãƒ æƒ…å ±ãŒæ›´æ–°ã•ã‚Œã€è¡¨ç¤ºç¯„å›²ã«åŸºã¥ã„ã¦ç¾åœ¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‚«ãƒ©ãƒ¼åã‚’ç‰¹å®šã—ã¾ã™ã€‚

ã“ã®æ–¹æ³•ã«ã‚ˆã‚Šã€ç¾åœ¨ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ“ãƒ¥ãƒ¼ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‚«ãƒ©ãƒ¼åã‚’å–å¾—ã—ã€ç”»é¢ä¸Šéƒ¨ã«ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã¨ã—ã¦è¡¨ç¤ºã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/6/25 9:58:47*

ViewOffsetKey ã¨ã¯ï¼Ÿ

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/6/25 9:59:19*

`ViewOffsetKey` ã¯ã€SwiftUI ã® `PreferenceKey` ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ“ãƒ¥ãƒ¼ã®ä½ç½®æƒ…å ±ã‚’åé›†ã™ã‚‹ãŸã‚ã®ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ¼ã§ã™ã€‚ã“ã®ã‚­ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€å„ãƒ“ãƒ¥ãƒ¼ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€ãã‚Œã‚’åŸºã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ“ãƒ¥ãƒ¼ã®è¡¨ç¤ºç¯„å›²ã‚’åˆ¤æ–­ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ä»¥ä¸‹ã¯ `ViewOffsetKey` ã®å®šç¾©ã¨ãã®ä½¿ã„æ–¹ã®è©³ç´°ã§ã™ã€‚

### ViewOffsetKey ã®å®šç¾©

`ViewOffsetKey` ã¯ã€å„ãƒ“ãƒ¥ãƒ¼ã®ä½ç½®æƒ…å ±ï¼ˆãƒ•ãƒ¬ãƒ¼ãƒ ï¼‰ã‚’åé›†ã™ã‚‹ãŸã‚ã® `PreferenceKey` ã§ã™ã€‚

```swift
import SwiftUI

// Custom preference key to store frame data
struct ViewOffsetKey: PreferenceKey {
    typealias Value = [CGRect]

    // The default value for the preference
    static var defaultValue: [CGRect] = []

    // Combines a new value with the current value
    static func reduce(value: inout [CGRect], nextValue: () -> [CGRect]) {
        value.append(contentsOf: nextValue())
    }
}
```

### ä½¿ã„æ–¹ã®èª¬æ˜

1. **ã‚«ã‚¹ã‚¿ãƒ  `PreferenceKey` ã®å®šç¾©**:
    - `defaultValue`: `PreferenceKey` ãŒä¿æŒã™ã‚‹ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å€¤ã€‚ã“ã“ã§ã¯ç©ºã® `CGRect` é…åˆ—ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚
    - `reduce`: æ–°ã—ã„å€¤ã‚’æ—¢å­˜ã®å€¤ã«çµåˆã™ã‚‹ãŸã‚ã®ãƒ¡ã‚½ãƒƒãƒ‰ã€‚ã“ã“ã§ã¯æ–°ã—ã„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’æ—¢å­˜ã®é…åˆ—ã«è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚

2. **å„ãƒ“ãƒ¥ãƒ¼ã®ä½ç½®æƒ…å ±ã®åé›†**:
    - å„ `RoundedRectangle` ã«å¯¾ã—ã¦é€æ˜ãª `GeometryReader` ã‚’é…ç½®ã—ã€ãã®ãƒ•ãƒ¬ãƒ¼ãƒ æƒ…å ±ã‚’ `ViewOffsetKey` ã«æ¸¡ã—ã¾ã™ã€‚

```swift
.background(
    GeometryReader { itemGeometry in
        Color.clear
            .preference(key: ViewOffsetKey.self, value: [itemGeometry.frame(in: .global)])
    }
)
```

3. **ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ“ãƒ¥ãƒ¼ã®ä½ç½®å¤‰æ›´ã«å¿œã˜ãŸå‡¦ç†**:
    - `onPreferenceChange` ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢ã‚’ä½¿ã£ã¦ã€ãƒ•ãƒ¬ãƒ¼ãƒ æƒ…å ±ãŒå¤‰æ›´ã•ã‚ŒãŸã¨ãã« `updateVisibleColors` é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã€è¡¨ç¤ºç¯„å›²ã«åŸºã¥ã„ã¦è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‚«ãƒ©ãƒ¼åã‚’æ›´æ–°ã—ã¾ã™ã€‚

```swift
.onPreferenceChange(ViewOffsetKey.self) { preferences in
    updateVisibleColors(with: preferences, in: geometry.frame(in: .global).minX...geometry.frame(in: .global).maxX)
}
```

### å®Œå…¨ãªã‚³ãƒ¼ãƒ‰

ä»¥ä¸‹ãŒã€ä¸Šè¨˜ã®èª¬æ˜ã‚’å«ã‚€å®Œå…¨ãªã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

```swift
import SwiftUI

public struct SimpleScrollDesignView: View {
    let items: [ScrollDesignViewItem]

    @State private var visibleColorNames: [String] = []

    public var body: some View {
        GeometryReader { geometry in
            ScrollView(.horizontal) {
                LazyHStack(spacing: 15) {
                    ForEach(items) { item in
                        RoundedRectangle(cornerRadius: 16)
                            .fill(item.color.gradient)
                            .frame(width: geometry.size.width - 60)
                            .background(
                                GeometryReader { itemGeometry in
                                    Color.clear
                                        .preference(key: ViewOffsetKey.self, value: [itemGeometry.frame(in: .global)])
                                }
                            )
                    }
                }
                .padding(.horizontal, 32)
            }
            .scrollIndicators(.hidden)
            .onPreferenceChange(ViewOffsetKey.self) { preferences in
                updateVisibleColors(with: preferences, in: geometry.frame(in: .global).minX...geometry.frame(in: .global).maxX)
            }
        }
        .frame(height: 100)
        .overlay(
            Text("Visible Colors: \(visibleColorNames.joined(separator: ", "))")
                .foregroundColor(.black)
                .padding()
                .background(Color.white.opacity(0.7))
                .cornerRadius(10)
                .padding()
                , alignment: .top
        )
    }

    private func updateVisibleColors(with preferences: [CGRect], in scrollRange: ClosedRange<CGFloat>) {
        let visibleItems = items.enumerated().filter { index, _ in
            let frame = preferences[index]
            return frame.minX < scrollRange.upperBound && frame.maxX > scrollRange.lowerBound
        }
        visibleColorNames = visibleItems.map { $0.element.color.description }
    }
}

struct ScrollDesignViewItem: Identifiable, Hashable {
    let id: String = UUID().uuidString
    let color: Color
}

// Custom preference key to store frame data
struct ViewOffsetKey: PreferenceKey {
    typealias Value = [CGRect]

    static var defaultValue: [CGRect] = []

    static func reduce(value: inout [CGRect], nextValue: () -> [CGRect]) {
        value.append(contentsOf: nextValue())
    }
}
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ“ãƒ¥ãƒ¼ã®è¡¨ç¤ºç¯„å›²ã«ã‚ã‚‹ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚«ãƒ©ãƒ¼åã‚’å–å¾—ã—ã¦è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ãƒ•ãƒ«ã‚»ãƒƒãƒˆã®ä¾‹ã§ã™ã€‚

---

# ホームインジケーター判定方法

Date: 2024-08-01

---

## 👤 User
*2024-08-01 18:56:14*

ホームインジケーター あるなし 判定してSwiftUIでボトムのpaddingを調整する

---

## 🤖 Assistant
*2024-08-01 18:56:30*

ホームインジケーターの有無を判定し、SwiftUIでボトムのpaddingを調整するには、以下の手順を踏むことができます。以下はその実装例です。

1. `Device` という名前の struct を作成して、ホームインジケーターがあるかどうかを判定するメソッドを追加します。
2. SwiftUIのビューでこのメソッドを利用してpaddingを動的に調整します。

```swift
import SwiftUI

struct Device {
    static var hasHomeIndicator: Bool {
        if let window = UIApplication.shared.windows.first {
            return window.safeAreaInsets.bottom > 0
        }
        return false
    }
}

struct ContentView: View {
    var body: some View {
        VStack {
            Text("Hello, World!")
            Spacer()
        }
        .padding(.bottom, Device.hasHomeIndicator ? 34 : 0) // Adjust bottom padding based on home indicator presence
    }
}

@main
struct YourApp: App {
    var body: some Scene {
        WindowGroup {
            ContentView()
        }
    }
}
```

### 解説

1. `Device` struct:
    - `hasHomeIndicator` プロパティは、`UIApplication` の `windows` の最初のウィンドウを取得し、その `safeAreaInsets.bottom` が0より大きいかどうかをチェックすることで、ホームインジケーターの有無を判定します。

2. `ContentView`:
    - `VStack`の`padding`を動的に調整するために、`Device.hasHomeIndicator`を使ってボトムのパディングを設定します。ホームインジケーターがある場合は34ポイント、ない場合は0ポイントを指定しています。

この方法で、デバイスにホームインジケーターがあるかどうかに基づいて、SwiftUIビューのボトムパディングを適切に調整することができます。

---

## 👤 User
*2024-08-01 18:57:14*

もっと公式のAPIなどはないのか？

---

## 🤖 Assistant
*2024-08-01 18:57:31*

ホームインジケーターの有無を判定するための公式なAPIとして、`UIView`の`safeAreaInsets`を使用することができます。SwiftUIのビューにおいても、この情報を利用してボトムのパディングを調整することができます。

以下は、`GeometryReader`を使用して安全な領域（safe area）を取得し、それに基づいてパディングを調整する例です。

```swift
import SwiftUI

struct ContentView: View {
    var body: some View {
        GeometryReader { geometry in
            VStack {
                Text("Hello, World!")
                Spacer()
            }
            .padding(.bottom, geometry.safeAreaInsets.bottom > 0 ? 34 : 0)
            .edgesIgnoringSafeArea(.bottom) // Ensure the view extends to the bottom edge
        }
    }
}

@main
struct YourApp: App {
    var body: some Scene {
        WindowGroup {
            ContentView()
        }
    }
}
```

### 解説

1. `GeometryReader`を使用して、ビューの安全な領域（safe area）を取得します。
2. `geometry.safeAreaInsets.bottom`を使用して、ボトムのインセットが0より大きいかどうかを確認します。これにより、ホームインジケーターの有無を判定できます。
3. `padding(.bottom, geometry.safeAreaInsets.bottom > 0 ? 34 : 0)` で、ボトムのパディングを調整します。
4. `edgesIgnoringSafeArea(.bottom)` を追加して、ビューがボトムエッジまで拡張されるようにします。

この方法は、SwiftUIの公式APIを利用してホームインジケーターの有無を判定し、ビューのパディングを動的に調整するための標準的なアプローチです。

---

## 👤 User
*2024-08-01 19:03:56*

UIApplication の extensionにはできないの？

struct Device {
    @MainActor
    static var hasHomeIndicator: Bool {
        let scenes = UIApplication.shared.connectedScenes
        let windowScenes = scenes.first as? UIWindowScene
        if let window = windowScenes?.windows.first {
            return window.safeAreaInsets.bottom &gt; 0
        }
        return false
    }
}

---

## 🤖 Assistant
*2024-08-01 19:04:16*

もちろん、`UIApplication`のextensionとして実装することが可能です。以下は、`UIApplication`に`hasHomeIndicator`プロパティを追加し、SwiftUIでそのプロパティを使用してボトムのパディングを調整する方法です。

### `UIApplication`のExtensionの実装

```swift
import SwiftUI

extension UIApplication {
    @MainActor
    var hasHomeIndicator: Bool {
        guard let windowScene = connectedScenes.first as? UIWindowScene,
              let window = windowScene.windows.first else {
            return false
        }
        return window.safeAreaInsets.bottom > 0
    }
}

struct ContentView: View {
    @State private var hasHomeIndicator: Bool = false

    var body: some View {
        VStack {
            Text("Hello, World!")
            Spacer()
        }
        .padding(.bottom, hasHomeIndicator ? 34 : 0)
        .edgesIgnoringSafeArea(.bottom)
        .onAppear {
            hasHomeIndicator = UIApplication.shared.hasHomeIndicator
        }
    }
}

@main
struct YourApp: App {
    var body: some Scene {
        WindowGroup {
            ContentView()
        }
    }
}
```

### 解説

1. **`UIApplication`のExtension**:
    - `hasHomeIndicator`プロパティを`UIApplication`のextensionとして定義します。`connectedScenes`から`UIWindowScene`を取得し、その最初のウィンドウの`safeAreaInsets.bottom`を確認します。

2. **SwiftUIのView**:
    - `ContentView`内で`@State`変数として`hasHomeIndicator`を定義します。
    - `onAppear`モディファイア内で`UIApplication.shared.hasHomeIndicator`を呼び出して`hasHomeIndicator`の値を設定します。
    - この`hasHomeIndicator`変数を使って、`padding(.bottom, hasHomeIndicator ? 34 : 0)`でボトムのパディングを動的に調整します。

この方法により、`UIApplication`のextensionとしてホームインジケーターの有無を判定し、SwiftUIのビューでそれを利用してパディングを調整することができます。

---

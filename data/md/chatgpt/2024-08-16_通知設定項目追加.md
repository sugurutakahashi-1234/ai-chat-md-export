# 通知設定項目追加

日付: 2024-08-16

---

## 👤 ユーザー
*2024/08/16 18:17:48*

新着投稿 のみ実装したが同様に他の設定項目も追加してほしい

// MARK: - View

public struct NotificationSettingView: View {
    @StateObject private var presenter: NotificationSettingPresenter

    public init() {
        _presenter = .init(wrappedValue: NotificationSettingPresenter())
    }

    public var body: some View {
        List {
            VStack(alignment: .leading) {
                Toggle(isOn: $presenter.isEnableNewPost) {
                    Text("新規投稿")
                }
                .padding(.bottom, 4)
                Text("同じボックスの参加者が新規投稿をした際に通知されます")
                    .font(.callout)
                    .foregroundStyle(.secondary)
            }
        }
        .navigationTitle("通知設定")
        .task {
            await presenter.onAppear()
        }
        .onDisappear {
            presenter.onDisappear()
        }
    }
}

#Preview {
    NotificationSettingView()
}

@MainActor
final class NotificationSettingPresenter: ObservableObject {
    @Published var isEnableNewPost: Bool = true
    
    private let logDriver: any LogDriverProtocol

    init(logDriver: any LogDriverProtocol = LogDriver()) {
        self.logDriver = logDriver

        logDriver.initLog()
    }

    deinit {
        logDriver.deinitLog()
    }

    func onAppear() async {
        logDriver.onAppearLog()
    }

    func onDisappear() {
        logDriver.onDisappearLog()
    }
}


- 新着投稿
    - 同じボックスの参加者が新規投稿をした際に通知されます
- 音声リプライ
    - 音声コメントがあった場合に通知されます
- リアクション
    - スタンプのリアクションがあった場合に通知されます
- ボックス参加/退出
    - ボックスへの参加/退出があった場合に通知されます
- 誕生日通知
    - ボックス参加者の誕生日に通知されます
- 運営からお知らせ
    - dayから新機能などに関するお知らせが通知されます

---

## 🤖 アシスタント
*2024/08/16 18:18:15*

User is working on implementing notification settings for various types, including "新着投稿", "音声リプライ", "リアクション", "ボックス参加/退出", "誕生日通知", and "運営からお知らせ" in a SwiftUI view.

---

## 🔧 ツール
*2024/08/16 18:18:15*

Model set context updated.

---

## 🤖 アシスタント
*2024/08/16 18:18:15*

Here’s how you can extend your `NotificationSettingView` to include the additional notification settings:

```swift
// MARK: - View

public struct NotificationSettingView: View {
    @StateObject private var presenter: NotificationSettingPresenter

    public init() {
        _presenter = .init(wrappedValue: NotificationSettingPresenter())
    }

    public var body: some View {
        List {
            notificationToggleSection(
                isOn: $presenter.isEnableNewPost,
                title: "新着投稿",
                description: "同じボックスの参加者が新規投稿をした際に通知されます"
            )
            
            notificationToggleSection(
                isOn: $presenter.isEnableVoiceReply,
                title: "音声リプライ",
                description: "音声コメントがあった場合に通知されます"
            )

            notificationToggleSection(
                isOn: $presenter.isEnableReaction,
                title: "リアクション",
                description: "スタンプのリアクションがあった場合に通知されます"
            )

            notificationToggleSection(
                isOn: $presenter.isEnableJoinLeave,
                title: "ボックス参加/退出",
                description: "ボックスへの参加/退出があった場合に通知されます"
            )

            notificationToggleSection(
                isOn: $presenter.isEnableBirthday,
                title: "誕生日通知",
                description: "ボックス参加者の誕生日に通知されます"
            )

            notificationToggleSection(
                isOn: $presenter.isEnableAdminNotice,
                title: "運営からお知らせ",
                description: "dayから新機能などに関するお知らせが通知されます"
            )
        }
        .navigationTitle("通知設定")
        .task {
            await presenter.onAppear()
        }
        .onDisappear {
            presenter.onDisappear()
        }
    }

    private func notificationToggleSection(isOn: Binding<Bool>, title: String, description: String) -> some View {
        VStack(alignment: .leading) {
            Toggle(isOn: isOn) {
                Text(title)
            }
            .padding(.bottom, 4)
            Text(description)
                .font(.callout)
                .foregroundStyle(.secondary)
        }
    }
}

// MARK: - Presenter

@MainActor
final class NotificationSettingPresenter: ObservableObject {
    @Published var isEnableNewPost: Bool = true
    @Published var isEnableVoiceReply: Bool = true
    @Published var isEnableReaction: Bool = true
    @Published var isEnableJoinLeave: Bool = true
    @Published var isEnableBirthday: Bool = true
    @Published var isEnableAdminNotice: Bool = true
    
    private let logDriver: any LogDriverProtocol

    init(logDriver: any LogDriverProtocol = LogDriver()) {
        self.logDriver = logDriver

        logDriver.initLog()
    }

    deinit {
        logDriver.deinitLog()
    }

    func onAppear() async {
        logDriver.onAppearLog()
    }

    func onDisappear() {
        logDriver.onDisappearLog()
    }
}

#Preview {
    NotificationSettingView()
}
```

This code adds the additional notification settings by creating a reusable `notificationToggleSection` function that handles the toggle and description text for each setting. The `NotificationSettingPresenter` is extended to include the properties for each notification type.

---

## 👤 ユーザー
*2024/08/16 18:18:29*

notificationToggleSection は struct View にしてほしい。

---

## 🤖 アシスタント
*2024/08/16 18:18:39*

Here’s how you can refactor the `notificationToggleSection` into a separate `NotificationToggleSectionView` struct:

```swift
// MARK: - View

public struct NotificationSettingView: View {
    @StateObject private var presenter: NotificationSettingPresenter

    public init() {
        _presenter = .init(wrappedValue: NotificationSettingPresenter())
    }

    public var body: some View {
        List {
            NotificationToggleSectionView(
                isOn: $presenter.isEnableNewPost,
                title: "新着投稿",
                description: "同じボックスの参加者が新規投稿をした際に通知されます"
            )
            
            NotificationToggleSectionView(
                isOn: $presenter.isEnableVoiceReply,
                title: "音声リプライ",
                description: "音声コメントがあった場合に通知されます"
            )

            NotificationToggleSectionView(
                isOn: $presenter.isEnableReaction,
                title: "リアクション",
                description: "スタンプのリアクションがあった場合に通知されます"
            )

            NotificationToggleSectionView(
                isOn: $presenter.isEnableJoinLeave,
                title: "ボックス参加/退出",
                description: "ボックスへの参加/退出があった場合に通知されます"
            )

            NotificationToggleSectionView(
                isOn: $presenter.isEnableBirthday,
                title: "誕生日通知",
                description: "ボックス参加者の誕生日に通知されます"
            )

            NotificationToggleSectionView(
                isOn: $presenter.isEnableAdminNotice,
                title: "運営からお知らせ",
                description: "dayから新機能などに関するお知らせが通知されます"
            )
        }
        .navigationTitle("通知設定")
        .task {
            await presenter.onAppear()
        }
        .onDisappear {
            presenter.onDisappear()
        }
    }
}

// MARK: - Notification Toggle Section View

struct NotificationToggleSectionView: View {
    @Binding var isOn: Bool
    let title: String
    let description: String

    var body: some View {
        VStack(alignment: .leading) {
            Toggle(isOn: $isOn) {
                Text(title)
            }
            .padding(.bottom, 4)
            Text(description)
                .font(.callout)
                .foregroundStyle(.secondary)
        }
    }
}

// MARK: - Presenter

@MainActor
final class NotificationSettingPresenter: ObservableObject {
    @Published var isEnableNewPost: Bool = true
    @Published var isEnableVoiceReply: Bool = true
    @Published var isEnableReaction: Bool = true
    @Published var isEnableJoinLeave: Bool = true
    @Published var isEnableBirthday: Bool = true
    @Published var isEnableAdminNotice: Bool = true
    
    private let logDriver: any LogDriverProtocol

    init(logDriver: any LogDriverProtocol = LogDriver()) {
        self.logDriver = logDriver

        logDriver.initLog()
    }

    deinit {
        logDriver.deinitLog()
    }

    func onAppear() async {
        logDriver.onAppearLog()
    }

    func onDisappear() {
        logDriver.onDisappearLog()
    }
}

#Preview {
    NotificationSettingView()
}
```

In this refactored code:

- The `NotificationToggleSectionView` struct is created to encapsulate the toggle and description for each notification setting.
- The `NotificationSettingView` uses instances of `NotificationToggleSectionView` for each setting.

---

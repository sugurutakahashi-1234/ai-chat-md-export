# åˆ‡ã‚Šæ›¿ãˆãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…

æ—¥ä»˜: 2024-05-30

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/5/30 14:16:07*

ã“ã®Viewã«ã¤ã„ã¦selectedApiã«ã‚ˆã£ã¦ResponseViewã‚„PropertyViewã®objectsã®å¼•æ•°ã«ä½¿ã†å€¤ã‚’å…¥ã‚Œæ›¿ãˆãŸã„

import SwiftUI
import OpenAPIURLSession
import SimpleToast
import Shimmer

enum ApiType: CaseIterable {
    case getUsers
    case getUser
}

enum ApiError: LocalizedError {
    case notFound
    case undocumented
    
    // alert title
    var errorDescription: String? {
        "\\(self)"
    }
}

public struct ContentView: View {
    @State var showToast: Bool = false
    @State var getUsersResponse: \[Components.Schemas.User\] = \[\]
    @State var getUserByIdResponse: \[Components.Schemas.User\] = \[\]
    @State var userId: Int = 1
    @State var selectedApi: ApiType = .getUser
    @State var isLoading: Bool = false
    @State var showAlert: Bool = false
    @State var apiError: ApiError?
    let client: Client

    public init() {
        self.client = Client(
            serverURL: try! Servers.server1(),
            transport: URLSessionTransport()
        )
    }

    public var body: some View {
        NavigationStack {
            List {
                Picker("API", selection: $selectedApi) {
                    Text("getUsers")
                        .tag(ApiType.getUsers)
                    Text("getUser").tag(ApiType.getUser)
                }
                .pickerStyle(.navigationLink)

                if selectedApi == .getUser {
                    TextField("User id", value: $userId, format: .number)
                }

                Button {
                    Task {
                        await executeSelectedAPI()
                    }
                } label: {
                    Text("Execute")
                }
    
                ResponseView(objects: getUserByIdResponse)
                    .redacted(reason: isLoading ? .placeholder : \[\])
                    .shimmering(active: isLoading)

                PropertyView(showToast: $showToast, objects: getUserByIdResponse)
                    .redacted(reason: isLoading ? .placeholder : \[\])
                    .shimmering(active: isLoading)
            }
            .simpleToast(isPresented: $showToast, options: SimpleToastOptions(
                alignment: .bottom,
                hideAfter: 1
            )) {
                Label {
                    Text("Copy")
                } icon: {
                    Image(systemName: "checkmark.circle")
                }
                .padding()
                .background(Color.green.opacity(0.8))
                .foregroundColor(Color.white)
                .cornerRadius(12)
                .padding(.top)
            }
        }
        .alert(isPresented: $showAlert, error: apiError) { 
            Button("OK") {}
        }
    }
    
    func executeSelectedAPI() async {
        switch selectedApi {
        case .getUsers:
            await getUsers()
        case .getUser:
            await getUserById(id: userId)
        }
    }

    private func getUsers() async {
        isLoading = true
        defer {
            isLoading = false
        }
        
        let response = try! await client.getUsers()
        
        switch response {
        case .ok(let okResponse):
            switch okResponse.body {
            case .json(let users):
                self.getUsersResponse = users
            }
        case .notFound(let notFoundResponse):
            switch notFoundResponse.body {
            case .json(let error):
                print("\\(error)")
                apiError = .notFound
                showAlert = true
            }
        case .undocumented(statusCode: let statusCode, \_):
            print("\\(statusCode)")
            apiError = .undocumented
            showAlert = true
        }
    }

    private func getUserById(id: Int) async {
        isLoading = true
        defer {
            isLoading = false
        }

        let response = try! await client.getUserById(path: .init(id: id))

        switch response {
        case .ok(let okResponse):
            switch okResponse.body {
            case .json(let user):
                self.getUserByIdResponse = \[user\]
            }
        case .notFound(let notFoundResponse):
            switch notFoundResponse.body {
            case .json(let error):
                print("\\(error)")
                apiError = .notFound
                showAlert = true
            }
        case .undocumented(statusCode: let statusCode, \_):
            print("\\(statusCode)")
            apiError = .undocumented
            showAlert = true
        }
    }
}

#Preview {
    ContentView()
}

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/5/30 14:16:31*

`ResponseView`ã¨`PropertyView`ã®`objects`å¼•æ•°ã«ä½¿ç”¨ã™ã‚‹å€¤ã‚’`selectedApi`ã«ã‚ˆã£ã¦åˆ‡ã‚Šæ›¿ãˆã‚‹ãŸã‚ã«ã€`selectedApi`ã®çŠ¶æ…‹ã«å¿œã˜ã¦é©åˆ‡ãªå€¤ã‚’æ¸¡ã™ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã§ãã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã™ã‚‹ã“ã¨ã§ã€ãã‚Œãã‚Œã®ãƒ“ãƒ¥ãƒ¼ã«æ¸¡ã™ãƒ‡ãƒ¼ã‚¿ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```swift
import SwiftUI
import OpenAPIURLSession
import SimpleToast
import Shimmer

enum ApiType: CaseIterable {
    case getUsers
    case getUser
}

enum ApiError: LocalizedError {
    case notFound
    case undocumented
    
    // alert title
    var errorDescription: String? {
        "\(self)"
    }
}

public struct ContentView: View {
    @State var showToast: Bool = false
    @State var getUsersResponse: [Components.Schemas.User] = []
    @State var getUserByIdResponse: [Components.Schemas.User] = []
    @State var userId: Int = 1
    @State var selectedApi: ApiType = .getUser
    @State var isLoading: Bool = false
    @State var showAlert: Bool = false
    @State var apiError: ApiError?
    let client: Client

    public init() {
        self.client = Client(
            serverURL: try! Servers.server1(),
            transport: URLSessionTransport()
        )
    }

    public var body: some View {
        NavigationStack {
            List {
                Picker("API", selection: $selectedApi) {
                    Text("getUsers").tag(ApiType.getUsers)
                    Text("getUser").tag(ApiType.getUser)
                }
                .pickerStyle(.navigationLink)

                if selectedApi == .getUser {
                    TextField("User id", value: $userId, format: .number)
                }

                Button {
                    Task {
                        await executeSelectedAPI()
                    }
                } label: {
                    Text("Execute")
                }

                let responseObjects: [Components.Schemas.User] = selectedApi == .getUsers ? getUsersResponse : getUserByIdResponse
                
                ResponseView(objects: responseObjects)
                    .redacted(reason: isLoading ? .placeholder : [])
                    .shimmering(active: isLoading)

                PropertyView(showToast: $showToast, objects: responseObjects)
                    .redacted(reason: isLoading ? .placeholder : [])
                    .shimmering(active: isLoading)
            }
            .simpleToast(isPresented: $showToast, options: SimpleToastOptions(
                alignment: .bottom,
                hideAfter: 1
            )) {
                Label {
                    Text("Copy")
                } icon: {
                    Image(systemName: "checkmark.circle")
                }
                .padding()
                .background(Color.green.opacity(0.8))
                .foregroundColor(Color.white)
                .cornerRadius(12)
                .padding(.top)
            }
        }
        .alert(isPresented: $showAlert, error: apiError) { 
            Button("OK") {}
        }
    }

    func executeSelectedAPI() async {
        switch selectedApi {
        case .getUsers:
            await getUsers()
        case .getUser:
            await getUserById(id: userId)
        }
    }

    private func getUsers() async {
        isLoading = true
        defer {
            isLoading = false
        }
        
        let response = try! await client.getUsers()
        
        switch response {
        case .ok(let okResponse):
            switch okResponse.body {
            case .json(let users):
                self.getUsersResponse = users
            }
        case .notFound(let notFoundResponse):
            switch notFoundResponse.body {
            case .json(let error):
                print("\(error)")
                apiError = .notFound
                showAlert = true
            }
        case .undocumented(statusCode: let statusCode, _):
            print("\(statusCode)")
            apiError = .undocumented
            showAlert = true
        }
    }

    private func getUserById(id: Int) async {
        isLoading = true
        defer {
            isLoading = false
        }

        let response = try! await client.getUserById(path: .init(id: id))

        switch response {
        case .ok(let okResponse):
            switch okResponse.body {
            case .json(let user):
                self.getUserByIdResponse = [user]
            }
        case .notFound(let notFoundResponse):
            switch notFoundResponse.body {
            case .json(let error):
                print("\(error)")
                apiError = .notFound
                showAlert = true
            }
        case .undocumented(statusCode: let statusCode, _):
            print("\(statusCode)")
            apiError = .undocumented
            showAlert = true
        }
    }
}

#Preview {
    ContentView()
}
```

ã“ã®ä¿®æ­£ã§ã¯ã€`selectedApi`ã«åŸºã¥ã„ã¦`responseObjects`ã‚’æ±ºå®šã—ã€ãã‚Œã‚’`ResponseView`ã¨`PropertyView`ã«æ¸¡ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€APIã®é¸æŠã«å¿œã˜ã¦é©åˆ‡ãªãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/5/30 14:17:18*

ã‚‚ã£ã¨APIãŒå¢—ãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§switchæ–‡ã§è¨˜è¿°ã—ã¦ã»ã—ã„

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/5/30 14:17:49*

å°†æ¥çš„ã«APIãŒå¢—ãˆã‚‹å¯èƒ½æ€§ã‚’è€ƒæ…®ã—ã€`switch`æ–‡ã‚’ä½¿ç”¨ã—ã¦`ResponseView`ã¨`PropertyView`ã®`objects`å¼•æ•°ã«æ¸¡ã™ãƒ‡ãƒ¼ã‚¿ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹å®Ÿè£…ã«å¤‰æ›´ã—ã¾ã™ã€‚

```swift
import SwiftUI
import OpenAPIURLSession
import SimpleToast
import Shimmer

enum ApiType: CaseIterable {
    case getUsers
    case getUser
}

enum ApiError: LocalizedError {
    case notFound
    case undocumented
    
    // alert title
    var errorDescription: String? {
        "\(self)"
    }
}

public struct ContentView: View {
    @State var showToast: Bool = false
    @State var getUsersResponse: [Components.Schemas.User] = []
    @State var getUserByIdResponse: [Components.Schemas.User] = []
    @State var userId: Int = 1
    @State var selectedApi: ApiType = .getUser
    @State var isLoading: Bool = false
    @State var showAlert: Bool = false
    @State var apiError: ApiError?
    let client: Client

    public init() {
        self.client = Client(
            serverURL: try! Servers.server1(),
            transport: URLSessionTransport()
        )
    }

    public var body: some View {
        NavigationStack {
            List {
                Picker("API", selection: $selectedApi) {
                    Text("getUsers").tag(ApiType.getUsers)
                    Text("getUser").tag(ApiType.getUser)
                }
                .pickerStyle(.navigationLink)

                if selectedApi == .getUser {
                    TextField("User id", value: $userId, format: .number)
                }

                Button {
                    Task {
                        await executeSelectedAPI()
                    }
                } label: {
                    Text("Execute")
                }

                let responseObjects: [Components.Schemas.User]
                switch selectedApi {
                case .getUsers:
                    responseObjects = getUsersResponse
                case .getUser:
                    responseObjects = getUserByIdResponse
                }

                ResponseView(objects: responseObjects)
                    .redacted(reason: isLoading ? .placeholder : [])
                    .shimmering(active: isLoading)

                PropertyView(showToast: $showToast, objects: responseObjects)
                    .redacted(reason: isLoading ? .placeholder : [])
                    .shimmering(active: isLoading)
            }
            .simpleToast(isPresented: $showToast, options: SimpleToastOptions(
                alignment: .bottom,
                hideAfter: 1
            )) {
                Label {
                    Text("Copy")
                } icon: {
                    Image(systemName: "checkmark.circle")
                }
                .padding()
                .background(Color.green.opacity(0.8))
                .foregroundColor(Color.white)
                .cornerRadius(12)
                .padding(.top)
            }
        }
        .alert(isPresented: $showAlert, error: apiError) { 
            Button("OK") {}
        }
    }

    func executeSelectedAPI() async {
        switch selectedApi {
        case .getUsers:
            await getUsers()
        case .getUser:
            await getUserById(id: userId)
        }
    }

    private func getUsers() async {
        isLoading = true
        defer {
            isLoading = false
        }
        
        let response = try! await client.getUsers()
        
        switch response {
        case .ok(let okResponse):
            switch okResponse.body {
            case .json(let users):
                self.getUsersResponse = users
            }
        case .notFound(let notFoundResponse):
            switch notFoundResponse.body {
            case .json(let error):
                print("\(error)")
                apiError = .notFound
                showAlert = true
            }
        case .undocumented(statusCode: let statusCode, _):
            print("\(statusCode)")
            apiError = .undocumented
            showAlert = true
        }
    }

    private func getUserById(id: Int) async {
        isLoading = true
        defer {
            isLoading = false
        }

        let response = try! await client.getUserById(path: .init(id: id))

        switch response {
        case .ok(let okResponse):
            switch okResponse.body {
            case .json(let user):
                self.getUserByIdResponse = [user]
            }
        case .notFound(let notFoundResponse):
            switch notFoundResponse.body {
            case .json(let error):
                print("\(error)")
                apiError = .notFound
                showAlert = true
            }
        case .undocumented(statusCode: let statusCode, _):
            print("\(statusCode)")
            apiError = .undocumented
            showAlert = true
        }
    }
}

#Preview {
    ContentView()
}
```

ã“ã®ä¿®æ­£ã«ã‚ˆã‚Šã€`selectedApi`ã®å€¤ã«åŸºã¥ã„ã¦`switch`æ–‡ã‚’ä½¿ç”¨ã—ã¦é©åˆ‡ãª`responseObjects`ã‚’é¸æŠã—ã€ãã‚Œã‚’`ResponseView`ãŠã‚ˆã³`PropertyView`ã«æ¸¡ã™ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å°†æ¥çš„ã«APIãŒå¢—ãˆã¦ã‚‚ã€åŒæ§˜ã®æ–¹æ³•ã§ç°¡å˜ã«å¯¾å¿œã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/5/30 14:39:13*

Viewå†…ã®ã‚³ãƒ¼ãƒ‰ã«ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å«ã‚ãŸããªã„

                let responseObjects: \[Components.Schemas.User\]
                switch selectedApi {
                case .getUsers:
                    responseObjects = getUsersResponse
                case .getUser:
                    responseObjects = getUserByIdResponse
                }

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/5/30 14:39:47*

ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’Viewã‹ã‚‰åˆ†é›¢ã™ã‚‹ãŸã‚ã«ã€ViewModelã‚’ä½¿ç”¨ã—ã¦ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç®¡ç†ã™ã‚‹æ–¹æ³•ã‚’å®Ÿè£…ã—ã¾ã™ã€‚ViewModelã‚’å°å…¥ã—ã€APIã®é¸æŠã«å¿œã˜ã¦é©åˆ‡ãªãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚

ä»¥ä¸‹ã¯ãã®å®Ÿè£…ä¾‹ã§ã™ã€‚

```swift
import SwiftUI
import OpenAPIURLSession
import SimpleToast
import Shimmer

enum ApiType: CaseIterable {
    case getUsers
    case getUser
}

enum ApiError: LocalizedError {
    case notFound
    case undocumented
    
    // alert title
    var errorDescription: String? {
        "\(self)"
    }
}

class ContentViewModel: ObservableObject {
    @Published var showToast: Bool = false
    @Published var getUsersResponse: [Components.Schemas.User] = []
    @Published var getUserByIdResponse: [Components.Schemas.User] = []
    @Published var userId: Int = 1
    @Published var selectedApi: ApiType = .getUser
    @Published var isLoading: Bool = false
    @Published var showAlert: Bool = false
    @Published var apiError: ApiError?
    
    let client: Client

    init() {
        self.client = Client(
            serverURL: try! Servers.server1(),
            transport: URLSessionTransport()
        )
    }
    
    var responseObjects: [Components.Schemas.User] {
        switch selectedApi {
        case .getUsers:
            return getUsersResponse
        case .getUser:
            return getUserByIdResponse
        }
    }

    func executeSelectedAPI() async {
        switch selectedApi {
        case .getUsers:
            await getUsers()
        case .getUser:
            await getUserById(id: userId)
        }
    }

    private func getUsers() async {
        isLoading = true
        defer {
            isLoading = false
        }
        
        let response = try! await client.getUsers()
        
        switch response {
        case .ok(let okResponse):
            switch okResponse.body {
            case .json(let users):
                self.getUsersResponse = users
            }
        case .notFound(let notFoundResponse):
            switch notFoundResponse.body {
            case .json(let error):
                print("\(error)")
                apiError = .notFound
                showAlert = true
            }
        case .undocumented(statusCode: let statusCode, _):
            print("\(statusCode)")
            apiError = .undocumented
            showAlert = true
        }
    }

    private func getUserById(id: Int) async {
        isLoading = true
        defer {
            isLoading = false
        }

        let response = try! await client.getUserById(path: .init(id: id))

        switch response {
        case .ok(let okResponse):
            switch okResponse.body {
            case .json(let user):
                self.getUserByIdResponse = [user]
            }
        case .notFound(let notFoundResponse):
            switch notFoundResponse.body {
            case .json(let error):
                print("\(error)")
                apiError = .notFound
                showAlert = true
            }
        case .undocumented(statusCode: let statusCode, _):
            print("\(statusCode)")
            apiError = .undocumented
            showAlert = true
        }
    }
}

public struct ContentView: View {
    @StateObject private var viewModel = ContentViewModel()

    public var body: some View {
        NavigationStack {
            List {
                Picker("API", selection: $viewModel.selectedApi) {
                    Text("getUsers").tag(ApiType.getUsers)
                    Text("getUser").tag(ApiType.getUser)
                }
                .pickerStyle(.navigationLink)

                if viewModel.selectedApi == .getUser {
                    TextField("User id", value: $viewModel.userId, format: .number)
                }

                Button {
                    Task {
                        await viewModel.executeSelectedAPI()
                    }
                } label: {
                    Text("Execute")
                }

                ResponseView(objects: viewModel.responseObjects)
                    .redacted(reason: viewModel.isLoading ? .placeholder : [])
                    .shimmering(active: viewModel.isLoading)

                PropertyView(showToast: $viewModel.showToast, objects: viewModel.responseObjects)
                    .redacted(reason: viewModel.isLoading ? .placeholder : [])
                    .shimmering(active: viewModel.isLoading)
            }
            .simpleToast(isPresented: $viewModel.showToast, options: SimpleToastOptions(
                alignment: .bottom,
                hideAfter: 1
            )) {
                Label {
                    Text("Copy")
                } icon: {
                    Image(systemName: "checkmark.circle")
                }
                .padding()
                .background(Color.green.opacity(0.8))
                .foregroundColor(Color.white)
                .cornerRadius(12)
                .padding(.top)
            }
        }
        .alert(isPresented: $viewModel.showAlert, error: viewModel.apiError) { 
            Button("OK") {}
        }
    }
}

#Preview {
    ContentView()
}
```

ã“ã®å®Ÿè£…ã§ã¯ã€`ContentViewModel`ã‚’å°å…¥ã—ã€ã™ã¹ã¦ã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ViewModelå†…ã«ç§»å‹•ã—ã¾ã—ãŸã€‚Viewå´ã§ã¯ViewModelã‚’ä½¿ç”¨ã—ã¦çŠ¶æ…‹ã‚’ç®¡ç†ã—ã€UIã‚’æ›´æ–°ã™ã‚‹ã ã‘ã«ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚³ãƒ¼ãƒ‰ã®è²¬ä»»ç¯„å›²ãŒæ˜ç¢ºã«ãªã‚Šã€ãƒ†ã‚¹ãƒˆã‚„ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚

---

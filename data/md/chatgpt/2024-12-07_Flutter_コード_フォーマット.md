# Flutter コード フォーマット

Date: 2024-12-07

---

## 👤 User
*2024-12-07 19:07:34*

flutterでフォーマッタを適応してコードを修正したい
コマンドってあるの？

---

## 🤖 Assistant
*2024-12-07 19:07:43*

はい、Flutterにはコードのフォーマッタが組み込まれており、以下のコマンドを使用してコードをフォーマットできます。

### 1. プロジェクト全体のコードをフォーマットする場合
```bash
flutter format .
```
このコマンドを実行すると、プロジェクト内のすべてのDartファイルがフォーマットされます。

### 2. 特定のファイルのみをフォーマットする場合
```bash
flutter format path/to/your/file.dart
```
`path/to/your/file.dart` の部分をフォーマットしたいDartファイルのパスに置き換えてください。

### 3. フォーマット結果を確認するだけの場合
`--dry-run` オプションを使用すると、フォーマットの影響を確認するだけで、実際の変更は行いません。
```bash
flutter format --dry-run .
```

### 注意事項
- **標準のDartスタイルガイド**に従ってフォーマットされます。
- フォーマットは不可逆なので、コミット前に実行するのが一般的です。
- 必要に応じて、フォーマットを自動化するために、`pre-commit` フックにフォーマッタを設定することも可能です。

### VSCodeや他のエディタで自動フォーマット
もしIDE（例えばVSCode）を使用している場合、保存時に自動フォーマットを有効にすることができます。

1. **VSCodeの場合**:
   - `settings.json`に以下を追加:
     ```json
     "editor.formatOnSave": true
     ```

これで、コードフォーマットを簡単に適用できます。

---

## 👤 User
*2024-12-07 19:08:05*

除外したいファイルなどを指定したい

---

## 🤖 Assistant
*2024-12-07 19:08:18*

`flutter format` コマンドで特定のファイルやフォルダをフォーマット対象から除外する方法は直接サポートされていませんが、以下の方法で対応できます。

---

### 1. **特定のファイルやフォルダを手動で除外**
特定のフォルダやファイルをフォーマットしないようにするには、フォーマット対象を明示的に指定します。

```bash
flutter format $(find . -name "*.dart" ! -path "./lib/generated/*")
```

上記のコマンドでは、`find` コマンドを使用して `./lib/generated/` 以下の `.dart` ファイルを除外しています。  
必要に応じて、`! -path` を使って複数のパスを除外できます。

---

### 2. **除外ファイルリストを使う**
除外したいファイルやフォルダのリストを作成し、それを利用してフォーマット対象を制御するスクリプトを用意します。

#### ステップ1: 除外リストを `.format-ignore` ファイルとして定義
例えば、プロジェクトのルートに `.format-ignore` ファイルを作成して以下のように記述します。

```
lib/generated/
lib/some_file.dart
```

#### ステップ2: 除外リストを使ったスクリプトを実行
以下のようなシェルスクリプトを作成して、除外リストに従ってフォーマットを実行します。

```bash
#!/bin/bash

# 除外リストを読み込み
IGNORE_LIST=$(cat .format-ignore | sed 's/^/! -path /' | tr '\n' ' ')

# 対象ファイルを抽出してフォーマット
eval "flutter format \$(find . -name '*.dart' $IGNORE_LIST)"
```

スクリプトに実行権限を与えて実行します。

```bash
chmod +x format.sh
./format.sh
```

---

### 3. **フォーマット対象を個別に指定する**
特定のファイルやディレクトリのみを明示的に指定してフォーマットを実行する方法です。

例えば、`lib/` ディレクトリ内だけをフォーマットしたい場合は以下のようにします。

```bash
flutter format lib/
```

特定の複数ファイルを指定する場合:

```bash
flutter format lib/file1.dart lib/file2.dart
```

---

### 4. **`dart format` を利用**
Dart SDK の `dart format` コマンドは、`--ignore` オプションを提供していませんが、同様に `find` コマンドを組み合わせて実現できます。

```bash
dart format $(find . -name "*.dart" ! -path "./lib/generated/*")
```

---

これらの方法で、除外対象を柔軟に管理できます。特に除外が多い場合は、`.format-ignore` ファイルを使った方法がおすすめです。

---

## 👤 User
*2024-12-07 19:08:39*

flutter lintとは関係ないの？

---

## 🤖 Assistant
*2024-12-07 19:08:58*

`flutter lint` はコードのフォーマットとは直接関係ありませんが、**コードスタイルや品質をチェックするためのツール**です。フォーマッタとリンターは目的が異なるため、それぞれの役割を理解することが重要です。

---

### **Flutter Lint とは？**
`flutter lint` は、コードのベストプラクティスやポテンシャルバグを検出するために Dart の静的解析（Static Analysis）を行うツールです。Flutter/Dart の推奨スタイルに基づいて、改善点や警告を表示します。

#### 特徴:
- **フォーマットのチェックではなく、コード品質のチェック**を行う
- たとえば、使われていない変数、不要な型キャスト、非推奨なAPIなどを警告します
- **分析のルールをカスタマイズ可能**（`analysis_options.yaml`）

---

### **Flutter Lint とフォーマッタの違い**

| 特徴                 | **Flutter Lint**                               | **フォーマッタ（flutter format）**          |
|---------------------|---------------------------------------------|-----------------------------------------|
| **目的**            | コード品質やスタイルガイド違反を検出する             | コードのフォーマットを一貫したスタイルに整える     |
| **動作**            | 警告やエラーを出力して修正箇所を指摘する               | 自動的にコードを整形する                     |
| **カスタマイズ性**   | ルールセットを `analysis_options.yaml` で設定可能 | カスタマイズ不可（標準スタイルに固定）           |
| **適用範囲**         | 論理エラー、ベストプラクティス、未使用コードの指摘など    | インデントや空白、改行などの物理的なコード構造を整える |

---

### **Flutter Lint を使う方法**

1. **Flutter Lints の設定**
   Flutter プロジェクトでは通常、`analysis_options.yaml` ファイルがルートにあります。デフォルトの推奨設定を追加するには、以下の内容を記述します。

   ```yaml
   include: package:flutter_lints/flutter.yaml
   ```

2. **Lint を実行する**
   以下のコマンドで静的解析を実行できます。

   ```bash
   flutter analyze
   ```

   これにより、Lintエラーや警告が出力されます。

3. **Lint ルールのカスタマイズ**
   特定のルールを追加・削除したい場合は、`analysis_options.yaml` を編集します。例えば:

   ```yaml
   linter:
     rules:
       prefer_const_constructors: true # ルールを有効化
       avoid_print: false             # ルールを無効化
   ```

---

### **フォーマットを Lint に統合する方法**
`flutter format` と `flutter analyze` は独立していますが、プロジェクトのコーディングルールを統一するため、フォーマットも合わせて実行するのがおすすめです。

#### 1. フォーマットチェックの自動化
`flutter analyze` の前にフォーマットを強制するには、CI/CD パイプラインや `pre-commit` フックで以下を設定できます。

```bash
flutter format --set-exit-if-changed .
flutter analyze
```

`--set-exit-if-changed` を使うと、フォーマットが適用されていない場合にエラーコードを返すため、自動化に役立ちます。

#### 2. Lint でフォーマットを考慮する
Lint ルールとフォーマットを組み合わせることで、以下のようなワークフローを構築できます：
- コードフォーマット → 静的解析 → テスト実行

---

### **まとめ**
- **`flutter lint` はコード品質のチェックツール**で、フォーマッタとは異なる目的で使用されます。
- 両方を組み合わせることで、コードを美しく保ちつつ、品質やベストプラクティスを維持できます。
- フォーマットを強制する場合は `flutter format` を使い、品質のチェックには `flutter analyze` を使用してください。

---

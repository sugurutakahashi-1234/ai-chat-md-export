# Amplify Multi-Platform Development

日付: 2023-05-10

---

## 👤 ユーザー
*2023/05/10 20:07:07*

amplify を iOSプロジェクトであったり、Webフロントプロジェクトであったり、マルチプラットフォームとして、使いたいと思っている。たとえば、Cognito を使った認証を実装したい。全体の開発戦略を教えて欲しい。iOSプロジェクトやWebフロントプロジェクトは別々のgitで管理されている。

---

## 🤖 アシスタント
*2023/05/10 20:09:50*

AWS Amplifyをマルチプラットフォームで利用し、Cognitoを使った認証を実装するための開発戦略は以下のようになります。

1. AWS Amplify Consoleを利用:
Amplify Consoleを利用して、iOSプロジェクトとWebフロントプロジェクトをそれぞれ独立したアプリケーションとして扱います。この方法では、それぞれのプロジェクトを別々のGitリポジトリで管理できます。

2. バックエンドリソースの共有:
Cognitoなどのバックエンドリソースは、両プロジェクトで共有することができます。Amplify CLIを使用して、バックエンドリソースをセットアップし、それらをiOSプロジェクトとWebフロントプロジェクトで共有する設定を行います。

具体的な手順は以下の通りです。

1. AWS アカウントを作成し、Amplify CLIをインストールして設定します。
2. WebフロントプロジェクトでAmplifyを初期化し、Cognito認証リソースを追加します。この時点で `amplify push` コマンドを実行して、バックエンドリソースをデプロイします。
3. Webフロントプロジェクトで、Amplify ライブラリをインポートし、Cognitoを使った認証機能を実装します。
4. iOSプロジェクトで、同じバックエンドリソースを利用するために、Amplify CLIを使って既存のリソースをインポートします。`amplify pull` コマンドを使用して、バックエンドの設定ファイルを取得します。
5. iOSプロジェクトで、Amplify ライブラリをインポートし、Cognitoを使った認証機能を実装します。
6. それぞれのプロジェクトで開発を進め、必要に応じてバックエンドリソースを更新します。更新がある場合は、`amplify push` コマンドを実行してデプロイし、他のプロジェクトでも `amplify pull` コマンドで最新の設定を取得します。

これらの手順に従って、iOSプロジェクトとWebフロントプロジェクトでCognito認証機能を実装し、バックエンドリソースを共有できます。開発が進むにつれて、他のAmplifyサービス（API, ストレージ, 通知, など）も追加していくことができます。

---

## 👤 ユーザー
*2023/05/10 20:11:10*

なるほど、ちなみにWebフロントチームもiOSチームもamplify pushしないような運用にして、amplify push する専用のgitのリポジトリを作って、WebフロントチームとiOSチームはamplify pull だけするようにすることはできないかな

---

## 🤖 アシスタント
*2023/05/10 20:13:30*

はい、その運用方法も可能です。AWS Amplifyのバックエンドリソースに関する変更を管理するために、専用のGitリポジトリを作成することができます。こうすることで、WebフロントチームとiOSチームは、それぞれのプロジェクトでAmplifyのバックエンドリソースを更新することなく、専用のリポジトリから最新の設定を取得（`amplify pull`）することができます。

具体的な手順は以下の通りです。

1. AWS アカウントを作成し、Amplify CLIをインストールして設定します。
2. 新たに、Amplifyのバックエンドリソースを管理するための専用Gitリポジトリを作成します。
3. 専用リポジトリでAmplifyを初期化し、Cognito認証リソースを追加します。この時点で `amplify push` コマンドを実行して、バックエンドリソースをデプロイします。
4. WebフロントプロジェクトとiOSプロジェクトのそれぞれで、専用リポジトリから最新の設定を取得するために `amplify pull` コマンドを実行します。
5. WebフロントプロジェクトとiOSプロジェクトで、Amplify ライブラリをインポートし、Cognitoを使った認証機能を実装します。
6. バックエンドリソースの更新が必要な場合は、専用のGitリポジトリで変更を行い、`amplify push` コマンドでデプロイします。その後、WebフロントプロジェクトとiOSプロジェクトで `amplify pull` コマンドを実行して、最新の設定を取得します。

この方法で、WebフロントチームとiOSチームはAmplifyのバックエンドリソースの変更を行わず、専用のリポジトリを介して最新の設定を共有できます。ただし、この運用方法では、バックエンドリソースの変更を管理する専門の担当者が必要になる場合があります。

---

## 👤 ユーザー
*2023/05/10 20:14:06*

なるほど。amplify pull コマンドではどのような指定方法があるの？

---

## 🤖 アシスタント
*2023/05/10 20:16:34*

`amplify pull` コマンドは、Amplifyプロジェクトのバックエンド環境をローカル環境に同期するために使用されます。このコマンドにはいくつかのオプションがあります。

1. `--appId <appId>`: AmplifyアプリIDを指定します。これは、Amplify Consoleでアプリを作成したときに自動的に生成されます。
2. `--envName <environmentName>`: プルする環境の名前を指定します。これは、プロジェクトで複数の環境がある場合に役立ちます。
3. `--yes`: 質問プロンプトをスキップし、デフォルトの設定でプルを実行します。
4. `--noOverride`: プロジェクト内の既存のファイルを上書きせずにプルを実行します。

以下にいくつかの例を示します。

- 通常の `amplify pull` コマンドを実行すると、対話形式でアプリID、環境名、プロバイダ情報を指定します。

```sh
amplify pull
```

- `--appId` オプションを使用して、特定のアプリIDを指定し、対話形式で環境名とプロバイダ情報を指定できます。

```sh
amplify pull --appId yourAppId
```

- `--appId` と `--envName` オプションを組み合わせて、特定のアプリIDと環境名を指定し、対話形式でプロバイダ情報を指定できます。

```sh
amplify pull --appId yourAppId --envName yourEnvironmentName
```

- `--yes` オプションを追加すると、デフォルトの設定でプルが実行され、質問プロンプトがスキップされます。

```sh
amplify pull --appId yourAppId --envName yourEnvironmentName --yes
```

- `--noOverride` オプションを使用すると、既存のファイルを上書きせずにプルが実行されます。

```sh
amplify pull --appId yourAppId --envName yourEnvironmentName --noOverride
```

これらのオプションを使用して、プロジェクトのバックエンド環境をローカル環境に同期することができます。ただし、プロジェクトに適切な設定が必要です。

---

# Combineで文字列を配列に追加

日付: 2023-09-08

---

## 👤 ユーザー
*2023/09/08 20:53:31*

Swift の Combine で流れてくる文字列のストリームを別の文字列の配列にどんどん追加していく処理を書きたい

---

## 🤖 アシスタント
*2023/09/08 20:54:17*

Combine フレームワークを使用して、流れてくる文字列のストリームを別の文字列の配列に追加する処理を行いたい場合、以下のステップに従ってください。

1. 必要な Combine モジュールをインポートします。
2. PassthroughSubject を使用して、新たな文字列のストリームを表すサブジェクトを作成します。
3. scan 演算子を使用して、サブジェクトから流れてくる文字列を配列に追加します。

以下はその例です:

```swift
import Combine

// 1. 文字列のストリームを受け取るサブジェクトを作成
let subject = PassthroughSubject<String, Never>()

// 配列を管理するプロパティを作成 (この例では、初期状態として空の配列を設定)
var stringsArray: [String] = []

// 2. `scan` 演算子を使用して、新しい文字列を配列に追加
let cancellable = subject
    .scan([], { (accumulatedStrings, newValue) -> [String] in
        return accumulatedStrings + [newValue]
    })
    .sink(receiveValue: { updatedArray in
        stringsArray = updatedArray
        print(stringsArray)
    })

// テスト
subject.send("Hello")
subject.send("World")
subject.send("Combine")

// 出力:
// ["Hello"]
// ["Hello", "World"]
// ["Hello", "World", "Combine"]

cancellable.cancel()  // 後処理として、cancellable をキャンセル
```

このコードは、新しい文字列が `subject` に送信されるたびに、その文字列を `stringsArray` に追加しています。

---

## 👤 ユーザー
*2023/09/08 20:54:34*

.append とかなかったっけ？

---

## 🤖 アシスタント
*2023/09/08 20:55:12*

はい、その通りです。Swift の配列には `.append(_:)` メソッドがあり、これを使って配列に新しい要素を追加することができます。前述のコードにおける `scan` 演算子の中でこのメソッドを使用しても同じ結果が得られます。

以下は `.append(_:)` メソッドを使用した例です:

```swift
import Combine

let subject = PassthroughSubject<String, Never>()

var stringsArray: [String] = []

let cancellable = subject
    .scan([], { (accumulatedStrings, newValue) -> [String] in
        var newAccumulatedStrings = accumulatedStrings
        newAccumulatedStrings.append(newValue)
        return newAccumulatedStrings
    })
    .sink(receiveValue: { updatedArray in
        stringsArray = updatedArray
        print(stringsArray)
    })

// テスト
subject.send("Hello")
subject.send("World")
subject.send("Combine")

// 出力:
// ["Hello"]
// ["Hello", "World"]
// ["Hello", "World", "Combine"]

cancellable.cancel()
```

このコードも、新しい文字列が `subject` に送信されるたびに、その文字列を `stringsArray` に追加しています。ただし、新しい配列を作成する代わりに、既存の配列に `.append(_:)` メソッドを使用して新しい文字列を追加しています。

---

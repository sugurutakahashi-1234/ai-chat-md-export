# GitHub Branch Protection Rules

日付: 2023-09-05

---

## 👤 ユーザー
*2023/09/05 13:28:12*

Github タグ保護ルール の設定例を作ってあげてほしい。

---

## 🤖 アシスタント
*2023/09/05 13:28:52*

GitHubでのブランチ保護ルールを設定することで、ブランチへの変更を制限することができます。これは、特定の条件を満たさないとブランチへのマージやプッシュができないようにするためのものです。

以下は、一般的なブランチ保護ルールの設定例です：

1. **mainまたはmasterブランチの保護**:
   - このブランチはプロジェクトの主要なブランチであるため、特に保護が重要です。

2. **必須のステータスチェックの設定**:
   - CIツール (例: Travis CI, GitHub Actions) を使用してテストを実行する場合、テストが成功するまでマージを許可しないようにします。

3. **レビューの承認が必要**:
   - PRがマージされる前に、少なくとも1人以上のコントリビューターからの承認が必要です。

4. **線形のコミット履歴の保持**:
   - マージコミットを禁止して、リベースとマージのみを許可します。これにより、コミット履歴がきれいに保たれます。

5. **フォースプッシュの禁止**:
   - これにより、既存のコミット履歴が書き換えられることを防ぎます。

具体的な設定手順：

1. GitHubのリポジトリページにアクセスします。
2. `Settings` タブをクリックします。
3. 左サイドバーで `Branches` をクリックします。
4. `Branch protection rules` セクションで `Add rule` をクリックします。
5. 保護したいブランチの名前（例：`main`）を指定します。
6. 必要に応じて以下のオプションを有効にします：
   - `Require pull request reviews before merging`
   - `Require status checks to pass before merging`
   - `Include administrators`
   - `Require linear history`
   - `Allow force pushes` (通常はこのオプションはオフにします)

7. `Create`または`Save changes`をクリックして設定を保存します。

これで、指定したルールに基づいてブランチが保護されます。

---

## 👤 ユーザー
*2023/09/05 13:29:02*

タグです x.x.x-rc.x のようなルールにしたい

---

## 🤖 アシスタント
*2023/09/05 13:29:39*

申し訳ございません、最初の回答でブランチの話を中心にしましたが、タグに対する保護ルールについて説明します。

GitHubでは、タグに対する保護ルールを直接設定することはできません。しかし、タグの命名規則を強制するワークフローをGitHub Actionsを使用して作成することができます。

以下は、`x.x.x-rc.x` のような形式に従ったタグのみを許可するためのGitHub Actionsのワークフローの例です。

1. リポジトリのルートに `.github/workflows/tag.yml` を作成します。

2. 以下の内容を `tag.yml` にコピー＆ペーストします。

```yaml
name: Check Tag Format

on:
  create:

jobs:
  check-tag:
    if: startsWith(github.ref, 'refs/tags/')
    runs-on: ubuntu-latest
    steps:
    - name: Check tag format
      run: |
        TAG_NAME=$(basename ${{ github.ref }})
        if [[ ! $TAG_NAME =~ ^[0-9]+\.[0-9]+\.[0-9]+-rc\.[0-9]+$ ]]; then
          echo "error: tag $TAG_NAME does not match x.x.x-rc.x format"
          exit 1
        fi
```

3. このワークフローは、新しいタグが作成されたときにトリガーされます。タグ名が `x.x.x-rc.x` の形式に従っていない場合、ワークフローは失敗し、その結果がGitHubのUIで表示されます。

注意: このアクションはタグの形式をチェックするだけで、タグの作成自体をブロックまたは削除することはありません。しかし、タグが期待される形式に従っていない場合にワークフローが失敗することで、コントリビュータにその情報を知らせることができます。

---

# Reactã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ææ¡ˆ

æ—¥ä»˜: 2025-06-16

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/16 18:01:00*

react+viteã§ã‚·ãƒ³ãƒ—ãƒ«ãªå®Ÿè£…ã‚’ã—ã¦ã„ã‚‹ã€‚
APIã‚’å‘¼ã³å‡ºã™ã‚ˆã†ãªç”»é¢ã§ã€ç”»é¢ã«ã‚ã¾ã‚Šãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ··ãœãŸããªã„ã€ 
ã©ã†ã„ã£ãŸå®Ÿè£…ã‚’ã™ã‚‹ã®ãŒè‰¯ã„ã‹ã€ã¾ãŸã‚·ãƒ³ãƒ—ãƒ«ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ãªã©ãŒã‚ã‚Œã°æ•™ãˆã¦ã»ã—ã„ã€‚ 
ãƒã‚¯ã‚¹ãƒˆJSã¯ã‚ã¾ã‚Šä½¿ã„ãŸããªã„ã€‚ 
ã‚ã¨ãƒªã‚¢ã‚¯ãƒˆãƒ«ãƒ¼ã‚¿ãƒ¼ã¯ä½¿ã£ã¦ã„ã‚‹ã€‚
APIã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ã¯è‡ªå‹•ç”Ÿæˆã—ãŸã‚‚ã®ã‚’ä½¿ã£ã¦ã„ã‚‹ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/16 18:01:22*

### æ–¹é‡ â€” UI ã¯ã€Œè–„ãã€ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯åˆ¥å±¤ã¸
Reactï¼‹Viteï¼ˆSPAï¼‰ã§ **Next.js ã‚’ä½¿ã‚ãš** ã«ç”»é¢ã‚’ã™ã£ãã‚Šä¿ã¤ãªã‚‰ã€  
ã€Œ**ç”Ÿæˆæ¸ˆã¿ API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â†’ ã‚µãƒ¼ãƒ“ã‚¹å±¤ â†’ ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ•ãƒƒã‚¯ â†’ ç”»é¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**ã€ã¨ã„ã† 4 å±¤æ§‹æˆãŒã‚‚ã£ã¨ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã€‚

```
src/
 â”œ api/               # openapi-generator ãªã©ã§è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
 â”œ services/          # API å‘¼ã³å‡ºã—ã‚’ã¾ã¨ã‚ã¦è²¬å‹™ã‚’åå‰ã§è¡¨ã™
 â”œ hooks/             # TanStack Query/RTK Query ã‚’ä½¿ã£ãŸ useXxx ãƒ•ãƒƒã‚¯
 â”œ components/        # å†åˆ©ç”¨ UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (ç´”è¡¨ç¤º)
 â”œ pages/             # react-router ã®å„ç”»é¢ã€‚ã“ã“ã¯æ¥µåŠ›è–„ã
 â”” types/             # ãƒ‰ãƒ¡ã‚¤ãƒ³å‹ãƒ»DTOãƒ»Enum ãªã©
```

* **api/** ã¯è§¦ã‚‰ãšå†ç”Ÿæˆã™ã‚‹ã ã‘  
* **services/** â€¦ ãƒ“ã‚¸ãƒã‚¹ç”¨èªã§ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã¾ã¨ã‚ã€ç”Ÿæˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®è©³ã—ã„å¼•æ•°ã‚’éš ã™  
* **hooks/** â€¦ `useQuery / useMutation` ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»ã‚¨ãƒ©ãƒ¼ãƒ»ãƒªãƒˆãƒ©ã‚¤ã‚’è‚©ä»£ã‚ã‚Š  
* **pages/** â€¦ ç”»é¢ã¯ã€Œãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ•ãƒƒã‚¯ã®å‘¼ã³å‡ºã—ï¼‹ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ã‚¨ãƒ©ãƒ¼ï¼è¡¨ç¤ºã€ã®ã¿  

---

### 1 ã‚µãƒ¼ãƒ“ã‚¹å±¤ï¼šç”Ÿæˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’â€œç¿»è¨³â€ã™ã‚‹

```ts
// src/services/userService.ts
import { UsersApi } from "@/api";
const usersApi = new UsersApi();

export const userService = {
  getUser(id: string) {
    return usersApi.getUser({ id });
  },
  updateUser(id: string, payload: UpdateUserRequest) {
    return usersApi.updateUser({ id, updateUserRequest: payload });
  },
};
```

* ç”Ÿæˆã‚³ãƒ¼ãƒ‰ã® HTTP è©³ç´°ã‚’ã“ã“ã§å¸å
* ç”»é¢ã¯ **ãƒ“ã‚¸ãƒã‚¹ç”¨èª**ï¼ˆ`getUser` ç­‰ï¼‰ã ã‘çŸ¥ã‚Œã°ã‚ˆã„

---

### 2 ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ•ãƒƒã‚¯ï¼šTanStack Query ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’è‡ªå‹•åŒ–

```ts
// src/hooks/useUser.ts
import { useQuery, useMutation } from "@tanstack/react-query";
import { userService } from "@/services/userService";

export const useUser = (id: string) =>
  useQuery({
    queryKey: ["user", id],
    queryFn: () => userService.getUser(id),
  });

export const useUpdateUser = () =>
  useMutation({
    mutationFn: ({ id, data }: { id: string; data: UpdateUserRequest }) =>
      userService.updateUser(id, data),
    // æˆåŠŸæ™‚ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å³æ›´æ–°
    onSuccess: (_, { id }) => {
      queryClient.invalidateQueries({ queryKey: ["user", id] });
    },
  });
```

> *TanStack Query ã¯ã€Œå•ã„åˆã‚ã›ã‚­ãƒ¼ç®¡ç†ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»èƒŒæ™¯å†å–å¾—ãƒ»ãƒªãƒˆãƒ©ã‚¤ã€ãªã©  
>  ã‚µãƒ¼ãƒãƒ¼ã‚¹ãƒ†ãƒ¼ãƒˆã®é¢å€’ã‚’å…¨éƒ¨æ‹…ã£ã¦ãã‚Œã¾ã™* îˆ€citeîˆ‚turn0search0îˆ‚turn0search2îˆ

* Redux ã‚’å°å…¥æ¸ˆã¿ãªã‚‰ **RTK Query** ã§ã‚‚åŒæ§˜ã«æ›¸ã‘ã¾ã™ã€‚RTK Query ã¯ Redux ãƒ„ãƒ¼ãƒ«ã‚­ãƒƒãƒˆæ¨™æº–ã§ã€Œslice ã‚’æ„è­˜ã›ãšã« API ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒä½¿ãˆã‚‹ã€ç‚¹ãŒãƒ¡ãƒªãƒƒãƒˆ îˆ€citeîˆ‚turn0search1îˆ‚turn0search9îˆ

---

### 3 ç”»é¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼šãƒ‡ãƒ¼ã‚¿ã®çŠ¶æ…‹é·ç§»ã ã‘æ‰±ã†

```tsx
// src/pages/UserPage.tsx
import { useParams } from "react-router-dom";
import { useUser, useUpdateUser } from "@/hooks/useUser";

export default function UserPage() {
  const { id = "" } = useParams();
  const { data, isLoading, error } = useUser(id);
  const updateUser = useUpdateUser();

  if (isLoading) return <Spinner />;
  if (error)     return <ErrorView error={error} />;

  return (
    <UserForm
      defaultValues={data}
      onSubmit={(payload) => updateUser.mutate({ id, data: payload })}
    />
  );
}
```

* **ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ã‚¨ãƒ©ãƒ¼ï¼å®Œæˆ UI** ã® 3 state ã‚’åˆ†å²ã™ã‚‹ã ã‘  
* ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯ `userService` ã¨ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ãŒå¸å  

---

### 4 React Router ã§ã€Œç”»é¢å¤–ãƒ•ã‚§ãƒƒãƒã€ã‚’ã™ã‚‹å ´åˆ

React Router (v6.4+) ãªã‚‰ **`loader` é–¢æ•°**ã§ã‚‚äº‹å‰å–å¾—ã§ãã¾ã™ãŒã€  
`useQuery` ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦ãŠã‘ã° **ãƒ«ãƒ¼ãƒˆé·ç§»å¾Œã‚‚å³æ™‚ã«å†åˆ©ç”¨**ã§ãã‚‹ã®ã§ã€  
*ã€Œãƒªã‚¹ãƒˆâ†’è©³ç´°ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å…±æœ‰ã—ãŸã„ã€* å ´åˆã¯ãƒ•ãƒƒã‚¯æ–¹å¼ã®ã»ã†ãŒæ¥½ã§ã™ã€‚

---

### çŠ¶æ…‹ç®¡ç†ã¯ã€Œã‚µãƒ¼ãƒãƒ¼ã‚¹ãƒ†ãƒ¼ãƒˆã€ã¨ã€ŒUI ãƒ­ãƒ¼ã‚«ãƒ«ã€ã‚’åˆ†é›¢

| ç›®çš„                           | æ¨å¥¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¾‹                |
|--------------------------------|--------------------------------|
| ã‚µãƒ¼ãƒãƒ¼åŒæœŸãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥        | TanStack Query / RTK Query |
| ç”»é¢å†… UI çŠ¶æ…‹ï¼ˆãƒ•ã‚©ãƒ¼ãƒ é–‹é–‰ç­‰ï¼‰| Zustand / Jotai / useReducer |

Redux ã‚’ã¾ã å°å…¥ã—ã¦ã„ãªã‘ã‚Œã° **Zustand + TanStack Query** ãŒæœ€å°æ§‹æˆã§æ¸ˆã‚€ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå¤šã„ã§ã™ã€‚  
ï¼ˆZustand ã¯ã‚·ãƒ³ãƒ—ãƒ«ãªé–¢æ•° 1 ã¤ã§ã‚¹ãƒˆã‚¢ã‚’ä½œã‚Œã€Context/Provider ã™ã‚‰ä¸è¦ï¼‰

---

### ã¾ã¨ã‚ â€” ã€Œå°ã•ãª Clean Architectureã€

1. **api/**ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰ã‚’ç›´æ¥è§¦ã‚‰ãš  
2. **services/** ãŒãƒ‰ãƒ¡ã‚¤ãƒ³æ¦‚å¿µå˜ä½ã§ API ã‚’åŒ…ã‚€  
3. **hooks/** ãŒã‚µãƒ¼ãƒ“ã‚¹ã‚’å‘¼ã³ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»ã‚¨ãƒ©ãƒ¼å‡¦ç†ã‚’çµ±ä¸€  
4. **UI** ã¯ hook ã®æˆ»ã‚Šå€¤ã‚’å—ã‘å–ã£ã¦è¡¨ç¤ºã«å°‚å¿µ  

ã“ã†ã™ã‚‹ã¨  
* ãƒ†ã‚¹ãƒˆã¯ **services ã¨ hooks** ã«å¯¾ã—ã¦è¡Œãˆã° UI ã‚’è§¦ã‚‰ãšã«æ¸ˆã‚€  
* å°†æ¥ API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒå¤‰ã‚ã£ã¦ã‚‚ **services ã ã‘ä¿®æ­£**ã™ã‚Œã°ç”»é¢ã¯ç„¡æ”¹ä¿®  
* ä¾å­˜æ–¹å‘ãŒ *UI â†’ hooks â†’ services â†’ api* ã¨ä¸€æ–¹å‘ã«ãªã‚‹ãŸã‚å¤‰æ›´ã«å¼·ã„  

ã€Œã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€ã‚’ãƒ•ãƒ«ã§å°å…¥ã™ã‚‹ã‚ˆã‚Š **ãƒ•ã‚©ãƒ«ãƒ€ 4 å±¤**ã ã‘ã§ååˆ†ã‚·ãƒ³ãƒ—ãƒ«ã«ä¿ã¦ã¾ã™ã€‚ãœã²è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/16 18:04:46*

2025å¹´ã€ä»Šä¸€ç•ªæœ€æ–°ã§å‹å®‰å…¨ã§ã€ è¨˜è¿°é‡ãŒå°‘ãªãã¦çŠ¶æ…‹ç®¡ç†ãŒã§ããŸã‚Šã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ•™ãˆã¦ã»ã—ã„ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/16 18:05:40*

#### 2025 å¹´ç‰ˆ â€• â€œå‹å®‰å…¨ãƒ»çœãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ»é«˜æ©Ÿèƒ½â€ ãª React ç”¨ã‚¹ãƒ†ãƒ¼ãƒˆç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒª TOP 3

| ãƒã‚¸ã‚·ãƒ§ãƒ³ | ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | ç‰¹é•·ã®ä¸€è¡Œã¾ã¨ã‚ | ç¾çŠ¶ |
|------------|-----------|-----------------|------|
| ğŸ¥‡ **TanStack Store** | Signals ãƒ™ãƒ¼ã‚¹ã§è¶…è»½é‡ã€**å®Œå…¨å‹å®‰å…¨**ã€ã‚ã‚‰ã‚†ã‚‹ FW ã§å‹•ã | Î±ç‰ˆï¼ˆAPI ã¯ã»ã¼å›ºã¾ã‚Šã¤ã¤ã‚ã‚‹ï¼‰ |
| ğŸ¥ˆ **Zustand v5** | 1 kB å°ã§**Hook ã ã‘**ã® APIã€Redux ä¸¦ã¿ã®è¡¨ç¾åŠ› | v5.0.5ï¼ˆå®‰å®šï¼‰ |
| ğŸ¥‰ **Jotai v2** | â€œåŸå­â€ æ€æƒ³ã§**å†ãƒ¬ãƒ³ãƒ€ãƒ¼æœ€å°åŒ–**ã€å®£è¨€çš„ã«è¤‡é›‘ãªæ´¾ç”ŸçŠ¶æ…‹ã‚’çµ„ã‚ã‚‹ | v2.xï¼ˆå®‰å®šï¼‰ |

---

### 1. TanStack Store â€” â€œä¿¡å·â€ ã«ã‚ˆã‚‹æ¬¡ä¸–ä»£ã‚¹ãƒˆã‚¢

```ts
import { Store } from '@tanstack/store';

// ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚«ã‚¦ãƒ³ã‚¿
const counter = new Store(0);

// React ã§èª­ã‚€
function Counter() {
  const count = counter.useStore(s => s);      // é¸æŠçš„è³¼èª­
  return <button onClick={() => counter.setState(s => s + 1)}>
    {count}
  </button>;
}
```

* **Signal ç³»**ï¼ˆSolidJS / Vue 3 ã«è¿‘ã„ï¼‰ãŒã‚³ã‚¢ã€‚ãã‚ç´°ã‹ãª reactivity ã§ä¸è¦ãªå†æç”»ã‚¼ãƒ­ã€‚  
* **å‹æ¨è«–ãƒ•ãƒ«æ´»ç”¨** â€” `setState` ã®ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã«ã‚‚æ›´æ–°å‰å‹ãŒæ¸¡ã‚‹ãŸã‚å®‰å…¨ã«ç·¨é›†å¯ã€‚  
* ãƒãƒ³ãƒ‰ãƒ«ã¯ **~2 kB**ã€React ä»¥å¤–ã«ã‚‚ã‚¢ãƒ€ãƒ—ã‚¿ã‚’æŒã¤ã®ã§å°†æ¥ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã—ã‚„ã™ã„ã€‚  
* TanStack Router / Form ãªã©å†…éƒ¨ã§ã‚‚æ¡ç”¨ â†’ ä¿¡é ¼æ€§â— îˆ€citeîˆ‚turn1view0îˆ‚turn11view0îˆ  

> Î±ç‰ˆã ãŒå®Ÿæˆ¦æŠ•å…¥ä¾‹ãŒå¢—ãˆã¦ãŠã‚Šã€**â€œã¨ã«ã‹ãæœ€å…ˆç«¯â€** ã‚’ç‹™ã†ãªã‚‰æœ€æœ‰åŠ›ã€‚

---

### 2. Zustand v5 â€” â€œãã¾ã•ã‚“â€ ãŒã•ã‚‰ã«ã‚¹ãƒªãƒ ã«

```ts
import { create } from 'zustand';

type State = {
  count: number;
  inc(): void;
};

export const useStore = create<State>()((set) => ({
  count: 0,
  inc: () => set((s) => ({ count: s.count + 1 })),
}));
```

* v5 ã§ **å¤ã„ API ã‚’ä¸€æƒ**ãƒ»å‹ã‚’å³æ ¼åŒ– â†’ ä½™è¨ˆãªã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãªã—ã§ã‚‚æ¨è«–ãŒåŠ¹ãã€‚  
* **Context ã‚’ä½¿ã‚ãš**ç‹¬è‡ªã‚µãƒ–ã‚¹ã‚¯æ§‹é€ ãªã®ã§å¤§é‡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã‚‚é«˜é€Ÿã€‚  
* Devtools / persist / immer ãªã©ã® **å…¬å¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢** ãŒãã®ã¾ã¾ä½¿ãˆã‚‹ã€‚  
* ã€ŒRedux ã®åŠåˆ†ã®ã‚³ãƒ¼ãƒ‰é‡ã€ã§**åŒç­‰ã®ã‚¹ã‚±ãƒ¼ãƒ«**ã¾ã§å¯¾å¿œå¯èƒ½ã¨ã®è©•ä¾¡ãŒå¤šã„ îˆ€citeîˆ‚turn0search5îˆ‚turn4view0îˆ  

---

### 3. Jotai v2 â€” â€œåŸå­â€ ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã‚¤ãƒ‡ã‚£ã‚ªãƒ 

```ts
import { atom, useAtom } from 'jotai';

const countAtom = atom(0);
const doubledAtom = atom((get) => get(countAtom) * 2);

function Counter() {
  const [count, setCount] = useAtom(countAtom);
  const doubled = useAtomValue(doubledAtom);

  return (
    <>
      <p>{count} â†’ doubled: {doubled}</p>
      <button onClick={() => setCount(c => c + 1)}>+1</button>
    </>
  );
}
```

* **ä¾å­˜ã‚°ãƒ©ãƒ•ãŒè‡ªå‹•æ§‹ç¯‰**ã•ã‚Œã€èª­ã‚“ã  atom ã ã‘å†ãƒ¬ãƒ³ãƒ€ãƒ¼ â†’ æ‰‹å‹• `memo` ä¸è¦ã€‚  
* **Store API ãŒå¤–éƒ¨å…¬é–‹**ã•ã‚ŒãŸãŸã‚ã€React å¤–ã§ã‚‚åŒã˜ atom ã‚’å…±æœ‰å¯èƒ½ã€‚  
* TypeScript å‰æè¨­è¨ˆã§ã€æ´¾ç”Ÿ atom ã‚‚æˆ»ã‚Šå€¤å‹ã‚’è‡ªå‹•æ¨è«–ã€‚  
* Props ãƒ‰ãƒªãƒ«è§£æ¶ˆ + éå‰° Global ã‚’é¿ã‘ãŸã„ä¸­è¦æ¨¡ SPA ã«å¥½é© îˆ€citeîˆ‚turn13view0îˆ  

---

## ã©ã†é¸ã¶ï¼Ÿ

| ã“ã‚“ãªæ™‚ | ãƒ™ã‚¹ãƒˆãƒãƒ§ã‚¤ã‚¹ |
|----------|---------------|
| **æœ€å…ˆç«¯ã® Signal ãƒ¢ãƒ‡ãƒ«**ã‚’è©¦ã—ãŸã„ï¼FW è¤‡æ•°ã§å…±æœ‰ã—ãŸã„ | **TanStack Store** |
| **å®‰å®šç‰ˆã§è»½é‡**ã‹ã¤ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚‚æ¬²ã—ã„ | **Zustand v5** |
| **ç´°ç²’åº¦ã®æ´¾ç”ŸçŠ¶æ…‹**ã‚’æ¥½ã«çµ„ã¿ãŸã„ï¼å®£è¨€çš„ã«ä¿å®ˆã—ãŸã„ | **Jotai v2** |

> **è£œè¶³**: ã‚µãƒ¼ãƒãƒ¼åŒæœŸï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒï¼‰ã«ã¯åŒã˜ TanStack ãƒ•ã‚¡ãƒŸãƒªã® **TanStack Query** ã‚„ Redux Toolkit ã® **RTK Query** ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã®ãŒ 2025 å¹´ã®å®šç•ªã§ã™ã€‚UI ãƒ­ãƒ¼ã‚«ãƒ«ï¼ä¸Šè¨˜ 3 ã¤ã€ã‚µãƒ¼ãƒãƒ¼ã‚¹ãƒ†ãƒ¼ãƒˆï¼Query ç³»ã‚’å½¹å‰²åˆ†æ‹…ã™ã‚‹ã¨ã‚¹ãƒƒã‚­ãƒªã—ã¾ã™ã€‚ îˆ€citeîˆ‚turn8view0îˆ

---

### å€‹äººçš„ãŠã™ã™ã‚ãƒ•ãƒ­ãƒ¼ï¼ˆReact + Vite + React Router å‰æï¼‰

1. **TanStack Query** ã§ API ã‚­ãƒ£ãƒƒã‚·ãƒ¥  
2. **Zustand v5** ã‚’å°å…¥ã—ã€ãƒ•ãƒƒã‚¯ã‚’ `useStore()` ã§ã¾ã¨ã‚ã‚‹  
3. è¦æ¨¡ãŒå¤§ãããªã‚Š â€œå†ãƒ¬ãƒ³ãƒ€ãƒ¼æœ€é©åŒ–â€ ãŒèª²é¡ŒåŒ– â†’ **Jotai** ã«ç½®æ›ã—ã¦ã‚‚ç§»è¡Œã‚³ã‚¹ãƒˆå°  

ãœã²ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¦æ¨¡ã¨å°†æ¥ã®ãƒ¡ãƒ³ãƒ†è¨ˆç”»ã«åˆã‚ã›ã¦ãƒãƒ§ã‚¤ã‚¹ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/16 18:20:47*

ãã‚‚ãã‚‚èƒŒæ™¯ã¨ã—ã¦ã¯åŸºæœ¬çš„ãªæ¨™æº–æ©Ÿèƒ½ã§æŠ‘ãˆãŸã„ãŒã€æ¨™æº–æ©Ÿèƒ½ã§ã©ã†ã—ã¦ã‚‚åã¾ã‚‰ãªã„æ©Ÿèƒ½ã ã‘ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã„ãŸã„ã€‚ãã†ã„ã†ä¸Šã ã£ãŸã‚‰ã©ã‚Œã‚’é¸æŠã™ã‚‹ã®ãŒã¡ã‚‡ã†ã©ã„ã„ã‹ã€‚ ãã‚‚ãã‚‚ã“ã‚Œã¯æ¨™æº–æ©Ÿèƒ½ã§ã¯ã§ããªã„ã“ã¨ãªã®ã‹ã€‚ ãƒªã‚¢ã‚¯ãƒˆã‚‚ã©ã‚“ã©ã‚“é€²åŒ–ã—ã¦ã„ã‚‹ã¨èã„ã¦ã„ã‚‹ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/16 18:21:08*

## ã¾ãš â€œç´ ã® Reactâ€ ã§ã©ã“ã¾ã§è¡Œã‘ã‚‹ã‹ï¼Ÿ

| ç›®çš„ | æ¨™æº– React ã§å‡ºæ¥ã‚‹ã“ã¨ | é™ç•Œ |
|------|------------------------|------|
| **UI ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹**<br>(å…¥åŠ›å€¤ãƒ»ãƒ¢ãƒ¼ãƒ€ãƒ«é–‹é–‰ãªã©) | `useState` / `useReducer` ã§ååˆ†ã€‚ | â€• |
| **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã§å…±æœ‰ã—ãŸã„å°‘é‡ã®çŠ¶æ…‹** | `createContext`ï¼‹`useSyncExternalStore` ãªã‚‰å†ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’æœ€å°åŒ–ã—ã¤ã¤è‡ªä½œã‚¹ãƒˆã‚¢ã‚’ä½œã‚Œã‚‹ã€‚îˆ€citeîˆ‚turn0search2îˆ‚turn0search6îˆ | ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«ãƒ»æ°¸ç¶šåŒ–ãƒ»éåŒæœŸæ´¾ç”Ÿå€¤ãªã©ã¯è‡ªå‰å®Ÿè£…ãŒå¿…è¦ã€‚ |
| **ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã‚„æ¥½è¦³çš„æ›´æ–°** | React 19 ã® `useActionState` / `useOptimistic` ã§å¤§åŠã¯æ¨™æº–å¯¾å¿œã€‚îˆ€citeîˆ‚turn0search0îˆ‚turn0search4îˆ | ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚„ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã¯æ‰±ãˆãªã„ã€‚ |
| **API å–å¾—ï¼‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥** | å…¬å¼æ©Ÿèƒ½ã¯ã¾ã ãªãï¼ˆServer Components å‰æã® `use()` ãªã©ã¯ Next.js å‘ã‘ï¼‰ã€‚Viteï¼‹CSR ã§ã¯è‡ªå‰ `fetch`ï¼‹`useEffect` ãŒå¿…è¦ã€‚ | **ã‚¹ãƒ†ãƒ¼ãƒ«â€“ãƒ›ãƒ¯ã‚¤ãƒ«â€“ãƒªãƒãƒªãƒ‡ãƒ¼ãƒˆã€å¤±æ•—æ™‚ãƒªãƒˆãƒ©ã‚¤ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¤±åŠ¹** ã‚’è‡ªåŠ›ã§æ›¸ãã®ã¯å¤šå¤§ãªå·¥æ•°ã€‚ |

> **çµè«–**  
> *ãƒ­ãƒ¼ã‚«ãƒ«ï½è»½é‡ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹* ã¯æ¨™æº– API ã ã‘ã§å®Ÿç”¨çš„ã€‚  
> *ã‚µãƒ¼ãƒãƒ¼ã‚¹ãƒ†ãƒ¼ãƒˆï¼ˆAPI ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰* ã¯ã„ã¾ã ã«å°‚ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å°å…¥ãŒ â€œå·¥æ•°ã¨ãƒã‚°ã®ç·é‡â€ ã‚’æœ€å°ã«ã—ã¾ã™ã€‚

---

## ã€Œãªã‚‹ã¹ãæ¨™æº–ï¼‹æœ€ä½é™ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€æ§‹æˆã®ãŠã™ã™ã‚

### 1ï¸âƒ£ ã‚°ãƒ­ãƒ¼ãƒãƒ«ï¼æ´¾ç”ŸçŠ¶æ…‹ â†’ **è‡ªä½œãƒŸãƒ‹ã‚¹ãƒˆã‚¢** (ä¾å­˜ã‚¼ãƒ­)

```ts
// store/counter.ts
import { useSyncExternalStore } from "react";

function createStore<T>(initial: T) {
  let state = initial;
  const listeners = new Set<() => void>();

  const setState = (u: T | ((s: T) => T)) => {
    state = typeof u === "function" ? (u as any)(state) : u;
    listeners.forEach(l => l());
  };

  const subscribe = (l: () => void) => (listeners.add(l), () => listeners.delete(l));
  const getSnapshot = () => state;

  function useStore<S = T>(selector: (s: T) => S = s => s as any) {
    return useSyncExternalStore(subscribe, () => selector(state));
  }

  return { useStore, setState };
}

export const counter = createStore(0);
```

```tsx
// Counter.tsx
import { counter } from "@/store/counter";

export default function Counter() {
  const value = counter.useStore();
  return <button onClick={() => counter.setState(v => v + 1)}>{value}</button>;
}
```

* **1 ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ä¾å­˜ã‚¼ãƒ­ãƒ»å‹å®‰å…¨**  
* ã»ã¨ã‚“ã©ã® â€œZustand çš„â€ ä½¿ã„æ–¹ãŒ 30 è¡Œã§å®Œçµã€‚

### 2ï¸âƒ£ ã‚µãƒ¼ãƒãƒ¼ã‚¹ãƒ†ãƒ¼ãƒˆ â†’ **TanStack Query** ã ã‘å°å…¥

```ts
import { useQuery, useMutation } from "@tanstack/react-query";
import { userService } from "@/services/userService";

export const useUser = (id: string) =>
  useQuery({ queryKey: ["user", id], queryFn: () => userService.getUser(id) });

export const useUpdateUser = () =>
  useMutation({
    mutationFn: userService.updateUser,
    onSuccess: (_, { id }) => queryClient.invalidateQueries({ queryKey: ["user", id] })
  });
```

* Vite ã§ã‚‚ **è¿½åŠ è¨­å®šã‚¼ãƒ­** ã§å‹•ãã€ãƒãƒ³ãƒ‰ãƒ«å·®åˆ†ã¯ç´„ 14 kB gzipã€‚  
* Stale-while-revalidateã€æ¥½è¦³çš„æ›´æ–°ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ UI ãªã© â€œæ›¸ãã¨ 1,000 è¡Œè¶…ãˆã‚‹æ©Ÿèƒ½â€ ãŒ 1 è¡Œã§æ¸ˆã‚€ã€‚îˆ€citeîˆ‚turn0search5îˆ  

> **ä»£æ›¿**: Redux Toolkit ã‚’æ—¢ã«æ¡ç”¨ã—ã¦ã„ã‚‹ãªã‚‰ RTK Query ã‚’ä½¿ãˆã°ä¾å­˜ã¯å®Ÿè³ª 0 å¢—ã€‚  
> ã—ã‹ã—ã€Œã¾ã  Redux ã‚’å…¥ã‚Œã¦ã„ãªã„ã€å ´åˆã¯ TanStack Query ã®æ–¹ãŒå°å…¥ãŒè»½ã„ã§ã™ã€‚

---

## ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ¡ç”¨åˆ¤æ–­ãƒ•ãƒ­ãƒ¼

1. **ã¾ãšæ¨™æº– API ã§è©¦ã™**  
   * `useState/useReducer` âœ UI ãƒ­ãƒ¼ã‚«ãƒ«  
   * `Context + useSyncExternalStore` âœ ã‚¢ãƒ—ãƒªå†…å…±æœ‰
2. ã€Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å¼µã‚ŠãŸã„ or æ¥½è¦³çš„æ›´æ–°ãŒæ¬²ã—ã„ã€  
   âœ **TanStack Query** ã‚’è¿½åŠ 
3. ã€Œè¤‡é›‘ãªãƒ­ãƒ¼ã‚«ãƒ«â€“ã‚°ãƒ­ãƒ¼ãƒãƒ«æ··åœ¨çŠ¶æ…‹ãŒå¢—ãˆ & DevTools ã‚„æ°¸ç¶šåŒ–ãŒæ¬²ã—ã„ã€  
   âœ 1 kB å°ã§ä¹—ã‚Šæ›ãˆã‚„ã™ã„ **Zustand** ã‚’â€œå¾Œä»˜ã‘â€ (æ—¢å­˜ã‚¹ãƒˆã‚¢ã¯æµç”¨å¯)

---

## ã¾ã¨ã‚

* **React 19 ã®æ–° API** ã§ãƒ•ã‚©ãƒ¼ãƒ å‡¦ç†ã‚„æ¥½è¦³çš„ UI ã¯ã»ã¼æ¨™æº–åŒ–ã€‚  
* ãã‚Œã§ã‚‚ **â€œã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†â€** ã ã‘ã¯æ¨™æº–æ©Ÿèƒ½ãŒä¸ååˆ†ã€‚  
* â€œæ¨™æº–ã‚’æ¥µåŠ›æ´»ã‹ã™â€ æ–¹é‡ãªã‚‰ **è‡ªä½œãƒŸãƒ‹ã‚¹ãƒˆã‚¢ï¼‹TanStack Query** ãŒæœ€å°æ§‹æˆã€‚  
  * ä¾å­˜ã¯ 1 ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼å®Ÿè£… 30 è¡Œã§æ¸ˆã¿ã€å¾Œã‹ã‚‰ Zustand ç­‰ã¸ç§»è¡Œã‚‚å®¹æ˜“ã€‚

> ã“ã†ã—ã¦ãŠãã¨ã€Œå°†æ¥ React ã«å…¬å¼ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæ¥ãŸã‚‰ TanStack Query ã‚’å¤–ã™ã€ã‚‚ç°¡å˜ã§ã™ã€‚æ¨™æº–ã¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®è‰¯ã„ã¨ã“ã‚ã ã‘ã¤ã¾ã¿é£Ÿã„ã—ã¦ã€ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã‚’ã‚¹ãƒªãƒ ã«ä¿ã¡ã¾ã—ã‚‡ã†ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/16 18:23:08*

ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†ã¨ã¯ãªã‚“ã®ã“ã¨ã ã‚ã†ã€‚ ã©ã†ã„ã£ãŸå ´åˆã§æœ‰åŠ¹ã«ãªã£ãŸã‚Šã™ã‚‹?

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/16 18:23:20*

### ã€Œã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†ã€ã¨ã¯ï¼Ÿ

- **ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆï¼Server Stateï¼‰**  
  - ãƒªãƒ¢ãƒ¼ãƒˆ API ã‚„ DB ã«ä¿å­˜ã•ã‚Œã¦ãŠã‚Šã€è‡ªåˆ†ã®ã‚¢ãƒ—ãƒªã ã‘ãŒæ‰€æœ‰è€…ã§ã¯ãªã„  
  - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¶Šã—ã« **éåŒæœŸ** ã§å–å¾—ï¼æ›´æ–°ã™ã‚‹  
  - ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚„åˆ¥ç«¯æœ«ã‹ã‚‰ **ã„ã¤ã§ã‚‚å¤‰åŒ–** ã—å¾—ã‚‹  
  - å–å¾—ã—ãŸç¬é–“ã‹ã‚‰ â€œå¤ããªã‚‹â€ å¯èƒ½æ€§ãŒã‚ã‚‹ îˆ€citeîˆ‚turn0search3îˆ

ã“ã®ã€Œå¤‰ã‚ã‚Šã†ã‚‹ãƒ»åŒæœŸãŒé…ã‚Œã‚‹ã€æ€§è³ªã«å¯¾å‡¦ã™ã‚‹ãŸã‚ã«ã€**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ã«ä¸€æ™‚çš„ã«ä¿æŒã—ã¦å†åˆ©ç”¨ãƒ»æ•´åˆæ€§ã‚’ä¿ã¤ä»•çµ„ã¿** ãŒ â€œã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†â€ ã§ã™ã€‚  
ä»£è¡¨çš„ãªæ©Ÿèƒ½ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚

| æ©Ÿèƒ½ | ç›®çš„ |
|------|------|
| **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ / ãƒ¡ãƒ¢åŒ–** | åŒã˜ã‚¯ã‚¨ãƒªã‚’è¤‡æ•°å›å‘¼ã‚“ã§ã‚‚ 1 åº¦ã ã‘é€šä¿¡ã—ã€çµæœã‚’å†åˆ©ç”¨ |
| **ã‚¹ãƒ†ãƒ¼ãƒ«-ãƒ›ãƒ¯ã‚¤ãƒ«-ãƒªãƒãƒªãƒ‡ãƒ¼ãƒˆ** | ç”»é¢ã«ã¯å³ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’è¡¨ç¤ºã—ã€è£ã§æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å†ãƒ•ã‚§ãƒƒãƒï¼ˆUI ãƒ•ãƒªãƒƒã‚«ã‚’é˜²æ­¢ï¼‰îˆ€citeîˆ‚turn0search6îˆ |
| **è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤** | ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¤±æ•—æ™‚ã«æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ã§å†è©¦è¡Œ |
| **ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å†å–å¾—** | ã‚¿ãƒ–ã«æˆ»ã£ãŸï¼ãƒãƒƒãƒˆå¾©æ´»ãªã©ãƒˆãƒªã‚¬ãƒ¼æ™‚ã«è‡ªå‹•æ›´æ–° |
| **ã‚¤ãƒ³ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³** | ã‚ã‚‹æ“ä½œã§ãƒ‡ãƒ¼ã‚¿ãŒå¤‰ã‚ã£ãŸã¨åˆ†ã‹ã£ãŸã‚‰ã€ç‰¹å®šã‚­ãƒ¼ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ‰‹å‹•ã§ã€Œå¤ã„ã€æ‰±ã„ã«ã™ã‚‹æ©Ÿæ§‹ îˆ€citeîˆ‚turn0search7îˆ |
| **ã‚¬ãƒ¼ãƒ™ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³** | ä¸€å®šæ™‚é–“ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œãªã„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç ´æ£„ã—ã¦ãƒ¡ãƒ¢ãƒªç¯€ç´„ îˆ€citeîˆ‚turn0search9îˆ |

---

### ã©ã‚“ãªå ´é¢ã§â€œåŠ¹ãç›®â€ãŒã‚ã‚‹ï¼Ÿ

| å…¸å‹ã‚·ãƒŠãƒªã‚ª | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†ãŒãªã„å ´åˆã®ç—›ã¿ | ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå°å…¥ã§å¾—ã‚‰ã‚Œã‚‹åŠ¹æœ |
|--------------|------------------------------|--------------------------------|
| **ãƒªã‚¹ãƒˆ â†’ è©³ç´° â†’ æˆ»ã‚‹**| ç”»é¢é·ç§»ã®ãŸã³ã«æ¯å›ãƒ•ã‚§ãƒƒãƒï¼ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ãƒ”ãƒŠãƒ¼ | 1 å›ç›®ã ã‘é€šä¿¡ã—ã€ä»¥å¾Œã¯å³æç”»ï¼†è£ã§æ›´æ–° |
| **è¤‡æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒåŒã˜ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã‚€**| åŒæœŸãšã‚Œãƒ»äºŒé‡ãƒ•ã‚§ãƒƒãƒãƒ»æ‰‹å‹•ã§ context æ›´æ–°ãŒå¿…è¦ | å˜ä¸€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å…¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§å…±æœ‰ |
| **ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ï¼ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«**| ç¾åœ¨ãƒšãƒ¼ã‚¸ã‚’ä¿æŒã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’è‡ªä½œ | `useInfiniteQuery` ç­‰ãŒ cursor ã‚’å†…åŒ… |
| **æ¥½è¦³çš„ UI æ›´æ–°ï¼ˆå…ˆã«è¡¨ç¤ºâ†’å¤±æ•—ã§å·»ãæˆ»ã—ï¼‰**| ç‹¬è‡ªã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè£…ãŒå¿…è¦ | `mutation` ã« `onMutate / onError` ãŒçµ„ã¿è¾¼ã¿ |
| **ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ PWA**| ãƒãƒƒãƒˆåˆ‡æ–­ã§ã‚¨ãƒ©ãƒ¼å¤šç™º | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒã‚ã‚Œã°é–²è¦§ç¶™ç¶šãƒ»å¾©å¸°æ™‚ã«åŒæœŸ |
| **SSR/SSG + CSR ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**| åŒæœŸãšã‚Œã§ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒ•ã‚©ãƒ¼ãƒ«æç”» | `dehydrate/rehydrate` ã§ã‚µãƒ¼ãƒãƒ¼å´ãƒ•ã‚§ãƒƒãƒçµæœã‚’ãã®ã¾ã¾æ³¨å…¥ îˆ€citeîˆ‚turn0search2îˆ |

å°è¦æ¨¡ãƒ»é™çš„ãªç”»é¢ãªã‚‰ `useEffect(fetch)` ã§æ¸ˆã¿ã¾ã™ãŒã€ä¸Šè¨˜ã®ã‚ˆã†ã« **ã€ŒåŒã˜ãƒ‡ãƒ¼ã‚¿ã‚’è¤‡æ•°ç”»é¢ã§å…±æœ‰ãƒ»é »ç¹ã«æ›´æ–°ã™ã‚‹ã€** å ´åˆã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å…¥ã‚ŒãŸæ–¹ãŒ **ã‚³ãƒ¼ãƒ‰é‡ã‚‚ãƒã‚°ã‚‚æ¿€æ¸›** ã—ã¾ã™ã€‚

---

### ä»£è¡¨çš„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨â€œæ¨™æº–ã ã‘â€ã¨ã®ç·šå¼•ã

| é¸æŠè‚¢ | æ¡ç”¨åˆ¤æ–­ã®ç›®å®‰ |
|--------|--------------|
| **æ¨™æº– API (`fetch` + `useEffect` + Context)** | å–å¾—å›æ•°ãŒå°‘ãªãã€å†å–å¾—ã‚„ä¸¦åˆ—å…±æœ‰ã‚’æ°—ã«ã—ãªã„ã‚·ãƒ³ãƒ—ãƒ« SPA |
| **TanStack Query / RTK Query** | â†™ï¸ã®ã©ã‚Œã‹ã«å½“ã¦ã¯ã¾ã‚‹ã¨ãã¯å°å…¥ã‚’å¼·ãæ¨å¥¨&lt;br&gt;ãƒ»åŒã˜ãƒ‡ãƒ¼ã‚¿ã‚’è¤‡æ•°ç”»é¢ã§å†åˆ©ç”¨&lt;br&gt;ãƒ»ä¸€è¦§â†”ï¸è©³ç´°â†”ï¸ç·¨é›†ã§ä¸€è²«æ€§ã‚’ä¿ã¡ãŸã„&lt;br&gt;ãƒ»ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§ã‚„ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã€SSR ã‚’è¦–é‡ã«å…¥ã‚Œã‚‹ |

&gt; React è‡ªä½“ã¯å°†æ¥çš„ã« â€œå…¬å¼ãƒ•ã‚§ãƒƒãƒã‚­ãƒ£ãƒƒã‚·ãƒ¥â€ ã‚’æ¤œè¨ã—ã¦ã„ã¾ã™ãŒã€2025 å¹´æ™‚ç‚¹ã§ã¯å®Ÿæˆ¦æŠ•å…¥ãƒ¬ãƒ™ãƒ«ã«é”ã—ã¦ã„ã¾ã›ã‚“ã€‚ã—ãŸãŒã£ã¦ **ã€Œå›°ã£ãŸã‚‰ 1 ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã ã‘è¼‰ã›ã‚‹ã€** ãŒç¾çŠ¶ã®æœ€å°ã‚³ã‚¹ãƒˆè§£ã§ã™ã€‚îˆ€citeîˆ‚turn0search4îˆ

---

## ã¾ã¨ã‚

- **ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†** ã¯ã€Œãƒãƒƒãƒˆè¶Šã—ã§å¤‰ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã€ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§ä¸€æ™‚ä¿æŒã—ã€**é«˜é€Ÿæç”»ãƒ»æ•´åˆæ€§ãƒ»å¤±æ•—è€æ€§**ã‚’å¾—ã‚‹ä»•çµ„ã¿ã€‚  
- React ã®æ¨™æº–æ©Ÿèƒ½ã§ UI ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã¯ã»ã¼å®Œçµã™ã‚‹ä¸€æ–¹ã€**ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼å†æ¤œè¨¼ï¼ãƒªãƒˆãƒ©ã‚¤** ãªã©ã¯æœªå®Ÿè£…ã®ãŸã‚ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒä¾ç„¶æœ‰åŠ¹ã€‚  
- å®Ÿéš›ã«ã€Œãƒªã‚¹ãƒˆâ†’è©³ç´°ã€ã€Œè¤‡æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå…±æœ‰ã€ã€Œæ¥½è¦³çš„æ›´æ–°ã€ãŒå¿…è¦ã«ãªã£ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ **TanStack Query ãªã©** ã‚’å°å…¥ã™ã‚‹ã¨ã€è¨˜è¿°é‡ã¨ä¸å…·åˆã‚’æœ€å°ã«æŠ‘ãˆã‚‰ã‚Œã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/16 18:53:43*

React v19 ã¨ã‹ã§æ¥½è¦³çš„æ›´æ–°ã¯ã‚‚ã†ã§ãã‚‹èªè­˜ãªã®ã ãŒã€ 
ã™ã”ã„è–„ã„çŠ¶æ…‹ç®¡ç†ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’1ã¤å°å…¥ã™ã‚Œã°ã„ã„ã£ã¦ç†è§£ã§ã‚ã£ã¦ã¾ã™ã‹? 
ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®ã‚ˆã†ã«ä½¿ã†ã‚¤ãƒ¡ãƒ¼ã‚¸ã ã£ã¦ã¾ã™ã‹? 
ã“ã‚Œã¯Next.jsã¨ã‹ä½¿ãˆã°ãã‚“ãªã“ã¨ã¯ã—ãªãã¦æ¸ˆã‚€ã®ã‹ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/16 18:53:58*

### React 19 ã§ã€Œæ¥½è¦³çš„ UIã€ã¯æ¨™æº–åŒ–ã•ã‚ŒãŸã‘ã©â€¦â€¦

| æ¨™æº–ãƒ•ãƒƒã‚¯ | ã§ãã‚‹ã“ã¨ | ã§ããªã„ï¼ã¾ã æ‰‹ä½œæ¥­ã«ãªã‚‹ã“ã¨ |
|------------|------------|--------------------------------|
| **`useOptimistic`** | é€ä¿¡ç›´å¾Œã« UI ã‚’å…ˆè¡Œæ›´æ–°ã—ã€ã‚µãƒ¼ãƒãƒ¼å¿œç­”ã«åˆã‚ã›ã¦ç¢ºå®š or å·»ãæˆ»ã— îˆ€citeîˆ‚turn0search0îˆ‚turn0search7îˆ | ã‚­ãƒ£ãƒƒã‚·ãƒ¥å…±æœ‰ãƒ»å†æ¤œè¨¼ãƒ»è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ãƒ»ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ |
| **`useActionState`** | `&lt;form&gt;` ã‚„ä»»æ„ã®é–¢æ•°ã‚’ã€Œé€ä¿¡ä¸­ï¼æˆåŠŸï¼å¤±æ•—ã€çŠ¶æ…‹ä»˜ãã§æ‰±ã† îˆ€citeîˆ‚turn0search1îˆ‚turn0search6îˆ | å–å¾—ç³» API ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚„åŒæ™‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é‡è¤‡æ’é™¤ |
| **`useTransition` ã® async å¯¾å¿œ** | é…å»¶ UIï¼ã‚¨ãƒ©ãƒ¼å‡¦ç†ã‚’ 1 è¡Œã§åˆ¶å¾¡ îˆ€citeîˆ‚turn0search2îˆ | â†‘ã¨åŒã˜ |

&gt; **è¦ç‚¹**  
&gt; React 19 ã ã‘ã§ *ã€Œå˜ä¸€ãƒ•ã‚©ãƒ¼ãƒ ã®æ¥½è¦³çš„æ›´æ–°ã€* ã‚„ *ã€Œä¿ç•™çŠ¶æ…‹ã€* ã¯å®Œçµã—ã¾ã™ãŒã€  
&gt; **â€œå–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’è¤‡æ•°ç”»é¢ã§å…±æœ‰ã—ã¦æœ€æ–°ã«ä¿ã¤â€** ä»•çµ„ã¿ã¯ä¾ç„¶ã‚ã‚Šã¾ã›ã‚“ã€‚

---

### ãã“ã§ â€œæ¥µè–„â€ ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ 1 ã¤è¿½åŠ ã™ã‚‹æ§‹æˆ

| ç”¨é€” | æœ€å°æ§‹æˆã§ã®é¸æŠè‚¢ | ãƒãƒ³ãƒ‰ãƒ«å¢—åŠ  (gzip) |
|------|------------------|---------------------|
| **ãƒ­ãƒ¼ã‚«ãƒ«ï¼†ã‚°ãƒ­ãƒ¼ãƒãƒ« UI çŠ¶æ…‹** | æ‰‹è£½ãƒŸãƒ‹ã‚¹ãƒˆã‚¢ (`useSyncExternalStore` 30è¡Œç¨‹åº¦)  or  **Zustand** | 0ã€œ1 kB |
| **ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹**&lt;br&gt;(å–å¾—ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»ãƒªãƒˆãƒ©ã‚¤ãƒ»SWV) | **TanStack Query**ï¼ˆæ©Ÿèƒ½ã«çµã‚Œã° 14 kB å‰å¾Œï¼‰ | â‰ˆ14 kB |

*è‡ªå‰ãƒŸãƒ‹ã‚¹ãƒˆã‚¢ï¼‹TanStack Query* ãªã‚‰ **ä¾å­˜ã¯ 1 ãƒ©ã‚¤ãƒ–ãƒ©ãƒª** ã§æ¸ˆã¿ã€  
React 19 ã®æ–°ãƒ•ãƒƒã‚¯ã¨ã‚‚é‡ãªã‚‰ãšå½¹å‰²ãŒæ˜ç¢ºã§ã™ã€‚  
&gt; TanStack Query ãŒä¾ç„¶æœ‰ç”¨ã¨ã„ã†å£°ã¯ React 19 ä»¥é™ã‚‚å¤šã„ã§ã™ îˆ€citeîˆ‚turn0search8îˆ

---

### ã€Œãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã€ã¨ã—ã¦ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ãã‚Œã§åˆã£ã¦ã„ã‚‹ï¼Ÿ

ã¯ã„ã€‚**TanStack Query ã‚„ RTK Query** ã¯

1. **ãƒ¡ãƒ¢ãƒªå†…ã‚­ãƒ£ãƒƒã‚·ãƒ¥** ã«ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ç½®ã  
2. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ **ã‚­ãƒ¼ã§è³¼èª­**  
3. ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³æˆåŠŸæ™‚ã‚„ã€Œæˆ»ã‚‹ãƒ»å‰é€²ã€æ™‚ã« **è‡ªå‹•ã§æ­£ã—ã„å€¤ã«å†å–å¾—ï¼å·®ã—æ›¿ãˆ**

ã¨ã„ã†æ„å‘³ã§ â€œãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ã®ä¸€æ™‚çš„ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢â€ ã¨è€ƒãˆã‚‹ã®ãŒè¿‘ã„ã§ã™ã€‚

---

### Next.js ã‚’ä½¿ãˆã°ä¸è¦ã«ãªã‚‹ã®ã‹ï¼Ÿ

* **Server Components + `fetch()` ã‚­ãƒ£ãƒƒã‚·ãƒ¥** ã§ã€Œãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ãƒ‡ãƒ¼ã‚¿ä»˜ãã® HTML ã‚’è¿”ã™ã€  
* **Server Actions** ã§ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å¾Œã« **æ–° UI ã¨æ–°ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ‹¬è¿”å´** îˆ€citeîˆ‚turn0search4îˆ‚turn0search9îˆ  

ã“ã®ãŸã‚ **ã€Œãƒšãƒ¼ã‚¸ã‚’ã¾ãŸã„ã§ãƒ‡ãƒ¼ã‚¿ã‚’å…±æœ‰ã™ã‚‹ã€** ã ã‘ãªã‚‰ Next.js å´ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã§è¶³ã‚Šã‚‹ã‚±ãƒ¼ã‚¹ãŒå¢—ãˆã¾ã™ã€‚  
ãŸã ã—ï¼š

- **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§é »ç¹ã«æ›´æ–°ã•ã‚Œã‚‹ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ– UI**ï¼ˆãƒãƒ£ãƒƒãƒˆå…¥åŠ›æ¬„ã€ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ãªã©ï¼‰  
- **ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ï¼PWA**  
- **Viteï¼‹CSR ã‚¢ãƒ—ãƒª**ï¼ˆNext.js ã‚’æ¡ç”¨ã—ãªã„ä»Šå›ã®å‰æï¼‰

ã§ã¯ä¾ç„¶ã¨ã—ã¦ãƒ•ãƒ­ãƒ³ãƒˆå´ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå½¹ç«‹ã¡ã¾ã™ã€‚

---

## ã¾ã¨ã‚ â€” 2025 å¹´æ™‚ç‚¹ã®â€œæœ€å°æ§‹æˆâ€æŒ‡é‡

1. **ã¾ãš React 19 æ¨™æº–ãƒ•ãƒƒã‚¯**ã§æ¥½è¦³çš„æ›´æ–°ãƒ»ãƒ•ã‚©ãƒ¼ãƒ å‡¦ç†ã‚’å®Ÿè£…  
2. **ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’è¤‡æ•°ç”»é¢ã§å…±æœ‰**ã—ãŸããªã£ãŸã‚‰  
   - TanStack Queryï¼ˆor RTK Queryï¼‰ã‚’ 1 æœ¬ã ã‘è¿½åŠ   
3. UI ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ãŒç…©é›‘ãªã‚‰  
   - è‡ªä½œã‚¹ãƒˆã‚¢ or 1 kB ã‚¯ãƒ©ã‚¹ã® Zustand ã‚’è£œåŠ©ã§å°å…¥  
4. Next.js ã‚’é¸ã¶å ´åˆã¯ **Server Components/Actions ã§è³„ãˆã‚‹ç¯„å›²**ã‚’ç¢ºèªã—ã€  
   ãã‚Œã§ã‚‚è¶³ã‚Šãªã„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´éƒ¨åˆ†ã«ã ã‘è–„ã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã†ã€‚

ã“ã†ã™ã‚Œã° **æ¨™æº– API ã‚’æœ€å¤§é™æ´»ã‹ã—ã¤ã¤ã€è¶³ã‚Šãªã„æ‰€ã«ã ã‘è–„ã„ä¾å­˜ã‚’è¶³ã™** â€•  
ã¾ã•ã«ã”è¦æœ›ã©ãŠã‚Šã®ãƒãƒ©ãƒ³ã‚¹ã§ç¶­æŒã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/16 18:59:16*

TanStack Query ã¨ Zustand ã¯æ©Ÿèƒ½ãŒé•ã†ã‚‚ã®ã§å…±å­˜ã™ã‚‹ã‚‚ã®ãªã®ã‹ï¼Ÿ
ãã‚Œã¨ã‚‚å…¨ç„¶ç”¨é€”ãŒé•ã†ã®ã‹ï¼‘

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/16 18:59:23*

### TanStack Query â‰  Zustand â€” å½¹å‰²ã¨é‡ãªã‚Šã‚’æ•´ç†
| é …ç›® | **TanStack Query (React Query)** | **Zustand** |
|---|---|---|
| ä¸»çœ¼ | **ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹**ï¼ˆãƒªãƒ¢ãƒ¼ãƒˆ API ã®å–å¾—ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»åŒæœŸï¼‰ | **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆçŠ¶æ…‹**ï¼ˆUI ãƒ­ãƒ¼ã‚«ãƒ«ï¼ã‚°ãƒ­ãƒ¼ãƒãƒ«å€¤ãƒ»æ´¾ç”Ÿè¨ˆç®—ï¼‰ |
| ä»£è¡¨æ©Ÿèƒ½ | ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¤±åŠ¹ãƒ» SWR å†æ¤œè¨¼ãƒ»è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ãƒ»æ¥½è¦³çš„æ›´æ–°ãƒ»ã‚¤ãƒ³ãƒ•ã‚£ãƒ‹ãƒƒãƒˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« | get/set ãƒ•ãƒƒã‚¯ï¼‘è¡Œã§ä½œã‚‹ã‚¹ãƒˆã‚¢ã€éƒ¨åˆ†è³¼èª­ã€æ°¸ç¶šåŒ–ãƒ»ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ |
| â€œçŠ¶æ…‹â€ ã®å¯¿å‘½ | API ãŒå¤‰ã‚ã‚Œã°ç ´æ£„ã—ã¦ã‚‚ã‚ˆã„ä¸€æ™‚ãƒ‡ãƒ¼ã‚¿ | ç”»é¢å…¨ä½“ã§ç”Ÿãç¶šã‘ã‚‹è¨­å®šãƒ»å…¥åŠ›å€¤ãƒ»UI ãƒ•ãƒ©ã‚°ãªã© |
| æƒ³å®šãƒ‡ãƒ¼ã‚¿é‡ | æ•°åƒãƒ¬ã‚³ãƒ¼ãƒ‰ã¾ã§ï¼ˆã‚¯ã‚¨ãƒªã”ã¨ã® GC ã‚ã‚Šï¼‰ | ã”ãå°‘é‡ã€œä¸­é‡ï¼ˆãƒ¡ãƒ¢ãƒªå¸¸é§ï¼‰ |
| ä¾å­˜ã‚µã‚¤ã‚º (gzip) | â‰ˆ 14 kB | â‰ˆ 1â€“2 kB |

> é–‹ç™ºè€…ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã§ã‚‚ã€Œ**ä¸¡æ–¹å…±å­˜ã•ã›ã‚‹ã®ãŒæ™®é€š**ã€ã€Œãã‚‚ãã‚‚ç”¨é€”ãŒé•ã†ã€ã¨ã„ã†æ„è¦‹ãŒå¤§å¤šæ•°ã§ã™ îˆ€citeîˆ‚turn0search0îˆ‚turn0search2îˆ

---

### ã©ã†é‡ã­ã¦ä½¿ã†ã‹ â€• åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³

```tsx
// 1ï¸âƒ£ ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿å–å¾—ã€€â€” TanStack Query
export const useTodos = () =>
  useQuery({ queryKey: ["todos"], queryFn: api.getTodos });

// 2ï¸âƒ£ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆçŠ¶æ…‹ã€€â€” Zustand
const useUiStore = create(set => ({
  filter: "all",
  setFilter: (f: Filter) => set({ filter: f }),
}));

// 3ï¸âƒ£ ç”»é¢
function TodoList() {
  const { data: todos = [] } = useTodos();
  const filter = useUiStore(s => s.filter);

  const visible = todos.filter(t => filter === "all" || t.status === filter);
  /* ... */
}
```

* **Query** ãŒè¿”ã™é…åˆ—ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥å…±æœ‰ã•ã‚Œã€è£ã§å†æ¤œè¨¼ã€‚  
* **Zustand** ã¯ â€œä»Šã®ãƒ•ã‚£ãƒ«ã‚¿æ¡ä»¶â€â€œãƒ€ã‚¤ã‚¢ãƒ­ã‚°é–‹é–‰å¯å¦â€ ãªã©ç´” UI å€¤ã ã‘æŒã¤ã€‚  
* ï¼’ã‚¹ãƒˆã‚¢ã¯å®Œå…¨ã«ç‹¬ç«‹ã—ã¦ãŠã‚Šã€å†ãƒ¬ãƒ³ãƒ€ãƒ¼ã¯æœ€å°é™ã€‚  

---

### ç‰‡æ–¹ã ã‘ã§ä»£æ›¿ã§ãã‚‹ï¼Ÿ

| è©¦ã¿ | çµæœ |
|---|---|
| **Zustand ã« API çµæœã‚’ä¿å­˜** | ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¤±åŠ¹ãƒ»ãƒªãƒˆãƒ©ã‚¤ãƒ» SWR ã‚’è‡ªåŠ›å®Ÿè£… â‡’ ã‚³ãƒ¼ãƒ‰è†¨å¼µãƒ»ãƒã‚°æºã«ãªã‚‹ îˆ€citeîˆ‚turn0search5îˆ |
| **TanStack Query ã« UI å€¤ã‚’ä¿å­˜** | çŠ¶æ…‹æ›´æ–°ã”ã¨ã« Query ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆ`isFetching` ãªã©ï¼‰ã‚‚å†æ§‹ç¯‰ã•ã‚Œã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã€‚æ¨å¥¨ã•ã‚Œã¦ã„ãªã„ îˆ€citeîˆ‚turn0search6îˆ |

ã¤ã¾ã‚Š **ã€Œã©ã¡ã‚‰ã‹ã§å…¨éƒ¨ã¾ã‹ãªã†ã€ã‚ˆã‚Šã€ç”¨é€”ã”ã¨ã«ä½¿ã„åˆ†ã‘ãŸæ–¹ãŒã‚·ãƒ³ãƒ—ãƒ«** ã§ã™ã€‚

---

### Next.js ã ã¨ä¸è¦ï¼Ÿ

- **Server Components + Server Actions** ã«ã‚ˆã‚Š  
  - ãƒšãƒ¼ã‚¸åˆæœŸè¡¨ç¤ºæ™‚ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯ **ã‚µãƒ¼ãƒãƒ¼å´ã§è§£æ±º**  
  - ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å¾Œã«æœ€æ–° UI ãŒè¿”ã‚‹ã®ã§ **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å†ãƒ•ã‚§ãƒƒãƒå‰Šæ¸›**  
- ãã‚Œã§ã‚‚ **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã ã‘ã§é »ç¹ã«å¤‰ã‚ã‚‹ UI å€¤ã‚„å³æ™‚åæ˜ ãŒæ¬²ã—ã„ã‚±ãƒ¼ã‚¹**ï¼ˆãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã€PWA ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã€å…¥åŠ›è£œå®Œãªã©ï¼‰ã¯æ®‹ã‚‹ãŸã‚ã€**è–„ã„ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆã‚¢ï¼ˆZustand ãªã©ï¼‰ã¯ä¾ç„¶ä¾¿åˆ©**ã€‚  
- ã¾ãŸ CSR ãƒ«ãƒ¼ãƒˆã§ API ã‚’â€œåŒã˜ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã§å†åˆ©ç”¨â€ã—ãŸã„å ´åˆã¯ã€Next.js å†…ã§ã‚‚ **TanStack Query ãŒæ¨å¥¨ã•ã‚Œã‚‹** ä¾‹ãŒå¤šã„ã§ã™ã€‚îˆ€citeîˆ‚turn0search3îˆ‚turn0search9îˆ

---

## ã¾ã¨ã‚

- **TanStack Query** âœ *ã‚µãƒ¼ãƒãƒ¼ï¼ˆãƒªãƒ¢ãƒ¼ãƒˆï¼‰çŠ¶æ…‹* å°‚ç”¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¨ãƒ³ã‚¸ãƒ³  
- **Zustand** âœ *ãƒ­ãƒ¼ã‚«ãƒ«ï¼UI ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹* ã‚’æ¥µå°ã‚³ã‚¹ãƒˆã§ä¿æŒ  
- ä¸¡è€…ã¯ **ç«¶åˆã§ã¯ãªãè£œå®Œé–¢ä¿‚**ã€‚ï¼‘ã¤ã«é›†ç´„ã—ã‚ˆã†ã¨ã™ã‚‹ã¨é€†ã«å®Ÿè£…è² è·ãŒè·³ã­ä¸ŠãŒã‚‹ã€‚  
- Next.js ã‚’æ¡ç”¨ã—ã¦ã‚‚ã€Œãƒšãƒ¼ã‚¸å†…ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã€ã€Œã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã€ã€ŒCSR éƒ¨åˆ†ã€ã§ã¯åŒã˜æ§‹æˆãŒæ´»ãã‚‹ã€‚

> çµå±€ã€**ã€ŒAPI ãƒ‡ãƒ¼ã‚¿ï¼Ÿ â†’ TanStack Queryã€ã€ŒUI ã®å€¤ï¼Ÿ â†’ Zustandï¼ˆã¾ãŸã¯æ¨™æº–ï¼‰ã€** ã® 2 æœ¬ç«‹ã¦ã§è€ƒãˆã‚‹ã®ãŒ 2025 å¹´æ™‚ç‚¹ã®æœ€å°ãƒ»æœ€å¼·ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/16 19:02:07*

ä»–ã®ç”»é¢ã¨å…±å­˜ã™ã‚‹ã‚ˆã†ãªæ›¸ãæ–¹ã«ã¤ã„ã¦ã‚‚ã¡ã‚‡ã£ã¨æ›¸ã„ã¦ã»ã—ã„ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/16 19:02:08*

### ã€Œè¤‡æ•°ç”»é¢ã§åŒã˜ãƒ‡ãƒ¼ã‚¿ã‚’å…±æœ‰ã€ã™ã‚‹æœ€å°ã‚µãƒ³ãƒ—ãƒ«  
â€ *React 19 + Vite + React Router v6.23*  
â€ *ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ â†’ TanStack Query*  
â€ *UI ãƒ­ãƒ¼ã‚«ãƒ«ï¼ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ â†’ Zustand*  

```
src/
â”œ api/              # è‡ªå‹•ç”Ÿæˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”œ services/         # API ã‚’æ¥­å‹™ç”¨èªã§åŒ…ã‚€ (getUsers, getUser)
â”œ hooks/            # useUsers / useUser ãªã© Query ãƒ•ãƒƒã‚¯
â”œ store/            # Zustand ã‚¹ãƒˆã‚¢ (uiStore.ts ãªã©)
â”œ pages/
â”‚  â”œ UsersPage.tsx      # ä¸€è¦§
â”‚  â”” UserDetailPage.tsx # è©³ç´°
â”” App.tsx
```

---

## 1  QueryClient ã¨ Router ã‚’æœ€ä¸Šä½ã§å…±æœ‰

```tsx
// src/App.tsx
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { BrowserRouter, Routes, Route } from 'react-router-dom';
import UsersPage from '@/pages/UsersPage';
import UserDetailPage from '@/pages/UserDetailPage';

const qc = new QueryClient({
  defaultOptions: {
    queries: { staleTime: 5 * 60_000, retry: 2 }, // å…¨ç”»é¢ã§å…±é€šãƒãƒªã‚·ãƒ¼
  },
});

export default function App() {
  return (
    <QueryClientProvider client={qc}>
      <BrowserRouter>
        <Routes>
          <Route path="/users"      element={<UsersPage />} />
          <Route path="/users/:id"  element={<UserDetailPage />} />
        </Routes>
      </BrowserRouter>
    </QueryClientProvider>
  );
}
```

* **QueryClientProvider** ã‚’ã‚¢ãƒ—ãƒªã®ãƒ«ãƒ¼ãƒˆã« 1 å›ç½®ãã ã‘ã§ã€  
  ã©ã®ç”»é¢ã‹ã‚‰å‘¼ã‚“ã§ã‚‚ **åŒã˜ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ—ãƒ¼ãƒ«** ã‚’å…±æœ‰ã—ã¾ã™ã€‚

---

## 2  ä¸€è¦§ç”»é¢ â€• åŒæœŸç”¨ UI çŠ¶æ…‹ã‚’ Zustand ã«åˆ†é›¢

```ts
// src/store/uiStore.ts
import { create } from 'zustand';
export type Filter = 'all' | 'active' | 'completed';

export const useUiStore = create<{
  filter: Filter;
  setFilter: (f: Filter) => void;
}>((set) => ({
  filter: 'all',
  setFilter: (f) => set({ filter: f }),
}));
```

```tsx
// src/pages/UsersPage.tsx
import { Link } from 'react-router-dom';
import { useUsers } from '@/hooks/useUsers';
import { useUiStore } from '@/store/uiStore';

export default function UsersPage() {
  const { data: users = [], isFetching } = useUsers();      // TanStack Query
  const filter = useUiStore(s => s.filter);                 // Zustand
  const setFilter = useUiStore(s => s.setFilter);

  const visible = users.filter(u =>
    filter === 'all' ? true : u.status === filter,
  );

  return (
    <>
      <h1>Users {isFetching && 'â³'}</h1>
      <select value={filter} onChange={e => setFilter(e.target.value as any)}>
        <option value="all">all</option>
        <option value="active">active</option>
        <option value="completed">completed</option>
      </select>

      <ul>
        {visible.map(u => (
          <li key={u.id}>
            <Link to={`/users/${u.id}`}>{u.name}</Link>
          </li>
        ))}
      </ul>
    </>
  );
}
```

* **ä¸€è¦§â†”ï¸è©³ç´°ã‚’è¡Œãæ¥**ã—ã¦ã‚‚ `useUsers()` ã®çµæœã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å³æç”»ã€‚  
* `filter` ã¯ UI ã ã‘ã®å€¤ãªã®ã§ **Zustand** ã«ã€‚ç”»é¢ã‚’è·¨ã„ã§ã‚‚ä¿æŒã•ã‚Œã¾ã™ã€‚  

---

## 3  è©³ç´°ç”»é¢ â€• æ¥½è¦³çš„æ›´æ–° + ä¸€è¦§ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ›¸ãæ›ãˆ

```tsx
// src/pages/UserDetailPage.tsx
import { useParams, useNavigate } from 'react-router-dom';
import { useUser, useUpdateUser } from '@/hooks/useUser';

export default function UserDetailPage() {
  const { id = '' } = useParams();
  const nav = useNavigate();
  const { data, isLoading } = useUser(id);          // å€‹åˆ¥å–å¾— (ã‚­ãƒ£ãƒƒã‚·ãƒ¥å…±æœ‰)
  const updateUser = useUpdateUser();               // mutation Hook

  if (isLoading) return <p>Loading...</p>;

  return (
    <div>
      <button onClick={() => nav(-1)}>â† back</button>
      <h2>{data.name}</h2>

      <button
        onClick={() =>
          updateUser.mutate(
            { id, payload: { active: !data.active } },
            {
              // âœ¨ æ¥½è¦³çš„æ›´æ–°
              optimisticData: { ...data, active: !data.active },
            },
          )
        }
      >
        Toggle Active
      </button>
    </div>
  );
}
```

- `useUser(id)` ã¯ **ä¸€è¦§ãƒšãƒ¼ã‚¸ã¨åŒã˜ã‚¯ã‚¨ãƒªã‚­ãƒ¼éƒ¨å“** (`["user", id]`) ã‚’ä½¿ã†ãŸã‚ã€
  è©³ç´°ã§æ›´æ–°ã™ã‚‹ã¨ **ä¸€è¦§ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚‚ç¬æ™‚ã«åŒæœŸ**ã€‚
- `optimisticData`ï¼ˆReact Query v5 APIï¼‰ã§å¿œç­”å‰ã§ã‚‚ UI å…ˆè¡Œæ›´æ–°ã€‚  
  *React 19 ã® `useOptimistic` ã¨äºŒé‡ã«ãªã‚‰ãªã„ã‚ˆã† Query å´ã ã‘ã§å®Œçµã•ã›ã‚‹*ã€‚

---

## 4  ç”»é¢æ•°ãŒå¢—ãˆã¦ã‚‚è¿½åŠ ã‚³ã‚¹ãƒˆã¯ã»ã¼ã‚¼ãƒ­

| è¿½åŠ ç”»é¢ä¾‹ | å®Ÿè£…æ™‚ã«æ›¸ãã‚³ãƒ¼ãƒ‰ | å…±æœ‰ / è‡ªå‹•ã§èµ·ã“ã‚‹ã“ã¨ |
|------------|-------------------|-------------------------|
| `/reports` ã§å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼çµ±è¨ˆ | `useUsers()` ã‚’å†åˆ©ç”¨ | ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ¸ˆã¿ãªã‚‰å³è¡¨ç¤ºãƒ»è£ã§å†æ¤œè¨¼ |
| `/settings` ã§ãƒ†ãƒ¼ãƒåˆ‡æ›¿ | `useUiStore(s=>s.theme)` | ã©ã®ç”»é¢ã§ã‚‚ãƒ†ãƒ¼ãƒå¤‰æ›´ãŒå³åæ˜  |
| ãƒ¢ãƒ¼ãƒ€ãƒ«å†…éƒ¨ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›† | `useUpdateUser()` | æˆåŠŸå¾Œã€å…¨ç”»é¢ã®ä¸€è¦§ãƒ»è©³ç´°ãŒåŒã˜å€¤ã« |

---

### ã¾ã¨ã‚ â€” â€œä»–ç”»é¢å…±å­˜â€ ã‚’è–„ãå®Ÿç¾ã™ã‚‹ã‚­ãƒ¼

1. **ã‚¯ã‚¨ãƒªã‚­ãƒ¼ã‚’ãƒ«ãƒ¼ãƒ«åŒ–**  
   - `["resource", id?]` ã®ã‚ˆã†ã«ä¸€è²«ã•ã›ã‚‹ã¨ **ç”»é¢ã‚’è·¨ã„ã§è‡ªå‹•åŒæœŸ**ã€‚  
2. **UI å€¤ã¯ Zustand ã«å¯„ã›ã€äººé–“ãŒæ‰‹ã§æ¶ˆã™ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’è€ƒãˆãªãã¦æ¸ˆã‚€ã‚ˆã†ã«ã™ã‚‹**  
   - React Router ã§ `Routes` ã‚’å‡ºãŸã‚Šå…¥ã£ãŸã‚Šã—ã¦ã‚‚å€¤ã¯æ®‹ã‚Šã€å¿…è¦ãªã‚‰ `useStorePersist()` ä¸­é–“ã‚¦ã‚§ã‚¢ã§ sessionStorage æ°¸ç¶šåŒ–ã‚‚ 1 è¡Œã€‚  
3. **QueryClientProvider ã¯ 1 ã¤ã ã‘**  
   - ãƒ«ãƒ¼ãƒˆä»¥ä¸‹ã§ã‚ã‚Œã°ã©ã®ãƒ¬ãƒ™ãƒ«ã«ç½®ã„ã¦ã‚‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯å…±æœ‰ã•ã‚Œã‚‹ã€‚  

> ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãªã‚‰ã€Œç”»é¢ãŒ 10â†’50 ã¨å¢—ãˆã¦ã‚‚ã€**ãƒ­ã‚¸ãƒƒã‚¯ã¯ services/hooks/store ã«é–‰ã˜è¾¼ã‚ã¦ UI ã¯è–„ã„ã¾ã¾**ã€â”€â”€ ã”è¦æœ›ã®â€œå…±å­˜ã—ã‚„ã™ã„æœ€å°ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£â€ã‚’ç¶­æŒã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/16 19:04:22*

åˆæœŸèª­ã¿è¾¼ã¿ã®ãƒ¦ãƒ¼ã‚ºã‚¹ãƒ†ã‚¤ãƒˆã¨ã‹ã¯ã‚‚ã†ã‚„ã‚‰ãªããªã£ãŸã®ã‹ãªã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/16 19:04:39*

### `useState` ã§ â€œæ‰‹æ›¸ããƒ­ãƒ¼ãƒ‰ãƒ•ãƒ©ã‚°â€ ã‚’ç«‹ã¦ã‚‹ã‚±ãƒ¼ã‚¹ã¯æ¿€æ¸›ã—ã¦ã„ã‚‹

æ˜”ã¯ã“ã‚“ãªã‚³ãƒ¼ãƒ‰ã‚’ã‚ˆãæ›¸ãã¾ã—ãŸã€‚

```tsx
// æ—§æ¥ã®ãƒ‘ã‚¿ãƒ¼ãƒ³
const [data, setData]       = useState<User[] | null>(null);
const [loading, setLoading] = useState(true);
const [error, setError]     = useState<unknown>(null);

useEffect(() => {
  fetch("/api/users")
    .then(r => r.json())
    .then(setData)
    .catch(setError)
    .finally(() => setLoading(false));
}, []);
```

#### 2025 å¹´ç¾åœ¨ã¯â€•â€•

| ã‚„ã‚ŠãŸã„ã“ã¨ | ä»Šã®â€œç´ ã® Reactâ€| è¿½åŠ ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | å…·ä½“çš„ã«æ›¸ãå ´æ‰€ |
|--------------|----------------|---------------|-----------------|
| **ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ï¼‹ä¿ç•™çŠ¶æ…‹ï¼‹æ¥½è¦³çš„ UI** | `useActionState` ã¨ `useOptimistic` ãŒä¸¸æŠ±ãˆ | ãªã— | **React 19 ä»¥é™**ã§æ¨™æº–åŒ– (docs) îˆ€citeîˆ‚turn0search0îˆ‚turn0search1îˆ |
| **ã‚µãƒ¼ãƒãƒ¼å–å¾—ï¼‹ãƒ­ãƒ¼ãƒ‰ï¼ã‚¨ãƒ©ãƒ¼ç®¡ç†ï¼‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥** | æ¨™æº–ã«ã¯ã¾ã ç„¡ã„ | **TanStack Query** 1 æœ¬ | `useQuery`, `useMutation` (docs) îˆ€citeîˆ‚turn1search1îˆ |
| **UI ãƒ­ãƒ¼ã‚«ãƒ«ï¼ã‚°ãƒ­ãƒ¼ãƒãƒ«å€¤** | `useState` / `useReducer` / `Context` | ï¼ˆå¿…è¦ãªã‚‰ï¼‰Zustand ç­‰ 1 kB ã‚¯ãƒ©ã‚¹ | ä»»æ„ |

> âš¡ **ã¤ã¾ã‚Š**: ã€Œæœ€åˆã«ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ•ãƒ©ã‚°ã ã‘ã®ãŸã‚ã« `useState` ã‚’æ›¸ãã€å ´é¢ã¯  
> â€œã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†é™ã‚Šâ€ **ã»ã¼ TanStack Query ã«ç½®ãæ›ã‚ã£ãŸ**ã€ã¨ã„ã†ã®ãŒç¾å ´æ„Ÿã§ã™ã€‚  
> UI å°‚ç”¨ã®å°ã•ãªå€¤ã¯ç›¸å¤‰ã‚ã‚‰ãš `useState` ã§ã‚µã‚¯ãƒƒã¨å®šç¾©ã™ã‚‹ã®ãŒæœ€çŸ­ã€‚

---

### ã©ã†ã—ã¦ `useState` ã‚’æ‰‹æ”¾ã›ãŸã®ã‹ï¼Ÿ

| å¾“æ¥ (`useState` + `useEffect`) | ä»Š (`useQuery`) |
|---|---|
| **3ã€œ4 å€‹ã® state** (`data`, `loading`, `error`, `retryCount` â€¦) ã‚’æ‰‹å‹•ã§åŒæœŸã•ã›ã‚‹ | `const { data, isLoading, error } = useQuery(...)` â€• **1 è¡Œã§ä¸‰ä½ä¸€ä½“** |
| å†ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ»ãƒªãƒˆãƒ©ã‚¤ãƒ»`AbortController` ã‚’è‡ªå‰å®Ÿè£… | ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ `retry`, `retryDelay`, `staleTime`, `refetchOnWindowFocus` |
| ã‚­ãƒ£ãƒƒã‚·ãƒ¥å…±æœ‰ã‚’è‡ªåˆ†ã§ Context ã«ç§»ã™ | è‡ªå‹•ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‹ã‚­ãƒ¼åŸºæº–ã§å…¨ç”»é¢å…±æœ‰ |
| å¤±æ•— â‡’ å·»ãæˆ»ã—ã‚‚è‡ªå‰ | `useMutation({ onMutate, onError })` ãŒãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ |

---

### ãã‚Œã§ã‚‚ `useState` ãŒæ®‹ã‚‹å…¸å‹ãƒ‘ã‚¿ãƒ¼ãƒ³

| ä¾‹ | ç†ç”± |
|----|------|
| ãƒ¢ãƒ¼ãƒ€ãƒ«é–‹é–‰ã€ã‚¿ãƒ–é¸æŠã€ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç®¡ç† | **ã‚µãƒ¼ãƒãƒ¼ã«ä¾å­˜ã—ãªã„ UI ãƒ•ãƒ©ã‚°**ãªã®ã§ Query ã«ä¹—ã›ã‚‹ã¨é€†ã«ã‚³ã‚¹ãƒˆé«˜ |
| Canvas æ“ä½œåº§æ¨™ã€ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®åº§æ¨™ | é«˜é »åº¦æ›´æ–° (ms å˜ä½) ã¯ `useState` ãŒä¸€ç•ªè»½ã„ |
| å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ­ãƒ¼ã‚«ãƒ«å€¤ | ã‚µãƒ¼ãƒãƒ¼ã«é€ã‚‹ã¾ã§ä»–ç”»é¢ã¨å…±æœ‰ä¸è¦ |

---

### Next.js ã‚’ä½¿ã†ã¨ã‚‚ã£ã¨æ¸›ã‚‹ï¼Ÿ

- **Server Components + Server Actions** ã§ã€Œåˆå›å–å¾—ï¼‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€ã‚’ã‚µãƒ¼ãƒãƒ¼å¯„ã‚Šã«å¸å  
- ãŸã ã— **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§å†ãƒ•ã‚§ãƒƒãƒãŒå¿…è¦ãªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ**ï¼ˆãƒãƒ£ãƒ¼ãƒˆã€PWA ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç”»é¢ãªã©ï¼‰ã¯æ®‹ã‚‹  
- ãã®éƒ¨åˆ†ã ã‘ **TanStack Query ã‚’ä½¿ã†**æ§‹æˆãŒæ¨å¥¨ã•ã‚Œã¦ã„ã‚‹ îˆ€citeîˆ‚turn0search3îˆ

---

## ã¾ã¨ã‚

* **ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã‚„æ¥½è¦³çš„æ›´æ–°**ã¯ React 19 ã® `useActionState` / `useOptimistic` ã§æ¨™æº–åŒ–ã€‚
* **ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿å–å¾—ã®åˆæœŸãƒ­ãƒ¼ãƒ‰ãƒ»å†å–å¾—ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥**ã¯ `useQuery` ãŒ 1 è¡Œã§è‚©ä»£ã‚ã‚Šã€‚
* ã‚ˆã£ã¦ â€œãƒ‡ãƒ¼ã‚¿å–å¾—ã®ãŸã‚ã« `useState` ã§ `loading` ã‚’æŠ±ãˆã‚‹â€ ã‚³ãƒ¼ãƒ‰ã¯ **ã»ã¼ä¸è¦**ã€‚
* ãŸã ã— **ç´” UI ç”¨ã®è»½ã„çŠ¶æ…‹**ã‚„é«˜é »åº¦æ›´æ–°ã¯ã€ä»Šã§ã‚‚ `useState` ãŒæœ€çŸ­ãƒ»æœ€è»½é‡ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/16 19:56:18*

Flutterã§ã„ã†ã¨ã“ã‚ã®ã€Riverpodã‚„hookã®é–¢ä¿‚ã«è¿‘ã„ã‹ï¼Ÿ

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/16 19:56:19*

### â€œReact Ã— Query + Zustandâ€ ã¨  
### â€œFlutter Ã— hooks_riverpodâ€ ã‚’ä¸¦ã¹ã¦ã¿ã‚‹

| æ¦‚å¿µ | **React** å´ | **Flutter** å´ (hooks_riverpod) | ã‚³ãƒ¡ãƒ³ãƒˆ |
|------|--------------|---------------------------------|----------|
| **è¨€èªãƒ¬ãƒ™ãƒ«ã®ã€Œãƒ•ãƒƒã‚¯ã€ä»•çµ„ã¿** | `useState` / `useEffect` â€¦<br>React ã«æ¨™æº–æ­è¼‰ | `HookWidget` / `useState()` â€¦<br>_hooks_riverpod_ ãŒ Flutter ã«ãƒ•ãƒƒã‚¯ API ã‚’æŒã¡è¾¼ã‚€ | React ã§ã¯ Hooks ãŒã‚³ã‚¢æ©Ÿèƒ½ã€Flutter ã§ã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ‹¡å¼µ |
| **ãƒ­ãƒ¼ã‚«ãƒ«ã€œã‚¢ãƒ—ãƒªå†…ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹** | **Zustand** 1 kB å°ã‚¹ãƒˆã‚¢<br>ï¼ˆ`create()` ã§å€¤ã¨ãƒ¡ã‚½ãƒƒãƒ‰ï¼‰ | `StateProvider` / `StateNotifierProvider` | Riverpod ã‚‚ zustand ã‚‚ã€Œè»½é‡ã‚¹ãƒˆã‚¢ + éƒ¨åˆ†è³¼èª­ã€ãŒå¾—æ„ |
| **ã‚µãƒ¼ãƒãƒ¼ï¼ˆéåŒæœŸãƒªãƒ¢ãƒ¼ãƒˆï¼‰çŠ¶æ…‹** | **TanStack Query**<br>ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»SWRãƒ»ãƒªãƒˆãƒ©ã‚¤ï¼‰ | `FutureProvider` / `StreamProvider` ã§éåŒæœŸå€¤<br>ï¼‹è‡ªå‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚„ `dio_cache_interceptor` ãªã© | Riverpodã¯ã€Œä½•ã§ãƒ•ã‚§ãƒƒãƒã™ã‚‹ã‹ã€ã€Œã‚­ãƒ£ãƒƒã‚·ãƒ¥æ–¹é‡ã€ã‚’é–‹ç™ºè€…ãŒé¸ã¶ã€‚Queryã¯â€œHTTPã‚­ãƒ£ãƒƒã‚·ãƒ¥å±¤â€è¾¼ã¿ã®å®Œæˆå“ |
| **æ¥½è¦³çš„æ›´æ–°** | `useMutation({ optimisticData })`<br>or React19 `useOptimistic` | Riverpod å´ã¯è‡ªä½œ (`ref.invalidate` ãªã©ã§ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯) | â€œæ›¸ãè¡Œæ•°â€ ã¯ Query > å°‘ãªã„ |
| **ä¾å­˜è§£æ±º / DI** | Context ã¾ãŸã¯ Zustand ã® `getState` | Riverpod ã¯ DIï¼ˆ`ref.watch()`ï¼‰ãŒæœ¬è· | Riverpod ã®æ–¹ãŒ â€œã‚µãƒ¼ãƒ“ã‚¹ãƒ­ã‚±ãƒ¼ã‚¿â€ ã¨ã—ã¦é«˜æ©Ÿèƒ½ |

> **ã–ã£ãã‚Šç­‰ä¾¡**  
> - **Zustand** â‰ˆ `StateProvider` / `StateNotifierProvider`  
> - **TanStack Query** â‰ˆ (`FutureProvider` + è‡ªä½œã‚­ãƒ£ãƒƒã‚·ãƒ¥ & ãƒªãƒˆãƒ©ã‚¤) ã®â€œå…¨éƒ¨å…¥ã‚Šç‰ˆâ€  
> - **React hooks** ã¯ Flutter ã® `hooks_riverpod` ãŒæä¾›ã™ã‚‹ `useXxx` ç¾¤ã«ç›¸å½“

---

### ãªãœ React ã§ã¯ 2 ã¤ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«åˆ†ã‹ã‚Œã¦ã„ã‚‹ã®ï¼Ÿ

* React ã‚³ã‚¢ã« **ã€Œãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã€ã¨ã€Œãƒªãƒ¢ãƒ¼ãƒˆçŠ¶æ…‹ã€ã‚’åˆ†ã‘ã‚‹æ€æƒ³** ãŒå¼·ãã€  
  **UIâ‡„ã‚µãƒ¼ãƒãƒ¼åŒæœŸã ã‘å°‚é–€ã«è§£ããƒ©ã‚¤ãƒ–ãƒ©ãƒª (Query)** ã¨  
  **UI ã ã‘æ‰±ã†è¶…è»½é‡ã‚¹ãƒˆã‚¢ (Zustand)** ãŒä½ã¿åˆ†ã‘ã‚‹æ–‡åŒ–ãŒå‡ºæ¥ãŸã€‚
* Flutter / Riverpod ã¯ **åŒä¸€ Provider ã®æœ¨** ã§ãƒ­ãƒ¼ã‚«ãƒ«ã‚‚ãƒªãƒ¢ãƒ¼ãƒˆã‚‚åŒ…ã‚€è¨­è¨ˆã€‚  
  æ©Ÿèƒ½ã¯ä¸€ä½“ã ãŒã€ŒHTTP ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¾ã§é¢å€’ã‚’è¦‹ã‚‹ã€ã‚ã‘ã§ã¯ãªã„ã€‚

---

### React ã®æ§‹æˆã‚’ Flutter ã®æ„Ÿè¦šã§è¦‹ã‚‹ã¨

```mermaid
graph TD
    subgraph React App
      UI1["ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ A"] --> ZS[Zustand]<-- UI2["ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ B"]
      UI1 --> Q["TanStack Query"] <-- UI3["ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ C"]
    end
```

* **Zustand** ãŒ `StateProvider` ã®å½¹ã€**Query** ãŒ `FutureProvider`ï¼‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å½¹  
* çµæœçš„ã« **hooks_riverpod** ã® `ref.watch()` ãŒ 2 ç³»çµ±ã«åˆ†ã‹ã‚ŒãŸã‚¤ãƒ¡ãƒ¼ã‚¸

---

### ã©ã¡ã‚‰ãŒæ¥½ã‹ï¼Ÿ

| è¦³ç‚¹ | React (Query + Zustand) | Flutter (Riverpod) |
|------|------------------------|--------------------|
| **å­¦ç¿’ã‚³ã‚¹ãƒˆ** | 2 ãƒ©ã‚¤ãƒ–ãƒ©ãƒªè¦šãˆã‚‹å¿…è¦ | 1 ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§å®Œçµ |
| **é€šä¿¡ã¾ã‚ã‚Šã®è¡Œæ•°** | Query ãŒæœ€å°‘ï¼ˆè‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ãƒ»SWR ä»˜ãï¼‰ | `FutureProvider` + æ‰‹å‹•ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã ã¨å¢—ãˆã‚‹ |
| **ä¾å­˜ã®æ˜ç¤ºæ€§** | Hook ã§å®Œçµã€DI ã¯è–„ã‚ | `ref.read()` ã§ DI ãŒæ˜ç¢º |
| **ç§»æ¤æ€§ï¼ˆä»– FWï¼‰** | TanStack Store / Query ãŒ Vanilla JS ã§ä½¿ãˆã‚‹ | Riverpod ã¯ Flutter å°‚ç”¨ |

---

## ã¾ã¨ã‚

* **å½¹å‰²ã®åˆ‡ã‚Šåˆ†ã‘**ã¯ã»ã¼åŒã˜ï¼š  
  ãƒ­ãƒ¼ã‚«ãƒ«/UI çŠ¶æ…‹ã‚¹ãƒˆã‚¢ + éåŒæœŸ/ãƒªãƒ¢ãƒ¼ãƒˆçŠ¶æ…‹ã‚¹ãƒˆã‚¢ã€‚
* **React** ã§ã¯ãã® 2 å½¹ã‚’ **åˆ¥ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**ï¼ˆZustand ã¨ TanStack Queryï¼‰ãŒæ‹…ã„ã€  
  **Flutter** ã§ã¯ **Riverpod** ãŒä¸¡æ–¹ã‚’åŒ…æ‹¬ã—ã¤ã¤ HTTP ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯å¤–éƒ¨ã«ä»»ã›ã‚‹ã€  
  â€¦ã¨ã„ã†å½¢ã§è²¬å‹™åˆ†æ‹…ãŒé•ã†ã ã‘ã€‚  
* å®Ÿè£…ä½“é¨“ã¨ã—ã¦ã¯ **ã€ŒZustand + Query = hooks_riverpod ã® Provider ç¾¤ã€** ã¨è€ƒãˆã‚‹ã¨è¿‘ã„æ„Ÿè¦šã§ç§»è¡Œã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/16 19:58:37*

useQueryã¯ã‚ˆãä½¿ãˆã‚‹ã“ã¨ãŒã‚ã‹ã£ãŸãŒã€ ZustandãŒã„ã¾ã„ã¡ä½¿ã„æ–¹ãŒã‚ã‹ã£ã¦ã„ãªã„
ãã‚Œã“ãã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«åŒ…ã‚“ã ã‚¹ãƒ†ãƒ¼ãƒˆã¯ã€ ãƒ¦ãƒ¼ã‚ºã‚¹ãƒ†ãƒ¼ãƒˆã§ç®¡ç†ã—ãŸæ–¹ãŒæ¥½ãªã‚ˆã†ã«æ€ãˆã‚‹ã€ 
Zustandã¯ã©ã“ã«å‡ºã¦ãã‚‹ã®ã ã‚ã†ã‹ã€‚ ãƒªã‚¢ã‚¯ãƒˆã§ã¯ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã§çŠ¶æ…‹ã‚’æŒã£ãŸã‚Šã—ãªã„ã®ã‹ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/16 19:58:48*

### 1. `useState` ã§ååˆ†ãªã‚±ãƒ¼ã‚¹
| çŠ¶æ…‹ã®æ€§è³ª | å…¸å‹ä¾‹ | ãƒ™ã‚¹ãƒˆãƒãƒ§ã‚¤ã‚¹ |
|------------|--------|---------------|
| **å˜ä¸€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã ã‘ã§å®Œçµ** | ã‚¤ãƒ³ãƒ—ãƒƒãƒˆå€¤ã€é–‹é–‰ãƒ•ãƒ©ã‚°ã€ãƒ›ãƒãƒ¼ä¸­ã‹ã©ã†ã‹ | `useState` / `useReducer` |
| **ãƒ„ãƒªãƒ¼å†…ã§å­ã¸æ¸¡ã™ã ã‘** | è¦ªãŒã‚µã‚¤ã‚ºã‚’è¨ˆç®—ã—ã¦å­ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«æ¸¡ã™ | props ã‹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ |
| **ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã¨åŒæ™‚ã«æ¨ã¦ã¦ã‚ˆã„** | ãƒ¢ãƒ¼ãƒ€ãƒ«å†…éƒ¨ã®ä¸€æ™‚ç·¨é›†ãƒãƒƒãƒ•ã‚¡ | ã€ƒ |

ã“ã‚Œã‚‰ã¯ *â€œãã®å ´é™ã‚Šâ€* ã®çŠ¶æ…‹ãªã®ã§ã€ãƒ•ã‚¡ã‚¤ãƒ«åˆ†é›¢ãƒ»ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³åŒ–ã¯  
ã‹ãˆã£ã¦ã‚ªãƒ¼ãƒãƒ¼ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã«ãªã‚Šã¾ã™ã€‚

---

### 2. ãã‚Œã§ã‚‚ `Zustand` ãŒå½¹ã«ç«‹ã¤å ´é¢
| ä»£è¡¨ã‚·ãƒŠãƒªã‚ª | `useState` ã ã‘ã§ã¯å›°ã‚‹ç†ç”± |
|--------------|---------------------------|
| **è¤‡æ•°ç”»é¢/ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰åŒã˜å€¤ã‚’èª­ã‚€** | `props drilling` åœ°ç„ï¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«å…¨éƒ¨å¯„ã›ã‚‹ã¨ä¸è¦ãƒ¬ãƒ³ãƒ€ãƒ¼ãŒå¢—ãˆã‚‹ |
| **ãƒ«ãƒ¼ãƒˆãŒåˆ‡ã‚Šæ›¿ã‚ã£ã¦ã‚‚æ®‹ã—ãŸã„ UI è¨­å®š** | `useState` ã¯ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã§æ¶ˆæ»… |
| **WebSocketãƒ»BroadcastChannel ãªã© React å¤–ã‚¤ãƒ™ãƒ³ãƒˆã§æ›´æ–°** | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå¤–ã‹ã‚‰ `setState` ã§ããªã„ |
| **Undo/Redoãƒ»å±¥æ­´ç®¡ç†ãƒ»æ°¸ç¶šåŒ–** | `useState` ã§å±¥æ­´é…åˆ—ã‚’æ‰‹ç®¡ç†ã™ã‚‹ã¨è‚¥å¤§ |
| **è¤‡æ•°ã‚¿ãƒ–å…±é€šã®å€¤ã‚’ sessionStorage ã«ä¿æŒ** | æ‰‹å‹• `useEffect` ã§åŒæœŸã‚³ãƒ¼ãƒ‰ã‚’æ›¸ããŒã¡ |

ã“ã‚Œã‚‰ã¯ **ã€Œã‚¢ãƒ—ãƒªå…¨ä½“ãƒ»é•·å¯¿å‘½ã€** ã® UI çŠ¶æ…‹ã§ã€å°‚ç”¨ã‚¹ãƒˆã‚¢ãŒã‚ã£ãŸæ–¹ãŒ  
_**â‘ ã‚³ãƒ¼ãƒ‰ãŒæ•£ã‚‰ã‹ã‚‰ãªã„â€ƒâ‘¡å†ãƒ¬ãƒ³ãƒ€ãƒ¼ãŒæœ€å°**_ ã«ãªã‚Šã¾ã™ã€‚îˆ€citeîˆ‚turn0search3îˆ‚turn0search9îˆ

---

### 3. Zustand ã‚¹ãƒˆã‚¢ã¯ â€œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å˜ä½ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³â€
```ts
// src/store/theme.ts         â† 1 ãƒ•ã‚¡ã‚¤ãƒ« = 1 ã‚¹ãƒˆã‚¢
import { create } from "zustand";

type Theme = "light" | "dark";

export const useThemeStore = create<{
  theme: Theme;
  toggle: () => void;
}>((set) => ({
  theme: "light",
  toggle: () => set((s) => ({ theme: s.theme === "light" ? "dark" : "light" })),
}));
```

*ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `import` ã™ã‚‹æ™‚ç‚¹ã§ store ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒ 1 ã¤ã ã‘ç”Ÿæˆ*ã€‚  
React ãƒ„ãƒªãƒ¼ã¨ã¯ç‹¬ç«‹ã—ãŸ **ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ä¿æŒ** ãªã®ã§ã€ã©ã®ç”»é¢ã‹ã‚‰ã§ã‚‚åŒã˜çŠ¶æ…‹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚îˆ€citeîˆ‚turn0search5îˆ

```tsx
// Header.tsx
const theme = useThemeStore((s) => s.theme);
<button onClick={() => useThemeStore.getState().toggle()}>
  {theme === "light" ? "ğŸŒ™" : "â˜€ï¸"}
</button>

// App.tsx
<div className={theme}>â€¦</div>
```

* `useThemeStore(selector)` ã§ **å¿…è¦ãª slice ã ã‘è³¼èª­**  
  â†’ åˆ¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒä»–ã® slice ã‚’æ›´æ–°ã—ã¦ã‚‚ã€è³¼èª­éƒ¨ãŒå¤‰ã‚ã‚‰ãªã‘ã‚Œã°å†ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¼ãƒ­ã€‚

---

### 4. `useState` â†” Zustand ã®åˆ‡ã‚Šåˆ†ã‘æ—©è¦‹è¡¨

| è³ªå• | â€œã¯ã„â€ãªã‚‰â€¦ |
|------|-----------|
| **è¤‡æ•°ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ/ãƒšãƒ¼ã‚¸ã§å…±æœ‰ã™ã‚‹ï¼Ÿ** | Zustand |
| **React ä»¥å¤–ã®ã‚¤ãƒ™ãƒ³ãƒˆã§æ›´æ–°ãŒé£›ã¶ï¼Ÿ** (WebSocket, postMessageâ€¦) | Zustand |
| **ç”»é¢ã‚’é›¢ã‚Œã¦æˆ»ã£ã¦ã‚‚å€¤ã‚’ä¿æŒã—ãŸã„ï¼Ÿ** | Zustand(ï¼‹`persist`ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢) |
| **å˜ä¸€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Œçµï¼Ÿ / ç ´æ£„ã—ã¦è‰¯ã„ï¼Ÿ** | `useState` ã§ååˆ† |

---

### 5. React ã§ â€œã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã‚’ç›´æ¥æ›¸ãâ€ ã®ã¯æ¨å¥¨ï¼Ÿ
- JS ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è‡ªä½“ã‚‚å®Ÿã¯ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã§ã™ãŒ  
  **å†ãƒ¬ãƒ³ãƒ€ãƒ¼ã¨ã®çµåˆãŒå¼±ãã€æ›´æ–°é€šçŸ¥ã‚’è‡ªå‰ã§è¡Œã†** å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  
- Zustand ã¯ `useSyncExternalStore` ãƒ™ãƒ¼ã‚¹ã§ **é€šçŸ¥ã¨æœ€é©è³¼èª­ã‚’è‡ªå‹•åŒ–**ã€‚  
  æ‰‹æ›¸ãã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã‚ˆã‚Šã¯ **å®‰å…¨ã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŠ¹ç‡ãŒé«˜ã„** ãŸã‚ã€  
  _â€œå°ã•ãªã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚’æŒã¡ãŸã„ã ã‘â€_ ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã§é¸ã°ã‚Œã¦ã„ã¾ã™ã€‚îˆ€citeîˆ‚turn0search6îˆ

---

## âœ… ã¾ã¨ã‚
1. **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã ã‘ã§å®Œçµ** â†’ `useState` ãŒæœ€é€Ÿã€‚  
2. **è¤‡æ•°ç”»é¢ã§å…±æœ‰ãƒ»æ°¸ç¶šåŒ–ãƒ»å¤–éƒ¨ã‚¤ãƒ™ãƒ³ãƒˆ** â†’ **Zustand** ãŒå‡ºç•ªã€‚  
3. Zustand ã‚¹ãƒˆã‚¢ã¯ *1 ãƒ•ã‚¡ã‚¤ãƒ« = 1 ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³*ã€‚React ã®å¤–ã§ã‚‚èª­ã‚ã‚‹ãŒã€è³¼èª­ã¯ hook ã§æœ€é©åŒ–ã€‚  
4. è¿·ã£ãŸã‚‰ã€Œãƒ„ãƒªãƒ¼ã‚’ã¾ãŸã„ã§åŒã˜çŠ¶æ…‹ã‚’æŒã¡ãŸã„ã‹ã€ã§åˆ¤æ–­ã™ã‚‹ã¨å¤±æ•—ãŒå°‘ãªã„ã§ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/16 19:59:33*

è¤‡æ•°ç”»é¢ã§å…±æœ‰ãƒ»æ°¸ç¶šåŒ–ãƒ»å¤–éƒ¨ã‚¤ãƒ™ãƒ³ãƒˆ â†’ Zustand ãŒå‡ºç•ªã§ã‚ã‚‹ãªã‚‰ã°ã€å¤‰æ›´ã®æ¤œçŸ¥ã¯ã©ã†ã‚„ã£ãŸã‚‰ã§ãã‚‹ã®ã‹ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/16 19:59:33*

## Zustand ã§ã€Œå¤‰æ›´ã‚’æ¤œçŸ¥ã€ã™ã‚‹ 3 ã¤ã®æ–¹æ³•

| ä½¿ã†å ´æ‰€ | æ¤œçŸ¥æ–¹æ³• | å…¸å‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ |
|----------|----------|------------------|
| **React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…** | `useStore(selector)` ãƒ•ãƒƒã‚¯ã§è³¼èª­ | ç”»é¢ã‚’è‡ªå‹•å†ãƒ¬ãƒ³ãƒ€ãƒ¼ |
| **React ã®å¤–ï¼ˆWebSocket ãªã©ï¼‰** | `store.subscribe(listener)` | é€šçŸ¥ãƒãƒƒãƒ•ã‚¡ã€Service Workerã€BroadcastChannel |
| **ç‰¹å®šãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã ã‘ç›£è¦–** | `subscribeWithSelector` ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ | ã€Œcount ã ã‘å¤‰ã‚ã£ãŸã‚‰â€¦ã€ãªã©ç´°ç²’åº¦æ¤œçŸ¥ |

> Zustand ã‚¹ãƒˆã‚¢ã¯ **Redux ã¨åŒã˜ã€ŒPub/Subã€** ä»•çµ„ã¿ã‚’å†…è”µã—ã¦ãŠã‚Šã€  
> React ã§ã‚‚ React ä»¥å¤–ã§ã‚‚ **åŒã˜ API** ã§å¤‰æ›´ã‚’ãƒ•ãƒƒã‚¯ã§ãã¾ã™ã€‚

---

### 1. React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã®æ¤œçŸ¥ï¼ˆã‚‚ã£ã¨ã‚‚é »ç¹ï¼‰

```ts
// store/counter.ts
import { create } from "zustand";

export const useCounter = create<{ count: number; inc: () => void }>((set) => ({
  count: 0,
  inc: () => set((s) => ({ count: s.count + 1 })),
}));
```

```tsx
function CounterButton() {
  const count = useCounter((s) => s.count);     // â† selector ã§ count ã ã‘è³¼èª­
  const inc   = useCounter((s) => s.inc);

  /* ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ count ãŒå¤‰ã‚ã£ãŸæ™‚ã ã‘å†ãƒ¬ãƒ³ãƒ€ãƒ¼ */
  return <button onClick={inc}>Clicked {count}</button>;
}
```

- **selector ã‚’æ¸¡ã™** â†’ ãã® slice ãŒå¤‰ã‚ã‚‰ãªã„é™ã‚Šå†ãƒ¬ãƒ³ãƒ€ãƒ¼ã—ãªã„  
- è¿½åŠ è¨­å®šã‚¼ãƒ­ã§ã€Œæœ€å°ãƒ¬ãƒ³ãƒ€ãƒ¼ & è‡ªå‹•è³¼èª­è§£é™¤ã€ã¾ã§é¢å€’ã‚’è¦‹ã¦ãã‚Œã¾ã™

---

### 2. React å¤–ã§è³¼èª­ (`store.subscribe`)

```ts
// éã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé ˜åŸŸ (WebSocket å—ä¿¡å‡¦ç†ãªã©)
import { useCounter } from "@/store/counter";

// â‘  å…¨å¤‰æ›´ã‚’æ‹¾ã†
const unsubscribe = useCounter.subscribe((state, prev) => {
  console.log("any change", state, prev);
});

// â‘¡ BroadcastChannel ã«æµã™
useCounter.subscribe((state) => {
  bc.postMessage(state);           // å¤–éƒ¨ã¸é€šçŸ¥
});
```

- **æˆ»ã‚Šå€¤ã¯è§£é™¤é–¢æ•°** â€” ã‚¿ã‚¤ãƒãƒ¼ã‚„ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã¨åˆã‚ã›ã¦æ‰‹å‹•ã§ `unsubscribe()`  
- React ã‚’ä»‹ã•ãªã„ã®ã§ **Service Worker / Node.js å´** ã‹ã‚‰ã§ã‚‚ä½¿ãˆã¾ã™

---

### 3. ç‰¹å®šã‚­ãƒ¼ã ã‘ç›£è¦– (`subscribeWithSelector`)

```ts
import { create } from "zustand";
import { subscribeWithSelector } from "zustand/middleware";

const useStore = create(
  subscribeWithSelector((set) => ({
    user: null as User | null,
    setUser: (u: User) => set({ user: u }),
    wsConnected: false,
    setWsConnected: (b: boolean) => set({ wsConnected: b }),
  })),
);

// count å¤‰æ›´ã ã‘ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
useStore.subscribe(
  (s) => s.wsConnected,         // selector
  (connected, prev) => {
    console.log("WebSocket â†’", connected);
  },
);
```

* `subscribeWithSelector` ã‚’æŒŸã‚€ã¨ **selector + equalityFn()** ãŒä½¿ãˆã‚‹  
* â€œWebSocket ãŒå†æ¥ç¶šã—ãŸã‚‰ã ã‘ä½•ã‹ã—ãŸã„â€ ãªã©ç„¡é§„ãƒˆãƒªã‚¬ãƒ¼ã‚’å‰Šæ¸›ã§ãã¾ã™

---

## ã‚ˆãã‚ã‚‹ç–‘å•

### Q1. **ã€Œã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã§æŒã¤ã€ã£ã¦ã©ã†ã„ã†ã“ã¨ï¼Ÿ**

```ts
// importing this file anywhere returns *the same* store instance
import { useCounter } from "@/store/counter";
```

- `create()` ãŒè¿”ã™ **é–¢æ•° (hook) ã¨å†…éƒ¨ã‚¹ãƒˆã‚¢** ã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å˜ä½ã§ 1 å€‹ã ã‘  
- React ãƒ„ãƒªãƒ¼ã‚’ã¾ãŸã„ã§ã‚‚ã¾ã£ãŸãåŒã˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å…±æœ‰ã—ã¾ã™  
  ï¼ˆå®Ÿè³ª **ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³**ã€‚ãŸã ã—ãƒ†ã‚¹ãƒˆæ™‚ã¯ `jest.resetModules()` ã§åˆ†é›¢å¯ï¼‰

### Q2. **`useState` ã§ lift-up ã—ã¦ Context å…±æœ‰ã™ã‚Œã°è‰¯ããªã„ï¼Ÿ**

- å°è¦æ¨¡ãªã‚‰ OKã€‚ãŸã  **ã€Œå¤–éƒ¨ã‚¤ãƒ™ãƒ³ãƒˆ â†’ Context æ›´æ–°ã€** ã‚’å®Ÿè£…ã™ã‚‹ã¨  
  - `useEffect` ï¼‹ `useReducer` ã§ Pub/Sub ã‚’æ‰‹æ›¸ã  
  - ä¾å­˜é–¢ä¿‚ç®¡ç†ãƒ»å†ãƒ¬ãƒ³ãƒ€ãƒ¼æœ€é©åŒ–ã‚’è‡ªåˆ†ã§è€ƒãˆã‚‹  
- Zustand ã ã¨ **10 è¡Œã§å®Œæˆ & ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹èª¿æ•´æ¸ˆã¿**ã€‚  
  ã€Œä¸€åº¦ã§ã‚‚ props drilling / Context flood ã«æ‚©ã‚“ã ã‚‰ã‚¹ãƒˆã‚¢æ¡ç”¨ã€ãŒåˆå›³ã§ã™ã€‚

### Q3. **æ°¸ç¶šåŒ–ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼‰ã¨çµ„ã¿åˆã‚ã›ãŸã„**

```ts
import { persist } from "zustand/middleware";

export const useSettings = create(
  persist(
    (set) => ({ theme: "light", setTheme: (t) => set({ theme: t }) }),
    { name: "settings-storage" },
  ),
);
```

- `persist` ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’å™›ã¾ã›ã‚‹ã ã‘  
- ä»¥é™ **`setTheme()` ã™ã‚‹ã¨è‡ªå‹•ã§ localStorage æ›´æ–°**  
- `subscribe()` ã‚‚ä½µç”¨ã§ãã‚‹ã®ã§ã€Œæ›¸ãè¾¼ã¿å¾Œã« Analytics é€ä¿¡ã€ãªã©è‡ªåœ¨

---

## âœ”ï¸ ã¾ã¨ã‚

1. **ç”»é¢å†…ãƒ­ãƒ¼ã‚«ãƒ«ã ã‘ãªã‚‰ `useState`** ã§ååˆ†ã€‚  
2. **è¤‡æ•°ç”»é¢ï¼å¤–éƒ¨ã‚¤ãƒ™ãƒ³ãƒˆï¼æ°¸ç¶šåŒ–** ãŒå¿…è¦ã«ãªã£ãŸç¬é–“ â†’ **Zustand**ã€‚  
3. å¤‰æ›´æ¤œçŸ¥ã¯  
   - React å†…ï¼š`useStore(selector)` *(è‡ªå‹•å†ãƒ¬ãƒ³ãƒ€ãƒ¼)*  
   - React å¤–ï¼š`store.subscribe()` *(æ‰‹å‹•è§£é™¤)*  
   - éƒ¨åˆ†ç›£è¦–ï¼š`subscribeWithSelector` *(æœ€å°é€šçŸ¥)*  
4. ã‚¹ãƒˆã‚¢ã¯ **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³**ã€‚ä½•åº¦ import ã—ã¦ã‚‚åŒã˜å®Ÿä½“ã‚’å…±æœ‰ã€‚  

ã“ã‚Œã§ã€Œã„ã¤ `useState` ã‚’å’æ¥­ã—ã€ã©ã†ã‚„ã£ã¦ Zustand ã§æ¤œçŸ¥ã™ã‚Œã°ã„ã„ã®ã‹ã€ãŒã‚¤ãƒ¡ãƒ¼ã‚¸ã—ã‚„ã™ããªã‚‹ã¯ãšã§ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/16 20:02:07*

TanStack Queryã§ã®å¤‰æ›´æ¤œçŸ¥ã¯ã©ã†ã™ã‚Œã°ã„ã„ã®ã‹ã€‚ ãã‚‚ãã‚‚è³ªå•ãŒé–“é•ã£ã¦ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ãŒã€

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/16 20:02:44*

### TanStack Query ã«ã¯ 2 æ®µéšã® â€œå¤‰åŒ–æ¤œçŸ¥â€ ãŒã‚ã‚‹
| è¦–ç‚¹ | ã©ã†æ¤œçŸ¥ã™ã‚‹ã‹ | ã„ã¤ä½¿ã†ï¼Ÿ |
|------|---------------|------------|
| **React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**<br>(UI ã‚’å†æç”»ã—ãŸã„) | `useQuery / useMutation` ã‚’å‘¼ã‚“ã ç¬é–“ **è‡ªå‹•è³¼èª­**<br>â†’ ãƒ‡ãƒ¼ã‚¿ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒå¤‰ã‚ã‚Œã°ãã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã ã‘å†ãƒ¬ãƒ³ãƒ€ãƒ¼ | ã»ã¼ã™ã¹ã¦ã®ç”»é¢ã‚³ãƒ¼ãƒ‰ |
| **React ã®å¤–å´**<br>(ãƒ­ã‚°é€ä¿¡ãƒ»Service Workerãƒ»BroadcastChannel ç­‰) | `queryClient.getQueryCache().subscribe(callback)` ã§ **ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­** | ã€Œãƒ‡ãƒ¼ã‚¿ãŒå¤‰ã‚ã£ãŸã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é£›ã°ã™ã€ãªã©ã€å‰¯ä½œç”¨ã ã‘å®Ÿè¡Œã—ãŸã„æ‰€ |

---

## 1 â”‚ UI ã§ã®æ¤œçŸ¥ â€• `useQuery` ã ã‘ã§å®Œçµ

```tsx
const { data, isFetching, isLoading, error } = useQuery({
  queryKey: ['todos'],
  queryFn : fetchTodos,
  // ğŸ”” å†ãƒ•ã‚§ãƒƒãƒãŒæˆåŠŸã™ã‚‹ãŸã³ã«å‘¼ã°ã‚Œã‚‹
  onSuccess: (newData) => analytics.track('todos_loaded', { rows: newData.length }),
});
```

* **å†ãƒ•ã‚§ãƒƒãƒ**ãƒ»**ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ›´æ–°**ãƒ»**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰åŒ–**ãŒèµ·ã“ã‚‹ãŸã³ã«  
  `useQuery` ã‚’å‘¼ã‚“ã ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã ã‘ãŒå†ãƒ¬ãƒ³ãƒ€ãƒ¼ã•ã‚Œã¾ã™ã€‚  
* è¿½åŠ ã§å‰¯ä½œç”¨ã‚’æ›¸ããŸã„ã¨ãã¯ `onSuccess / onError / onSettled` ã«æ¸¡ã™ã ã‘ã€‚  
  â†’ æ‰‹å‹•ã§ `useEffect([data])` ã‚’æ›¸ãå¿…è¦ã¯ã»ã¼ç„¡ã„ã€‚îˆ€citeîˆ‚turn0search9îˆ

### ã€Œã„ã¾ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸­ã‹ï¼Ÿã€ã ã‘çŸ¥ã‚ŠãŸã„  
```tsx
const globalFetching = useIsFetching({ queryKey: ['todos'] }); // 0 ãªã‚‰ã‚¢ã‚¤ãƒ‰ãƒ«
```

---

## 2 â”‚ React å¤–ã§ã®æ¤œçŸ¥ â€• `queryCache.subscribe`

```ts
import { queryClient } from '@/lib/queryClient';

// ğŸ”” ã™ã¹ã¦ã® Query æ›´æ–°ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒ•ãƒƒã‚¯
const unsubscribe = queryClient
  .getQueryCache()
  .subscribe((event) => {
    if (event.type === 'updated' && event.query.queryKey[0] === 'todos') {
      const latest = event.query.state.data;
      broadcast.postMessage({ type: 'todos-updated', payload: latest });
    }
  });

// è§£é™¤ã¯æˆ»ã‚Šå€¤ã§
window.addEventListener('beforeunload', unsubscribe);
```

* `event.type` â€¦ `'added' | 'updated' | 'removed'`  
* `event.query` â€¦ å¤‰æ›´ãŒèµ·ã“ã£ãŸ **Query ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹**  
* 1 è¡Œã§ **å…¨ Query ã® Pub/Sub** ãŒçµ„ã‚ã‚‹ãŸã‚ã€  
  - Service Worker ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æµã™  
  - DevTools ä»¥å¤–ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ«ã‚’ä½œã‚‹  
  - ãƒãƒ«ãƒã‚¿ãƒ–åŒæœŸã‚’ BroadcastChannel ã§è‡ªä½œã™ã‚‹  
  ã¨ã„ã£ãŸ â€œReact ã‹ã‚‰ç‹¬ç«‹ã—ãŸã‚µã‚¤ãƒ‰ã‚¨ãƒ•ã‚§ã‚¯ãƒˆâ€ ã«ä½¿ãˆã¾ã™ã€‚îˆ€citeîˆ‚turn0search0îˆ‚turn0search4îˆ

---

## 3 â”‚ Mutation ã‹ã‚‰ã®æ¤œçŸ¥ï¼ˆå‰¯ä½œç”¨ï¼‰  
å¤‰æ›´ãŒã€Œæ›¸ãè¾¼ã¿ã€ç”±æ¥ãªã‚‰ã€**Mutation ã«ç›´æ¥ãƒ•ãƒƒã‚¯**ã™ã‚‹ã®ãŒæœ€çŸ­ã§ã™ã€‚

```ts
const likePost = useMutation({
  mutationFn : api.likePost,
  onSuccess  : () => {
    queryClient.invalidateQueries({ queryKey: ['posts'] });   // èª­ã¿å–ã‚Šå´ã‚’å…¨è‡ªå‹•æ›´æ–°
    toast.success('Liked!');
  },
  onError    : () => toast.error('Failedâ€¦'),
});
```

* `invalidateQueries` ã§ **â€œèª­ã‚€å´â€ ã‚’ä¸€æ–‰ã«å†ãƒ•ã‚§ãƒƒãƒçŠ¶æ…‹**ã¸  
* UI ã¯ `useQuery` ã®è³¼èª­ã®ãŠã‹ã’ã§ä½•ã‚‚æ›¸ã‹ãšã«æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã¸å·®ã—æ›¿ã‚ã‚‹

---

## 4 â”‚ ã€ŒZustand ã® subscribeã€ã¨ã®é•ã„ã‚’æ•´ç†

|               | **Zustand** | **TanStack Query** |
|---------------|-------------|--------------------|
| ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè³¼èª­ | ãªã—ï¼ˆè‡ªåˆ†ã§ `useStore(sel)` ã‚’æ›¸ãï¼‰ | `useQuery` ã‚’å‘¼ã¶ã ã‘ |
| å¤–éƒ¨è³¼èª­      | `store.subscribe(listener)` | `queryCache.subscribe(listener)` |
| ç›£è¦–å¯¾è±¡      | *ãƒ­ãƒ¼ã‚«ãƒ« / UI çŠ¶æ…‹* | *ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ã¨ãã®ãƒ¡ã‚¿æƒ…å ±* |
| å…¸å‹å‰¯ä½œç”¨    | Analyticsã€ãƒ†ãƒ¼ãƒåˆ‡æ›¿ã€UI ãƒ•ãƒ©ã‚° | ãƒãƒ«ãƒã‚¿ãƒ– PWAã€DevTools æ‹¡å¼µã€ãƒ­ã‚®ãƒ³ã‚° |

> è¦ã™ã‚‹ã« **ã€Œèª­ã‚“ã§ã„ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å†æç”»ã—ãŸã„ã‹ï¼Ÿ â‡¢ `useQuery`ã€**  
> **ã€ŒReact ã®å¤–ã§ä½•ã‹ã—ãŸã„ã‹ï¼Ÿ â‡¢ `queryCache.subscribe`ã€** ã ã‘è¦šãˆã‚Œã° OK ã§ã™ã€‚

---

### ãƒŸãƒ‹ã¾ã¨ã‚

* **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã®å¤‰åŒ–æ¤œçŸ¥**  
  *â†’* `useQuery` / `useMutation` ãŒè‡ªå‹•ã§å†ãƒ¬ãƒ³ãƒ€ãƒ¼  
  *è¿½åŠ ã®å‰¯ä½œç”¨ã¯ `onSuccess` ãªã©ã«æ›¸ãã ã‘*  
* **React å¤–ã®ã‚µã‚¤ãƒ‰ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ**  
  *â†’* `queryClient.getQueryCache().subscribe` ã‚’ 1 è¡Œè¶³ã™  
* **æ›¸ãè¾¼ã¿å¾Œã«èª­å–ã‚’æ›´æ–°ã—ãŸã„**  
  *â†’* Mutation ã§ `invalidateQueries` or `setQueryData`

ã“ã‚ŒãŒ TanStack Query æµã® â€œå¤‰æ›´æ¤œçŸ¥â€ ã®å…¨ä½“åƒã§ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/16 20:05:49*

æ”¹ã‚ã¦è³ªå•ã™ã‚‹ã‘ã©ã€ 

react+viteã§ã‚·ãƒ³ãƒ—ãƒ«ãªå®Ÿè£…ã‚’ã—ã¦ã„ã‚‹ã€‚
APIã‚’å‘¼ã³å‡ºã™ã‚ˆã†ãªç”»é¢ã§ã€ç”»é¢ã«ã‚ã¾ã‚Šãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ··ãœãŸããªã„ã€ 
ã©ã†ã„ã£ãŸå®Ÿè£…ã‚’ã™ã‚‹ã®ãŒè‰¯ã„ã‹ã€ã¾ãŸã‚·ãƒ³ãƒ—ãƒ«ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚„ãã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ãªã©ãŒã‚ã‚Œã°æ•™ãˆã¦ã»ã—ã„ã€‚ 
ãƒã‚¯ã‚¹ãƒˆJSã¯ã‚ã¾ã‚Šä½¿ã„ãŸããªã„ã€‚ 
ã‚ã¨ãƒªã‚¢ã‚¯ãƒˆãƒ«ãƒ¼ã‚¿ãƒ¼ã¯ä½¿ã£ã¦ã„ã‚‹ã€‚
APIã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ã¯è‡ªå‹•ç”Ÿæˆã—ãŸã‚‚ã®ã‚’ä½¿ã£ã¦ã„ã‚‹ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/16 20:05:56*

æœ€å°‘ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ **ã€ŒUI ã¯è–„ãï¼ãƒ­ã‚¸ãƒƒã‚¯ã¯åˆ¥å±¤ã€** ã‚’ä¿ã¤ãªã‚‰  
ä»¥ä¸‹ã® 4-ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹æˆãŒã„ã¡ã°ã‚“ã‚·ãƒ³ãƒ—ãƒ«ã«åã¾ã‚Šã¾ã™ã€‚

```
src/
â”œ api/              # openapi-generator ç­‰ã§è‡ªå‹•ç”Ÿæˆï¼ˆç·¨é›†ã—ãªã„ï¼‰
â”œ services/         # ç”Ÿæˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ãƒ‰ãƒ¡ã‚¤ãƒ³èªã§åŒ…ã‚€
â”œ hooks/            # TanStack Query, Mutation ã‚’ 1 ç”»é¢ï¼1 ãƒ•ãƒƒã‚¯åŒ–
â”œ store/            # UI ã‚°ãƒ­ãƒ¼ãƒãƒ«å€¤ãŒè¦ã‚‹ãªã‚‰ Zustand (ä»»æ„)
â”œ components/       # å†åˆ©ç”¨ç´” UI (Button, Cardâ€¦)
â”œ pages/            # react-router ã®å„ç”»é¢ã€‚ã“ã“ã¯è¶…è–„ã
â”” App.tsx           # QueryClientProvider + Router
```

---

## 1ï¸âƒ£ ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ 2 ã¤ã ã‘

| ç›®çš„ | ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | npm i â€¦ |
|------|-----------|---------|
| ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ï¼ˆå–å¾—ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»SWRï¼‰ | **@tanstack/react-query** | `@tanstack/react-query` |
| ç”»é¢é·ç§» | **react-router-dom** | `react-router-dom` |

> UI ã‚°ãƒ­ãƒ¼ãƒãƒ«å€¤ãŒæœ¬å½“ã«å¿…è¦ã«ãªã£ãŸã‚‰å¾Œä»˜ã‘ã§ **zustand** ã‚’ 1 kB ã ã‘è¼‰ã›ã‚‹ã€‚  
> ã¾ã è¦ã‚‰ãªã‘ã‚Œã°å…¥ã‚Œãªã„æ–¹ãŒä¾å­˜ã‚’æ¸›ã‚‰ã›ã¾ã™ã€‚  

---

## 2ï¸âƒ£ QueryClient ã¨ Router ã‚’ãƒ«ãƒ¼ãƒˆã«ç½®ã

```tsx
// src/App.tsx
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { BrowserRouter, Routes, Route } from "react-router-dom";
import UsersPage        from "@/pages/UsersPage";
import UserDetailPage   from "@/pages/UserDetailPage";

const qc = new QueryClient({
  defaultOptions: {
    queries: { staleTime: 5 * 60_000, refetchOnWindowFocus: false }, // SWR îˆ€citeîˆ‚turn0search0îˆ
  },
});

export default function App() {
  return (
    <QueryClientProvider client={qc}>
      <BrowserRouter>
        <Routes>
          <Route path="/users"      element={<UsersPage />} />
          <Route path="/users/:id"  element={<UserDetailPage />} />
        </Routes>
      </BrowserRouter>
    </QueryClientProvider>
  );
}
```

*`QueryClientProvider` ã¯ 1 å›ã ã‘ç½®ã‘ã° **å…¨ç”»é¢ã§åŒã˜ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ—ãƒ¼ãƒ«** ãŒä½¿ãˆã¾ã™ã€‚*

---

## 3ï¸âƒ£ services â€• ç”Ÿæˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’â€œç¿»è¨³â€ã™ã‚‹

```ts
// src/services/userService.ts
import { UsersApi } from "@/api";

const api = new UsersApi();

export const userService = {
  list: () => api.getUsers(),
  get:  (id: string) => api.getUser({ id }),
  update: (id: string, body: UpdateUserRequest) =>
    api.updateUser({ id, updateUserRequest: body }),
};
```

*ç”»é¢ã¯ **HTTP è©³ç´°ã‚’çŸ¥ã‚‰ãšã«** `userService.list()` ç­‰ã®ãƒ‰ãƒ¡ã‚¤ãƒ³èªã§å‘¼ã¹ã‚‹ã€‚*

---

## 4ï¸âƒ£ hooks â€• TanStack Query ã‚’ 1 ç”»é¢ï¼1 ãƒ•ãƒƒã‚¯ã«

```ts
// src/hooks/useUsers.ts
import { useQuery, useMutation, queryClient } from "@tanstack/react-query";
import { userService } from "@/services/userService";

export const useUsers = () =>
  useQuery({ queryKey: ["users"], queryFn: userService.list });

export const useUpdateUser = () =>
  useMutation({
    mutationFn: ({ id, body }: { id: string; body: UpdateUserRequest }) =>
      userService.update(id, body),
    // æˆåŠŸã—ãŸã‚‰ä¸€è¦§ã¨è©³ç´°ã‚’åŒæ™‚ã«ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
    onSuccess: (_, { id }) => {
      queryClient.invalidateQueries({ queryKey: ["users"] });     // îˆ€citeîˆ‚turn0search9îˆ
      queryClient.invalidateQueries({ queryKey: ["user", id] });
    },
  });

/* if you also need a single user */
export const useUser = (id: string) =>
  useQuery({ queryKey: ["user", id], queryFn: () => userService.get(id) });
```

*`useQuery` ã‚’å‘¼ã‚“ã ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã ã‘è‡ªå‹•å†æç”»ã•ã‚Œã¾ã™ã€‚  
 è¿½åŠ ã® `useEffect` ã¯ä¸€åˆ‡ä¸è¦* îˆ€citeîˆ‚turn0search6îˆ

---

## 5ï¸âƒ£ pages â€• UI ã¯ã€Œãƒ•ãƒƒã‚¯ + åˆ†å²ã€ã ã‘

```tsx
// src/pages/UsersPage.tsx
import { Link } from "react-router-dom";
import { useUsers } from "@/hooks/useUsers";

export default function UsersPage() {
  const { data = [], isLoading, error } = useUsers();

  if (isLoading) return <p>Loadingâ€¦</p>;
  if (error)     return <p>Oops!</p>;

  return (
    <ul>
      {data.map((u) => (
        <li key={u.id}>
          <Link to={`/users/${u.id}`}>{u.name}</Link>
        </li>
      ))}
    </ul>
  );
}
```

```tsx
// src/pages/UserDetailPage.tsx
import { useParams, useNavigate } from "react-router-dom";
import { useUser, useUpdateUser } from "@/hooks/useUsers";

export default function UserDetailPage() {
  const { id = "" } = useParams();
  const nav = useNavigate();
  const { data, isLoading } = useUser(id);
  const update = useUpdateUser();

  if (isLoading) return <p>Loadingâ€¦</p>;

  return (
    <>
      <button onClick={() => nav(-1)}>â† back</button>
      <h2>{data.name}</h2>
      <button
        onClick={() => update.mutate({ id, body: { active: !data.active } })}
      >
        Toggle Active
      </button>
    </>
  );
}
```

*ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯ã‚µãƒ¼ãƒ“ã‚¹/ãƒ•ãƒƒã‚¯ãŒå¸åã€‚ãƒšãƒ¼ã‚¸ã¯ **3-way åˆ†å²** ã ã‘ã§çµ‚ã‚ã‚Šã¾ã™ã€‚*

---

## 6ï¸âƒ£ ï¼ˆä»»æ„ï¼‰UI ã‚°ãƒ­ãƒ¼ãƒãƒ«å€¤ãŒå¢—ãˆãŸã‚‰ Zustand ã‚’å¾Œä»˜ã‘

```ts
// src/store/ui.ts
import { create } from "zustand";
export const useUiStore = create<{ theme: "light" | "dark"; setTheme(t:"light"|"dark"):void }>((set)=>({
  theme:"light", setTheme:(t)=>set({theme:t})
}));
```

```tsx
const theme = useUiStore(s=>s.theme);          // slice è³¼èª­ã§å†ãƒ¬ãƒ³ãƒ€ãƒ¼æœ€å°åŒ– îˆ€citeîˆ‚turn0search4îˆ
```

*ã‚¹ãƒˆã‚¢ã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãªã®ã§è¤‡æ•°ç”»é¢ã§å€¤ã‚’å³å…±æœ‰ã§ãã¾ã™  
ï¼ˆå†…éƒ¨ã¯ `useSyncExternalStore` å®Ÿè£…ï¼‰* îˆ€citeîˆ‚turn0search1îˆ

---

## 7ï¸âƒ£ ã¾ã¨ã‚ â€• æœ€å°ãƒ»å®Ÿæˆ¦çš„ 4-ãƒ¬ã‚¤ãƒ¤ãƒ¼

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | å½¹å‰² | å¤‰æ›´å½±éŸ¿ç¯„å›² |
|----------|------|--------------|
| **api/** | è‡ªå‹•ç”Ÿæˆã‚³ãƒ¼ãƒ‰ã€‚HTTP è©³ç´°ã‚’ä¿æŒ | generator å·®ã—æ›¿ãˆã®ã¿ |
| **services/** | ãƒ‰ãƒ¡ã‚¤ãƒ³å‘¼ã³å‡ºã— (`getUser`) â€” *ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã¯ã“ã“* | API ãŒå¤‰ã‚ã£ãŸã‚‰ã“ã“ã ã‘ |
| **hooks/** | `useQuery/useMutation` ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»ã‚¨ãƒ©ãƒ¼å‡¦ç†ã‚’çµ±ä¸€ | UI ã¸ã®å½±éŸ¿ã‚¼ãƒ­ |
| **pages/components/** | è¡¨ç¤ºã¨ `isLoading/error/data` åˆ†å²ã ã‘ | **æ‰‹ã‚’æ±šã•ãš** UI æ”¹ä¿®ã«é›†ä¸­ |

ã“ã‚Œãªã‚‰ **Next.js ã«é ¼ã‚‰ãš**ã€React + Vite + React Router ã ã‘ã§

* ãƒ­ã‚¸ãƒƒã‚¯ã¯ 1 ç®‡æ‰€é›†ä¸­  
* ç”»é¢ã¯èª­ã¿ã‚„ã™ãä¿å®ˆç°¡å˜  
* ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»å†æ¤œè¨¼ãƒ»ãƒªãƒˆãƒ©ã‚¤ã‚‚ 1 è¡Œã§å®Ÿè£…

ã¨ã„ã†ã€Œè–„ã„ UI ã¨ã‚·ãƒ³ãƒ—ãƒ«è¨­è¨ˆã€ã‚’ä¸¡ç«‹ã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/16 21:04:05*

react-router-domã¯ãªãœå¿…è¦ãªã®ã‹ï¼Ÿç´”æ­£ã§ã¯è‰¯ããªã„ã®ã‹ã€‚ ä»–ã®é¸æŠè‚¢ã¯ãªã„ã®ã‹ï¼‘ï¼Ÿ
ã¡ãªã¿ã«ã€ãƒ•ãƒƒã‚¯ã®ã¨ã“ã‚ã§ã‚µãƒ¼ãƒ“ã‚¹ã®APIã‚³ãƒ¼ãƒ«ã‚’ã™ã‚‹ã®ã‹ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/16 21:04:18*

### ãªãœ â€œreact-router-domâ€ ãŒè¦ã‚‹ã®ã‹ï¼Ÿ

| é …ç›® | äº‹æƒ… |
|------|------|
| **React æœ¬ä½“ã¯ URL ã‚’ç›£è¦–ãƒ»æ›¸ãæ›ãˆã‚‹ API ã‚’æŒãŸãªã„** | å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã‚‚ã€Œãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¯ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£è£½ã‚’ä½¿ã£ã¦ã­ã€ã¨æ˜è¨˜ã€‚SPA ã§ãƒ‘ã‚¹ â†” ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å¯¾å¿œã‚’è‡ªå‰å®Ÿè£…ã™ã‚‹ã¨ `history.pushState`ãƒ»popstate ç›£è¦–ãƒ»ã‚³ãƒ¼ãƒ‰ã‚¹ãƒ—ãƒªãƒƒãƒˆãƒ»404 ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãªã©ã™ã¹ã¦æ‰‹æ›¸ãã«ãªã‚‹ îˆ€citeîˆ‚turn0search2îˆ |
| **react-router-dom ãŒâ€œãƒ‡ãƒ•ã‚¡ã‚¯ãƒˆâ€** | 2015 å¹´ã‹ã‚‰ç¶šãå®Ÿç¸¾ï¼‹å‹•çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼å…¥ã‚Œå­ãƒ«ãƒ¼ãƒˆï¼é…å»¶ãƒ­ãƒ¼ãƒ‰ï¼ãƒ•ã‚©ãƒ¼ãƒ  actions ã¾ã§ã‚«ãƒãƒ¼ã—ã€ã€ŒURL ã¨ UI ã‚’åŒæœŸã•ã›ã‚‹ä»•çµ„ã¿ä¸€å¼ã€ã‚’ 1 è¡Œè¨­å®šã§å°å…¥ã§ãã‚‹ îˆ€citeîˆ‚turn0search4îˆ |
| **ãƒ–ãƒ©ã‚¦ã‚¶å°‚ç”¨ãƒ“ãƒ«ãƒ‰** | `react-router-dom` ã¯ History API å‰æã§æœ€é©åŒ–ã•ã‚Œã€Viteï¼‹CSR ã‚¢ãƒ—ãƒªã«ãã®ã¾ã¾æŒ¿ã›ã‚‹ï¼ˆNode ç‰ˆã¯ `react-router` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼‰ |

> ã¤ã¾ã‚Š *ã€ŒURL ã«å¿œã˜ã¦ç”»é¢ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã€* ã“ã¨è‡ªä½“ãŒæ¨™æº– React ã§ã¯è³„ãˆãªã„ãŸã‚ã€  
> æœ€ä½é™ **ä½•ã‚‰ã‹ã® Router** ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚

---

### ã»ã‹ã®é¸æŠè‚¢ã¯ï¼Ÿ

| ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | ç‰¹é•· | ã„ã¤æ¤œè¨ï¼Ÿ |
|------------|------|-----------|
| **TanStack Router** | 100 % å‹å®‰å…¨ãƒ»æ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ APIãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒå†…è”µï¼ˆSWRï¼‰| å‹ãƒ¬ãƒ™ãƒ«ã§ãƒ«ãƒ¼ãƒˆã¨ params ã‚’ç…§åˆã—ãŸã„ï¼TanStack ãƒ•ã‚¡ãƒŸãƒªã‚’ã™ã§ã«ä½¿ã£ã¦ã„ã‚‹å ´åˆ îˆ€citeîˆ‚turn0search3îˆ‚turn0search6îˆ |
| **Wouter** | 1 kB ã®è¶…è»½é‡ãƒ»Hooks ãƒ™ãƒ¼ã‚¹ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«æ•°æ¿€å°‘ | ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¯ `/` ã¨ `/about` ç¨‹åº¦ã€æ©Ÿèƒ½ã‚ˆã‚Šã‚µã‚¤ã‚ºé‡è¦– |
| **Page.js / Navigo** | ä¾å­˜ã‚¼ãƒ­ã® History ãƒ©ãƒƒãƒ‘ãƒ¼ | React ã¨å¯†çµåˆã—ãªã„â€œç´ ã® JS ãƒ«ãƒ¼ã‚¿â€ãŒæ¬²ã—ã„ |
| **è‡ªä½œ (history API + Context)** | ç ”ç©¶ãƒ»å­¦ç¿’ç›®çš„ | ä»•æ§˜è¿½åŠ ã”ã¨ã«è†¨å¤§ãªå®Ÿè£…ãŒå¿…è¦â€¦å®Ÿå‹™ã§ã¯éæ¨å¥¨ |

---

### Router ã‚’å…¥ã‚Œã‚‹ä½ç½®ï¼ˆå†æ•´ç†ï¼‰

```
<StrictMode>
  <QueryClientProvider client={qc}>   â† TanStack Query
    <BrowserRouter>                   â† Router (react-router-dom)
      <AppRoutes />                   â† lazy & nested routes
    </BrowserRouter>
  </QueryClientProvider>
</StrictMode>
```

*`BrowserRouter` ã‚’ã‚¢ãƒ—ãƒªã®ãƒ«ãƒ¼ãƒˆã« 1 å›ç½®ã‘ã°ã€ä¸‹ä½ãƒ„ãƒªãƒ¼å…¨ä½“ã§  
`useNavigate`, `<Link>`, `<Route>` ãªã©ãŒä½¿ãˆã¾ã™ã€‚*

---

## â€œhooks å±¤â€ ã§ã‚µãƒ¼ãƒ“ã‚¹ã‚’å‘¼ã¶ã®ï¼Ÿ â€” YES

```
pages/              â† UI(V)
hooks/              â† TanStack Query ãƒ•ãƒƒã‚¯ (P)
services/           â† ç”Ÿæˆ API ã‚’åŒ…ã‚€ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤(UseCase)
api/ (generated)    â† ã‚¤ãƒ³ãƒ•ãƒ©å±¤
```

```ts
// hooks/useUser.ts
export const useUser = (id: string) =>
  useQuery({
    queryKey: ['user', id],
    queryFn: () => userService.get(id)   // â† services çµŒç”±ã§ API å®Ÿè¡Œ
  });
```

* **ã‚µãƒ¼ãƒ“ã‚¹å±¤** â€¦ HTTP ã‚„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®çŸ¥è­˜ã‚’é›†ç´„  
* **ãƒ•ãƒƒã‚¯å±¤** â€¦ TanStack Query ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ã‚¨ãƒ©ãƒ¼ï¼å†æ¤œè¨¼ã‚’çµ±ä¸€  
* **ãƒšãƒ¼ã‚¸å±¤** â€¦ `const {data,isLoading}=useUser(id)` ã®ä¸‰åˆ†å²ã ã‘

ã“ã†ã™ã‚‹ã¨ **ã€ŒAPI ã‚’ GraphQL ã«å·®ã—æ›¿ãˆãŸã€ã€Œv2 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«å¤‰æ›´ã€**  
ã¨ã„ã£ãŸä¿®æ­£ã¯ *services ã ã‘* ã§æ¸ˆã¿ã€UI ã¯å½±éŸ¿ã‚¼ãƒ­ã«ãªã‚Šã¾ã™ã€‚

---

### çµè«–

1. **ç´”æ­£ React ã«ã¯ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ©Ÿèƒ½ãŒç„¡ã„** â†’ URL/ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ‰±ã†ãªã‚‰ Router ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå¿…é ˆã€‚  
2. **react-router-dom** ã¯æ©Ÿèƒ½ã¨å®Ÿç¸¾ã®ãƒãƒ©ãƒ³ã‚¹ãŒã‚ˆãã€ã¾ãšå›°ã‚‰ãªã„ã€‚  
   *ã‚¿ã‚¤ãƒ—ã‚»ãƒ¼ãƒ•ï¼çµ±åˆãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãŒæ¬²ã—ã„ãªã‚‰* **TanStack Router** ãŒ 2025 å¹´æ™‚ç‚¹ã®æœ‰åŠ›ä»£æ›¿ã€‚  
3. ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆAPI å‘¼ã³å‡ºã—ï¼‰ã¯ **services â†’ hooks** ã® 2 æ®µã§åˆ‡ã‚Šåˆ†ã‘ã€  
   ãƒšãƒ¼ã‚¸ã¯ã€Œãƒ•ãƒƒã‚¯å‘¼ã³å‡ºã—ï¼‹ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ã‚¨ãƒ©ãƒ¼ï¼è¡¨ç¤ºã€ã ã‘ã«ã™ã‚‹ â€• ã“ã‚ŒãŒ **è–„ã„ UI + ä¿å®ˆã—ã‚„ã™ã„æ§‹æˆ** ã®æœ€çŸ­ãƒ«ãƒ¼ãƒˆã§ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/16 21:11:56*

react router v7 ã¨ã„ã†é¸æŠè‚¢ã¯ãªã„ã®ã‹ï¼Ÿ ã¾ãŸ TanStack Query ã‚’ä½¿ã†äºˆå®šãªã®ã ãŒã€TanStack Router ã¨ä¸€ç·’ã«ä½¿ã†ã¨ã„ã„ã“ã¨ã¯ã‚ã‚‹ã‹ï¼Ÿ
å‹å®‰å…¨æ€§ã«ã¤ã„ã¦ã‚‚ç¢ºèªã—ãŸã„ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/16 21:12:09*

### 1. ãã‚‚ãã‚‚ **React Router v7** ã¯ï¼Ÿ  
*2025 å¹´ 6 æœˆç¾åœ¨* ã™ã§ã« **å®‰å®šç‰ˆ v7** ãŒå…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚v6 ã¨ã®äº’æ›ã‚’ä¿ã£ãŸã¾ã¾ Remix ã®ãƒ‡ãƒ¼ã‚¿ APIï¼ˆ`loader` / `action`ï¼‰ã€ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¯¾å¿œã€ãã—ã¦ **ãƒ«ãƒ¼ãƒˆã”ã¨ã®å‹è‡ªå‹•ç”Ÿæˆï¼ˆtypegenï¼‰** ãŒå…¥ã‚Šã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Š *params / loaderData / actionData* ãªã©ãŒå‹æ¨è«–ã§ãã€`useLoaderData()` ã§å–ã‚Šå‡ºã™å€¤ã«ã‚‚å‹ãŒä»˜ãã¾ã™ã€‚îˆ€citeîˆ‚turn0search1îˆ‚turn0search6îˆ

---

### 2. **TanStack Router** ã¨ã„ã†é¸æŠè‚¢  
| ç‰¹é•· | React Router v7 | **TanStack Router** |
|------|----------------|---------------------|
| **å‹å®‰å…¨** | ç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å‹ä»˜ä¸ï¼ˆtypegenï¼‰ | **å®£è¨€æ™‚ç‚¹**ã§ãƒ‘ã‚¹ãƒ»ã‚¯ã‚¨ãƒªãƒ»æ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒå®Œå…¨æ¨è«–ã€‚IDE è£œå®Œã§ `$postId` vs `$postID` ã‚‚æ¤œå‡º îˆ€citeîˆ‚turn0search2îˆ‚turn0search7îˆ |
| **ãƒ‡ãƒ¼ã‚¿å–å¾— API** | `loader/ action`ï¼ˆRemix æ–¹å¼ï¼‰ | `loader` ã«åŠ ãˆ **å†…è”µ SWR ã‚­ãƒ£ãƒƒã‚·ãƒ¥**ã€`prefetch`ã€`defer` ãŒæœ€åˆã‹ã‚‰æ­è¼‰ã€‚ |
| **TanStack Query ã¨ã®çµ±åˆ** | æ‰‹å‹•ã§ `useQuery` ã‚’å‘¼ã¶ | **å…¬å¼ã«ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹**ã€‚`loader` ã§ `queryClient.ensureQueryData()` ã‚’æ›¸ã‘ã° Query ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å…±ç”¨ îˆ€citeîˆ‚turn1search3îˆ‚turn1search5îˆ |
| **æ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ API** | ä½ãƒ¬ãƒ™ãƒ« `URLSearchParams` | ã‚¹ã‚­ãƒ¼ãƒä»˜ãã§ `searchSchema({page:z.number()})` â†’ å‹å®‰å…¨ã« URL â‡„ çŠ¶æ…‹åŒæœŸ îˆ€citeîˆ‚turn0search7îˆ |
| **ã‚µã‚¤ã‚ºæ„Ÿ** | 18 kB gzip (core) | 12 kB gzip å‰å¾Œ |

> **çµè«–**  
> - **ã€ŒReact Router ã«æ…£ã‚Œã¦ã„ã¦ v7 ã® typegen ã§ååˆ†ã€** â†’ v7 ã§ OK  
> - **ã€ŒTanStack Query ä¸­å¿ƒã«çµ„ã‚€ã€ã€Œãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚‚ compile-time ã§æ¼ã‚Œãªãä¿è¨¼ã—ãŸã„ã€** â†’ TanStack Router ãŒç›¸æ€§æŠœç¾¤

---

### 3. **TanStack Query Ã— TanStack Router** ã§å¾—ã‚‰ã‚Œã‚‹å…·ä½“çš„ãƒ¡ãƒªãƒƒãƒˆ

1. **å…±é€š QueryClient**  
   ```ts
   // route definition
   const userRoute = createRoute({
     path: '/users/$userId',
     loader: ({ params }) =>
       queryClient.ensureQueryData({
         queryKey: ['user', params.userId],
         queryFn: () => userService.get(params.userId),
       }),
   });
   ```
   *ãƒŠãƒ“ã‚²ãƒ¼ãƒˆå‰ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å…ˆå–ã—ã¦ãŠã* â‡’ ç”»é¢é·ç§»ãŒ **0 ms** ã§æç”»ã€‚  
2. **SWR è‡ªå‹•åŒ–** â€“ ãƒ«ãƒ¼ãƒˆå˜ä½ã§ `staleTime` ã‚’å®£è¨€ â†’ èƒŒæ™¯ãƒªãƒ•ã‚§ãƒƒãƒã‚’ Router ãŒä»£è¡Œã€‚  
3. **å‹æ¼ã‚Œã‚¼ãƒ­** â€“ ãƒ«ãƒ¼ãƒˆå®£è¨€æ™‚ã« TS ãŒ `"users/$userId"` ã¨ `params.userId: string` ã‚’å¼·åˆ¶ã€‚ä¸€åº¦ã§ã‚‚ãƒŸã‚¹ã™ã‚Œã°ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ã€‚  
4. **æ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’çŠ¶æ…‹ç®¡ç†ã®ã‚ˆã†ã«æ‰±ãˆã‚‹**  
   ```ts
   const search = rootRoute.useSearch({
     page: z.number().int().default(1),
   });
   ```

---

### 4. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆï¼ˆå†æ²ï¼‰

```
src/
â”œ api/              # è‡ªå‹•ç”Ÿæˆ
â”œ services/         # userService / postService â€¦
â”œ hooks/            # useUsers / useUser (TanStack Query) â† â˜…ã“ã“ã§ API å‘¼ã³å‡ºã—
â”œ router/           # react-router v7 or tanstack-router ã®å®šç¾©
â”œ pages/            # ãƒ«ãƒ¼ãƒˆè¦ç´ ã€‚UI ã¨åˆ†å²ã ã‘
â”œ store/            # (ä»»æ„) zustand â€“ ãƒ†ãƒ¼ãƒãƒ»ã‚¿ãƒ–çŠ¶æ…‹ãªã©
â”” App.tsx           # QueryClientProvider + RouterProvider
```

> **ãƒ•ãƒƒã‚¯å±¤ã§ã‚µãƒ¼ãƒ“ã‚¹é–¢æ•°ã‚’å‘¼ã¶** ã“ã¨ã§  
> *UI* ã¨ *ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ / ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥* ã‚’å®Œå…¨åˆ†é›¢ã§ãã¾ã™ã€‚

---

### 5. ã¾ã¨ã‚

|  | React Router v7 | TanStack Router |
|---|---|---|
| **å­¦ç¿’ã‚³ã‚¹ãƒˆ** | v6 ãƒ¦ãƒ¼ã‚¶ãƒ¼ãªã‚‰æœ€å° | æ–° API å­¦ç¿’ãŒå¿…è¦ |
| **å‹å®‰å…¨ãƒ¬ãƒ™ãƒ«** | typegen ã§ â€œæº–â€ å®Œå…¨ | å®£è¨€ï¼å‹ä¿è¨¼ã§ â€œå®Œå…¨â€ |
| **TanStack Query ã¨ã®è¦ªå’Œ** | æ‰‹å‹•é€£æº | **ãƒ“ãƒ«ãƒˆã‚¤ãƒ³** ã§ prefetch/SWR |
| **URL æ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ DX** | æ‰‹æ›¸ãå¤‰æ› | ã‚¹ã‚­ãƒ¼ãƒï¼‹å‹æ¨è«– |
| **ãŠã™ã™ã‚** | æ—¢å­˜ v6, Remix ãƒ¦ãƒ¼ã‚¶ãƒ¼ | TanStack Suite (Query / Table â€¦) ã‚’æ¡ç”¨æ¸ˆã¿ or å‹å®‰å…¨ã‚’é™ç•Œã¾ã§é«˜ã‚ãŸã„ |

ã©ã¡ã‚‰ã‚’é¸ã‚“ã§ã‚‚ **hooks ã§ã‚µãƒ¼ãƒ“ã‚¹ã‚’å‘¼ã¶ 4 ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹æˆ** ã¯ãã®ã¾ã¾æµç”¨ã§ãã¾ã™ã€‚  
ã€ŒQuery ã¨ Router ã‚’ *åŒã˜ TanStack ãƒ•ã‚¡ãƒŸãƒª* ã§æƒãˆã¦ DXï¼å‹å®‰å…¨ã‚’ä¸€æ®µä¸Šã’ãŸã„ã€ãªã‚‰ **TanStack Router + TanStack Query** ãŒ 2025 å¹´ç¾åœ¨ãƒ™ã‚¹ãƒˆãªçµ„ã¿åˆã‚ã›ã§ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/16 21:14:45*

ã ã‚“ãŸã‚“TanStack ãƒ•ã‚¡ãƒŸãƒªãƒ¼ã«å¸åã•ã‚ŒãŒã¡ã§ã‚ã‚‹ãŒã€ãƒ™ãƒ³ãƒ€ãƒ¼ãƒ­ãƒƒã‚¯ã‚¤ãƒ³ã¿ãŸã„ãªå½¢ã«ãªã‚‰ãªã„ã‹ã€‚ 
ã¾ãŸä»–ã«TanStackã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ä½¿ã†ã¹ãã‚‚ã®ã¯ã‚ã‚‹ã‹ã€ä¸€æ—¦ã“ã®2ã¤ã ã‘ã§ååˆ†ã‹ã€‚ 
ã‚ã‚“ã¾ã‚Šè»½é‡ç³»ãªã‚¦ã‚§ãƒ–ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œã‚ã†ã¨æ€ã£ã¦ã„ãŸã®ãŒã€ã ã‚“ã ã‚“è¤‡é›‘ã«ãªã£ã¦ããŸã‚ˆã†ãªæ°—ãŒã™ã‚‹ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/16 21:14:55*

### 1. ã€ŒTanStackï¼ãƒ™ãƒ³ãƒ€ãƒ¼ãƒ­ãƒƒã‚¯ã‚¤ãƒ³ï¼Ÿã€  
**å®Ÿéš›ã¯ãƒ­ãƒƒã‚¯ã‚¤ãƒ³åº¦ã¯ã‹ãªã‚Šä½ã‚**ã§ã™ã€‚  

| è¦³ç‚¹ | å®Ÿæƒ… |
|------|------|
| **ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹è¨­è¨ˆ** | Query ã‚‚ Router ã‚‚ã€ŒDOMã‚„ UI ã‚’ä¸€åˆ‡æŒãŸãªã„ãƒ­ã‚¸ãƒƒã‚¯å±¤ã€ã€‚`fetch` ã‚„ `history` ã‚’æ³¨å…¥ã™ã‚‹ã ã‘ãªã®ã§å…¥ã‚Œæ›¿ãˆã‚³ã‚¹ãƒˆãŒå°ã•ã„ã€‚ |
| **ãƒ‡ãƒ¼ã‚¿ã¯ãƒ—ãƒ¬ãƒ¼ãƒ³ JS** | å–å¾—çµæœã‚’ç‹¬è‡ªã‚¯ãƒ©ã‚¹ã«åŒ…ã¾ãšãã®ã¾ã¾è¿”ã™ã€‚â†’ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ã‚ãªã„æ–¹é‡ã«æˆ»ã—ã¦ã‚‚å‹ãƒ»å€¤ã¯ãã®ã¾ã¾æµç”¨å¯ã€‚ |
| **æ®µéšçš„å°å…¥ï¼æ’¤é€€ãŒå¯èƒ½** | Routerã¨Queryã¯äº’ã„ã«ç‹¬ç«‹ã€‚ãŸã¨ãˆã° Router ã ã‘ React-Router v7 ã«æˆ»ã™ï¼Query ã ã‘ SWR ã«å·®ã—æ›¿ãˆã‚‹ã€ã¨ã„ã£ãŸåˆ†é›¢é‹ç”¨ãŒã§ãã‚‹ã€‚ |
| **Bundle Size** | Query â‰ˆ14 kBã€Router â‰ˆ12 kB gzip - ä¾å­˜æ•°ã¯ 0ã€‚å¿…è¦ãªããªã‚Œã° tree-shake ã§ä¸¸ã”ã¨è½ã¨ã›ã‚‹ã€‚îˆ€citeîˆ‚turn0search3îˆ‚turn0search0îˆ |

> ğŸ‘‰ **â€œä½¿ã†ã¨ä¾¿åˆ©ã ãŒã€å¤–ã—ã«ãã„ API ã§å›²ã„è¾¼ã‚€â€** ã‚¿ã‚¤ãƒ—ã§ã¯ãªãã€  
> **â€œæ¬²ã—ã„æ‰€ã ã‘ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹é–¢æ•°ã‚’å‘¼ã¶â€**ã‚¿ã‚¤ãƒ—ãªã®ã§ãƒ­ãƒƒã‚¯ã‚¤ãƒ³ãƒªã‚¹ã‚¯ã¯å°ã•ã‚ã§ã™ã€‚

---

### 2. ã€ŒQueryï¼‹Routerä»¥å¤–ã« TanStackã§â€œå¿…é ˆâ€ãªç‰©ã¯ï¼Ÿã€  

| ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | ä¸»ç”¨é€” | è¿½åŠ ã‚³ã‚¹ãƒˆ | ã„ã¤å°å…¥ï¼Ÿ |
|------------|--------|-----------|------------|
| **@tanstack/table** | ãƒ•ã‚£ãƒ«ã‚¿ãƒ»ã‚½ãƒ¼ãƒˆãƒ»ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãƒ†ãƒ¼ãƒ–ãƒ« | â‰ˆ9 kB | REST/GraphQL ã§å¤§é‡è¡¨ã‚’æ‰±ã†æ™‚ã®ã¿ îˆ€citeîˆ‚turn0search6îˆ |
| **@tanstack/virtual** | 10 kï¼‹è¡Œã®ãƒªã‚¹ãƒˆ/ã‚°ãƒªãƒƒãƒ‰ä»®æƒ³åŒ– | â‰ˆ6 kB | ãƒãƒ£ãƒƒãƒˆã€Infinite Scroll ãŒã‚«ã‚¯ã¤ãæ™‚ îˆ€citeîˆ‚turn0search3îˆ |
| **TanStack Store** (Î±) | Signal ãƒ™ãƒ¼ã‚¹è¶…è»½é‡ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ | â‰ˆ2 kB | Zustand ä»£æ›¿ã‚’è©¦ã—ãŸã„æ™‚ |
| **TanStack Form** (Î²) | å‹å®‰å…¨ï¼†field-array æŒ‡å‘ãƒ•ã‚©ãƒ¼ãƒ  | â‰ˆ7 kB | React-Hook-Form ã‚’ç½®ãæ›ãˆãŸã„æ™‚ |

**çµè«–ï¼šã¾ãšã¯ _Query + (React-)Router_ ã§ååˆ†**ã€‚  
ä»–ã¯ã€Œæ€§èƒ½ã‚„æ©Ÿèƒ½ãŒè¶³ã‚Šãªããªã£ãŸã‚‰å¾Œä»˜ã‘ã€ã§ OK ã§ã™ã€‚

---

### 3. å‹å®‰å…¨æ€§ â€” ã©ã“ã¾ã§æ‹…ä¿ã•ã‚Œã‚‹ï¼Ÿ

| é …ç›® | React Router v7 | **TanStack Router** |
|------|----------------|---------------------|
| ãƒ«ãƒ¼ãƒˆãƒ‘ã‚¹ & params | `npm run typegen` ã§è‡ªå‹•ç”Ÿæˆ | ãƒ«ãƒ¼ãƒˆå®£è¨€æ™‚ã«å³æ¨è«–ï¼ˆãƒ“ãƒ«ãƒ‰å‰ã«ã‚¨ãƒ©ãƒ¼ï¼‰ îˆ€citeîˆ‚turn0search8îˆ |
| æ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | æ‰‹æ›¸ããƒ‘ãƒ¼ã‚¹ | `searchSchema({ page: z.number() })` ã§å‹ä¿è¨¼ |
| TanStack Query ã¸ã®å—ã‘æ¸¡ã— | æ‰‹å‹• string çµåˆ | `loader` å†…ã§ `queryClient.ensureQueryData()` ç›´çµå¯ îˆ€citeîˆ‚turn1search5îˆ‚turn0search4îˆ |

> **ã€Œå‹ã®å³å¯†ã•ã‚’æœ€å„ªå…ˆã€**ãªã‚‰ Router ã‚‚ TanStack ã«æƒãˆã‚‹ã¨ DX ãŒä¸€æ®µãƒ©ã‚¯ã«ãªã‚Šã¾ã™ã€‚  
> ãŸã ã— React-Router v7 ã‚‚ typegen ã§ 80â€‰% ä»¥ä¸Šã¯å®‰å…¨ãªã®ã§ã€æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã‚„å­¦ç¿’ã‚³ã‚¹ãƒˆã‚’å„ªå…ˆã™ã‚‹ãªã‚‰ v7 ã‚’ç¶šæŠ•ã—ã¦ã‚‚å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚

---

### 4. ã€Œè»½é‡ã«å§‹ã‚ã‚‹ã€ãŸã‚ã®æœ€å°ã‚¹ãƒ†ãƒƒãƒ—

1. **Query ã ã‘å°å…¥**  
   * API ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã‚’ hooks ã«é–‰ã˜è¾¼ã‚ã€UI ã¯ä¸‰åˆ†å² (`isLoading/error/data`) ã®ã¿ã€‚  
2. **å¿…è¦ã«ãªã£ãŸã‚‰ Router ã‚’ç½®ãæ›ãˆ**  
   * ãƒ«ãƒ¼ãƒˆãŒè¤‡é›‘åŒ– or å‹å®‰å…¨ URL ã‚’å¼·åŒ–ã—ãŸã„æ®µéšã§ TanStack Router ã¸ã€‚  
3. **ã•ã‚‰ã«å¿…è¦ãªã‚‰ Table/Virtual ã‚’å±€æ‰€å°å…¥**  
   * ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå˜ä½ã§ import ã™ã‚‹ã ã‘ã€‚ã»ã‹ã®éƒ¨åˆ†ã®ãƒãƒ³ãƒ‰ãƒ«ã«ã¯å½±éŸ¿ã—ãªã„ã€‚

ã“ã‚Œãªã‚‰ **ä¾å­˜ 1 â†’ 2 â†’ 3â€¦ ã¨â€œè–„ãâ€ã‚¹ã‚±ãƒ¼ãƒ«**ã§ãã€  
ã€Œã‚ã¨ã§ç°¡å˜ã«å¤–ã›ãªã„ã»ã©æ·±ãçµåˆã™ã‚‹ã€çŠ¶æ³ã‚’é¿ã‘ã‚‰ã‚Œã¾ã™ã€‚

---

### 5. ã‚µãƒ¼ãƒ“ã‚¹å‘¼ã³å‡ºã—ä½ç½®ï¼ˆå†ç¢ºèªï¼‰

```ts
// services/userService.ts
export const userService = { list: () => api.getUsers() };

// hooks/useUsers.ts
export const useUsers = () =>
  useQuery({ queryKey: ['users'], queryFn: userService.list });
```

* **API å‘¼ã³å‡ºã—ã¯ _services_**ã€‚  
* **ã‚­ãƒ£ãƒƒã‚·ãƒ¥/å†å–å¾—ã¯ _hooks_**ã€‚  
â†’ UI ã‚‚ Router ã‚‚ä½•ã‚‚çŸ¥ã‚‰ãšã€å°†æ¥ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå¤‰æ›´æ™‚ã®å½±éŸ¿ã¯æœ€å°ã€‚

---

## âœ… ã¾ã¨ã‚

* **ãƒ™ãƒ³ãƒ€ãƒ¼ãƒ­ãƒƒã‚¯ã‚¤ãƒ³ã®å¿ƒé…ã¯å°ã•ã‚**ï¼šãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ï¼ä¾å­˜ã‚¼ãƒ­ï¼æ®µéšå°å…¥å¯ã€‚  
* **ä»Šã¯ Queryï¼‹ï¼ˆå¥½ããªï¼‰Routerã§ååˆ†**ã€‚ä»–ã® TanStack è£½å“ã¯â€œå¿…è¦ã«ãªã£ãŸã‚‰è¶³ã™â€ã€‚  
* **å‹å®‰å…¨ã‚’æ¥µã‚ãŸã„ï¼Query ã¨ç·Šå¯†é€£æºã—ãŸã„**å ´åˆã ã‘ **TanStack Router** ãŒçœŸä¾¡ã‚’ç™ºæ®ã€‚  
* **è»½é‡ã«ä¿ã¤ã‚³ãƒ„**ã¯ã€Œãƒ¬ã‚¤ãƒ¤ã‚’å®ˆã‚Šã€ä¾å­˜ã¯å¾Œä»˜ã‘ã€ã§é€²ã‚ã‚‹ã“ã¨ã€‚ã“ã‚Œãªã‚‰è¤‡é›‘åŒ–ã‚’æ„Ÿã˜ã¦ã‚‚ã€ã„ã¤ã§ã‚‚æˆ»ã—ãŸã‚Šå¤–ã—ãŸã‚Šã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/16 21:47:54*

TanStack Routerã‚’ä½¿ãŠã†ã€‚ 
æ”¹ã‚ã¦å…¨ä½“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã¯ã©ã†ãªã‚‹ã€‚ã¾ãŸãã‚Œãã‚Œã®ç°¡å˜ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã»ã—ã„ã€‚ 
ä¾‹ãˆã°ç”Ÿæˆã—ãŸã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã€ APRã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã€ await getUsersApi();ã“ã‚Œã§ã§ãã‚‹ã€‚ ç‰¹ã«ã‚µãƒ¼ãƒ“ã‚¹å±¤ã®æ›¸ãå¿…è¦ãŒã‚ã‚‹ã®ã‹ã¡ã‚‡ã£ã¨ã‚ˆãã‚ã‹ã£ã¦ãªã„ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/16 21:48:05*

ä»¥ä¸‹ã¯ **TanStack Router Ã— TanStack Query** ã‚’å‰æã«ã—ãŸ  
â€œã„ã¡ã°ã‚“è–„ã„ã‘ã‚Œã©å¾Œã‹ã‚‰æ‹¡å¼µã—ã‚„ã™ã„â€ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¨æœ€å°ã‚³ãƒ¼ãƒ‰ä¾‹ã§ã™ã€‚

```
src/
â”œ api/                 # openapi ã‚„ tRPC ãªã©ã§è‡ªå‹•ç”Ÿæˆï¼ˆç·¨é›†ã—ãªã„ï¼‰
â”‚   â”” usersApi.ts
â”‚
â”œ lib/
â”‚   â”œ queryClient.ts   # TanStack Query ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
â”‚   â”” router.ts        # TanStack Router (ãƒ«ãƒ¼ãƒˆå®šç¾©)
â”‚
â”œ services/            # â† ä»»æ„ã€‚ç”Ÿæˆ API ã‚’ãƒ‰ãƒ¡ã‚¤ãƒ³åã§åŒ…ã‚€
â”‚   â”” userService.ts
â”‚
â”œ hooks/               # Queryï¼‹Mutation ã‚’ 1 æ©Ÿèƒ½ï¼1 ãƒ•ãƒƒã‚¯åŒ–
â”‚   â”” useUsers.ts
â”‚
â”œ pages/               # ç”»é¢ UIã€‚ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°/Error/è¡¨ç¤ºã ã‘
â”‚   â”œ Root.tsx
â”‚   â”” users/
â”‚       â”œ UsersPage.tsx
â”‚       â”” UserDetailPage.tsx
â”‚
â”œ App.tsx              # RouterProviderï¼‹QueryClientProvider
â”” main.tsx             # Vite ã®ã‚¨ãƒ³ãƒˆãƒª
```

---

## 1. `lib/queryClient.ts`

```ts
import { QueryClient } from '@tanstack/react-query';

export const queryClient = new QueryClient({
  defaultOptions: {
    queries: { staleTime: 5 * 60_000, retry: 2 },
  },
});
```

---

## 2. `lib/router.ts`

```ts
import {
  Router,
  RootRoute,
  Route,
} from '@tanstack/router';
import { queryClient } from './queryClient';
import Root from '@/pages/Root';
import UsersPage from '@/pages/users/UsersPage';
import UserDetailPage from '@/pages/users/UserDetailPage';
import { userService } from '@/services/userService';

/* --- ãƒ«ãƒ¼ãƒˆå®šç¾© --- */
const rootRoute = new RootRoute({
  component: Root,
});

const usersRoute = new Route({
  getParentRoute: () => rootRoute,
  path: '/users',
  component: UsersPage,
  loader: () =>
    // ä¸€è¦§ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«å…ˆå–ã—ã¦ãƒšãƒ¼ã‚¸é·ç§»ã‚’é«˜é€ŸåŒ–
    queryClient.ensureQueryData(['users'], userService.list),
});

const userRoute = new Route({
  getParentRoute: () => usersRoute,
  path: '$userId',                     // â† ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯å‹æ¨è«–ã•ã‚Œã‚‹
  component: UserDetailPage,
  loader: ({ params }) =>
    queryClient.ensureQueryData(['user', params.userId], () =>
      userService.get(params.userId),
    ),
});

/* --- Router æœ¬ä½“ --- */
export const router = new Router({
  routeTree: rootRoute.addChildren([usersRoute.addChildren([userRoute])]),
  context: { queryClient },
});
```

*ãƒ‘ã‚¹æ–‡å­—åˆ—ãƒ»`params.userId` å‹ãªã©ãŒ**å®£è¨€æ™‚ç‚¹ã§å®Œå…¨æ¨è«–**ã•ã‚Œã€ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å…ˆã®å‹å®‰å…¨æ€§ãŒæ‹…ä¿ã•ã‚Œã¾ã™ã€‚îˆ€citeîˆ‚turn0search7îˆ*

---

## 3. `services/userService.ts`ï¼ˆ**æ›¸ã / æ›¸ã‹ãªã„ã¯è‡ªç”±**ï¼‰

```ts
import { getUsersApi, getUserApi, updateUserApi } from '@/api/usersApi';

export const userService = {
  list : ()            => getUsersApi(),                     // GET /users
  get  : (id: string)  => getUserApi({ id }),                // GET /users/:id
  update: (id: string, body: UpdateUserRequest) =>
          updateUserApi({ id, updateUserRequest: body }),    // PUT ...
};
```

> *ãªãœ wrap ã™ã‚‹ï¼Ÿ*  
> - ç”Ÿæˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒ¡ã‚½ãƒƒãƒ‰åãŒé•·ã„ / å¤‰æ›´ãŒå¤šã„  
> - èªè¨¼ãƒ˜ãƒƒãƒ€ãƒ»å…±é€šã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ 1 ç®‡æ‰€ã§å·®ã—è¾¼ã¿ãŸã„  
> - ãƒ†ã‚¹ãƒˆæ™‚ã« **userService** ã ã‘ stub ã™ã‚Œã° UI ã‚’ä¸¸ã”ã¨ãƒ¢ãƒƒã‚¯ã§ãã‚‹  
> ç”Ÿæˆã‚³ãƒ¼ãƒ‰ã«æº€è¶³ã—ã¦ã„ã‚Œã° **services å±¤ã¯ã‚¹ã‚­ãƒƒãƒ—**ã—ã¦ `hooks` ã‹ã‚‰ç›´æ¥å‘¼ã‚“ã§ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚  

---

## 4. `hooks/useUsers.ts`

```ts
import { useQuery, useMutation } from '@tanstack/react-query';
import { queryClient } from '@/lib/queryClient';
import { userService } from '@/services/userService';

export const useUsers = () =>
  useQuery({ queryKey: ['users'], queryFn: userService.list });

export const useUser = (id: string) =>
  useQuery({ queryKey: ['user', id], queryFn: () => userService.get(id) });

export const useUpdateUser = () =>
  useMutation({
    mutationFn: ({ id, body }: { id: string; body: UpdateUserRequest }) =>
      userService.update(id, body),
    // ä¸€è¦§ãƒ»è©³ç´°ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’åŒæ™‚æ›´æ–°
    onSuccess: (_, { id }) => {
      queryClient.invalidateQueries({ queryKey: ['users'] });
      queryClient.invalidateQueries({ queryKey: ['user', id] });
    },
  });
```

---

## 5. `pages/` â€” UI ã¯ã€Œä¸‰åˆ†å²ã€ã ã‘

```tsx
// pages/Root.tsx
import { Outlet } from '@tanstack/router';
export default function Root() {
  return (
    <>
      <h1>My App</h1>
      <Outlet /> {/* ãƒã‚¹ãƒˆå…ˆã‚’æç”» */}
    </>
  );
}
```

```tsx
// pages/users/UsersPage.tsx
import { Link } from '@tanstack/router';
import { useUsers } from '@/hooks/useUsers';

export default function UsersPage() {
  const { data = [], isLoading, error } = useUsers();
  if (isLoading) return <p>Loadingâ€¦</p>;
  if (error)     return <p>Oops!</p>;

  return (
    <ul>
      {data.map((u) => (
        <li key={u.id}>
          {/* å‹å®‰å…¨ãª params ã¨ã—ã¦ userId ã‚’æ¸¡ã›ã‚‹ */}
          <Link to="/users/$userId" params={{ userId: u.id }}>
            {u.name}
          </Link>
        </li>
      ))}
    </ul>
  );
}
```

```tsx
// pages/users/UserDetailPage.tsx
import { useParams, Link } from '@tanstack/router';
import { useUser, useUpdateUser } from '@/hooks/useUsers';

export default function UserDetailPage() {
  const { userId = '' } = useParams({ strict: false });
  const { data, isLoading } = useUser(userId);
  const update = useUpdateUser();

  if (isLoading) return <p>Loadingâ€¦</p>;

  return (
    <>
      <Link to="/users">â† back</Link>
      <h2>{data.name}</h2>
      <button
        onClick={() =>
          update.mutate({ id: userId, body: { active: !data.active } })
        }
      >
        Toggle Active
      </button>
    </>
  );
}
```

---

## 6. `App.tsx` ã¨ `main.tsx`

```tsx
// App.tsx
import { RouterProvider } from '@tanstack/router';
import { QueryClientProvider } from '@tanstack/react-query';
import { router } from '@/lib/router';
import { queryClient } from '@/lib/queryClient';

export function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <RouterProvider router={router} />
    </QueryClientProvider>
  );
}
```

```tsx
// main.tsx
import React from 'react';
import { createRoot } from 'react-dom/client';
import { App } from './App';

createRoot(document.getElementById('root')!).render(<App />);
```

---

### ã¾ã¨ã‚

* **Router** â†’ å‹å®‰å…¨ãƒ«ãƒ¼ãƒˆ & äº‹å‰ `ensureQueryData` ã§â€œã‚¼ãƒ­ç§’é·ç§»â€  
* **Query** â†’ ã‚­ãƒ£ãƒƒã‚·ãƒ¥å…±æœ‰ãƒ»SWRãƒ»ãƒªãƒˆãƒ©ã‚¤ã‚’ 1 è¡Œã§é›†ä¸­ç®¡ç†  
* **services å±¤** ã¯ â€œç”Ÿæˆ API åã‚’éš ã™ & æ¨ªæ–­çš„ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ³¨å…¥â€ ç”¨ã«ç½®ãã®ãŒãƒ™ã‚¿ãƒ¼ã€‚  
  ãŸã ã—ä¸è¦ãªã‚‰ *hooks ã‹ã‚‰ç›´æ¥ç”Ÿæˆãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³* ã§ã‚‚å‹•ãã¾ã™ã€‚  
* **UI** ã¯ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° / ã‚¨ãƒ©ãƒ¼ / è¡¨ç¤ºã® *ä¸‰åˆ†å²* ã ã‘ â€”â€” è–„ã„ãƒ“ãƒ¥ãƒ¼ã‚’ç¶­æŒã€‚  

ã“ã‚Œã§ **è»½é‡ SPA** ã®ã¾ã¾ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¨ç”»é¢ã‚’ãã‚Œã„ã«åˆ†é›¢ã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/16 23:55:02*

ã¡ãªã¿ã«ä»Šã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã€ CSSãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ä½•ã‚’é¸æŠã—ãŸæ–¹ãŒè‰¯ã•ãã†ã‹ã€‚ ã¾ãŸãƒ•ã‚©ãƒ«ãƒ€ã¯ã©ã‚“ãªæ§‹æˆã«ãªã‚Šãã†ã‹ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/16 23:55:03*

### 1 | ã©ã‚“ãª CSS æ‰‹æ³•ãŒ â€œã„ã¾â€ ç›¸æ€§ãŒè‰¯ã„ï¼Ÿ

| ã‚«ãƒ†ã‚´ãƒª | ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | å‘ã„ã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹ | pros / cons (è¦ç‚¹ã ã‘) |
|----------|-----------|------------------|------------------------|
| **ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ç³»ï¼ˆ1 æ®µï¼‰** | **Tailwind CSS** | ã€Œã¾ãšå‹•ã UI ã‚’é«˜é€Ÿã§çµ„ã¿ãŸã„ã€ã€Œã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ•°ãŒå¤šã„ã€ | âœ” Viteï¼‹PostCSS ã§ 1 åˆ†å°å…¥<br>âœ” Purge ã§å®Ÿåƒæ•° kB<br>âœ” IntelliSense / Prettier ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å……å®Ÿ<br>â— æ—¢å­˜ãƒ‡ã‚¶ã‚¤ãƒ³ä½“ç³»ãŒã‚ã‚‹ã¨ã‚¯ãƒ©ã‚¹çˆ†å¢— |
| | **UnoCSS** | Tailwind ã® API ãŒå¥½ãï¼ã•ã‚‰ã«ã‚µã‚¤ã‚ºã‚’å‰Šã‚ŠãŸã„ | âœ” â€œã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ç”Ÿæˆâ€ ã§ãƒ“ãƒ«ãƒ‰ãŒé€Ÿã„<br>âœ” ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§  (Windi/Tailwind/Figma-Tokens) æ··åœ¨å¯ |
| **CSS-in-JSï¼ˆå‹•çš„ãƒ†ãƒ¼ãƒï¼‰** | **vanilla-extract** | å®Œå…¨å‹å®‰å…¨ + 0 runtime ãŒæ¬²ã—ã„ | âœ” TS ã§å¤‰æ•°ãƒ»åª’ä½“ãƒ»ã‚«ãƒ©ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ«ã‚’ç®¡ç†<br>âœ” ãƒ“ãƒ«ãƒ‰æ™‚ã«ç´” CSS å‡ºåŠ›ï¼ˆãƒ©ãƒ³ã‚¿ã‚¤ãƒ  0ï¼‰<br>â— æ–°è¦å­¦ç¿’ã‚³ã‚¹ãƒˆé«˜ã‚ |
| | **styled-components / @emotion** | æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§æ¡ç”¨æ¸ˆã¿ï¼ãƒ©ãƒ³ã‚¿ã‚¤ãƒ å¤‰æ›´ãŒå¤šã„ | âœ” prop ã«å¿œã˜ãŸå‹•çš„ã‚¹ã‚¿ã‚¤ãƒ«ãŒæ¥½<br>â— è¿½åŠ ãƒ©ãƒ³ã‚¿ã‚¤ãƒ  ~10 kBãƒ»SSR ç”¨ã® Babel è¨­å®šãŒå¿…è¦ |
| **å¾“æ¥** | **CSS Modules + PostCSS** | ã‚·ãƒ³ãƒ—ãƒ«ã§ååˆ†ï¼BEM æ´¾ | âœ” ä¾å­˜ã‚¼ãƒ­ãƒ»IDE è£œå®Œå¯<br>â— ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã‚’è‡ªåˆ†ã§å®šç¾©ã™ã‚‹å¿…è¦ |

> **TanStack Query / Router** ã¯ UI ã‚’æŒãŸãªã„ãŸã‚  
> CSS æ‰‹æ³•ã¯ **å®Œå…¨ã«ç‹¬ç«‹**ã€‚  
> ğŸŒŸ **æœ€çŸ­ã§ UI ã‚’å½¢ã«ã—ãŸã„**ãªã‚‰ **Tailwind** ãŒå°å…¥ãƒ»å­¦ç¿’ã‚³ã‚¹ãƒˆæœ€å°ã€  
> ğŸ’ **å‹å®‰å…¨ãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³é§†å‹•ã‚’å¾¹åº•ã—ãŸã„**ãªã‚‰ **vanilla-extract** ãŒè¿‘å¹´æ€¥ä¼¸ä¸­ã§ã™ã€‚  

---

### 2 | Tailwind ã‚’æ¡ç”¨ã—ãŸå ´åˆã®ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆï¼ˆä¾‹ï¼‰

```
project/
â”œ public/
â”‚   â”” index.html
â”œ src/
â”‚   â”œ api/               # â† å‰è¿°
â”‚   â”œ lib/
â”‚   â”œ services/
â”‚   â”œ hooks/
â”‚   â”œ pages/
â”‚   â”œ components/
â”‚   â”‚   â”œ ui/            # Button.tsx, Card.tsx â€¦ã€Œç´”è¡¨ç¤ºã€
â”‚   â”‚   â”” layout/        # Header.tsx, Sidebar.tsx
â”‚   â”” styles/
â”‚       â”œ base.css       # @tailwind base;
â”‚       â”œ components.css # @tailwind components;
â”‚       â”œ utilities.css  # @tailwind utilities;
â”‚       â”” theme.css      # ã‚«ã‚¹ã‚¿ãƒ å¤‰æ•°ãƒ»ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒ
â”œ tailwind.config.ts     # presets / theme æ‹¡å¼µ
â”” vite.config.ts
```

* **pages/** ã§ã¯æ¥µåŠ›ç”Ÿ Tailwind ã‚¯ãƒ©ã‚¹ã ã‘  
* **components/ui/** ã« `className="btn-primary"` ã®ã‚ˆã†ãª  
  *æŠ½è±¡ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆ@apply ã§åˆæˆï¼‰* ã‚’ç”¨æ„ã™ã‚‹ã¨ã‚¯ãƒ©ã‚¹åˆ—ã®çˆ†ç™ºã‚’æŠ‘åˆ¶  
* **styles/theme.css** ã« CSS ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ç½®ã‘ã°  
  Tailwind ã® `theme('colors.primary')` ã¨åŒæœŸãŒå–ã‚Œã‚‹  

---

### 3 | vanilla-extract ã‚’æ¡ç”¨ã—ãŸå ´åˆ

```
src/
â”œ styles/
â”‚   â”œ tokens.css.ts      # ã‚«ãƒ©ãƒ¼ãƒ»ã‚¹ãƒšãƒ¼ã‚¹ãƒ»Z-index ãªã© Design Tokens
â”‚   â”œ global.css.ts      # normalizeãƒ»ãƒ¢ãƒ€ãƒ³ãƒªã‚»ãƒƒãƒˆ
â”‚   â”” themes.css.ts      # light/dark ä½œã‚Šåˆ†ã‘
â”” components/
    â”” Button/
        â”œ Button.css.ts  # recipe() ã§ variant ç”Ÿæˆ
        â”” Button.tsx
```

* **`*.css.ts`** å†…ã¯ pure TypeScript â†’ ãƒ“ãƒ«ãƒ‰æ™‚ CSS æŠ½å‡º  
* `import styles from './Button.css.ts'` ã—ã¦  
  `<button className={styles.primary}>` ã®ã‚ˆã†ã«ä½¿ç”¨  
* ãƒ©ãƒ³ã‚¿ã‚¤ãƒ  0 kBã€CSS ã‚¯ãƒ©ã‚¹åã¯ãƒãƒƒã‚·ãƒ¥è‡ªå‹•ç”Ÿæˆ

---

### 4 | ã€Œã¾ãšè»½é‡ã«å§‹ã‚ã‚‹ã€å„ªå…ˆåº¦

1. **Tailwind**   (ã¾ãŸã¯ UnoCSS) â€¦ æœ€é€Ÿã§ UI ãŒå®Œæˆ  
2. UI ãŒå›ºã¾ã£ãŸå¾Œ **vanilla-extract** ã«ç½®ãæ›ãˆã‚‚ã§ãã‚‹  
   ï¼ˆTailwind ã® `@apply` å…ˆã‚’é †æ¬¡ vanilla ã«ç§»è¡Œã—ã¦ã„ãæ–¹å¼ãŒå®Ÿä¾‹å¤šæ•°ï¼‰  
3. æ—¢å­˜ç¤¾å†…ãƒ‡ã‚¶ã‚¤ãƒ³ã‚­ãƒƒãƒˆãŒ styled-components ç­‰ã§çµ±ä¸€ã•ã‚Œã¦ã„ã‚‹ãªã‚‰  
   ãã®ã¾ã¾ä½¿ã†æ–¹ãŒãƒˆãƒ¼ã‚¿ãƒ«ã‚³ã‚¹ãƒˆã¯ä½ã„

---

## ğŸ“Œ ãƒãƒ§ã‚¤ã‚¹æ—©è¦‹è¡¨

| è¦ä»¶ | ãƒ™ã‚¹ãƒˆå€™è£œ |
|------|-----------|
| **æœ€é€Ÿãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ”ãƒ³ã‚°ï¼æœ€å° CSS ã‚µã‚¤ã‚º** | **Tailwind CSS** (or UnoCSS) |
| **å³å¯†ãª Design Tokensï¼å®Œå…¨å‹å®‰å…¨** | **vanilla-extract** |
| **æ—¢å­˜ styled-components è³‡ç”£ã‚’ç¶™ç¶š** | styled-components / @emotion |
| **ã¨ã«ã‹ãä¾å­˜ã‚¼ãƒ­ã§è¡ŒããŸã„** | CSS Modules + PostCSS |

> ã¾ãš **Tailwind** ã§ç”»é¢ã‚’ä»•ä¸Šã’ã€å¿…è¦ã«å¿œã˜ã¦  
> *ã€Œ`@apply` ã—ãŸãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’ vanilla-extract ã¸æ®µéšç§»è¡Œã€* ãŒ  
> **è»½é‡ Ã— å‹å®‰å…¨** ã‚’ä¸¡å–ã‚Šã™ã‚‹ 2025 å¹´ã®ç‹é“ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/17 0:05:38*

Tailwind CSS ã¨vanilla-extractã®2ã¤ã®å…±å­˜ã¯ç¾å®Ÿçš„ã‹ã€ãã‚Œã¨ã‚‚ç‰‡æ–¹ã«å¯„ã›ãŸæ–¹ãŒã„ã„ã‹ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/17 0:05:38*

### å…±å­˜ã¯ **ã€Œã‚„ã‚ã†ã¨æ€ãˆã°ã§ãã‚‹ã€** â”€ ãŸã ã—ãƒ«ãƒ¼ãƒ«ã‚’æ±ºã‚ãªã„ã¨ **æ··ä¹±ã—ã‚„ã™ã„**  

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | ãƒ¡ãƒªãƒƒãƒˆ | ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ |
|----------|----------|------------|
| **Tailwind ï¼‹ vanilla-extract ä¸¦å­˜** | - æ—¢å­˜ Tailwind ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã§è©¦ä½œãŒçˆ†é€Ÿ<br>- `vanilla-extract` ã§å‹å®‰å…¨ãƒ»å¤‰æ•°é§†å‹•ã®**ä»•ä¸Šã’éƒ¨å“**ã‚’æ®µéšçš„ã«è¿½åŠ ã§ãã‚‹ | - **ãƒ“ãƒ«ãƒ‰è¨­å®šãŒ 2 æœ¬**ï¼ˆPostCSS & Vite VE pluginï¼‰<br>- åŒã˜è‰²ãƒ»ä½™ç™½ã‚’2ã‹æ‰€ã§å®šç¾©ã—ç›´ã™ã¨ç ´ç¶»<br>- ã‚¯ãƒ©ã‚¹ vs CSS Modules ã§**ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«ãŒå‰²ã‚Œã‚‹** |
| **Tailwind ã«ä¸€æœ¬åŒ–** | - PostCSS ã ã‘ã§ã‚·ãƒ³ãƒ—ãƒ«<br>- å­¦ç¿’ã‚³ã‚¹ãƒˆæœ€ä½ã€ãƒãƒ¼ãƒ ã®åˆæ„å½¢æˆãŒå®¹æ˜“ | - ãƒ‡ã‚¶ã‚¤ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³ãŒ JS ã‹ã‚‰å‚ç…§ã—ã«ãã„<br>- å·¨å¤§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã¯ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£åˆ—ãŒé•·ããªã‚ŠãŒã¡ |
| **vanilla-extract ã«ä¸€æœ¬åŒ–** | - **å®Œå…¨å‹å®‰å…¨**ï¼štokens/variant ã‚’ TS ã§ç®¡ç†<br>- ãƒ©ãƒ³ã‚¿ã‚¤ãƒ  0 kB ã§æœ¬ç•ª CSS æœ€å° | - ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—é€Ÿåº¦ã¯ Tailwindã‚ˆã‚Šé…ã„<br>- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œã‚Šåˆ‡ã‚‹ã¾ã§ã€Œä½•ã‚‚æ˜ ã‚‰ãªã„ã€ã“ã¨ãŒã‚ã‚‹ |

---

## 1 | **ä¸¦å­˜ã™ã‚‹ãªã‚‰â€œå½¹å‰²åˆ†æ‹…â€ã‚’æ˜ç¢ºã«**

| ãƒ«ãƒ¼ãƒ«ä¾‹ | å…·ä½“çš„ãªæ›¸ãæ–¹ |
|---------|----------------|
| **ãƒšãƒ¼ã‚¸ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ & ä¸€ç™ºè£…é£¾** â†’ Tailwind  | ```<div className="flex items-center gap-4 p-6">``` |
| **å†åˆ©ç”¨ UI ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ– & ãƒ‡ã‚¶ã‚¤ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³** â†’ vanilla-extract | ```tsx<br>import * as s from './Button.css';<br><button className={s.primary}>â€¦``` |
| ã‚«ãƒ©ãƒ¼ãƒ»ã‚¹ãƒšãƒ¼ã‚¹ã¯ **`theme.css` ã« CSS å¤‰æ•°**ã‚’å®£è¨€ã—ã€<br>Tailwind `@apply` ã¨ vanilla-extract `vars` ã®ä¸¡æ–¹ã‹ã‚‰å‚ç…§ | ```css<br>:root { --color-primary: #3b82f6; }``` |

> **ãƒã‚¤ãƒ³ãƒˆ**: â€œTailwind ã§çµ„ã‚“ã ãƒ•ãƒ©ãƒƒãƒˆ HTMLâ€ ã‚’å¾Œã‹ã‚‰  
> **ã€ŒæŠ½è±¡ UI ã«æ˜‡æ ¼ã€**ã™ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ vanilla-extract ã«ç§»ã™â”€â”€  
> ã“ã†ã™ã‚Œã°äºŒé‡å®šç¾©ã‚’æŠ‘ãˆã¤ã¤æ®µéšç§»è¡Œã§ãã¾ã™ã€‚

---

## 2 | æœ€å°æ§‹æˆä¾‹ï¼ˆViteï¼‰

```ts
// vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { vanillaExtractPlugin } from '@vanilla-extract/vite-plugin';

export default defineConfig({
  plugins: [
    react(),
    vanillaExtractPlugin(),   // â† VE ç”¨
  ],
});
```

```css
/* src/styles/global.css */
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --color-primary: theme(colors.blue.500); /* Tailwind token ã‚’å¤‰æ•°åŒ– */
  }
}
```

```ts
// src/components/Button/Button.css.ts (VE)
import { recipe, vars } from '@/styles/tokens.css';

export const button = recipe({
  base: {
    padding: `${vars.space[2]} ${vars.space[4]}`,
    borderRadius: vars.radius.md,
  },
  variants: {
    tone: {
      primary: { background: 'var(--color-primary)', color: '#fff' },
      ghost:   { background: 'transparent',          color: 'var(--color-primary)' },
    },
  },
});
```

---

## 3 | **ã„ã¤ç‰‡æ–¹ã«å¯„ã›ã‚‹ã¹ãï¼Ÿ**

- **ãƒãƒ¼ãƒ ãŒ 1ã€œ3 äººï¼è©¦ä½œé€Ÿåº¦é‡è¦–**  
  â¡ **Tailwind ä¸€æœ¬**ã§ã¾ãš MVP ã‚’å‡ºã—ã€å¾Œã§å¿…è¦ãªã‚‰ `@apply` æŠ½è±¡åŒ–ã€‚
- **é•·æœŸãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã§ Design Token ã‚’å³æ ¼é‹ç”¨**  
  â¡ **vanilla-extract ä¸€æœ¬ or ä¸¦å­˜**ã‚’æ—©ã‚ã«æ¤œè¨ã€‚  
  ï¼ˆå…¨å“¡ãŒ TS ã‚’è§¦ã‚Œã‚‹ä½“åˆ¶ãŒå‰æï¼‰
- **ã™ã§ã« Tailwind ã§å‹•ã„ã¦ã„ã‚‹ãŒã€<br>ç¹°ã‚Šè¿”ã—ä½¿ã†è¤‡åˆéƒ¨å“ãŒè‚¥å¤§åŒ–**  
  â¡ **ä¸¦å­˜ â†’ å¾ã€…ã« VE ã¸åˆ‡æ›¿** ãŒç¾å®Ÿçš„ã€‚  
  _Tailwind-to-VE_ ã‚’è‡ªå‹•å¤‰æ›ã™ã‚‹ codemod ã‚‚ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã«å¢—ãˆã¤ã¤ã‚ã‚‹ã€‚

---

## 4 | ãƒãƒ¼ãƒ é‹ç”¨ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

1. **Figma / ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ **ãŒ Tailwind ã‚¹ã‚±ãƒ¼ãƒ«ã§å®Œçµã™ã‚‹ã‹ï¼Ÿ  
2. **ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼åŸºæº–**  
   - ã€Œlayout ã¯ Tailwindã€å†åˆ©ç”¨ã¯ VEã€ã¨ PR ãƒ†ãƒ³ãƒ—ãƒ¬ã«æ˜æ–‡åŒ–  
3. **CI ã§ãƒ‡ãƒƒãƒ‰ CSS æ¤œå‡º**  
   - PurgeCSS + `vanilla-extract/babel-plugin` ã§ä¸¡æ–¹ã®æœªä½¿ç”¨ã‚¹ã‚¿ã‚¤ãƒ«ã‚’æƒé™¤  
4. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**  
   - Storybook ã§ `args` ã‚’ä½¿ã„ã€VE ã§ä½œã£ãŸéƒ¨å“ã‚’ã‚«ã‚¿ãƒ­ã‚°åŒ–  
   - Tailwind åˆ©ç”¨ä¾‹ã¯ MDX ã§ â€œBest Practiceâ€ ã‚’è¨˜è¼‰

---

## âœ… çµè«–

- **å…±å­˜ã¯å¯èƒ½**ã ãŒã€Œã©ã“ã§ã©ã¡ã‚‰ã‚’ä½¿ã†ã‹ã€ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ãŒå¿…é ˆã€‚  
- *å°è¦æ¨¡ãƒ»é«˜é€Ÿ* âœ **Tailwindã ã‘**  
- *é•·æœŸãƒ»å³æ ¼ãƒˆãƒ¼ã‚¯ãƒ³* âœ **vanilla-extractä¸»ä½“** or **æ®µéšç§»è¡Œ**  
- è¿·ã£ãŸã‚‰ Tailwind ã‚¹ã‚¿ãƒ¼ãƒˆ â†’ **å†åˆ©ç”¨éƒ¨å“ãŒè‚²ã£ãŸæ®µéšã§ VE ã«æ˜‡æ ¼** ãŒå¤±æ•—ã—ã«ãã„ç¾å®Ÿè§£ã§ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/17 0:07:21*

ã‚€ã—ã‚ä»Šã‹ã‚‰ã‚¼ãƒ­ã‹ã‚‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å§‹ã‚ã‚ˆã†ã¨æ€ã£ã¦ã„ã‚‹ã€‚ ã¾ãŸãƒªã‚¢ã‚¯ãƒˆã ã£ãŸã‚Šã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã ã£ãŸã‚Šã€ãƒªã‚¢ã‚¯ãƒˆã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã ã£ãŸã‚Šã®æ©æµãŒå—ã‘ã‚‰ã‚ŒãŸã‚‰å¬‰ã—ã„ã¨æ€ã£ã¦ã„ã‚‹ã‹çµ¶å¯¾ã§ã¯ãªã„ã‘ã©å¬‰ã—ã„ãªã¨æ€ã£ã¦ã„ã‚‹ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/17 0:07:22*

## 0 ã‹ã‚‰å§‹ã‚ã‚‹ã¨ãã® â€œå®Ÿç”¨ Ã— é•·ç”Ÿãâ€ ã‚¹ã‚¿ãƒƒã‚¯æŒ‡é‡

| ç›®çš„ | æœ€çŸ­ã§ã‚´ãƒ¼ãƒ«ã«å±Šãé¸æŠ | Next.js ã‚’é¿ã‘ãŸã„å ´åˆã®ä»£æ›¿ |
|------|----------------------|------------------------------|
| **CSR-SPA**ï¼ˆã¾ãšå‹•ã UIï¼‰ | Vite + React 19 + TanStack Query/Router | ã€ƒï¼ˆNext ãªã—ã§ååˆ†ï¼‰ |
| **SSR / ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°** | Next.js 14ï¼ˆApp Routerï¼‰ | **Vite SSR + Express** ã§ *Hydrate on top*<br>ï¼ˆReact 19 + `vite-plugin-ssr` + TanStack Routerï¼‰ |
| **React Server Components** | Next.js 14 (å®‰å®š) | âš ï¸ 2025-06 æ™‚ç‚¹ã§ã¯ã©ã® Vite ç³»ã‚‚ **ã¾ã å®Ÿé¨“æ®µéš**<br>`vite-rsc` or `react-server-dom-vite` ã‚’è©¦ã™ä¾¡å€¤ã¯ã‚ã‚‹ãŒæœ¬ç•ªã¯æ…é‡ã« |

> **çµè«–ã‚’å…ˆã«**  
> 1. **ã¾ãš Vite + CSRï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼‰** ã§ç”»é¢ã¨ãƒ­ã‚¸ãƒƒã‚¯ã‚’å›ºã‚ã‚‹  
> 2. å¿…è¦ã«ãªã£ãŸã‚‰ **Vite ã® SSR ãƒ“ãƒ«ãƒ‰**ã«ã‚¹ã‚¤ãƒƒãƒ â†’ Express/Fastify ã§é…ä¿¡  
> 3. RSC ã‚’æœ¬ç•ªã§ä½¿ã†ãªã‚‰ **Next.js 14** ãŒã¾ã å”¯ä¸€ã®å®‰å®šè§£  
>    ï¼ˆãŸã ã— *å®Œå…¨å¿…é ˆ* ã§ã¯ãªã„ â€” Streaming SSR ã ã‘ã§ã‚‚ä½“æ„Ÿé€Ÿåº¦ã¯ååˆ†ã«å‘ä¸Šï¼‰

ä»¥ä¸‹ã¯ **ã€ŒNext ã‚’ä½¿ã‚ãš / React-Vite ç³»ã ã‘ã§ SSR ã¾ã§è¡ŒããŸã„ã€** ãƒ«ãƒ¼ãƒˆã®
æœ€å°ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã¨ã‚³ãƒ¼ãƒ‰æ–­ç‰‡ã§ã™ã€‚

---

## 1. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
project/
â”œ server/                    # SSR ç”¨ Node ã‚¨ãƒ³ãƒˆãƒª
â”‚   â”” index.ts               # (Fastify/Express)
â”œ src/
â”‚   â”œ api/                   # openapi-generator ã®ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ
â”‚   â”œ lib/
â”‚   â”‚   â”œ queryClient.ts
â”‚   â”‚   â”” router.ts          # TanStack Router (client+server å…±ç”¨)
â”‚   â”œ entry-client.tsx       # Vite ãŒè‡ªå‹•æ³¨å…¥ã™ã‚‹ hydrate ã‚¨ãƒ³ãƒˆãƒª
â”‚   â”œ entry-server.tsx       # Vite SSR ãŒå‘¼ã¶ â€œrenderâ€ ã‚¨ãƒ³ãƒˆãƒª
â”‚   â”œ hooks/                 # useUsers ãªã© (Query)
â”‚   â”œ services/              # ä»»æ„ã€‚ç”Ÿæˆ API ã‚’åŒ…ã‚€
â”‚   â”œ components/            # å†åˆ©ç”¨ UI
â”‚   â”œ pages/                 # ç”»é¢ (Route component)
â”‚   â”” styles/                # Tailwind / vanilla-extract ç­‰
â”œ tailwind.config.ts
â”” vite.config.ts
```

---

## 2. Vite è¨­å®šï¼ˆ`vite.config.ts`ï¼‰

```ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import ssr from 'vite-plugin-ssr/plugin';        // ğŸ”µ Streaming SSR
import { vanillaExtractPlugin } from '@vanilla-extract/vite-plugin';

export default defineConfig({
  plugins: [
    react(),
    vanillaExtractPlugin(),     // ä½¿ã‚ãªã„ãªã‚‰å‰Šé™¤
    ssr({ directives: { stream: true } }),
  ],
  ssr: {
    target: 'node',
    noExternal: ['@tanstack/router', '@tanstack/react-query'],
  },
});
```

---

## 3. Router ã‚’ **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ã‚µãƒ¼ãƒãƒ¼å…±ç”¨**

```ts
// src/lib/router.ts
import {
  Router,
  RootRoute,
  Route,
  createMemoryHistory,
} from '@tanstack/router';
import { queryClient } from './queryClient';
import Root  from '@/pages/Root';
import Home  from '@/pages/Home';
import Users from '@/pages/users/UsersPage';
import User  from '@/pages/users/UserDetailPage';
import { userService } from '@/services/userService';

/* â‘  ãƒ«ãƒ¼ãƒˆå®£è¨€ï¼ˆå‹å®‰å…¨ï¼‰ */
const rootRoute = new RootRoute({ component: Root });

const homeRoute  = new Route({ getParentRoute: () => rootRoute, path: '/', component: Home });

const usersRoute = new Route({
  getParentRoute: () => rootRoute,
  path: '/users',
  component: Users,
  loader: () => queryClient.ensureQueryData(['users'], userService.list),
});

const userRoute  = new Route({
  getParentRoute: () => usersRoute,
  path: '$userId',
  component: User,
  loader: ({ params }) =>
    queryClient.ensureQueryData(['user', params.userId], () =>
      userService.get(params.userId),
    ),
});

/* â‘¡ Router factory â€” history ã¯ DI */
export const createRouter = (history = undefined /* client default */) =>
  new Router({
    routeTree: rootRoute.addChildren([homeRoute, usersRoute.addChildren([userRoute])]),
    context: { queryClient },
    history, // client: undefined (browser), server: memory
  });
```

---

## 4. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¨ãƒ³ãƒˆãƒªï¼ˆ`entry-client.tsx`ï¼‰

```tsx
import React from 'react';
import { hydrateRoot } from 'react-dom/client';
import { QueryClientProvider } from '@tanstack/react-query';
import { RouterProvider } from '@tanstack/router';
import { createRouter } from '@/lib/router';
import { queryClient } from '@/lib/queryClient';

/* ãƒ–ãƒ©ã‚¦ã‚¶ç”¨ Router ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ */
const router = createRouter(); // history = BrowserHistory ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ

hydrateRoot(
  document.getElementById('root')!,
  <QueryClientProvider client={queryClient}>
    <RouterProvider router={router} />
  </QueryClientProvider>,
);
```

---

## 5. ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ³ãƒˆãƒªï¼ˆ`entry-server.tsx`ï¼‰

```tsx
import React from 'react';
import { createRouter } from '@/lib/router';
import { QueryClientProvider, QueryClient } from '@tanstack/react-query';
import { RouterProvider } from '@tanstack/router';
import { renderToPipeableStream } from 'react-dom/server';

export default async function render(url: string, res: any) {
  const queryClient = new QueryClient();
  const router = createRouter(createMemoryHistory({ initialEntries: [url] }));

  // ãƒ«ãƒ¼ãƒˆ loader ã‚’å®Ÿè¡Œã—ã€ãƒ‡ãƒ¼ã‚¿ã‚’ Query ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«å…¥ã‚Œã¦ãŠã
  await router.load();

  const { pipe } = renderToPipeableStream(
    <QueryClientProvider client={queryClient}>
      <RouterProvider router={router} />
    </QueryClientProvider>,
    {
      onShellReady() {
        res.setHeader('content-type', 'text/html');
        pipe(res);
      },
      onError(err) {
        console.error(err);
        res.statusCode = 500;
        res.end('Internal Error');
      },
    },
  );
}
```

---

## 6. ã‚µãƒ¼ãƒãƒ¼ï¼ˆExpress ä¾‹ï¼‰`server/index.ts`

```ts
import express from 'express';
import { createServer as createViteServer } from 'vite';
import render from '../dist/server/entry-server.js';

(async () => {
  const app = express();
  const vite = await createViteServer({
    server: { middlewareMode: 'ssr' },
  });

  app.use(vite.middlewares);

  app.get('*', async (req, res) => {
    try {
      await render(req.originalUrl, res);
    } catch (e) {
      vite.ssrFixStacktrace(e as Error);
      res.status(500).end((e as Error).message);
    }
  });

  app.listen(3000, () => console.log('http://localhost:3000'));
})();
```

---

## 7. ã€Œã‚µãƒ¼ãƒ“ã‚¹å±¤ã¯è¦ã‚‹ï¼Ÿã€å•é¡Œ

| æ¡ä»¶ | ã©ã†ã™ã‚‹ã‹ |
|------|-----------|
| **ç”Ÿæˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒ¡ã‚½ãƒƒãƒ‰åãƒ»å¼•æ•°ãŒãã®ã¾ã¾ â€œãƒ‰ãƒ¡ã‚¤ãƒ³èªâ€ ã§æ¸ˆã‚€** | **hooks ã‹ã‚‰ç›´å‘¼ã³**ã§ OK |
| - å…±é€šãƒ˜ãƒƒãƒ€ï¼ãƒªãƒˆãƒ©ã‚¤ï¼èªè¨¼ã‚’æ¨ªä¸²ã§å·®ã—è¾¼ã¿ãŸã„<br>- ç”Ÿæˆ API ãŒãƒªãƒãƒ¼ãƒ ã§å£Šã‚Œã‚„ã™ã„<br>- ãƒ†ã‚¹ãƒˆã§å·®ã—æ›¿ãˆãƒ¢ãƒƒã‚¯ã‚’æ³¨å…¥ã—ãŸã„ | **services/** ã‚’è–„ã 1 ãƒ•ã‚¡ã‚¤ãƒ«ç½®ãã¨å¾Œã§æ¥½ |

*æœ€åˆã¯ç„¡ã— â†’ å¿…è¦ãŒè¦‹ãˆãŸæ™‚ç‚¹ã§ `services/` ã‚’åˆ‡ã‚Šå‡ºã™* æ–¹ãŒç„¡é§„ãŒã‚ã‚Šã¾ã›ã‚“ã€‚  

---

## 8. CSS æ–¹é‡ã‚’çµ¡ã‚ãŸ â€œæœ€å°ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—â€

1. **Tailwind**:  
   ```bash
   npm i -D tailwindcss postcss autoprefixer
   npx tailwindcss init -p
   ```
   `src/styles/global.css` ã« `@tailwind base; ...` ã‚’æ›¸ãã€`main.tsx` ã§ importã€‚
2. å¾Œã§ **vanilla-extract** ã‚’è¶³ã—ãŸã‘ã‚Œã° `vite-plugin-vanilla-extract` ã‚’è¿½åŠ ã—ã€
   å†åˆ©ç”¨éƒ¨å“ã ã‘ `*.css.ts` ã«ç§»è¡Œã—ã¦ã„ãï¼ˆæ··åœ¨ OK: PostCSS ã¨ç›¸æ€§è‰¯ã„ï¼‰ã€‚

---

## âœ… ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ã¾ã¨ã‚

1. **Vite create** â†’ `npm create vite@latest my-app --template react-ts`
2. **è¿½åŠ ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**  
   ```bash
   pnpm add @tanstack/react-query @tanstack/router
   pnpm add -D vite-plugin-ssr express
   # CSS ãŒ Tailwind ã®å ´åˆ
   pnpm add -D tailwindcss postcss autoprefixer
   ```
3. ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä¸Šè¨˜æ§‹æˆã«ã—ã¦  
   *`lib/router.ts`* / *entry-client.tsx* / *entry-server.tsx* ã‚’ã‚³ãƒ”ãƒš
4. `pnpm dev` â†’ CSR ã§ã¾ãšå‹•ã  
   `pnpm build && node server/index.js` â†’ SSR ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã§å‹•ã

ã“ã‚Œã§ **Next.js ãªã—**ã«

* âœ… Vite ã®é«˜é€Ÿ DX  
* âœ… TanStack Query/Router ã® **å‹å®‰å…¨ & ã‚­ãƒ£ãƒƒã‚·ãƒ¥**  
* âœ… Node ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚° SSRï¼ˆå¿…è¦ã«ãªã£ãŸã‚‰å³ã‚ªãƒ³ï¼‰  

ã‚’å‚™ãˆãŸ **è»½é‡ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯** ãŒ 0 ã‹ã‚‰ç«‹ã¡ä¸ŠãŒã‚Šã¾ã™ã€‚  
React Server Components ã‚’æœ¬ç•ªã§ä½¿ã†æ—¥ã¯ã‚‚ã†å°‘ã—å…ˆã§ã™ãŒã€
ã“ã®æ§‹æˆãªã‚‰ **RSC å¯¾å¿œãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒå®‰å®šã—ãŸæ™‚ç‚¹ã§å·®ã—æ›¿ãˆ**ã‚‚å®¹æ˜“ã§ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/17 0:09:22*

vanilla-extractã¨ç›¸æ€§ã®ã„ã„ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã¯ã‚ã‚‹ã‹ã€‚ ä¾‹ãˆã°Figmaã‹ã‚‰ä½œã‚ŒãŸã‚Šã¨ã‹ã€ ãªã‚‹ã¹ãå‹å®‰å…¨ã«é–‹ç™ºã—ãŸã„ã¨æ€ã£ã¦ã„ã‚‹ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/17 0:09:52*

### vanilla-extract ã¨â€œç›¸æ€§ãŒã„ã„â€ãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³æ—©è¦‹è¡¨

| ç›®çš„ | æ¨å¥¨ãƒ„ãƒ¼ãƒ« | ã²ã¨è¨€ã¾ã¨ã‚ |
|------|-----------|-------------|
| **Figma â†’ ãƒ‡ã‚¶ã‚¤ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³æŠ½å‡º** | **Tokens Studio for Figma**ï¼ˆæ—§ Figma Tokensï¼‰ | Figma å¤‰æ•°/ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ JSON ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€‚CLI ã‚‚ã‚ã‚Š îˆ€citeîˆ‚turn0search3îˆ |
| **ãƒˆãƒ¼ã‚¯ãƒ³ JSON â†’ å‹å®‰å…¨ãª TS & CSS å¤‰æ›** | **Style Dictionary ï¼‹ SD-Transforms** | `tokens.json â†’ tokens.css.ts + theme.css` ã‚’è‡ªå‹•ç”Ÿæˆ îˆ€citeîˆ‚turn3search2îˆ |
| **ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚¯ãƒ©ã‚¹åŒ–ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–åŒ–** | `@vanilla-extract/sprinkles`<br>`@vanilla-extract/recipes`<br>ï¼ˆæ´¾ç”Ÿç³» Rainbow Sprinkles ãªã©ï¼‰ | prop ãƒ™ãƒ¼ã‚¹ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’å‹å®‰å…¨ã«ç”Ÿæˆ îˆ€citeîˆ‚turn0search4îˆ‚turn1view0îˆ |
| **Variant API ã‚’ã‚‚ã£ã¨ç°¡æ½”ã«** | **class-variance-authority (CVA)** | recipes ã®è–„ã„ãƒ©ãƒƒãƒ‘ãƒ¼ã€‚Tailwind/CSS ä½µç”¨æ™‚ã‚‚â— |
| **ã‚¿ã‚¤ãƒã‚°ãƒ©ãƒ•ã‚£ã‚’æ•°å€¤ã§ç®¡ç†** | **Capsize** | è¡Œé«˜ãƒ»ã‚«ãƒƒãƒˆã‚ªãƒ•ã‚’æ•°å¼åŒ–ã—ã¦ `style()` ã¸æµã—è¾¼ã¿ |
| **ã‚³ãƒ¼ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼** | `css-to-vanilla-extract` | æ—¢å­˜ CSS/Sass ã‚’ä¸€æ‹¬ `.css.ts` å¤‰æ› îˆ€citeîˆ‚turn1view0îˆ |
| **Component Lib é€£æº** | Mantineãƒ»Radix UI ãªã©ã¯å…¬å¼ã« VE ã‚¬ã‚¤ãƒ‰ã‚ã‚Š îˆ€citeîˆ‚turn2search5îˆ |

> âš¡ **ãƒã‚¤ãƒ³ãƒˆ**  
> - *Figma â‡’ Tokens Studio â‡’ Style Dictionary â‡’ vanilla-extract* ã¨ã„ã† **ä¸€æ–¹å‘ãƒ‘ã‚¤ãƒ—** ã«ã™ã‚‹ã¨ã€äººæ‰‹ã§å¤‰æ›ã™ã‚‹å ´æ‰€ãŒã‚¼ãƒ­ã€‚  
> - ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯å‹ä»˜ãã® `.css.ts` ãªã®ã§ **IDE è£œå®Œãƒ»å®‰å…¨ãªãƒªãƒãƒ¼ãƒ ** ãŒåŠ¹ãã¾ã™ã€‚

---

## æ¨å¥¨ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã¨æœ€å°ã‚³ãƒ¼ãƒ‰ä¾‹

```
project/
â”œ design-tokens/          # Figma ã‹ã‚‰ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ (Tokens Studio)
â”‚   â”” tokens.json
â”œ scripts/                # ãƒˆãƒ¼ã‚¯ãƒ³â†’VE å¤‰æ›ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”” build-tokens.ts
â”œ src/
â”‚   â”œ styles/
â”‚   â”‚   â”œ contract.css.ts # è‡ªå‹•ç”Ÿæˆ: createGlobalThemeContract()
â”‚   â”‚   â”œ theme.css.ts    # è‡ªå‹•ç”Ÿæˆ: createGlobalTheme()
â”‚   â”‚   â”œ sprinkles.css.ts# prop ãƒ™ãƒ¼ã‚¹ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”‚   â”” recipes/        # Button.recipe.ts â€¦ variant API
â”‚   â”” components/
â”‚       â”” Button/
â”‚           â”œ Button.css.ts
â”‚           â”” Button.tsx
â”” style-dictionary.config.js
```

### 1. Style Dictionary â†’ vanilla-extract å¤‰æ›ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```js
// style-dictionary.config.js
module.exports = {
  source: ['design-tokens/tokens.json'],
  platforms: {
    ve: {
      transformGroup: 'tokens-studio',  // SD-Transforms ãŒæä¾›
      buildPath: 'src/styles/',
      files: [
        { destination: 'contract.css.ts', format: 've/contract' },
        { destination: 'theme.css.ts',    format: 've/theme'    },
      ],
    },
  },
};
```

```bash
# ä¾å­˜
pnpm add -D style-dictionary @tokens-studio/sd-transforms
pnpm run sd                # => contract.css.ts / theme.css.ts ã‚’ç”Ÿæˆ
```

*ã“ã‚Œã§ **Figma å´ã®å¤‰æ›´ â†’ `pnpm run sd` ã ã‘ã§å‹ä»˜ããƒ†ãƒ¼ãƒãŒæœ€æ–°åŒ–** ã•ã‚Œã¾ã™ã€‚*

### 2. Sprinkles & Recipes ã‚’ã¤ãªã„ã§å‹å®‰å…¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

```ts
// src/styles/sprinkles.css.ts
import { defineProperties, createSprinkles } from '@vanilla-extract/sprinkles';
import { vars } from './contract.css';          // â† è‡ªå‹•ç”Ÿæˆã§å‹ä»˜

const responsive = defineProperties({
  conditions: { mobile: {}, desktop: { '@media': 'screen and (min-width: 768px)' } },
  defaultCondition: 'mobile',
  properties: { padding: vars.space, display: ['flex', 'block'] },
});

export const sprinkles = createSprinkles(responsive);
/* ä½¿ç”¨å´: className={sprinkles({ padding: { mobile: 2, desktop: 4 } })} */
```

### 3. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä¾‹

```ts
// src/components/Button/Button.css.ts
import { recipe } from '@vanilla-extract/recipes';
import { vars } from '@/styles/contract.css';

export const button = recipe({
  base: { borderRadius: vars.radius.md, fontWeight: 600 },
  variants: {
    tone: {
      primary: { background: vars.color.primary, color: '#fff' },
      ghost:   { background: 'transparent',      color: vars.color.primary },
    },
    size: {
      sm: { padding: `${vars.space[1]} ${vars.space[3]}` },
      md: { padding: `${vars.space[2]} ${vars.space[4]}` },
    },
  },
  defaultVariants: { tone: 'primary', size: 'md' },
});
```

```tsx
// Button.tsx
import * as s from './Button.css';

export function Button(props: React.ComponentProps<'button'> & RecipeVariants<typeof s.button>) {
  const { tone, size, ...rest } = props;
  return <button className={s.button({ tone, size })} {...rest} />;
}
```

*`tone` ã‚„ `size` ã®å€¤ã¯ **è‡ªå‹•ã§ union å‹åŒ–** ã•ã‚Œã€èª¤å­—ã¯ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚*

---

## â€œç‰‡æ–¹ã«å¯„ã›ã‚‹ã‹ï¼Ÿå…±å­˜ã‹ï¼Ÿâ€ ã®æœ€çµ‚åˆ¤æ–­

| ãƒãƒ¼ãƒ çŠ¶æ³ | æ¨å¥¨ |
|------------|------|
| **UI ä»•æ§˜ãŒã¾ã æµå‹•çš„** | ã¾ãš **Tailwind** ã§ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ”ãƒ³ã‚° â†’ å›ºã¾ã£ãŸéƒ¨å“ã ã‘ VE ã¸ç§»è¡Œ |
| **é•·æœŸé‹ç”¨ãƒ»å¤šè¨€èª / å¤šãƒ–ãƒ©ãƒ³ãƒ‰ãƒ†ãƒ¼ãƒ** | æœ€åˆã‹ã‚‰ **vanilla-extract + TokensStudio/StyleDictionary** ã§ä¸€æœ¬åŒ– |
| **æ—¢å­˜ Tailwind ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¼¸é€²ç§»è¡Œ** | `css-to-vanilla-extract` ã§æ®µéšã‚³ãƒ³ãƒãƒ¼ãƒˆ + `@apply` ã§æ©‹æ¸¡ã— |

> **Rule of thumb**:  
> **ãƒ‡ã‚¶ã‚¤ãƒ³æºæ³‰ï¼ˆFigmaï¼‰â†’ å‹å®‰å…¨ãƒˆãƒ¼ã‚¯ãƒ³ â†’ VE ãƒ†ãƒ¼ãƒ â†’ Sprinkles/Recipes**  
> â€¦ã¨ã„ã† **å˜ä¸€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³** ã‚’ä¿ã¦ã‚‹ãªã‚‰å…±å­˜ã—ã¦ã‚‚æ··ä¹±ã—ã¾ã›ã‚“ã€‚  
> é€†ã« *Figma â‡’ Tailwind Config â‡’ VE* ã®ã‚ˆã†ã«æåˆ†ã‹ã‚Œã™ã‚‹ã¨ç®¡ç†åœ°ç„ã«é™¥ã‚‹ã®ã§æ³¨æ„ã—ã¾ã—ã‚‡ã†ã€‚

---

### å‚è€ƒãƒªãƒ³ã‚¯

* Tokens Studio plugin & CLI â€“ Figma ã‹ã‚‰å¤šå½¢å¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ›¸ãå‡ºã— îˆ€citeîˆ‚turn0search3îˆ  
* Style Dictionary + SD-Transforms â€“ JSONâ†’VE å¤‰æ›å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ îˆ€citeîˆ‚turn3search2îˆ  
* Rainbow Sprinkles / Macaron ãªã© VE å°‚ç”¨æ‹¡å¼µã¯ã€Œawesome-vanilla-extractã€ãƒªã‚¹ãƒˆå‚ç…§ îˆ€citeîˆ‚turn1view0îˆ  
* ä¼æ¥­å°å…¥äº‹ä¾‹ï¼šVE + Sprinkles ã§å®Œå…¨å‹å®‰å…¨åŒ– îˆ€citeîˆ‚turn0search4îˆ  

ã“ã‚Œã‚‰ã‚’çµ„ã¿åˆã‚ã›ã‚Œã° **Figma ã‹ã‚‰ã‚³ãƒ¼ãƒ‰ã¾ã§ 100 % å‹å®‰å…¨ãªä¸€æœ¬ç·š**ãŒå¼•ã‘ã€é•·æœŸé‹ç”¨ã§ã‚‚ç ´ç¶»ã—ã«ãã„ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°åŸºç›¤ã‚’æ‰‹ã«å…¥ã‚Œã‚‰ã‚Œã¾ã™ã€‚

---

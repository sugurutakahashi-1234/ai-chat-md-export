# GitHooksã®æ¦‚è¦

æ—¥ä»˜: 2023-05-03

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/05/04 01:22:23*

GitHooks ã«ã¤ã„ã¦æ•™ãˆã¦

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/05/04 01:24:06*

GitHooksã¯ã€Gitã®æ©Ÿèƒ½ã®ä¸€éƒ¨ã§ã€ãƒªãƒã‚¸ãƒˆãƒªã®ç‰¹å®šã®ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã™ã‚‹å‰å¾Œã«ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã‚‹ä»•çµ„ã¿ã§ã™ã€‚ã“ã‚Œã‚‰ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€ä¸»ã«é–‹ç™ºè€…ã®ä½œæ¥­ãƒ•ãƒ­ãƒ¼ã‚’åŠ¹ç‡åŒ–ã—ã€ãƒãƒ¼ãƒ é–“ã§ä¸€è²«æ€§ã‚’ä¿ã¤ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

GitHooksã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã¾ãŸã¯ãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã§å‹•ä½œã—ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¤ãƒ™ãƒ³ãƒˆã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚

1. ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä½œæˆå‰å¾Œ
2. ã‚³ãƒŸãƒƒãƒˆå‰å¾Œ
3. ãƒ–ãƒ©ãƒ³ãƒã®ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆå‰å¾Œ
4. ãƒ–ãƒ©ãƒ³ãƒã®ãƒãƒ¼ã‚¸å‰å¾Œ
5. ãƒ—ãƒƒã‚·ãƒ¥å‰å¾Œ
6. ãã®ä»–ã®ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ

GitHooksã¯ã€ãƒªãƒã‚¸ãƒˆãƒªã®`.git/hooks`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã™ã€‚ã“ã‚Œã‚‰ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚„Pythonã€Rubyãªã©ã€å®Ÿè¡Œå¯èƒ½ãªã‚ã‚‰ã‚†ã‚‹è¨€èªã§æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚GitHooksã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€é©åˆ‡ãªã‚¤ãƒ™ãƒ³ãƒˆã«å¯¾å¿œã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«åã§ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã€å®Ÿè¡Œå¯èƒ½ã«ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

GitHooksã®ä¾‹:

1. ã‚³ãƒ¼ãƒ‰ã®å“è³ªã‚’ä¿ã¤ãŸã‚ã«ã€ã‚³ãƒŸãƒƒãƒˆå‰ã«ã‚³ãƒ¼ãƒ‰ã®ãƒªãƒ³ãƒˆï¼ˆæ§‹æ–‡ãƒã‚§ãƒƒã‚¯ï¼‰ã‚’å®Ÿè¡Œã™ã‚‹ã€‚
2. ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’æ¤œè¨¼ã—ã€ä¸é©åˆ‡ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®å ´åˆã¯ã‚³ãƒŸãƒƒãƒˆã‚’æ‹’å¦ã™ã‚‹ã€‚
3. ãƒ–ãƒ©ãƒ³ãƒã®ãƒãƒ¼ã‚¸å‰ã«ã€ç‰¹å®šã®ãƒ–ãƒ©ãƒ³ãƒãƒãƒªã‚·ãƒ¼ãŒæº€ãŸã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ã€‚

GitHooksã¯ã€åŠ¹ç‡çš„ãªé–‹ç™ºãƒ•ãƒ­ãƒ¼ã‚’ã‚µãƒãƒ¼ãƒˆã—ã€ãƒãƒ¼ãƒ ã®ç”Ÿç”£æ€§ã‚’å‘ä¸Šã•ã›ã‚‹å¼·åŠ›ãªãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ãŸã ã—ã€é©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€äºˆæœŸã—ãªã„å•é¡Œã‚’å¼•ãèµ·ã“ã™å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€æ³¨æ„ã—ã¦ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/05/04 01:37:48*

ä»¥ä¸‹ã®GitHooksã®pre-commitã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç¶ºéº—ã«æ›¸ãç›´ã—ã¦ã¿ã¦

```
#!/usr/bin/env sh

# SwiftFormat
command="swift run --package-path BuildTools swiftformat"

color_red () {
  ESC=$(printf '\033')
  printf "$ESC[31m$1$ESC[m"
}

command -v $command 1>/dev/null 2>&1
if [ $? -gt 0 ]; then
  echo $(color_red "ğŸ˜“ swiftformat ã‚³ãƒãƒ³ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚")
  exit 1
fi

should_fail=false
staged_swift_files=`git diff --diff-filter=d --staged --name-only | grep -e '\(.*\).swift$'`
if [ -z "$staged_swift_files" ]; then
  # no swift file found
  exit 0
fi

while read file; do
  # stagingã•ã‚Œã¦ã„ãªã„å¤‰æ›´ã®ãƒ‘ãƒƒãƒã‚’ä½œæˆ
  unstaged_patch=$(git diff "$file")
  if [ ! -z "$unstaged_patch" ]; then
    # stagingã•ã‚Œã¦ã„ãªã„å¤‰æ›´ãŒã‚ã‚Œã°å‰Šé™¤
    git restore $file
  fi
  # stagingã®å¤‰æ›´éƒ¨åˆ†ã®ã¿SwiftFormatã§ãƒã‚§ãƒƒã‚¯ (å¤‰æ›´ã¯èµ·ã“ã‚‰ãªã„)
  echo "ğŸ‘ SwiftFormat: ç¢ºèªä¸­... $file"
  $command --lint $file
  if [ $? -eq 0 ]; then
    # no error
    if [ ! -z "$unstaged_patch" ]; then
      # ãƒ‘ãƒƒãƒãŒã‚ã‚Œã°é©ç”¨ã—ã¦æˆ»ã™
      echo "$unstaged_patch" | git apply --whitespace=nowarn
    fi
    printf "\n"
    continue
  fi
  
  should_fail=true
  if [ ! -z "$unstaged_patch" ]; then
    # ãƒ‘ãƒƒãƒãŒã‚ã‚Œã°é©ç”¨ã—ã¦æˆ»ã™
    echo "$unstaged_patch" | git apply --whitespace=nowarn
  fi
  # SwiftFormatã‚’é©ç”¨ (å¤‰æ›´ãŒèµ·ã“ã‚‹)
  echo "ğŸª¬ SwiftFormat: é©ç”¨ä¸­... $file"
  $command $file
  printf "\n"
done <<< "$staged_swift_files"
# â†‘doneã®å¾Œã‚ã‹ã‚‰èª­ã¿è¾¼ã¾ã›ã‚‹æ–¹æ³•ã§ãªã‘ã‚Œã°ã€should_failå¤‰æ•°ã®å¤‰æ›´ãŒåæ˜ ã•ã‚Œãªã„

if "$should_fail" ; then
  echo $(color_red "â›”ï¸ SwiftFormatã«ã‚ˆã£ã¦ã‚³ãƒ¼ãƒ‰ã«å¤‰æ›´ãŒç”Ÿã˜ã¾ã—ãŸã€‚")
  echo "å¤‰æ›´ã‚’å–ã‚Šå…¥ã‚Œã‚‹ãªã©ã®å¯¾å¿œã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚"
  echo "ğŸ”— wikiã¯ã“ã¡ã‚‰ - https://..."
  exit 1
fi
```

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/05/04 01:39:38*

ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ•´ç†ã—ã¾ã—ãŸã€‚ä¸»ãªå¤‰æ›´ç‚¹ã¯ã‚³ãƒ¡ãƒ³ãƒˆã®è¿½åŠ ã€é–¢æ•°ã®å®šç¾©ã€ãŠã‚ˆã³ä¸€éƒ¨ã®ã‚³ãƒ¼ãƒ‰ã®ç°¡ç•¥åŒ–ã§ã™ã€‚

```bash
#!/usr/bin/env sh

# Functions
color_red() {
  ESC=$(printf '\033')
  printf "$ESC[31m$1$ESC[m"
}

run_swiftformat() {
  command="swift run --package-path BuildTools swiftformat"
  command -v $command >/dev/null 2>&1
  if [ $? -gt 0 ]; then
    echo $(color_red "ğŸ˜“ swiftformat ã‚³ãƒãƒ³ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚")
    exit 1
  fi
  $command "$@"
}

# Variables
should_fail=false
staged_swift_files=$(git diff --diff-filter=d --staged --name-only | grep -e '\(.*\).swift$')

# Main script
if [ -z "$staged_swift_files" ]; then
  # No Swift files found
  exit 0
fi

while read file; do
  # Create patch for unstaged changes
  unstaged_patch=$(git diff "$file")
  if [ ! -z "$unstaged_patch" ]; then
    # Remove unstaged changes if any
    git restore $file
  fi

  # Check staged changes only with SwiftFormat (no changes applied)
  echo "ğŸ‘ SwiftFormat: ç¢ºèªä¸­... $file"
  run_swiftformat --lint $file
  if [ $? -eq 0 ]; then
    if [ ! -z "$unstaged_patch" ]; then
      # Apply patch if any and restore unstaged changes
      echo "$unstaged_patch" | git apply --whitespace=nowarn
    fi
    printf "\n"
    continue
  fi

  should_fail=true
  if [ ! -z "$unstaged_patch" ]; then
    # Apply patch if any and restore unstaged changes
    echo "$unstaged_patch" | git apply --whitespace=nowarn
  fi

  # Apply SwiftFormat to the file (changes will be applied)
  echo "ğŸª¬ SwiftFormat: é©ç”¨ä¸­... $file"
  run_swiftformat $file
  printf "\n"
done <<< "$staged_swift_files"

if $should_fail; then
  echo $(color_red "â›”ï¸ SwiftFormatã«ã‚ˆã£ã¦ã‚³ãƒ¼ãƒ‰ã«å¤‰æ›´ãŒç”Ÿã˜ã¾ã—ãŸã€‚")
  echo "å¤‰æ›´ã‚’å–ã‚Šå…¥ã‚Œã‚‹ãªã©ã®å¯¾å¿œã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚"
  echo "ğŸ”— wikiã¯ã“ã¡ã‚‰ - https://..."
  exit 1
fi
```

ã“ã®æ•´ç†ã«ã‚ˆã‚Šã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒã‚ˆã‚Šèª­ã¿ã‚„ã™ããªã‚Šã€ä¿å®ˆæ€§ãŒå‘ä¸Šã—ã¦ã„ã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/05/04 01:39:50*

ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ—¥æœ¬èªã«å¤‰æ›´ã—ã¦

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/05/04 01:42:14*

ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ—¥æœ¬èªã«å¤‰æ›´ã—ã¾ã—ãŸã€‚ä»¥ä¸‹ãŒä¿®æ­£å¾Œã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã™ã€‚

```bash
#!/usr/bin/env sh

# é–¢æ•°
color_red() {
  ESC=$(printf '\033')
  printf "$ESC[31m$1$ESC[m"
}

run_swiftformat() {
  command="swift run --package-path BuildTools swiftformat"
  command -v $command >/dev/null 2>&1
  if [ $? -gt 0 ]; then
    echo $(color_red "ğŸ˜“ swiftformat ã‚³ãƒãƒ³ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚")
    exit 1
  fi
  $command "$@"
}

# å¤‰æ•°
should_fail=false
staged_swift_files=$(git diff --diff-filter=d --staged --name-only | grep -e '\(.*\).swift$')

# ãƒ¡ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
if [ -z "$staged_swift_files" ]; then
  # Swiftãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ
  exit 0
fi

while read file; do
  # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚Œã¦ã„ãªã„å¤‰æ›´ã®ãƒ‘ãƒƒãƒã‚’ä½œæˆ
  unstaged_patch=$(git diff "$file")
  if [ ! -z "$unstaged_patch" ]; then
    # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚Œã¦ã„ãªã„å¤‰æ›´ãŒã‚ã‚‹å ´åˆã¯å‰Šé™¤
    git restore $file
  fi

  # SwiftFormatã§ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚ŒãŸå¤‰æ›´ã®ã¿ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆå¤‰æ›´ã¯é©ç”¨ã•ã‚Œã¾ã›ã‚“ï¼‰
  echo "ğŸ‘ SwiftFormat: ç¢ºèªä¸­... $file"
  run_swiftformat --lint $file
  if [ $? -eq 0 ]; then
    if [ ! -z "$unstaged_patch" ]; then
      # ãƒ‘ãƒƒãƒãŒã‚ã‚‹å ´åˆã¯é©ç”¨ã—ã¦æœªã‚¹ãƒ†ãƒ¼ã‚¸ã®å¤‰æ›´ã‚’å¾©å…ƒ
      echo "$unstaged_patch" | git apply --whitespace=nowarn
    fi
    printf "\n"
    continue
  fi

  should_fail=true
  if [ ! -z "$unstaged_patch" ]; then
    # ãƒ‘ãƒƒãƒãŒã‚ã‚‹å ´åˆã¯é©ç”¨ã—ã¦æœªã‚¹ãƒ†ãƒ¼ã‚¸ã®å¤‰æ›´ã‚’å¾©å…ƒ
    echo "$unstaged_patch" | git apply --whitespace=nowarn
  fi

  # ãƒ•ã‚¡ã‚¤ãƒ«ã«SwiftFormatã‚’é©ç”¨ï¼ˆå¤‰æ›´ãŒé©ç”¨ã•ã‚Œã¾ã™ï¼‰
  echo "ğŸª¬ SwiftFormat: é©ç”¨ä¸­... $file"
  run_swiftformat $file
  printf "\n"
done <<< "$staged_swift_files"

if $should_fail; then
  echo $(color_red "â›”ï¸ SwiftFormatã«ã‚ˆã£ã¦ã‚³ãƒ¼ãƒ‰ã«å¤‰æ›´ãŒç”Ÿã˜ã¾ã—ãŸã€‚")
  echo "å¤‰æ›´ã‚’å–ã‚Šå…¥ã‚Œã‚‹ãªã©ã®å¯¾å¿œã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚"
  echo "ğŸ”— wikiã¯ã“ã¡ã‚‰ - https://..."
  exit 1
fi
```

ã“ã‚Œã§ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ã‚³ãƒ¡ãƒ³ãƒˆãŒæ—¥æœ¬èªã«ãªã‚Šã¾ã—ãŸã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/05/04 01:43:40*

while æ–‡ã‚’ä½¿ã†ã®ã‚’ã‚„ã‚ã¦æ›¸ãã“ã¨ã¯ã§ãã¾ã›ã‚“ã‹ï¼Ÿ

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/05/04 01:45:45*

ã‚‚ã¡ã‚ã‚“ã§ãã¾ã™ã€‚`while`æ–‡ã‚’ä½¿ã‚ãšã«`for`æ–‡ã‚’ä½¿ç”¨ã—ã¦ã€åŒã˜å‡¦ç†ã‚’å®Ÿç¾ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä»¥ä¸‹ãŒä¿®æ­£å¾Œã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã™ã€‚

```bash
#!/usr/bin/env sh

# é–¢æ•°
color_red() {
  ESC=$(printf '\033')
  printf "$ESC[31m$1$ESC[m"
}

run_swiftformat() {
  command="swift run --package-path BuildTools swiftformat"
  command -v $command >/dev/null 2>&1
  if [ $? -gt 0 ]; then
    echo $(color_red "ğŸ˜“ swiftformat ã‚³ãƒãƒ³ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚")
    exit 1
  fi
  $command "$@"
}

# å¤‰æ•°
should_fail=false
staged_swift_files=$(git diff --diff-filter=d --staged --name-only | grep -e '\(.*\).swift$')

# ãƒ¡ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
if [ -z "$staged_swift_files" ]; then
  # Swiftãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ
  exit 0
fi

# ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚ŒãŸSwiftãƒ•ã‚¡ã‚¤ãƒ«ã®é…åˆ—ã‚’ä½œæˆ
IFS=$'\n' read -ra swift_files_array <<< "$staged_swift_files"

for file in "${swift_files_array[@]}"; do
  # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚Œã¦ã„ãªã„å¤‰æ›´ã®ãƒ‘ãƒƒãƒã‚’ä½œæˆ
  unstaged_patch=$(git diff "$file")
  if [ ! -z "$unstaged_patch" ]; then
    # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚Œã¦ã„ãªã„å¤‰æ›´ãŒã‚ã‚‹å ´åˆã¯å‰Šé™¤
    git restore $file
  fi

  # SwiftFormatã§ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚ŒãŸå¤‰æ›´ã®ã¿ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆå¤‰æ›´ã¯é©ç”¨ã•ã‚Œã¾ã›ã‚“ï¼‰
  echo "ğŸ‘ SwiftFormat: ç¢ºèªä¸­... $file"
  run_swiftformat --lint $file
  if [ $? -eq 0 ]; then
    if [ ! -z "$unstaged_patch" ]; then
      # ãƒ‘ãƒƒãƒãŒã‚ã‚‹å ´åˆã¯é©ç”¨ã—ã¦æœªã‚¹ãƒ†ãƒ¼ã‚¸ã®å¤‰æ›´ã‚’å¾©å…ƒ
      echo "$unstaged_patch" | git apply --whitespace=nowarn
    fi
    printf "\n"
    continue
  fi

  should_fail=true
  if [ ! -z "$unstaged_patch" ]; then
    # ãƒ‘ãƒƒãƒãŒã‚ã‚‹å ´åˆã¯é©ç”¨ã—ã¦æœªã‚¹ãƒ†ãƒ¼ã‚¸ã®å¤‰æ›´ã‚’å¾©å…ƒ
    echo "$unstaged_patch" | git apply --whitespace=nowarn
  fi

  # ãƒ•ã‚¡ã‚¤ãƒ«ã«SwiftFormatã‚’é©ç”¨ï¼ˆå¤‰æ›´ãŒé©ç”¨ã•ã‚Œã¾ã™ï¼‰
  echo "ğŸª¬ SwiftFormat: é©ç”¨ä¸­... $file"
  run_swiftformat $file
  printf "\n"
done

if $should_fail; then
  echo $(color_red "â›”ï¸ SwiftFormatã«ã‚ˆã£ã¦ã‚³ãƒ¼ãƒ‰ã«å¤‰æ›´ãŒç”Ÿã˜ã¾ã—ãŸã€‚")
  echo "å¤‰æ›´ã‚’å–ã‚Šå…¥ã‚Œã‚‹ãªã©ã®å¯¾å¿œã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚"
  echo "ğŸ”— wikiã¯ã“ã¡ã‚‰ - https://..."
  exit 1
fi
```

ã“ã®ä¿®æ­£ã«ã‚ˆã‚Šã€`

---

# ファイルパスの抽出方法

Date: 2023-05-03

---

## 👤 User
*2023-05-04 02:11:47*

シェルスクリプトで"/Users/sugurutakahashi/git/SwiftUI-Sample-App/SampleAppCommonModule/Sources/SampleAppCoreFoundation/MockError.swift:12:1:" の文字列から"MockError.swift:12:1:"みたいに最後のスラッシュの部分の文字列を抜き出す時ってどうやるんだっけ？

---

## 🤖 Assistant
*2023-05-04 02:12:23*

シェルスクリプトで最後のスラッシュ以降の部分の文字列を抜き出すには、`basename` コマンドを使うか、パラメータ展開を利用する方法があります。

1. `basename` コマンドを使う方法:

```bash
filepath="/Users/sugurutakahashi/git/SwiftUI-Sample-App/SampleAppCommonModule/Sources/SampleAppCoreFoundation/MockError.swift:12:1:"
filename_with_position=$(basename "$filepath")
echo "$filename_with_position"
```

2. パラメータ展開を利用する方法:

```bash
filepath="/Users/sugurutakahashi/git/SwiftUI-Sample-App/SampleAppCommonModule/Sources/SampleAppCoreFoundation/MockError.swift:12:1:"
filename_with_position="${filepath##*/}"
echo "$filename_with_position"
```

どちらの方法でも、`MockError.swift:12:1:` が抜き出されます。

---

## 👤 User
*2023-05-04 02:14:17*

それを踏まえて以下のスクリプトのechoしている文字列が最後のスラッシュ以降の部分の文字列になるように書き換えてて欲しい

```
#!/usr/bin/env sh

# 関数
run_swiftformat() {
  command="swift run --package-path SampleAppToolsPackage swiftformat"
  command -v $command >/dev/null 2>&1
  if [ $? -gt 0 ]; then
    echo "😓 swiftformat コマンドが見つかりません。"
    exit 1
  fi
  $command "$@"
}

# 変数
should_fail=false
staged_swift_files=$(git diff --diff-filter=d --staged --name-only | grep -e '\(.*\).swift$')

# メインスクリプト
if [ -z "$staged_swift_files" ]; then
  # 変更された Swift ファイルが見つからない場合
  exit 0
fi

while read file; do
  # ステージングされていない変更のパッチを作成
  unstaged_patch=$(git diff "$file")
  if [ ! -z "$unstaged_patch" ]; then
    # ステージングされていない変更がある場合は削除
    git restore $file
  fi

  # SwiftFormat でステージングされた変更のみをチェック（変更は適用されません）
  echo "👁 SwiftFormat: 確認中... $file"
  run_swiftformat --lint $file
  if [ $? -eq 0 ]; then
    if [ ! -z "$unstaged_patch" ]; then
      # パッチがある場合は適用して未ステージの変更を復元
      echo "$unstaged_patch" | git apply --whitespace=nowarn
    fi
    printf "\n"
    continue
  fi

  should_fail=true
  if [ ! -z "$unstaged_patch" ]; then
    # パッチがある場合は適用して未ステージの変更を復元
    echo "$unstaged_patch" | git apply --whitespace=nowarn
  fi

  # ファイルにSwiftFormatを適用（変更が適用されます）
  echo "🪬 SwiftFormat: 適用中... $file"
  run_swiftformat $file
  printf "\n"
done <<< "$staged_swift_files"

if $should_fail; then
  echo "⛔️ SwiftFormatによってコードに変更が生じました。"
  echo "変更を取り入れるなどの対応をお願いします。"
  exit 1
fi
```

---

## 🤖 Assistant
*2023-05-04 02:16:09*

以下のスクリプトは、最後のスラッシュ以降の部分の文字列を `echo` するように修正しました。

```bash
#!/usr/bin/env sh

# 関数
run_swiftformat() {
  command="swift run --package-path SampleAppToolsPackage swiftformat"
  command -v $command >/dev/null 2>&1
  if [ $? -gt 0 ]; then
    echo "😓 swiftformat コマンドが見つかりません。"
    exit 1
  fi
  $command "$@"
}

# 変数
should_fail=false
staged_swift_files=$(git diff --diff-filter=d --staged --name-only | grep -e '\(.*\).swift$')

# メインスクリプト
if [ -z "$staged_swift_files" ]; then
  # 変更された Swift ファイルが見つからない場合
  exit 0
fi

while read file; do
  # ステージングされていない変更のパッチを作成
  unstaged_patch=$(git diff "$file")
  if [ ! -z "$unstaged_patch" ]; then
    # ステージングされていない変更がある場合は削除
    git restore $file
  fi

  # 最後のスラッシュ以降の部分の文字列を取得
  filename_with_position="${file##*/}"

  # SwiftFormat でステージングされた変更のみをチェック（変更は適用されません）
  echo "👁 SwiftFormat: 確認中... $filename_with_position"
  run_swiftformat --lint $file
  if [ $? -eq 0 ]; then
    if [ ! -z "$unstaged_patch" ]; then
      # パッチがある場合は適用して未ステージの変更を復元
      echo "$unstaged_patch" | git apply --whitespace=nowarn
    fi
    printf "\n"
    continue
  fi

  should_fail=true
  if [ ! -z "$unstaged_patch" ]; then
    # パッチがある場合は適用して未ステージの変更を復元
    echo "$unstaged_patch" | git apply --whitespace=nowarn
  fi

  # ファイルにSwiftFormatを適用（変更が適用されます）
  echo "🪬 SwiftFormat: 適用中... $filename_with_position"
  run_swiftformat $file
  printf "\n"
done <<< "$staged_swift_files"

if $should_fail; then
  echo "⛔️ SwiftFormatによってコードに変更が生じました。"
  echo "変更を取り入れるなどの対応をお願いします。"
  exit 1
fi
```

このスクリプトでは、`filename_with_position` という変数に最後のスラッシュ以降の部分の文字列を格納し、それを `echo` しています。

---

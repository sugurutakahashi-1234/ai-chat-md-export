# ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®æŠ½å‡ºæ–¹æ³•

Date: 2023-05-03

---

## ğŸ‘¤ User
*2023-05-04 02:11:47*

ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§"/Users/sugurutakahashi/git/SwiftUI-Sample-App/SampleAppCommonModule/Sources/SampleAppCoreFoundation/MockError.swift:12:1:" ã®æ–‡å­—åˆ—ã‹ã‚‰"MockError.swift:12:1:"ã¿ãŸã„ã«æœ€å¾Œã®ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã®éƒ¨åˆ†ã®æ–‡å­—åˆ—ã‚’æŠœãå‡ºã™æ™‚ã£ã¦ã©ã†ã‚„ã‚‹ã‚“ã ã£ã‘ï¼Ÿ

---

## ğŸ¤– Assistant
*2023-05-04 02:12:23*

ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§æœ€å¾Œã®ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ä»¥é™ã®éƒ¨åˆ†ã®æ–‡å­—åˆ—ã‚’æŠœãå‡ºã™ã«ã¯ã€`basename` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã†ã‹ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å±•é–‹ã‚’åˆ©ç”¨ã™ã‚‹æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚

1. `basename` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã†æ–¹æ³•:

```bash
filepath="/Users/sugurutakahashi/git/SwiftUI-Sample-App/SampleAppCommonModule/Sources/SampleAppCoreFoundation/MockError.swift:12:1:"
filename_with_position=$(basename "$filepath")
echo "$filename_with_position"
```

2. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å±•é–‹ã‚’åˆ©ç”¨ã™ã‚‹æ–¹æ³•:

```bash
filepath="/Users/sugurutakahashi/git/SwiftUI-Sample-App/SampleAppCommonModule/Sources/SampleAppCoreFoundation/MockError.swift:12:1:"
filename_with_position="${filepath##*/}"
echo "$filename_with_position"
```

ã©ã¡ã‚‰ã®æ–¹æ³•ã§ã‚‚ã€`MockError.swift:12:1:` ãŒæŠœãå‡ºã•ã‚Œã¾ã™ã€‚

---

## ğŸ‘¤ User
*2023-05-04 02:14:17*

ãã‚Œã‚’è¸ã¾ãˆã¦ä»¥ä¸‹ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®echoã—ã¦ã„ã‚‹æ–‡å­—åˆ—ãŒæœ€å¾Œã®ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ä»¥é™ã®éƒ¨åˆ†ã®æ–‡å­—åˆ—ã«ãªã‚‹ã‚ˆã†ã«æ›¸ãæ›ãˆã¦ã¦æ¬²ã—ã„

```
#!/usr/bin/env sh

# é–¢æ•°
run_swiftformat() {
  command="swift run --package-path SampleAppToolsPackage swiftformat"
  command -v $command >/dev/null 2>&1
  if [ $? -gt 0 ]; then
    echo "ğŸ˜“ swiftformat ã‚³ãƒãƒ³ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚"
    exit 1
  fi
  $command "$@"
}

# å¤‰æ•°
should_fail=false
staged_swift_files=$(git diff --diff-filter=d --staged --name-only | grep -e '\(.*\).swift$')

# ãƒ¡ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
if [ -z "$staged_swift_files" ]; then
  # å¤‰æ›´ã•ã‚ŒãŸ Swift ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ
  exit 0
fi

while read file; do
  # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚Œã¦ã„ãªã„å¤‰æ›´ã®ãƒ‘ãƒƒãƒã‚’ä½œæˆ
  unstaged_patch=$(git diff "$file")
  if [ ! -z "$unstaged_patch" ]; then
    # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚Œã¦ã„ãªã„å¤‰æ›´ãŒã‚ã‚‹å ´åˆã¯å‰Šé™¤
    git restore $file
  fi

  # SwiftFormat ã§ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚ŒãŸå¤‰æ›´ã®ã¿ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆå¤‰æ›´ã¯é©ç”¨ã•ã‚Œã¾ã›ã‚“ï¼‰
  echo "ğŸ‘ SwiftFormat: ç¢ºèªä¸­... $file"
  run_swiftformat --lint $file
  if [ $? -eq 0 ]; then
    if [ ! -z "$unstaged_patch" ]; then
      # ãƒ‘ãƒƒãƒãŒã‚ã‚‹å ´åˆã¯é©ç”¨ã—ã¦æœªã‚¹ãƒ†ãƒ¼ã‚¸ã®å¤‰æ›´ã‚’å¾©å…ƒ
      echo "$unstaged_patch" | git apply --whitespace=nowarn
    fi
    printf "\n"
    continue
  fi

  should_fail=true
  if [ ! -z "$unstaged_patch" ]; then
    # ãƒ‘ãƒƒãƒãŒã‚ã‚‹å ´åˆã¯é©ç”¨ã—ã¦æœªã‚¹ãƒ†ãƒ¼ã‚¸ã®å¤‰æ›´ã‚’å¾©å…ƒ
    echo "$unstaged_patch" | git apply --whitespace=nowarn
  fi

  # ãƒ•ã‚¡ã‚¤ãƒ«ã«SwiftFormatã‚’é©ç”¨ï¼ˆå¤‰æ›´ãŒé©ç”¨ã•ã‚Œã¾ã™ï¼‰
  echo "ğŸª¬ SwiftFormat: é©ç”¨ä¸­... $file"
  run_swiftformat $file
  printf "\n"
done <<< "$staged_swift_files"

if $should_fail; then
  echo "â›”ï¸ SwiftFormatã«ã‚ˆã£ã¦ã‚³ãƒ¼ãƒ‰ã«å¤‰æ›´ãŒç”Ÿã˜ã¾ã—ãŸã€‚"
  echo "å¤‰æ›´ã‚’å–ã‚Šå…¥ã‚Œã‚‹ãªã©ã®å¯¾å¿œã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚"
  exit 1
fi
```

---

## ğŸ¤– Assistant
*2023-05-04 02:16:09*

ä»¥ä¸‹ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€æœ€å¾Œã®ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ä»¥é™ã®éƒ¨åˆ†ã®æ–‡å­—åˆ—ã‚’ `echo` ã™ã‚‹ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã—ãŸã€‚

```bash
#!/usr/bin/env sh

# é–¢æ•°
run_swiftformat() {
  command="swift run --package-path SampleAppToolsPackage swiftformat"
  command -v $command >/dev/null 2>&1
  if [ $? -gt 0 ]; then
    echo "ğŸ˜“ swiftformat ã‚³ãƒãƒ³ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚"
    exit 1
  fi
  $command "$@"
}

# å¤‰æ•°
should_fail=false
staged_swift_files=$(git diff --diff-filter=d --staged --name-only | grep -e '\(.*\).swift$')

# ãƒ¡ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
if [ -z "$staged_swift_files" ]; then
  # å¤‰æ›´ã•ã‚ŒãŸ Swift ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ
  exit 0
fi

while read file; do
  # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚Œã¦ã„ãªã„å¤‰æ›´ã®ãƒ‘ãƒƒãƒã‚’ä½œæˆ
  unstaged_patch=$(git diff "$file")
  if [ ! -z "$unstaged_patch" ]; then
    # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚Œã¦ã„ãªã„å¤‰æ›´ãŒã‚ã‚‹å ´åˆã¯å‰Šé™¤
    git restore $file
  fi

  # æœ€å¾Œã®ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ä»¥é™ã®éƒ¨åˆ†ã®æ–‡å­—åˆ—ã‚’å–å¾—
  filename_with_position="${file##*/}"

  # SwiftFormat ã§ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚ŒãŸå¤‰æ›´ã®ã¿ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆå¤‰æ›´ã¯é©ç”¨ã•ã‚Œã¾ã›ã‚“ï¼‰
  echo "ğŸ‘ SwiftFormat: ç¢ºèªä¸­... $filename_with_position"
  run_swiftformat --lint $file
  if [ $? -eq 0 ]; then
    if [ ! -z "$unstaged_patch" ]; then
      # ãƒ‘ãƒƒãƒãŒã‚ã‚‹å ´åˆã¯é©ç”¨ã—ã¦æœªã‚¹ãƒ†ãƒ¼ã‚¸ã®å¤‰æ›´ã‚’å¾©å…ƒ
      echo "$unstaged_patch" | git apply --whitespace=nowarn
    fi
    printf "\n"
    continue
  fi

  should_fail=true
  if [ ! -z "$unstaged_patch" ]; then
    # ãƒ‘ãƒƒãƒãŒã‚ã‚‹å ´åˆã¯é©ç”¨ã—ã¦æœªã‚¹ãƒ†ãƒ¼ã‚¸ã®å¤‰æ›´ã‚’å¾©å…ƒ
    echo "$unstaged_patch" | git apply --whitespace=nowarn
  fi

  # ãƒ•ã‚¡ã‚¤ãƒ«ã«SwiftFormatã‚’é©ç”¨ï¼ˆå¤‰æ›´ãŒé©ç”¨ã•ã‚Œã¾ã™ï¼‰
  echo "ğŸª¬ SwiftFormat: é©ç”¨ä¸­... $filename_with_position"
  run_swiftformat $file
  printf "\n"
done <<< "$staged_swift_files"

if $should_fail; then
  echo "â›”ï¸ SwiftFormatã«ã‚ˆã£ã¦ã‚³ãƒ¼ãƒ‰ã«å¤‰æ›´ãŒç”Ÿã˜ã¾ã—ãŸã€‚"
  echo "å¤‰æ›´ã‚’å–ã‚Šå…¥ã‚Œã‚‹ãªã©ã®å¯¾å¿œã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚"
  exit 1
fi
```

ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã¯ã€`filename_with_position` ã¨ã„ã†å¤‰æ•°ã«æœ€å¾Œã®ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ä»¥é™ã®éƒ¨åˆ†ã®æ–‡å­—åˆ—ã‚’æ ¼ç´ã—ã€ãã‚Œã‚’ `echo` ã—ã¦ã„ã¾ã™ã€‚

---

# ESLint設定修正案

日付: 2025-05-19

---

## 👤 ユーザー
*2025/5/19 21:31:44*

この記述が適切かどうかが分からない

import tseslint from "typescript-eslint";
import unicornPlugin from "eslint-plugin-unicorn";
import sonarjsPlugin from "eslint-plugin-sonarjs";
import prettierConfig from "eslint-config-prettier";

export default tseslint.config(
  tseslint.configs.strictTypeChecked,
  {
    languageOptions: {
      parser: tseslint.parser,
      parserOptions: {
        project: "./tsconfig.json",
        tsconfigRootDir: import.meta.dirname,
      },
    },
  },
  {
    plugins: {
      unicorn: unicornPlugin,
      sonarjs: sonarjsPlugin,
    },
    rules: {
      ...prettierConfig.rules,
      ...unicornPlugin.configs.recommended.rules,
      ...sonarjsPlugin.configs.recommended.rules,
    },
  },
  prettierConfig,
  {
    ignores: ["dist/**", "node_modules/**"],
  }
);

---

## 🤖 アシスタント
*2025/5/19 21:31:48*

このESLint設定（ESLint v9+の`typescript-eslint`新形式）について、**記述自体は概ね正しい方向ですが、いくつか修正・注意点があります。**  
今の書き方だと**動かない/意図通りにならない可能性が高いです**。  
理由と、より適切な記述例を解説します。

---

## 問題点・気になる点

1. **`eslint-config-prettier`はルールセットであり、`rules`としてスプレッドするのは非対応**  
   `eslint-config-prettier`は`rules`オブジェクトではなく、`configs`や`extends`として使うものです。

2. **pluginのrecommendedは`configs`であり、直接`.rules`で展開しない**  
   `eslint-plugin-unicorn`や`eslint-plugin-sonarjs`の`recommended`はルールセット全体。  
   通常は`extends: ["plugin:unicorn/recommended", ...]`で使うもの。

3. **tseslint.configの使い方**  
   配列ではなく、オブジェクト（または複数の設定オブジェクトを渡す）  
   ですが、`tseslint.config()`に`tseslint.configs.strictTypeChecked`をそのまま入れるのは「*拡張用*」として使いたいならOKですが、併用時の順序や競合に注意。

4. **`prettierConfig.rules`がない**  
   公式の`eslint-config-prettier`は`rules`プロパティを持たず、extendsすることで「競合を無効化」します。

5. **`import.meta.dirname`はNode.jsのESM限定。古いNodeや一部環境では動かない。**  
   問題なければOK。

---

## **正しい・おすすめの書き方例（ESLint v9系/typescript-eslint新方式）**

公式おすすめ（2024年5月時点）の記述例をもとに修正版を示します：

```js
import tseslint from "typescript-eslint";
import unicorn from "eslint-plugin-unicorn";
import sonarjs from "eslint-plugin-sonarjs";
import prettier from "eslint-config-prettier";

export default tseslint.config(
  // TypeScript用のstrict config
  tseslint.configs.strictTypeChecked,
  {
    languageOptions: {
      parser: tseslint.parser,
      parserOptions: {
        project: "./tsconfig.json",
        tsconfigRootDir: import.meta.dirname,
      },
    },
    plugins: {
      unicorn,
      sonarjs,
    },
    // "extends"のようにruleset全体を拡張
    extends: [
      "plugin:unicorn/recommended",
      "plugin:sonarjs/recommended",
      "prettier"
    ],
    // 追加したい独自ルール
    rules: {
      // 例: "unicorn/filename-case": ["error", { "case": "camelCase" }]
    },
    ignores: [
      "dist/**",
      "node_modules/**"
    ],
  }
);
```

---

### **ポイント**

- `extends` でpluginやprettierのrecommendedを指定する（rules直指定しない）。
- `prettier`は必ず`extends`で後ろに書く（他のrecommendedの後）。
- `plugins`にはインポートしたものを入れるが、`extends`しないとrulesは有効にならない。
- `tseslint.configs.strictTypeChecked`などのプリセットを先頭に渡すことでTypeScript対応を強化。
- `ignores`で除外パス指定。

---

## **まとめ**

- **今の記述だと意図通りに機能しません。**
- **`extends`でrecommended/Prettierルールを有効にしましょう。**
- **`rules`で`...prettierConfig.rules`はNG。**

---

### **もし公式リファレンスを確認したい場合**

- [typescript-eslint v7 の ESLint config documentation](https://typescript-eslint.io/blog/announcing-typescript-eslint-v7/#eslint-flat-config-support)
- [eslint-config-prettier 公式](https://github.com/prettier/eslint-config-prettier)
- [eslint-plugin-unicorn 公式](https://github.com/sindresorhus/eslint-plugin-unicorn)

---

**自分のプロジェクトに合わせて`rules`を足していけばOKです！  
もし環境（Node, package, TypeScript）で追加の調整があれば教えてください。**

---

## 👤 ユーザー
*2025/5/19 21:37:36*

最新はtypeScriptにも対応したらしいのでその記述方法で書いて欲しい

---

## 🤖 アシスタント
*2025/5/19 21:37:36*

はい！  
**ESLint v9** & **typescript-eslint v7**以降の「フラット構成（`eslint.config.js`）」と「TypeScript対応」の最新・公式推奨記述例を示します。

---

## **最新版：TypeScript対応 ESLint フラット構成例**

この例は、  
- **ESLint v9+**
- **@typescript-eslint/eslint-plugin v7+**
- **`eslint.config.js`（フラット構成）**
- **Prettier/Unicorn/SonarJS全て併用**
- `typescript`パッケージも必要

に準拠しています。

---

```js
// eslint.config.js
import tseslint from "typescript-eslint";
import unicorn from "eslint-plugin-unicorn";
import sonarjs from "eslint-plugin-sonarjs";
import prettier from "eslint-config-prettier";

export default [
  // typescript-eslint の strictTypeChecked推奨セット
  ...tseslint.configs.strictTypeChecked,
  {
    // TypeScriptプロジェクト用設定
    languageOptions: {
      parser: tseslint.parser,
      parserOptions: {
        project: "./tsconfig.json",
        tsconfigRootDir: import.meta.dirname,
      },
    },
    plugins: {
      unicorn,
      sonarjs,
    },
    // 追加で有効化したいルールセット
    extends: [
      "plugin:unicorn/recommended",
      "plugin:sonarjs/recommended",
      "prettier"
    ],
    // 独自で上書きしたい場合はここに追記
    rules: {
      // "unicorn/filename-case": ["error", { "case": "camelCase" }]
    },
    ignores: [
      "dist/**",
      "node_modules/**"
    ],
  },
];
```

---

### **ポイントまとめ**

- `tseslint.configs.strictTypeChecked`は**配列展開**（`...`）することで他の設定とマージ可能
- TypeScriptプロジェクトであることを`parserOptions.project`で明示
- `plugins`は**オブジェクトで記述**し、`extends`でpluginのrecommendedやprettierを指定
- `.rules`には独自上書きだけ書く
- `ignores`で不要なパスを除外
- **必ずNode.js 18+ & ESLint 9+**で利用（それ以前はこの書き方は動きません）

---

### **パッケージ例**

必要なnpmパッケージ：

```sh
pnpm add -D eslint typescript @typescript-eslint/eslint-plugin @typescript-eslint/parser eslint-plugin-unicorn eslint-plugin-sonarjs eslint-config-prettier
```

---

## **参考**
- [typescript-eslint公式: v7 flat configガイド](https://typescript-eslint.io/getting-started/eslint-flat-config/)
- [eslint-config-prettier flat config対応](https://github.com/prettier/eslint-config-prettier#eslint-flat-config)
- [eslint-plugin-unicorn flat config例](https://github.com/sindresorhus/eslint-plugin-unicorn#flat

---

## 👤 ユーザー
*2025/5/19 21:38:56*

そういうことではなくて、eslint.config.jsではなく、eslint.config.tsとなっているらしい。

---

## 🤖 アシスタント
*2025/5/19 21:38:57*

ありがとうございます、理解しました！  
**2024年以降、`eslint.config.ts`（TypeScriptで書くESLintフラット設定）が公式サポートされています。**  
TypeScriptで書いてもOKですが、記述内容自体は `.js` とほぼ同じです。ただし、型安全や補完のメリットが得られます。

---

## `eslint.config.ts` の最新・正しい記述例（TypeScript/ESLint v9+）

```ts
// eslint.config.ts

import tseslint from "typescript-eslint";
import unicorn from "eslint-plugin-unicorn";
import sonarjs from "eslint-plugin-sonarjs";
import prettier from "eslint-config-prettier";
import type { FlatConfigItem } from "eslint-define-config";

const config: FlatConfigItem[] = [
  // TypeScriptのstrict config（配列展開が必要）
  ...tseslint.configs.strictTypeChecked,
  {
    languageOptions: {
      parser: tseslint.parser,
      parserOptions: {
        project: "./tsconfig.json",
        tsconfigRootDir: import.meta.dirname,
      },
    },
    plugins: {
      unicorn,
      sonarjs,
    },
    extends: [
      "plugin:unicorn/recommended",
      "plugin:sonarjs/recommended",
      "prettier",
    ],
    // 独自ルールを追加する場合はここに
    rules: {
      // "unicorn/filename-case": ["error", { case: "camelCase" }],
    },
    ignores: [
      "dist/**",
      "node_modules/**",
    ],
  },
];

export default config;
```

---

### **TypeScriptならではのポイント**

- `import type { FlatConfigItem } from "eslint-define-config";` を使うと型補完が効いて安心。
  - `eslint-define-config`は**オプショナル**ですが、型安全と補完が便利。  
    `pnpm add -D eslint-define-config`
- `eslint.config.ts`は自動的にESLintが解釈します（`eslint` v9+）。
- 設定内容自体は`.js`と同じですが、**型チェックやエディタ補完の恩恵**があります。
- exportは`default export`。

---

### **必要なnpmパッケージ例**

```sh
pnpm add -D eslint typescript @typescript-eslint/eslint-plugin @typescript-eslint/parser eslint-plugin-unicorn eslint-plugin-sonarjs eslint-config-prettier eslint-define-config
```

---

## **まとめ**

- **`eslint.config.ts`でOK**（型補完したいなら`eslint-define-config`も入れるとよい）
- **書き方は上記例で十分最新・公式準拠**
- **`.js`も`.ts`もESLint v9+は自動検出**（ただし`eslint.config.ts`はv9.0.0以降）

---

**さらに細かい最適化やプロジェクト事情に合わせたカスタムも対応できます。  
「こういうルールも追加したい」等があれば、具体例で教えてください！**

---

## 👤 ユーザー
*2025/5/19 21:40:45*

$ pnpm add -D eslint-define-config                           
 WARN  deprecated eslint-define-config@2.1.0: Package no longer supported. Contact Support at https://www.npmjs.com/support for more info.
Packages: +1
+
Progress: resolved 300, reused 275, downloaded 1, added 1, done

devDependencies:
+ eslint-define-config 2.1.0 deprecated

Done in 1.2s using pnpm v10.11.0

---

## 🤖 アシスタント
*2025/5/19 21:40:47*

はい、その警告は**問題ありません**。

### 解説

- `eslint-define-config` は一時的に便利だった型補完用パッケージですが、  
  **ESLint v9 からは不要になりました。**
- ESLint v9 以降、`eslint.config.ts` でも型補完・型安全は公式で対応されているため、  
  **追加パッケージ無しでOK** です。

---

### **どうすればいい？**

- **`eslint-define-config`は削除してもよい**です（全く必須ではありません）。
- `import type { FlatConfigItem } from "eslint-define-config";` の部分も不要です。
- TypeScriptの型補完はそのまま効きます（vscodeなど主要エディタでOK）。

---

## **最新版シンプルな例（eslint.config.ts, ESLint v9）**

```ts
// eslint.config.ts

import tseslint from "typescript-eslint";
import unicorn from "eslint-plugin-unicorn";
import sonarjs from "eslint-plugin-sonarjs";
import prettier from "eslint-config-prettier";

export default [
  ...tseslint.configs.strictTypeChecked,
  {
    languageOptions: {
      parser: tseslint.parser,
      parserOptions: {
        project: "./tsconfig.json",
        tsconfigRootDir: import.meta.dirname,
      },
    },
    plugins: {
      unicorn,
      sonarjs,
    },
    extends: [
      "plugin:unicorn/recommended",
      "plugin:sonarjs/recommended",
      "prettier",
    ],
    rules: {
      // 独自ルールはここに追記
    },
    ignores: [
      "dist/**",
      "node_modules/**",
    ],
  },
];
```

---

## **結論**

- `eslint-define-config` **は使わない！**（アンインストールしてOK）
- 上記サンプルのまま `eslint.config.ts` で運用すればOK

---

**何か他に「型補完が効かない」等があればご相談ください！**

---

## 👤 ユーザー
*2025/5/19 21:42:02*

prettier が使われていない

---

## 🤖 アシスタント
*2025/5/19 21:42:03*

鋭い指摘です！  
実は `eslint-config-prettier`（import prettier from "eslint-config-prettier";）は  
**extends に "prettier" を指定するだけ** で「他のルールセットとの競合を無効化」する役割を果たします。

---

### **なぜ import しているの？**

`eslint-config-prettier` はただのルールセットであり、  
ESLint v9+ のフラット構成では import しなくても、  
`extends: ["prettier"]` と書けば十分です。

---

### **さらにシンプルな記述例**

**importも不要、"prettier"をextendsに追加するだけでOK**

```ts
// eslint.config.ts

import tseslint from "typescript-eslint";
import unicorn from "eslint-plugin-unicorn";
import sonarjs from "eslint-plugin-sonarjs";

export default [
  ...tseslint.configs.strictTypeChecked,
  {
    languageOptions: {
      parser: tseslint.parser,
      parserOptions: {
        project: "./tsconfig.json",
        tsconfigRootDir: import.meta.dirname,
      },
    },
    plugins: {
      unicorn,
      sonarjs,
    },
    extends: [
      "plugin:unicorn/recommended",
      "plugin:sonarjs/recommended",
      "prettier", // これがあれば競合ルールをoffにしてくれる
    ],
    rules: {
      // ここに独自ルール
    },
    ignores: [
      "dist/**",
      "node_modules/**",
    ],
  },
];
```

---

## **Prettierそのものの実行**

- 上記は「ESLintルールとしてのPrettier競合の無効化」なので、
- **実際にPrettierによる整形も使いたい場合は、  
  `prettier`自体もdevDependenciesに入れて、  
  `.prettierrc` などの設定ファイルもプロジェクトに置く**のが一般的です。

---

## **結論**

- **extends に "prettier" を書くだけで十分！**
- importは不要。
- Prettierの整形自体はエディタやCIで`prettier`コマンドを使ってください。

---

もし**Prettierのフォーマット自体をESLint経由で強制したい（エラー出したい）場合は、  
`eslint-plugin-prettier` を使うやり方もあります。**  
「エラーとして検知したいか」も含めて要件あれば追加でご相談ください！

---

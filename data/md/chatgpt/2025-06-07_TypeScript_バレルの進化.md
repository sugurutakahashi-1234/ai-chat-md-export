# TypeScript バレルの進化

日付: 2025-06-07

---

## 👤 ユーザー
*2025/06/08 01:25:52*

これって今も一般的なのか？

TypeScript利用時に毎回ファイル単位でimportするのは面倒ですね。 そういう場合、index.tsに対象ディレクトリのファイルをまとめて export しておくと便利です。 また、index.ts の場合、./ディレクトリ/index ではなく ./ディレクトリ と記載することで利用できます。

---

## 🤖 アシスタント
*2025/06/08 01:26:34*

### 結論 ― “index.ts バレル”は **今でもよく使われる** が、  
2024〜25 年は「**アプリ内では可／ライブラリでは慎重に**」という空気が強まっています。

---

## 1. いま何が起きているか

| 用途 | 2025 年現在のムード |
|------|--------------------|
| **社内アプリ・UI フォルダー** | *依然ポピュラー*。IDE の自動補完も効き、エンジニアの DX 向上が主目的 |
| **公開 NPM ライブラリ** | “バレルやめよう”という記事・ツールが急増し、**避ける流れ**が顕著 |
| **モノレポの共有ユーティリティ** | ファイル間循環やツリーシェイク阻害が問題化しやすく、**賛否が分かれる** |

- バレル推奨派  
  - インポートが短くなり可読性が向上する【turn1view2】｡  
- 反対派  
  - すべてを再エクスポートするため **ツリーシェイクが効きづらく**、不要コードまでバンドルされる【turn1view1】【turn1view3】。  
  - 隠れ循環参照が増え、リファクタリング時に発見が遅れる【turn0search2】。  
  - Web Worker や JIT で実行時エラーの報告も増えている【turn2search6】。  

---

## 2. バレルを続ける場合の最小限ルール

| **やる** | **やらない** |
|----------|-------------|
| **明示的エクスポート**&lt;br&gt;`export { Button } from "./Button"` | `export * from "./Button"` のワイルドカード大量使用 |
| “機能単位フォルダー”ごとに置く | ルート `src/index.ts` に全コンポーネントを集約 |
| **アプリ内部だけ**で参照 | ライブラリ公開時のエントリーポイントにする |
| `sideEffects: false` を `package.json` に設定 | バレル内で副作用コードを実行 |

---

## 3. バレルの代替パターン

| 目的 | 手段 |
|------|------|
| インポートを短くしたい | **`tsconfig.json` の `paths`** でエイリアスを張る【turn3search4】 |
| ライブラリでツリーシェイクを保ちたい | **`package.json` の `"exports"` サブパス**で粒度の細かい入口を用意【turn4search0】 |
| “バレル撲滅”を自動チェック | `npx barrel-begone` など静的解析ツール【turn3search6】 |

---

## 4. どう判断すべきか

1. **対象がアプリなら**  
   - DX を優先して OK。上記“最小限ルール”を守れば過剰最適化より生産性が勝ちます。  
2. **対象がライブラリ（社外公開）なら**  
   - *index.ts だけ*を公開入口にせず、`exports` フィールドでモジュールを小分けにする。  
3. **既存プロジェクトで大量に使っている場合**  
   - すぐに全部消す必要はありません。まずは **新規コードから徐々に置き換え**、循環参照検出とバンドルサイズ計測を自動化しましょう。  

---

## 5. まとめ

- **index.ts バレルは “便利” と “パフォーマンス・保守性リスク” のトレードオフ。**  
- 2025 年のコミュニティでは「アプリ OK、ライブラリ NG」の温度感が主流。  
- 代替として `tsconfig paths` と `"exports"` フィールドが急速に浸透中。  
- 使い続ける場合は *明示的エクスポート＋副作用ゼロ* を徹底すること。

これを指針に、プロジェクトの規模・公開範囲・チーム体制に合わせて選択してみてください。

---

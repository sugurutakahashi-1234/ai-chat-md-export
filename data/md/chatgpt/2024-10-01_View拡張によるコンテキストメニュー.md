# View拡張によるコンテキストメニュー

日付: 2024-10-01

---

## 👤 ユーザー
*2024/10/01 16:12:58*

ViewModifier ではなくて Viewの拡張にしてほしい

struct CustomContextMenu: ViewModifier {
  let copyText: String
  func body(content: Content) -&gt; some View {
    content
      .contextMenu(ContextMenu(menuItems: {
        Button(action: {
          UIPasteboard.general.string = copyText
        }) {
          Image(systemName: "doc.on.doc")
          Text("コピーする")
        }
      }))
  }
}

extension View {
  func customContextMenu(_ copyText: String) -&gt; some View {
    modifier(CustomContextMenu(copyText: copyText))
  }
}

---

## 🤖 アシスタント
*2024/10/01 16:13:01*

以下のように `ViewModifier` を使わず、`View` の拡張だけを使った形に変更できます。`contextMenu` に直接カスタムロジックを含めるようにしています。

```swift
extension View {
  func customContextMenu(_ copyText: String) -> some View {
    self.contextMenu {
      Button(action: {
        UIPasteboard.general.string = copyText
      }) {
        Image(systemName: "doc.on.doc")
        Text("コピーする")
      }
    }
  }
}
```

これで `ViewModifier` を使わずに、`View` の拡張として `customContextMenu` を実装できます。

---

## 👤 ユーザー
*2024/10/01 16:13:35*

使い方は

---

## 🤖 アシスタント
*2024/10/01 16:13:39*

`customContextMenu` の使い方は、他の `View` に対して直接適用する形です。例えば、`Text` や他の `View` に対して以下のように使います。

```swift
Text("サンプルテキスト")
  .customContextMenu("このテキストをコピー")
```

この場合、`"サンプルテキスト"` にカスタムのコンテキストメニューが追加され、長押しなどで「コピーする」ボタンが表示され、そのボタンを押すと `UIPasteboard` に `"このテキストをコピー"` という文字列がコピーされます。

他の `View` にも同様に `.customContextMenu` を適用することで、同様の機能を簡単に追加できます。

---

## 👤 ユーザー
*2024/10/01 16:14:06*

customContextMenu の引数をTextの文字列をとれるようにできないの？

---

## 🤖 アシスタント
*2024/10/01 16:14:14*

`customContextMenu` の引数として `Text` の文字列を自動的に取得するようにしたい場合は、`View` の内容から直接テキストを取得する方法はないため、手動で渡す必要があります。ただし、特定の `Text` コンポーネントの文字列を簡単に渡せるようにするための方法として、`Text` の文字列を引数として渡す形で実装できます。

具体的には、`Text` の文字列を `customContextMenu` に渡しやすい形で以下のようにします。

```swift
extension View {
    func customContextMenu(for text: String) -> some View {
        self.contextMenu {
            Button(action: {
                UIPasteboard.general.string = text
            }) {
                Image(systemName: "doc.on.doc")
                Text("コピーする")
            }
        }
    }
}
```

この拡張により、`Text` のコンテンツを手動で引数として渡すことが可能です。例えば以下のように使います：

```swift
Text("コピーしたいテキスト")
    .customContextMenu(for: "コピーしたいテキスト")
```

このコードでは、表示されている `Text` と同じ内容が `customContextMenu` に渡され、長押しでコピー機能が提供されます。

残念ながら、`Text` の文字列を自動的に取得することは不可能ですが、このように手動で渡すことでニーズを満たせると思います。

---

## 👤 ユーザー
*2024/10/01 16:14:23*

どうにか文字列を取得したい

---

## 🤖 アシスタント
*2024/10/01 16:14:33*

`SwiftUI` では `Text` ビュー自体から直接その文字列を取得する方法は提供されていません。`Text` はビューレイヤーに対する抽象化であり、内部で保持している文字列データはアクセスできないようになっています。

しかし、テキスト情報を扱う他の方法で、`Text` に与える文字列を何らかの形で保持して、それを `customContextMenu` に渡す方法なら可能です。

以下に、`Text` に表示する文字列を変数で管理し、それを `customContextMenu` に渡す方法を示します：

```swift
struct ContentView: View {
    @State private var text = "コピーしたいテキスト"

    var body: some View {
        Text(text)
            .customContextMenu(for: text)
    }
}

extension View {
    func customContextMenu(for text: String) -> some View {
        self.contextMenu {
            Button(action: {
                UIPasteboard.general.string = text
            }) {
                Image(systemName: "doc.on.doc")
                Text("コピーする")
            }
        }
    }
}
```

このように、`@State` 変数や他のデータソースにテキストを保持して、それを `Text` に表示する際に同時に `customContextMenu` にも渡すというアプローチが考えられます。これにより、表示されているテキストを `customContextMenu` 内で参照し、コピーできるようになります。

残念ながら、SwiftUI の `Text` から直接文字列を取得する機能は存在しないため、データを変数として管理する必要があります。

---

## 👤 ユーザー
*2024/10/01 16:15:10*

コピーブルTextというTextを使うのはどうだろうか？

---

## 🤖 アシスタント
*2024/10/01 16:15:19*

`CopyableText` という独自のカスタム `Text` ビューを作成し、その中で文字列を保持しつつ、同時にコピー機能を提供するというアイデアは非常に良いと思います。これにより、 `Text` の表示とコピー機能を一つにまとめたカスタムコンポーネントが実現できます。

以下に `CopyableText` を実装した例を示します。

```swift
struct CopyableText: View {
    let text: String
    
    var body: some View {
        Text(text)
            .contextMenu {
                Button(action: {
                    UIPasteboard.general.string = text
                }) {
                    Image(systemName: "doc.on.doc")
                    Text("コピーする")
                }
            }
    }
}
```

### 使用例

```swift
struct ContentView: View {
    var body: some View {
        VStack {
            CopyableText(text: "これはコピーできるテキストです")
            CopyableText(text: "もう一つのコピーできるテキスト")
        }
    }
}
```

### 解説

- `CopyableText` は単純に `Text` をラップしたものですが、 `contextMenu` を使ってコピー機能を追加しています。
- `CopyableText` に渡された文字列を `UIPasteboard` にコピーする機能を持たせています。
- これにより、`CopyableText` を使うたびに簡単にコピー機能を持つ `Text` が作成されます。

このようなカスタムビューを作成することで、他の `Text` コンポーネントと同じように使えるシンプルな `Text` が作成でき、かつコピー機能も持たせることができます。

---

## 👤 ユーザー
*2024/10/01 16:23:27*

copyableContextMenu というviewのextensionはどう？

---

## 🤖 アシスタント
*2024/10/01 16:23:41*

`copyableContextMenu` という名前で `View` の拡張を作成するのも非常に良いアイデアです。この拡張を使うことで、どの `Text` ビューにも簡単にコピー機能を追加できるようになります。

以下に `copyableContextMenu` を `View` の拡張として実装した例を示します。

```swift
extension View {
    func copyableContextMenu(text: String) -> some View {
        self.contextMenu {
            Button(action: {
                UIPasteboard.general.string = text
            }) {
                Image(systemName: "doc.on.doc")
                Text("コピーする")
            }
        }
    }
}
```

### 使用方法

```swift
struct ContentView: View {
    let sampleText = "コピーしたいテキスト"

    var body: some View {
        VStack {
            Text(sampleText)
                .copyableContextMenu(text: sampleText) // ここでコピー機能を付加
            Text("別のテキスト")
                .copyableContextMenu(text: "別のテキストもコピーできる")
        }
    }
}
```

### 解説

- `copyableContextMenu` は `View` の拡張メソッドとして定義されているため、任意の `View` に対して簡単に呼び出せます。
- 引数として `Text` に表示されている文字列を渡す必要がありますが、この拡張を使うことで一貫したコピー機能を簡単に追加できます。
- 上記の例では、複数の `Text` ビューに対してコピー機能を手軽に追加しています。

このように `copyableContextMenu` を `View` の拡張として提供することで、任意の `Text` ビューに手軽にコピー機能を適用でき、他のコンポーネントにも拡張が可能です。

---

## 👤 ユーザー
*2024/10/01 16:24:12*

text よりもわかりやすい表現はないかな？

---

## 🤖 アシスタント
*2024/10/01 16:24:25*

User prefers more intuitive and clear parameter names instead of "text".

---

## 🔧 ツール
*2024/10/01 16:24:25*

Model set context updated.

---

## 🤖 アシスタント
*2024/10/01 16:24:25*

`text` よりもわかりやすい表現として、コピー対象の文字列を明確に示す名前を使うと良いでしょう。たとえば、`copyText` や `contentToCopy` などが候補になります。これらは、何がコピーされるのかを明示的に示すため、より直感的です。

以下に例を示します。

```swift
extension View {
    func copyableContextMenu(copyText: String) -> some View {
        self.contextMenu {
            Button(action: {
                UIPasteboard.general.string = copyText
            }) {
                Image(systemName: "doc.on.doc")
                Text("コピーする")
            }
        }
    }
}
```

### 使用方法

```swift
struct ContentView: View {
    let sampleText = "コピーしたいテキスト"

    var body: some View {
        VStack {
            Text(sampleText)
                .copyableContextMenu(copyText: sampleText) // より直感的な名前
            Text("別のテキスト")
                .copyableContextMenu(copyText: "別のテキストもコピーできる")
        }
    }
}
```

このように、`copyText` のような名前を使うことで、引数が何を指しているのかがより明確になり、使いやすさが向上します。

---

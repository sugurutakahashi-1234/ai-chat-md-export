# Flutter 外部アプリ表示方法

Date: 2025-01-12

---

## 👤 User
*2025-01-12 21:51:58*

Flutterで外部アプリを表示する方法

---

## 🤖 Assistant
*2025-01-12 21:52:13*

Flutterで外部アプリを表示するには、以下の手法を使用します。代表的なケースとして、URLを開いたり、特定のアプリを起動したりする場合について説明します。

### 1. **`url_launcher` パッケージを使用**
外部アプリを開く場合、特にブラウザやメールアプリなど、`url_launcher` パッケージが便利です。

#### インストール
`pubspec.yaml` に以下を追加してパッケージをインストールします：
```yaml
dependencies:
  url_launcher: ^6.1.7
```

#### 実装例
以下はURLをブラウザで開く例です：
```dart
import 'package:flutter/material.dart';
import 'package:url_launcher/url_launcher.dart';

class OpenAppExample extends StatelessWidget {
  final String url = 'https://flutter.dev';

  Future<void> _launchURL() async {
    final uri = Uri.parse(url);
    if (await canLaunchUrl(uri)) {
      await launchUrl(uri, mode: LaunchMode.externalApplication);
    } else {
      throw 'Could not launch $url';
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('Open External App Example')),
      body: Center(
        child: ElevatedButton(
          onPressed: _launchURL,
          child: Text('Open Flutter Website'),
        ),
      ),
    );
  }
}

void main() {
  runApp(MaterialApp(home: OpenAppExample()));
}
```

### 2. **特定のアプリを開く**
例えば、WhatsAppやGoogle Mapsなどのアプリを直接開きたい場合は、専用のURLスキームを使用します。

#### 例: WhatsAppを開く
```dart
final String whatsappUrl = 'whatsapp://send?phone=+1234567890&text=Hello!';

Future<void> _launchWhatsApp() async {
  final uri = Uri.parse(whatsappUrl);
  if (await canLaunchUrl(uri)) {
    await launchUrl(uri, mode: LaunchMode.externalApplication);
  } else {
    throw 'Could not launch WhatsApp';
  }
}
```

#### 例: Google Mapsを開く
```dart
final String googleMapsUrl = 'geo:37.7749,-122.4194';

Future<void> _launchGoogleMaps() async {
  final uri = Uri.parse(googleMapsUrl);
  if (await canLaunchUrl(uri)) {
    await launchUrl(uri, mode: LaunchMode.externalApplication);
  } else {
    throw 'Could not launch Google Maps';
  }
}
```

### 3. **AndroidのインテントやiOSのカスタムURLスキームを使用**
`url_launcher` では不十分な場合、ネイティブコードを介して外部アプリを呼び出すことも可能です。

#### Androidの場合
Androidのネイティブコードを`MainActivity.kt`や`MainActivity.java`に書いてインテントを使用します。

```kotlin
import android.content.Intent
import android.net.Uri

fun openExternalApp() {
    val intent = Intent(Intent.ACTION_VIEW)
    intent.data = Uri.parse("geo:37.7749,-122.4194")
    startActivity(intent)
}
```

#### iOSの場合
iOSのネイティブコードを`AppDelegate.swift`に記述します。
```swift
if let url = URL(string: "geo:37.7749,-122.4194") {
    UIApplication.shared.open(url)
}
```

### 注意事項
1. URLスキームは外部アプリごとに異なります。必要に応じてアプリのドキュメントを確認してください。
2. 必要に応じてAndroidの`AndroidManifest.xml`やiOSの`Info.plist`でパーミッションやURLスキームの設定が必要です。
3. テストするデバイスに対象のアプリがインストールされていることを確認してください。

### まとめ
- **ブラウザやメールアプリ** → `url_launcher`を使用。
- **特定のアプリ** → URLスキームを指定。
- **さらに高度な操作** → ネイティブコードでインテントやカスタムスキームを利用。

---

## 👤 User
*2025-01-12 21:59:07*

AndroidとiOSでは違うのでは？

---

## 🤖 Assistant
*2025-01-12 21:59:59*

その通りです！Flutterで外部アプリを開く場合、AndroidとiOSでは挙動が異なる部分がいくつかあります。それぞれのプラットフォームでの違いと注意点を詳しく説明します。

---

## 1. **`url_launcher` を使う場合の違い**
`url_launcher` はAndroidとiOSの両方をサポートしますが、各プラットフォームでの動作には微妙な違いがあります。

### Androidの場合
- Androidでは、**インテント** を利用して外部アプリが起動します。
- URLスキームが不明な場合、エラーになることがあります。
- ユーザーがインストールしていないアプリを開こうとすると失敗します。

例: Google Mapsを開く
```dart
final String googleMapsUrl = 'geo:37.7749,-122.4194';

Future<void> _launchGoogleMaps() async {
  final uri = Uri.parse(googleMapsUrl);
  if (await canLaunchUrl(uri)) {
    await launchUrl(uri, mode: LaunchMode.externalApplication);
  } else {
    throw 'Could not launch Google Maps';
  }
}
```

### iOSの場合
- iOSでは、**カスタムURLスキーム** または `UIApplication.shared.open` を利用します。
- URLスキームが登録されていない場合、エラーになります。
- App Storeで公開されているアプリしかURLスキームが利用できません。

例: Google Mapsを開く
```dart
final String googleMapsUrl = 'comgooglemaps://?q=37.7749,-122.4194';

Future<void> _launchGoogleMaps() async {
  final uri = Uri.parse(googleMapsUrl);
  if (await canLaunchUrl(uri)) {
    await launchUrl(uri, mode: LaunchMode.externalApplication);
  } else {
    throw 'Could not launch Google Maps';
  }
}
```

#### 注意点
- iOSでは、`Info.plist` にURLスキームを登録する必要があります。  
  ```xml
  <key>LSApplicationQueriesSchemes</key>
  <array>
    <string>comgooglemaps</string>
    <string>geo</string>
  </array>
  ```

---

## 2. **URLスキームの違い**
特定のアプリを開く場合、AndroidとiOSで使われるURLスキームが異なることがよくあります。

### 例1: WhatsAppを開く
- **Android**: `whatsapp://send?phone=+1234567890&text=Hello!`
- **iOS**: 同じURLスキームですが、`Info.plist` に `whatsapp` を登録する必要があります。

### 例2: 電話をかける
- **Android**: `tel:+1234567890`
- **iOS**: 同じURLスキームですが、アプリがバックグラウンドに移行します。

---

## 3. **ネイティブコードを使う場合の違い**

### Androidの場合
Androidでは、ネイティブコードでインテントを使用します。FlutterからAndroidのネイティブコードを呼び出すには、`MethodChannel` を使用します。

#### `MainActivity.kt` の例
```kotlin
import android.content.Intent
import android.net.Uri
import io.flutter.embedding.android.FlutterActivity
import io.flutter.plugin.common.MethodChannel

class MainActivity: FlutterActivity() {
    private val CHANNEL = "com.example.app/launch"

    override fun configureFlutterEngine(@NonNull flutterEngine: FlutterEngine) {
        super.configureFlutterEngine(flutterEngine)
        MethodChannel(flutterEngine.dartExecutor.binaryMessenger, CHANNEL).setMethodCallHandler { call, result ->
            if (call.method == "openApp") {
                val url = call.argument<String>("url")
                if (url != null) {
                    val intent = Intent(Intent.ACTION_VIEW, Uri.parse(url))
                    startActivity(intent)
                    result.success(null)
                } else {
                    result.error("INVALID_URL", "URL was null", null)
                }
            }
        }
    }
}
```

### iOSの場合
iOSでは、`UIApplication.shared.open` を利用します。

#### `AppDelegate.swift` の例
```swift
import UIKit
import Flutter

@UIApplicationMain
@objc class AppDelegate: FlutterAppDelegate {
    override func application(
        _ application: UIApplication,
        didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?
    ) -> Bool {
        GeneratedPluginRegistrant.register(with: self)

        let controller: FlutterViewController = window?.rootViewController as! FlutterViewController
        let channel = FlutterMethodChannel(name: "com.example.app/launch", binaryMessenger: controller.binaryMessenger)

        channel.setMethodCallHandler { (call: FlutterMethodCall, result: @escaping FlutterResult) -> Void in
            if call.method == "openApp" {
                if let args = call.arguments as? [String: Any],
                   let urlString = args["url"] as? String,
                   let url = URL(string: urlString) {
                    UIApplication.shared.open(url, options: [:], completionHandler: nil)
                    result(nil)
                } else {
                    result(FlutterError(code: "INVALID_URL", message: "URL was invalid", details: nil))
                }
            }
        }

        return super.application(application, didFinishLaunchingWithOptions: launchOptions)
    }
}
```

---

## 4. **Flutter側からネイティブコードを呼び出す**
ネイティブコードを呼び出すには、以下のように `MethodChannel` を使います：

#### Flutter側のコード
```dart
import 'package:flutter/services.dart';

class ExternalAppLauncher {
  static const platform = MethodChannel('com.example.app/launch');

  static Future&lt;void&gt; openApp(String url) async {
    try {
      await platform.invokeMethod('openApp', {'url': url});
    } on PlatformException catch (e) {
      print("Failed to open app: ${e.message}");

---

## 👤 User
*2025-01-12 22:00:00*

StoreRedirect というライブラリは？

---

## 🤖 Assistant
*2025-01-12 22:00:20*

`store_redirect` ライブラリは、Flutterアプリから簡単に**Google Playストア**や**Apple App Store**にリダイレクトするために使用されます。このライブラリを使用すると、ユーザーを特定のアプリのストアページに案内してアプリを評価したり、最新バージョンをインストールさせたりすることができます。

---

## `store_redirect` の特徴
- **Google Playストア**と**Apple App Store**の両方をサポート。
- Flutterのコード内で簡単にストアページを開くことが可能。
- アプリIDを指定することで、該当するストアページに直接リダイレクト。

---

## 1. **インストール**

`pubspec.yaml` に以下を追加してパッケージをインストールします。

```yaml
dependencies:
  store_redirect: ^2.0.0
```

その後、以下のコマンドを実行します：
```bash
flutter pub get
```

---

## 2. **基本的な使い方**

以下は、アプリのストアページを開く最小限の例です。

```dart
import 'package:flutter/material.dart';
import 'package:store_redirect/store_redirect.dart';

void main() {
  runApp(MyApp());
}

class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      home: StoreRedirectExample(),
    );
  }
}

class StoreRedirectExample extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('Store Redirect Example')),
      body: Center(
        child: ElevatedButton(
          onPressed: () {
            // 現在のアプリのストアページを開く
            StoreRedirect.redirect(
              androidAppId: "com.example.android",
              iOSAppId: "123456789", // iOSアプリのApp Store ID
            );
          },
          child: Text('Open Store Page'),
        ),
      ),
    );
  }
}
```

---

## 3. **パラメータの詳細**

### Androidの場合
- **`androidAppId`**: アプリのパッケージ名を指定します（例: `com.example.android`）。
  - Google Playストアでアプリのページにリダイレクトします。

### iOSの場合
- **`iOSAppId`**: App Store ID（数値形式）を指定します（例: `123456789`）。
  - Apple App Storeでアプリのページにリダイレクトします。

---

## 4. **動作の流れ**

### Androidの場合
`androidAppId` が指定されている場合、Google Playストアのページが開きます。例:
```
https://play.google.com/store/apps/details?id=com.example.android
```

### iOSの場合
`iOSAppId` が指定されている場合、App Storeのページが開きます。例:
```
https://apps.apple.com/app/id123456789
```

---

## 5. **注意事項**
1. **必須設定**:
   - Android: 正しい `androidAppId`（アプリのパッケージ名）を指定してください。
   - iOS: App Store ID は必須です。これは Apple Developer Account の App Store Connect から確認できます。
   
2. **App Storeのリダイレクトのテスト**:
   - iOSシミュレータでは動作しないため、実機でテストしてください。

3. **パーミッション**:
   - このライブラリを使用するために特別なパーミッションは必要ありません。

---

## 6. **応用例**
特定の状況でストアに誘導する例として、以下のシナリオが考えられます。

### 1. **アプリの評価ページを開く**
アプリの評価を促すために、ストアページに遷移させる:
```dart
StoreRedirect.redirect(
  androidAppId: "com.example.android",
  iOSAppId: "123456789",
);
```

### 2. **バージョンアップの案内**
古いバージョンのアプリを使っているユーザーに最新バージョンをインストールさせる:
```dart
if (isOutdatedVersion) {
  StoreRedirect.redirect(
    androidAppId: "com.example.android",
    iOSAppId: "123456789",
  );
}
```

---

## まとめ
`store_redirect` は、アプリのストアページに直接リダイレクトさせるための便利なライブラリです。使い方もシンプルで、少ないコードでAndroidとiOSの両方をサポートすることができます。

- **メリット**: 簡単に実装できる、多くのユースケースに対応可能。
- **デメリット**: シミュレータでは動作確認が難しい（iOS）。

必要な場合にぜひ活用してみてください！

---

## 👤 User
*2025-01-12 22:44:27*

アプリを単純に開かせる場合はどうすればいいか？この2つなんだ。

https://play.google.com/store/apps/details?id=com.snapitonline.snap_it
https://apps.apple.com/jp/app/snpit-snap-to-earn/id6456411024

---

## 🤖 Assistant
*2025-01-12 22:45:04*

Flutterで指定されたアプリを単純に開かせるには、`url_launcher` パッケージを使用するのが最も簡単で汎用的な方法です。それぞれのストアで指定されたアプリを開く方法を具体的に説明します。

---

## 1. **アプリがインストールされている場合に直接開く**
AndroidおよびiOSでは、URLスキームを使用してアプリを開くことが可能です。

- **Android**: パッケージ名を使ったカスタムスキーム（例: `intent://`）。
- **iOS**: カスタムURLスキーム（例: `snpit://`）。

ただし、これらのURLスキームはアプリによって異なるため、公式ドキュメントでスキームを確認する必要があります。

---

## 2. **アプリがインストールされていない場合にストアページを開く**

以下のコードは、指定されたアプリを**インストール済みの場合に開き**、そうでない場合は**Google PlayストアやApp Store**を開く処理を実装した例です。

### 必要なパッケージ
まず、`pubspec.yaml` に以下を追加して `url_launcher` をインストールします：
```yaml
dependencies:
  url_launcher: ^6.1.7
```

---

### 実装例
以下は、指定されたアプリを開く実装例です。

```dart
import 'package:flutter/material.dart';
import 'package:url_launcher/url_launcher.dart';

class OpenAppExample extends StatelessWidget {
  // Androidのアプリのパッケージ名
  final String androidAppId = "com.snapitonline.snap_it";
  // iOSのApp Store ID
  final String iOSAppId = "6456411024";

  Future<void> openApp() async {
    if (Theme.of(BuildContext).platform == TargetPlatform.android) {
      // Androidアプリを直接開く
      final uri = Uri.parse("intent://$androidAppId#Intent;scheme=package;end");
      if (await canLaunchUrl(uri)) {
        await launchUrl(uri, mode: LaunchMode.externalApplication);
      } else {
        // インストールされていない場合はGoogle Playストアへ
        final playStoreUri = Uri.parse(
            "https://play.google.com/store/apps/details?id=$androidAppId");
        await launchUrl(playStoreUri, mode: LaunchMode.externalApplication);
      }
    } else if (Theme.of(BuildContext).platform == TargetPlatform.iOS) {
      // iOSアプリを直接開く
      final uri = Uri.parse("snpit://");
      if (await canLaunchUrl(uri)) {
        await launchUrl(uri, mode: LaunchMode.externalApplication);
      } else {
        // インストールされていない場合はApp Storeへ
        final appStoreUri =
            Uri.parse("https://apps.apple.com/jp/app/id$iOSAppId");
        await launchUrl(appStoreUri, mode: LaunchMode.externalApplication);
      }
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text("Open App Example")),
      body: Center(
        child: ElevatedButton(
          onPressed: openApp,
          child: Text("Open SnapIt App"),
        ),
      ),
    );
  }
}

void main() {
  runApp(MaterialApp(home: OpenAppExample()));
}
```

---

## 3. **コードのポイント**

### Androidでのアプリ起動
- **直接アプリを起動**: `intent://` スキームを使用。
  - 例: `intent://com.snapitonline.snap_it#Intent;scheme=package;end`
- **ストアページを開く**: アプリがインストールされていない場合は `https://play.google.com/...` を使用。

### iOSでのアプリ起動
- **直接アプリを起動**: カスタムURLスキーム（例: `snpit://`）。
  - カスタムスキームは対象アプリの開発元から提供されている必要があります。
- **ストアページを開く**: アプリがインストールされていない場合は `https://apps.apple.com/...` を使用。

---

## 4. **注意点**

1. **URLスキームの確認**:
   - `snpit://` のようなカスタムスキームが使えるかどうかは、アプリ開発者に確認する必要があります。
   - 提供されていない場合、直接アプリを開くことはできません。

2. **iOSの設定**:
   - `Info.plist` に以下の設定を追加して、アプリが他のアプリを開けるようにします。

   ```xml
   <key>LSApplicationQueriesSchemes</key>
   <array>
       <string>snpit</string>
   </array>
   ```

3. **Google PlayストアやApp Storeのリンクの正確性**:
   - リンクは必ず正しいURLを使用してください。

4. **シミュレータでのテスト**:
   - シミュレータではアプリがインストールされていないため、ストアページを開く動作のみ確認可能です。

---

## まとめ
- アプリがインストールされていれば**直接アプリを開く**。
- インストールされていない場合は**Google PlayストアやApp Storeに遷移**。
- URLスキームやApp IDを正しく設定することが成功の鍵です。

---

## 👤 User
*2025-01-12 22:45:41*

向こう側はカスタムURLスキームを提供しているのかどうかわからない

---

## 🤖 Assistant
*2025-01-12 22:46:18*

カスタムURLスキームが提供されているか不明な場合でも、以下の方法で外部アプリを開く実装が可能です。ただし、カスタムURLスキームが提供されていない場合、外部アプリを直接開くことは難しく、ストアページを開く方法が確実です。

---

## 1. **確実にできる方法: ストアページを開く**
アプリがインストールされているかどうかを確認せずに、ストアページを開く方法です。

```dart
import 'package:flutter/material.dart';
import 'package:url_launcher/url_launcher.dart';

class StoreRedirectExample extends StatelessWidget {
  final String androidAppUrl =
      "https://play.google.com/store/apps/details?id=com.snapitonline.snap_it";
  final String iOSAppUrl =
      "https://apps.apple.com/jp/app/snpit-snap-to-earn/id6456411024";

  Future<void> openStorePage() async {
    final uri = Theme.of(BuildContext).platform == TargetPlatform.android
        ? Uri.parse(androidAppUrl)
        : Uri.parse(iOSAppUrl);

    if (await canLaunchUrl(uri)) {
      await launchUrl(uri, mode: LaunchMode.externalApplication);
    } else {
      throw 'Could not launch $uri';
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('Store Redirect Example')),
      body: Center(
        child: ElevatedButton(
          onPressed: openStorePage,
          child: Text('Open App Store Page'),
        ),
      ),
    );
  }
}

void main() {
  runApp(MaterialApp(home: StoreRedirectExample()));
}
```

この方法は、確実にストアページを開くため、カスタムURLスキームが提供されていない場合でも問題なく動作します。

---

## 2. **アプリがインストールされている場合を試す**
カスタムURLスキームが提供されているかどうかわからない場合でも、可能性のあるスキームで試してみることはできます。

例えば、以下のように標準的なスキームで試します：

### Android
- 試すURLスキーム: `intent://` または `package:`。
```dart
final String androidIntentUrl =
    "intent://com.snapitonline.snap_it#Intent;scheme=package;end";
```

### iOS
- 試すカスタムスキーム: 一般的な命名規則に基づいたもの。
```dart
final String possibleCustomScheme = "snpit://";
```

実際のコード例：
```dart
Future<void> tryOpenApp() async {
  String? customUrl;
  if (Theme.of(BuildContext).platform == TargetPlatform.android) {
    customUrl =
        "intent://com.snapitonline.snap_it#Intent;scheme=package;end";
  } else if (Theme.of(BuildContext).platform == TargetPlatform.iOS) {
    customUrl = "snpit://";
  }

  if (customUrl != null) {
    final uri = Uri.parse(customUrl);
    if (await canLaunchUrl(uri)) {
      await launchUrl(uri, mode: LaunchMode.externalApplication);
    } else {
      // 開けない場合はストアページにフォールバック
      await openStorePage();
    }
  } else {
    await openStorePage();
  }
}
```

---

## 3. **相手側にカスタムスキームを確認する方法**
アプリ提供者がカスタムスキームを提供しているかどうかを確認するためには、以下の方法を試してください：

1. **公式ドキュメントやサポートに問い合わせ**:
   - アプリのWebサイトやサポートページでカスタムURLスキームが公開されていないか確認。
   - アプリ提供者に直接問い合わせて、カスタムスキームが存在するかどうかを確認。

2. **デバッグツールを使用**:
   - Androidでは、`adb logcat` を使用してインテントログを監視します。
   - iOSでは、`Console.app` を使用してカスタムスキームのログを確認できます。

---

## 4. **おすすめの実装フロー**

カスタムスキームが不明な場合は以下のように段階的に実装するのがおすすめです：

1. **カスタムスキームで試行**: `snpit://` のような一般的な命名規則で試してみる。
2. **失敗した場合はストアにフォールバック**: アプリが開けなかった場合、ストアページを開く。
3. **公式サポートに問い合わせ**: カスタムURLスキームが提供されているかどうかを確認。

---

## まとめ

- カスタムスキームが不明な場合は、まず可能性のあるスキームを試し、失敗したらストアページを開く方法が安全。
- 確実にストアページを開く方法を実装するのが現実的な選択肢。
- 公式ドキュメントや提供元にカスタムスキームの有無を問い合わせるのも重要です。

---

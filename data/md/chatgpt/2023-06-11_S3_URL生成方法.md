# S3 URLç”Ÿæˆæ–¹æ³•

æ—¥ä»˜: 2023-06-11

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/6/12 2:49:18*

ä»¥ä¸‹ã®ã‚ˆã†ãªkeyåã§S3ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã®ã ã‘ã‚Œã©ã‚‚ã€ãã‚Œã®urlæ–‡å­—åˆ—ã®çµ„ã¿ç«‹ã¦æ–¹ã®ã„ã„æ–¹æ³•ã‚’æ¨ã—ã¦æ¬²ã—ã„ã€‚Swiftã‚’ä½¿ã†ã“ã¨ãŒå‰æã§ã™

/raw/anchors/measurements/{measurement_id}/users/{user_id}
/raw/emotions/measurements/{measurement_id}/users/{user_id}
/raw/interactions/measurements/{measurement_id}/users/{user_id}

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/6/12 2:50:00*

Swiftã§æ–‡å­—åˆ—ã‚’å‹•çš„ã«ä½œæˆã™ã‚‹ãŸã‚ã«ã¯ã€æ–‡å­—åˆ—å†…æŒ¿å…¥(String interpolation)ã‚’ä½¿ã†ã®ãŒä¸€èˆ¬çš„ãªæ–¹æ³•ã§ã™ã€‚S3ã®URLã¯é€šå¸¸æ¬¡ã®å½¢å¼ã§æ§‹æˆã•ã‚Œã¾ã™ï¼š

```
https://{bucket}.s3.{region}.amazonaws.com/{key}
```

ãŸã ã—ã€bucketã¯ã‚ãªãŸã®S3ãƒã‚±ãƒƒãƒˆåã€regionã¯ãƒªãƒ¼ã‚¸ãƒ§ãƒ³åï¼ˆä¾‹ãˆã°us-west-2ãªã©ï¼‰ã€keyã¯ã‚ãªãŸãŒæŒ‡å®šã—ãŸkeyåã§ã™ã€‚

ãã‚Œã‚‰ã‚’çµ„ã¿åˆã‚ã›ã¦S3 URLã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã®Swiftã®é–¢æ•°ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š

```swift
func createS3URL(bucket: String, region: String, category: String, measurementId: String, userId: String) -> String {
    let key = "/raw/\(category)/measurements/\(measurementId)/users/\(userId)"
    let url = "https://\(bucket).s3.\(region).amazonaws.com\(key)"
    return url
}
```

ã“ã“ã§`category`ã¯"anchors"ã€"emotions"ã€"interactions"ã®ã„ãšã‚Œã‹ã‚’æŒ‡ã™ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

ãã—ã¦ã€ã“ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¦URLã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

```swift
let url = createS3URL(bucket: "mybucket", region: "us-west-2", category: "anchors", measurementId: "123", userId: "abc")
print(url)  // å‡ºåŠ›: https://mybucket.s3.us-west-2.amazonaws.com/raw/anchors/measurements/123/users/abc
```

ã“ã®æ–¹æ³•ã¯ç°¡å˜ã§ç›´æ„Ÿçš„ã§ã€ãã‚Œãã‚Œã®ã‚«ãƒ†ã‚´ãƒªã€æ¸¬å®šIDã€ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã«å¯¾ã—ã¦ç•°ãªã‚‹URLã‚’ç°¡å˜ã«ç”Ÿæˆã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/6/12 2:51:49*

ä»Šã®æ‰€ä»¥ä¸‹ã®3ã¤ã§ä»Šå¾Œã‚‚ã©ã‚“ã©ã‚“keyåãŒè¿½åŠ ã•ã‚Œã¦ã„ãã®ã ã‘ã‚Œã©ã‚‚ã€ãã‚Œã‚’ã†ã¾ãç®¡ç†ã—ã¦ãå®šç¾©ã‚’1ç®‡æ‰€ã«ã¾ã¨ã‚ã¦é‹ç”¨ã—ã¦ã„ããŸã®ã ã‘ã‚Œã©ã‚‚ã©ã†ã™ã‚Œã°ã„ã„ã‹ãªï¼Ÿ

/raw/anchors/measurements/{measurement_id}/users/{user_id}
/raw/emotions/measurements/{measurement_id}/users/{user_id}
/raw/interactions/measurements/{measurement_id}/users/{user_id}

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/6/12 2:52:24*

ãã‚Œã‚’ã†ã¾ãç®¡ç†ã™ã‚‹ãŸã‚ã«ã¯ã€Swiftã®enumã¨structã‚’åˆ©ç”¨ã—ã¦å®šç¾©ã‚’1ç®‡æ‰€ã«ã¾ã¨ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€è¿½åŠ ã‚„å¤‰æ›´ãŒã‚ã£ãŸå ´åˆã‚‚ä¸€ç®‡æ‰€ã®æ›´æ–°ã§æ¸ˆã¿ã¾ã™ã€‚

ä»¥ä¸‹ã«ä¾‹ã‚’ç¤ºã—ã¾ã™ã€‚

```swift
enum S3Category: String {
    case anchors
    case emotions
    case interactions
    // æ–°ã—ã„ã‚«ãƒ†ã‚´ãƒªã‚’è¿½åŠ ã™ã‚‹ã¨ãã¯ã“ã“ã«enum caseã‚’è¿½åŠ 
}

struct S3URLBuilder {
    let bucket: String
    let region: String

    func createURL(for category: S3Category, measurementId: String, userId: String) -> String {
        let key = "/raw/\(category.rawValue)/measurements/\(measurementId)/users/\(userId)"
        let url = "https://\(bucket).s3.\(region).amazonaws.com\(key)"
        return url
    }
}
```

ã“ã®ã‚ˆã†ã«ã™ã‚‹ã¨ã€æ–°ã—ã„ã‚«ãƒ†ã‚´ãƒªã‚’è¿½åŠ ã™ã‚‹ãŸã³ã«`S3Category` enumã«caseã‚’è¿½åŠ ã™ã‚‹ã ã‘ã§æ¸ˆã¿ã¾ã™ã€‚ãã—ã¦ã€URLã‚’ç”Ÿæˆã™ã‚‹éš›ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¾ã™ï¼š

```swift
let builder = S3URLBuilder(bucket: "mybucket", region: "us-west-2")
let url = builder.createURL(for: .anchors, measurementId: "123", userId: "abc")
print(url)  // å‡ºåŠ›: https://mybucket.s3.us-west-2.amazonaws.com/raw/anchors/measurements/123/users/abc
```

ã“ã®æ–¹æ³•ãªã‚‰ã°ã€å…¨ã¦ã®S3ã®ã‚­ãƒ¼åãŒä¸€ç®‡æ‰€ï¼ˆ`S3Category` enumï¼‰ã«é›†ã¾ã‚‹ãŸã‚ã€ç®¡ç†ãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/6/12 2:53:44*

ã¾ãšã€ç”Ÿæˆã¯keyåã ã‘ã§ã„ã„ã‚ˆã€ã‚ã¨ä»ŠãŸã¾ãŸã¾ã€measurement_idã¨user_idãŒç½®ãæ›ãˆæ–‡å­—ã«ãªã£ã¦ã„ã‚‹ã‘ã©ã€ãã†ã§ã¯ãªã„ã‚‚ã®ãŒå¢—ãˆãŸã‚Šã€ã™ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã®ã§ã€ãã‚Œã‚‚è€ƒæ…®ã«å…¥ã‚Œã¦æ¬²ã—ã„

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/6/12 2:54:49*

ã™ã¿ã¾ã›ã‚“ã€ç§ã®ç†è§£ãŒä¸ååˆ†ã§ã—ãŸã€‚æŒ‡å®šã•ã‚ŒãŸkeyåä»¥å¤–ã«ã‚‚æ§˜ã€…ãªç½®ãæ›ãˆå¯èƒ½ãªéƒ¨åˆ†ãŒå­˜åœ¨ã—å¾—ã‚‹ã€ã¨ã„ã†ã“ã¨ã§ã™ã­ã€‚ãã®å ´åˆã€ã‚ˆã‚Šæ±ç”¨çš„ãªæ–¹æ³•ã‚’ç”¨ã„ã‚‹ã“ã¨ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã«ã€formatã¨å‘¼ã°ã‚Œã‚‹æ–‡å­—åˆ—ã¨ã€ãã‚Œã«å¯¾å¿œã™ã‚‹ç½®ãæ›ãˆã‚‹ã¹ãå€¤ã®è¾æ›¸ã‚’å—ã‘å–ã£ã¦æ–‡å­—åˆ—ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°ã‚’ç¤ºã—ã¾ã™ã€‚

```swift
enum KeyCategory: String {
    case anchors
    case emotions
    case interactions
    // æ–°ã—ã„ã‚«ãƒ†ã‚´ãƒªã‚’è¿½åŠ ã™ã‚‹ã¨ãã¯ã“ã“ã«enum caseã‚’è¿½åŠ 
}

struct KeyBuilder {
    static let formats: [KeyCategory: String] = [
        .anchors: "/raw/anchors/measurements/{measurement_id}/users/{user_id}",
        .emotions: "/raw/emotions/measurements/{measurement_id}/users/{user_id}",
        .interactions: "/raw/interactions/measurements/{measurement_id}/users/{user_id}",
        // æ–°ã—ã„ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’è¿½åŠ ã™ã‚‹ã¨ãã¯ã“ã“ã«è¿½åŠ 
    ]
    
    func createKey(for category: KeyCategory, replacements: [String: String]) -> String? {
        guard let format = KeyBuilder.formats[category] else { return nil }
        var key = format
        for (placeholder, value) in replacements {
            key = key.replacingOccurrences(of: "{\(placeholder)}", with: value)
        }
        return key
    }
}
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€ã¾ãšenum `KeyCategory`ã‚’å®šç¾©ã—ã¦ã€ã‚ãªãŸãŒç¾åœ¨æŒã£ã¦ã„ã‚‹å„ç¨®ã®keyåã‚’è¡¨ã—ã¾ã™ã€‚æ¬¡ã«`KeyBuilder` structã‚’å®šç¾©ã—ã€ãã®ä¸­ã«formatã¨ãã®formatã«å¯¾å¿œã™ã‚‹æ–‡å­—åˆ—ã‚’æ ¼ç´ã—ãŸè¾æ›¸`formats`ã‚’å®šç¾©ã—ã¾ã™ã€‚ã“ã“ã§æ–°ã—ã„keyåã‚’è¿½åŠ ã™ã‚‹ã¨ãã¯ã€`formats`ã«æ–°ã—ã„ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚’è¿½åŠ ã—ã¾ã™ã€‚

ã¾ãŸã€`createKey`é–¢æ•°ã¯æŒ‡å®šã•ã‚ŒãŸ`category`ã¨ã€ç½®ãæ›ãˆã‚‹ã¹ãæ–‡å­—åˆ—ã¨ãã®å€¤ã®è¾æ›¸`replacements`ã‚’å—ã‘å–ã‚Šã€ç½®ãæ›ãˆãŸå¾Œã®keyã‚’ç”Ÿæˆã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã©ã®ã‚ˆã†ãªç½®ãæ›ãˆæ–‡å­—åˆ—ãŒå­˜åœ¨ã—ã¦ã‚‚ã€ãã®æ–‡å­—åˆ—ã¨å€¤ã®è¾æ›¸ã‚’å—ã‘å–ã£ã¦keyã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã«ä½¿ã„æ–¹ã®ä¾‹ã‚’ç¤ºã—ã¾ã™ï¼š

```swift
let builder = KeyBuilder()
let replacements = ["measurement_id": "123", "user_id": "abc"]
if let key = builder.createKey(for: .anchors, replacements: replacements) {
    print(key)  // å‡ºåŠ›: /raw/anchors/measurements/123/users/abc
}
```

æ–°ã—ã„keyåã‚’è¿½åŠ ã™ã‚‹ã¨ãã‚„ã€ç½®ãæ›ãˆã‚‹æ–‡å­—åˆ—ãŒè¿½åŠ ã•ã‚ŒãŸã¨ãã‚‚ã€ãã‚Œãã‚Œ`formats`ã‚’æ›´æ–°ã—ãŸã‚Šã€`replacements`ã«æ–°ã—ã„ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚’è¿½åŠ ã—ãŸã‚Šã™ã‚‹ã ã‘ã§å¯¾å¿œã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/6/12 2:55:04*

è¾æ›¸å‹ã‚’ä½¿ã†ã®ã¯ã‚»ãƒ³ã‚¹ãŒãªã„æ°—ãŒã™ã‚‹ã€‚å°‘ã—å†—é•·ã§ã‚‚ã„ã„ã‹ã‚‰ã‚‚ã†ã¡ã‚‡ã£ã¨ã†ã¾ã„æ–¹æ³•ã‚’è€ƒãˆã¦æ¬²ã—ã„

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/6/12 2:55:56*

ç†è§£ã—ã¾ã—ãŸã€‚æ–‡å­—åˆ—ã®ç½®ãæ›ãˆã«å¯¾ã™ã‚‹ä¸€èˆ¬çš„ãªè§£æ±ºç­–ã®ä¸€ã¤ã¨ã—ã¦è¾æ›¸å‹ã‚’ææ¡ˆã—ã¾ã—ãŸãŒã€ã‚ˆã‚Šæ˜ç¤ºçš„ã§å‹å®‰å…¨ãªæ–¹æ³•ã‚’æ±‚ã‚ã¦ã„ã‚‹ã¨æ„Ÿã˜ã¾ã™ã€‚

Swiftã®å¼·åŠ›ãªå‹ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨ã—ã¦ã€ç‰¹å®šã®ã‚«ãƒ†ã‚´ãƒªã”ã¨ã«æ§‹é€ ä½“ã‚’å®šç¾©ã—ã€ãã‚Œãã‚Œã®ç½®ãæ›ãˆéƒ¨åˆ†ã‚’ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦æŒã¤ã“ã¨ã§ã€ã‚ˆã‚Šå‹å®‰å…¨ã«ã€ãã—ã¦å†—é•·ã•ã‚‚å°‘ãªãå®Ÿè£…ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ä»¥ä¸‹ã«ã€ãã‚Œãã‚Œã®ã‚«ãƒ†ã‚´ãƒªã‚’è¡¨ã™æ§‹é€ ä½“ã‚’ä½¿ç”¨ã—ã¦ã€keyã‚’ç”Ÿæˆã™ã‚‹ä¾‹ã‚’ç¤ºã—ã¾ã™ï¼š

```swift
protocol S3Key {
    var path: String { get }
}

struct AnchorKey: S3Key {
    var measurementId: String
    var userId: String

    var path: String {
        return "/raw/anchors/measurements/\(measurementId)/users/\(userId)"
    }
}

struct EmotionKey: S3Key {
    var measurementId: String
    var userId: String

    var path: String {
        return "/raw/emotions/measurements/\(measurementId)/users/\(userId)"
    }
}

struct InteractionKey: S3Key {
    var measurementId: String
    var userId: String

    var path: String {
        return "/raw/interactions/measurements/\(measurementId)/users/\(userId)"
    }
}

// æ–°ã—ã„ã‚«ãƒ†ã‚´ãƒªã‚’è¿½åŠ ã™ã‚‹ã¨ãã¯ã“ã“ã«æ–°ã—ã„æ§‹é€ ä½“ã‚’è¿½åŠ 
```

ã“ã“ã§ã€å„ã‚«ãƒ†ã‚´ãƒªã”ã¨ã«æ§‹é€ ä½“ã‚’å®šç¾©ã—ã€ãã‚Œã‚‰å…¨ã¦ãŒ`S3Key`ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚`S3Key`ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«ã¯ã€pathã¨ã„ã†æ–‡å­—åˆ—ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒã‚ã‚Šã¾ã™ã€‚

ãã—ã¦ã€ã“ã‚Œã‚‰ã®æ§‹é€ ä½“ã‚’ä½¿ç”¨ã—ã¦æ¬¡ã®ã‚ˆã†ã«keyã‚’ç”Ÿæˆã—ã¾ã™ï¼š

```swift
let anchorKey = AnchorKey(measurementId: "123", userId: "abc")
print(anchorKey.path)  // å‡ºåŠ›: /raw/anchors/measurements/123/users/abc
```

æ–°ã—ã„ã‚«ãƒ†ã‚´ãƒªã‚„ç½®ãæ›ãˆéƒ¨åˆ†ã‚’è¿½åŠ ã™ã‚‹ã¨ãã¯ã€æ–°ã—ã„æ§‹é€ ä½“ã‚’å®šç¾©ã™ã‚‹ã ã‘ã§å¯¾å¿œã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å‹å®‰å…¨æ€§ãŒå‘ä¸Šã—ã€å„éƒ¨åˆ†ãŒæ˜ç¢ºã«å®šç¾©ã•ã‚Œã€å†—é•·ã•ã‚‚å°‘ãªããªã‚Šã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/6/12 2:56:36*

ã“ã‚Œã¯ã„ã„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã ã¨æ€ã†ã€‚letã§å®£è¨€ã§ãã‚‹ã¨ã“ã‚ã¯letã§å®£è¨€ã—ã¦æ¬²ã—ã„ã€‚ã¾ãŸpublicã«ã—ã¦initã‚‚publicã«ã—ã¦ã»ã—ã„ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/6/12 2:57:10*

äº†è§£ã—ã¾ã—ãŸã€‚ãã‚Œãã‚Œã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’`let`ã§å®šç¾©ã—ã€æ§‹é€ ä½“ã¨`init`ã‚’`public`ã«ã™ã‚‹ã‚ˆã†ã«ä¿®æ­£ã—ãŸã‚³ãƒ¼ãƒ‰ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ï¼š

```swift
public protocol S3Key {
    var path: String { get }
}

public struct AnchorKey: S3Key {
    public let measurementId: String
    public let userId: String

    public var path: String {
        return "/raw/anchors/measurements/\(measurementId)/users/\(userId)"
    }

    public init(measurementId: String, userId: String) {
        self.measurementId = measurementId
        self.userId = userId
    }
}

public struct EmotionKey: S3Key {
    public let measurementId: String
    public let userId: String

    public var path: String {
        return "/raw/emotions/measurements/\(measurementId)/users/\(userId)"
    }

    public init(measurementId: String, userId: String) {
        self.measurementId = measurementId
        self.userId = userId
    }
}

public struct InteractionKey: S3Key {
    public let measurementId: String
    public let userId: String

    public var path: String {
        return "/raw/interactions/measurements/\(measurementId)/users/\(userId)"
    }

    public init(measurementId: String, userId: String) {
        self.measurementId = measurementId
        self.userId = userId
    }
}

// æ–°ã—ã„ã‚«ãƒ†ã‚´ãƒªã‚’è¿½åŠ ã™ã‚‹ã¨ãã¯ã“ã“ã«æ–°ã—ã„æ§‹é€ ä½“ã‚’è¿½åŠ 
```

ã“ã®ä¿®æ­£ã«ã‚ˆã‚Šã€ã“ã‚Œã‚‰ã®æ§‹é€ ä½“ã¯ä»»æ„ã®Swiftã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ãªã‚Šã€ã¾ãŸå„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚‚ä¸å¤‰ï¼ˆ`let`ã§å®£è¨€ï¼‰ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ä¸€åº¦åˆæœŸåŒ–ã•ã‚ŒãŸå¾Œã¯å¤‰æ›´ã§ããªã„ãŸã‚ã€å®‰å…¨æ€§ãŒå‘ä¸Šã—ã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/6/12 3:11:54*

ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ¡ç”¨ã—ã¦ã„ã¦ã€ã“ã®keyæƒ…å ±ã¯domainå±¤ãªã®ã§ã€S3Keyã§ã¯ãªãã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å…ˆãŒS3ã¨ã„ã†ã“ã¨ã‚’æ„è­˜ã—ãªã„ã‚ˆã†ã«å¤‰æ›´ã—ã¦æ¬²ã—ã„ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/6/12 3:12:34*

ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ¡ç”¨ã—ã¦ã„ã¦ã€ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ãŒå…·ä½“çš„ãªã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã«ä¾å­˜ã—ãªã„ã‚ˆã†ã«ã™ã‚‹ã¨ã„ã†ç†è§£ã‚’æŒã£ã¦ã„ã¾ã™ã€‚ãã‚Œã«å¯¾å¿œã™ã‚‹ãŸã‚ã«ã€`S3Key`ã‚’`DataKey`ãªã©ã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¾å­˜ã—ãªã„åå‰ã«å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä»¥ä¸‹ã«ä¿®æ­£ã—ãŸã‚³ãƒ¼ãƒ‰ã‚’ç¤ºã—ã¾ã™ï¼š

```swift
public protocol DataKey {
    var path: String { get }
}

public struct AnchorDataKey: DataKey {
    public let measurementId: String
    public let userId: String

    public var path: String {
        return "/raw/anchors/measurements/\(measurementId)/users/\(userId)"
    }

    public init(measurementId: String, userId: String) {
        self.measurementId = measurementId
        self.userId = userId
    }
}

public struct EmotionDataKey: DataKey {
    public let measurementId: String
    public let userId: String

    public var path: String {
        return "/raw/emotions/measurements/\(measurementId)/users/\(userId)"
    }

    public init(measurementId: String, userId: String) {
        self.measurementId = measurementId
        self.userId = userId
    }
}

public struct InteractionDataKey: DataKey {
    public let measurementId: String
    public let userId: String

    public var path: String {
        return "/raw/interactions/measurements/\(measurementId)/users/\(userId)"
    }

    public init(measurementId: String, userId: String) {
        self.measurementId = measurementId
        self.userId = userId
    }
}

// æ–°ã—ã„ã‚«ãƒ†ã‚´ãƒªã‚’è¿½åŠ ã™ã‚‹ã¨ãã¯ã“ã“ã«æ–°ã—ã„æ§‹é€ ä½“ã‚’è¿½åŠ 
```

ã“ã†ã™ã‚‹ã“ã¨ã§ã€ã“ã‚Œã‚‰ã®keyç”Ÿæˆã‚¯ãƒ©ã‚¹ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã§ã‚ã‚‹ã¨åŒæ™‚ã«ã€å…·ä½“çš„ãªã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®è©³ç´°ï¼ˆã“ã®å ´åˆã¯S3ï¼‰ã«ä¾å­˜ã—ãªã„è¨­è¨ˆã«ãªã‚Šã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/6/12 3:15:28*

ä»¥ä¸‹ã®ã‚ˆã†ãªCloudStorageManagerProtocolã‚’ç”¨æ„ã—ã¦ã„ã¦ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å‡¦ç†ã¯ä»Š3ã¤ãªã‚“ã ã‘ã©ã€ã“ã‚Œã‚’enumã®é€£æƒ³å‹ã¨ã—ã¦ã‚‚ã£ã¦ã€é€£æƒ³åœ°ã¨ã—ã¦ã€ãã‚Œãã‚Œã®DataKeyã¨Anyå‹ã®dataã‚’æŒã¤ã‚ˆã†ãªã‚‚ã®ã‚’ä½œã£ã¦ãã‚Œã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«uploadã™ã‚‹ã‚ˆã†ãªé–¢æ•°ã‚’å®šç¾©ã—ã¦ã»ã—ã„

public protocol CloudStorageManagerProtocol {}

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/6/12 3:16:25*

äº†è§£ã—ã¾ã—ãŸã€‚ã¾ãšã€ãã‚Œãã‚Œã®`DataKey`ã‚’æŒã¤enumã‚’ä½œã‚Šã€ãã‚Œã¨ä¸€ç·’ã«ä»»æ„ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã™ã‚‹å‹ã‚’å®šç¾©ã—ã¾ã™ã€‚ãã‚Œã‹ã‚‰ã€ãã®å‹ã‚’å¼•æ•°ã«å–ã‚‹`upload`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’`CloudStorageManagerProtocol`ã«è¿½åŠ ã—ã¾ã™ã€‚

ä»¥ä¸‹ã«ç¤ºã™ã®ã¯ã€ãã®ã‚ˆã†ãªè¨­è¨ˆã‚’å®Ÿç¾ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã§ã™ï¼š

```swift
public protocol DataKey {
    var path: String { get }
}

public struct AnchorDataKey: DataKey {
    public let measurementId: String
    public let userId: String

    public var path: String {
        return "/raw/anchors/measurements/\(measurementId)/users/\(userId)"
    }

    public init(measurementId: String, userId: String) {
        self.measurementId = measurementId
        self.userId = userId
    }
}

public struct EmotionDataKey: DataKey {
    public let measurementId: String
    public let userId: String

    public var path: String {
        return "/raw/emotions/measurements/\(measurementId)/users/\(userId)"
    }

    public init(measurementId: String, userId: String) {
        self.measurementId = measurementId
        self.userId = userId
    }
}

public struct InteractionDataKey: DataKey {
    public let measurementId: String
    public let userId: String

    public var path: String {
        return "/raw/interactions/measurements/\(measurementId)/users/\(userId)"
    }

    public init(measurementId: String, userId: String) {
        self.measurementId = measurementId
        self.userId = userId
    }
}

public enum CloudStorageKey {
    case anchor(AnchorDataKey)
    case emotion(EmotionDataKey)
    case interaction(InteractionDataKey)
}

public struct CloudStorageUploadRequest {
    public let key: CloudStorageKey
    public let data: Any
}

public protocol CloudStorageManagerProtocol {
    func upload(_ request: CloudStorageUploadRequest) -> Bool
}
```

ã“ã®è¨­è¨ˆã§ã¯ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯`CloudStorageUploadRequest`å‹ã§è¡¨ç¾ã•ã‚Œã€ãã‚Œã¯å…·ä½“çš„ãª`DataKey`ï¼ˆãã‚Œãã‚Œã®ãƒ‡ãƒ¼ã‚¿ã‚«ãƒ†ã‚´ãƒªã«å¯¾å¿œï¼‰ã¨ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ä»»æ„ã®ãƒ‡ãƒ¼ã‚¿ã‚’æŒã¡ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†ã¯æ±ç”¨çš„ã«ãªã‚Šã€æ–°ãŸãªãƒ‡ãƒ¼ã‚¿ã‚«ãƒ†ã‚´ãƒªã‚’è¿½åŠ ã™ã‚‹éš›ã«ã¯`CloudStorageKey` enumã«æ–°ãŸãªcaseã‚’è¿½åŠ ã™ã‚‹ã ã‘ã§ã‚ˆããªã‚Šã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/6/12 3:19:28*

ä»Šã¯Anyå‹ã®dataãªã‚“ã ã‘ã©ã€ä»Šå¾Œã€ãã‚Œãã‚Œã¯å…·ä½“çš„ãªå‹ã«å¤‰æ›´ã—ã¦ã„ããŸã„ã®ã§ã€ãã†ãªã‚‹ã‚ˆã†ã«å¤‰æ›´ã—ã¦æ¬²ã—ã„

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/6/12 3:20:36*

äº†è§£ã—ã¾ã—ãŸã€‚ãã‚Œãã‚Œã®keyãŒç‹¬è‡ªã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’æŒã¤ã‚ˆã†ã«è¨­è¨ˆã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã¾ãšã€`DataKey`ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«é–¢é€£å‹`DataType`ã‚’è¿½åŠ ã—ã¾ã™ã€‚ãã—ã¦ã€ãã‚Œãã‚Œã®å…·ä½“çš„ãª`DataKey`æ§‹é€ ä½“ã§ã¯ã€ã“ã®é–¢é€£å‹ã‚’å…·ä½“çš„ãªãƒ‡ãƒ¼ã‚¿å‹ã§æŒ‡å®šã—ã¾ã™ã€‚

ä¸€æ–¹ã€`CloudStorageUploadRequest`ã¯ä»»æ„ã®`DataKey`ã‚’æŒã¤ã“ã¨ãŒã§ãã¾ã™ãŒã€ãã‚Œãã‚Œã®`DataKey`ãŒç•°ãªã‚‹ãƒ‡ãƒ¼ã‚¿å‹ã‚’æŒã¤å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã‚’ä½¿ç”¨ã—ã¦å…·ä½“çš„ãª`DataKey`å‹ã‚’æŒ‡å®šã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ä»¥ä¸‹ã«ã€ãã‚Œã‚’é©ç”¨ã—ãŸã‚³ãƒ¼ãƒ‰ã‚’ç¤ºã—ã¾ã™ï¼š

```swift
public protocol DataKey {
    associatedtype DataType
    var path: String { get }
}

public struct AnchorDataKey: DataKey {
    public typealias DataType = AnchorData  // AnchorData is a placeholder for the actual type.

    public let measurementId: String
    public let userId: String

    public var path: String {
        return "/raw/anchors/measurements/\(measurementId)/users/\(userId)"
    }

    public init(measurementId: String, userId: String) {
        self.measurementId = measurementId
        self.userId = userId
    }
}

public struct EmotionDataKey: DataKey {
    public typealias DataType = EmotionData  // EmotionData is a placeholder for the actual type.

    public let measurementId: String
    public let userId: String

    public var path: String {
        return "/raw/emotions/measurements/\(measurementId)/users/\(userId)"
    }

    public init(measurementId: String, userId: String) {
        self.measurementId = measurementId
        self.userId = userId
    }
}

public struct InteractionDataKey: DataKey {
    public typealias DataType = InteractionData  // InteractionData is a placeholder for the actual type.

    public let measurementId: String
    public let userId: String

    public var path: String {
        return "/raw/interactions/measurements/\(measurementId)/users/\(userId)"
    }

    public init(measurementId: String, userId: String) {
        self.measurementId = measurementId
        self.userId = userId
    }
}

public struct CloudStorageUploadRequest<Key: DataKey> {
    public let key: Key
    public let data: Key.DataType
}

public protocol CloudStorageManagerProtocol {
    func upload<Key: DataKey>(_ request: CloudStorageUploadRequest<Key>) -> Bool
}
```

ã“ã®è¨­è¨ˆã«ã‚ˆã‚Šã€å„`DataKey`ã¯ç‹¬è‡ªã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’æŒã¤ã“ã¨ãŒã§ãã€ãã—ã¦`CloudStorageUploadRequest`ã¯ãã®`DataKey`ã¨ä¸€è‡´ã™ã‚‹ãƒ‡ãƒ¼ã‚¿å‹ã‚’æŒã¤ã“ã¨ãŒä¿è¨¼ã•ã‚Œã¾ã™ã€‚

ãªãŠã€ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã¯`AnchorData`, `EmotionData`, `InteractionData`ã¨ã„ã†å‹ã‚’ä»®ã«å°å…¥ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã¯ãã‚Œãã‚Œã®ãƒ‡ãƒ¼ã‚¿ã‚«ãƒ†ã‚´ãƒªã«é©ã—ãŸå…·ä½“çš„ãªãƒ‡ãƒ¼ã‚¿å‹ã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/6/12 3:21:50*

ã“ã‚Œã‚’ã™ã‚‹ãã‚‰ã„ã ã£ãŸã‚‰ã€enum ã§3ã¤ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‹ã‚’å®šç¾©ã—ã¦ã€ãã‚Œãã‚ŒãŒdataã¨DataKeyã‚’æŒã¤ã‚ˆã†ã«ã—ãŸæ–¹ãŒè‰¯ã„æ°—ãŒã™ã‚‹ã®ã ã‘ã‚Œã©ã‚‚ã©ã†æ€ã†ï¼Ÿ

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/6/12 3:22:44*

ã¯ã„ã€ãã‚Œã¯æœ‰åŠ¹ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã™ã€‚enumã‚’ä½¿ã£ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‹ã‚’å®šç¾©ã™ã‚‹ã¨ã€ãã‚Œãã‚Œã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ­£ç¢ºãª`DataKey`ã¨ãƒ‡ãƒ¼ã‚¿å‹ã‚’æŒã¤ã“ã¨ã‚’ä¿è¨¼ã§ãã¾ã™ã€‚

ä»¥ä¸‹ã«ãã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’åæ˜ ã—ãŸã‚³ãƒ¼ãƒ‰ã‚’ç¤ºã—ã¾ã™ï¼š

```swift
public protocol DataKey {
    associatedtype DataType
    var path: String { get }
}

public struct AnchorDataKey: DataKey {
    public typealias DataType = AnchorData  // AnchorData is a placeholder for the actual type.

    public let measurementId: String
    public let userId: String

    public var path: String {
        return "/raw/anchors/measurements/\(measurementId)/users/\(userId)"
    }

    public init(measurementId: String, userId: String) {
        self.measurementId = measurementId
        self.userId = userId
    }
}

public struct EmotionDataKey: DataKey {
    public typealias DataType = EmotionData  // EmotionData is a placeholder for the actual type.

    public let measurementId: String
    public let userId: String

    public var path: String {
        return "/raw/emotions/measurements/\(measurementId)/users/\(userId)"
    }

    public init(measurementId: String, userId: String) {
        self.measurementId = measurementId
        self.userId = userId
    }
}

public struct InteractionDataKey: DataKey {
    public typealias DataType = InteractionData  // InteractionData is a placeholder for the actual type.

    public let measurementId: String
    public let userId: String

    public var path: String {
        return "/raw/interactions/measurements/\(measurementId)/users/\(userId)"
    }

    public init(measurementId: String, userId: String) {
        self.measurementId = measurementId
        self.userId = userId
    }
}

public enum CloudStorageUploadRequest {
    case anchor(key: AnchorDataKey, data: AnchorDataKey.DataType)
    case emotion(key: EmotionDataKey, data: EmotionDataKey.DataType)
    case interaction(key: InteractionDataKey, data: InteractionDataKey.DataType)
}

public protocol CloudStorageManagerProtocol {
    func upload(_ request: CloudStorageUploadRequest) -> Bool
}
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€`CloudStorageUploadRequest` enumã®å„caseã¯ã€ãã‚Œãã‚Œã®`DataKey`ã¨å¯¾å¿œã™ã‚‹ãƒ‡ãƒ¼ã‚¿å‹ã‚’æŒã£ã¦ã„ã¾ã™ã€‚ã¾ãŸã€`CloudStorageManagerProtocol`ã®`upload`ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã“ã®enumã‚’å¼•æ•°ã«å–ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å…·ä½“çš„ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¿ã‚¤ãƒ—ã”ã¨ã«é©åˆ‡ãªãƒ‡ãƒ¼ã‚¿ã¨ã‚­ãƒ¼ã‚’æŒã¤ã“ã¨ãŒä¿è¨¼ã•ã‚Œã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/6/12 3:23:15*

CloudStorageManagerå´ã®å‡¦ç†ã¨ã‹æ›¸ã„ã¦æ¬²ã—ã„ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/6/12 3:24:10*

CloudStorageManagerã®å‡¦ç†ã«ã¤ã„ã¦ã€å…·ä½“çš„ã«ã¯ã©ã®ã‚ˆã†ãªå‹•ä½œã‚’æœŸå¾…ã—ã¦ã„ã¾ã™ã‹ï¼ŸãŸã ã—ã€å®Ÿéš›ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆAWS SDKç­‰ã®å…·ä½“çš„ãªä½¿ç”¨æ–¹æ³•ï¼‰ã¯ã‚ã¾ã‚Šã«ã‚‚å…·ä½“çš„ã§ã€ãã‚Œã¯ãŠãã‚‰ãã‚ãªãŸã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®è¦ä»¶ã«ã‚ˆã£ã¦å¤§ããå·¦å³ã•ã‚Œã‚‹ãŸã‚ã€ã“ã“ã§ã¯å…·ä½“çš„ãªã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®å®Ÿè£…ã‚’çœç•¥ã—ã¦ã„ã¾ã™ã€‚

ã¨ã¯ã„ãˆã€åŸºæœ¬çš„ãªæ§‹é€ ã¨ã—ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

```swift
public class CloudStorageManager: CloudStorageManagerProtocol {
    public init() {}
    
    public func upload(_ request: CloudStorageUploadRequest) -> Bool {
        switch request {
        case .anchor(let key, let data):
            return uploadData(path: key.path, data: data)
        case .emotion(let key, let data):
            return uploadData(path: key.path, data: data)
        case .interaction(let key, let data):
            return uploadData(path: key.path, data: data)
        }
    }
    
    private func uploadData(path: String, data: Any) -> Bool {
        // Use path to determine where to upload the data to.
        // The actual uploading process depends on the specific details of your storage service.
        // Replace 'Any' with the specific data type expected by the storage service.

        print("Uploading data to \(path)...")
        // TODO: Add actual upload logic here.
        
        return true  // Return true if upload succeeded, false otherwise.
    }
}
```

ã“ã“ã§ã¯ã€`CloudStorageManager`ã¯`CloudStorageManagerProtocol`ã‚’å®Ÿè£…ã—ã€`upload`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æä¾›ã—ã¾ã™ã€‚ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯`CloudStorageUploadRequest` enumã‚’å¼•æ•°ã«ã¨ã‚Šã€ãã‚Œãã‚Œã®caseã«å¿œã˜ã¦`uploadData`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚`uploadData`ãƒ¡ã‚½ãƒƒãƒ‰ã¯å…·ä½“çš„ãªã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯ã‚’å«ã‚€å ´æ‰€ã¨ãªã‚‹ã§ã—ã‚‡ã†ã€‚

ã“ã®è¨­è¨ˆã§ã¯ã€æ–°ãŸãªãƒ‡ãƒ¼ã‚¿ã‚«ãƒ†ã‚´ãƒªãŒè¿½åŠ ã•ã‚ŒãŸå ´åˆã€ãã‚Œã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã«ã¯`CloudStorageUploadRequest` enumã«æ–°ãŸãªcaseã‚’è¿½åŠ ã—ã€`CloudStorageManager`ã®`upload`ãƒ¡ã‚½ãƒƒãƒ‰ã«ãã®caseã«å¯¾ã™ã‚‹å‡¦ç†ã‚’è¿½åŠ ã™ã‚‹ã ã‘ã§è‰¯ã„ã§ã™ã€‚

ãªãŠã€å…·ä½“çš„ãªãƒ‡ãƒ¼ã‚¿ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ–¹æ³•ã‚„ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®è©³ç´°ã¯ã€ä½¿ç”¨ã—ã¦ã„ã‚‹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚µãƒ¼ãƒ“ã‚¹ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€ã•ã‚‰ã«ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è¦ä»¶ã«ã‚ˆã‚Šã¾ã™ã®ã§ã€ã“ã“ã§ã¯çœç•¥ã—ã¦ã„ã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/6/12 3:25:10*

å®Ÿéš›ã«CloudStorageManagerã‚’ä½¿ã£ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã‚ˆã†ãªå‡¦ç†ã‚’ã‹ã„ã¦ã¿ã¦ã»ã—ã„ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/6/12 3:26:00*

äº†è§£ã—ã¾ã—ãŸã€å…·ä½“çš„ãªåˆ©ç”¨ä¾‹ã‚’ç¤ºã—ã¾ã™ã€‚ä¸‹è¨˜ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€`CloudStorageManager`ã‚’åˆ©ç”¨ã—ã¦å„ç¨®ãƒ‡ãƒ¼ã‚¿ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚

```swift
// Create your CloudStorageManager instance.
let manager = CloudStorageManager()

// Create data keys and data for each upload request.
let anchorKey = AnchorDataKey(measurementId: "measurement1", userId: "user1")
let anchorData = AnchorData()  // This is a placeholder. Replace with actual data.

let emotionKey = EmotionDataKey(measurementId: "measurement2", userId: "user2")
let emotionData = EmotionData()  // This is a placeholder. Replace with actual data.

let interactionKey = InteractionDataKey(measurementId: "measurement3", userId: "user3")
let interactionData = InteractionData()  // This is a placeholder. Replace with actual data.

// Create upload requests.
let anchorRequest = CloudStorageUploadRequest.anchor(key: anchorKey, data: anchorData)
let emotionRequest = CloudStorageUploadRequest.emotion(key: emotionKey, data: emotionData)
let interactionRequest = CloudStorageUploadRequest.interaction(key: interactionKey, data: interactionData)

// Upload data using the CloudStorageManager.
let anchorUploadResult = manager.upload(anchorRequest)
print("Anchor data upload was successful: \(anchorUploadResult)")

let emotionUploadResult = manager.upload(emotionRequest)
print("Emotion data upload was successful: \(emotionUploadResult)")

let interactionUploadResult = manager.upload(interactionRequest)
print("Interaction data upload was successful: \(interactionUploadResult)")
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€ãã‚Œãã‚Œã®`DataKey`ã¨ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¦ã€ãã‚Œã‚‰ã‚’ç”¨ã„ã¦`CloudStorageUploadRequest`ã‚’ä½œã‚Šã¾ã™ã€‚ãã—ã¦ã€`CloudStorageManager`ã®`upload`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç”¨ã„ã¦ãã‚Œã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒæˆåŠŸã—ãŸã‹ã©ã†ã‹ã®çµæœã¯`Bool`ã§è¿”ã•ã‚Œã¾ã™ã€‚

ãªãŠã€`AnchorData`, `EmotionData`, `InteractionData`ã¯å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿å‹ã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚ã¾ãŸã€`"measurement1"`, `"user1"`ç­‰ã®æ–‡å­—åˆ—ã‚‚å®Ÿéš›ã®æ¸¬å®šIDã‚„ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/6/12 3:28:45*

ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ãŸã¨ã—ã¦ã€å…¨éƒ¨æ›¸ãç›´ã—ã¦æ¬²ã—ã„ã€‚.DataTypeã¯ã‚„ã‚‰ãªãã¦ã„ã„ã‚ˆ

public enum CloudStorageUploadRequest {
    case anchor(key: AnchorDataKey, data: Any)
    case emotion(key: EmotionDataKey, data: Any)
    case interaction(key: InteractionDataKey, data: Any)
}


public protocol CloudStorageManagerProtocol {
    func upload(_ request: CloudStorageUploadRequest) async throws
}

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/6/12 3:29:59*

æŒ‡ç¤ºã«åŸºã¥ãã€ã‚³ãƒ¼ãƒ‰ã‚’å†åº¦è¨˜è¿°ã—ã¾ã™ã€‚ãªãŠã€Swift 5.5ä»¥é™ã®éåŒæœŸå‡¦ç†ã‚„ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’åæ˜ ã—ã¦ã„ã¾ã™ã€‚

```swift
public protocol DataKey {
    var path: String { get }
}

public struct AnchorDataKey: DataKey {
    public let measurementId: String
    public let userId: String

    public var path: String {
        return "/raw/anchors/measurements/\(measurementId)/users/\(userId)"
    }

    public init(measurementId: String, userId: String) {
        self.measurementId = measurementId
        self.userId = userId
    }
}

public struct EmotionDataKey: DataKey {
    public let measurementId: String
    public let userId: String

    public var path: String {
        return "/raw/emotions/measurements/\(measurementId)/users/\(userId)"
    }

    public init(measurementId: String, userId: String) {
        self.measurementId = measurementId
        self.userId = userId
    }
}

public struct InteractionDataKey: DataKey {
    public let measurementId: String
    public let userId: String

    public var path: String {
        return "/raw/interactions/measurements/\(measurementId)/users/\(userId)"
    }

    public init(measurementId: String, userId: String) {
        self.measurementId = measurementId
        self.userId = userId
    }
}

public enum CloudStorageUploadRequest {
    case anchor(key: AnchorDataKey, data: Any)
    case emotion(key: EmotionDataKey, data: Any)
    case interaction(key: InteractionDataKey, data: Any)
}

public enum CloudStorageError: Error {
    case uploadFailed
}

public protocol CloudStorageManagerProtocol {
    func upload(_ request: CloudStorageUploadRequest) async throws
}

public class CloudStorageManager: CloudStorageManagerProtocol {
    public init() {}
    
    public func upload(_ request: CloudStorageUploadRequest) async throws {
        switch request {
        case .anchor(let key, let data):
            try await uploadData(path: key.path, data: data)
        case .emotion(let key, let data):
            try await uploadData(path: key.path, data: data)
        case .interaction(let key, let data):
            try await uploadData(path: key.path, data: data)
        }
    }
    
    private func uploadData(path: String, data: Any) async throws {
        // Use path to determine where to upload the data to.
        // The actual uploading process depends on the specific details of your storage service.

        print("Uploading data to \(path)...")
        // TODO: Add actual upload logic here.
        
        // Mock a failed upload.
        throw CloudStorageError.uploadFailed
    }
}
```

ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€Swift 5.5ã®æ–°æ©Ÿèƒ½ã§ã‚ã‚‹async/awaitã‚’ä½¿ç”¨ã—ã¦éåŒæœŸå‡¦ç†ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚ã¾ãŸã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãŸã‚ã«`CloudStorageError`ã‚’å®šç¾©ã—ã€ã“ã‚Œã‚’ä½¿ã£ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—ã‚’ç¤ºã™ä¾‹å¤–ã‚’ã‚¹ãƒ­ãƒ¼ã—ã¦ã„ã¾ã™ã€‚å…·ä½“çš„ãªã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¦ä»¶ã«ã‚ˆã‚Šã¾ã™ã®ã§ã€`uploadData`ãƒ¡ã‚½ãƒƒãƒ‰å†…ã«é©åˆ‡ãªã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/6/12 3:43:52*

ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¦æ¬²ã—ã„ã€‚

protocol ã§CloudStorageUploadInteractorProtocolã¨ã„ã†ã‚‚ã®ã‚’è€ƒãˆãŸã„ã€‚

å®Ÿæ…‹ã¯CloudStorageUploadInteractorã§ã‚ã‚‹ã€‚

CloudStorageManagerProtocolã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä»¥ä¸‹ã«å¤‰ãˆãŸã„ã€‚

public protocol CloudStorageManagerProtocol {
    func upload(data: Data, key: String) async throws
}

CloudStorageUploadInteractor ã®ä¸­ã§ã€ä»¥ä¸‹ã®ConverterãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã¨ã™ã‚‹ã€‚

AnchorConverter
EmotionConverter
InteractionConverter

CloudStorageUploadInteractor ã§ã¯ enum ã§ããŸCloudStorageUploadRequestã«å¯¾ã—ã¦ã€ãã‚Œãã‚Œã®switchæ–‡ã‚’æ›¸ã„ã¦ã€ãã‚Œãã‚Œã«å¯¾ã™ã‚‹Converterã§Dataå‹ã«å¤‰æ›´ã—ã¦ã€CloudStorageManagerProtocol çµŒç”±ã§upload(data: Data, key: String) async throws ã‚’å®Ÿè¡Œã™ã‚‹ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/6/12 3:44:53*

æŒ‡ç¤ºã«åŸºã¥ã„ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚¯ãƒ©ã‚¹ã¨ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’å†è¨­è¨ˆã—ã¾ã™ã€‚ã“ã“ã§ã¯ã€å„ãƒ‡ãƒ¼ã‚¿å‹ã‚’`Data`å‹ã«å¤‰æ›ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ã‚³ãƒ³ãƒãƒ¼ã‚¿ã‚’ä»®å®šã—ã¦ã„ã¾ã™ã€‚ãã‚Œãã‚Œã®ãƒ‡ãƒ¼ã‚¿å‹ã«å¯¾å¿œã™ã‚‹`Converter`ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚

```swift
public protocol DataKey {
    var path: String { get }
}

// ... (AnchorDataKey, EmotionDataKey, InteractionDataKeyã®å®šç¾©ã¯ä»¥å‰ã®ã‚‚ã®ã‚’ãã®ã¾ã¾ä½¿ã„ã¾ã™)

public enum CloudStorageUploadRequest {
    case anchor(key: AnchorDataKey, data: Any)
    case emotion(key: EmotionDataKey, data: Any)
    case interaction(key: InteractionDataKey, data: Any)
}

public protocol AnchorConverter {
    func convertToData(_ any: Any) async throws -> Data
}

public protocol EmotionConverter {
    func convertToData(_ any: Any) async throws -> Data
}

public protocol InteractionConverter {
    func convertToData(_ any: Any) async throws -> Data
}

public protocol CloudStorageManagerProtocol {
    func upload(data: Data, key: String) async throws
}

public protocol CloudStorageUploadInteractorProtocol {
    func handle(_ request: CloudStorageUploadRequest) async throws
}

public class CloudStorageUploadInteractor: CloudStorageUploadInteractorProtocol {
    private let cloudStorageManager: CloudStorageManagerProtocol
    private let anchorConverter: AnchorConverter
    private let emotionConverter: EmotionConverter
    private let interactionConverter: InteractionConverter

    public init(
        cloudStorageManager: CloudStorageManagerProtocol,
        anchorConverter: AnchorConverter,
        emotionConverter: EmotionConverter,
        interactionConverter: InteractionConverter
    ) {
        self.cloudStorageManager = cloudStorageManager
        self.anchorConverter = anchorConverter
        self.emotionConverter = emotionConverter
        self.interactionConverter = interactionConverter
    }

    public func handle(_ request: CloudStorageUploadRequest) async throws {
        switch request {
        case .anchor(let key, let data):
            let convertedData = try await anchorConverter.convertToData(data)
            try await cloudStorageManager.upload(data: convertedData, key: key.path)
        case .emotion(let key, let data):
            let convertedData = try await emotionConverter.convertToData(data)
            try await cloudStorageManager.upload(data: convertedData, key: key.path)
        case .interaction(let key, let data):
            let convertedData = try await interactionConverter.convertToData(data)
            try await cloudStorageManager.upload(data: convertedData, key: key.path)
        }
    }
}
```

`CloudStorageUploadInteractor`ã¯ã€`CloudStorageUploadInteractorProtocol`ã‚’å®Ÿè£…ã—ã€è¦æ±‚ã«åŸºã¥ã„ã¦é©åˆ‡ãªã‚³ãƒ³ãƒãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’`Data`å‹ã«å¤‰æ›ã—ã€ãã‚Œã‚’ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/6/12 3:56:40*

ä»¥ä¸‹ã«å¤‰æ›´ã—ã¦æ¬²ã—ã„ã€‚

public protocol CloudStorageManagerProtocol {
    func upload(key: String, data: Data) async throws
}

ã‚ã¨ã€ã‚³ãƒ³ãƒãƒ¼ã‚¿ãƒ¼ã¯å¼•æ•°ã§æ¸¡ã•ãšã«ã€äºˆã‚private let ã§åˆæœŸåŒ–ã—ã¦ã„ã¦ã„ã„ã‚ˆã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/6/12 3:57:49*

ã”æŒ‡ç¤ºã«å¾“ã„ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¨ã‚¯ãƒ©ã‚¹ã®å®šç¾©ã‚’å¤‰æ›´ã—ã¾ã™ã€‚ã“ã“ã§ã¯ã€CloudStorageUploadInteractorã®åˆæœŸåŒ–æ™‚ã«ã‚³ãƒ³ãƒãƒ¼ã‚¿ã‚’å†…éƒ¨ã§ç”Ÿæˆã—ã€ãã‚Œã‚’å¾Œç¶šã®å‡¦ç†ã§åˆ©ç”¨ã—ã¾ã™ã€‚

```swift
public protocol DataKey {
    var path: String { get }
}

// ... (AnchorDataKey, EmotionDataKey, InteractionDataKeyã®å®šç¾©ã¯ä»¥å‰ã®ã‚‚ã®ã‚’ãã®ã¾ã¾ä½¿ã„ã¾ã™)

public enum CloudStorageUploadRequest {
    case anchor(key: AnchorDataKey, data: Any)
    case emotion(key: EmotionDataKey, data: Any)
    case interaction(key: InteractionDataKey, data: Any)
}

public protocol AnchorConverter {
    func convertToData(_ any: Any) async throws -> Data
}

public protocol EmotionConverter {
    func convertToData(_ any: Any) async throws -> Data
}

public protocol InteractionConverter {
    func convertToData(_ any: Any) async throws -> Data
}

public protocol CloudStorageManagerProtocol {
    func upload(key: String, data: Data) async throws
}

public protocol CloudStorageUploadInteractorProtocol {
    func handle(_ request: CloudStorageUploadRequest) async throws
}

public class CloudStorageUploadInteractor: CloudStorageUploadInteractorProtocol {
    private let cloudStorageManager: CloudStorageManagerProtocol
    private let anchorConverter: AnchorConverter
    private let emotionConverter: EmotionConverter
    private let interactionConverter: InteractionConverter

    public init(cloudStorageManager: CloudStorageManagerProtocol) {
        self.cloudStorageManager = cloudStorageManager
        self.anchorConverter = AnchorConverter()  // Assume AnchorConverter has default initializer.
        self.emotionConverter = EmotionConverter()  // Assume EmotionConverter has default initializer.
        self.interactionConverter = InteractionConverter()  // Assume InteractionConverter has default initializer.
    }

    public func handle(_ request: CloudStorageUploadRequest) async throws {
        switch request {
        case .anchor(let key, let data):
            let convertedData = try await anchorConverter.convertToData(data)
            try await cloudStorageManager.upload(key: key.path, data: convertedData)
        case .emotion(let key, let data):
            let convertedData = try await emotionConverter.convertToData(data)
            try await cloudStorageManager.upload(key: key.path, data: convertedData)
        case .interaction(let key, let data):
            let convertedData = try await interactionConverter.convertToData(data)
            try await cloudStorageManager.upload(key: key.path, data: convertedData)
        }
    }
}
```

`CloudStorageUploadInteractor`ã§ã¯ã€`CloudStorageManagerProtocol`ã¨å…±ã«ã€ãã‚Œãã‚Œã®`Converter`ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚‚ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦ä¿æŒã—ã¾ã™ã€‚ãã‚Œãã‚Œã®`Converter`ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¤ãƒ‹ã‚·ãƒ£ãƒ©ã‚¤ã‚¶ã‚’æŒã¤ã“ã¨ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚ã“ã®è¨­å®šã«ã‚ˆã‚Šã€`CloudStorageUploadInteractor`ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒä½œæˆã•ã‚Œã‚‹ã¨ãã«å„`Converter`ã‚‚è‡ªå‹•çš„ã«åˆæœŸåŒ–ã•ã‚Œã€è¦æ±‚ã«å¯¾ã™ã‚‹å‡¦ç†ã«åˆ©ç”¨ã•ã‚Œã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/6/12 3:58:21*

InteractorProtocol ã®é–¢æ•°åã¯

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/6/12 3:58:53*

`InteractorProtocol`ã®é–¢æ•°åã‚’`uploadRequest(_ request: CloudStorageUploadRequest)`ã«å¤‰æ›´ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š

```swift
public protocol CloudStorageUploadInteractorProtocol {
    func uploadRequest(_ request: CloudStorageUploadRequest) async throws
}

public class CloudStorageUploadInteractor: CloudStorageUploadInteractorProtocol {
    private let cloudStorageManager: CloudStorageManagerProtocol
    private let anchorConverter: AnchorConverter
    private let emotionConverter: EmotionConverter
    private let interactionConverter: InteractionConverter

    public init(cloudStorageManager: CloudStorageManagerProtocol) {
        self.cloudStorageManager = cloudStorageManager
        self.anchorConverter = AnchorConverter()  // Assume AnchorConverter has default initializer.
        self.emotionConverter = EmotionConverter()  // Assume EmotionConverter has default initializer.
        self.interactionConverter = InteractionConverter()  // Assume InteractionConverter has default initializer.
    }

    public func uploadRequest(_ request: CloudStorageUploadRequest) async throws {
        switch request {
        case .anchor(let key, let data):
            let convertedData = try await anchorConverter.convertToData(data)
            try await cloudStorageManager.upload(key: key.path, data: convertedData)
        case .emotion(let key, let data):
            let convertedData = try await emotionConverter.convertToData(data)
            try await cloudStorageManager.upload(key: key.path, data: convertedData)
        case .interaction(let key, let data):
            let convertedData = try await interactionConverter.convertToData(data)
            try await cloudStorageManager.upload(key: key.path, data: convertedData)
        }
    }
}
```

ã“ã‚Œã«ã‚ˆã‚Šã€`CloudStorageUploadInteractor`ã¯`CloudStorageUploadInteractorProtocol`ã‚’å®Ÿè£…ã—ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã®åå‰ãŒ`uploadRequest(_:)`ã«ãªã‚Šã¾ã—ãŸã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/6/12 3:59:14*

upload(request: )ã«å¤‰æ›´ã—ã¦æ¬²ã—ã„ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/6/12 3:59:46*

ã”æŒ‡ç¤ºã«å¾“ã„ã€`InteractorProtocol`ã®é–¢æ•°åã‚’`upload(request: CloudStorageUploadRequest)`ã«å¤‰æ›´ã—ã¾ã™ï¼š

```swift
public protocol CloudStorageUploadInteractorProtocol {
    func upload(request: CloudStorageUploadRequest) async throws
}

public class CloudStorageUploadInteractor: CloudStorageUploadInteractorProtocol {
    private let cloudStorageManager: CloudStorageManagerProtocol
    private let anchorConverter: AnchorConverter
    private let emotionConverter: EmotionConverter
    private let interactionConverter: InteractionConverter

    public init(cloudStorageManager: CloudStorageManagerProtocol) {
        self.cloudStorageManager = cloudStorageManager
        self.anchorConverter = AnchorConverter()  // Assume AnchorConverter has default initializer.
        self.emotionConverter = EmotionConverter()  // Assume EmotionConverter has default initializer.
        self.interactionConverter = InteractionConverter()  // Assume InteractionConverter has default initializer.
    }

    public func upload(request: CloudStorageUploadRequest) async throws {
        switch request {
        case .anchor(let key, let data):
            let convertedData = try await anchorConverter.convertToData(data)
            try await cloudStorageManager.upload(key: key.path, data: convertedData)
        case .emotion(let key, let data):
            let convertedData = try await emotionConverter.convertToData(data)
            try await cloudStorageManager.upload(key: key.path, data: convertedData)
        case .interaction(let key, let data):
            let convertedData = try await interactionConverter.convertToData(data)
            try await cloudStorageManager.upload(key: key.path, data: convertedData)
        }
    }
}
```

ã“ã‚Œã«ã‚ˆã‚Šã€`CloudStorageUploadInteractor`ã¯`CloudStorageUploadInteractorProtocol`ã‚’å®Ÿè£…ã—ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã®åå‰ãŒ`upload(request:)`ã«ãªã‚Šã¾ã—ãŸã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/6/12 4:00:16*

private let anchorConverter = AnchorConverter() ã‚ˆã†ã«ç›´ã—ã¦ä»Šã®æ‰€ã®ã‚³ãƒ¼ãƒ‰ã‚’å…¨éƒ¨å‡ºåŠ›ã—ã¦æ¬²ã—ã„ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/6/12 4:01:17*

ä¸Šè¨˜ã®æŒ‡ç¤ºã«å¾“ã„ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ¬ãƒƒãƒˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’`AnchorConverter()`ã¨å®šç¾©ã—ã¦ã€å…¨ä½“ã®ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š

```swift
public protocol DataKey {
    var path: String { get }
}

public struct AnchorDataKey: DataKey {
    public let measurementId: String
    public let userId: String

    public var path: String {
        return "/raw/anchors/measurements/\(measurementId)/users/\(userId)"
    }
}

public struct EmotionDataKey: DataKey {
    public let measurementId: String
    public let userId: String

    public var path: String {
        return "/raw/emotions/measurements/\(measurementId)/users/\(userId)"
    }
}

public struct InteractionDataKey: DataKey {
    public let measurementId: String
    public let userId: String

    public var path: String {
        return "/raw/interactions/measurements/\(measurementId)/users/\(userId)"
    }
}

public enum CloudStorageUploadRequest {
    case anchor(key: AnchorDataKey, data: Any)
    case emotion(key: EmotionDataKey, data: Any)
    case interaction(key: InteractionDataKey, data: Any)
}

public protocol AnchorConverter {
    func convertToData(_ any: Any) async throws -> Data
}

public protocol EmotionConverter {
    func convertToData(_ any: Any) async throws -> Data
}

public protocol InteractionConverter {
    func convertToData(_ any: Any) async throws -> Data
}

public protocol CloudStorageManagerProtocol {
    func upload(key: String, data: Data) async throws
}

public protocol CloudStorageUploadInteractorProtocol {
    func upload(request: CloudStorageUploadRequest) async throws
}

public class CloudStorageUploadInteractor: CloudStorageUploadInteractorProtocol {
    private let cloudStorageManager: CloudStorageManagerProtocol
    private let anchorConverter: AnchorConverter = AnchorConverter()
    private let emotionConverter: EmotionConverter = EmotionConverter()
    private let interactionConverter: InteractionConverter = InteractionConverter()

    public init(cloudStorageManager: CloudStorageManagerProtocol) {
        self.cloudStorageManager = cloudStorageManager
    }

    public func upload(request: CloudStorageUploadRequest) async throws {
        switch request {
        case .anchor(let key, let data):
            let convertedData = try await anchorConverter.convertToData(data)
            try await cloudStorageManager.upload(key: key.path, data: convertedData)
        case .emotion(let key, let data):
            let convertedData = try await emotionConverter.convertToData(data)
            try await cloudStorageManager.upload(key: key.path, data: convertedData)
        case .interaction(let key, let data):
            let convertedData = try await interactionConverter.convertToData(data)
            try await cloudStorageManager.upload(key: key.path, data: convertedData)
        }
    }
}
```

ã“ã®è¨­å®šã§ã¯ã€å„`Converter`ã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ¬ãƒƒãƒˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦ç›´æ¥åˆæœŸåŒ–ã•ã‚Œã€`CloudStorageUploadInteractor`ã®åˆæœŸåŒ–æ™‚ã«ã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç”ŸæˆãŒè¡Œã‚ã‚Œã¾ã›ã‚“ã€‚ã“ã®çµæœã€`CloudStorageUploadInteractor`ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒä½œæˆã•ã‚ŒãŸã¨ãã«ã¯å„`Converter`ãŒã™ã§ã«åˆ©ç”¨å¯èƒ½ãªçŠ¶æ…‹ã«ãªã‚Šã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/6/12 4:02:10*

xxxDataKeyã®public initã‚’ã¤ãã£ã¦ã»ã—ã„ã®ã¨ã€ãã‚Œãã‚Œã®å¤‰æ•°ã¯å…¨éƒ¨privateã«ã—ã¦ã»ã—ã„ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/6/12 4:03:13*

`DataKey`ã‚’å®Ÿè£…ã™ã‚‹å„æ§‹é€ ä½“ã«å¯¾ã—ã¦`public init`ã‚’è¿½åŠ ã—ã€`measurementId`ã¨`userId`ã‚’ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã«å¤‰æ›´ã—ã¾ã™ã€‚ãã®çµæœã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š

```swift
public protocol DataKey {
    var path: String { get }
}

public struct AnchorDataKey: DataKey {
    private let measurementId: String
    private let userId: String

    public init(measurementId: String, userId: String) {
        self.measurementId = measurementId
        self.userId = userId
    }

    public var path: String {
        return "/raw/anchors/measurements/\(measurementId)/users/\(userId)"
    }
}

public struct EmotionDataKey: DataKey {
    private let measurementId: String
    private let userId: String

    public init(measurementId: String, userId: String) {
        self.measurementId = measurementId
        self.userId = userId
    }

    public var path: String {
        return "/raw/emotions/measurements/\(measurementId)/users/\(userId)"
    }
}

public struct InteractionDataKey: DataKey {
    private let measurementId: String
    private let userId: String

    public init(measurementId: String, userId: String) {
        self.measurementId = measurementId
        self.userId = userId
    }

    public var path: String {
        return "/raw/interactions/measurements/\(measurementId)/users/\(userId)"
    }
}

public enum CloudStorageUploadRequest {
    case anchor(key: AnchorDataKey, data: Any)
    case emotion(key: EmotionDataKey, data: Any)
    case interaction(key: InteractionDataKey, data: Any)
}

public protocol AnchorConverter {
    func convertToData(_ any: Any) async throws -> Data
}

public protocol EmotionConverter {
    func convertToData(_ any: Any) async throws -> Data
}

public protocol InteractionConverter {
    func convertToData(_ any: Any) async throws -> Data
}

public protocol CloudStorageManagerProtocol {
    func upload(key: String, data: Data) async throws
}

public protocol CloudStorageUploadInteractorProtocol {
    func upload(request: CloudStorageUploadRequest) async throws
}

public class CloudStorageUploadInteractor: CloudStorageUploadInteractorProtocol {
    private let cloudStorageManager: CloudStorageManagerProtocol
    private let anchorConverter: AnchorConverter = AnchorConverter()
    private let emotionConverter: EmotionConverter = EmotionConverter()
    private let interactionConverter: InteractionConverter = InteractionConverter()

    public init(cloudStorageManager: CloudStorageManagerProtocol) {
        self.cloudStorageManager = cloudStorageManager
    }

    public func upload(request: CloudStorageUploadRequest) async throws {
        switch request {
        case .anchor(let key, let data):
            let convertedData = try await anchorConverter.convertToData(data)
            try await cloudStorageManager.upload(key: key.path, data: convertedData)
        case .emotion(let key, let data):
            let convertedData = try await emotionConverter.convertToData(data)
            try await cloudStorageManager.upload(key: key.path, data: convertedData)
        case .interaction(let key, let data):
            let convertedData = try await interactionConverter.convertToData(data)
            try await cloudStorageManager.upload(key: key.path, data: convertedData)
        }
    }
}
```

ä»¥ä¸Šã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€`DataKey`ã®å®Ÿè£…ã¯ã‚¯ãƒ©ã‚¹å¤–éƒ¨ã‹ã‚‰ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ç›´æ¥

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/6/12 4:03:19*

ã¤ã¥ã

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/6/12 4:03:39*

ã‚¢ã‚¯ã‚»ã‚¹ã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚`measurementId`ã¨`userId`ã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãªã®ã§ã€ã“ã‚Œã‚‰ã®å€¤ã¯`AnchorDataKey`, `EmotionDataKey`, `InteractionDataKey`ã®ãã‚Œãã‚Œã®åˆæœŸåŒ–æ™‚ã«ã®ã¿è¨­å®šã™ã‚‹ã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã“ã‚Œã‚‰ã®å€¤ã¯èª­ã¿å–ã‚Šå°‚ç”¨ã¨ãªã‚Šã€å¤–éƒ¨ã‹ã‚‰å¤‰æ›´ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚

ãã—ã¦ã€ã“ã‚Œã‚‰ã®æ§‹é€ ä½“ã«ã¯å…¬é–‹åˆæœŸåŒ–å­ãŒè¿½åŠ ã•ã‚Œã€ã“ã‚Œã«ã‚ˆã‚Šã‚¯ãƒ©ã‚¹ã®å¤–éƒ¨ã‹ã‚‰ã§ã‚‚æ–°ãŸãªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã“ã®åˆæœŸåŒ–å­ã¯`measurementId`ã¨`userId`ã®ä¸¡æ–¹ã‚’å¼•æ•°ã«å–ã‚Šã€ã“ã‚Œã‚‰ã®å€¤ã‚’å†…éƒ¨çš„ã«è¨­å®šã—ã¾ã™ã€‚

---

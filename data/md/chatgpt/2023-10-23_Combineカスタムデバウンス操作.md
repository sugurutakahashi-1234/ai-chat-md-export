# Combineã‚«ã‚¹ã‚¿ãƒ ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ“ä½œ

æ—¥ä»˜: 2023-10-23

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/10/23 20:46:00*

swift ã® Combine ã« debounce ã‚„ throttle ãŒã‚ã‚‹ãŒä¸€å®šæ™‚é–“å‡ºåŠ›ãŒæ¥ã¦ã„ã‚Œã°ã€å»¶é•·ã—ã¦ã€ä¸€å®šæ™‚é–“å‡ºåŠ›ãŒã“ãªã‘ã‚Œã°å‡¦ç†ã‚’ã—ãŸã„å ´åˆã¯ã©ã†ã™ã‚Œã°ã„ã„ã‹ï¼Ÿ

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/10/23 20:46:41*

Swiftã®Combineãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã¯ã€`debounce`ã¨`throttle`ã®ã‚ˆã†ãªã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã€å‡ºåŠ›ã‚¤ãƒ™ãƒ³ãƒˆã®é…ä¿¡é »åº¦ã‚’åˆ¶å¾¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚`debounce`ã¯ç‰¹å®šã®æœŸé–“ä¸­ã«å—ã‘å–ã£ãŸè¤‡æ•°ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¸€ã¤ã«ã¾ã¨ã‚ã€ãã®æœŸé–“ã®çµ‚äº†æ™‚ã«æœ€æ–°ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚ä¸€æ–¹ã€`throttle`ã¯æŒ‡å®šã•ã‚ŒãŸæœŸé–“ä¸­ã«æœ€åˆã«å—ã‘å–ã£ãŸã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡ã—ã€ãã®å¾Œã®ã‚¤ãƒ™ãƒ³ãƒˆã¯ç„¡è¦–ã—ã¾ã™ã€‚

ã‚ãªãŸãŒè¿°ã¹ã¦ã„ã‚‹ã‚ˆã†ãªæŒ¯ã‚‹èˆã„ã€ã¤ã¾ã‚Šã€Œä¸€å®šæ™‚é–“å‡ºåŠ›ãŒç¶šã„ã¦ã„ã‚Œã°ãã®æœŸé–“ã‚’å»¶é•·ã—ã€ä¸€å®šæ™‚é–“å‡ºåŠ›ãŒãªã‘ã‚Œã°å‡¦ç†ã‚’è¡Œã„ãŸã„ã€ã¨ã„ã†ã‚‚ã®ã¯ã€ã“ã‚Œã‚‰ã®ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ã ã‘ã§ã¯å®Œå…¨ã«ã¯å®Ÿç¾ã§ãã¾ã›ã‚“ã€‚ã—ã‹ã—ã€ã‚«ã‚¹ã‚¿ãƒ ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ä½œæˆã™ã‚‹ã“ã¨ã§ã€ã“ã®ã‚ˆã†ãªå‹•ä½œã‚’å®Ÿç¾ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

ä»¥ä¸‹ã«ã€ã“ã®æŒ¯ã‚‹èˆã„ã‚’æ¨¡å€£ã™ã‚‹ãŸã‚ã®ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰ã‚’ç¤ºã—ã¾ã™ã€‚å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚„ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆã‚¤ãƒ™ãƒ³ãƒˆã®å‡¦ç†ãªã©ã€ã‚ˆã‚Šå¤šãã®è€ƒæ…®ãŒå¿…è¦ã«ãªã‚Šã¾ã™ãŒã€åŸºæœ¬çš„ãªã‚¢ã‚¤ãƒ‡ã‚¢ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

```swift
import Combine
import Foundation

extension Publisher {
    
    func extendableDebounce(for dueTime: DispatchQueue.SchedulerTimeType.Stride, scheduler: DispatchQueue) -> AnyPublisher<Output, Failure> {
        let subject = PassthroughSubject<Output, Failure>()
        var lastValue: Output? = nil
        var debounceWorkItem: DispatchWorkItem?
        
        return self
            .handleEvents(receiveOutput: { value in
                // ã‚­ãƒ£ãƒ³ã‚»ãƒ«å‰ã®ä½œæ¥­é …ç›®ãŒã‚ã‚Œã°ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                debounceWorkItem?.cancel()
                
                // æ–°ã—ã„ä½œæ¥­é …ç›®ã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
                debounceWorkItem = DispatchWorkItem {
                    if let lastValue = lastValue {
                        subject.send(lastValue)
                    }
                    lastValue = nil
                }
                lastValue = value
                scheduler.schedule(after: scheduler.now.advanced(by: dueTime), execute: debounceWorkItem!)
            }, receiveCompletion: { completion in
                // å®Œäº†ã‚¤ãƒ™ãƒ³ãƒˆã§æ®‹ã‚Šã®ä½œæ¥­ã‚’å‡¦ç†
                debounceWorkItem?.perform()
                subject.send(completion: completion)
            })
            .flatMap { _ in Empty<Output, Failure>() } // å…ƒã®ã‚¤ãƒ™ãƒ³ãƒˆã¯ç„¡è¦–
            .merge(with: subject) // æ–°ã—ã„subjectã‹ã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒãƒ¼ã‚¸
            .eraseToAnyPublisher()
    }
}
```

ã“ã®ã‚«ã‚¹ã‚¿ãƒ ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ã¯ã€æ–°ã—ã„å€¤ãŒæ¥ã‚‹ãŸã³ã«ãƒ‡ãƒã‚¦ãƒ³ã‚¹ã‚¿ã‚¤ãƒãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã€‚ä¸€å®šæ™‚é–“æ–°ã—ã„å€¤ãŒã“ãªã‘ã‚Œã°ã€æœ€å¾Œã®å€¤ã‚’é€ä¿¡ã—ã¾ã™ã€‚

ã“ã‚Œã¯ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰ã§ã‚ã‚Šã€å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«é©ç”¨ã™ã‚‹å‰ã«é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚„è³¼èª­ã®è§£é™¤ã€ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã®è€ƒæ…®ãªã©ã‚’å«ã‚ãŸååˆ†ãªãƒ†ã‚¹ãƒˆãŒå¿…è¦ã§ã™ã€‚ã¾ãŸã€ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ä¸»ã«ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã‚­ãƒ¥ãƒ¼ã¨ã®ç›¸äº’é‹ç”¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ãŒã€ä»–ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ã§ã®ä½¿ç”¨ã«ã¯é©å¿œãŒå¿…è¦ã§ã™ã€‚

---

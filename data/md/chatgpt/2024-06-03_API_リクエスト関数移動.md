# API „É™„ÇØ„Ç®„Çπ„ÉàÈñ¢Êï∞ÁßªÂãï

Êó•‰ªò: 2024-06-03

---

## üë§ „É¶„Éº„Ç∂„Éº
*2024/6/3 15:18:25*

View„Å´Ë®òËø∞„Åó„Å¶„ÅÑ„ÇãÈñ¢Êï∞„ÇíPresenter„Å´ÁßªË°å„Åó„Å¶„Åª„Åó„ÅÑ„ÄÇÈñ¢Êï∞Âêç„ÅØÂêå„Åò„Å´„Åó„Å¶„Åª„Åó„ÅÑ

final class APIRequestPresenter: ObservableObject {
    @Published var selectedApi: APIType = .getUsers

    @Published var getUsersResponse: [Components.Schemas.User] = []
    @Published var getUserByIdResponse: [Components.Schemas.User] = []
    @Published var allResponse: [AllResponse] = []

    @Published var userId: Int = 1

    @Published var showToast: Bool = false
    @Published var isLoading: Bool = false
    @Published var showAlert: Bool = false
    @Published var apiError: APIError?

    private let jsonHandleDriver: JSONHandleDriver = JSONHandleDriver()
    private let client: Client = Client(
        serverURL: try! Servers.server1(),
        transport: URLSessionTransport()
    )

    init() {}
}

@MainActor
public struct APIRequestView: View {
        @StateObject private var presenter: APIRequestPresenter
    
        init() {
            _presenter = .init(wrappedValue: .init())
        }
    
    @State var selectedApi: APIType = .getUsers

    @State var getUsersResponse: [Components.Schemas.User] = []
    @State var getUserByIdResponse: [Components.Schemas.User] = []
    @State var allResponse: [AllResponse] = []

    @State var userId: Int = 1

    @State var showToast: Bool = false
    @State var isLoading: Bool = false
    @State var showAlert: Bool = false
    @State var apiError: APIError?

    let client: Client

    public init() {
        client = Client(
            serverURL: try! Servers.server1(),
            transport: URLSessionTransport()
        )
    }

    public var body: some View {
        List {
            Section("Request") {
                HStack {
                    Picker(selection: $selectedApi) {
                        ForEach(APIType.allCases, id: \.self) { apiType in
                            Text("\(apiType)")
                        }
                    } label: {
                        Text("API")
                    }
                    .pickerStyle(.menu)

                    Spacer()
                }

                Group {
                    switch selectedApi {
                    case .getUsers:
                        EmptyView()
                    case .getUser:
                        VStack(alignment: .leading) {
                            Text("User id")
                                .font(.subheadline)
                            TextField("1", value: $userId, format: .number)
                                .textFieldStyle(.roundedBorder)
                                .keyboardType(.numberPad)
                        }
                    case .all:
                        EmptyView()
                    }
                }

                Button {
                    Task {
                        await onTapPlay()
                    }
                } label: {
                    Text("Request")
                }
            }
            .textCase(.none)
            .listRowSeparator(.hidden)

            Section("Response") {
                Group {
                    switch selectedApi {
                    case .getUsers:
                        ResponseView(objects: getUsersResponse)
                    case .getUser:
                        ResponseView(objects: getUserByIdResponse)
                    case .all:
                        ResponseView(objects: allResponse)
                    }
                }
                .redacted(reason: isLoading ? .placeholder : [])
                .shimmering(active: isLoading)
            }
            .textCase(.none)

            Group {
                switch selectedApi {
                case .all:
                    PropertyView(showToast: $showToast, objects: allResponse)
                case .getUsers:
                    PropertyView(showToast: $showToast, objects: getUsersResponse)
                case .getUser:
                    PropertyView(showToast: $showToast, objects: getUserByIdResponse)
                }
            }
            .redacted(reason: isLoading ? .placeholder : [])
            .shimmering(active: isLoading)
        }
        .scrollDismissesKeyboard(.immediately)
        .simpleToast(isPresented: $showToast, options: SimpleToastOptions(alignment: .bottom, hideAfter: 1), content: {
            Label {
                Text("Copy")
            } icon: {
                SFSymbols.checkmarkCircle.image
            }
            .padding()
            .background(Color.green.opacity(0.8))
            .foregroundColor(Color.white)
            .cornerRadius(12)
            .padding(.top)
        })
        .toolbar {
            ToolbarItem(placement: .topBarTrailing) {
                Button {
                    onTapCleaner()
                } label: {
                    SFSymbols.wandAndStars.image
                }
            }
        }
        .navigationTitle("API Request")
        .alert(isPresented: $showAlert, error: apiError) {
            Button("OK") {}
        }
    }

    func onTapCleaner() {
        getUsersResponse = []
        getUserByIdResponse = []
        allResponse = []

        userId = 1
    }

    func onTapPlay() async {
        switch selectedApi {
        case .all:
            await getUsers()
            await getUserById(id: userId)

            allResponse = [.init(getUsers: getUsersResponse, getUserById: getUserByIdResponse)]
        case .getUsers:
            await getUsers()
        case .getUser:
            await getUserById(id: userId)
        }
    }

    private func getUsers() async {
        getUsersResponse = []
        isLoading = true
        defer {
            isLoading = false
        }

        do {
            let response = try await client.getUsers()

            switch response {
            case .ok(let okResponse):
                switch okResponse.body {
                case .json(let users):
                    getUsersResponse = users
                }
            case .notFound(let notFoundResponse):
                switch notFoundResponse.body {
                case .json(let error):
                    print("\(error)")
                    apiError = .notFound
                    showAlert = true
                }
            case .undocumented(statusCode: let statusCode, _):
                print("\(statusCode)")
                apiError = .undocumented
                showAlert = true
            }
        } catch {
            print("\(error)")
            apiError = .unexpected
            showAlert = true
        }
    }

    private func getUserById(id: Int) async {
        getUserByIdResponse = []
        isLoading = true
        defer {
            isLoading = false
        }

        do {
            let response = try await client.getUserById(path: .init(id: id))

            switch response {
            case .ok(let okResponse):
                switch okResponse.body {
                case .json(let user):
                    getUserByIdResponse = [user]
                }
            case .notFound(let notFoundResponse):
                switch notFoundResponse.body {
                case .json(let error):
                    print("\(error)")
                    apiError = .notFound
                    showAlert = true
                }
            case .undocumented(statusCode: let statusCode, _):
                print("\(statusCode)")
                apiError = .undocumented
                showAlert = true
            }
        } catch {
            print("\(error)")
            apiError = .unexpected
            showAlert = true
        }
    }
}

// MARK: - Sample Entity

// TODO: Entity „Å´Âêà„Çè„Åõ„Å¶ÂâäÈô§„Åô„Çã

enum APIType: CaseIterable {
    case all
    case getUsers
    case getUser
}

enum APIError: LocalizedError {
    case notFound
    case undocumented
    case unexpected

    /// alert title
    var errorDescription: String? {
        "\(self)"
    }
}

struct AllResponse: Codable {
    let getUsers: [Components.Schemas.User]
    let getUserById: [Components.Schemas.User]
}

enum CityType: Codable {
    case urban
    case rural
}

struct Address: Codable {
    var city: [String]
    var postalCode: [Int]
    var cityType: CityType
}

struct Person: Codable {
    var name: String
    var age: Int
    var isEmployed: Bool
    var address: [Address]
}

struct Persons: Codable {
    var persons: [Person]
}

// MARK: - Preview

#Preview {
    APIRequestView()
        .navigationStacked()
}

---

## ü§ñ „Ç¢„Ç∑„Çπ„Çø„É≥„Éà
*2024/6/3 15:19:15*

User wants to move functions from View to Presenter while keeping the function names the same.

---

## üîß „ÉÑ„Éº„É´
*2024/6/3 15:19:15*

Model set context updated.

---

## ü§ñ „Ç¢„Ç∑„Çπ„Çø„É≥„Éà
*2024/6/3 15:19:15*

Here's the refactored code with the functions moved from `APIRequestView` to `APIRequestPresenter`. The function names remain the same:

```swift
final class APIRequestPresenter: ObservableObject {
    @Published var selectedApi: APIType = .getUsers

    @Published var getUsersResponse: [Components.Schemas.User] = []
    @Published var getUserByIdResponse: [Components.Schemas.User] = []
    @Published var allResponse: [AllResponse] = []

    @Published var userId: Int = 1

    @Published var showToast: Bool = false
    @Published var isLoading: Bool = false
    @Published var showAlert: Bool = false
    @Published var apiError: APIError?

    private let jsonHandleDriver: JSONHandleDriver = JSONHandleDriver()
    private let client: Client = Client(
        serverURL: try! Servers.server1(),
        transport: URLSessionTransport()
    )

    init() {}

    func onTapCleaner() {
        getUsersResponse = []
        getUserByIdResponse = []
        allResponse = []

        userId = 1
    }

    func onTapPlay() async {
        switch selectedApi {
        case .all:
            await getUsers()
            await getUserById(id: userId)

            allResponse = [.init(getUsers: getUsersResponse, getUserById: getUserByIdResponse)]
        case .getUsers:
            await getUsers()
        case .getUser:
            await getUserById(id: userId)
        }
    }

    private func getUsers() async {
        getUsersResponse = []
        isLoading = true
        defer {
            isLoading = false
        }

        do {
            let response = try await client.getUsers()

            switch response {
            case .ok(let okResponse):
                switch okResponse.body {
                case .json(let users):
                    getUsersResponse = users
                }
            case .notFound(let notFoundResponse):
                switch notFoundResponse.body {
                case .json(let error):
                    print("\(error)")
                    apiError = .notFound
                    showAlert = true
                }
            case .undocumented(statusCode: let statusCode, _):
                print("\(statusCode)")
                apiError = .undocumented
                showAlert = true
            }
        } catch {
            print("\(error)")
            apiError = .unexpected
            showAlert = true
        }
    }

    private func getUserById(id: Int) async {
        getUserByIdResponse = []
        isLoading = true
        defer {
            isLoading = false
        }

        do {
            let response = try await client.getUserById(path: .init(id: id))

            switch response {
            case .ok(let okResponse):
                switch okResponse.body {
                case .json(let user):
                    getUserByIdResponse = [user]
                }
            case .notFound(let notFoundResponse):
                switch notFoundResponse.body {
                case .json(let error):
                    print("\(error)")
                    apiError = .notFound
                    showAlert = true
                }
            case .undocumented(statusCode: let statusCode, _):
                print("\(statusCode)")
                apiError = .undocumented
                showAlert = true
            }
        } catch {
            print("\(error)")
            apiError = .unexpected
            showAlert = true
        }
    }
}

@MainActor
public struct APIRequestView: View {
    @StateObject private var presenter: APIRequestPresenter

    init() {
        _presenter = .init(wrappedValue: .init())
    }

    public var body: some View {
        List {
            Section("Request") {
                HStack {
                    Picker(selection: $presenter.selectedApi) {
                        ForEach(APIType.allCases, id: \.self) { apiType in
                            Text("\(apiType)")
                        }
                    } label: {
                        Text("API")
                    }
                    .pickerStyle(.menu)

                    Spacer()
                }

                Group {
                    switch presenter.selectedApi {
                    case .getUsers:
                        EmptyView()
                    case .getUser:
                        VStack(alignment: .leading) {
                            Text("User id")
                                .font(.subheadline)
                            TextField("1", value: $presenter.userId, format: .number)
                                .textFieldStyle(.roundedBorder)
                                .keyboardType(.numberPad)
                        }
                    case .all:
                        EmptyView()
                    }
                }

                Button {
                    Task {
                        await presenter.onTapPlay()
                    }
                } label: {
                    Text("Request")
                }
            }
            .textCase(.none)
            .listRowSeparator(.hidden)

            Section("Response") {
                Group {
                    switch presenter.selectedApi {
                    case .getUsers:
                        ResponseView(objects: presenter.getUsersResponse)
                    case .getUser:
                        ResponseView(objects: presenter.getUserByIdResponse)
                    case .all:
                        ResponseView(objects: presenter.allResponse)
                    }
                }
                .redacted(reason: presenter.isLoading ? .placeholder : [])
                .shimmering(active: presenter.isLoading)
            }
            .textCase(.none)

            Group {
                switch presenter.selectedApi {
                case .all:
                    PropertyView(showToast: $presenter.showToast, objects: presenter.allResponse)
                case .getUsers:
                    PropertyView(showToast: $presenter.showToast, objects: presenter.getUsersResponse)
                case .getUser:
                    PropertyView(showToast: $presenter.showToast, objects: presenter.getUserByIdResponse)
                }
            }
            .redacted(reason: presenter.isLoading ? .placeholder : [])
            .shimmering(active: presenter.isLoading)
        }
        .scrollDismissesKeyboard(.immediately)
        .simpleToast(isPresented: $presenter.showToast, options: SimpleToastOptions(alignment: .bottom, hideAfter: 1), content: {
            Label {
                Text("Copy")
            } icon: {
                SFSymbols.checkmarkCircle.image
            }
            .padding()
            .background(Color.green.opacity(0.8))
            .foregroundColor(Color.white)
            .cornerRadius(12)
            .padding(.top)
        })
        .toolbar {
            ToolbarItem(placement: .topBarTrailing) {
                Button {
                    presenter.onTapCleaner()
                } label: {
                    SFSymbols.wandAndStars.image
                }
            }
        }
        .navigationTitle("API Request")
        .alert(isPresented: $presenter.showAlert, error: presenter.apiError) {
            Button("OK") {}
        }
    }
}

// MARK: - Sample Entity

// TODO: Entity „Å´Âêà„Çè„Åõ„Å¶ÂâäÈô§„Åô„Çã

enum APIType: CaseIterable {
    case all
    case getUsers
    case getUser
}

enum APIError: LocalizedError {
    case notFound
    case undocumented
    case unexpected

    /// alert title
    var errorDescription: String? {
        "\(self)"
    }
}

struct AllResponse: Codable {
    let getUsers: [Components.Schemas.User]
    let getUserById: [Components.Schemas.User]
}

enum CityType: Codable {
    case urban
    case rural
}

struct Address: Codable {
    var city: [String]
    var postalCode: [Int]
    var cityType: CityType
}

struct Person: Codable {
    var name: String
    var age: Int
    var isEmployed: Bool
    var address: [Address]
}

struct Persons: Codable {
    var persons: [Person]
}

// MARK: - Preview

#Preview {
    APIRequestView()
        .navigationStacked()
}
```

In this refactored code, the functions `onTapCleaner`, `onTapPlay`, `getUsers`, and `getUserById` are moved from `APIRequestView` to `APIRequestPresenter`. The `APIRequestView` now uses the presenter to handle these functions.

---

## üë§ „É¶„Éº„Ç∂„Éº
*2024/6/3 15:40:19*

ResponseView „Åß JSONHandleDriver „Çí‰Ωø„Çè„Å™„ÅÑ„Çà„ÅÜ„Å´„Åó„Åü„ÅÑ

struct ResponseView&lt;T: Encodable&gt;: View {
    @State var showToast: Bool = false
    let objects: [T]

    public var body: some View {
        NavigationLink {
            ScrollView {
                VStack(alignment: .leading) {
                    SelectableTextView(text: "\(try! JSONHandleDriver.encodeToJSONString(objects: objects))")
                }
                .padding()
            }
            .navigationTitle("Response")
            .toolbar {
                ToolbarItem(placement: .topBarTrailing) {
                    Button {
                        onTapElement(object: objects)
                    } label: {
                        SFSymbols.docOnDoc.image
                    }
                }
            }
            .simpleToast(isPresented: $showToast, options: SimpleToastOptions(alignment: .bottom, hideAfter: 1), content: {
                Label {
                    Text("Copy")
                } icon: {
                    SFSymbols.checkmarkCircle.image
                }
                .padding()
                .background(Color.green.opacity(0.8))
                .foregroundColor(Color.white)
                .cornerRadius(12)
                .padding(.top)
            })
        } label: {
            Text("Response")
        }
        .isHidden(objects.isEmpty)
    }

    func onTapElement(object: some Encodable) {
        UIPasteboard.general.string = {
            do {
                return try JSONHandleDriver.encodeToJSONString(object: object)
            } catch {
                return "\(object)"
            }
        }()

        showToast = true
    }
}

#Preview {
    NavigationStack {
        List {
            ResponseView(objects: [Person(name: "John Doe", age: 30, isEmployed: true, address: [
                Address(city: ["New Yor„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇ„ÅÇk", "„Éà„Éº„Ç≠„Éß„Éº"], postalCode: [10001, 10002], cityType: .urban),
                Address(city: ["New York", "„Éà„Éº„Ç≠„Éß„Éº"], postalCode: [10001, 10002], cityType: .urban),
            ])])
        }
    }
}

class JSONHandleDriver {
    func encodeToJSONString(anyObject: Any) throws -&gt; String {
        guard let encodableObject = anyObject as? (any Encodable) else {
            OSLogger.debugLog("JSON Encode Error")
            throw AppError.customError("JSON Encode Error")
        }

        let encoder = JSONEncoder()
        encoder.outputFormatting = .prettyPrinted

        let data = try encoder.encode(encodableObject)

        guard let jsonString = String(data: data, encoding: .utf8) else {
            OSLogger.debugLog("JSON Encode Error")
            throw AppError.customError("JSON Encode Error")
        }

        return jsonString
    }

    func encodeToJSONString(object: some Encodable) throws -&gt; String {
        let encoder = JSONEncoder()
        encoder.outputFormatting = .prettyPrinted

        let data = try encoder.encode(object)

        guard let jsonString = String(data: data, encoding: .utf8) else {
            OSLogger.debugLog("JSON Encode Error")
            throw AppError.customError("JSON Encode Error")
        }

        return jsonString
    }

    func encodeToJSONString(objects: [some Encodable]) throws -&gt; String {
        let encoder = JSONEncoder()
        encoder.outputFormatting = .prettyPrinted

        let data = try encoder.encode(objects)
        guard let jsonString = String(data: data, encoding: .utf8) else {
            OSLogger.debugLog("JSON Encode Error")
            throw AppError.customError("JSON Encode Error")
        }

        return jsonString
    }
}

---

## ü§ñ „Ç¢„Ç∑„Çπ„Çø„É≥„Éà
*2024/6/3 15:40:48*

To remove the dependency on `JSONHandleDriver` in `ResponseView`, we can use the `JSONEncoder` directly within the `ResponseView` struct. Here's how you can modify the `ResponseView`:

```swift
struct ResponseView<T: Encodable>: View {
    @State var showToast: Bool = false
    let objects: [T]

    public var body: some View {
        NavigationLink {
            ScrollView {
                VStack(alignment: .leading) {
                    SelectableTextView(text: "\(encodeToJSONString(objects: objects))")
                }
                .padding()
            }
            .navigationTitle("Response")
            .toolbar {
                ToolbarItem(placement: .topBarTrailing) {
                    Button {
                        onTapElement(object: objects)
                    } label: {
                        SFSymbols.docOnDoc.image
                    }
                }
            }
            .simpleToast(isPresented: $showToast, options: SimpleToastOptions(alignment: .bottom, hideAfter: 1), content: {
                Label {
                    Text("Copy")
                } icon: {
                    SFSymbols.checkmarkCircle.image
                }
                .padding()
                .background(Color.green.opacity(0.8))
                .foregroundColor(Color.white)
                .cornerRadius(12)
                .padding(.top)
            })
        } label: {
            Text("Response")
        }
        .isHidden(objects.isEmpty)
    }

    func onTapElement(object: some Encodable) {
        UIPasteboard.general.string = {
            do {
                return try encodeToJSONString(object: object)
            } catch {
                return "\(object)"
            }
        }()

        showToast = true
    }

    private func encodeToJSONString(object: some Encodable) throws -> String {
        let encoder = JSONEncoder()
        encoder.outputFormatting = .prettyPrinted

        let data = try encoder.encode(object)

        guard let jsonString = String(data: data, encoding: .utf8) else {
            throw AppError.customError("JSON Encode Error")
        }

        return jsonString
    }

    private func encodeToJSONString(objects: [some Encodable]) -> String {
        let encoder = JSONEncoder()
        encoder.outputFormatting = .prettyPrinted

        do {
            let data = try encoder.encode(objects)
            if let jsonString = String(data: data, encoding: .utf8) {
                return jsonString
            }
        } catch {
            print("JSON Encode Error: \(error)")
        }
        return "[]"
    }
}

#Preview {
    NavigationStack {
        List {
            ResponseView(objects: [Person(name: "John Doe", age: 30, isEmployed: true, address: [
                Address(city: ["New York", "„Éà„Éº„Ç≠„Éß„Éº"], postalCode: [10001, 10002], cityType: .urban),
                Address(city: ["New York", "„Éà„Éº„Ç≠„Éß„Éº"], postalCode: [10001, 10002], cityType: .urban),
            ])])
        }
    }
}

// Define required types for the preview to work
enum CityType: Codable {
    case urban
    case rural
}

struct Address: Codable {
    var city: [String]
    var postalCode: [Int]
    var cityType: CityType
}

struct Person: Codable {
    var name: String
    var age: Int
    var isEmployed: Bool
    var address: [Address]
}

// Define your custom error type
enum AppError: Error {
    case customError(String)
}
```

In this modified code:

- The `JSONHandleDriver` is removed.
- The `encodeToJSONString` functions are implemented directly within the `ResponseView`.
- These functions handle encoding objects and arrays of objects to JSON strings.

This approach keeps the functionality intact while removing the dependency on `JSONHandleDriver`.

---

## üë§ „É¶„Éº„Ç∂„Éº
*2024/6/3 15:41:27*

„Åù„ÅÜ„ÅÑ„ÅÜ„Çè„Åë„Åß„ÅØ„Å™„Åè„Å¶„ÄÅAPIRequestView „Å® APIRequestPresenter ÂÅ¥„ÅßÂá¶ÁêÜ„Çí„Åó„ÅüÊñπ„Åå„ÅÑ„ÅÑ„Å®ÊÄù„Å£„Åü„Çì„Å†„ÄÇ„Å§„Åæ„Çä„ÄÅResponseView„ÅÆÂºïÊï∞„Å®„Åó„Å¶Ê∏°„Åõ„Å∞„ÅÑ„ÅÑ„Å®ÊÄù„Å£„Åü

---

## ü§ñ „Ç¢„Ç∑„Çπ„Çø„É≥„Éà
*2024/6/3 15:42:38*

„Å™„Çã„Åª„Å©„ÄÅ`ResponseView` „Åß„ÅÆ JSON „Ç®„É≥„Ç≥„Éº„ÉâÂá¶ÁêÜ„Çí `APIRequestView` „Åæ„Åü„ÅØ `APIRequestPresenter` ÂÅ¥„ÅßË°å„ÅÑ„ÄÅ`ResponseView` „Å´„ÅØ„Ç®„É≥„Ç≥„Éº„Éâ„Åï„Çå„Åü JSON ÊñáÂ≠óÂàó„ÇíÊ∏°„ÅôÂΩ¢„Å´Â§âÊõ¥„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ

„Åæ„Åö„ÄÅ`APIRequestPresenter` „Å´ JSON „Ç®„É≥„Ç≥„Éº„ÉâÂá¶ÁêÜ„ÇíËøΩÂä†„Åó„ÄÅ„Åù„ÅÆÁµêÊûú„Çí `APIRequestView` „Åã„Çâ `ResponseView` „Å´Ê∏°„Åó„Åæ„Åô„ÄÇ

‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å´„Ç≥„Éº„Éâ„Çí‰øÆÊ≠£„Åó„Åæ„ÅôÔºö

### APIRequestPresenter

```swift
final class APIRequestPresenter: ObservableObject {
    @Published var selectedApi: APIType = .getUsers

    @Published var getUsersResponse: [Components.Schemas.User] = []
    @Published var getUserByIdResponse: [Components.Schemas.User] = []
    @Published var allResponse: [AllResponse] = []

    @Published var userId: Int = 1

    @Published var showToast: Bool = false
    @Published var isLoading: Bool = false
    @Published var showAlert: Bool = false
    @Published var apiError: APIError?

    private let client: Client = Client(
        serverURL: try! Servers.server1(),
        transport: URLSessionTransport()
    )

    init() {}

    func onTapCleaner() {
        getUsersResponse = []
        getUserByIdResponse = []
        allResponse = []

        userId = 1
    }

    func onTapPlay() async {
        switch selectedApi {
        case .all:
            await getUsers()
            await getUserById(id: userId)

            allResponse = [.init(getUsers: getUsersResponse, getUserById: getUserByIdResponse)]
        case .getUsers:
            await getUsers()
        case .getUser:
            await getUserById(id: userId)
        }
    }

    private func getUsers() async {
        getUsersResponse = []
        isLoading = true
        defer {
            isLoading = false
        }

        do {
            let response = try await client.getUsers()

            switch response {
            case .ok(let okResponse):
                switch okResponse.body {
                case .json(let users):
                    getUsersResponse = users
                }
            case .notFound(let notFoundResponse):
                switch notFoundResponse.body {
                case .json(let error):
                    print("\(error)")
                    apiError = .notFound
                    showAlert = true
                }
            case .undocumented(statusCode: let statusCode, _):
                print("\(statusCode)")
                apiError = .undocumented
                showAlert = true
            }
        } catch {
            print("\(error)")
            apiError = .unexpected
            showAlert = true
        }
    }

    private func getUserById(id: Int) async {
        getUserByIdResponse = []
        isLoading = true
        defer {
            isLoading = false
        }

        do {
            let response = try await client.getUserById(path: .init(id: id))

            switch response {
            case .ok(let okResponse):
                switch okResponse.body {
                case .json(let user):
                    getUserByIdResponse = [user]
                }
            case .notFound(let notFoundResponse):
                switch notFoundResponse.body {
                case .json(let error):
                    print("\(error)")
                    apiError = .notFound
                    showAlert = true
                }
            case .undocumented(statusCode: let statusCode, _):
                print("\(statusCode)")
                apiError = .undocumented
                showAlert = true
            }
        } catch {
            print("\(error)")
            apiError = .unexpected
            showAlert = true
        }
    }

    func encodeToJSONString<T: Encodable>(objects: [T]) -> String {
        let encoder = JSONEncoder()
        encoder.outputFormatting = .prettyPrinted

        do {
            let data = try encoder.encode(objects)
            if let jsonString = String(data: data, encoding: .utf8) {
                return jsonString
            }
        } catch {
            print("JSON Encode Error: \(error)")
        }
        return "[]"
    }
}
```

### APIRequestView

```swift
@MainActor
public struct APIRequestView: View {
    @StateObject private var presenter: APIRequestPresenter

    init() {
        _presenter = .init(wrappedValue: .init())
    }

    public var body: some View {
        List {
            Section("Request") {
                HStack {
                    Picker(selection: $presenter.selectedApi) {
                        ForEach(APIType.allCases, id: \.self) { apiType in
                            Text("\(apiType)")
                        }
                    } label: {
                        Text("API")
                    }
                    .pickerStyle(.menu)

                    Spacer()
                }

                Group {
                    switch presenter.selectedApi {
                    case .getUsers:
                        EmptyView()
                    case .getUser:
                        VStack(alignment: .leading) {
                            Text("User id")
                                .font(.subheadline)
                            TextField("1", value: $presenter.userId, format: .number)
                                .textFieldStyle(.roundedBorder)
                                .keyboardType(.numberPad)
                        }
                    case .all:
                        EmptyView()
                    }
                }

                Button {
                    Task {
                        await presenter.onTapPlay()
                    }
                } label: {
                    Text("Request")
                }
            }
            .textCase(.none)
            .listRowSeparator(.hidden)

            Section("Response") {
                Group {
                    switch presenter.selectedApi {
                    case .getUsers:
                        ResponseView(jsonString: presenter.encodeToJSONString(objects: presenter.getUsersResponse))
                    case .getUser:
                        ResponseView(jsonString: presenter.encodeToJSONString(objects: presenter.getUserByIdResponse))
                    case .all:
                        ResponseView(jsonString: presenter.encodeToJSONString(objects: presenter.allResponse))
                    }
                }
                .redacted(reason: presenter.isLoading ? .placeholder : [])
                .shimmering(active: presenter.isLoading)
            }
            .textCase(.none)

            Group {
                switch presenter.selectedApi {
                case .all:
                    PropertyView(showToast: $presenter.showToast, objects: presenter.allResponse)
                case .getUsers:
                    PropertyView(showToast: $presenter.showToast, objects: presenter.getUsersResponse)
                case .getUser:
                    PropertyView(showToast: $presenter.showToast, objects: presenter.getUserByIdResponse)
                }
            }
            .redacted(reason: presenter.isLoading ? .placeholder : [])
            .shimmering(active: presenter.isLoading)
        }
        .scrollDismissesKeyboard(.immediately)
        .simpleToast(isPresented: $presenter.showToast, options: SimpleToastOptions(alignment: .bottom, hideAfter: 1), content: {
            Label {
                Text("Copy")
            } icon: {
                SFSymbols.checkmarkCircle.image
            }
            .padding()
            .background(Color.green.opacity(0.8))
            .foregroundColor(Color.white)
            .cornerRadius(12)
            .padding(.top)
        })
        .toolbar {
            ToolbarItem(placement: .topBarTrailing) {
                Button {
                    presenter.onTapCleaner()
                } label: {
                    SFSymbols.wandAndStars.image
                }
            }
        }
        .navigationTitle("API Request")
        .alert(isPresented: $presenter.showAlert, error: presenter.apiError) {
            Button("OK") {}
        }
    }
}

// Define required types for the preview to work
enum CityType: Codable {
    case urban
    case rural
}

struct Address: Codable {
    var city: [String]
    var postalCode: [Int]
    var cityType: CityType
}

struct Person: Codable {
    var name: String
    var age: Int
    var isEmployed: Bool
    var address: [Address]
}

enum APIType: CaseIterable {
    case all
    case getUsers
    case getUser
}

enum APIError: LocalizedError {
    case notFound
    case undocumented
    case unexpected

    /// alert title
    var errorDescription: String? {
        "\(self)"
    }
}

struct AllResponse: Codable {
    let getUsers: [Components.Schemas.User]
    let getUserById: [Components.Schemas.User]
}

// Define your custom error type
enum AppError: Error {
    case customError(String)
}
```

### ResponseView

```swift
struct ResponseView: View {
    @State var showToast: Bool = false
    let jsonString: String

    public var body: some View {
        NavigationLink {
            ScrollView {
                VStack(alignment: .leading) {
                    SelectableTextView(text: jsonString)
                }
                .padding()
            }
            .navigationTitle("Response")
            .toolbar {
                ToolbarItem(placement: .topBarTrailing) {
                    Button {
                        onTapElement(jsonString: jsonString)
                    } label: {
                        SFSymbols.docOnDoc.image
                    }
                }
            }
            .simpleToast(isPresented: $showToast, options: SimpleToastOptions(alignment: .bottom, hideAfter: 1), content: {
                Label {
                    Text("Copy")
                } icon: {
                    SFSymbols.checkmarkCircle.image
                }
                .padding()
                .background(Color.green.opacity(0.8))
                .foregroundColor(Color.white)
                .cornerRadius(12)
                .padding(.top)
            })
        } label: {
            Text("Response")
        }
        .isHidden(jsonString.isEmpty)
    }

    func onTapElement(jsonString: String

---

## ü§ñ „Ç¢„Ç∑„Çπ„Çø„É≥„Éà
*2024/6/3 15:42:50*

) {
        UIPasteboard.general.string = jsonString
        showToast = true
    }
}

#Preview {
    NavigationStack {
        List {
            ResponseView(jsonString: "[{\"name\": \"John Doe\", \"age\": 30, \"isEmployed\": true, \"address\": [{\"city\": [\"New York\", \"„Éà„Éº„Ç≠„Éß„Éº\"], \"postalCode\": [10001, 10002], \"cityType\": \"urban\"}]}]")
        }
    }
}
```

„Åì„ÅÆ„Ç≥„Éº„Éâ„Åß„ÅØ„ÄÅ`APIRequestPresenter` „Åß„Ç®„É≥„Ç≥„Éº„ÉâÂá¶ÁêÜ„ÇíË°å„ÅÑ„ÄÅÁµêÊûú„ÅÆ JSON ÊñáÂ≠óÂàó„Çí `APIRequestView` „Åã„Çâ `ResponseView` „Å´Ê∏°„Åó„Åæ„Åô„ÄÇ„Åì„Çå„Å´„Çà„Çä„ÄÅ`ResponseView` „ÅØ JSON „Ç®„É≥„Ç≥„Éº„Éâ„ÅÆÂá¶ÁêÜ„ÇíÊåÅ„Åü„Åö„Å´„ÄÅÂèó„ÅëÂèñ„Å£„Åü JSON ÊñáÂ≠óÂàó„ÇíË°®Á§∫„Åô„Çã„Å†„Åë„Å´„Å™„Çä„Åæ„Åô„ÄÇ

---

## üë§ „É¶„Éº„Ç∂„Éº
*2024/6/3 15:44:02*

presenter.encodeToJSONString „ÅÆ‰∏≠„ÅÆÂá¶ÁêÜ„ÅØ Prenseter„Å´ private let jsonHandleDriver: JSONHandleDriver = JSONHandleDriver() ÂÆöÁæ©„Åó„Å¶„ÄÅjsonHandleDriver„ÅÆÈñ¢Êï∞„Çí‰Ωø„Åà„Å™„ÅÑ„ÅãÔºü

---

## ü§ñ „Ç¢„Ç∑„Çπ„Çø„É≥„Éà
*2024/6/3 15:45:10*

„ÇÇ„Å°„Çç„Çì„ÄÅ`JSONHandleDriver` „ÅÆÈñ¢Êï∞„Çí‰ΩøÁî®„Åô„Çã„Åü„ÇÅ„Å´ `APIRequestPresenter` „Å´ `jsonHandleDriver` „ÇíËøΩÂä†„Åó„ÄÅ„Åù„ÅÆÈñ¢Êï∞„ÇíÂëº„Å≥Âá∫„ÅôÂΩ¢„Å´Â§âÊõ¥„Åß„Åç„Åæ„Åô„ÄÇ‰ª•‰∏ã„ÅØ„Åù„ÅÆ‰øÆÊ≠£‰æã„Åß„ÅôÔºö

### APIRequestPresenter

```swift
final class APIRequestPresenter: ObservableObject {
    @Published var selectedApi: APIType = .getUsers

    @Published var getUsersResponse: [Components.Schemas.User] = []
    @Published var getUserByIdResponse: [Components.Schemas.User] = []
    @Published var allResponse: [AllResponse] = []

    @Published var userId: Int = 1

    @Published var showToast: Bool = false
    @Published var isLoading: Bool = false
    @Published var showAlert: Bool = false
    @Published var apiError: APIError?

    private let jsonHandleDriver: JSONHandleDriver = JSONHandleDriver()
    private let client: Client = Client(
        serverURL: try! Servers.server1(),
        transport: URLSessionTransport()
    )

    init() {}

    func onTapCleaner() {
        getUsersResponse = []
        getUserByIdResponse = []
        allResponse = []

        userId = 1
    }

    func onTapPlay() async {
        switch selectedApi {
        case .all:
            await getUsers()
            await getUserById(id: userId)

            allResponse = [.init(getUsers: getUsersResponse, getUserById: getUserByIdResponse)]
        case .getUsers:
            await getUsers()
        case .getUser:
            await getUserById(id: userId)
        }
    }

    private func getUsers() async {
        getUsersResponse = []
        isLoading = true
        defer {
            isLoading = false
        }

        do {
            let response = try await client.getUsers()

            switch response {
            case .ok(let okResponse):
                switch okResponse.body {
                case .json(let users):
                    getUsersResponse = users
                }
            case .notFound(let notFoundResponse):
                switch notFoundResponse.body {
                case .json(let error):
                    print("\(error)")
                    apiError = .notFound
                    showAlert = true
                }
            case .undocumented(statusCode: let statusCode, _):
                print("\(statusCode)")
                apiError = .undocumented
                showAlert = true
            }
        } catch {
            print("\(error)")
            apiError = .unexpected
            showAlert = true
        }
    }

    private func getUserById(id: Int) async {
        getUserByIdResponse = []
        isLoading = true
        defer {
            isLoading = false
        }

        do {
            let response = try await client.getUserById(path: .init(id: id))

            switch response {
            case .ok(let okResponse):
                switch okResponse.body {
                case .json(let user):
                    getUserByIdResponse = [user]
                }
            case .notFound(let notFoundResponse):
                switch notFoundResponse.body {
                case .json(let error):
                    print("\(error)")
                    apiError = .notFound
                    showAlert = true
                }
            case .undocumented(statusCode: let statusCode, _):
                print("\(statusCode)")
                apiError = .undocumented
                showAlert = true
            }
        } catch {
            print("\(error)")
            apiError = .unexpected
            showAlert = true
        }
    }

    func encodeToJSONString<T: Encodable>(objects: [T]) -> String {
        do {
            return try jsonHandleDriver.encodeToJSONString(objects: objects)
        } catch {
            print("JSON Encode Error: \(error)")
            return "[]"
        }
    }
}
```

### APIRequestView

```swift
@MainActor
public struct APIRequestView: View {
    @StateObject private var presenter: APIRequestPresenter

    init() {
        _presenter = .init(wrappedValue: .init())
    }

    public var body: some View {
        List {
            Section("Request") {
                HStack {
                    Picker(selection: $presenter.selectedApi) {
                        ForEach(APIType.allCases, id: \.self) { apiType in
                            Text("\(apiType)")
                        }
                    } label: {
                        Text("API")
                    }
                    .pickerStyle(.menu)

                    Spacer()
                }

                Group {
                    switch presenter.selectedApi {
                    case .getUsers:
                        EmptyView()
                    case .getUser:
                        VStack(alignment: .leading) {
                            Text("User id")
                                .font(.subheadline)
                            TextField("1", value: $presenter.userId, format: .number)
                                .textFieldStyle(.roundedBorder)
                                .keyboardType(.numberPad)
                        }
                    case .all:
                        EmptyView()
                    }
                }

                Button {
                    Task {
                        await presenter.onTapPlay()
                    }
                } label: {
                    Text("Request")
                }
            }
            .textCase(.none)
            .listRowSeparator(.hidden)

            Section("Response") {
                Group {
                    switch presenter.selectedApi {
                    case .getUsers:
                        ResponseView(jsonString: presenter.encodeToJSONString(objects: presenter.getUsersResponse))
                    case .getUser:
                        ResponseView(jsonString: presenter.encodeToJSONString(objects: presenter.getUserByIdResponse))
                    case .all:
                        ResponseView(jsonString: presenter.encodeToJSONString(objects: presenter.allResponse))
                    }
                }
                .redacted(reason: presenter.isLoading ? .placeholder : [])
                .shimmering(active: presenter.isLoading)
            }
            .textCase(.none)

            Group {
                switch presenter.selectedApi {
                case .all:
                    PropertyView(showToast: $presenter.showToast, objects: presenter.allResponse)
                case .getUsers:
                    PropertyView(showToast: $presenter.showToast, objects: presenter.getUsersResponse)
                case .getUser:
                    PropertyView(showToast: $presenter.showToast, objects: presenter.getUserByIdResponse)
                }
            }
            .redacted(reason: presenter.isLoading ? .placeholder : [])
            .shimmering(active: presenter.isLoading)
        }
        .scrollDismissesKeyboard(.immediately)
        .simpleToast(isPresented: $presenter.showToast, options: SimpleToastOptions(alignment: .bottom, hideAfter: 1), content: {
            Label {
                Text("Copy")
            } icon: {
                SFSymbols.checkmarkCircle.image
            }
            .padding()
            .background(Color.green.opacity(0.8))
            .foregroundColor(Color.white)
            .cornerRadius(12)
            .padding(.top)
        })
        .toolbar {
            ToolbarItem(placement: .topBarTrailing) {
                Button {
                    presenter.onTapCleaner()
                } label: {
                    SFSymbols.wandAndStars.image
                }
            }
        }
        .navigationTitle("API Request")
        .alert(isPresented: $presenter.showAlert, error: presenter.apiError) {
            Button("OK") {}
        }
    }
}
```

### ResponseView

```swift
struct ResponseView: View {
    @State var showToast: Bool = false
    let jsonString: String

    public var body: some View {
        NavigationLink {
            ScrollView {
                VStack(alignment: .leading) {
                    SelectableTextView(text: jsonString)
                }
                .padding()
            }
            .navigationTitle("Response")
            .toolbar {
                ToolbarItem(placement: .topBarTrailing) {
                    Button {
                        onTapElement(jsonString: jsonString)
                    } label: {
                        SFSymbols.docOnDoc.image
                    }
                }
            }
            .simpleToast(isPresented: $showToast, options: SimpleToastOptions(alignment: .bottom, hideAfter: 1), content: {
                Label {
                    Text("Copy")
                } icon: {
                    SFSymbols.checkmarkCircle.image
                }
                .padding()
                .background(Color.green.opacity(0.8))
                .foregroundColor(Color.white)
                .cornerRadius(12)
                .padding(.top)
            })
        } label: {
            Text("Response")
        }
        .isHidden(jsonString.isEmpty)
    }

    func onTapElement(jsonString: String) {
        UIPasteboard.general.string = jsonString
        showToast = true
    }
}

#Preview {
    NavigationStack {
        List {
            ResponseView(jsonString: "[{\"name\": \"John Doe\", \"age\": 30, \"isEmployed\": true, \"address\": [{\"city\": [\"New York\", \"„Éà„Éº„Ç≠„Éß„Éº\"], \"postalCode\": [10001, 10002], \"cityType\": \"urban\"}]}]")
        }
    }
}

// Define required types for the preview to work
enum CityType: Codable {
    case urban
    case rural
}

struct Address: Codable {
    var city: [String]
    var postalCode: [Int]
    var cityType: CityType
}

struct Person: Codable {
    var name: String
    var age: Int
    var isEmployed: Bool
    var address: [Address]
}

enum APIType: CaseIterable {
    case all
    case getUsers
    case getUser
}

enum APIError: LocalizedError {
    case notFound
    case undocumented
    case unexpected

    /// alert title
    var errorDescription: String? {
        "\(self)"
    }
}

struct AllResponse: Codable {
    let getUsers: [Components.Schemas.User]
    let get

---

## ü§ñ „Ç¢„Ç∑„Çπ„Çø„É≥„Éà
*2024/6/3 15:45:26*

UserById: [Components.Schemas.User]
}

// Define your custom error type
enum AppError: Error {
    case customError(String)
}
```

„Åì„ÅÆ‰øÆÊ≠£„Å´„Çà„Çä„ÄÅ`APIRequestPresenter` „Åß `JSONHandleDriver` „ÅÆÈñ¢Êï∞„Çí‰ΩøÁî®„Åó„Å¶ JSON „Ç®„É≥„Ç≥„Éº„ÉâÂá¶ÁêÜ„ÇíË°å„ÅÑ„ÄÅ„Åù„ÅÆÁµêÊûú„ÅÆ JSON ÊñáÂ≠óÂàó„Çí `APIRequestView` „Åã„Çâ `ResponseView` „Å´Ê∏°„Åô„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åô„ÄÇ

---

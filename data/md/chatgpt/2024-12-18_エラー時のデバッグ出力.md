# ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›

Date: 2024-12-18

---

## ğŸ‘¤ User
*2024-12-18 15:25:36*

ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚debugPrintã—ãŸã„ã€‚

import 'package:dio/dio.dart';
import 'package:flutter/material.dart';
import 'package:go_router/go_router.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:snpit_guild_app/domain/screen.dart';
import 'package:snpit_guild_app/lib/infrastructure/snapit_guild_api/snapit_guild_api.openapi.dart';

// API Client Provider
final guildApiProvider = Provider&lt;GuildApi&gt;((ref) {
  return GuildApi(
    Dio(),
    Uri.parse('http://localhost:3002/'),
  );
});

// Guild Info Future Provider
final guildInfoProvider = FutureProvider((ref) async {
  final client = ref.read(guildApiProvider);
  final guildInfo = await client.guildControllerGetGuildInfo();
  debugPrint('Guild Info: $guildInfo');
  return guildInfo.data;
});

class GuildPage extends HookConsumerWidget {
  const GuildPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final guildInfoAsync = ref.watch(guildInfoProvider);

    return Scaffold(
      appBar: AppBar(title: const Text('Guild Page')),
      body: guildInfoAsync.when(
        data: (guildInfo) =&gt; Center(
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              Text('Guild Info: $guildInfo'),
              const SizedBox(height: 16),
              ElevatedButton(
                onPressed: () {
                  context.push(Screen.guildCode.path);
                },
                child: const Text('Go To Guild Code'),
              ),
              ElevatedButton(
                onPressed: () {
                  context.push(Screen.guildCreate.path);
                },
                child: const Text('Go To Guild Create'),
              ),
            ],
          ),
        ),
        loading: () =&gt; const Center(child: CircularProgressIndicator()),
        error: (error, stackTrace) =&gt; Center(
          child: Text('Error: $error'),
        ),
      ),
    );
  }
}

---

## ğŸ¤– Assistant
*2024-12-18 15:25:47*

ã‚¨ãƒ©ãƒ¼æ™‚ã«ã‚‚`debugPrint`ã§ã‚¨ãƒ©ãƒ¼å†…å®¹ã‚’è¡¨ç¤ºã—ãŸã„å ´åˆã¯ã€`guildInfoProvider`ã§ã‚¨ãƒ©ãƒ¼ã‚’ã‚­ãƒ£ãƒƒãƒã—ã¦ãƒ­ã‚°ã«å‡ºåŠ›ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´ã§ãã¾ã™ã€‚`catchError`ã‚’ä½¿ç”¨ã—ã¦ã‚¨ãƒ©ãƒ¼ã‚’å‡¦ç†ã™ã‚‹æ–¹æ³•ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚

```dart
// Guild Info Future Provider
final guildInfoProvider = FutureProvider((ref) async {
  final client = ref.read(guildApiProvider);
  try {
    final guildInfo = await client.guildControllerGetGuildInfo();
    debugPrint('Guild Info: $guildInfo');
    return guildInfo.data;
  } catch (error, stackTrace) {
    debugPrint('Error fetching Guild Info: $error');
    debugPrint('StackTrace: $stackTrace');
    throw error; // å†åº¦ã‚¨ãƒ©ãƒ¼ã‚’ã‚¹ãƒ­ãƒ¼ã—ã¦Viewã§è¡¨ç¤ºã™ã‚‹
  }
});
```

ã“ã‚Œã«ã‚ˆã‚Šã€APIå‘¼ã³å‡ºã—ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã§ã‚‚ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚¨ãƒ©ãƒ¼æƒ…å ±ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚ã¾ãŸã€`throw error`ã‚’ä½¿ã†ã“ã¨ã§ã€ã‚¨ãƒ©ãƒ¼ã‚’å†åº¦ã‚¹ãƒ­ãƒ¼ã—ã€`guildInfoAsync.when`å†…ã®`error`ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã«æ¸¡ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¾ãŸã€`GuildPage`å†…ã§ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹éƒ¨åˆ†ã«ã•ã‚‰ã«è©³ç´°ãªæƒ…å ±ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

```dart
error: (error, stackTrace) => Center(
  child: Column(
    mainAxisAlignment: MainAxisAlignment.center,
    children: [
      Text('Error: $error'),
      const SizedBox(height: 16),
      TextButton(
        onPressed: () {
          debugPrint('Error: $error');
          debugPrint('StackTrace: $stackTrace');
        },
        child: const Text('Show Error Details'),
      ),
    ],
  ),
),
```

ã“ã®ã‚ˆã†ã«ã™ã‚‹ã¨ã€UIä¸Šã§ã‚¨ãƒ©ãƒ¼ã®è©³ç´°æƒ…å ±ã‚’ç¢ºèªã—ãŸã„å ´åˆã«å½¹ç«‹ã¡ã¾ã™ã€‚`debugPrint`ã®ä¸­ã§`error`ã¨`stackTrace`ã®ä¸¡æ–¹ã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ã§ã€ãƒ‡ãƒãƒƒã‚°ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚

---

## ğŸ‘¤ User
*2024-12-18 15:26:32*

client ãŒ 'http://localhost:3002/' ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦ã„ã‚‹ã‹ãŒçŸ¥ã‚ŠãŸã„

---

## ğŸ¤– Assistant
*2024-12-18 15:27:04*

`client`ãŒæ­£ã—ã`http://localhost:3002/`ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹ã«ã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚„ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãƒ­ã‚°ã«å‡ºåŠ›ã™ã‚‹æ–¹æ³•ãŒæœ‰åŠ¹ã§ã™ã€‚`Dio`ã«ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç°¡å˜ã«ãƒ­ã‚°ã«å‡ºåŠ›ã™ã‚‹ãŸã‚ã®`Interceptor`ã‚’è¿½åŠ ã™ã‚‹æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã«ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãƒ­ã‚°ã«å‡ºåŠ›ã™ã‚‹æ–¹æ³•ã‚’ç¤ºã—ã¾ã™ã€‚

### 1. Dio ã« `LogInterceptor` ã‚’è¿½åŠ ã™ã‚‹
`GuildApi`ã®`Dio`ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«`LogInterceptor`ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```dart
import 'package:dio/dio.dart';

final guildApiProvider = Provider<GuildApi>((ref) {
  final dio = Dio();
  dio.options.baseUrl = 'http://localhost:3002/';
  dio.interceptors.add(LogInterceptor(
    request: true, // ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ã‚°ã«å‡ºåŠ›
    requestBody: true, // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒœãƒ‡ã‚£ã‚’ãƒ­ã‚°ã«å‡ºåŠ›
    responseBody: true, // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒœãƒ‡ã‚£ã‚’ãƒ­ã‚°ã«å‡ºåŠ›
    responseHeader: false, // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ãƒ­ã‚°ã«å‡ºåŠ›ï¼ˆå¿…è¦ã«å¿œã˜ã¦å¤‰æ›´ï¼‰
  ));
  return GuildApi(dio, Uri.parse('http://localhost:3002/'));
});
```

ã“ã®è¨­å®šã«ã‚ˆã‚Šã€ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒãƒ­ã‚°ã«å‡ºåŠ›ã•ã‚Œã¾ã™ã€‚ãƒ­ã‚°ã«ã¯ä»¥ä¸‹ãŒå«ã¾ã‚Œã¾ã™ï¼š
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®URL
- HTTPãƒ¡ã‚½ãƒƒãƒ‰
- ãƒ˜ãƒƒãƒ€ãƒ¼
- ãƒœãƒ‡ã‚£ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿

---

### 2. ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã‚’è¿½åŠ ã—ã¦ã‚ˆã‚Šè©³ç´°ã«ãƒ­ã‚°ã‚’å–å¾—
ã‚ˆã‚Šè©³ç´°ãªåˆ¶å¾¡ãŒå¿…è¦ãªå ´åˆã€ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã‚’ä½œæˆã—ã¦ã€ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚„ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ã‚­ãƒ£ãƒƒãƒã™ã‚‹æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚

```dart
class LoggingInterceptor extends Interceptor {
  @override
  void onRequest(RequestOptions options, RequestInterceptorHandler handler) {
    debugPrint('Request [${options.method}] ${options.baseUrl}${options.path}');
    debugPrint('Headers: ${options.headers}');
    debugPrint('Body: ${options.data}');
    handler.next(options); // æ¬¡ã®å‡¦ç†ã¸æ¸¡ã™
  }

  @override
  void onResponse(Response response, ResponseInterceptorHandler handler) {
    debugPrint('Response [${response.statusCode}] ${response.requestOptions.baseUrl}${response.requestOptions.path}');
    debugPrint('Response Data: ${response.data}');
    handler.next(response); // æ¬¡ã®å‡¦ç†ã¸æ¸¡ã™
  }

  @override
  void onError(DioError err, ErrorInterceptorHandler handler) {
    debugPrint('Error [${err.response?.statusCode}] ${err.requestOptions.baseUrl}${err.requestOptions.path}');
    debugPrint('Error Data: ${err.response?.data}');
    handler.next(err); // æ¬¡ã®å‡¦ç†ã¸æ¸¡ã™
  }
}

final guildApiProvider = Provider<GuildApi>((ref) {
  final dio = Dio();
  dio.options.baseUrl = 'http://localhost:3002/';
  dio.interceptors.add(LoggingInterceptor());
  return GuildApi(dio, Uri.parse('http://localhost:3002/'));
});
```

ã“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ãƒ­ã‚°ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã¾ãŸã€ã‚¨ãƒ©ãƒ¼æ™‚ã®æƒ…å ±ã‚‚ã‚­ãƒ£ãƒƒãƒã§ãã¾ã™ã€‚

---

### 3. å®Ÿè¡Œæ™‚ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç¢ºèª
ã‚¢ãƒ—ãƒªã‚’å®Ÿè¡Œã—ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã§ã™ï¼š

#### ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ­ã‚°
```
Request [GET] http://localhost:3002/guild-info
Headers: {Authorization: Bearer token...}
Body: null
```

#### ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ­ã‚°
```
Response [200] http://localhost:3002/guild-info
Response Data: {id: 1, name: 'Example Guild'}
```

#### ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°
```
Error [404] http://localhost:3002/guild-info
Error Data: {message: 'Not Found'}
```

ã“ã‚Œã«ã‚ˆã‚Šã€`client`ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ­£ã—ã„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«é€ä¿¡ã—ã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã§ãã¾ã™ã€‚

---

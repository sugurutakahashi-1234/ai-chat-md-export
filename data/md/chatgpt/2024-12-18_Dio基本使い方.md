# DioåŸºæœ¬ä½¿ã„æ–¹

Date: 2024-12-18

---

## ğŸ‘¤ User
*2024-12-18 17:34:53*

flutterã®dioã«ã¤ã„ã¦è‰²ã€…æ•™ãˆã¦ã»ã—ã„

---

## ğŸ¤– Assistant
*2024-12-18 17:35:37*

**Dio** ã¯ã€Flutterã§äººæ°—ã®ã‚ã‚‹HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã€REST APIã¨ã®é€šä¿¡ã‚’ç°¡å˜ã«è¡Œã†ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚æ©Ÿèƒ½ãŒè±Šå¯Œã§ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ€§ãŒé«˜ã„ã®ãŒç‰¹å¾´ã§ã™ã€‚

ä»¥ä¸‹ã«Dioã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ã‚„ç‰¹å¾´ã€å¿œç”¨æ–¹æ³•ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚

---

## **Dioã®ç‰¹å¾´**
1. **ã‚·ãƒ³ãƒ—ãƒ«ãªAPI**  
   HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆGETã€POSTã€PUTã€DELETEãªã©ï¼‰ã‚’ç°¡å˜ã«è¨˜è¿°å¯èƒ½ã€‚
   
2. **ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼**  
   ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚„ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å¯¾ã—ã¦å‰å‡¦ç†ãƒ»å¾Œå‡¦ç†ã‚’æŒŸã‚€ã“ã¨ãŒå¯èƒ½ã€‚

3. **ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚­ãƒ£ãƒ³ã‚»ãƒ«**  
   ç‰¹å®šã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã§ãã‚‹æ©Ÿèƒ½ã‚’æä¾›ã€‚

4. **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š**  
   æ¥ç¶šã€èª­ã¿å–ã‚Šã€æ›¸ãè¾¼ã¿ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’å€‹åˆ¥ã«è¨­å®šå¯èƒ½ã€‚

5. **Base URLã®è¨­å®š**  
   ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹URLã‚’è¨­å®šã—ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã«è¨˜è¿°ã‚’çœç•¥å¯èƒ½ã€‚

6. **ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰/ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**  
   ç°¡å˜ã«ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚„ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒå¯èƒ½ã€‚

7. **ãƒ‡ãƒãƒƒã‚°ã‚„ãƒ­ã‚°ã®å‡ºåŠ›**  
   ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ï¼ˆ`dio_logger`ã‚„`pretty_dio_logger`ãªã©ï¼‰ã‚’åˆ©ç”¨ã—ã¦ã€ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ­ã‚°ã‚’å‡ºåŠ›å¯èƒ½ã€‚

8. **JSONè‡ªå‹•ãƒ‘ãƒ¼ã‚¹**  
   JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç°¡å˜ã«è§£æã™ã‚‹æ©Ÿèƒ½ã‚’æŒã¤ã€‚

---

## **Dioã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
```yaml
dependencies:
  dio: ^5.0.0
```

`pubspec.yaml`ã«è¿½åŠ å¾Œã€ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
```bash
flutter pub get
```

---

## **åŸºæœ¬çš„ãªä½¿ã„æ–¹**

### **1. ã‚·ãƒ³ãƒ—ãƒ«ãªGETãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```dart
import 'package:dio/dio.dart';

void main() async {
  final dio = Dio();
  final response = await dio.get('https://jsonplaceholder.typicode.com/posts');
  print(response.data); // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’å‡ºåŠ›
}
```

### **2. POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```dart
final response = await dio.post(
  'https://jsonplaceholder.typicode.com/posts',
  data: {
    'title': 'Flutter',
    'body': 'Dio is amazing!',
    'userId': 1,
  },
);
print(response.data);
```

### **3. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š**
```dart
final dio = Dio(
  BaseOptions(
    connectTimeout: Duration(seconds: 5),
    receiveTimeout: Duration(seconds: 3),
  ),
);
```

---

## **ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã®æ´»ç”¨**

### **ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‰ã«å‡¦ç†ã‚’æŒŸã‚€**
```dart
dio.interceptors.add(
  InterceptorsWrapper(
    onRequest: (options, handler) {
      print('ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡: ${options.uri}');
      return handler.next(options); // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç¶šè¡Œ
    },
    onResponse: (response, handler) {
      print('ãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡: ${response.statusCode}');
      return handler.next(response); // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç¶šè¡Œ
    },
    onError: (DioError e, handler) {
      print('ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: ${e.message}');
      return handler.next(e); // ã‚¨ãƒ©ãƒ¼ã‚’ç¶šè¡Œ
    },
  ),
);
```

---

## **ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**
```dart
final file = MultipartFile.fromFileSync('path/to/file');
final formData = FormData.fromMap({'file': file});

final response = await dio.post(
  'https://example.com/upload',
  data: formData,
);
print(response.data);
```

---

## **ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**
```dart
await dio.download(
  'https://example.com/file.zip',
  '/path/to/save/file.zip',
  onReceiveProgress: (received, total) {
    if (total != -1) {
      print('${(received / total * 100).toStringAsFixed(0)}% å®Œäº†');
    }
  },
);
```

---

## **ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«**
```dart
final cancelToken = CancelToken();

dio.get(
  'https://example.com/api',
  cancelToken: cancelToken,
);

// å¾Œã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
cancelToken.cancel('ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚­ãƒ£ãƒ³ã‚»ãƒ«!');
```

---

## **ãƒ‡ãƒãƒƒã‚°ç”¨ã®ãƒ­ã‚°å‡ºåŠ›**
`pretty_dio_logger`ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚„ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¦‹ã‚„ã™ãå‡ºåŠ›å¯èƒ½ã§ã™ã€‚

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```yaml
dependencies:
  pretty_dio_logger: ^1.3.0
```

### ä½¿ç”¨æ–¹æ³•
```dart
import 'package:pretty_dio_logger/pretty_dio_logger.dart';

dio.interceptors.add(PrettyDioLogger());
```

---

## **å¿œç”¨ä¾‹: èªè¨¼ä»˜ããƒªã‚¯ã‚¨ã‚¹ãƒˆ**
Bearerãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒ˜ãƒƒãƒ€ãƒ¼ã«è¿½åŠ ã—ã¦èªè¨¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ä¾‹ã§ã™ã€‚

```dart
dio.options.headers['Authorization'] = 'Bearer your_token_here';

final response = await dio.get('https://example.com/protected');
print(response.data);
```

---

Dioã¯æŸ”è»Ÿã§ä½¿ã„ã‚„ã™ã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚èªè¨¼ã€ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãªã©ã®å ´é¢ã§åŠ›ã‚’ç™ºæ®ã—ã¾ã™ã€‚ã‚‚ã—ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚„èª²é¡ŒãŒã‚ã‚Œã°ã€ã•ã‚‰ã«è©³ã—ããŠæ‰‹ä¼ã„ã§ãã¾ã™ï¼

---

## ğŸ‘¤ User
*2024-12-18 17:36:31*

openapi genã§ä½œã£ãŸã‚³ãƒ¼ãƒ‰ã§ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã‚ªãƒ¼ã‚½ãƒ©ã‚¤ã‚ºãƒˆãƒ¼ã‚¯ãƒ³ã‚’åŸ‹ã‚è¾¼ã‚“ã ã‚Šã—ãŸã„
dioã‚’ä½¿ã†ã¨ã©ã†ãªã‚‹ã®ã‹ï¼Ÿ

---

## ğŸ¤– Assistant
*2024-12-18 17:37:22*

OpenAPI Generatorã§ç”Ÿæˆã—ãŸã‚³ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦ã€Dioã‚’åˆ©ç”¨ã—ã¦HTTPé€šä¿¡ã‚’è¡Œã†å ´åˆã€ãƒ˜ãƒƒãƒ€ãƒ¼ã«èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’åŸ‹ã‚è¾¼ã‚€æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

### **å‰æ**
OpenAPI Generatorã§ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹éš›ã€`dart-dio`ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æŒ‡å®šã—ã¦ã„ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯Dioã‚’åˆ©ç”¨ã—ãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

---

## **ãƒ˜ãƒƒãƒ€ãƒ¼ã«èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’åŸ‹ã‚è¾¼ã‚€æ–¹æ³•**

### **1. OpenAPI Generatorã§Dioãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ**
```bash
openapi-generator-cli generate \
  -i api-spec.yaml \
  -g dart-dio \
  -o generated_code
```

ã“ã‚Œã«ã‚ˆã‚Šã€Dioã‚’åˆ©ç”¨ã—ãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹é€ ã®ã‚³ãƒ¼ãƒ‰ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ï¼š
- `lib/api/api.dart`
- `lib/api/api_client.dart`
- `lib/api/apis/`

---

### **2. èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒ˜ãƒƒãƒ€ãƒ¼ã«è¿½åŠ **

ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã®ä¸­ã§ã€HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ã«ã¯`ApiClient`ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

#### **2.1 ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º**
`ApiClient`ã®`addDefaultHeader`ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å…±é€šã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ ã§ãã¾ã™ã€‚

```dart
import 'package:generated_code/api/api.dart';

void main() async {
  // ApiClientã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å–å¾—
  final apiClient = ApiClient();

  // èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ˜ãƒƒãƒ€ãƒ¼ã«è¿½åŠ 
  apiClient.addDefaultHeader('Authorization', 'Bearer your_token_here');

  // ä½¿ç”¨ã™ã‚‹APIã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
  final exampleApi = ExampleApi(apiClient);

  // APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å®Ÿè¡Œ
  final response = await exampleApi.getExample();
  print(response);
}
```

#### **2.2 ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã‚’åˆ©ç”¨**
ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã§ã¯ã€Dioã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç›´æ¥æ“ä½œã§ãã¾ã™ã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã‚’è¨­å®šã—ã¦èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å‹•çš„ã«è¿½åŠ ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

```dart
void main() async {
  final apiClient = ApiClient();

  // Dioã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å–å¾—
  final dio = apiClient.dio;

  // ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã‚’è¿½åŠ ã—ã¦èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒ˜ãƒƒãƒ€ãƒ¼ã«åŸ‹ã‚è¾¼ã‚€
  dio.interceptors.add(
    InterceptorsWrapper(
      onRequest: (options, handler) {
        options.headers['Authorization'] = 'Bearer your_token_here';
        return handler.next(options); // æ¬¡ã®å‡¦ç†ã¸
      },
    ),
  );

  final exampleApi = ExampleApi(apiClient);
  final response = await exampleApi.getExample();
  print(response);
}
```

---

### **3. ãƒˆãƒ¼ã‚¯ãƒ³ã®å‹•çš„ç®¡ç†**

#### **ãƒˆãƒ¼ã‚¯ãƒ³ã®æ›´æ–°ã«å¯¾å¿œ**
ãƒˆãƒ¼ã‚¯ãƒ³ãŒå®šæœŸçš„ã«æ›´æ–°ã•ã‚Œã‚‹å ´åˆã€Dioã®ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼å†…ã§ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§å¯¾å¿œå¯èƒ½ã§ã™ã€‚

```dart
dio.interceptors.add(
  InterceptorsWrapper(
    onRequest: (options, handler) async {
      // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å‹•çš„ã«å–å¾—
      final token = await getToken(); // ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…
      options.headers['Authorization'] = 'Bearer $token';
      return handler.next(options);
    },
  ),
);
```

#### **ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ã‚’ãƒã‚§ãƒƒã‚¯**
ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€æœ‰åŠ¹ã§ãªã„å ´åˆã«ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã™ã‚‹å‡¦ç†ã‚‚è¿½åŠ ã§ãã¾ã™ã€‚

```dart
dio.interceptors.add(
  InterceptorsWrapper(
    onRequest: (options, handler) async {
      if (isTokenExpired()) {
        await refreshToken(); // ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°å‡¦ç†ã‚’å®Ÿè£…
      }
      options.headers['Authorization'] = 'Bearer ${getToken()}';
      return handler.next(options);
    },
  ),
);
```

---

### **4. ã‚«ã‚¹ã‚¿ãƒ HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ä½¿ç”¨**
ç”Ÿæˆã•ã‚ŒãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ‹¡å¼µã—ã¦ã€èªè¨¼ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å«ã‚€ã‚«ã‚¹ã‚¿ãƒ Dioã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

#### **ã‚«ã‚¹ã‚¿ãƒ ApiClient**
```dart
class CustomApiClient extends ApiClient {
  CustomApiClient() {
    dio.interceptors.add(
      InterceptorsWrapper(
        onRequest: (options, handler) async {
          final token = await getToken();
          options.headers['Authorization'] = 'Bearer $token';
          return handler.next(options);
        },
      ),
    );
  }
}
```

ä½¿ç”¨ä¾‹ï¼š
```dart
void main() async {
  final apiClient = CustomApiClient();
  final exampleApi = ExampleApi(apiClient);
  final response = await exampleApi.getExample();
  print(response);
}
```

---

### **5. ç’°å¢ƒå¤‰æ•°ã‚„è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—**
ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã›ãšã€ã‚»ã‚­ãƒ¥ã‚¢ã«ç®¡ç†ã™ã‚‹ãŸã‚ã€ç’°å¢ƒå¤‰æ•°ã‚„è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã™ã‚‹æ–¹æ³•ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

```dart
import 'package:flutter_secure_storage/flutter_secure_storage.dart';

Future<String> getToken() async {
  final storage = FlutterSecureStorage();
  return await storage.read(key: 'auth_token') ?? '';
}
```

---

## **ã¾ã¨ã‚**
Dioã‚’ä½¿ç”¨ã—ã¦OpenAPI Generatorã§ç”Ÿæˆã—ãŸã‚³ãƒ¼ãƒ‰ã«èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’åŸ‹ã‚è¾¼ã‚€ã«ã¯ã€ä»¥ä¸‹ã®æ‰‹æ³•ãŒä¾¿åˆ©ã§ã™ï¼š
1. `addDefaultHeader`ã‚’ä½¿ç”¨ã™ã‚‹ã€‚
2. Dioã®ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã‚’æ´»ç”¨ã—ã¦ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å‹•çš„ã«è¿½åŠ ã™ã‚‹ã€‚
3. ã‚«ã‚¹ã‚¿ãƒ `ApiClient`ã‚’ä½œæˆã—ã¦å†åˆ©ç”¨æ€§ã‚’é«˜ã‚ã‚‹ã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€èªè¨¼å‡¦ç†ã‚’åŠ¹ç‡åŒ–ã—ã€ã‚»ã‚­ãƒ¥ã‚¢ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å®Ÿç¾ã§ãã¾ã™ã€‚

---

## ğŸ‘¤ User
*2024-12-18 17:38:43*

ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒˆãƒ¼ã‚¯ãƒ³ãŒå¤‰ã‚ã‚‹ãŸã³ã«APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¯ãƒ©ã‚¹ã®åˆæœŸåŒ–ã‚’è¡Œã†ã®ã¯é›£ã—ããªã„ã‹ï¼Ÿ

ã©ã†ã«ã‹å·®ã—è¾¼ã¿ãŸã„

---

## ğŸ¤– Assistant
*2024-12-18 17:39:24*

ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒˆãƒ¼ã‚¯ãƒ³ãŒå¤‰ã‚ã‚‹ãŸã³ã«APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¯ãƒ©ã‚¹ã®åˆæœŸåŒ–ã‚’ç¹°ã‚Šè¿”ã™ã®ã¯ç¢ºã‹ã«éåŠ¹ç‡ã§ã™ã€‚ã“ã®ã‚ˆã†ãªå ´åˆã€Dioã® **ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼** ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å‹•çš„ã«å·®ã—è¾¼ã‚€æ–¹æ³•ãŒæœ‰åŠ¹ã§ã™ã€‚

---

## **ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã§å‹•çš„ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å·®ã—è¾¼ã‚€æ–¹æ³•**

### **è§£æ±ºã®ãƒã‚¤ãƒ³ãƒˆ**
1. **ãƒˆãƒ¼ã‚¯ãƒ³ã®ä¸€å…ƒç®¡ç†**
   - ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã¾ãŸã¯çŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ä¸€å…ƒç®¡ç†ã€‚
   - ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã«å‹•çš„ã«å–å¾—ã—ã¦é©ç”¨ã€‚

2. **Dioã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã®åˆ©ç”¨**
   - ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œã‚‹ãŸã³ã«ã€æœ€æ–°ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒ˜ãƒƒãƒ€ãƒ¼ã«å·®ã—è¾¼ã‚€ã€‚

---

### **å®Ÿè£…ä¾‹ï¼šãƒˆãƒ¼ã‚¯ãƒ³ã‚’å‹•çš„ã«å·®ã—è¾¼ã‚€**

ä»¥ä¸‹ã®ã‚ˆã†ã«ã€Dioã®ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã‚’åˆ©ç”¨ã—ã¦ã€èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å·®ã—è¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚

```dart
import 'package:dio/dio.dart';

// ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¸€å…ƒç®¡ç†ã™ã‚‹ã‚¯ãƒ©ã‚¹
class AuthTokenManager {
  String? _token;

  // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
  String? get token => _token;

  // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ›´æ–°
  void updateToken(String newToken) {
    _token = newToken;
  }
}

// ã‚°ãƒ­ãƒ¼ãƒãƒ«ã§ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç®¡ç†
final authTokenManager = AuthTokenManager();

void main() async {
  // Dioã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
  final dio = Dio();

  // ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã‚’è¿½åŠ ã—ã¦ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’é©ç”¨
  dio.interceptors.add(
    InterceptorsWrapper(
      onRequest: (options, handler) {
        // æœ€æ–°ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã¦ãƒ˜ãƒƒãƒ€ãƒ¼ã«å·®ã—è¾¼ã‚€
        final token = authTokenManager.token;
        if (token != null) {
          options.headers['Authorization'] = 'Bearer $token';
        }
        return handler.next(options); // æ¬¡ã®å‡¦ç†ã¸
      },
    ),
  );

  // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é€ä¿¡ä¾‹
  authTokenManager.updateToken("newToken123"); // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ›´æ–°
  final response = await dio.get('https://example.com/api/data');
  print(response.data);
}
```

---

### **ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®ãƒ¡ãƒªãƒƒãƒˆ**
1. **ãƒˆãƒ¼ã‚¯ãƒ³ã®å¤‰æ›´ã«å¯¾å¿œ**
   - ãƒˆãƒ¼ã‚¯ãƒ³ãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆã§ã‚‚ã€`AuthTokenManager`ã‚’æ›´æ–°ã™ã‚‹ã ã‘ã§ã€ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«åæ˜ ã•ã‚Œã‚‹ã€‚

2. **ã‚³ãƒ¼ãƒ‰ã®ç°¡æ½”åŒ–**
   - å„APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¯ãƒ©ã‚¹ã‚’å†åˆæœŸåŒ–ã™ã‚‹å¿…è¦ãŒãªããªã‚‹ã€‚

3. **å†åˆ©ç”¨æ€§**
   - Dioã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å†åˆ©ç”¨ã§ãã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã«æ–°ã—ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒãªã„ã€‚

---

### **å¿œç”¨ï¼šãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥å¯¾å¿œ**
ãƒˆãƒ¼ã‚¯ãƒ³ãŒæœŸé™åˆ‡ã‚Œã®å ´åˆã«è‡ªå‹•ã§ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ ã§ãã¾ã™ã€‚

```dart
dio.interceptors.add(
  InterceptorsWrapper(
    onRequest: (options, handler) async {
      // æœ€æ–°ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
      var token = authTokenManager.token;

      // ãƒˆãƒ¼ã‚¯ãƒ³ãŒæœŸé™åˆ‡ã‚Œã®å ´åˆã«ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
      if (isTokenExpired(token)) {
        token = await refreshAuthToken(); // ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…
        authTokenManager.updateToken(token!); // æ–°ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜
      }

      if (token != null) {
        options.headers['Authorization'] = 'Bearer $token';
      }

      return handler.next(options); // æ¬¡ã®å‡¦ç†ã¸
    },
  ),
);
```

---

### **ãƒˆãƒ¼ã‚¯ãƒ³ã®ä¸€å…ƒç®¡ç†ã®ä»£æ›¿æ¡ˆ**
ä»¥ä¸‹ã®ã‚ˆã†ãªæ–¹æ³•ã§ã‚‚ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¸€å…ƒç®¡ç†ã§ãã¾ã™ï¼š

1. **ãƒ—ãƒ­ãƒã‚¤ãƒ€ï¼ˆProviderã‚„Riverpodï¼‰**
   - çŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ã¦ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç®¡ç†ã€‚

2. **Flutter Secure Storage**
   - æ°¸ç¶šçš„ãªãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†ãŒå¿…è¦ãªå ´åˆã€‚

---

### **ã¾ã¨ã‚**
- APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¯ãƒ©ã‚¹ã®åˆæœŸåŒ–ã‚’ç¹°ã‚Šè¿”ã•ãªã„ãŸã‚ã«ã€Dioã®ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã‚’åˆ©ç”¨ã—ã¦ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å‹•çš„ã«å·®ã—è¾¼ã‚€æ–¹æ³•ãŒæœ€é©ã§ã™ã€‚
- çŠ¶æ…‹ç®¡ç†ã¨Dioã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€ãƒˆãƒ¼ã‚¯ãƒ³ã®ç®¡ç†ã¨é©ç”¨ã‚’åŠ¹ç‡åŒ–ã§ãã¾ã™ã€‚
- ãƒˆãƒ¼ã‚¯ãƒ³ã®æ›´æ–°ã‚„ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒ­ã‚¸ãƒƒã‚¯ã‚‚å®¹æ˜“ã«è¿½åŠ å¯èƒ½ã§ã™ã€‚

ã“ã®æ–¹æ³•ã‚’æ¡ç”¨ã™ã‚Œã°ã€ãƒˆãƒ¼ã‚¯ãƒ³ã®ç®¡ç†ã‚„APIãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒç°¡å˜ã‹ã¤æŸ”è»Ÿã«è¡Œãˆã¾ã™ï¼

---

## ğŸ‘¤ User
*2024-12-18 17:40:29*

ãƒªãƒãƒ¼ãƒãƒƒãƒ‰ã‚’ä½¿ã„ãŸã„
èªè¨¼APiãŒã‚ã£ã¦ãã‚Œã‚’ä½¿ã£ã¦æœ€åˆã®ã‚ªãƒ¼ã‚½ãƒ©ã‚¤ã‚ºãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ã‚»ãƒƒãƒˆã—ãŸã„

---

## ğŸ¤– Assistant
*2024-12-18 17:41:27*

Riverpod ã‚’ä½¿ç”¨ã—ã¦èªè¨¼ API ã‚’ä½¿ã„ã€æœ€åˆã®ã‚ªãƒ¼ã‚½ãƒ©ã‚¤ã‚ºãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ã‚»ãƒƒãƒˆã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚ä»¥ä¸‹ã«ã€Riverpod ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’æ´»ç”¨ã—ã¦èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç®¡ç†ã—ã€Dio ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å‹•çš„ã«ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ ã™ã‚‹æ–¹æ³•ã‚’è§£èª¬ã—ã¾ã™ã€‚

---

## **å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—**

### **1. èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®ç®¡ç†**
èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ `StateNotifierProvider` ã¾ãŸã¯ `AsyncNotifierProvider` ã‚’ä½¿ç”¨ã—ã¦ç®¡ç†ã—ã¾ã™ã€‚

---

### **ã‚³ãƒ¼ãƒ‰ä¾‹**

#### **1. ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†ã‚¯ãƒ©ã‚¹**
ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç®¡ç†ã™ã‚‹ `AuthNotifier` ã‚’ä½œæˆã—ã¾ã™ã€‚

```dart
import 'package:flutter_riverpod/flutter_riverpod.dart';

class AuthNotifier extends StateNotifier<String?> {
  AuthNotifier() : super(null);

  // èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã¦ä¿å­˜
  Future<void> fetchAuthToken() async {
    // èªè¨¼APIã‚’å‘¼ã³å‡ºã—ã¦ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
    final token = await _authenticateUser();
    state = token;
  }

  // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚¯ãƒªã‚¢ï¼ˆãƒ­ã‚°ã‚¢ã‚¦ãƒˆãªã©ã§ä½¿ç”¨ï¼‰
  void clearToken() {
    state = null;
  }

  // ä»®ã®èªè¨¼APIå‘¼ã³å‡ºã—
  Future<String> _authenticateUser() async {
    await Future.delayed(Duration(seconds: 1)); // ãƒ€ãƒŸãƒ¼ã®é…å»¶
    return "example_auth_token";
  }
}

// ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç®¡ç†ã™ã‚‹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼
final authProvider = StateNotifierProvider<AuthNotifier, String?>((ref) {
  return AuthNotifier();
});
```

---

#### **2. Dioã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®è¨­å®š**
Dio ã‚’ä½¿ã£ã¦ API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

```dart
import 'package:dio/dio.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';

// Dioã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’æä¾›ã™ã‚‹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼
final dioProvider = Provider<Dio>((ref) {
  final dio = Dio();

  // ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã‚’è¿½åŠ 
  dio.interceptors.add(
    InterceptorsWrapper(
      onRequest: (options, handler) {
        // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
        final token = ref.read(authProvider);

        if (token != null) {
          // Authorizationãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ã‚»ãƒƒãƒˆ
          options.headers['Authorization'] = 'Bearer $token';
        }

        return handler.next(options);
      },
    ),
  );

  return dio;
});
```

---

#### **3. èªè¨¼å‡¦ç†ã‚’å‘¼ã³å‡ºã™UI**
ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã€Dio ã‚’è¨­å®šã™ã‚‹å‡¦ç†ã‚’ UI ã«çµ±åˆã—ã¾ã™ã€‚

```dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';

class AuthScreen extends ConsumerWidget {
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final authState = ref.watch(authProvider);

    return Scaffold(
      appBar: AppBar(title: Text('èªè¨¼ç”»é¢')),
      body: Center(
        child: authState == null
            ? ElevatedButton(
                onPressed: () async {
                  // èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
                  await ref.read(authProvider.notifier).fetchAuthToken();
                },
                child: Text('ãƒ­ã‚°ã‚¤ãƒ³'),
              )
            : Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  Text('ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—æ¸ˆã¿: $authState'),
                  ElevatedButton(
                    onPressed: () async {
                      // èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’åˆ©ç”¨ã—ã¦APIãƒªã‚¯ã‚¨ã‚¹ãƒˆ
                      final dio = ref.read(dioProvider);
                      final response = await dio.get('https://example.com/api/data');
                      print(response.data);
                    },
                    child: Text('APIãƒªã‚¯ã‚¨ã‚¹ãƒˆ'),
                  ),
                  ElevatedButton(
                    onPressed: () {
                      // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚¯ãƒªã‚¢
                      ref.read(authProvider.notifier).clearToken();
                    },
                    child: Text('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ'),
                  ),
                ],
              ),
      ),
    );
  }
}
```

---

### **èª¬æ˜**

1. **`AuthNotifier`**
   - èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç®¡ç†ã™ã‚‹ã‚¯ãƒ©ã‚¹ã§ã™ã€‚
   - åˆå›ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã« API ã‚’å‘¼ã³å‡ºã—ã¦ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã€çŠ¶æ…‹ (`state`) ã«ä¿å­˜ã—ã¾ã™ã€‚
   - ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ™‚ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã€‚

2. **`authProvider`**
   - Riverpod ã® `StateNotifierProvider` ã‚’åˆ©ç”¨ã—ã¦ `AuthNotifier` ã®çŠ¶æ…‹ã‚’æä¾›ã—ã¾ã™ã€‚

3. **`dioProvider`**
   - Dio ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æä¾›ã™ã‚‹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã§ã™ã€‚
   - ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã‚’åˆ©ç”¨ã—ã¦ã€ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å‹•çš„ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¿½åŠ ã—ã¾ã™ã€‚

4. **`AuthScreen`**
   - ãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾—ã€APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã€ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½ã‚’å®Ÿè£…ã—ãŸç”»é¢ã§ã™ã€‚

---

### **å‹•ä½œãƒ•ãƒ­ãƒ¼**
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œãƒ­ã‚°ã‚¤ãƒ³ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€`fetchAuthToken` ãŒå‘¼ã³å‡ºã•ã‚Œã€ãƒˆãƒ¼ã‚¯ãƒ³ãŒå–å¾—ã•ã‚Œã¾ã™ã€‚
2. ãƒˆãƒ¼ã‚¯ãƒ³ã¯ `authProvider` ã‚’é€šã˜ã¦çŠ¶æ…‹ã«ä¿å­˜ã•ã‚Œã€Dio ã®ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ãŒãƒˆãƒ¼ã‚¯ãƒ³ã‚’è‡ªå‹•çš„ã«ãƒ˜ãƒƒãƒ€ãƒ¼ã«è¿½åŠ ã—ã¾ã™ã€‚
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€ŒAPIãƒªã‚¯ã‚¨ã‚¹ãƒˆã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€Dio ã‚’åˆ©ç”¨ã—ãŸèªè¨¼ä»˜ããƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
4. ã€Œãƒ­ã‚°ã‚¢ã‚¦ãƒˆã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ãƒˆãƒ¼ã‚¯ãƒ³ãŒå‰Šé™¤ã•ã‚Œã¾ã™ã€‚

---

### **ã“ã®æ–¹æ³•ã®ãƒ¡ãƒªãƒƒãƒˆ**
- **ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†ãŒä¸€å…ƒåŒ–**ï¼š`AuthProvider`ã§ãƒˆãƒ¼ã‚¯ãƒ³ã‚’é›†ä¸­ç®¡ç†ã€‚
- **å‹•çš„ãƒ˜ãƒƒãƒ€ãƒ¼é©ç”¨**ï¼šDioã®ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã«å‹•çš„ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’é©ç”¨ã€‚
- **çŠ¶æ…‹ç®¡ç†ã¨ã®çµ±åˆ**ï¼šRiverpodã‚’åˆ©ç”¨ã—ã¦ã€èªè¨¼çŠ¶æ…‹ã‚’ç°¡å˜ã«ç›£è¦–ãƒ»æ“ä½œå¯èƒ½ã€‚

---

ã“ã®å®Ÿè£…ã§ã€èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’åŠ¹ç‡ã‚ˆãç®¡ç†ã—ã€ãƒ˜ãƒƒãƒ€ãƒ¼ã«è‡ªå‹•ã§å·®ã—è¾¼ã‚€ä»•çµ„ã¿ã‚’æ§‹ç¯‰ã§ãã¾ã™ï¼

---

## ğŸ‘¤ User
*2024-12-18 17:41:51*

ãƒãƒ†ã‚£ãƒ•ã‚¡ã‚¤ã‚¢ã‚’ä½¿ã†ãªã‚‰ãƒªãƒãƒ¼ãƒãƒƒãƒ‰ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§è‡ªå‹•ç”Ÿæˆã—ãŸã„

---

## ğŸ¤– Assistant
*2024-12-18 17:42:41*

Riverpod ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ `StateNotifier` ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚³ãƒ¼ãƒ‰ã®è¨˜è¿°ãŒç°¡æ½”ã«ãªã‚Šã€ã‚ˆã‚Šãƒ¢ãƒ€ãƒ³ãªé–‹ç™ºä½“é¨“ã‚’å¾—ã‚‰ã‚Œã¾ã™ã€‚

ä»¥ä¸‹ã¯ã€èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç®¡ç†ã—ã€APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã§å‹•çš„ã«ã‚ªãƒ¼ã‚½ãƒ©ã‚¤ã‚ºãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¨­å®šã™ã‚‹ã‚³ãƒ¼ãƒ‰ä¾‹ã§ã™ã€‚

---

## **æº–å‚™**

1. **å¿…è¦ãªä¾å­˜é–¢ä¿‚ã‚’è¿½åŠ **
   `pubspec.yaml` ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ã€‚

   ```yaml
   dependencies:
     flutter:
       sdk: flutter
     flutter_riverpod: ^2.0.0

   dev_dependencies:
     build_runner: ^2.0.0
     riverpod_generator: ^2.0.0
   ```

2. **è‡ªå‹•ç”Ÿæˆã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ**
   æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¾ã™ã€‚

   ```bash
   flutter pub run build_runner build
   ```

---

## **èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†ã®å®Ÿè£…**

ä»¥ä¸‹ã¯ Riverpod ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ãŸã‚³ãƒ¼ãƒ‰ä¾‹ã§ã™ã€‚

### **1. AuthNotifier ã®å®šç¾©**
èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®ç®¡ç†ã‚’è‡ªå‹•ç”Ÿæˆå¯¾å¿œã«ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

```dart
import 'package:riverpod_annotation/riverpod_annotation.dart';

part 'auth_provider.g.dart';

@riverpod
class AuthNotifier extends _$AuthNotifier {
  @override
  String? build() {
    // åˆæœŸçŠ¶æ…‹ã§ã¯ãƒˆãƒ¼ã‚¯ãƒ³ã¯null
    return null;
  }

  // èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã¦ä¿å­˜
  Future<void> fetchAuthToken() async {
    final token = await _authenticateUser();
    state = token; // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ›´æ–°
  }

  // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚¯ãƒªã‚¢
  void clearToken() {
    state = null;
  }

  // ãƒ€ãƒŸãƒ¼ã®èªè¨¼APIå‘¼ã³å‡ºã—
  Future<String> _authenticateUser() async {
    await Future.delayed(Duration(seconds: 1)); // ãƒ€ãƒŸãƒ¼ã®é…å»¶
    return "example_auth_token";
  }
}
```

---

### **2. Dio ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®è¨­å®š**

Dio ã‚’åˆ©ç”¨ã—ã¦ã€ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒ˜ãƒƒãƒ€ãƒ¼ã«å‹•çš„ã«è¿½åŠ ã™ã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã‚’è¨­å®šã—ã¾ã™ã€‚

```dart
import 'package:dio/dio.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'auth_provider.dart';

final dioProvider = Provider<Dio>((ref) {
  final dio = Dio();

  // ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã‚’è¿½åŠ 
  dio.interceptors.add(
    InterceptorsWrapper(
      onRequest: (options, handler) {
        // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
        final token = ref.read(authNotifierProvider);
        if (token != null) {
          // Authorizationãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ã‚»ãƒƒãƒˆ
          options.headers['Authorization'] = 'Bearer $token';
        }
        return handler.next(options);
      },
    ),
  );

  return dio;
});
```

---

### **3. UIã§ã®åˆ©ç”¨**

èªè¨¼çŠ¶æ…‹ã‚’åæ˜ ã™ã‚‹ UI ã‚’ä½œæˆã—ã¾ã™ã€‚

```dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'auth_provider.dart';
import 'dio_provider.dart';

class AuthScreen extends ConsumerWidget {
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final authState = ref.watch(authNotifierProvider);

    return Scaffold(
      appBar: AppBar(title: Text('èªè¨¼ç”»é¢')),
      body: Center(
        child: authState == null
            ? ElevatedButton(
                onPressed: () async {
                  // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
                  await ref.read(authNotifierProvider.notifier).fetchAuthToken();
                },
                child: Text('ãƒ­ã‚°ã‚¤ãƒ³'),
              )
            : Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  Text('ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—æ¸ˆã¿: $authState'),
                  ElevatedButton(
                    onPressed: () async {
                      // APIãƒªã‚¯ã‚¨ã‚¹ãƒˆ
                      final dio = ref.read(dioProvider);
                      final response = await dio.get('https://example.com/api/data');
                      print(response.data);
                    },
                    child: Text('APIãƒªã‚¯ã‚¨ã‚¹ãƒˆ'),
                  ),
                  ElevatedButton(
                    onPressed: () {
                      // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚¯ãƒªã‚¢
                      ref.read(authNotifierProvider.notifier).clearToken();
                    },
                    child: Text('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ'),
                  ),
                ],
              ),
      ),
    );
  }
}
```

---

## **èª¬æ˜**

1. **`AuthNotifier`**
   - Riverpod ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ `AuthNotifier` ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã€‚
   - ãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾— (`fetchAuthToken`) ã¨ã‚¯ãƒªã‚¢ (`clearToken`) ã‚’ç®¡ç†ã€‚

2. **è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼**
   - `@riverpod` ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ã†ã“ã¨ã§ã€`authNotifierProvider` ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ã€‚
   - ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼åã¯ã€ã‚¯ãƒ©ã‚¹åã«åŸºã¥ã„ã¦ç”Ÿæˆã•ã‚Œã¾ã™ã€‚

3. **Dio ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ**
   - ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒ˜ãƒƒãƒ€ãƒ¼ã«è¿½åŠ ã™ã‚‹ãŸã‚ã« `dioProvider` ã‚’è¨­å®šã€‚
   - ãƒˆãƒ¼ã‚¯ãƒ³ã¯ `authNotifierProvider` ã‹ã‚‰å‹•çš„ã«å–å¾—ã•ã‚Œã¾ã™ã€‚

4. **UI**
   - ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰ç„¡ã«ã‚ˆã£ã¦è¡¨ç¤ºå†…å®¹ã‚’åˆ‡ã‚Šæ›¿ãˆã€‚
   - ãƒœã‚¿ãƒ³ã§èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾—ã€APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã€ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãŒå¯èƒ½ã€‚

---

## **å‹•ä½œãƒ•ãƒ­ãƒ¼**

1. **ã€Œãƒ­ã‚°ã‚¤ãƒ³ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™**  
   â†’ èªè¨¼APIã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã€`AuthNotifier` ã® `state` ã‚’æ›´æ–°ã€‚
   
2. **APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡**  
   â†’ Dio ã®ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ãŒãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒ˜ãƒƒãƒ€ãƒ¼ã«è¿½åŠ ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å®Ÿè¡Œã€‚

3. **ã€Œãƒ­ã‚°ã‚¢ã‚¦ãƒˆã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™**  
   â†’ `state` ã‚’ `null` ã«ã—ã¦ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚¯ãƒªã‚¢ã€‚

---

## **åˆ©ç‚¹**
- **ã‚³ãƒ¼ãƒ‰ã®ç°¡æ½”åŒ–**: `@riverpod` ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’è‡ªå‹•ç”Ÿæˆã€‚
- **çŠ¶æ…‹ç®¡ç†ã®ä¸€å…ƒåŒ–**: ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†ã¨ API å‘¼ã³å‡ºã—ã‚’åˆ†é›¢ã€‚
- **æ‹¡å¼µæ€§**: ä»–ã®çŠ¶æ…‹ã‚„ä¾å­˜é–¢ä¿‚ã‚’ç°¡å˜ã«è¿½åŠ å¯èƒ½ã€‚

ã“ã®å®Ÿè£…ã«ã‚ˆã‚Šã€Riverpod ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®å¼·åŠ›ãªè‡ªå‹•ç”Ÿæˆæ©Ÿèƒ½ã‚’æ´»ã‹ã—ã¦ã€èªè¨¼å‡¦ç†ã‚’åŠ¹ç‡ã‚ˆãå®Ÿç¾ã§ãã¾ã™ï¼

---

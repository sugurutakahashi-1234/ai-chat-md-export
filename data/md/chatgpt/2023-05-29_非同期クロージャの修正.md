# 非同期クロージャの修正

Date: 2023-05-29

---

## 👤 User
*2023-05-30 04:11:50*

以下のエラーが発生している

Cannot convert value of type '(_) -&gt; InputtedUserAttributes' to specified type '(() async throws -&gt; (InputtedUserAttributes))?'

```
var fetchInputtedUserAttributesHandler: (() async throws -> (InputtedUserAttributes))? = { _ in
        InputtedUserAttributes(
            nickName: "ニックネーム",
            gender: .init(id: "1", name: "gender"),
            birthday: Date.random(offset: 100),
            location: .init(id: "2", name: "location"),
            residenceType: .init(id: "3", name: "residenceType"),
            householdSize: .init(id: "4", name: "householdSize"),
            houseAnnualIncome: .init(id: "5", name: "houseAnnualIncome"),
            occupation: .init(id: "6", name: "occupation"),
            industry: .init(id: "7", name: "industry"),
            annualIncome: .init(id: "8", name: "annualIncome"),
            education: .init(id: "9", name: "education")
        )
    }

```

---

## 🤖 Assistant
*2023-05-30 04:12:40*

エラーメッセージによれば、指定されている型`(() async throws -> (InputtedUserAttributes))?`とクロージャ`(_) -> InputtedUserAttributes`の型が一致していないため、この問題が発生しています。

あなたが示してくれたコードスニペットでは、`fetchInputtedUserAttributesHandler`は引数を取らない非同期のクロージャを期待しています。しかし、提供されているクロージャは引数を取る形になっています。

Swift 5.5から非同期処理のための新しい機能が追加され、関数やクロージャで非同期操作を表現するためには`async`キーワードを使用します。エラーの型には非同期クロージャが要求されていますので、`async`キーワードを使用して非同期クロージャを定義しましょう。

また、クロージャが引数を取らないことを明示するために、引数の部分`_ in`を削除します。

以下に修正後のコードを示します：

```swift
var fetchInputtedUserAttributesHandler: (() async throws -> (InputtedUserAttributes))? = { 
        InputtedUserAttributes(
            nickName: "ニックネーム",
            gender: .init(id: "1", name: "gender"),
            birthday: Date.random(offset: 100),
            location: .init(id: "2", name: "location"),
            residenceType: .init(id: "3", name: "residenceType"),
            householdSize: .init(id: "4", name: "householdSize"),
            houseAnnualIncome: .init(id: "5", name: "houseAnnualIncome"),
            occupation: .init(id: "6", name: "occupation"),
            industry: .init(id: "7", name: "industry"),
            annualIncome: .init(id: "8", name: "annualIncome"),
            education: .init(id: "9", name: "education")
        )
    }
```

ただし、上記の修正後のコードは非同期クロージャを定義していますが、クロージャ内のコードは非同期で実行する必要がないように見えます。したがって、非同期クロージャを期待する理由がなければ、`fetchInputtedUserAttributesHandler`の型を`(() -> (InputtedUserAttributes))?`に変更することを考慮してみてください。

---

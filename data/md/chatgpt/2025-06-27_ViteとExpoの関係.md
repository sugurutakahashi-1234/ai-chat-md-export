# ViteとExpoの関係

Date: 2025-06-27

---

## 👤 User
*2025-06-27 09:28:35*

viteって完全にWebの技術でReact Native の expoでは全く関係ない話かな

---

## 🤖 Assistant
*2025-06-27 09:28:54*

ほぼそのとおりです。要点をまとめると — 

### 1. Vite は「ブラウザ（Web）」向けのビルドツール
* Vite は ESModules を直接配信し、開発中の HMR（ホットリロード）が高速、という **Web 専用ツール** です。citeturn3search3

### 2. Expo / React Native で使われるのは Metro
* React Native（素の RN でも Expo でも）は **Metro** という独自バンドラが標準で、ネイティブ向け JavaScript バンドルを生成します。Web でも 2024 年末に webpack から Metro に統一されました。citeturn0search3turn3search4  
* Metro はバンドル形式・トランスパイル・アセット解決などが「RN 向け」に最適化されており、Vite に置き換えると多くのネイティブ-モジュール（`react-native-svg` など）が動かなくなります。

### 3. 「Expo で Vite」を試す余地は“Web だけ”に限られる
* **Web 出力だけを Vite で置き換える** 手法は、一部コミュニティが検証していますが公式サポートはありません。GitHub でも「今は難しい」という結論が繰り返し議論されています。citeturn2search1
* ネイティブ / Web 共通コードを持ちつつ、Web だけ Vite でビルドするワークアラウンド（`react-native-web` + Vite）なら実例があります。citeturn4view0  
  * ただし **Expo CLI の `npx expo start` では切り替えられない** ので、別ディレクトリで Vite 用エントリーポイントを用意する、CI を分ける、など運用コストが増えます。  
  * Expo SDK 53 以降は Web も Metro に統一されたため、このルートはさらに「非公式で要メンテ」という位置付けです。

### 4. 結論
* **ネイティブアプリ部分には Vite は関係しない** ─ Metro が前提。  
* **Expo プロジェクトを“Web サイトとしても高速化したい”** という場合に限り、Web 専用で Vite を導入する手はあるが、公式ではなく自己責任。  
* Expo/React Native をメインターゲットにするなら「Metro 前提で考え、Web パフォーマンスは別手段（コード分割、遅延読み込みなど）で最適化」が現実的です。

---

## 👤 User
*2025-06-27 09:29:52*

Metroの次と言われているものはあるのか？
またMetro一強なのか？

---

## 🤖 Assistant
*2025-06-27 09:30:15*

### Metroを取り巻く 2025 年の最新状況

| 項目 | 現状 | 補足 |
|------|------|------|
| **公式サポート** | **Metro 0.82 〜 0.83（いわゆる *Metro 3.0* 相当）** が React Native 0.79/0.80 に同梱 | 冷スタートが **最大 3 倍高速**・`package.exports` 対応など多数の改良citeturn2search5turn2search3 |
| **将来ロードマップ** | 公式ブログでは “Metro を Rust などに全面置換する予定はなく、**既存コードを磨き続ける**” 方針 | 大幅リライトより **プラグイン拡張**路線（例 : `metro-serializer-esbuild`）citeturn3search0 |
| **エコシステム浸透度** | Expo CLI・React Native CLI とも **デフォルト＝Metro**。HMR、Hermes との統合、DevTools 連携などで **依存度が高く代替しにくい** | |

---

## 「Metro の次」と言われる主な選択肢

| バンドラ | コア技術 | 強み | 現状 / 制限 |
|----------|---------|------|-------------|
| **Re.Pack**（Callstack） | Webpack 5 | *Module Federation*・ツリーシェイク・動的コード分割。大規模アプリで**マイクロフロントエンド**構成が可能 | 追加設定が多い／iOS & Android のネイティブ依存ライブラリでパッチが必要な場合ありciteturn0search1turn4view0 |
| **react-native-esbuild** | esbuild | バンドル速度が Metro 比 **5-10×** 報告。設定は比較的シンプル | サードパーティモジュールで未対応ケース。公式 HMR に比べライブリロードが限定的citeturn0search1turn0search5 |
| **rnx-kit / metro-serializer-esbuild**（Microsoft） | Metro＋esbuild プラグイン | “**Metro 上で esbuild が動く**”ため既存 DevFlow を保持しつつ高速化 | **β版**。Hermes バイトコードが Metro より大きくなる事例ありciteturn3search0turn3search4 |
| **One** フレームワーク | Vite + React Native | **Vite を RN でも使う**実験的プロジェクト。Web／Native 同一ソースを Vite で配信 | まだ技術検証段階・Expo/CLI 非公式citeturn0search0 |
| 過去の選択肢（Haul など） | Webpack 4 系 | 現在ほぼメンテ停止 | — |

&gt; 📝 **ポイント**  
&gt; * どの代替バンドラも *「Metro API とのギャップをどう埋めるか」* が本質課題。  
&gt; * Re.Pack は実運用例が増えつつある一方、**Expo SDK 53 以降は Metro 前提がより強固**になり、Webpack 系は “カスタム eject” 運用が必須。  
&gt; * esbuild 系は **ビルド時間短縮**に魅力があるが、Hermes バイトコードサイズや iOS Bitcode 互換性など細部で検証要。  

---

## まとめ ― Metro 一強か？

1. **公式 = Metro が今後も続く見込み**  
   * React Native 本体・Expo のリリースノートの語調は「Metro を磨き上げる」方向で、置き換え計画は明言されていません。  
   * 新機能 (`package.exports`・Deferred Hashing 等) はすべて Metro にまず着地していますciteturn2search5turn2search6。

2. **とはいえ “次世代” の芽は複数**  
   * **Re.Pack** が *Module Federation* 需要で急伸。  
   * **esbuild 系**（rnx-kit, react-native-esbuild）が「速さ」で注目。  
   * **Vite 系統**（One）はクロスプラットフォーム統合を模索。

3. **選定指針（2025 年時点）**
   | 使い続ける | 乗り換え検討 |
   |------------|--------------|
   | **標準的 Expo / RN App**&lt;br&gt;Hermes・DevMenu・OTA アップデートをフル活用 | *ネイティブ + マイクロフロントエンド* を導入したい&lt;br&gt;**Web と同一ビルド基盤**に揃えたい&lt;br&gt;CI 時間短縮が最優先で、Metro ではボトルネック |

   移行には「Metro 用 Babel 設定 → Webpack/esbuild 設定」移行や `react-native-svg`, `react-native-reanimated` など **C++/JSI 系モジュールのパッチ適用** が伴うため、**PoC で効果を測ってから段階導入**が現実的です。

&gt; 👀 **結論**  
&gt; * **Metro は 2025 年も “事実上のデフォルト”**。特に Expo ユーザーは Metro 以外を選ぶとサポート外になる点に注意。  
&gt; * ただし **Re.Pack（Webpack 5）と esbuild 系プラグイン** はパフォーマンス／モジュール分割面で実戦投入例が増加。「次」候補というより **ニッチを埋める強力な選択肢** と位置付けられます。

---

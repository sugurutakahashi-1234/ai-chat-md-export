# カード中央配置調整

日付: 2025-01-08

---

## 👤 ユーザー
*2025/01/08 19:23:40*

{
  "content_type": "image_asset_pointer",
  "asset_pointer": "file-service://file-4t5DHqotmP3dd6oAoVpbJV",
  "size_bytes": 333842,
  "width": 1236,
  "height": 1150,
  "fovea": null,
  "metadata": {
    "dalle": null,
    "gizmo": null,
    "generation": null,
    "container_pixel_height": null,
    "container_pixel_width": null,
    "emu_omit_glimpse_image": null,
    "emu_patches_override": null,
    "sanitized": true,
    "asset_pointer_link": null,
    "watermarked_asset_pointer": null
  }
}
{
  "content_type": "image_asset_pointer",
  "asset_pointer": "file-service://file-2bDYSABpQ2j72Bu3y32TZu",
  "size_bytes": 203929,
  "width": 766,
  "height": 784,
  "fovea": null,
  "metadata": {
    "dalle": null,
    "gizmo": null,
    "generation": null,
    "container_pixel_height": null,
    "container_pixel_width": null,
    "emu_omit_glimpse_image": null,
    "emu_patches_override": null,
    "sanitized": true,
    "asset_pointer_link": null,
    "watermarked_asset_pointer": null
  }
}
2枚目が現時点での実装であるが、1枚目のように実装したい。
カードの幅を画面の横幅のhorizonの32の余白を持つ横幅にしてほしい。
また、カードの下側の余白を無くしてほしいのと中央に配置してほしい。

import 'package:carousel_slider/carousel_slider.dart';
import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:geolocator/geolocator.dart';
import 'package:go_router/go_router.dart';
import 'package:google_maps_flutter/google_maps_flutter.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:snpit_guild_app/infrastructure/snapit_guild_api/snapit_guild_api.openapi.dart';
import 'package:snpit_guild_app/presentation/design_token/color_token.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/explorers/get_explorer_info.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/explorers/update_explorer.dart';

class ExplorerListPage extends HookConsumerWidget {
  const ExplorerListPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final selectedExplorerIndex = useState(0);
    final explorerState = ref.watch(getExplorerNotifierProvider);

    useEffect(
      () {
        WidgetsBinding.instance.addPostFrameCallback((_) {
          ref.read(getExplorerNotifierProvider.notifier).executeRequest();
        });
        return null;
      },
      [],
    );

    Widget buildExplorerCard(ExplorerDTO explorer, {required bool isSelected}) {
      final imageUrl = explorer.explorerImage?.isNotEmpty == true
          ? explorer.explorerImage
          : null;

      return Card(
        shape: RoundedRectangleBorder(
          borderRadius: BorderRadius.circular(16),
          side: BorderSide(
            color: isSelected ? ColorToken.primary : ColorToken.secondary,
          ),
        ),
        color: ColorToken.bg,
        elevation: 4,
        child: Padding(
          padding: const EdgeInsets.all(16),
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              Row(
                children: [
                  ClipRRect(
                    borderRadius: BorderRadius.circular(8),
                    child: imageUrl != null
                        ? Image.network(
                            imageUrl,
                            height: 120,
                            width: 120,
                            fit: BoxFit.cover,
                            errorBuilder: (context, error, stackTrace) {
                              return Container(
                                width: 120,
                                height: 120,
                                color: ColorToken.bgDark,
                                child: const Icon(
                                  Icons.broken_image_outlined,
                                  size: 96,
                                  color: ColorToken.text,
                                ),
                              );
                            },
                          )
                        : Container(
                            width: 120,
                            height: 120,
                            color: ColorToken.bgDark,
                            child: const Icon(
                              Icons.hide_image_outlined,
                              size: 96,
                              color: ColorToken.text,
                            ),
                          ),
                  ),
                  Expanded(
                    child: Column(
                      mainAxisSize: MainAxisSize.min,
                      crossAxisAlignment: CrossAxisAlignment.start,
                      children: [
                        const Text(
                          'Life',
                          style: TextStyle(
                            fontSize: 14,
                            color: ColorToken.border,
                          ),
                        ),
                        const SizedBox(height: 4),
                        LinearProgressIndicator(
                          value: (explorer.energy ?? 0) / 100,
                          valueColor: const AlwaysStoppedAnimation&lt;Color&gt;(
                            ColorToken.primary,
                          ),
                          backgroundColor: ColorToken.bgDark,
                        ),
                        const SizedBox(height: 12),
                        const Text(
                          'Search range',
                          style: TextStyle(
                            fontSize: 14,
                            color: ColorToken.border,
                          ),
                        ),
                        const SizedBox(height: 4),
                        Text(
                          '${explorer.range ?? 0}km radius',
                          style: const TextStyle(
                            fontSize: 14,
                          ),
                        ),
                        const SizedBox(height: 12),
                        Text(
                          explorer.explorerDescription ?? 'No description',
                          style: const TextStyle(
                            fontSize: 12,
                          ),
                        ),
                      ],
                    ),
                  ),
                ],
              ),
            ],
          ),
        ),
      );
    }

    return Scaffold(
      appBar: AppBar(
        automaticallyImplyLeading: false,
        title: const Text('Select explorer'),
        actions: [
          IconButton(
            onPressed: () =&gt; context.pop(),
            icon: const Icon(Icons.close),
          ),
        ],
      ),
      body: explorerState.when(
        data: (explorers) {
          if ((explorers ?? []).isEmpty) {
            return const Center(child: Text('No explorers available.'));
          }

          return Column(
            children: [
              Expanded(
                child: CarouselSlider.builder(
                  options: CarouselOptions(
                    onPageChanged: (index, reason) {
                      selectedExplorerIndex.value = index;
                    },
                  ),
                  itemCount: explorers?.length ?? 0,
                  itemBuilder: (context, index, realIndex) {
                    final explorer = explorers?[index];
                    final isSelected = index == selectedExplorerIndex.value;

                    return Padding(
                      padding: const EdgeInsets.symmetric(horizontal: 8),
                      child: explorer != null
                          ? buildExplorerCard(explorer, isSelected: isSelected)
                          : null,
                    );
                  },
                ),
              ),
            ],
          );
        },
        loading: () =&gt; const Center(child: CircularProgressIndicator()),
        error: (error, _) =&gt; Center(child: Text('Error: $error')),
      ),
      bottomNavigationBar: SafeArea(
        child: Padding(
          padding: const EdgeInsets.all(16),
          child: ElevatedButton(
            onPressed: () async {
              final explorers = explorerState.value;
              if (explorers != null && explorers.isNotEmpty) {
                final position = await Geolocator.getCurrentPosition();
                final selectedExplorer = explorers[selectedExplorerIndex.value];
                await ref.read(updateExplorerNotifierProvider.notifier).search(
                      selectedExplorer.explorerId!,
                      LatLng(position.latitude, position.longitude),
                    );
              }

              if (context.mounted) {
                context.pop();
              }
            },
            child: const Text('Start explore'),
          ),
        ),
      ),
    );
  }
}

---

## 🤖 アシスタント
*2025/01/08 19:24:45*

以下のポイントを押さえることで、

1. **カード幅を画面横幅−左右32px（合計64px）にする**  
2. **カードの下余白をなくす**  
3. **中央に配置する**

といった要件を満たせます。

---

## カギとなる設定

1. **`Card`ウィジェットの`margin`をゼロにする**  
   - `Card`にはデフォルトで4px程度のマージンが付いています。これを消すために `margin: EdgeInsets.zero` を設定します。  

2. **上下余白の調整**  
   - カード自体の下余白をなくしたい場合は、`Card`の外側（例えば `Padding` や `Margin`) を含め、不要な上下のパディングをゼロにするようにします。

3. **左右32px分を確保した幅にする**  
   - `CarouselSlider` の `viewportFraction` を使う方法  
     - 画面幅に対して「左右で合計32pxの余白を除いた割合」にします。例えば画面幅を `W` とすると `(W - 64) / W` がカード幅の割合になります。  
     - ただし、実機によって画面幅が異なるため、細かい制御が必要な場合は `LayoutBuilder` や `MediaQuery` を用いて動的に計算する方法もあります。
   - `CarouselSlider` の `enlargeCenterPage` を使う/使わない  
     - 中央に拡大表示したい場合は `enlargeCenterPage: true` を使い、拡大は不要でただ中央配置だけにしたい場合はオフにし、`viewportFraction` だけで調整します。  
   - `Padding` のみで調整する方法  
     - `itemBuilder` 内で `SizedBox(width: MediaQuery.of(context).size.width - 64, child: Card(...))` のようにして、左右に32pxずつ空ける方法もあります。

---

## 実装例

以下の例では、

- カードの幅が画面幅から左右32px(計64px)を引いたサイズになるように  
- カード下余白をなくし、中央に表示  
- ページ切り替え時には中央にカーソルが合うように  

という設定をしています。

```dart
import 'package:carousel_slider/carousel_slider.dart';
import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:geolocator/geolocator.dart';
import 'package:go_router/go_router.dart';
import 'package:google_maps_flutter/google_maps_flutter.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:snpit_guild_app/infrastructure/snapit_guild_api/snapit_guild_api.openapi.dart';
import 'package:snpit_guild_app/presentation/design_token/color_token.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/explorers/get_explorer_info.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/explorers/update_explorer.dart';

class ExplorerListPage extends HookConsumerWidget {
  const ExplorerListPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final selectedExplorerIndex = useState(0);
    final explorerState = ref.watch(getExplorerNotifierProvider);

    useEffect(() {
      WidgetsBinding.instance.addPostFrameCallback((_) {
        ref.read(getExplorerNotifierProvider.notifier).executeRequest();
      });
      return null;
    }, []);

    Widget buildExplorerCard(
      ExplorerDTO explorer, {
      required bool isSelected,
    }) {
      final imageUrl =
          explorer.explorerImage?.isNotEmpty == true ? explorer.explorerImage : null;

      return Card(
        // ★ カード外側の余白を消す
        margin: EdgeInsets.zero,
        shape: RoundedRectangleBorder(
          borderRadius: BorderRadius.circular(16),
          side: BorderSide(
            color: isSelected ? ColorToken.primary : ColorToken.secondary,
          ),
        ),
        color: ColorToken.bg,
        elevation: 4,
        child: Padding(
          padding: const EdgeInsets.all(16),
          child: Column(
            // 下部に余白を作りたくない場合などはここで配置を見直す
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              Row(
                children: [
                  ClipRRect(
                    borderRadius: BorderRadius.circular(8),
                    child: imageUrl != null
                        ? Image.network(
                            imageUrl,
                            height: 120,
                            width: 120,
                            fit: BoxFit.cover,
                            errorBuilder: (context, error, stackTrace) {
                              return Container(
                                width: 120,
                                height: 120,
                                color: ColorToken.bgDark,
                                child: const Icon(
                                  Icons.broken_image_outlined,
                                  size: 96,
                                  color: ColorToken.text,
                                ),
                              );
                            },
                          )
                        : Container(
                            width: 120,
                            height: 120,
                            color: ColorToken.bgDark,
                            child: const Icon(
                              Icons.hide_image_outlined,
                              size: 96,
                              color: ColorToken.text,
                            ),
                          ),
                  ),
                  const SizedBox(width: 16),
                  Expanded(
                    child: Column(
                      crossAxisAlignment: CrossAxisAlignment.start,
                      children: [
                        const Text(
                          'Life',
                          style: TextStyle(
                            fontSize: 14,
                            color: ColorToken.border,
                          ),
                        ),
                        const SizedBox(height: 4),
                        LinearProgressIndicator(
                          value: (explorer.energy ?? 0) / 100,
                          valueColor: const AlwaysStoppedAnimation<Color>(
                            ColorToken.primary,
                          ),
                          backgroundColor: ColorToken.bgDark,
                        ),
                        const SizedBox(height: 12),
                        const Text(
                          'Search range',
                          style: TextStyle(
                            fontSize: 14,
                            color: ColorToken.border,
                          ),
                        ),
                        const SizedBox(height: 4),
                        Text(
                          '${explorer.range ?? 0}km radius',
                          style: const TextStyle(fontSize: 14),
                        ),
                        const SizedBox(height: 12),
                        Text(
                          explorer.explorerDescription ?? 'No description',
                          style: const TextStyle(fontSize: 12),
                        ),
                      ],
                    ),
                  ),
                ],
              ),
            ],
          ),
        ),
      );
    }

    return Scaffold(
      appBar: AppBar(
        automaticallyImplyLeading: false,
        title: const Text('Select explorer'),
        actions: [
          IconButton(
            onPressed: () => context.pop(),
            icon: const Icon(Icons.close),
          ),
        ],
      ),
      body: explorerState.when(
        data: (explorers) {
          if ((explorers ?? []).isEmpty) {
            return const Center(child: Text('No explorers available.'));
          }

          return Column(
            children: [
              Expanded(
                child: CarouselSlider.builder(
                  itemCount: explorers?.length ?? 0,
                  itemBuilder: (context, index, realIndex) {
                    final explorer = explorers?[index];
                    final isSelected = index == selectedExplorerIndex.value;
                    if (explorer == null) return const SizedBox();

                    return Center(
                      // ★ カードの幅を画面幅 - 64 に固定し、左右32pxずつ余白を確保
                      child: SizedBox(
                        width: MediaQuery.of(context).size.width - 64,
                        child: buildExplorerCard(explorer, isSelected: isSelected),
                      ),
                    );
                  },
                  options: CarouselOptions(
                    // カードを真ん中に配置 & スライド切り替え時のアニメを設定
                    enlargeCenterPage: false, // 必要であればtrueにすると中央のみ拡大
                    enableInfiniteScroll: false,
                    // 画面幅に対するカードの占有割合を設定
                    // viewportFractionを (画面幅 - 64)/画面幅 に合わせてもOK
                    viewportFraction: 1.0, 
                    onPageChanged: (index, reason) {
                      selectedExplorerIndex.value = index;
                    },
                  ),
                ),
              ),
            ],
          );
        },
        loading: () => const Center(child: CircularProgressIndicator()),
        error: (error, _) => Center(child: Text('Error: $error')),
      ),
      bottomNavigationBar: SafeArea(
        child: Padding(
          padding: const EdgeInsets.all(16),
          child: ElevatedButton(
            onPressed: () async {
              final explorers = explorerState.value;
              if (explorers != null && explorers.isNotEmpty) {
                final position = await Geolocator.getCurrentPosition();
                final selectedExplorer = explorers[selectedExplorerIndex.value];
                await ref.read(updateExplorerNotifierProvider.notifier).search(
                      selectedExplorer.explorerId!,
                      LatLng(position.latitude, position.longitude),
                    );
              }

              if (context.mounted) {
                context.pop();
              }
            },
            child: const Text('Start explore'),
          ),
        ),
      ),
    );
  }
}
```

### ポイント解説

- **`SizedBox` で幅を `MediaQuery.of(context).size.width - 64`**  
  これにより、左右に32pxずつ余白が生まれ、カードの幅が「画面幅 - 64」に固定されます。

- **`Card(margin: EdgeInsets.zero)`**  
  デフォルトの `Card` マージンを削除して、不要な余白をなくしています。

- **`CarouselOptions(viewportFraction: 1.0)`**  
  `viewportFraction` を `1.0` にすることで、スライド1枚あたり画面幅いっぱいに使うようになります。そのうえで `SizedBox` で実際のカード幅を制御しているので、結果的に中央にそろったカード表示になります。

- **下側の余白をなくす**  
  カード下部に余白を付けるパディングや`SizedBox(height: ...)` を入れていないため、下部の余白がありません。もし親のレイアウト側で余白ができている場合は、その箇所を調整する必要があります。

上記を参考に調整すれば、
- **左右32pxの余白**  
- **下余白ゼロ**  
- **中央配置**  

が実現できます。お試しください。

---

## 👤 ユーザー
*2025/01/08 22:02:35*

SizedBox 使ってもサイズが指定できなかった

---

## 🤖 アシスタント
*2025/01/08 22:03:13*

CarouselSlider は内部で独自のレイアウト制御を行うため、単に `SizedBox(width: xxx)` を配置しても思った通りにサイズが反映されないケースがあります。  

Flutter では **「親子の制約」** によってウィジェットのサイズが決まるため、CarouselSlider からどのような制約がかかっているかを理解しておく必要があります。  

以下のような方法を試すと、カード幅をうまく固定できる可能性が高いです。

---

## 1. `viewportFraction` を使ってカード幅を制御する

`CarouselOptions` の `viewportFraction` プロパティで「画面幅に対してどのくらいの割合を表示するか」を指定します。

たとえば、
```dart
viewportFraction: 0.9,
```
とすれば **画面幅の 90%** の幅でカードが表示されます。左右の 10% は余白（または他のカードの一部）として見えます。

#### 画面幅 - 64px 分を割合で計算する

左右に 32px ずつ余白をとって合計 64px を空けたい場合、画面幅を `W` とすると

```
(W - 64) / W
```

がそのまま割合になります。 画面幅が 360px の場合を例にすると

```
(360 - 64) / 360 = 296 / 360 ≈ 0.82
```

この値を `viewportFraction` に設定してみてください。

```dart
CarouselSlider.builder(
  options: CarouselOptions(
    viewportFraction: (MediaQuery.of(context).size.width - 64) /
        MediaQuery.of(context).size.width,
    // 例: enlargeCenterPage などはお好みで
    enlargeCenterPage: false,
  ),
  itemCount: ...,
  itemBuilder: (context, index, realIndex) {
    return Card(/* ... */);
  },
)
```

これでカード一枚あたりが「画面幅 - 64px」の大きさを基準に配置されるようになります。  

- `enlargeCenterPage: false` にすると中央拡大が無効になるため、ちょうど左右 32px が余るように見えやすくなります。  
- `enlargeCenterPage: true` を使いたい場合は、拡大率でまた見た目が変わるのでバランスを見ながら調整が必要です。

---

## 2. `itemWidth` と `itemHeight` を指定する

`CarouselOptions` の中には、`viewportFraction` 以外に `itemWidth` や `itemHeight` も存在します。これらは **固定ピクセル** でウィジェット幅や高さを決めたいときに使います。

```dart
CarouselSlider.builder(
  options: CarouselOptions(
    // たとえば 「画面幅 - 64px」 をそのまま指定
    itemWidth: MediaQuery.of(context).size.width - 64,
    // 高さも固定したい場合
    itemHeight: 400,
    enlargeCenterPage: false,
    enableInfiniteScroll: false,
  ),
  itemCount: ...,
  itemBuilder: (context, index, realIndex) {
    return Card(/* ... */);
  },
)
```

- `itemWidth` を指定すると、CarouselSlider 側は「1 つのカードの幅はこれ」と解釈し、スライドをレイアウトします。  
- `viewportFraction` と `itemWidth` は同時に指定することもできますが、基本的にどちらか片方を使えば十分です。  

---

## 3. `SizedBox` で包む場合のポイント

もし `SizedBox`(width: ...) で明示的に幅を設定したい場合は、**`CarouselOptions(viewportFraction: 1.0)`** にしてあげると、CarouselSlider が「横幅いっぱい使っていいよ」という制約を子へ渡すため、子の `SizedBox(width: ...)` が有効になりやすくなります。

```dart
CarouselSlider.builder(
  options: CarouselOptions(
    viewportFraction: 1.0,   // 親としては横幅100%を渡すイメージ
    enlargeCenterPage: false,
  ),
  itemCount: ...,
  itemBuilder: (context, index, realIndex) {
    return Center(
      child: SizedBox(
        width: MediaQuery.of(context).size.width - 64,
        child: Card(/* ... */),
      ),
    );
  },
)
```

- ただし、CarouselSlider 自体が行うスワイプ方向のレイアウト(左右にスライド)を考慮すると、`viewportFraction: 1.0` を使う場合は「隣のカードがはみ出して見える」という UI にはならず、完全に 1 ページ＝1 カード という見え方になります。  
- 他のカードをちら見せしたいようなデザインの場合は、`viewportFraction` を 0.8 〜 0.9 程度にし、横幅に余裕を持たせます。

---

## 4. カード下側の余白をなくす

`Card` はデフォルトでいくつかのマージンが付いていますが、Flutter のバージョンによっては `Card` の外側に余白がない場合もあります。もし下余白が気になる場合は、以下をチェックしましょう。

1. `Card( margin: EdgeInsets.zero, ... )` で外側マージンを明示的にゼロにする。  
2. `Padding` や `SizedBox(height: ...)` をどこかで入れていないか確認する。  
3. 親ウィジェット(例えば `Padding` など)が下方向に余白を作っていないか確認する。  

CarouselSlider 自体が下に余白を加えることはあまりないので、主に `Card` や親レイアウトの余白を見直してください。

---

## まとめ

- **「CarouselSlider でカードの幅をコントロールする」＝ `viewportFraction` or `itemWidth` を使う**  
- `SizedBox` だけでサイズ指定がうまくいかない場合は、CarouselSlider 側の `viewportFraction` や `itemWidth` と併用するか、`viewportFraction: 1.0` にしてカードを中央に固定幅で出すのが簡単。  
- カードの下側余白は `Card` の `margin` や `Padding` を再度確認して調整。  

上記を組み合わせることで、「横幅を画面幅 - 64px にして、下余白なしで中央寄せ表示する」レイアウトが実現できるはずです。ぜひお試しください。

---

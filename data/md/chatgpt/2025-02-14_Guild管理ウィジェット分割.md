# Guildç®¡ç†ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆåˆ†å‰²

Date: 2025-02-14

---

## ğŸ‘¤ User
*2025-02-14 15:33:02*

Widget _buildGuildManagementContent({ ã‚’å®šç¾©ã—ã¦ã„ã‚‹ãŒã€å…¨ä½“çš„ã«refã®å¼•æ•°ã‚’å¼•ãå›ã™ã®ãŒå¤§å¤‰ãªã®ã§ã€HookConsumerWidgetã§åˆ¥ã«å®šç¾©ã—ãŸæ–¹ãŒã„ã„æ°—ãŒã—ã¦ã„ã‚‹ã€‚

ãã—ã¦ã€ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¦ã„ã‚‹ä»¥ä¸‹ã®å‡¦ç†ã‚’å®Ÿéš›ã«é©å¿œã•ã›ãŸã„ã€‚onTapDeleteGuildã¯ãã¡ã‚‰ã®HookConsumerWidgetã§å®šç¾©ã—ã¦æ–¹ãŒã„ã„ã¨æ€ã†ã€‚
ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã®å‡¦ç†ã‚‚ã—ãªã„ã¨ã„ã‘ãªã„ã®ã§ã€ãã‚Œã¯è€ƒãˆã¦æ¬²ã—ã„ã€‚

        // Padding(
        //   padding: const EdgeInsets.only(top: 24, bottom: 24),
        //   child: OutlinedButton(
        //     onPressed: isLoadingState.value
        //         ? null
        //         : () async {
        //             await onTapDeleteGuild();
        //           },
        //     child: const Text('Delete this guild'),
        //   ),
        // ),â€¨â€¨import 'dart:io';
import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:go_router/go_router.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:image_cropper/image_cropper.dart';
import 'package:image_picker/image_picker.dart';
import 'package:permission_handler/permission_handler.dart';
import 'package:snpit_guild_app/domain/design/color_pallet.dart';
import 'package:snpit_guild_app/domain/design/color_token.dart';
import 'package:snpit_guild_app/domain/screen.dart';
import 'package:snpit_guild_app/infrastructure/entities/extensions/camera_dto_x.dart';
import 'package:snpit_guild_app/infrastructure/snapit_guild_api/snapit_guild_api.openapi.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/guilds/delete_guild.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/guilds/get_guild.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/guilds/update_guild.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/guilds/update_guild_member.dart';
import 'package:snpit_guild_app/presentation/router/router.dart';
import 'package:snpit_guild_app/presentation/widgets/dialogs/delete_guild_dialog.dart';
import 'package:snpit_guild_app/presentation/widgets/guild_icon.dart';
import 'package:snpit_guild_app/presentation/widgets/guild_member_column.dart';
import 'package:snpit_guild_app/presentation/widgets/parameters_bar_column.dart';
import 'package:snpit_guild_app/utils/extensions/uri_extensions.dart';
import 'package:snpit_guild_app/utils/snack_bar_utils.dart';

class GuildManagePage extends HookConsumerWidget {
  const GuildManagePage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final picker = useMemoized(ImagePicker.new);
    final imageFileState = useState&lt;File?&gt;(null);
    final myGuildAsyncValue = ref.watch(getMyGuildNotifierProvider);
    final isLoadingState = useState(false);

    Future&lt;void&gt; onRefresh() async {
      try {
        await ref.read(getMyGuildNotifierProvider.notifier).getMyGuild();
      } on Exception catch (error) {
        if (context.mounted) {
          showErrorSnackBar(context, error);
        }
      }
    }

    Future&lt;void&gt; onTapDeleteGuild() async {
      final confirm = await showDialog&lt;bool&gt;(
        context: context,
        builder: (context) =&gt; const DeleteGuildDialog(),
      );

      if (confirm != true) {
        return;
      }

      try {
        await ref.read(deleteGuildNotifierProvider.notifier).deleteGuild();
        await onRefresh();

        if (context.mounted) {
          ScaffoldMessenger.of(context).showSnackBar(
            const SnackBar(
              content: Text('Guild deleted successfully.'),
            ),
          );
        }

        if (context.mounted) {
          context.pop();
        }
      } on Exception catch (error) {
        if (context.mounted) {
          showErrorSnackBar(context, error);
        }
      }
    }

    Future&lt;void&gt; pickAndCropImage() async {
      final pickedFile = await picker.pickImage(source: ImageSource.gallery);
      if (pickedFile == null) {
        debugPrint('Image selection cancelled');
        return;
      }

      final croppedFile = await ImageCropper().cropImage(
        sourcePath: pickedFile.path,
        aspectRatio: const CropAspectRatio(ratioX: 1, ratioY: 1),
        uiSettings: [
          AndroidUiSettings(
            hideBottomControls: true,
            lockAspectRatio: true,
          ),
          IOSUiSettings(
            aspectRatioLockEnabled: true,
          ),
        ],
      );

      if (croppedFile == null) {
        debugPrint('Cropping cancelled');
        return;
      }

      if (!context.mounted) {
        return;
      }

      imageFileState.value = File(croppedFile.path);
      debugPrint('Cropped image path: ${imageFileState.value!.path}');

      try {
        // TODO: [ãƒ•ã‚§ãƒ¼ã‚º2] ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãªã©é©åˆ‡ãª API å‘¼ã³å‡ºã—
        await ref.read(updateGuildNotifierProvider.notifier).updateGuildAvatar(
              UriExtensions.randomImageUrlWithTitle(
                // ignore: use_build_context_synchronously
                TimeOfDay.now().format(context),
              ).toString(),
            );

        if (context.mounted) {
          ScaffoldMessenger.of(context).showSnackBar(
            const SnackBar(
              content: Text('Updated Successfully'),
            ),
          );
        }

        await onRefresh();
      } on Exception catch (error) {
        if (context.mounted) {
          showErrorSnackBar(context, error);
        }
      }
    }

    Future&lt;void&gt; onTapGuildPhoto() async {
      await showDialog&lt;void&gt;(
        context: context,
        builder: (context) =&gt; AlertDialog(
          insetPadding: const EdgeInsets.symmetric(horizontal: 16),
          shape: RoundedRectangleBorder(
            borderRadius: BorderRadius.circular(8),
          ),
          backgroundColor: ColorPallet.gray800,
          title: const Text('Guild Icon Editor'),
          content: const Text(
            'Coming Soon!',
          ),
          actions: [
            TextButton(
              onPressed: () =&gt; context.pop(),
              child: const Text('OK'),
            ),
          ],
        ),
      );

      return;

      // TODO: [ãƒ•ã‚§ãƒ¼ã‚º2] ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹
      // ignore: dead_code, use_build_context_synchronously
      final hasPermission = await _hasPhotoPermission(context);
      if (hasPermission) {
        await pickAndCropImage();
      }
    }

    Future&lt;void&gt; onTapSave(String updatedText, String guildName) async {
      try {
        if (updatedText.isNotEmpty && updatedText != guildName) {
          await ref
              .read(updateGuildNotifierProvider.notifier)
              .updateGuildName(updatedText);

          // Refresh guild information
          await onRefresh();

          // show snackbar
          if (context.mounted) {
            ScaffoldMessenger.of(context).showSnackBar(
              SnackBar(
                content: Text('Guild name updated to $updatedText'),
              ),
            );
          }
        }
      } on Exception catch (error) {
        if (context.mounted) {
          showErrorSnackBar(context, error);
        }
      }
    }

    Future&lt;void&gt; onTapReject({
      required String guildId,
      required String userId,
      required String userName,
    }) async {
      try {
        await ref
            .read(rejectGuildNotifierProvider.notifier)
            .rejectGuild(guildId: guildId, userId: userId);

        // ã‚®ãƒ«ãƒ‰æƒ…å ±ã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
        await onRefresh();

        if (context.mounted) {
          ScaffoldMessenger.of(context).showSnackBar(
            SnackBar(
              content: Text('Rejected $userName'),
            ),
          );
        }
      } on Exception catch (error) {
        if (context.mounted) {
          showErrorSnackBar(context, error);
        }
      }
    }

    Future&lt;void&gt; onTapApprove({
      required String guildId,
      required String userId,
      required String userName,
    }) async {
      try {
        await ref
            .read(approveGuildNotifierProvider.notifier)
            .approveGuild(guildId: guildId, userId: userId);

        // ã‚®ãƒ«ãƒ‰æƒ…å ±ã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
        await onRefresh();

        if (context.mounted) {
          ScaffoldMessenger.of(context).showSnackBar(
            SnackBar(
              content: Text('Approved $userName'),
            ),
          );
        }
      } on Exception catch (error) {
        if (context.mounted) {
          showErrorSnackBar(context, error);
        }
      }
    }

    useEffect(
      () {
        Future.microtask(() async {
          await onRefresh();
        });
        return null;
      },
      [],
    );

    return Scaffold(
      appBar: AppBar(
        title: const Text('Guild management'),
      ),
      body: RefreshIndicator(
        onRefresh: () async {
          await onRefresh();
        },
        color: ColorToken.primary,
        backgroundColor: ColorToken.bgLight,
        child: myGuildAsyncValue.when(
          data: (guild) {
            if (guild == null) {
              return const SizedBox.shrink();
            }

            final guildId = guild.guildId ?? 'Unknown';
            final guildName = guild.guildName ?? 'No Name';
            final guildAvatar = guild.guildAvatar ?? '';
            final guildMembers = guild.guildMembers ?? &lt;GuildMemberDto&gt;[];

            return SingleChildScrollView(
              physics: const AlwaysScrollableScrollPhysics(),
              child: Padding(
                padding: const EdgeInsets.symmetric(horizontal: 20),
                child: _buildGuildManagementContent(
                  context: context,
                  ref: ref,
                  guildId: guildId,
                  guildName: guildName,
                  guildAvatar: guildAvatar,
                  guildMembers: guildMembers,
                  pickAndCropImage: pickAndCropImage,
                  onTapSave: onTapSave,
                  onTapGuildPhoto: onTapGuildPhoto,
                  onTapReject: onTapReject,
                  onTapApprove: onTapApprove,
                ),
              ),
            );
          },
          loading: () {
            return const Center(child: CircularProgressIndicator());
          },
          error: (error, _) {
            return Center(child: Text('Error: $error'));
          },
        ),
      ),
    );
  }

  /// GuildInfoResponseDtoData ã®ä¸­ã®å¿…è¦ãƒ‡ãƒ¼ã‚¿ã‚’éã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ã§å—ã‘å–ã‚Šã€å®‰å…¨ãªãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’ä½¿ã†
  Widget _buildGuildManagementContent({
    required BuildContext context,
    required WidgetRef ref,
    required String guildId,
    required String guildName,
    required String guildAvatar,
    required List&lt;GuildMemberDto&gt; guildMembers,
    required Future&lt;void&gt; Function() pickAndCropImage,
    required Future&lt;void&gt; Function(String updatedText, String guildName)
        onTapSave,
    required Future&lt;void&gt; Function() onTapGuildPhoto,
    required Future&lt;void&gt; Function({
      required String guildId,
      required String userId,
      required String userName,
    }) onTapReject,
    required Future&lt;void&gt; Function({
      required String guildId,
      required String userId,
      required String userName,
    }) onTapApprove,
  }) {
    return Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        const SizedBox(height: 32),
        // ã‚®ãƒ«ãƒ‰ã®ã‚¢ãƒã‚¿ãƒ¼(å†™çœŸ)
        Center(
          child: GestureDetector(
            onTap: () async {
              await onTapGuildPhoto();
            },
            child: Stack(
              alignment: Alignment.center,
              children: [
                GuildIcon(
                  guildId: guildId,
                  guildAvatar: guildAvatar,
                ),
                Container(
                  width: 64,
                  height: 64,
                  decoration: BoxDecoration(
                    color: Colors.black.withAlpha(180),
                    borderRadius: BorderRadius.circular(8),
                  ),
                ),
                const Icon(
                  Icons.camera_alt,
                  size: 24,
                  color: Colors.white,
                ),
              ],
            ),
          ),
        ),
        const SizedBox(height: 32),
        // ã‚®ãƒ«ãƒ‰åç·¨é›†éƒ¨åˆ†
        Material(
          color: Colors.transparent,
          child: InkWell(
            onTap: () {
              context.push(
                Screen.textEditing.path,
                extra: TextEditingPageArgs(
                  title: 'Name',
                  text: guildName,
                  hintText: 'Enter guild name',
                  onSave: (updatedText) async {
                    await onTapSave(updatedText, guildName);
                  },
                ),
              );
            },
            borderRadius: BorderRadius.circular(8),
            child: Container(
              padding: const EdgeInsets.symmetric(vertical: 8),
              child: Row(
                mainAxisAlignment: MainAxisAlignment.spaceBetween,
                children: [
                  const Text(
                    'Name',
                    style: TextStyle(
                      fontSize: 16,
                      color: ColorPallet.gray300,
                    ),
                  ),
                  const SizedBox(
                    width: 8,
                  ),
                  Flexible(
                    child: Row(
                      mainAxisSize: MainAxisSize.min,
                      children: [
                        Flexible(
                          child: Text(
                            guildName,
                            style: const TextStyle(fontSize: 16),
                            maxLines: 1,
                            overflow: TextOverflow.ellipsis,
                          ),
                        ),
                        const SizedBox(width: 8),
                        const Icon(
                          Icons.chevron_right,
                          color: ColorToken.text,
                          size: 20,
                        ),
                      ],
                    ),
                  ),
                ],
              ),
            ),
          ),
        ),
        const SizedBox(height: 32),
        const Divider(
          color: ColorToken.secondary,
        ),
        const SizedBox(height: 32),
        // ãƒ¡ãƒ³ãƒãƒ¼ç”³è«‹ä¸€è¦§
        _buildRequestedMembers(
          context: context,
          ref: ref,
          guildId: guildId,
          guildMembers: guildMembers,
          onTapReject: onTapReject,
          onTapApprove: onTapApprove,
        ),

        // Padding(
        //   padding: const EdgeInsets.only(top: 24, bottom: 24),
        //   child: OutlinedButton(
        //     onPressed: isLoadingState.value
        //         ? null
        //         : () async {
        //             await onTapDeleteGuild();
        //           },
        //     child: const Text('Delete this guild'),
        //   ),
        // ),
      ],
    );
  }

  /// ç”³è«‹ä¸­ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§è¡¨ç¤º
  Widget _buildRequestedMembers({
    required BuildContext context,
    required WidgetRef ref,
    required String guildId,
    required List&lt;GuildMemberDto&gt; guildMembers,
    required Future&lt;void&gt; Function({
      required String guildId,
      required String userId,
      required String userName,
    }) onTapReject,
    required Future&lt;void&gt; Function({
      required String guildId,
      required String userId,
      required String userName,
    }) onTapApprove,
  }) {
    // guildMembers ã®ä¸­ã§ã€`memberStatus` ãŒ REQUESTED ã®ã‚‚ã®ã ã‘ã‚’æŠ½å‡º
    final requestedMembers = guildMembers
        .where(
          (member) =&gt;
              member.memberStatus == GuildMemberDtoMemberStatus.REQUESTED,
        )
        .toList();

    // ç”³è«‹ä¸­ãƒ¡ãƒ³ãƒãƒ¼ãŒã„ãªã„å ´åˆ
    if (requestedMembers.isEmpty) {
      return const Center(
        child: Padding(
          // pulll-to-refresh ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹ãŸã‚ã®ä½™ç™½ã‚’è¿½åŠ 
          padding: EdgeInsets.only(bottom: 180),
          child: Text('No members requesting to join.'),
        ),
      );
    }

    return Padding(
      // pulll-to-refresh ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹ãŸã‚ã®ä½™ç™½ã‚’è¿½åŠ 
      padding: const EdgeInsets.only(bottom: 180),
      child: ListView.builder(
        shrinkWrap: true,
        physics: const NeverScrollableScrollPhysics(),
        itemCount: requestedMembers.length,
        itemBuilder: (context, index) {
          final member = requestedMembers[index];
          final userId = member.userId ?? '';
          final userName = member.username ?? '';
          final avatarUrl = member.avatar;
          final cameraList =
              member.decks?.firstOrNull?.deckCameras?.sorted() ?? [];

          return Padding(
            padding: const EdgeInsets.only(bottom: 8),
            child: DecoratedBox(
              decoration: BoxDecoration(
                color: ColorToken.bg,
                borderRadius: BorderRadius.circular(4),
                border: Border.all(
                  color: ColorToken.defaultBorder,
                ),
              ),
              child: Padding(
                padding: const EdgeInsets.all(16),
                child: Column(
                  children: [
                    // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±éƒ¨åˆ†
                    Row(
                      children: [
                        // å·¦å´ï¼šã‚¢ãƒã‚¿ãƒ¼ + ãƒ¦ãƒ¼ã‚¶ãƒ¼å
                        Expanded(
                          child: GuildMemberColumn(
                            userName: userName,
                            isGuildOwner: false,
                            userPhotoUrl: avatarUrl,
                            cameraList: cameraList,
                          ),
                        ),
                        // å³å´ï¼šå„ç¨®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ (Q, E, L, B ãªã©)
                        Expanded(
                          child: ParametersBarColumn(
                            searchQ: member.decks?.firstOrNull?.searchQ ?? 0,
                            attackE: member.decks?.firstOrNull?.attackE ?? 0,
                            luckL: member.decks?.firstOrNull?.luckL ?? 0,
                            defenseB: member.decks?.firstOrNull?.defenseB ?? 0,
                          ),
                        ),
                      ],
                    ),
                    const SizedBox(height: 16),
                    // æ‰¿èªãƒ»å´ä¸‹ãƒœã‚¿ãƒ³
                    Row(
                      mainAxisAlignment: MainAxisAlignment.spaceBetween,
                      children: [
                        Flexible(
                          child: OutlinedButton(
                            onPressed: () async {
                              await onTapReject(
                                guildId: guildId,
                                userId: userId,
                                userName: userName,
                              );
                            },
                            style: OutlinedButton.styleFrom(
                              minimumSize: const Size.fromHeight(32),
                            ),
                            child: const Text(
                              'Reject',
                              style: TextStyle(fontSize: 12),
                            ),
                          ),
                        ),
                        const SizedBox(width: 12),
                        Flexible(
                          child: ElevatedButton(
                            onPressed: () async {
                              await onTapApprove(
                                guildId: guildId,
                                userId: userId,
                                userName: userName,
                              );
                            },
                            style: OutlinedButton.styleFrom(
                              minimumSize: const Size.fromHeight(32),
                            ),
                            child: const Text(
                              'Approve',
                              style: TextStyle(fontSize: 12),
                            ),
                          ),
                        ),
                      ],
                    ),
                  ],
                ),
              ),
            ),
          );
        },
      ),
    );
  }

  /// å†™çœŸã®æ¨©é™ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã€æ¨©é™ãŒã‚ã‚Œã° true ã‚’è¿”ã™
  Future&lt;bool&gt; _hasPhotoPermission(BuildContext context) async {
    final status = await Permission.photos.request();

    switch (status) {
      case PermissionStatus.granted:
      case PermissionStatus.limited:
        // è¨±å¯æ¸ˆã¿
        return true;
      case PermissionStatus.permanentlyDenied:
        // æ°¸ä¹…ã«æ‹’å¦ã•ã‚Œã¦ã„ã‚‹å ´åˆ
        if (context.mounted) {
          _showPermissionDialog(context);
        }
        return false;
      case PermissionStatus.denied:
      case PermissionStatus.restricted:
      case PermissionStatus.provisional:
        // ãã®ä»–ã®å ´åˆ
        if (context.mounted) {
          ScaffoldMessenger.of(context).showSnackBar(
            const SnackBar(content: Text('Access to photos is not granted.')),
          );
        }
        return false;
    }
  }

  /// è¨­å®šç”»é¢ã¸é·ç§»ã•ã›ã‚‹ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
  void _showPermissionDialog(BuildContext context) {
    showDialog&lt;void&gt;(
      context: context,
      builder: (context) =&gt; AlertDialog(
        insetPadding: const EdgeInsets.symmetric(horizontal: 16),
        shape: RoundedRectangleBorder(
          borderRadius: BorderRadius.circular(8),
        ),
        backgroundColor: ColorPallet.gray800,
        title: const Text(
          'Permission to access photos is required',
        ),
        content: const Text(
          'Enable photo access in settings to select a photo.',
        ),
        actions: [
          TextButton(
            onPressed: () async {
              context.pop();
            },
            child: const Text('Cancel'),
          ),
          TextButton(
            onPressed: () async {
              await openAppSettings();
            },
            child: const Text('Open Settings'),
          ),
        ],
      ),
    );
  }
}

import 'dart:io';
import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:go_router/go_router.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:image_cropper/image_cropper.dart';
import 'package:image_picker/image_picker.dart';
import 'package:permission_handler/permission_handler.dart';
import 'package:snpit_guild_app/domain/design/color_pallet.dart';
import 'package:snpit_guild_app/domain/design/color_token.dart';
import 'package:snpit_guild_app/domain/screen.dart';
import 'package:snpit_guild_app/infrastructure/entities/extensions/camera_dto_x.dart';
import 'package:snpit_guild_app/infrastructure/snapit_guild_api/snapit_guild_api.openapi.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/guilds/delete_guild.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/guilds/get_guild.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/guilds/update_guild.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/guilds/update_guild_member.dart';
import 'package:snpit_guild_app/presentation/router/router.dart';
import 'package:snpit_guild_app/presentation/widgets/dialogs/delete_guild_dialog.dart';
import 'package:snpit_guild_app/presentation/widgets/guild_icon.dart';
import 'package:snpit_guild_app/presentation/widgets/guild_member_column.dart';
import 'package:snpit_guild_app/presentation/widgets/parameters_bar_column.dart';
import 'package:snpit_guild_app/utils/extensions/uri_extensions.dart';
import 'package:snpit_guild_app/utils/snack_bar_utils.dart';

class GuildManagePage extends HookConsumerWidget {
  const GuildManagePage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final picker = useMemoized(ImagePicker.new);
    final imageFileState = useState&lt;File?&gt;(null);
    final myGuildAsyncValue = ref.watch(getMyGuildNotifierProvider);
    final isLoadingState = useState(false);

    Future&lt;void&gt; onRefresh() async {
      try {
        await ref.read(getMyGuildNotifierProvider.notifier).getMyGuild();
      } on Exception catch (error) {
        if (context.mounted) {
          showErrorSnackBar(context, error);
        }
      }
    }

    Future&lt;void&gt; onTapDeleteGuild() async {
      final confirm = await showDialog&lt;bool&gt;(
        context: context,
        builder: (context) =&gt; const DeleteGuildDialog(),
      );

      if (confirm != true) {
        return;
      }

      try {
        await ref.read(deleteGuildNotifierProvider.notifier).deleteGuild();
        await onRefresh();

        if (context.mounted) {
          ScaffoldMessenger.of(context).showSnackBar(
            const SnackBar(
              content: Text('Guild deleted successfully.'),
            ),
          );
        }

        if (context.mounted) {
          context.pop();
        }
      } on Exception catch (error) {
        if (context.mounted) {
          showErrorSnackBar(context, error);
        }
      }
    }

    Future&lt;void&gt; pickAndCropImage() async {
      final pickedFile = await picker.pickImage(source: ImageSource.gallery);
      if (pickedFile == null) {
        debugPrint('Image selection cancelled');
        return;
      }

      final croppedFile = await ImageCropper().cropImage(
        sourcePath: pickedFile.path,
        aspectRatio: const CropAspectRatio(ratioX: 1, ratioY: 1),
        uiSettings: [
          AndroidUiSettings(
            hideBottomControls: true,
            lockAspectRatio: true,
          ),
          IOSUiSettings(
            aspectRatioLockEnabled: true,
          ),
        ],
      );

      if (croppedFile == null) {
        debugPrint('Cropping cancelled');
        return;
      }

      if (!context.mounted) {
        return;
      }

      imageFileState.value = File(croppedFile.path);
      debugPrint('Cropped image path: ${imageFileState.value!.path}');

      try {
        // TODO: [ãƒ•ã‚§ãƒ¼ã‚º2] ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãªã©é©åˆ‡ãª API å‘¼ã³å‡ºã—
        await ref.read(updateGuildNotifierProvider.notifier).updateGuildAvatar(
              UriExtensions.randomImageUrlWithTitle(
                // ignore: use_build_context_synchronously
                TimeOfDay.now().format(context),
              ).toString(),
            );

        if (context.mounted) {
          ScaffoldMessenger.of(context).showSnackBar(
            const SnackBar(
              content: Text('Updated Successfully'),
            ),
          );
        }

        await onRefresh();
      } on Exception catch (error) {
        if (context.mounted) {
          showErrorSnackBar(context, error);
        }
      }
    }

    Future&lt;void&gt; onTapGuildPhoto() async {
      await showDialog&lt;void&gt;(
        context: context,
        builder: (context) =&gt; AlertDialog(
          insetPadding: const EdgeInsets.symmetric(horizontal: 16),
          shape: RoundedRectangleBorder(
            borderRadius: BorderRadius.circular(8),
          ),
          backgroundColor: ColorPallet.gray800,
          title: const Text('Guild Icon Editor'),
          content: const Text(
            'Coming Soon!',
          ),
          actions: [
            TextButton(
              onPressed: () =&gt; context.pop(),
              child: const Text('OK'),
            ),
          ],
        ),
      );

      return;

      // TODO: [ãƒ•ã‚§ãƒ¼ã‚º2] ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹
      // ignore: dead_code, use_build_context_synchronously
      final hasPermission = await _hasPhotoPermission(context);
      if (hasPermission) {
        await pickAndCropImage();
      }
    }

    Future&lt;void&gt; onTapSave(String updatedText, String guildName) async {
      try {
        if (updatedText.isNotEmpty && updatedText != guildName) {
          await ref
              .read(updateGuildNotifierProvider.notifier)
              .updateGuildName(updatedText);

          // Refresh guild information
          await onRefresh();

          // show snackbar
          if (context.mounted) {
            ScaffoldMessenger.of(context).showSnackBar(
              SnackBar(
                content: Text('Guild name updated to $updatedText'),
              ),
            );
          }
        }
      } on Exception catch (error) {
        if (context.mounted) {
          showErrorSnackBar(context, error);
        }
      }
    }

    Future&lt;void&gt; onTapReject({
      required String guildId,
      required String userId,
      required String userName,
    }) async {
      try {
        await ref
            .read(rejectGuildNotifierProvider.notifier)
            .rejectGuild(guildId: guildId, userId: userId);

        // ã‚®ãƒ«ãƒ‰æƒ…å ±ã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
        await onRefresh();

        if (context.mounted) {
          ScaffoldMessenger.of(context).showSnackBar(
            SnackBar(
              content: Text('Rejected $userName'),
            ),
          );
        }
      } on Exception catch (error) {
        if (context.mounted) {
          showErrorSnackBar(context, error);
        }
      }
    }

    Future&lt;void&gt; onTapApprove({
      required String guildId,
      required String userId,
      required String userName,
    }) async {
      try {
        await ref
            .read(approveGuildNotifierProvider.notifier)
            .approveGuild(guildId: guildId, userId: userId);

        // ã‚®ãƒ«ãƒ‰æƒ…å ±ã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
        await onRefresh();

        if (context.mounted) {
          ScaffoldMessenger.of(context).showSnackBar(
            SnackBar(
              content: Text('Approved $userName'),
            ),
          );
        }
      } on Exception catch (error) {
        if (context.mounted) {
          showErrorSnackBar(context, error);
        }
      }
    }

    useEffect(
      () {
        Future.microtask(() async {
          await onRefresh();
        });
        return null;
      },
      [],
    );

    return Scaffold(
      appBar: AppBar(
        title: const Text('Guild management'),
      ),
      body: RefreshIndicator(
        onRefresh: () async {
          await onRefresh();
        },
        color: ColorToken.primary,
        backgroundColor: ColorToken.bgLight,
        child: myGuildAsyncValue.when(
          data: (guild) {
            if (guild == null) {
              return const SizedBox.shrink();
            }

            final guildId = guild.guildId ?? 'Unknown';
            final guildName = guild.guildName ?? 'No Name';
            final guildAvatar = guild.guildAvatar ?? '';
            final guildMembers = guild.guildMembers ?? &lt;GuildMemberDto&gt;[];

            return SingleChildScrollView(
              physics: const AlwaysScrollableScrollPhysics(),
              child: Padding(
                padding: const EdgeInsets.symmetric(horizontal: 20),
                child: _buildGuildManagementContent(
                  context: context,
                  ref: ref,
                  guildId: guildId,
                  guildName: guildName,
                  guildAvatar: guildAvatar,
                  guildMembers: guildMembers,
                  pickAndCropImage: pickAndCropImage,
                  onTapSave: onTapSave,
                  onTapGuildPhoto: onTapGuildPhoto,
                  onTapReject: onTapReject,
                  onTapApprove: onTapApprove,
                ),
              ),
            );
          },
          loading: () {
            return const Center(child: CircularProgressIndicator());
          },
          error: (error, _) {
            return Center(child: Text('Error: $error'));
          },
        ),
      ),
    );
  }

  /// GuildInfoResponseDtoData ã®ä¸­ã®å¿…è¦ãƒ‡ãƒ¼ã‚¿ã‚’éã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ã§å—ã‘å–ã‚Šã€å®‰å…¨ãªãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’ä½¿ã†
  Widget _buildGuildManagementContent({
    required BuildContext context,
    required WidgetRef ref,
    required String guildId,
    required String guildName,
    required String guildAvatar,
    required List&lt;GuildMemberDto&gt; guildMembers,
    required Future&lt;void&gt; Function() pickAndCropImage,
    required Future&lt;void&gt; Function(String updatedText, String guildName)
        onTapSave,
    required Future&lt;void&gt; Function() onTapGuildPhoto,
    required Future&lt;void&gt; Function({
      required String guildId,
      required String userId,
      required String userName,
    }) onTapReject,
    required Future&lt;void&gt; Function({
      required String guildId,
      required String userId,
      required String userName,
    }) onTapApprove,
  }) {
    return Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        const SizedBox(height: 32),
        // ã‚®ãƒ«ãƒ‰ã®ã‚¢ãƒã‚¿ãƒ¼(å†™çœŸ)
        Center(
          child: GestureDetector(
            onTap: () async {
              await onTapGuildPhoto();
            },
            child: Stack(
              alignment: Alignment.center,
              children: [
                GuildIcon(
                  guildId: guildId,
                  guildAvatar: guildAvatar,
                ),
                Container(
                  width: 64,
                  height: 64,
                  decoration: BoxDecoration(
                    color: Colors.black.withAlpha(180),
                    borderRadius: BorderRadius.circular(8),
                  ),
                ),
                const Icon(
                  Icons.camera_alt,
                  size: 24,
                  color: Colors.white,
                ),
              ],
            ),
          ),
        ),
        const SizedBox(height: 32),
        // ã‚®ãƒ«ãƒ‰åç·¨é›†éƒ¨åˆ†
        Material(
          color: Colors.transparent,
          child: InkWell(
            onTap: () {
              context.push(
                Screen.textEditing.path,
                extra: TextEditingPageArgs(
                  title: 'Name',
                  text: guildName,
                  hintText: 'Enter guild name',
                  onSave: (updatedText) async {
                    await onTapSave(updatedText, guildName);
                  },
                ),
              );
            },
            borderRadius: BorderRadius.circular(8),
            child: Container(
              padding: const EdgeInsets.symmetric(vertical: 8),
              child: Row(
                mainAxisAlignment: MainAxisAlignment.spaceBetween,
                children: [
                  const Text(
                    'Name',
                    style: TextStyle(
                      fontSize: 16,
                      color: ColorPallet.gray300,
                    ),
                  ),
                  const SizedBox(
                    width: 8,
                  ),
                  Flexible(
                    child: Row(
                      mainAxisSize: MainAxisSize.min,
                      children: [
                        Flexible(
                          child: Text(
                            guildName,
                            style: const TextStyle(fontSize: 16),
                            maxLines: 1,
                            overflow: TextOverflow.ellipsis,
                          ),
                        ),
                        const SizedBox(width: 8),
                        const Icon(
                          Icons.chevron_right,
                          color: ColorToken.text,
                          size: 20,
                        ),
                      ],
                    ),
                  ),
                ],
              ),
            ),
          ),
        ),
        const SizedBox(height: 32),
        const Divider(
          color: ColorToken.secondary,
        ),
        const SizedBox(height: 32),
        // ãƒ¡ãƒ³ãƒãƒ¼ç”³è«‹ä¸€è¦§
        _buildRequestedMembers(
          context: context,
          ref: ref,
          guildId: guildId,
          guildMembers: guildMembers,
          onTapReject: onTapReject,
          onTapApprove: onTapApprove,
        ),

        // Padding(
        //   padding: const EdgeInsets.only(top: 24, bottom: 24),
        //   child: OutlinedButton(
        //     onPressed: isLoadingState.value
        //         ? null
        //         : () async {
        //             await onTapDeleteGuild();
        //           },
        //     child: const Text('Delete this guild'),
        //   ),
        // ),
      ],
    );
  }

  /// ç”³è«‹ä¸­ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§è¡¨ç¤º
  Widget _buildRequestedMembers({
    required BuildContext context,
    required WidgetRef ref,
    required String guildId,
    required List&lt;GuildMemberDto&gt; guildMembers,
    required Future&lt;void&gt; Function({
      required String guildId,
      required String userId,
      required String userName,
    }) onTapReject,
    required Future&lt;void&gt; Function({
      required String guildId,
      required String userId,
      required String userName,
    }) onTapApprove,
  }) {
    // guildMembers ã®ä¸­ã§ã€`memberStatus` ãŒ REQUESTED ã®ã‚‚ã®ã ã‘ã‚’æŠ½å‡º
    final requestedMembers = guildMembers
        .where(
          (member) =&gt;
              member.memberStatus == GuildMemberDtoMemberStatus.REQUESTED,
        )
        .toList();

    // ç”³è«‹ä¸­ãƒ¡ãƒ³ãƒãƒ¼ãŒã„ãªã„å ´åˆ
    if (requestedMembers.isEmpty) {
      return const Center(
        child: Padding(
          // pulll-to-refresh ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹ãŸã‚ã®ä½™ç™½ã‚’è¿½åŠ 
          padding: EdgeInsets.only(bottom: 180),
          child: Text('No members requesting to join.'),
        ),
      );
    }

    return Padding(
      // pulll-to-refresh ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹ãŸã‚ã®ä½™ç™½ã‚’è¿½åŠ 
      padding: const EdgeInsets.only(bottom: 180),
      child: ListView.builder(
        shrinkWrap: true,
        physics: const NeverScrollableScrollPhysics(),
        itemCount: requestedMembers.length,
        itemBuilder: (context, index) {
          final member = requestedMembers[index];
          final userId = member.userId ?? '';
          final userName = member.username ?? '';
          final avatarUrl = member.avatar;
          final cameraList =
              member.decks?.firstOrNull?.deckCameras?.sorted() ?? [];

          return Padding(
            padding: const EdgeInsets.only(bottom: 8),
            child: DecoratedBox(
              decoration: BoxDecoration(
                color: ColorToken.bg,
                borderRadius: BorderRadius.circular(4),
                border: Border.all(
                  color: ColorToken.defaultBorder,
                ),
              ),
              child: Padding(
                padding: const EdgeInsets.all(16),
                child: Column(
                  children: [
                    // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±éƒ¨åˆ†
                    Row(
                      children: [
                        // å·¦å´ï¼šã‚¢ãƒã‚¿ãƒ¼ + ãƒ¦ãƒ¼ã‚¶ãƒ¼å
                        Expanded(
                          child: GuildMemberColumn(
                            userName: userName,
                            isGuildOwner: false,
                            userPhotoUrl: avatarUrl,
                            cameraList: cameraList,
                          ),
                        ),
                        // å³å´ï¼šå„ç¨®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ (Q, E, L, B ãªã©)
                        Expanded(
                          child: ParametersBarColumn(
                            searchQ: member.decks?.firstOrNull?.searchQ ?? 0,
                            attackE: member.decks?.firstOrNull?.attackE ?? 0,
                            luckL: member.decks?.firstOrNull?.luckL ?? 0,
                            defenseB: member.decks?.firstOrNull?.defenseB ?? 0,
                          ),
                        ),
                      ],
                    ),
                    const SizedBox(height: 16),
                    // æ‰¿èªãƒ»å´ä¸‹ãƒœã‚¿ãƒ³
                    Row(
                      mainAxisAlignment: MainAxisAlignment.spaceBetween,
                      children: [
                        Flexible(
                          child: OutlinedButton(
                            onPressed: () async {
                              await onTapReject(
                                guildId: guildId,
                                userId: userId,
                                userName: userName,
                              );
                            },
                            style: OutlinedButton.styleFrom(
                              minimumSize: const Size.fromHeight(32),
                            ),
                            child: const Text(
                              'Reject',
                              style: TextStyle(fontSize: 12),
                            ),
                          ),
                        ),
                        const SizedBox(width: 12),
                        Flexible(
                          child: ElevatedButton(
                            onPressed: () async {
                              await onTapApprove(
                                guildId: guildId,
                                userId: userId,
                                userName: userName,
                              );
                            },
                            style: OutlinedButton.styleFrom(
                              minimumSize: const Size.fromHeight(32),
                            ),
                            child: const Text(
                              'Approve',
                              style: TextStyle(fontSize: 12),
                            ),
                          ),
                        ),
                      ],
                    ),
                  ],
                ),
              ),
            ),
          );
        },
      ),
    );
  }

  /// å†™çœŸã®æ¨©é™ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã€æ¨©é™ãŒã‚ã‚Œã° true ã‚’è¿”ã™
  Future&lt;bool&gt; _hasPhotoPermission(BuildContext context) async {
    final status = await Permission.photos.request();

    switch (status) {
      case PermissionStatus.granted:
      case PermissionStatus.limited:
        // è¨±å¯æ¸ˆã¿
        return true;
      case PermissionStatus.permanentlyDenied:
        // æ°¸ä¹…ã«æ‹’å¦ã•ã‚Œã¦ã„ã‚‹å ´åˆ
        if (context.mounted) {
          _showPermissionDialog(context);
        }
        return false;
      case PermissionStatus.denied:
      case PermissionStatus.restricted:
      case PermissionStatus.provisional:
        // ãã®ä»–ã®å ´åˆ
        if (context.mounted) {
          ScaffoldMessenger.of(context).showSnackBar(
            const SnackBar(content: Text('Access to photos is not granted.')),
          );
        }
        return false;
    }
  }

  /// è¨­å®šç”»é¢ã¸é·ç§»ã•ã›ã‚‹ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
  void _showPermissionDialog(BuildContext context) {
    showDialog&lt;void&gt;(
      context: context,
      builder: (context) =&gt; AlertDialog(
        insetPadding: const EdgeInsets.symmetric(horizontal: 16),
        shape: RoundedRectangleBorder(
          borderRadius: BorderRadius.circular(8),
        ),
        backgroundColor: ColorPallet.gray800,
        title: const Text(
          'Permission to access photos is required',
        ),
        content: const Text(
          'Enable photo access in settings to select a photo.',
        ),
        actions: [
          TextButton(
            onPressed: () async {
              context.pop();
            },
            child: const Text('Cancel'),
          ),
          TextButton(
            onPressed: () async {
              await openAppSettings();
            },
            child: const Text('Open Settings'),
          ),
        ],
      ),
    );
  }
}

---

## ğŸ”§ Tool
*2025-02-14 15:34:12*

**ã‚³ãƒ¼ãƒ‰ã®å†æ§‹ç¯‰ã‚’æ¤œè¨ä¸­**

GuildManagePageã®ã‚³ãƒ¼ãƒ‰ã‚’åˆ†å‰²ã—ã€ç‹¬ç«‹ã—ãŸHookConsumerWidgetã§ç®¡ç†ã™ã‚‹è¨ˆç”»ã€‚å‰Šé™¤ãƒœã‚¿ãƒ³ã¨ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒ­ã‚¸ãƒƒã‚¯ã‚’çµ±åˆã—ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’æŒã¤GuildManagementContentã‚’æ§‹ç¯‰ä¸­ã€‚

**ä½œæ¥­ã®é€²è¡Œä¸­**

GuildManagementContentã‚’HookConsumerWidgetã¨ã—ã¦ä½œæˆã—ã€å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’å˜ä¸€ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§æ¸¡ã™ã“ã¨ã‚’æ¤œè¨ã€‚onTapDeleteGuildãƒ¡ã‚½ãƒƒãƒ‰ã®çµ±åˆã‚‚æ¤œè¨ã—ã¦ã„ã‚‹ã€‚

**è©³ç´°ã‚’è©°ã‚ã‚‹**

onTapDeleteGuildã¨ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒ­ã‚¸ãƒƒã‚¯ã‚’GuildManagementContentã«çµ±åˆã—ã¦ã€è¦ªã‹ã‚‰ã‚®ãƒ«ãƒ‰æƒ…å ±ã‚’æ¸¡ã™è¨ˆç”»ã‚’é€²ã‚ã¦ã„ã‚‹ã€‚

**ãƒ‡ãƒ¼ã‚¿ã®æ‰±ã„ã‚’è€ƒãˆã‚‹**

å­ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒç›´æ¥ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒ­ã‚¸ãƒƒã‚¯ã‚‚æ‹…å½“ã™ã‚‹æ–¹æ³•ã‚’æ¨¡ç´¢ä¸­ã€‚è¦ªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®watchã‚’çœç•¥ã™ã‚‹ã‹ã€éƒ¨åˆ†çš„ã«è¡Œã†ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’æ¤œè¨ä¸­ã€‚

**è¦ªå­ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®å½¹å‰²ã‚’è¦‹æ¥µã‚ã‚‹**

è¦ªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã—ã¤ã¤ã€å­ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã§ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè¡Œã™ã‚‹æ–¹æ³•ã‚’æ¤œè¨ä¸­ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€è¦ªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã¯ã‚·ãƒ³ãƒ—ãƒ«ã«ä¿ãŸã‚Œã‚‹ã€‚

**æ–°ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®å½¹å‰²ã‚’å¼·èª¿**

æ–°ã—ã„ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã‚’æ‹…å½“ã—ã€è¦ªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒ­ã‚¸ãƒƒã‚¯ã‚’çœç•¥ã—ã¦ã„ã‚‹ã€‚è¦ªã¯è¡¨ç¤ºã®ç°¡ç•¥åŒ–ã‚’å›³ã£ã¦ã„ã‚‹ã€‚

**æ–°ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®ç·¨æˆã‚’è€ƒãˆã‚‹**

è¦ªã®ã‚³ãƒ¼ãƒ‰ã‚’çœç•¥ã—ã¤ã¤ã€æ–°ã—ã„`HookConsumerWidget`ã‚’ä½œæˆã—ã¦æ³¨é‡ˆã‚³ãƒ¼ãƒ‰ã‚„å‰Šé™¤ãƒœã‚¿ãƒ³ã®`onTapDeleteGuild`ã‚’çµ±åˆã—ã€ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒ­ã‚¸ãƒƒã‚¯ã‚‚æ–°ã—ã„ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«å«ã‚ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ã„ã‚‹ã€‚

**ç”»åƒé¸æŠã®çµ±åˆã‚’æ¨¡ç´¢ä¸­**

ç”»åƒé¸æŠã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ–°ã—ã„`HookConsumerWidget`ã«çµ„ã¿è¾¼ã¿ã€å¿…è¦ã«å¿œã˜ã¦`ref`ã‚’å­ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«æ¸¡ã™æ–¹æ³•ã‚’æ¢ã£ã¦ã„ã‚‹ã€‚

**æ–°ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®ä½œæˆ**

`GuildManagementContent`ã¨ã„ã†æ–°ã—ã„ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’ä½œæˆã—ã€ç”»åƒé¸æŠã‚„æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯ã‚’çµ±åˆã€‚è¦ªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®`GuildManagePage`ã¯ç°¡ç•¥åŒ–ã—ã€`AppBar`ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ä¸­ã€‚

**ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆä½œæˆã‚’ãƒ›ãƒ¼ãƒ—ã™ã‚‹**

`GuildManagementContent`ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’ä½œæˆã—ã€ç”»åƒé¸æŠã‚„æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯ã‚’çµ±åˆã€‚è¦ªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ`GuildManagePage`ã¯ç°¡ç•¥åŒ–ã—ã€`AppBar`ã‚’ç¶­æŒã™ã‚‹æ–¹é‡ã€‚

---

## ğŸ¤– Assistant
*2025-02-14 15:34:12*

ä»¥ä¸‹ã¯ä¸€ä¾‹ã¨ã—ã¦ã€**ã€Œã‚®ãƒ«ãƒ‰ç®¡ç†ç”»é¢ã¾ã‚‹ã”ã¨ã€ã‚’æ–°ã—ã„ `HookConsumerWidget` ã«åˆ‡ã‚Šå‡ºã™** å½¢ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚  
ï¼ˆ`GuildManagePage` ã‚’æ¥µåŠ›ã‚·ãƒ³ãƒ—ãƒ«ã«ã—ã€å®Ÿéš›ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚„ UI ã¯ã™ã¹ã¦åˆ‡ã‚Šå‡ºã—ãŸ `GuildManagementContent` ã§å®Œçµã•ã›ã¾ã™ã€‚ï¼‰

ã‚‚ã—ã€Œ`AppBar` ã¯è¦ªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã§å®šç¾©ã—ãŸã¾ã¾ã€ä¸­èº«ã ã‘ã‚’å·®ã—æ›¿ãˆãŸã„ã€ã¨ã„ã†å ´åˆã¯ã€ä¸‹è¨˜ã‚µãƒ³ãƒ—ãƒ«ã® `GuildManagePage` ã®å®Ÿè£…ã‚’èª¿æ•´ã—ã¦åˆ©ç”¨ã—ã¦ãã ã•ã„ã€‚

---

## ä¾‹: `GuildManagePage`ï¼ˆå…ƒã®ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ï¼‰ã‚’æœ€å°åŒ–ã—ã€å­ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«é›†ç´„ã™ã‚‹

```dart
import 'package:flutter/material.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';

/// ã‚®ãƒ«ãƒ‰ç®¡ç†ãƒšãƒ¼ã‚¸ï¼ˆå…ƒã®è¦ªï¼‰
class GuildManagePage extends StatelessWidget {
  const GuildManagePage({super.key});

  @override
  Widget build(BuildContext context) {
    return const Scaffold(
      appBar: AppBar(
        title: Text('Guild management'),
      ),
      // ä¸­èº«(RefreshIndicatorå«ã‚€) ã¯ GuildManagementContent ã«ã¾ã¨ã‚ã‚‹
      body: GuildManagementContent(),
    );
  }
}
```

---

## ä¾‹: æ–°ã—ãä½œã£ãŸ `GuildManagementContent`ï¼ˆHookConsumerWidgetï¼‰

```dart
import 'dart:io';

import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:go_router/go_router.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:image_cropper/image_cropper.dart';
import 'package:image_picker/image_picker.dart';
import 'package:permission_handler/permission_handler.dart';

// ä»¥ä¸‹ã¯ã”è‡ªèº«ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® import ã«åˆã‚ã›ã¦ãƒ‘ã‚¹ã‚’èª¿æ•´ã—ã¦ãã ã•ã„
import 'package:snpit_guild_app/domain/design/color_pallet.dart';
import 'package:snpit_guild_app/domain/design/color_token.dart';
import 'package:snpit_guild_app/domain/screen.dart';
import 'package:snpit_guild_app/infrastructure/entities/extensions/camera_dto_x.dart';
import 'package:snpit_guild_app/infrastructure/snapit_guild_api/snapit_guild_api.openapi.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/guilds/delete_guild.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/guilds/get_guild.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/guilds/update_guild.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/guilds/update_guild_member.dart';
import 'package:snpit_guild_app/presentation/router/router.dart';
import 'package:snpit_guild_app/presentation/widgets/dialogs/delete_guild_dialog.dart';
import 'package:snpit_guild_app/presentation/widgets/guild_icon.dart';
import 'package:snpit_guild_app/presentation/widgets/guild_member_column.dart';
import 'package:snpit_guild_app/presentation/widgets/parameters_bar_column.dart';
import 'package:snpit_guild_app/utils/extensions/uri_extensions.dart';
import 'package:snpit_guild_app/utils/snack_bar_utils.dart';

/// ã‚®ãƒ«ãƒ‰ç®¡ç†ãƒšãƒ¼ã‚¸ã®ã€Œä¸­èº«ã€å…¨ã¦ã‚’ã“ã“ã«é–‰ã˜è¾¼ã‚ãŸä¾‹
/// è¦ªã® GuildManagePage ã¯ã€ã“ã® GuildManagementContent ã‚’ãã®ã¾ã¾ body ã«ç½®ãã ã‘
class GuildManagementContent extends HookConsumerWidget {
  const GuildManagementContent({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final picker = useMemoized(ImagePicker.new);
    final imageFileState = useState<File?>(null);
    final isLoadingState = useState(false);

    // ã‚®ãƒ«ãƒ‰æƒ…å ±ã® AsyncValue
    final myGuildAsyncValue = ref.watch(getMyGuildNotifierProvider);

    // ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥å‡¦ç†
    Future<void> onRefresh() async {
      try {
        await ref.read(getMyGuildNotifierProvider.notifier).getMyGuild();
      } on Exception catch (error) {
        if (context.mounted) {
          showErrorSnackBar(context, error);
        }
      }
    }

    // ã‚®ãƒ«ãƒ‰å‰Šé™¤
    Future<void> onTapDeleteGuild() async {
      final confirm = await showDialog<bool>(
        context: context,
        builder: (context) => const DeleteGuildDialog(),
      );

      if (confirm != true) {
        return;
      }

      try {
        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°é–‹å§‹
        isLoadingState.value = true;

        await ref.read(deleteGuildNotifierProvider.notifier).deleteGuild();

        // å‰Šé™¤å¾Œãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
        await onRefresh();

        if (context.mounted) {
          ScaffoldMessenger.of(context).showSnackBar(
            const SnackBar(
              content: Text('Guild deleted successfully.'),
            ),
          );
        }

        // å‰ã®ç”»é¢ã«æˆ»ã‚‹
        if (context.mounted) {
          context.pop();
        }
      } on Exception catch (error) {
        if (context.mounted) {
          showErrorSnackBar(context, error);
        }
      } finally {
        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è§£é™¤
        isLoadingState.value = false;
      }
    }

    // ã‚®ãƒ«ãƒ‰ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆå†™çœŸï¼‰é¸æŠ & ã‚¯ãƒ­ãƒƒãƒ—
    Future<void> pickAndCropImage() async {
      final pickedFile = await picker.pickImage(source: ImageSource.gallery);
      if (pickedFile == null) {
        debugPrint('Image selection cancelled');
        return;
      }

      final croppedFile = await ImageCropper().cropImage(
        sourcePath: pickedFile.path,
        aspectRatio: const CropAspectRatio(ratioX: 1, ratioY: 1),
        uiSettings: [
          AndroidUiSettings(
            hideBottomControls: true,
            lockAspectRatio: true,
          ),
          IOSUiSettings(
            aspectRatioLockEnabled: true,
          ),
        ],
      );

      if (croppedFile == null) {
        debugPrint('Cropping cancelled');
        return;
      }

      if (!context.mounted) {
        return;
      }

      imageFileState.value = File(croppedFile.path);
      debugPrint('Cropped image path: ${imageFileState.value!.path}');

      try {
        // TODO: å®Ÿéš›ã®ã‚®ãƒ«ãƒ‰ã‚¢ã‚¤ã‚³ãƒ³ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰APIã‚’å‘¼ã¶
        await ref.read(updateGuildNotifierProvider.notifier).updateGuildAvatar(
              UriExtensions.randomImageUrlWithTitle(
                TimeOfDay.now().format(context),
              ).toString(),
            );

        if (context.mounted) {
          ScaffoldMessenger.of(context).showSnackBar(
            const SnackBar(
              content: Text('Updated Successfully'),
            ),
          );
        }

        await onRefresh();
      } on Exception catch (error) {
        if (context.mounted) {
          showErrorSnackBar(context, error);
        }
      }
    }

    // ã‚¢ãƒã‚¿ãƒ¼å†™çœŸãŒã‚¿ãƒƒãƒ—ã•ã‚ŒãŸæ™‚
    Future<void> onTapGuildPhoto() async {
      await showDialog<void>(
        context: context,
        builder: (context) => AlertDialog(
          insetPadding: const EdgeInsets.symmetric(horizontal: 16),
          shape: RoundedRectangleBorder(
            borderRadius: BorderRadius.circular(8),
          ),
          backgroundColor: ColorPallet.gray800,
          title: const Text('Guild Icon Editor'),
          content: const Text('Coming Soon!'),
          actions: [
            TextButton(
              onPressed: () => context.pop(),
              child: const Text('OK'),
            ),
          ],
        ),
      );
      // å®Ÿè£…ã™ã‚‹ãªã‚‰ä¸‹è¨˜ã®ã‚ˆã†ã«ã€‚ã„ã£ãŸã‚“ return ã—ã¦å®Ÿè£…ã‚’æ­¢ã‚ã¦ã„ã¾ã™ã€‚
      return;

      // TODO: [ãƒ•ã‚§ãƒ¼ã‚º2] ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹
      final hasPermission = await _hasPhotoPermission(context);
      if (hasPermission) {
        await pickAndCropImage();
      }
    }

    // ã‚®ãƒ«ãƒ‰åæ›´æ–°
    Future<void> onTapSaveName(String updatedText, String currentGuildName) async {
      try {
        if (updatedText.isNotEmpty && updatedText != currentGuildName) {
          await ref
              .read(updateGuildNotifierProvider.notifier)
              .updateGuildName(updatedText);

          // Refresh guild information
          await onRefresh();

          // show snackbar
          if (context.mounted) {
            ScaffoldMessenger.of(context).showSnackBar(
              SnackBar(
                content: Text('Guild name updated to $updatedText'),
              ),
            );
          }
        }
      } on Exception catch (error) {
        if (context.mounted) {
          showErrorSnackBar(context, error);
        }
      }
    }

    // ç”³è«‹ãƒ¦ãƒ¼ã‚¶ã®ã€Œå´ä¸‹ã€
    Future<void> onTapReject({
      required String guildId,
      required String userId,
      required String userName,
    }) async {
      try {
        await ref
            .read(rejectGuildNotifierProvider.notifier)
            .rejectGuild(guildId: guildId, userId: userId);

        // ã‚®ãƒ«ãƒ‰æƒ…å ±ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
        await onRefresh();

        if (context.mounted) {
          ScaffoldMessenger.of(context).showSnackBar(
            SnackBar(
              content: Text('Rejected $userName'),
            ),
          );
        }
      } on Exception catch (error) {
        if (context.mounted) {
          showErrorSnackBar(context, error);
        }
      }
    }

    // ç”³è«‹ãƒ¦ãƒ¼ã‚¶ã®ã€Œæ‰¿èªã€
    Future<void> onTapApprove({
      required String guildId,
      required String userId,
      required String userName,
    }) async {
      try {
        await ref
            .read(approveGuildNotifierProvider.notifier)
            .approveGuild(guildId: guildId, userId: userId);

        // ã‚®ãƒ«ãƒ‰æƒ…å ±ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
        await onRefresh();

        if (context.mounted) {
          ScaffoldMessenger.of(context).showSnackBar(
            SnackBar(
              content: Text('Approved $userName'),
            ),
          );
        }
      } on Exception catch (error) {
        if (context.mounted) {
          showErrorSnackBar(context, error);
        }
      }
    }

    // åˆå›è¡¨ç¤ºæ™‚ã«ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
    useEffect(() {
      Future.microtask(() async {
        await onRefresh();
      });
      return null;
    }, []);

    // ç”»é¢æœ¬ä½“
    return RefreshIndicator(
      onRefresh: onRefresh,
      color: ColorToken.primary,
      backgroundColor: ColorToken.bgLight,
      child: myGuildAsyncValue.when(
        data: (guild) {
          if (guild == null) {
            return const SizedBox.shrink();
          }

          final guildId = guild.guildId ?? 'Unknown';
          final guildName = guild.guildName ?? 'No Name';
          final guildAvatar = guild.guildAvatar ?? '';
          final guildMembers = guild.guildMembers ?? <GuildMemberDto>[];

          return SingleChildScrollView(
            physics: const AlwaysScrollableScrollPhysics(),
            child: Padding(
              padding: const EdgeInsets.symmetric(horizontal: 20),
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  const SizedBox(height: 32),
                  // ã‚®ãƒ«ãƒ‰ã‚¢ãƒã‚¿ãƒ¼
                  Center(
                    child: GestureDetector(
                      onTap: () => onTapGuildPhoto(),
                      child: Stack(
                        alignment: Alignment.center,
                        children: [
                          GuildIcon(
                            guildId: guildId,
                            guildAvatar: guildAvatar,
                          ),
                          Container(
                            width: 64,
                            height: 64,
                            decoration: BoxDecoration(
                              color: Colors.black.withAlpha(180),
                              borderRadius: BorderRadius.circular(8),
                            ),
                          ),
                          const Icon(
                            Icons.camera_alt,
                            size: 24,
                            color: Colors.white,
                          ),
                        ],
                      ),
                    ),
                  ),

                  const SizedBox(height: 32),
                  // ã‚®ãƒ«ãƒ‰åç·¨é›†
                  Material(
                    color: Colors.transparent,
                    child: InkWell(
                      onTap: () {
                        context.push(
                          Screen.textEditing.path,
                          extra: TextEditingPageArgs(
                            title: 'Name',
                            text: guildName,
                            hintText: 'Enter guild name',
                            onSave: (updatedText) async {
                              await onTapSaveName(updatedText, guildName);
                            },
                          ),
                        );
                      },
                      borderRadius: BorderRadius.circular(8),
                      child: Container(
                        padding: const EdgeInsets.symmetric(vertical: 8),
                        child: Row(
                          mainAxisAlignment: MainAxisAlignment.spaceBetween,
                          children: [
                            const Text(
                              'Name',
                              style: TextStyle(
                                fontSize: 16,
                                color: ColorPallet.gray300,
                              ),
                            ),
                            const SizedBox(width: 8),
                            Flexible(
                              child: Row(
                                mainAxisSize: MainAxisSize.min,
                                children: [
                                  Flexible(
                                    child: Text(
                                      guildName,
                                      style: const TextStyle(fontSize: 16),
                                      maxLines: 1,
                                      overflow: TextOverflow.ellipsis,
                                    ),
                                  ),
                                  const SizedBox(width: 8),
                                  const Icon(
                                    Icons.chevron_right,
                                    color: ColorToken.text,
                                    size: 20,
                                  ),
                                ],
                              ),
                            ),
                          ],
                        ),
                      ),
                    ),
                  ),

                  const SizedBox(height: 32),
                  const Divider(color: ColorToken.secondary),
                  const SizedBox(height: 32),

                  // ç”³è«‹ä¸­ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§
                  _buildRequestedMembers(
                    context: context,
                    guildId: guildId,
                    guildMembers: guildMembers,
                    onTapReject: onTapReject,
                    onTapApprove: onTapApprove,
                  ),

                  // ã‚®ãƒ«ãƒ‰å‰Šé™¤ãƒœã‚¿ãƒ³
                  Padding(
                    padding: const EdgeInsets.only(top: 24, bottom: 24),
                    child: OutlinedButton(
                      onPressed: isLoadingState.value
                          ? null
                          : () async {
                              await onTapDeleteGuild();
                            },
                      child: const Text('Delete this guild'),
                    ),
                  ),
                ],
              ),
            ),
          );
        },
        loading: () => const Center(child: CircularProgressIndicator()),
        error: (error, _) => Center(child: Text('Error: $error')),
      ),
    );
  }

  /// ç”³è«‹ä¸­ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§è¡¨ç¤º
  Widget _buildRequestedMembers({
    required BuildContext context,
    required String guildId,
    required List<GuildMemberDto> guildMembers,
    required Future<void> Function({
      required String guildId,
      required String userId,
      required String userName,
    }) onTapReject,
    required Future<void> Function({
      required String guildId,
      required String userId,
      required String userName,
    }) onTapApprove,
  }) {
    final requestedMembers = guildMembers
        .where(
          (member) =>
              member.memberStatus == GuildMemberDtoMemberStatus.REQUESTED,
        )
        .toList();

    if (requestedMembers.isEmpty) {
      return const Center(
        child: Padding(
          padding: EdgeInsets.only(bottom: 180),
          child: Text('No members requesting to join.'),
        ),
      );
    }

    return Padding(
      padding: const EdgeInsets.only(bottom: 180),
      child: ListView.builder(
        shrinkWrap: true,
        physics: const NeverScrollableScrollPhysics(),
        itemCount: requestedMembers.length,
        itemBuilder: (context, index) {
          final member = requestedMembers[index];
          final userId = member.userId ?? '';
          final userName = member.username ?? '';
          final avatarUrl = member.avatar;
          final cameraList =
              member.decks?.firstOrNull?.deckCameras?.sorted() ?? [];

          return Padding(
            padding: const EdgeInsets.only(bottom: 8),
            child: DecoratedBox(
              decoration: BoxDecoration(
                color: ColorToken.bg,
                borderRadius: BorderRadius.circular(4),
                border: Border.all(color: ColorToken.defaultBorder),
              ),
              child: Padding(
                padding: const EdgeInsets.all(16),
                child: Column(
                  children: [
                    // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
                    Row(
                      children: [
                        Expanded(
                          child: GuildMemberColumn(
                            userName: userName,
                            isGuildOwner: false,
                            userPhotoUrl: avatarUrl,
                            cameraList: cameraList,
                          ),
                        ),
                        Expanded(
                          child: ParametersBarColumn(
                            searchQ: member.decks?.firstOrNull?.searchQ ?? 0,
                            attackE: member.decks?.firstOrNull?.attackE ?? 0,
                            luckL: member.decks?.firstOrNull?.luckL ?? 0,
                            defenseB: member.decks?.firstOrNull?.defenseB ?? 0,
                          ),
                        ),
                      ],
                    ),
                    const SizedBox(height: 16),
                    // æ‰¿èªãƒ»å´ä¸‹ãƒœã‚¿ãƒ³
                    Row(
                      mainAxisAlignment: MainAxisAlignment.spaceBetween,
                      children: [
                        Flexible(
                          child: OutlinedButton(
                            onPressed: () async {
                              await onTapReject(
                                guildId: guildId,
                                userId: userId,
                                userName: userName,
                              );
                            },
                            style: OutlinedButton.styleFrom(
                              minimumSize: const Size.fromHeight(32),
                            ),
                            child: const Text(
                              'Reject',
                              style: TextStyle(fontSize: 12),
                            ),
                          ),
                        ),
                        const SizedBox(width: 12),
                        Flexible(
                          child: ElevatedButton(
                            onPressed: () async {
                              await onTapApprove(
                                guildId: guildId,
                                userId: userId,
                                userName: userName,
                              );
                            },
                            style: OutlinedButton.styleFrom(
                              minimumSize: const Size.fromHeight(32),
                            ),
                            child: const Text(
                              'Approve',
                              style: TextStyle(fontSize: 12),
                            ),
                          ),
                        ),
                      ],
                    ),
                  ],
                ),
              ),
            ),
          );
        },
      ),
    );
  }

  /// å†™çœŸã®æ¨©é™ç¢ºèª
  Future<bool> _hasPhotoPermission(BuildContext context) async {
    final status = await Permission.photos.request();
    switch (status) {
      case PermissionStatus.granted:
      case PermissionStatus.limited:
        return true;
      case PermissionStatus.permanentlyDenied:
        if (context.mounted) {
          _showPermissionDialog(context);
        }
        return false;
      default:
        if (context.mounted) {
          ScaffoldMessenger.of(context).showSnackBar(
            const SnackBar(content: Text('Access to photos is not granted.')),
          );
        }
        return false;
    }
  }

  /// æ¨©é™ãŒæ°¸ä¹…æ‹’å¦ã®å ´åˆã®ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
  void _showPermissionDialog(BuildContext context) {
    showDialog<void>(
      context: context,
      builder: (context) => AlertDialog(
        insetPadding: const EdgeInsets.symmetric(horizontal: 16),
        shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(8)),
        backgroundColor: ColorPallet.gray800,
        title: const Text('Permission to access photos is required'),
        content: const Text('Enable photo access in settings to select a photo.'),
        actions: [
          TextButton(
            onPressed: () => context.pop(),
            child: const Text('Cancel'),
          ),
          TextButton(
            onPressed: () async {
              await openAppSettings();
            },
            child: const Text('Open Settings'),
          ),
        ],
      ),
    );
  }
}
```

---

## ãƒã‚¤ãƒ³ãƒˆ

1. **è¦ª `GuildManagePage` ã‚’æœ€å°é™ã«ã™ã‚‹**  
   - ã“ã“ã§ã¯ `Scaffold` ã¨ `AppBar` ã ã‘ã‚’æ®‹ã—ã€`body` ã« `GuildManagementContent` ã‚’é…ç½®ã—ã¦ã„ã¾ã™ã€‚  
   - ã™ã¹ã¦ã®ãƒ­ã‚¸ãƒƒã‚¯ãƒ»ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥å‡¦ç†ãƒ»APIå‘¼ã³å‡ºã—ç­‰ã¯æ–°è¦ä½œæˆã—ãŸå­ `HookConsumerWidget` ã«é›†ç´„ã€‚

2. **å­ `GuildManagementContent` ãŒ `HookConsumerWidget`**  
   - `build` ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ `ref.watch(...)` ã‚„ `ref.read(...)` ã‚’ä½¿ã„æ”¾é¡Œã«ãªã‚Šã¾ã™ã€‚
   - è¦ªã§ `ref` ã‚’å¼•ãå›ã™å¿…è¦ãŒãªããªã‚Šã¾ã™ã€‚

3. **å‰Šé™¤ãƒœã‚¿ãƒ³(onTapDeleteGuild) ã‚„ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥(onRefresh) ã‚‚å­ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆå†…ã§å®Œçµ**  
   - ã“ã‚Œã«ã‚ˆã‚Šã€Œã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã•ã‚Œã¦ã„ãŸã‚®ãƒ«ãƒ‰å‰Šé™¤ãƒœã‚¿ãƒ³ã€ã‚„ã€ãã“ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ `onTapDeleteGuild` ã®å®Ÿè£…ã€ã•ã‚‰ã«å‰Šé™¤å¾Œã®ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã¾ã§ä¸€è²«ã—ã¦å­ã§è¡Œãˆã¾ã™ã€‚
   - è¦ª `GuildManagePage` å´ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚¹ãƒƒã‚­ãƒªã•ã›ã‚‰ã‚Œã¾ã™ã€‚

4. **`RefreshIndicator` ã‚‚å­ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆå†…ã§å®Œçµã•ã›ã‚‹**  
   - `myGuildAsyncValue.when(...)` ã®ä¸­ã§ã‚®ãƒ«ãƒ‰æƒ…å ±ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹ã®ã§ã€ãã®å‘¨ã‚Šã‚’ `RefreshIndicator` ã§åŒ…ã‚ã°OKã€‚  
   - `useEffect` (åˆå›è¡¨ç¤ºæ™‚ã«éåŒæœŸå‡¦ç†ã‚’èµ°ã‚‰ã›ã‚‹) ã‚‚åŒã˜ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆå†…ã«ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚

---

ä¸Šè¨˜ã®ã‚„ã‚Šæ–¹ã§ã‚ã‚Œã°ã€**ã€Œ`ref` å¼•æ•°ã‚’å…¨ä½“ã§å¼•ãå›ã™ã€ã“ã¨ãªã**ã€  
`onTapDeleteGuild` ã‚’ã¯ã˜ã‚ã¨ã—ãŸ API å‘¼ã³å‡ºã—ã‚„ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥å‡¦ç†ã‚’ã€ã²ã¨ã¾ã¨ã‚ã«ç®¡ç†ã§ãã¾ã™ã€‚  

ã‚‚ã—ã€Œã‚¢ãƒ—ãƒªã«ã‚ˆã£ã¦ã¯è¦ªã«ã‚‚ä½•ã‚‰ã‹ã®ãƒ­ã‚¸ãƒƒã‚¯ãŒå¿…è¦ã€ã¨ã„ã†ã‚±ãƒ¼ã‚¹ãªã‚‰ã€å¿…è¦æœ€å°é™ã®ãƒ‡ãƒ¼ã‚¿ã‚„ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã ã‘ã‚’ `GuildManagementContent` ã¸æ¸¡ã™å½¢ã«èª¿æ•´ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

---

## ğŸ‘¤ User
*2025-02-14 15:34:46*

Widget _buildRequestedMembers({ ã‚’åˆ¥ã®HookConsumerWidgetã«ã—ãŸã»ã†ãŒã€é–¢æ•°ã‚’å¼•æ•°ã«å›ã•ãªã„ã®ã§è‰¯ããªã„ã‹ï¼Ÿ

---

## ğŸ”§ Tool
*2025-02-14 15:35:25*

**åˆ†é›¢ã—ã¦æ§‹ç¯‰ã™ã‚‹**

_RequestedMembersSectionã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’ç‹¬ç«‹ã•ã›ã€guilIdã¨guildMembersãƒªã‚¹ãƒˆã‚’ç›´æ¥å—ã‘å–ã‚‹ã€‚ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯å¼•æ•°ã¾ãŸã¯refã‹ã‚‰å–å¾—ã™ã‚‹ã€‚getMyGuildNotifierProviderã‚’ä½¿ç”¨ã—ã¦guildIdã¨ãƒ¡ãƒ³ãƒãƒ¼ã‚’ç›£è¦–ã™ã‚‹ã€‚

**æ•´ç†ã—ã¦ã„ã‚‹ã¨**

refã®é€šçŸ¥ã‚’ä½¿ã„ã€rejectã‚„approveã®å‡¦ç†ã‚’ã™ã‚‹ã€‚guildIdã‚„ãƒ¡ãƒ³ãƒãƒ¼ã‚’å¼•æ•°ã¨ã—ã¦æ¸¡ã—ãŸã‚Šã€è¦ªã‹ã‚‰ç›´æ¥èª­ã‚“ã ã‚Šã™ã‚‹æ–¹æ³•ã‚‚æ¢ã£ã¦ã„ã‚‹ã€‚

**è¦ªã®æä¾›å…ƒã‹ã‚‰ã®èª­ã¿è¾¼ã¿**

è¦ªã®æä¾›å…ƒã‹ã‚‰ç›´æ¥guildIdã‚’å–å¾—ã—ã¦ã€å­ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆå†…ã§refreshã‚’è¡Œã†æ–¹æ³•ã‚’æ¨¡ç´¢ã—ã¦ã„ã‚‹ã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¸¡ã•ãšã«è§£æ±ºã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ã€‚

**ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã¨ãƒ­ã‚¸ãƒƒã‚¯ç§»ç®¡**

`RequestedMembersSection`ã‚’ä½œæˆã—ã€`getMyGuildNotifierProvider`ã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã€ãŠãã‚‰ãè¦ªã‹ã‚‰ã®ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã‚’å¼•æ•°ã§æ¸¡ã—ã¦ã„ã‚‹ã€‚ã“ã“ã§ã®ä½œæ¥­é€²æ—ã‚’è¦‹å®ˆã‚‹ã€‚

**ä½œæ¥­ã®é€²è¡Œ**

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å¸Œæœ›ã‚’å—ã‘ã¦ã€_buildRequestedMembersã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç‹¬ç«‹ã•ã›ã€å­ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã¨ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã‚’æ‹…å½“ã•ã›ã‚‹æ–¹æ³•ã‚’ç¤ºã™ã‚³ãƒ¼ãƒ‰ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’ä½œæˆã—ã¦ã„ã‚‹ã€‚

---

## ğŸ¤– Assistant
*2025-02-14 15:35:25*

ã‚‚ã¡ã‚ã‚“ã€**`_buildRequestedMembers`** ã‚’åˆ¥ã® **`HookConsumerWidget`** ã«åˆ‡ã‚Šå‡ºã™è¨­è¨ˆã¯ã‚¢ãƒªã§ã™ã€‚  
ã€Œé–¢æ•°ã‚’å¼•æ•°ã¨ã—ã¦æ¸¡ã•ãšã«æ¸ˆã‚€ã€ã€ŒUIãƒ‘ãƒ¼ãƒ„ã”ã¨ã«è²¬å‹™ã‚’åˆ†å‰²ã—ã‚„ã™ã„ã€ãªã©ã®ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šã¾ã™ã€‚

---

## åˆ¥ `HookConsumerWidget` ã¸åˆ‡ã‚Šå‡ºã™ä¾‹

ä»¥ä¸‹ã¯ã‚µãƒ³ãƒ—ãƒ«ã¨ã—ã¦ã€`_buildRequestedMembers` ã®ä¸­èº«ã‚’ **`RequestedMembersSection`** ã¨ã„ã† **`HookConsumerWidget`** ã«åˆ†é›¢ã—ãŸä¾‹ã§ã™ã€‚

### 1. è¦ªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ (`GuildManagementContent` ãªã©) å´ã®ã‚³ãƒ¼ãƒ‰

```dart
import 'package:flutter/material.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';

/// è¦ªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆä¾‹ (GuildManagementContent)
class GuildManagementContent extends HookConsumerWidget {
  const GuildManagementContent({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    // ... çœç•¥: ã‚®ãƒ«ãƒ‰æƒ…å ±ã‚’å–å¾— (myGuildAsyncValue) ã™ã‚‹ãªã©ã®ãƒ­ã‚¸ãƒƒã‚¯ ...

    return myGuildAsyncValue.when(
      data: (guild) {
        if (guild == null) {
          return const SizedBox.shrink();
        }
        final guildId = guild.guildId ?? 'Unknown';
        final guildMembers = guild.guildMembers ?? [];

        return SingleChildScrollView(
          child: Column(
            children: [
              // ... çœç•¥: ã‚®ãƒ«ãƒ‰æƒ…å ±ã‚„ã‚®ãƒ«ãƒ‰åç·¨é›†ç”¨ã®UI ...

              // ã“ã“ã§ RequestedMembersSection ã‚’é…ç½®ã™ã‚‹
              RequestedMembersSection(
                guildId: guildId,
                guildMembers: guildMembers,
              ),

              // ... çœç•¥: ã‚®ãƒ«ãƒ‰å‰Šé™¤ãƒœã‚¿ãƒ³ãªã© ...
            ],
          ),
        );
      },
      loading: () => const Center(child: CircularProgressIndicator()),
      error: (error, _) => Center(child: Text(error.toString())),
    );
  }
}
```

- è¦ªã§ã¯ã€**`guildId`** ã¨ **`guildMembers`** ã ã‘ã‚’ **`RequestedMembersSection`** ã«æ¸¡ã—ã¦ã„ã¾ã™ã€‚
- ã€Œæ‰¿èª/å´ä¸‹ã€ãªã©ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯ **æ¸¡ã—ã¦ã„ã¾ã›ã‚“**ã€‚ä»£ã‚ã‚Šã« **å­ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆå†…ã§ `ref.read(...)` ã—ã¦å‡¦ç†** ã—ã¾ã™ã€‚

---

### 2. å­ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ (`RequestedMembersSection`) ã®å®Ÿè£…

```dart
import 'package:flutter/material.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';

// ä»¥ä¸‹ã¯å®Ÿéš›ã®ãƒ‘ã‚¹ã«åˆã‚ã›ã¦ import ã‚’èª¿æ•´ã—ã¦ãã ã•ã„
import 'package:snpit_guild_app/infrastructure/snapit_guild_api/snapit_guild_api.openapi.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/guilds/get_guild.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/guilds/update_guild_member.dart';
import 'package:snpit_guild_app/utils/snack_bar_utils.dart';
import 'package:snpit_guild_app/domain/design/color_token.dart';
import 'package:snpit_guild_app/presentation/widgets/guild_member_column.dart';
import 'package:snpit_guild_app/presentation/widgets/parameters_bar_column.dart';

/// ç”³è«‹ä¸­ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§è¡¨ç¤ºç”¨ã® HookConsumerWidget
class RequestedMembersSection extends HookConsumerWidget {
  const RequestedMembersSection({
    Key? key,
    required this.guildId,
    required this.guildMembers,
  }) : super(key: key);

  final String guildId;
  final List<GuildMemberDto> guildMembers;

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    // ç”³è«‹ä¸­ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚’çµã‚Šè¾¼ã‚€
    final requestedMembers = guildMembers.where(
      (m) => m.memberStatus == GuildMemberDtoMemberStatus.REQUESTED,
    ).toList();

    // ç”³è«‹ä¸­ãƒ¡ãƒ³ãƒãƒ¼ãŒã„ãªã„å ´åˆã®è¡¨ç¤º
    if (requestedMembers.isEmpty) {
      return const Center(
        child: Padding(
          padding: EdgeInsets.only(bottom: 180),
          child: Text('No members requesting to join.'),
        ),
      );
    }

    return Padding(
      padding: const EdgeInsets.only(bottom: 180),
      child: ListView.builder(
        shrinkWrap: true,
        physics: const NeverScrollableScrollPhysics(),
        itemCount: requestedMembers.length,
        itemBuilder: (context, index) {
          final member = requestedMembers[index];
          final userId = member.userId ?? '';
          final userName = member.username ?? '';
          final avatarUrl = member.avatar;
          final cameraList = member.decks?.firstOrNull?.deckCameras ?? [];

          return Padding(
            padding: const EdgeInsets.only(bottom: 8),
            child: DecoratedBox(
              decoration: BoxDecoration(
                color: ColorToken.bg,
                borderRadius: BorderRadius.circular(4),
                border: Border.all(color: ColorToken.defaultBorder),
              ),
              child: Padding(
                padding: const EdgeInsets.all(16),
                child: Column(
                  children: [
                    // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
                    Row(
                      children: [
                        Expanded(
                          child: GuildMemberColumn(
                            userName: userName,
                            isGuildOwner: false,
                            userPhotoUrl: avatarUrl,
                            cameraList: cameraList.sorted(), // æ‹¡å¼µãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã‚Œã°
                          ),
                        ),
                        Expanded(
                          child: ParametersBarColumn(
                            searchQ: member.decks?.firstOrNull?.searchQ ?? 0,
                            attackE: member.decks?.firstOrNull?.attackE ?? 0,
                            luckL: member.decks?.firstOrNull?.luckL ?? 0,
                            defenseB: member.decks?.firstOrNull?.defenseB ?? 0,
                          ),
                        ),
                      ],
                    ),
                    const SizedBox(height: 16),
                    // æ‰¿èªãƒ»å´ä¸‹ãƒœã‚¿ãƒ³
                    Row(
                      mainAxisAlignment: MainAxisAlignment.spaceBetween,
                      children: [
                        Flexible(
                          child: OutlinedButton(
                            onPressed: () async {
                              await _onTapReject(
                                context: context,
                                ref: ref,
                                guildId: guildId,
                                userId: userId,
                                userName: userName,
                              );
                            },
                            style: OutlinedButton.styleFrom(
                              minimumSize: const Size.fromHeight(32),
                            ),
                            child: const Text('Reject', style: TextStyle(fontSize: 12)),
                          ),
                        ),
                        const SizedBox(width: 12),
                        Flexible(
                          child: ElevatedButton(
                            onPressed: () async {
                              await _onTapApprove(
                                context: context,
                                ref: ref,
                                guildId: guildId,
                                userId: userId,
                                userName: userName,
                              );
                            },
                            style: ElevatedButton.styleFrom(
                              minimumSize: const Size.fromHeight(32),
                            ),
                            child: const Text('Approve', style: TextStyle(fontSize: 12)),
                          ),
                        ),
                      ],
                    ),
                  ],
                ),
              ),
            ),
          );
        },
      ),
    );
  }

  /// æ‰¿èªãƒœã‚¿ãƒ³æŠ¼ä¸‹
  Future<void> _onTapApprove({
    required BuildContext context,
    required WidgetRef ref,
    required String guildId,
    required String userId,
    required String userName,
  }) async {
    try {
      await ref.read(approveGuildNotifierProvider.notifier)
          .approveGuild(guildId: guildId, userId: userId);

      // æˆåŠŸã—ãŸã‚‰ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
      await ref.read(getMyGuildNotifierProvider.notifier).getMyGuild();

      if (context.mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text('Approved $userName')),
        );
      }
    } catch (error) {
      if (context.mounted) {
        showErrorSnackBar(context, error);
      }
    }
  }

  /// å´ä¸‹ãƒœã‚¿ãƒ³æŠ¼ä¸‹
  Future<void> _onTapReject({
    required BuildContext context,
    required WidgetRef ref,
    required String guildId,
    required String userId,
    required String userName,
  }) async {
    try {
      await ref.read(rejectGuildNotifierProvider.notifier)
          .rejectGuild(guildId: guildId, userId: userId);

      // æˆåŠŸã—ãŸã‚‰ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
      await ref.read(getMyGuildNotifierProvider.notifier).getMyGuild();

      if (context.mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text('Rejected $userName')),
        );
      }
    } catch (error) {
      if (context.mounted) {
        showErrorSnackBar(context, error);
      }
    }
  }
}
```

- ä¸Šè¨˜ã®ã‚ˆã†ã«ã€**æ‰¿èª/å´ä¸‹ã®ãƒ¡ã‚½ãƒƒãƒ‰**ï¼ˆ`_onTapApprove` / `_onTapReject`ï¼‰ã‚’ å­ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆå†…ã«å®šç¾© ã—ã€`ref.read(...)` ã§å„ NotifierProvider ã‚’ç›´æ¥å‘¼ã³å‡ºã—ã¦ã„ã¾ã™ã€‚
- å‡¦ç†å¾Œã«ã¯åŒã˜ã å­ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆå†…ã‹ã‚‰ `ref.read(getMyGuildNotifierProvider.notifier).getMyGuild()` ã‚’å‘¼ã³ã€**è‡ªåˆ†ã§ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥** ã—ã¦ã„ã¾ã™ã€‚
- ã“ã‚Œã«ã‚ˆã‚Šã€**è¦ªã‹ã‚‰ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’å¼•æ•°ã§ã‚‚ã‚‰ã‚ãš** ã«å®Œçµã§ãã¾ã™ã€‚

---

## ã€Œåˆ‡ã‚Šå‡ºã™ãƒ¡ãƒªãƒƒãƒˆã€ vs ã€Œåˆ‡ã‚Šå‡ºã•ãªã„ãƒ¡ãƒªãƒƒãƒˆã€

- **åˆ‡ã‚Šå‡ºã™ãƒ¡ãƒªãƒƒãƒˆ**  
  - è¦ªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒã‚·ãƒ³ãƒ—ãƒ«ã«ãªã‚Šã€**ç”³è«‹ä¸€è¦§ã«é–¢ã‚ã‚‹å‡¦ç†ã‚’ã¾ã‚‹ã”ã¨ã‚«ãƒ—ã‚»ãƒ«åŒ–** ã§ãã‚‹ã€‚  
  - ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å¼•æ•°ã‚’ãŸãã•ã‚“æ¸¡ã•ãªãã¦ã„ã„ã®ã§ã€è¦‹é€šã—ãŒè‰¯ããªã‚‹ã€‚

- **åˆ‡ã‚Šå‡ºã•ãªã„ãƒ¡ãƒªãƒƒãƒˆ**  
  - è¦ªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®çŠ¶æ…‹ã‚„é–¢æ•°ã§ä¸€æ‹¬ç®¡ç†ã§ãã‚‹ã®ã§ã€**ç”»é¢å˜ä½ã§æŠŠæ¡ã—ã‚„ã™ã„** å ´åˆã‚‚ã‚ã‚‹ã€‚  
  - ã‚ã–ã‚ã–åˆ¥ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«ã™ã‚‹ã»ã©ã§ã‚‚ãªã„ãƒœãƒªãƒ¥ãƒ¼ãƒ ãªã‚‰ã€åŒã˜ã‚¯ãƒ©ã‚¹ã«æ›¸ã„ã¦ãŠã„ãŸã»ã†ãŒä¸€è²«ã™ã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚‹ã€‚

æœ€çµ‚çš„ã«ã¯ã€**ãƒ­ã‚¸ãƒƒã‚¯ã®é‡** ã‚„ **å†åˆ©ç”¨ã®æœ‰ç„¡**ã€**ä¿å®ˆæ€§** ãªã©ã‚’è€ƒæ…®ã—ã¦ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ–¹é‡ã«åˆã‚ã›ã¦æ±ºã‚ã‚Œã°OKã§ã™ã€‚  

---

## ã¾ã¨ã‚

- **`_buildRequestedMembers(...)`** ã®ã‚ˆã†ã«æ©Ÿèƒ½ãŒã¯ã£ãã‚Šåˆ†ã‹ã‚Œã¦ã„ã‚‹éƒ¨åˆ†ã¯ã€**åˆ¥ `HookConsumerWidget`** ã¨ã—ã¦åˆ‡ã‚Šå‡ºã™ã¨ã€Œã‚³ãƒ¼ãƒ‰ã®åˆ†å‰²ã€ãŒé€²ã‚“ã§èª­ã¿ã‚„ã™ããªã‚Šã¾ã™ã€‚
- è¦ªã‹ã‚‰ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’å¤§é‡ã«æ¸¡ã™ã‚ˆã‚Šã€**å­ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆå´ã§ `ref.read(...)` ã‚„ `ref.watch(...)`** ã‚’ã™ã‚‹ã»ã†ãŒã‚·ãƒ³ãƒ—ãƒ«ã«ç®¡ç†ã§ãã‚‹ã‚±ãƒ¼ã‚¹ã‚‚å¤šã„ã§ã™ã€‚

---

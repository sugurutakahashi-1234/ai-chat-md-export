# ãƒ†ã‚¹ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

æ—¥ä»˜: 2025-06-11

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/11 10:27:59*

jestã§å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã”ã¨ã«__tests__ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’é…ç½®ã™ã‚‹æ§‹æˆã¯ä¸€èˆ¬çš„ãªã®ã‹ï¼Ÿå°å…¥ã—ã¦ã„ã‚‹ä¼æ¥­ã®ã‚µãƒ³ãƒ—ãƒ«ãªã© ãŒã‚ã‚Œã°æ•™ãˆã¦æ¬²ã—ã„

src/
â”œâ”€â”€ errors/
â”‚   â”œâ”€â”€ error-definition.ts
â”‚   â”œâ”€â”€ error-handler.ts
â”‚   â””â”€â”€ __tests__/
â”‚       â”œâ”€â”€ error-definition.test.ts
â”‚       â”œâ”€â”€ error-handler.test.ts
â”‚       â””â”€â”€ api-error.test.ts
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ users.ts
â”‚   â””â”€â”€ __tests__/
â”‚       â””â”€â”€ users.test.ts
â””â”€â”€ __tests__/
    â””â”€â”€ integration/
        â””â”€â”€ api.test.ts
```

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/11 10:29:11*

### çµè«– â€” ã€Œå„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç›´ä¸‹ã« `__tests__` ã‚’ç½®ãã€ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ååˆ†ãƒãƒ”ãƒ¥ãƒ©ãƒ¼  
Jest ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§

```
**/__tests__/**/*.[jt]s?(x)
**/*.{test,spec}.[jt]s?(x)
```

ã‚’æ¢ç´¢ã—ã¾ã™ã€‚ãã®ãŸã‚ **å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªéšå±¤ã« `__tests__` ã‚’ä¸¦ã¹ã‚‹æ–¹å¼**ã¯å…¬å¼ã«ã‚µãƒãƒ¼ãƒˆã•ã‚Œã€å¤šãã®ä¼æ¥­ãƒ» OSS ã§æ¡ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚ã‚ãªãŸãŒç¤ºã—ãŸ

```
src/errors/__tests__/*
src/routes/__tests__/*
```

ã®ã‚ˆã†ãªæ§‹æˆã¯ã¾ã•ã«ãã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã€å¯èª­æ€§ãƒ»ä¿å®ˆæ€§ã®ç‚¹ã§ã‚‚å®Ÿç¸¾ãŒã‚ã‚Šã¾ã™ã€‚

---

## æ¡ç”¨ä¾‹ï¼ˆä¼æ¥­ï¼å¤§è¦æ¨¡ OSSï¼‰

| ä¼šç¤¾ / ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ | æ¡ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¾‹ | å‚™è€ƒ |
|---|---|---|
| **Shopify â€“ Polaris React** | `src/components/IndexTable/tests/IndexTable.test.tsx` | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã”ã¨ã« `tests` ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½µè¨­ã™ã‚‹æ§‹æˆã€‚ îˆ€citeîˆ‚turn11search5îˆ |
| **Meta / Facebook â€“ jscodeshift** | `<transform>/__tests__/â€¦` | ã‚³ãƒ¼ãƒ‰ãƒ¢ãƒƒãƒ‰ 1 ã¤ã«ã¤ãã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª `__tests__` ã‚’ç½®ãã“ã¨ã‚’å…¬å¼ README ã§æ¨å¥¨ã€‚ îˆ€citeîˆ‚turn16search1îˆ |
| **Meta â€“ Jest è‡ªä½“ã®ã‚³ã‚¢** | core ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸é…ä¸‹ã« `__tests__/` ãŒå¤§é‡ã«å­˜åœ¨ | Jest æœ¬ä½“ãŒ â€œãƒ†ã‚¹ãƒˆæ¨ªç½®ãâ€ ã‚’æ¡ç”¨ã—ã¦ã„ã‚‹ä¾‹ã€‚ îˆ€citeîˆ‚turn0search5îˆ |
| **RedwoodJS CLI** | `generator/__tests__` ã¨ `__testfixtures__/` | ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã”ã¨ã«ãƒ†ã‚¹ãƒˆï¼ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã‚’ä¸¦ç½®ã€‚ îˆ€citeîˆ‚turn16search4îˆ |

> **Tip**: Next.js ãªã©ä¸€éƒ¨ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯ `pages/` ç›´ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒšãƒ¼ã‚¸ã¨ã—ã¦è§£é‡ˆã•ã‚Œã‚‹ãŸã‚  
> `pages/__tests__/` ã‚’é¿ã‘ã‚‹ã€ã‚ã‚‹ã„ã¯ `pageExtensions` ã‚’èª¿æ•´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ îˆ€citeîˆ‚turn4search3îˆ

---

## æ¨ªç½®ã (`__tests__`) ã®ãƒ¡ãƒªãƒƒãƒˆ / ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ

|               | ãƒ¡ãƒªãƒƒãƒˆ | ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ |
|---------------|----------|-----------|
| **ãƒ†ã‚¹ãƒˆæ¨ªç½®ã**<br>`src/foo/__tests__/foo.test.ts` | * å®Ÿè£…ã¨ãƒ†ã‚¹ãƒˆã‚’åŒæ™‚ã«é–²è¦§ã—ã‚„ã™ã„<br>* ãƒªãƒ•ã‚¡ã‚¯ã‚¿æ™‚ã®ãƒ•ã‚¡ã‚¤ãƒ«ç§»å‹•ã«è¿½å¾“ã—ã‚„ã™ã„<br>* ç›¸å¯¾ãƒ‘ã‚¹ import ãŒçŸ­ããªã‚‹ | * ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰ã«å«ã‚ãªã„ã‚ˆã† `exclude` è¨­å®šãŒå¿…é ˆï¼ˆBabelãƒ»tscãƒ»Vite ãªã©ï¼‰<br>* å¤§é‡ã® `__snapshots__` ãŒæ•£åœ¨ã™ã‚‹ã®ãŒæ°—ã«ãªã‚‹å ´åˆã‚‚ |
| **ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ« `tests/`** | * æœ¬ç•ªã‚³ãƒ¼ãƒ‰ã¨å®Œå…¨ã«åˆ†é›¢ã§ãã‚‹<br>* Jest ä»¥å¤–ã®ãƒ†ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ã«ç§»è¡Œã—ã¦ã‚‚æ§‹æˆã‚’å¤‰ãˆãšã«æ¸ˆã‚€ | * å®Ÿè£…ã‹ã‚‰é›¢ã‚Œã¦ãŠã‚Šæ¤œç´¢ã‚³ã‚¹ãƒˆãŒé«˜ã¾ã‚‹<br>* åŒåãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤šã„ã¨ IDE è£œå®ŒãŒé‡ãªã‚‹ |

è²´ç¤¾ã®ã‚ˆã†ã« **ã€Œãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã¯å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä¸‹ã€çµ±åˆãƒ†ã‚¹ãƒˆã¯ `src/__tests__/integration` ã«ã¾ã¨ã‚ã‚‹ã€** ã¯ã€ä¸¡è€…ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã£ãŸç¾å®Ÿçš„ãªæŠ˜è¡·æ¡ˆã¨ã—ã¦ã‚ˆãè¦‹ã‹ã‘ã‚‹æ§‹æˆã§ã™ã€‚

---

## å®Ÿè£…æ™‚ã«æŠ¼ã•ãˆã¦ãŠããŸã„ Jest è¨­å®š

```js
// jest.config.ts ã®ä¸€ä¾‹
export default {
  testMatch: [
    '**/__tests__/**/*.[jt]s?(x)',   // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
    '**/?(*.)+(spec|test).[tj]s?(x)'
  ],
  modulePathIgnorePatterns: [
    '<rootDir>/dist/',               // ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã‚’é™¤å¤–
  ],
  collectCoverageFrom: [
    'src/**/*.{ts,tsx,js,jsx}',
    '!src/**/__tests__/**',          // ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰è‡ªä½“ã¯ã‚«ãƒãƒ¬ãƒƒã‚¸å¯¾è±¡å¤–
  ],
};
```

* TypeScript ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ `tsc --noEmit` ã‚„ `ts-node/ts-jest` ãŒ `__tests__` ã‚‚è§£æã™ã‚‹ãŸã‚ã€`exclude` ã¾ãŸã¯ `compilerOptions.paths` ã‚’å¿˜ã‚Œãšã«ã€‚
* Node.js 18 ä»¥é™ã§ ESM ã‚’ä½¿ã†å ´åˆã€`testMatch` ã¨ `transform` ã®ãƒ‘ã‚¹è§£æ±ºé †ã«æ³¨æ„ã€‚

---

## ã¾ã¨ã‚

- **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é…ä¸‹ã® `__tests__` ä½µè¨­ã¯ Jest å…¬å¼ãŒæƒ³å®šã—ã¦ã„ã‚‹ç‹é“ãƒ‘ã‚¿ãƒ¼ãƒ³**ã€‚
- Shopify ã‚„ Metaï¼ˆFacebookï¼‰ãªã©ã® OSSï¼ç¤¾å†…ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚‚åºƒãå°å…¥æ¸ˆã¿ã€‚
- å°å…¥æ™‚ã¯ *ãƒ“ãƒ«ãƒ‰é™¤å¤–* ã¨ *ãƒšãƒ¼ã‚¸è‡ªå‹•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç³»ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¸ã®é…æ…®* ã‚’å¿˜ã‚Œãšã«è¨­å®šã™ã‚Œã°ã€å¤§è¦æ¨¡ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã§ã‚‚å¿«é©ã«é‹ç”¨ã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/11 10:31:01*

ã“ã‚Œã‚’ä¿®æ­£ã—ã¦æ¬²ã—ã„

import { defineConfig } from "vitest/config";

const config = defineConfig({
  test: {
    globals: true,
    environment: "node",
    include: \["packages/\*\*/src/\*\*/\*.{test,spec}.{js,ts,jsx,tsx}"\],
    exclude: \["\*\*/node\_modules/\*\*", "\*\*/dist/\*\*"\],
    coverage: {
      provider: "v8",
      reporter: \["text", "json", "html"\],
      exclude: \[
        "\*\*/\*.config.\*",
        "\*\*/dist/\*\*",
        "\*\*/node\_modules/\*\*",
        "\*\*/src/generated/\*\*",
      \],
    },
  },
});

export default config;

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/11 10:31:36*

ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãæ›ãˆã‚‹ã¨ Vitest ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨å®Ÿé‹ç”¨ã«æ²¿ã£ãŸè¨­å®šã«ãªã‚Šã¾ã™ã€‚ä¸»ãªä¿®æ­£ç‚¹ã¯ **â‘  include ã‚°ãƒ­ãƒ–ã‚’æ­£è¦ã®æ›¸å¼ã«**ã€**â‘¡ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã¨ã®é‡è¤‡ã‚’æ’é™¤**ã€**â‘¢ coverage.exclude ã‚’æ—¢å®šå€¤ã¨ãƒãƒ¼ã‚¸ã—ã¦æœ€å°åŒ–** ã® 3 ç‚¹ã§ã™ã€‚

```ts
import { defineConfig, coverageConfigDefaults } from "vitest/config";

export default defineConfig({
  test: {
    globals: true,
    environment: "node",

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // â‘ : ãƒ†ã‚¹ãƒˆå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¿ãƒ¼ãƒ³
    //    *.test.ts / *.spec.ts ãªã©ã‚’ packages/*/src ä»¥ä¸‹ã‹ã‚‰æ‹¾ã†
    //    Vitest æ¨™æº–ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆdocs: **/*.{test,spec}.?(c|m)[jt]s?(x)ï¼‰ã‚’
    //    packages/*/src ã«é™å®šã™ã‚‹ã ã‘ã§ OK
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    include: ["packages/*/src/**/*.{test,spec}.?(c|m)[jt]s?(x)"],

    // ãƒ†ã‚¹ãƒˆè‡ªä½“ã‚’å®Ÿè¡Œã—ãªã„ãƒ‘ã‚¹
    // ï¼ˆã“ã“ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨åŒã˜ãªã®ã§è¿½åŠ åˆ†ã ã‘æ›¸ãï¼‰
    exclude: ["**/dist/**"],

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // â‘¡: ã‚«ãƒãƒ¬ãƒƒã‚¸è¨­å®š
    //    test.include ã¨åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ Vitest ãŒè‡ªå‹•ã§é™¤å¤–ã—ã¦ãã‚Œã‚‹
    //    â†’ é‡è¤‡ã™ã‚‹ exclude ã¯ä¸è¦
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    coverage: {
      provider: "v8",                           // Node 18+ ãªã‚‰ v8 ã§å•é¡Œãªã—
      reporter: ["text", "json", "html"],
      exclude: [
        "**/*.config.*",                        // è¿½åŠ ã§é™¤å¤–ã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«
        "**/src/generated/**",
        ...coverageConfigDefaults.exclude,      // æ—¢å®šã®é™¤å¤–ã‚’ç¶­æŒ
      ],
    },
  },
});
```

### å¤‰æ›´ãƒã‚¤ãƒ³ãƒˆè©³ç´°

| ä¿®æ­£ç®‡æ‰€ | èª¬æ˜ |
|----------|------|
| **include** | Vitest å…¬å¼ã®æ—¢å®šå€¤ã¯ `**/*.{test,spec}.?(c|m)[jt]s?(x)` îˆ€citeîˆ‚turn2view0îˆã€‚ã“ã‚Œã‚’ *packages* ä»¥ä¸‹ã«ã‚¹ã‚³ãƒ¼ãƒ—ã‚’çµã£ãŸã ã‘ã«ã—ã€äºŒé‡æ³¢æ‹¬å¼§ `{}` ãŒãƒã‚¹ãƒˆã—ã¦ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå±•é–‹ã•ã‚Œãªã„å•é¡Œã‚’å›é¿ã—ã¾ã—ãŸã€‚ |
| **exclude** | `node_modules/**` ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ—¢å®šã§é™¤å¤–ã•ã‚Œã‚‹ãŸã‚è¨˜è¿°ã‚’ç°¡ç•¥åŒ–ã—ã¾ã—ãŸï¼ˆæ®‹ã—ãŸã„ç‹¬è‡ªãƒ‘ã‚¹ã ã‘æ›¸ãæ–¹ãŒãƒ¡ãƒ³ãƒ†ã—ã‚„ã™ã„ï¼‰ã€‚ |
| **coverage.exclude** | `coverageConfigDefaults.exclude` ã‚’å±•é–‹ã—ã¦ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨è‡ªå‰ãƒ«ãƒ¼ãƒ«ã‚’ãƒãƒ¼ã‚¸ã€‚Vitest ã¯ test.include ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è‡ªå‹•ã§é™¤å¤–ã«åŠ ãˆã‚‹ãŸã‚ã€é‡è¤‡æŒ‡å®šã¯ä¸è¦ã§ã™ï¼ˆdocs å‚™è€ƒæ¬„å‚ç…§ï¼‰ îˆ€citeîˆ‚turn2view0îˆã€‚ |

ã“ã‚Œã§ **ãƒ‘ã‚¿ãƒ¼ãƒ³è§£æ±ºã‚¨ãƒ©ãƒ¼ãŒå‡ºãš**ã€ã‹ã¤ **è¨­å®šã®é‡è¤‡ã‚„ç„¡é§„ãªé™¤å¤–æŒ‡å®š** ã‚‚ç„¡ããªã‚Šã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/11 10:33:45*

provider: "v8", // Node 18+ ãªã‚‰ v8 ã§å•é¡Œãªã—ã«ã¤ã„ã¦ã€ä»Šã¯ Node+24ãªã‚“ã ã‚‚ã£ã¨ãŸã‹ãã§ãã‚‹ã®ã‹ï¼Ÿ

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/11 10:34:04*

`coverage.provider` ã«æ¸¡ã™ \*\*"v8" ã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã§ã¯ãªã â€œV8 ã‚¨ãƒ³ã‚¸ãƒ³ã‚’ç›´æ¥ä½¿ã†æ–¹å¼â€ ã¨ã„ã†æ„å‘³\*\* ãªã®ã§ã€Node 24 ã§ã‚‚ãã®ã¾ã¾ `v8` ã‚’æŒ‡å®šã™ã‚‹ã®ãŒæ­£è§£ã§ã™ã€‚

---

### ãªãœ `v8` ã®ã¾ã¾ã§è‰¯ã„ã®ã‹ï¼Ÿ

| èª¤è§£ã—ãŒã¡ãªç‚¹ | å®Ÿéš›ã¯â€¦ |
|----------------|---------|
| \*\*`"v8"` ã¯ V8 v8.x ã‚’æŒ‡ã—ã¦ã„ã‚‹ï¼Ÿ\*\* | \*\*Ã—\*\* ãƒãƒ¼ã‚¸ãƒ§ãƒ³è¡¨è¨˜ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚Vitest ãŒ â€œãƒã‚¤ãƒ†ã‚£ãƒ– V8 ã‚«ãƒãƒ¬ãƒƒã‚¸ API ã‚’ä½¿ã†â€ æ–¹å¼ã‚’æŒ‡å®šã™ã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§ã™ã€‚|
| \*\*Node 24 ã ã‹ã‚‰ `v13` ãªã©ã«ä¸Šã’ã‚‰ã‚Œã‚‹ï¼Ÿ\*\* | \*\*Ã—\*\* é¸æŠè‚¢ã¯ `v8`ãƒ»`istanbul`ãƒ»`custom` ã® 3 ã¤ã ã‘ã§ã™ã€‚Node 24ï¼ˆå†…éƒ¨ V8 13.6 â€»ï¼‰ã‚’ä½¿ã£ã¦ã„ã¦ã‚‚è¨­å®šå€¤ã¯ `v8` ã®ã¾ã¾ã€‚|

&gt; â€» Node 24.0.0 ã®ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã§ V8 13.6 ã¸ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã•ã‚ŒãŸã“ã¨ãŒç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚ îˆ€citeîˆ‚turn2search0îˆ  
&gt; Vitest å…¬å¼ã‚¬ã‚¤ãƒ‰ã‚‚ã€`provider: 'v8'` ã¾ãŸã¯ `'istanbul'` ã¨ã ã‘è¨˜è¼‰ã—ã¦ã„ã¾ã™ã€‚ îˆ€citeîˆ‚turn1search0îˆ

---

### ã‚‚ã— â€œã‚ˆã‚Šé«˜æ©Ÿèƒ½â€ ã‚’æ±‚ã‚ã‚‹ãªã‚‰

| ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ | ç‰¹å¾´ | ã“ã‚“ãªæ™‚ã« |
|--------------|------|-----------|
| \*\*v8 (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)\*\* | é€Ÿã„ãƒ»äº‹å‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ«ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ä¸è¦ãƒ»AST ãƒãƒƒãƒ”ãƒ³ã‚°ã«ã‚ˆã‚Šç²¾åº¦ã‚‚é«˜ã„ï¼ˆVitest â‰¥ v3.2ï¼‰ | Node / Chromium ãƒ™ãƒ¼ã‚¹ç’°å¢ƒã§é€Ÿåº¦å„ªå…ˆ |
| \*\*istanbul\*\* | ãƒ©ãƒ³ã‚¿ã‚¤ãƒ éä¾å­˜ï¼ˆV8 ä»¥å¤–ã§ã‚‚å¯ï¼‰ãƒ»ãƒ–ãƒ©ãƒ³ãƒ/é–¢æ•°å˜ä½ã®é–¾å€¤è¨­å®šãªã©ãŒè±Šå¯Œ | Firefox / Bun å¯¾å¿œã‚„è©³ç´°ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒæ¬²ã—ã„ |
| \*\*custom\*\* + `coverage.customProviderModule` | ç‹¬è‡ªãƒ¬ãƒãƒ¼ãƒˆå½¢å¼ã‚„ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£è£½é›†è¨ˆã‚’çµ„ã¿è¾¼ã¿ãŸã„ | ç¤¾å†…ãƒ„ãƒ¼ãƒ«ã‚„ç‹¬è‡ªå¯è¦–åŒ–ã¨é€£æº |

Node 24 ã§ã€Œã‚‚ã£ã¨é«˜ãã€ã¨ã„ã†æ„å‘³ãŒ \*\*â€œã‚«ãƒãƒ¬ãƒƒã‚¸ç²¾åº¦ã‚„æ©Ÿèƒ½ã‚’ä¸Šã’ãŸã„â€\*\* ã®ã§ã‚ã‚Œã°ã€`istanbul` ã‚’è©¦ã—ã¦é–¾å€¤ã‚„ ignore è¨­å®šã‚’ç´°ã‹ããƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã™ã‚‹ã®ãŒç¾å®Ÿçš„ã§ã™ã€‚

---

### ã¾ã¨ã‚

- `provider: "v8"` ã¯ \*\*ã€ŒV8 ã‚«ãƒãƒ¬ãƒƒã‚¸ API ã‚’ä½¿ã†ã€\*\* ã¨ã„ã†ã‚¹ã‚¤ãƒƒãƒã§ã‚ã‚Šã€Node ã® V8 ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ 8â†’13 ã«ãªã£ã¦ã‚‚å¤‰æ›´ä¸è¦ã€‚  
- Node 24 ã§ã‚‚ `v8` ã‚’æŒ‡å®šã—ã¦ãŠã‘ã°æœ€æ–°ã® V8 13.x ã«å¯¾ã—ã¦è‡ªå‹•ã§è¨ˆæ¸¬ãŒè¡Œã‚ã‚Œã‚‹ã€‚  
- æ©Ÿèƒ½é¢ã§ç‰©è¶³ã‚Šãªã‘ã‚Œã° `istanbul` ã‹ `custom` ã‚’æ¤œè¨ã™ã‚‹ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/11 10:36:56*

ä»Šãƒ¢ãƒãƒ¬ãƒã‚’ä½¿ã£ã¦ã„ã¦ã€tsconfig.jsonã¯ã“ã®ã‚ˆã†ãªå½¢ã«ãªã£ã¦ã„ã¦ã€ã‚µãƒ¼ãƒãƒ¼ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®tsconfig.jsonã‚‚ã„ã‹ã®ã‚ˆã†ãªå½¢ã«ãªã£ã¦ã„ã‚‹ã€‚ã“ã®æ™‚ã«ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ“ãƒ«ãƒ‰ã‹ã‚‰ã®æ–¹æ³•ãªã©ã¯ã‚ã‚‹ã®ã‹ã€ãã‚Œã¨ã‚‚ã‚„ã£ã±ã‚Šãƒ“ãƒ«ãƒ‰ã¯ã—ãŸæ–¹ãŒã„ã„ã®ã‹æ•™ãˆã¦ã»ã—ã„ã€‚

// tsconfig.base.json

{
  "compilerOptions": {
    // ============================================================
    // ğŸ—ï¸  åŸºæœ¬ãƒ“ãƒ«ãƒ‰è¨­å®š
    // ============================================================
    "target": "ES2024", // ğŸ“¦ å‡ºåŠ›ã‚³ãƒ¼ãƒ‰ã®ECMAScriptã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
    "module": "ESNext", // ğŸ“¦ æœ€æ–°ã®ESMä»•æ§˜
    "moduleResolution": "Bundler", // ğŸ“¦ ãƒ¢ãƒ€ãƒ³ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è§£æ±ºï¼ˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼/ãƒ„ãƒ¼ãƒ«ãƒã‚§ã‚¤ãƒ³å¯¾å¿œï¼‰
    "moduleDetection": "force", // ğŸ”’ LEVEL-1: ã™ã¹ã¦ã‚’ã€Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€æ‰±ã„ï¼ˆãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«æ±šæŸ“é˜²æ­¢ï¼‰
    // â””â”€ script ã‚¿ã‚°ã§å®Ÿè¡Œã—ãªã„å‰æã®ãƒ¢ãƒãƒ¬ãƒã«æ¨å¥¨ã€‚ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å½±éŸ¿ãªã—

    // ============================================================
    // ğŸ”’ LEVEL-1: â€œå¿…é ˆâ€ åŸºæœ¬å‹å®‰å…¨
    // ============================================================
    "strict": true, // ğŸ”’ strictãƒ¢ãƒ¼ãƒ‰ä¸€æ‹¬ï¼ˆnoImplicitAny ç­‰ã‚’å†…åŒ…ï¼‰
    "forceConsistentCasingInFileNames": true, // ğŸ”’ ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã®å¤§æ–‡å­—å°æ–‡å­—å·®ç•°ã‚’æ¤œå‡º
    // ã„ãšã‚Œã‚‚ãƒ“ãƒ«ãƒ‰é€Ÿåº¦ã¸ã®å½±éŸ¿ã¯ã»ã¼ã‚¼ãƒ­

    // ============================================================
    // ğŸ”’ğŸ”’ LEVEL-2: â€œæ¨å¥¨â€ ä¸­ç´šå‹å®‰å…¨
    // ============================================================
    "exactOptionalPropertyTypes": true, // ğŸ”’ğŸ”’ undefined ä»¥å¤– (null ãªã©) ã‚’æ’é™¤
    "noUncheckedIndexedAccess": true, // ğŸ”’ğŸ”’ arr\[0\] ãªã©ã« |undefined ã‚’ä»˜ä¸
    "noImplicitReturns": true, // ğŸ”’ğŸ”’ é–¢æ•°ã®å…¨ãƒ‘ã‚¹ã§ return ã‚’å¼·åˆ¶
    "noFallthroughCasesInSwitch": true, // ğŸ”’ğŸ”’ switch ã® break æŠœã‘æ¼ã‚Œé˜²æ­¢
    "useUnknownInCatchVariables": true, // ğŸ”’ğŸ”’ catch å¤‰æ•°ã‚’ unknown å‹ã«
    "isolatedDeclarations": true, // ğŸ”’ğŸ”’ å…¬é–‹ API ã«å‹æ³¨é‡ˆæ¼ã‚ŒãŒã‚ã‚‹ã¨ã‚¨ãƒ©ãƒ¼
    // â””â”€ composite / declaration ã¨é€£å‹•ã€‚é«˜é€Ÿä¸¦åˆ— .d.ts ç”Ÿæˆã«ã‚‚å¯„ä¸ã€‚ãƒ“ãƒ«ãƒ‰æ™‚é–“: è»½å¾® +

    // ============================================================
    // ğŸ”’ğŸ”’ğŸ”’ LEVEL-3: â€œä¸Šç´šâ€ å‹å®‰å…¨
    // ============================================================
    "noImplicitOverride": true, // ğŸ”’ğŸ”’ğŸ”’ override ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å¿…é ˆåŒ–ï¼ˆæ„å›³ã—ãªã„ä¸Šæ›¸ãé˜²æ­¢ï¼‰
    "noPropertyAccessFromIndexSignature": true, // ğŸ”’ğŸ”’ğŸ”’ obj.prop ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶é™ â†’ obj\["prop"\] ã‚’æ¨å¥¨
    "verbatimModuleSyntax": true, // ğŸ”’ğŸ”’ğŸ”’ import/export ã®æ§‹æ–‡ã‚’å³æ ¼ã«ä¿æŒ
    // â””â”€ ä¸è¦ãª value import ã‚’è‡ªå‹•é™¤å»ã—ã€ãƒ„ãƒªãƒ¼ã‚·ã‚§ã‚¤ã‚¯åŠ¹ç‡UP

    // ============================================================
    // ğŸ”’ğŸ”’ğŸ”’ğŸ”’ LEVEL-4: â€œæ½”ç™–â€ ãƒ‡ãƒƒãƒ‰ã‚³ãƒ¼ãƒ‰æ¤œå‡º
    // ============================================================
    "noUnusedLocals": true, // ğŸ”’ğŸ”’ğŸ”’ğŸ”’ æœªä½¿ç”¨å¤‰æ•°ã‚’ã‚¨ãƒ©ãƒ¼
    "noUnusedParameters": true, // ğŸ”’ğŸ”’ğŸ”’ğŸ”’ æœªä½¿ç”¨å¼•æ•°ã‚’ã‚¨ãƒ©ãƒ¼ï¼ˆ\_ ã§å›é¿ï¼‰
    "allowUnreachableCode": false, // ğŸ”’ğŸ”’ğŸ”’ğŸ”’ åˆ°é”ä¸èƒ½ã‚³ãƒ¼ãƒ‰ã‚’ã‚¨ãƒ©ãƒ¼
    "allowUnusedLabels": false, // ğŸ”’ğŸ”’ğŸ”’ğŸ”’ æœªä½¿ç”¨ãƒ©ãƒ™ãƒ«ã‚’ã‚¨ãƒ©ãƒ¼
    // â””â”€ IDE è­¦å‘ŠãŒå¢—ãˆã‚‹ãŒå“è³ªå‘ä¸Šã€‚ãƒ“ãƒ«ãƒ‰æ™‚é–“: å½±éŸ¿è»½å¾®

    // ============================================================
    // âš¡  ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
    // ============================================================
    "skipLibCheck": true, // âš¡ å¤–éƒ¨å‹å®šç¾©ã®ãƒã‚§ãƒƒã‚¯ã‚’ã‚¹ã‚­ãƒƒãƒ— â†’ ãƒ“ãƒ«ãƒ‰é«˜é€ŸåŒ–â—
    "isolatedModules": true, // âš¡ ãƒ•ã‚¡ã‚¤ãƒ«å˜ä½ã®ç‹¬ç«‹ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã§ HMR é«˜é€ŸåŒ–
    "incremental": true, // âš¡ å¢—åˆ†ãƒ“ãƒ«ãƒ‰ON

    // (å¤§è¦æ¨¡ãƒ¢ãƒãƒ¬ãƒå‘ã‘) IDEãƒ¡ãƒ¢ãƒªç¯€ç´„ â†’ é©å®œã‚³ãƒ¡ãƒ³ãƒˆè§£é™¤
    // "disableReferencedProjectLoad": true,

    // ============================================================
    // ğŸ”—  äº’æ›ãƒ»Interop
    // ============================================================
    "esModuleInterop": true, // CommonJS default export ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã‚„ã™ã
    "allowSyntheticDefaultImports": true, // Babel äº’æ›ã® default import ã‚’è¨±å¯
    "resolveJsonModule": true, // JSON import ã‚’å‹ä»˜ãã§è¨±å¯

    // ============================================================
    // ğŸ—‚ï¸  å‡ºåŠ›è¨­å®š
    // ============================================================
    "sourceMap": true, // ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ—çµ±åˆã«å¿…é ˆ
    "composite": true, // ãƒ“ãƒ«ãƒ‰ã®ä¸¦åˆ—åŒ–ã«å¿…é ˆ
    "declaration": true, // å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«(.d.ts)ç”Ÿæˆã§ãƒ¢ãƒãƒ¬ãƒé–“ã®å‹å…±æœ‰æ”¹å–„
    "declarationMap": true, // å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ—ç”Ÿæˆã§ãƒ‡ãƒãƒƒã‚°æ”¹å–„
    "importHelpers": true, // tslib ã®å…±é€šåŒ–ã§ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºæ¸›
    "newLine": "lf", // æ”¹è¡Œã‚³ãƒ¼ãƒ‰çµ±ä¸€

    // ============================================================
    // ğŸ“Œ  ãƒ‘ã‚¹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ï¼ˆãƒ¢ãƒãƒ¬ãƒä¾‹ï¼‰
    // ============================================================
    "baseUrl": ".",
    "paths": {
      "@myapp/shared": \["./packages/shared/src"\],
      "@myapp/shared/\*": \["./packages/shared/src/\*"\]
    }
  }
}


// Server

{
  "extends": "../../tsconfig.base.json",
  "compilerOptions": {
    // ============================================================
    // ğŸ¢ Node / Edge ãƒ©ãƒ³ã‚¿ã‚¤ãƒ 
    // ============================================================
    "lib": \["ES2024"\], // DOM ä¸è¦
    "module": "NodeNext", // Node.js ESMã«æº–æ‹ 
    "moduleResolution": "NodeNext", // Node.jså›ºæœ‰ã®è§£æ±ºãŒå¿…è¦
    "types": \["node"\], // Node.jså‹å®šç¾©
    "rootDir": "./src",
    "outDir": "./dist",

    "noEmit": false // ãƒ“ãƒ«ãƒ‰æ™‚ã¯ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›
  },
  "include": \["src/\*\*/\*.ts"\],
  "references": \[{ "path": "../shared" }, { "path": "../database" }\]
}

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/11 10:36:57*

### TL;DR  
æœ¬ç•ªãƒ“ãƒ«ãƒ‰ (`tsc -b` / `tsup` ãªã©) ã§ã¯ **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«å¯¾è±¡ã‹ã‚‰å¤–ã™** ã®ãŒä¸€èˆ¬çš„ã§ã™ã€‚  
IDE è£œå®Œã‚„ Vitest å®Ÿè¡Œæ™‚ã«å‹ãƒã‚§ãƒƒã‚¯ã‚’åŠ¹ã‹ã›ãŸã„å ´åˆã¯ **ã€Œé–‹ç™ºç”¨ tsconfigã€ã¨ã€Œãƒ“ãƒ«ãƒ‰ç”¨ tsconfigã€ã‚’åˆ†ã‘ã‚‹** ã®ãŒæœ€ã‚‚ãƒˆãƒ©ãƒ–ãƒ«ãŒå°‘ãªã„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã™ã€‚

---

## ãªãœãƒ†ã‚¹ãƒˆã‚’ãƒ“ãƒ«ãƒ‰ã‹ã‚‰å¤–ã™ã®ã‹ï¼Ÿ

| å½±éŸ¿ | å«ã‚ãŸå ´åˆ | å¤–ã—ãŸå ´åˆ |
|---|---|---|
| **ãƒ“ãƒ«ãƒ‰é€Ÿåº¦** | ãƒ†ã‚¹ãƒˆåˆ†ã ã‘ `tsc` ãƒ‘ã‚¹ãŒå¢—ãˆé…ããªã‚‹ | é€Ÿã„ |
| **dist ã‚µã‚¤ã‚º** | `*.test.js` ã‚„ `__tests__` ãŒã¾ãã‚Œè¾¼ã‚€ | è»½ã„ |
| **ä¾å­˜è§£æ±º** | `@vitest` å‹ã‚„ `happy-dom` å‹ãŒ **runtime ä¾å­˜** ã¨èª¤è§£ã•ã‚ŒãŒã¡ | dev-only ä¾å­˜ã‚’åŒºåˆ¥ã§ãã‚‹ |
| **å‹ãƒã‚§ãƒƒã‚¯** | âœ… IDE ã§ã‚‚é€šã‚‹ãŒã€æœ¬ç•ªä¸è¦ã®å‹ã‚‚å¸¸ã«è§£æ±º | âœ… IDE ã§ã‚‚é€šã‚‹ï¼ˆå¾Œè¿°ã® dev ç”¨ tsconfig ã§æ‹…ä¿ï¼‰ |

å®Ÿé‹ç”¨ã§ã¯ â€œIDE ã§ãƒ†ã‚¹ãƒˆã‚‚å‹ã‚¨ãƒ©ãƒ¼ã‚’å‡ºã—ãŸã„â€ ã¨ â€œæœ¬ç•ª artefact ã¯ãƒŸãƒ‹ãƒãƒ«ã«ã—ãŸã„â€ ã®ä¸¡ç«‹ãŒå¿…è¦ã§ã™ã€‚ãã®ãŸã‚ **tsconfig ã‚’ 2 æšã«åˆ†ã‘ã‚‹æ§‹æˆ** ãŒå®šç•ªã§ã™ã€‚

---

## ãƒ¢ãƒãƒ¬ãƒã§ã®å…·ä½“çš„ãªæ§‹æˆä¾‹

```
packages/
â””â”€â”€ server/
    â”œâ”€â”€ tsconfig.json         // é–‹ç™ºç”¨ (IDEãƒ»Vitest)
    â”œâ”€â”€ tsconfig.build.json   // æœ¬ç•ªãƒ“ãƒ«ãƒ‰ç”¨
    â””â”€â”€ src/
        â”œâ”€â”€ index.ts
        â””â”€â”€ __tests__/
            â””â”€â”€ index.test.ts
```

### 1. é–‹ç™ºç”¨ `tsconfig.json`ï¼ˆVitest / IDEï¼‰

```jsonc
// packages/server/tsconfig.json
{
  "extends": "../../tsconfig.base.json",
  "compilerOptions": {
    // Node ãƒ©ãƒ³ã‚¿ã‚¤ãƒ è¨­å®šã¯ãã®ã¾ã¾
    "lib": ["ES2024"],
    "module": "NodeNext",
    "moduleResolution": "NodeNext",
    "types": ["node", "vitest"],   // â† â˜… ãƒ†ã‚¹ãƒˆå‹ã‚’è§£æ±º
    "rootDir": "./src",
    "outDir": "./dist",
    "noEmit": true                 // â† â˜… é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚ºã¯å‡ºåŠ›ã—ãªã„
  },
  "include": ["src/**/*.ts"],
  "references": [{ "path": "../shared" }, { "path": "../database" }]
}
```

* `noEmit: true` ã«ã‚ˆã£ã¦ **IDE ã¨ Vitest ã ã‘ãŒå‹ãƒã‚§ãƒƒã‚¯ã—ã€ãƒ•ã‚¡ã‚¤ãƒ«ã¯å‡ºåŠ›ã—ãªã„**ã€‚

### 2. ãƒ“ãƒ«ãƒ‰ç”¨ `tsconfig.build.json`

```jsonc
// packages/server/tsconfig.build.json
{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "noEmit": false                // â† â˜… prod ãƒ“ãƒ«ãƒ‰ã¯ emit
  },
  "exclude": [
    "**/*.test.ts",
    "**/*.spec.ts",
    "**/__tests__/**"
  ]
}
```

* **exclude** ã«ã‚ˆã‚Šãƒ†ã‚¹ãƒˆã¯ãƒ“ãƒ«ãƒ‰å¯¾è±¡å¤–ã€‚
* ãƒ«ãƒ¼ãƒˆ `package.json` ã‚„ CI ã§ã¯ `tsc -p packages/server/tsconfig.build.json` ã‚’å‘¼ã³å‡ºã™ã€‚

> **è£œè¶³**: solution-style ãƒ“ãƒ«ãƒ‰ (`tsc -b`) ã‚’ä½¿ã†å ´åˆã¯ `references` ã‹ã‚‰ã‚‚å„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã® `tsconfig.build.json` ã‚’æŒ‡ã™ã‚ˆã†ã«ã—ã¾ã™ã€‚

---

## ä»£æ›¿æ¡ˆï¼š`tsup` / `esbuild` ã‚’ä½¿ã†å ´åˆ

`tsup`, `unbuild`, `bun build` ãªã© **ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ç³»** ã‚’æ¡ç”¨ã™ã‚‹å ´åˆã¯å¤§æŠµãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§

* `__tests__/`
* `*.test.ts`, `*.spec.ts`
* `vitest.config.*`

ã‚’ **è‡ªå‹•ã§å¤–ã—ã¦ãã‚Œã‚‹** ãŸã‚ã€ãƒ“ãƒ«ãƒ‰ç”¨ tsconfig ã‚’åˆ†ã‘ãšã¨ã‚‚ OK ã§ã™ï¼ˆãŸã ã— `tsup --dts` ã®éš›ã¯ TS ã®å‹ãƒã‚§ãƒƒã‚¯ã‚’é€šã‚‹ã®ã§ã€ä¸Šã¨åŒã˜ exclude ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ `tsconfig.json` å´ã«æ›¸ã„ã¦ãŠãã¨å®‰å¿ƒï¼‰ã€‚

---

## FAQ

| ç–‘å• | å›ç­” |
|------|------|
| **Vitest ãŒ `noEmit: false` ãª tsconfig.build.json ã‚’æ‹¾ã£ã¦ã—ã¾ã‚ãªã„ï¼Ÿ** | `vitest` ã‚³ãƒãƒ³ãƒ‰ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ç›´ä¸‹ or `vite.config.ts` ã«é€£å‹•ã—ãŸ tsconfig ã‚’æ¢ã—ã¾ã™ã€‚ãƒ¢ãƒãƒ¬ãƒã§ **explicit ãª `--config` or `root` ã‚’æŒ‡å®š**ã™ã‚Œã°ã€é–‹ç™ºç”¨ tsconfig ã ã‘ã‚’èª­ã‚€ã®ã§å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚|
| **`isolatedDeclarations` ãŒã‚ã‚‹ã¨ãƒ†ã‚¹ãƒˆå°‚ç”¨ã®å‹ä¸è¶³ã§è½ã¡ãªã„ï¼Ÿ** | è½ã¡ã¾ã™ã€‚ã ã‹ã‚‰ã“ã *é–‹ç™ºç”¨ tsconfig* ã«ã¯ `"types": ["vitest"]` ã‚’å…¥ã‚Œã¦ IDE ã§ã‚‚è§£æ±ºã•ã›ã€æœ¬ç•ªç”¨ tsconfig.build.json ã§ã¯ãƒ†ã‚¹ãƒˆã‚’ exclude ã™ã‚‹å½¢ã§å›é¿ã—ã¾ã™ã€‚|
| **ãƒ“ãƒ«ãƒ‰ã§ã‚‚ãƒ†ã‚¹ãƒˆã‚’åãå‡ºã—ãŸã„ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¯ï¼Ÿ** | ã»ã¼ç„¡ã—ã§ã™ã€‚`dist` é…ä¸‹ã®ãƒ†ã‚¹ãƒˆã‚’ CI å¾Œæ®µã§å®Ÿè¡Œã™ã‚‹ãªã‚‰ `vitest run --dir dist` ã®ã‚ˆã†ã« â€œå¤‰æ›å¾Œã‚³ãƒ¼ãƒ‰â€ ã«å¯¾ã—ã¦å†å®Ÿè¡Œã™ã‚‹ã€ã¨ã„ã†ç‰¹æ®Šãªã‚±ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã™ãŒã€å¤šãã® Node ã‚µãƒ¼ãƒ“ã‚¹ã§ã¯æ¡ç”¨ä¾‹ãŒç¨€ã§ã™ã€‚|

---

## ã¾ã¨ã‚

1. **å‹ãƒã‚§ãƒƒã‚¯ç”¨ tsconfigï¼ˆnoEmit: trueï¼‰** ã¨ **ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰ tsconfig.build.jsonï¼ˆãƒ†ã‚¹ãƒˆ exclude, noEmit: falseï¼‰** ã‚’åˆ†ã‘ã‚‹ã®ãŒç‹é“ã€‚  
2. ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ä¸»å°ãƒ“ãƒ«ãƒ‰ãªã‚‰ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé™¤å¤–ã«ä»»ã›ã¦ã‚‚è‰¯ã„ãŒã€tsc å‹ç”Ÿæˆ (`--declaration`) ã‚’ä½µç”¨ã™ã‚‹ãªã‚‰ã‚„ã¯ã‚Š exclude ã‚’æ˜ç¤ºã™ã‚‹æ–¹ãŒç¢ºå®Ÿã€‚  
3. ã“ã†ã—ã¦ãŠãã¨ **IDE ã§ã¯ãƒ†ã‚¹ãƒˆè¾¼ã¿ã§å¿«é©ã«é–‹ç™º**ã—ãªãŒã‚‰ã€**æœ¬ç•ª artefact ã¯ãƒ†ã‚¹ãƒˆã‚¼ãƒ­ã§è»½é‡** ã¨ã„ã†ãƒãƒ©ãƒ³ã‚¹ãŒå–ã‚Œã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/11 10:44:17*

1
ä»¥ä¸‹ã¯ã©ã†ã„ã†ã“ã¨ã ã‚ã†ã‹ã€‚
"types": \["node", "vitest"\],   // â† â˜… ãƒ†ã‚¹ãƒˆå‹ã‚’è§£æ±º

2
tsconfig.build.jsonã‚’ä½œã‚‹ã®ã¯ä¸€èˆ¬çš„ã‹?

3
ç¾çŠ¶ã®package.jsonã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¦‹ç›´ã—ã¦ã»ã—ã„

{
  "name": "@myapp/server",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "main": "dist/app.js",
  "types": "dist/app.d.ts",
  "exports": {
    ".": {
      "types": "./dist/app.d.ts",
      "import": "./dist/app.js"
    }
  },
  "files": \[
    "dist"
  \],
  "scripts": {
    "dev": "tsx watch src/app.ts",
    "build": "tsc -p .",
    "start": "node dist/app.js",
    "openapi:generate": "tsx scripts/generate-openapi.ts",
    "openapi:validate": "redocly lint openapi.yaml",
    "typecheck": "tsc -p . --noEmit",
    "lint": "biome check .",
    "lint:check": "biome check .",
    "test": "vitest --run",
    "verify": "pnpm openapi:generate && pnpm lint && pnpm build && pnpm lint:check && pnpm typecheck && pnpm test"
  },
  "dependencies": {
    "@hono/node-server": "1.14.3",
    "@hono/swagger-ui": "0.5.1",
    "@hono/zod-openapi": "0.19.8",
    "@myapp/database": "workspace:\*",
    "@myapp/shared": "workspace:\*",
    "@t3-oss/env-core": "0.13.6",
    "find-up": "7.0.0",
    "hono": "4.7.11",
    "zod-openapi": "4.2.4"
  },
  "devDependencies": {
    "@redocly/cli": "1.34.3",
    "@types/node": "22.15.29",
    "@types/statuses": "2.0.6",
    "dotenv": "16.5.0",
    "statuses": "2.0.2",
    "tsx": "4.19.4",
    "typescript": "5.8.3",
    "yaml": "2.8.0",
    "zod": "3.25.51"
  }
}

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/11 10:44:17*

## 1. `types`: ["node", "vitest"] ã¨ã¯ï¼Ÿ

`compilerOptions.types` ã§ **ã€Œæš—é»™ã«èª­ã¿è¾¼ã‚€å‹å®šç¾©ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã€ã‚’å®£è¨€** ã—ã¦ã„ã¾ã™ã€‚  
ã“ã“ã«åˆ—æŒ™ã•ã‚ŒãŸ package åã¯ `<rootDir>/node_modules/@types/*` ã¾ãŸã¯å‹å®šç¾©å…¥ã‚Šãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦è§£æ±ºã•ã‚Œã€å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã§

```ts
/// <reference types="node" />
/// <reference types="vitest" />
```

ã‚’æ›¸ã„ãŸã®ã¨åŒç­‰ã«ãªã‚Šã¾ã™ã€‚

| æŒ‡å®š | ä½•ãŒå…¥ã‚‹ã‹ | ãªãœå¿…è¦ã‹ |
|------|-----------|-----------|
| **node** | `global`, `process`, `Buffer` ãªã© Node.js ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«å®£è¨€ | ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚„ãƒ†ã‚¹ãƒˆã§ Node API ã‚’ä½¿ã†ã¨ãã«å‹ã‚¨ãƒ©ãƒ¼ã‚’é˜²ã |
| **vitest** | `describe`, `it`, `expect` ãªã© Vitest ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«å®£è¨€ | ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `noEmit: true` ã® IDE å‹ãƒã‚§ãƒƒã‚¯ã«å«ã‚ã¦ã‚‚ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„ |

> ã“ã‚Œã‚’æŒ‡å®šã—ãªã„å ´åˆã€`globalThis.expect` ãªã©ãŒ **å‹ä¸æ˜ (any) ã«ãªã‚‹** ã‹ã€`noImplicitAny` ã§ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

---

## 2. `tsconfig.build.json` ã‚’åˆ†ã‘ã‚‹ã®ã¯ â€œã‹ãªã‚Šä¸€èˆ¬çš„â€ ã‹ï¼Ÿ

ã¯ã„ã€‚**é–‹ç™ºç”¨ (`ts-node` / IDE / Vitest) ã¨æœ¬ç•ªãƒ“ãƒ«ãƒ‰ç”¨ (`tsc --emit`) ã‚’åˆ†é›¢**ã™ã‚‹æ§‹æˆã¯ã€ãƒ¢ãƒãƒ¬ãƒãƒ»ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã„ãšã‚Œã§ã‚‚åºƒãä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚

### æ¡ç”¨ä¾‹

| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ | ãƒ«ãƒ¼ãƒˆ tsconfig | ãƒ“ãƒ«ãƒ‰å°‚ç”¨ | ãƒ¡ãƒ¢ |
|--------------|----------------|------------|------|
| NestJS æ–°è¦ CLI ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ | `tsconfig.json` | `tsconfig.build.json` | æœ¬ç•ªç”¨ã¯ãƒ†ã‚¹ãƒˆé™¤å¤–ãƒ»`noEmit` ç„¡åŠ¹ |
| Vite ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ | `tsconfig.json` | `tsconfig.build.json` | dev ç”¨ã¯ HMR æœ€é©åŒ– & `noEmit:true` |
| Angular (ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰) | `tsconfig.base.json` | `tsconfig.app.json`, `tsconfig.spec.json` | ç”¨é€”ã”ã¨ã« 3 æšä»¥ä¸Š |

**ãƒ¡ãƒªãƒƒãƒˆ**

* ãƒ“ãƒ«ãƒ‰ artefact ã«ãƒ†ã‚¹ãƒˆãŒæ··å…¥ã—ãªã„  
* é–‹ç™ºæ™‚ã¯ IDE ãŒãƒ†ã‚¹ãƒˆè¾¼ã¿ã§å‹ãƒã‚§ãƒƒã‚¯ã§ãã‚‹  
* `isolatedDeclarations` ãªã© strict æ——ã‚’ç¶­æŒã—ãŸã¾ã¾ã€ä¸è¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é™¤å¤–ã§ãã‚‹

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**

* tsconfig ãŒå¢—ãˆã‚‹ã®ã§ CI / npm-scripts ã®å‘¼ã³åˆ†ã‘ãŒå¿…è¦  
* IDE ãŒé–“é•ã£ãŸ tsconfig ã‚’æ‹¾ã†ã¨è£œå®ŒãŒå£Šã‚Œã‚‹ï¼ˆVS Code ã¯ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã§ä½•ã‚’æ—¢å®šã«ã™ã‚‹ã‹è¨­å®šå¯èƒ½ï¼‰

---

## 3. `package.json` ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ”¹å–„æ¡ˆ

```jsonc
{
  "scripts": {
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ é–‹ç™ºç”¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    "dev": "tsx watch src/app.ts",

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ å‹ãƒã‚§ãƒƒã‚¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    "typecheck": "tsc -p tsconfig.json --noEmit",   // â† IDE ã¨åŒã˜ dev è¨­å®šã§

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ æœ¬ç•ªãƒ“ãƒ«ãƒ‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    "build": "tsc -p tsconfig.build.json",          // â† ãƒ†ã‚¹ãƒˆé™¤å¤– & emit ã‚ã‚Š
    "start": "node dist/app.js",

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ ãƒ†ã‚¹ãƒˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    "test": "vitest run",
    "test:watch": "vitest",                         // é–‹ç™ºä¸­ã¯ watch ãŒä¾¿åˆ©

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ Quality Gate â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    "lint": "biome check .",
    "lint:fix": "biome check . --apply",

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ OpenAPI â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    "openapi:generate": "tsx scripts/generate-openapi.ts",
    "openapi:validate": "redocly lint openapi.yaml",

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ ã™ã¹ã¦ä¸€æ‹¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    "verify": "pnpm openapi:generate && pnpm lint && pnpm build && pnpm typecheck && pnpm test"
  }
}
```

### æ”¹å–„ãƒã‚¤ãƒ³ãƒˆ

1. **`build` ã¨ `typecheck` ã‚’æ˜ç¢ºã«åˆ†é›¢**  
   * `build` ã¯ **emit ã‚ã‚Š** ã® `tsconfig.build.json` ã‚’ä½¿ã†  
   * `typecheck` ã¯ **emit ãªã—** ã® dev ç”¨ tsconfig ã‚’ä½¿ã†  
   * ã“ã‚Œã«ã‚ˆã‚Š â€œæœ¬ç•ª artefact ã«ãƒ†ã‚¹ãƒˆã‚„ dev å‹ãŒæ··ã–ã‚‰ãªã„â€ ã‹ã¤ â€œIDE è£œå®ŒãŒåŠ¹ãâ€ ã‚’ä¸¡ç«‹ã€‚

2. **`test:watch` è¿½åŠ **  
   é–‹ç™ºä¸­ã¯ `vitest` å˜ä½“ã§ watch ãƒ¢ãƒ¼ãƒ‰ãŒèµ°ã‚‹ãŸã‚ã€`pnpm test:watch` ã‚’ã‚ˆãä½¿ã†ã‚±ãƒ¼ã‚¹ãŒå¤šã„ã€‚

3. **`lint:fix` ã‚’åˆ†ã‘ã‚‹**  
   ãƒã‚§ãƒƒã‚¯ã¨è‡ªå‹•ä¿®æ­£ã‚’åˆ†é›¢ã—ã¦ãŠãã¨ CI ã¨ãƒ­ãƒ¼ã‚«ãƒ«ã§ä½¿ã„åˆ†ã‘ã‚„ã™ã„ã€‚

4. **`verify` ã®é †åºæœ€é©åŒ–**  
   *å…ˆã« lint â†’ typecheck â†’ test* ã§ã‚‚è‰¯ã„ã§ã™ãŒã€OpenAPI ã®ç”Ÿæˆã¯ãƒ“ãƒ«ãƒ‰ã«ä¾å­˜ã—ãªã„ãªã‚‰æœ€åˆã«ç½®ãã®ãŒå®Ÿè¡Œå›æ•°ã‚’æ¸›ã‚‰ã›ã¾ã™ã€‚  
   ï¼ˆå¤±æ•—ã—ãŸã‚‰ãƒ“ãƒ«ãƒ‰ã¾ã§è¡Œã‹ãªã„ãŸã‚æ™‚çŸ­ï¼‰

---

### ã¾ã¨ã‚

* `types: ["node", "vitest"]` ã¯ **IDE / Vitest ãŒå‚ç…§ã™ã‚‹å‹å®šç¾©ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«æ³¨å…¥**ã™ã‚‹æŒ‡å®šã€‚  
* **`tsconfig.build.json` ã‚’åˆ†ã‘ã‚‹è¨­è¨ˆã¯ä¸€èˆ¬çš„**ã§ã€æœ¬ç•ª artefact ã‹ã‚‰ãƒ†ã‚¹ãƒˆã‚’æ’é™¤ã—ãŸã„å ´åˆã«æœ‰åŠ¹ã€‚  
* ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ **build ã¨ typecheck ã‚’åˆ¥ tsconfig ã«å‘ã‘ã‚‹** ã‚ˆã†ä¿®æ­£ã—ã€`test:watch` ã‚„ `lint:fix` ã‚‚è¶³ã™ã¨æ—¥å¸¸é–‹ç™ºãŒã‚¹ãƒ ãƒ¼ã‚ºã«ãªã‚Šã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/11 11:09:50*

types ã¯ã»ã‹ã«ã©ã‚“ãªã®ãŒã‚ã‚‹ã‹ï¼Ÿ
packages/server/tsconfig.jsonã¨ã‹ã§ã¯åŸºæœ¬çš„ã«"noEmit": true                 // â† â˜… é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚ºã¯å‡ºåŠ›ã—ãªã„ãªã®ã‹ï¼Ÿ
"typecheck": "tsc -p tsconfig.json --noEmit", ã§ã‚‚--noEmitã¨ã™ã‚‹å¿…è¦ã¯ã‚ã‚‹ã®ã‹ï¼Ÿ
base.configã§    // ============================================================
    // ğŸ“Œ  ãƒ‘ã‚¹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ï¼ˆãƒ¢ãƒãƒ¬ãƒä¾‹ï¼‰
    // ============================================================
    "baseUrl": ".",
    "paths": {
      "@myapp/shared": \["./packages/shared/src"\],
      "@myapp/shared/\*": \["./packages/shared/src/\*"\]
    }
  }
ã¨ã—ã¦ã„ã‚‹ãŒã€ä»–ã®è¨˜è¿°ã¯ã„ã‚‰ãªã„ã®ã‹ï¼Ÿã“ã‚ŒãŒã‚ã‚‹ã¨ä½•ãŒé•ã†ã®ã‹ï¼Ÿ

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/11 11:09:51*

### 1. `compilerOptions.types` ã«ã¯ä½•ãŒå…¥ã‚Œã‚‰ã‚Œã‚‹ï¼Ÿ

| ä»£è¡¨ä¾‹ | å½¹å‰² / ã„ã¤ä½¿ã†ã‹ | å‚™è€ƒ |
|-------|-----------------|------|
| **node** | `process`, `Buffer`, ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¿ã‚¤ãƒãƒ¼ ãªã© | ã‚µãƒ¼ãƒãƒ¼ã‚„ãƒ„ãƒ¼ãƒ«ç³»ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å¿…é ˆ |
| **vitest** | `describe`, `it`, `expect` ãªã© | Vitest ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ« API ã§ä½¿ã†æ™‚ |
| **jest** | Jest ã®åŒä¸Šã‚°ãƒ­ãƒ¼ãƒãƒ« | ãƒ¢ãƒãƒ¬ãƒã« Jestï¼Vitest ãŒæ··åœ¨ã™ã‚‹ã¨ãã¯ä¸è¦å´ã‚’å¤–ã™ |
| **bun-types** | Bun ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®ã‚°ãƒ­ãƒ¼ãƒãƒ« | Bun ã§ CLIï¼ã‚µãƒ¼ãƒãƒ¼ã‚’èµ°ã‚‰ã›ã‚‹å ´åˆ |
| **mocha** | `describe`, `it` ãªã© Mocha ã‚°ãƒ­ãƒ¼ãƒãƒ« | Rare ã ãŒãƒ¬ã‚¬ã‚·ãƒ¼ç§»è¡Œé€”ä¸­ã§ä½µç”¨ã™ã‚‹æ™‚ |
| **chai** | `expect`, `assert`, `should` | Mocha + Chai æ§‹æˆãªã© |
| **web`** / **dom** | ãƒ–ãƒ©ã‚¦ã‚¶ API ã®ã‚°ãƒ­ãƒ¼ãƒãƒ« (`window`, `document`) | `"lib": ["DOM"]` ã¨é‡è¤‡ã™ã‚‹ã®ã§é€šå¸¸ä¸è¦ |
| **react** | JSX åå‰ç©ºé–“ (`React`) ã‚’æš—é»™å®šç¾© | React 17 ä»¥å‰ã® â€œè‡ªå‹• import ãªã—â€ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãªã© |
| **aws-lambda** | `Handler`, `APIGatewayProxyEvent` ãªã© | Lambda é–¢æ•°ã‚’å‹å®‰å…¨ã«æ›¸ããŸã„æ™‚ |
| **chrome** | `chrome.tabs` ãªã©æ‹¡å¼µæ©Ÿèƒ½ API | Chrome Extension é–‹ç™ºæ™‚ |

> **ãƒã‚¤ãƒ³ãƒˆ**  
> - **æœ€å°é™ã ã‘**ã‚’åˆ—æŒ™ã™ã‚‹ã¨ãƒ“ãƒ«ãƒ‰ãŒã‚ãšã‹ã«é€Ÿããªã‚Šã€åå‰è¡çªã‚‚èµ·ãã«ãã„ã€‚  
> - è¿·ã£ãŸã‚‰ VS Code ã§å‹ãŒè§£æ±ºã—ãªã„ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚’ âŒ˜+ã‚¯ãƒªãƒƒã‚¯ â†’ *ã€Œå‹å®šç¾©ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€* ã¨å‡ºã‚‹ã‚‚ã®ã ã‘è¿½åŠ ã™ã‚‹ã®ãŒå®‰å…¨ã€‚

---

### 2. `packages/server/tsconfig.json` ã¯åŸºæœ¬ `noEmit: true` ã§è‰¯ã„ï¼Ÿ

- **é–‹ç™ºç”¨ï¼ˆIDE è£œå®Œ / Vitest å®Ÿè¡Œï¼‰ã¨ã—ã¦ä½¿ã†ãªã‚‰ `noEmit: true` ãŒä¸€èˆ¬çš„**  
  - ä¸è¦ãª `*.js` ãŒæ•£ã‚‰ã°ã‚‰ãšã€ã‚¦ã‚©ãƒƒãƒå†ãƒ“ãƒ«ãƒ‰ã‚‚é«˜é€Ÿã€‚  
- **æœ¬ç•ªãƒ“ãƒ«ãƒ‰ç”¨** ã¯åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆä¾‹ `tsconfig.build.json`ï¼‰ã§ `noEmit: false` ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã€ã¨ã„ã† 2 æšæ§‹æˆãŒã‚ˆãæ¡ã‚‰ã‚Œã¾ã™ã€‚

> ã‚‚ã—ã€Œå°è¦æ¨¡ã ã— 1 æšã§æ¸ˆã¾ã›ãŸã„ã€å ´åˆã¯  
> - `noEmit: false` ã‚’ tsconfig ã«æ›¸ã„ã¦ãŠãã€  
> - **é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚ºã®ã¿** `ts-node`, `tsx`, `vite` ãªã© **ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ©å´ã§ãƒ¡ãƒ¢ãƒªå¤‰æ›**  
> ã§ã‚‚é‹ç”¨ã§ãã¾ã™ã€‚ãƒ†ã‚¹ãƒˆè¾¼ã¿ã®å‹ãƒã‚§ãƒƒã‚¯ã‚’ IDE ã«ä»»ã›ã‚‰ã‚Œã‚‹ãªã‚‰ãƒ“ãƒ«ãƒ‰é…å»¶ã¯è¨±å®¹ç¯„å›²ã§ã™ã€‚

---

### 3. `typecheck` ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ `--noEmit` ã¯å†—é•·ï¼Ÿ

- tsconfig.json ã§ã™ã§ã« `"noEmit": true` ãªã‚‰ **CLI ã® `--noEmit` ã¯å†—é•·**ã€‚  
- ãŸã ã— **æ˜ç¤ºçš„ã«ä¸Šæ›¸ã**ã—ãŸã„å ´åˆï¼ˆå°†æ¥ tsconfig å´ã‚’å¤‰æ›´ã—ã¦ã‚‚ CI ã¯å¤‰ãˆãŸããªã„ç­‰ï¼‰ã¯æ®‹ã—ã¦ãŠã„ã¦ã‚‚å®³ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

**çµè«–**: ã“ã ã‚ã‚ŠãŒãªã‘ã‚Œã°å¤–ã—ã¦ã‚·ãƒ³ãƒ—ãƒ«ã«ã—ã¦ OKã€‚

```jsonc
"typecheck": "tsc -p tsconfig.json"
```

---

### 4. `baseUrl` & `paths` ã§ä½•ãŒå¤‰ã‚ã‚‹ï¼Ÿ

#### 4-1. ä½•ãŒå¬‰ã—ã„ï¼Ÿ

```ts
// å¾“æ¥
import { foo } from "../../../shared/src/foo.ts";

// paths ãŒã‚ã‚‹ã¨
import { foo } from "@myapp/shared/foo";
```

* **ç›¸å¯¾ãƒ‘ã‚¹ã®ã€Œ../ åœ°ç„ã€** ã‚’è§£æ¶ˆ  
* **VS Code ã®ãƒªãƒãƒ¼ãƒ ãƒ»ç§»å‹•ãŒå£Šã‚Œã«ãã„**ï¼ˆãƒ‘ã‚¹å†è§£æ±ºãŒæ¥½ï¼‰  
* ãƒ¢ãƒãƒ¬ãƒå„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸é–“ã§ **å‹ã‚‚å®Ÿè£…ã‚‚ 1 è¡Œã§å‚ç…§**ã§ãã‚‹

#### 4-2. ãƒ©ãƒ³ã‚¿ã‚¤ãƒ å´ã®è¨­å®šã‚‚å¿˜ã‚Œãšã«

| ãƒ„ãƒ¼ãƒ« | è¿½åŠ è¨­å®š |
|--------|----------|
| **ts-node / tsx / vitest** | ã»ã¼è‡ªå‹•ã§ tsconfig ã® paths ã‚’è§£æ±ºï¼ˆæœ€è¿‘ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§å¯¾å¿œæ¸ˆã¿ï¼‰ |
| **esbuild / tsup / bun build** | `tsconfig` èª­ã¿è¾¼ã¿ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹åŒ– or `external` ã«ç½®ãæ›ãˆ |
| **Node ç›´å®Ÿè¡Œ (import "@myapp/shared")** | `package.json#exports` ã¾ãŸã¯ `NODE_PATH`, `module-alias` ãŒå¿…è¦ |

> **ãƒ“ãƒ«ãƒ‰å¾Œã® JS** ã«ã‚‚åŒã˜ alias ã‚’æ®‹ã™ãªã‚‰ **bundler å´ã§ `path alias â†’ å®Ÿãƒ•ã‚¡ã‚¤ãƒ«` ã«æ›¸ãæ›ãˆã‚‹**ã‚ˆã†å¿…ãšè¨­å®šã—ã¦ãã ã•ã„ã€‚è¨­å®šæ¼ã‚Œã¯ â€œCannot find module '@myapp/shared'â€ ã‚¨ãƒ©ãƒ¼ã®å…ƒã§ã™ã€‚

#### 4-3. ä»–ã«å…¥ã‚Œã‚‹ã¹ãé …ç›®ã¯ï¼Ÿ

- **è¿½åŠ ã® workspace** ãŒã‚ã‚Œã°éƒ½åº¦ä¼¸ã°ã™  
  ```jsonc
  "@myapp/database": ["./packages/database/src"]
  ```
- **`paths` ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã®ã¿ä½œç”¨** â†’ ãƒ©ãƒ³ã‚¿ã‚¤ãƒ /Bundler ãŒåˆ¥ãªã‚‰ä¸Šè¨˜ã®å¯¾å¿œãŒå¿…è¦  
- **`baseUrl` ã‚’ `"."` ã«ã—ã¦ã„ã‚‹ãªã‚‰ `"paths"` ãªã—ã§ã‚‚çµ¶å¯¾ãƒ‘ã‚¹ import (`from "src/foo"`) ãŒé€šã‚‹**ãŒã€ãƒ¢ãƒãƒ¬ãƒæ¨ªæ–­ã¯å‡ºæ¥ãªããªã‚‹

---

## ã¾ã¨ã‚

| è³ªå• | ç«¯çš„ãªç­”ãˆ |
|------|-----------|
| **types ã«ã¯ä½•ãŒã‚ã‚‹ï¼Ÿ** | Nodeã€Vitestã€Jestã€Bunã€Reactã€Lambdaâ€¦ ãªã©ã€ã‚°ãƒ­ãƒ¼ãƒãƒ« API ã‚’æ³¨å…¥ã—ãŸã„ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ï¼ãƒ†ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ã®å‹å®šç¾©ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã‚’åˆ—æŒ™ã™ã‚‹ã€‚ |
| **server/tsconfig.json ã¯ noEmit: true ã§ã‚ˆã„ï¼Ÿ** | é–‹ç™ºå°‚ç”¨ãªã‚‰ trueã€æœ¬ç•ªãƒ“ãƒ«ãƒ‰ã¯åˆ¥ tsconfig ã§ false ã«ã™ã‚‹ 2 æšæ§‹æˆãŒç‹é“ã€‚ |
| **typecheck ã‚¹ã‚¯ãƒªãƒ—ãƒˆã® --noEmit ã¯å¿…è¦ï¼Ÿ** | tsconfig ã« noEmit ãŒã‚ã‚‹ãªã‚‰å†—é•·ã€‚å‰Šã£ã¦ã‚‚ OKï¼ˆæ®‹ã—ã¦ã‚‚å®³ã¯ãªã„ï¼‰ã€‚ |
| **baseUrl & paths ã®åŠ¹æœã¨è¿½åŠ è¨­å®šã¯ï¼Ÿ** | ç›¸å¯¾ãƒ‘ã‚¹ã‚’å‰Šæ¸›ã—ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹æ¨ªæ–­ import ã‚’å®Ÿç¾ã™ã‚‹ã€‚<br>ãŸã ã—ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ï¼ãƒãƒ³ãƒ‰ãƒ©å´ã«ã‚‚åŒã˜ alias ã‚’æ•™ãˆã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ |

ã“ã‚Œã§ç–‘å•ç‚¹ã¯ã‚¯ãƒªã‚¢ã«ãªã‚‹ã¯ãšã§ã™ã€‚ã•ã‚‰ãªã‚‹è©³ç´°ã‚„ãƒ„ãƒ¼ãƒ«ã”ã¨ã®å…·ä½“çš„è¨­å®šãŒå¿…è¦ãªã‚‰æ°—è»½ã«ã©ã†ãï¼

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/11 11:29:47*

ãŸã¨ãˆã°ã€ãƒ¢ãƒãƒ¬ãƒã‚’æ’®ã£ã¦ã„ã¦ã€"references": \[{ "path": "../shared" }\] ã®ã‚ˆã†ã«å‚ç…§å…ˆã¯ãƒ“ãƒ«ãƒ‰ã—ãªã„ã¨ã„ã‘ãªã„å ´åˆã¯ã©ã†ã™ã‚Œã°ã„ã„ã®ã‹ï¼Ÿ

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/11 11:29:48*

ä»¥ä¸‹ã§ã¯ **ã€Œ`packages/server` ãŒ `packages/shared` ã‚’å‚ç…§ (`references`) ã—ã¦ã„ã‚‹ã¨ãã«ã€shared å´ã‚’ã©ã†ãƒ“ãƒ«ãƒ‰ã•ã›ã‚‹ã‹ã€** ã‚’ 3 ãƒ‘ã‚¿ãƒ¼ãƒ³ã§æ•´ç†ã—ã¾ã™ã€‚çµè«–ã ã‘æ¬²ã—ã„æ–¹ã¯ **â–  ã¾ã¨ã‚** ã¸ã©ã†ãã€‚

---

## 0. å‰æï¼šProject References ã®å‹•ã

| ã‚³ãƒãƒ³ãƒ‰ | èµ·ã“ã‚‹ã“ã¨ |
|----------|-----------|
| `tsc` | **å˜ç™º** ãƒ“ãƒ«ãƒ‰ã€‚`references` å…ˆã¯ã€Œ.d.ts ç­‰ãŒ *æ—¢ã«å­˜åœ¨* ã—ã¦ã„ã‚‹ã€å‰æã§ *ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ãªã„*ã€‚ |
| `tsc -b` ã¾ãŸã¯ `tsc --build` | **ãƒ“ãƒ«ãƒ‰ãƒ¢ãƒ¼ãƒ‰**ã€‚ä¾å­˜ã‚°ãƒ©ãƒ•ã‚’è§£æã—ã€`references` å…ˆãŒ **å¤ã„ï¼æœªãƒ“ãƒ«ãƒ‰** ãªã‚‰è‡ªå‹•ã§é †æ¬¡ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã€‚ |

> ã¤ã¾ã‚Š **shared ã‚’è‡ªå‹•ãƒ“ãƒ«ãƒ‰ã—ãŸã„ãªã‚‰ `-b` ãƒ¢ãƒ¼ãƒ‰ã§å‘¼ã¶** ã®ãŒ TypeScript æœ¬æ¥ã®æƒ³å®šã§ã™ã€‚

---

## 1. ãƒ«ãƒ¼ãƒˆã§ä¸€æ‹¬ `tsc -b`

### æ§‹æˆä¾‹

```text
tsconfig.base.json          # å…±é€šè¨­å®š
tsconfig.build.json         # ãƒ«ãƒ¼ãƒˆãƒ“ãƒ«ãƒ‰ç”¨ (â˜…)
packages/
  shared/
    tsconfig.build.json
  server/
    tsconfig.build.json
```

*å„ tsconfig.build.json ã«ã¯ `composite: true`, `outDir`, `references` ã‚’è¨˜è¿°*

#### ãƒ«ãƒ¼ãƒˆã® `tsconfig.build.json`

```jsonc
{
  "files": [],        // ãƒ«ãƒ¼ãƒˆè‡ªä½“ã¯ã‚½ãƒ¼ã‚¹ã‚’æŒãŸãªã„
  "references": [
    { "path": "packages/shared" },
    { "path": "packages/server" }
  ]
}
```

#### ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```jsonc
"scripts": {
  "build": "tsc -b tsconfig.build.json",
  "clean": "tsc -b tsconfig.build.json --clean"
}
```

- `tsc -b` ãŒ **shared â†’ server ã®é †ã§è‡ªå‹•ãƒ“ãƒ«ãƒ‰**ã€‚  
- å¢—åˆ†ãƒ“ãƒ«ãƒ‰ (`incremental`) ãŒåŠ¹ãã®ã§ 2 å›ç›®ä»¥é™ã¯å·®åˆ†ã ã‘ã€‚

---

## 2. ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å˜ä½ã§ `tsc -b` â†’ ãƒ«ãƒ¼ãƒˆã‹ã‚‰ *å®Ÿè¡Œé †* ã‚’åˆ¶å¾¡

ãƒ¢ãƒãƒ¬ãƒç®¡ç†ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã‚ãªã„è»½é‡ãƒ‘ã‚¿ãƒ¼ãƒ³ã€‚

```jsonc
// packages/shared/package.json
"scripts": { "build": "tsc -b tsconfig.build.json" }

// packages/server/package.json
"scripts": { "build": "tsc -b tsconfig.build.json" }

// ãƒ«ãƒ¼ãƒˆ package.json
"scripts": {
  "build": "pnpm --filter \"@myapp/shared\" build && pnpm --filter \"@myapp/server\" build"
}
```

- **shared â†’ server** ã®é †åºã‚’æ˜ç¤ºã€‚  
- ä¾å­˜ãŒå¢—ãˆãŸã‚‰é †åºãƒ¡ãƒ³ãƒ†ãŒå¤§å¤‰ â†’ ãƒ„ãƒ¼ãƒ«ã¸ç§»è¡Œã™ã‚‹ã®ãŒæ™®é€šã€‚

---

## 3. Turborepo / Nx / Lage ãªã© *ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼* ã§ä¾å­˜è§£æ±º

ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼ãŒ **`package.json#dependencies`** ã‚’è¦‹ã¦è‡ªå‹•ã‚½ãƒ¼ãƒˆ & ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€‚

```jsonc
// turborepo ç”¨ pipeline è¨­å®šä¾‹ (turbo.json)
{
  "pipeline": {
    "build": {
      "dependsOn": ["^build"],     // ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã® build ã‚’å…ˆã«
      "outputs": ["dist/**"]
    }
  }
}
```

```bash
pnpm turbo run build --filter @myapp/server
```

- Turbo/Nx ãŒ **shared â†’ server** ã‚’åˆ¤æ–­ã—ã¦ä¸¦åˆ—ãƒ“ãƒ«ãƒ‰ã€‚  
- å¢—åˆ†ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚„ãƒªãƒ¢ãƒ¼ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚‚ç°¡å˜ã«è¿½åŠ å¯èƒ½ã€‚

---

## 4. ã‚ˆãã‚ã‚‹è³ªå•

| Q | A |
|---|---|
| **`references` ã«ã¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ tsconfig ã©ã£ã¡ã‚’æ›¸ãï¼Ÿ** | **ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**æ¨å¥¨ã€‚TypeScript ãŒè‡ªå‹•ã§ `<dir>/tsconfig.json` or `tsconfig.build.json` ã‚’æ¢ã—ã¾ã™ã€‚ |
| **`isolatedDeclarations` ã§ shared å´ã® d.ts ãŒç„¡ã„ã¨ã‚¨ãƒ©ãƒ¼ï¼Ÿ** | `tsc -b` ã¯ *ã¾ãš shared ã‚’ãƒ“ãƒ«ãƒ‰ â†’ ç”Ÿæˆã•ã‚ŒãŸ d.ts ã‚’ server ãŒå‚ç…§* ã™ã‚‹ã®ã§å•é¡Œãªã—ã€‚å˜ç™º `tsc` ã ã¨ç™ºç”Ÿã—ã¾ã™ã€‚ |
| **Bun / tsup ãªã©ãƒãƒ³ãƒ‰ãƒ©æ™‚ã¯ï¼Ÿ** | å¤šãã®ãƒãƒ³ãƒ‰ãƒ©ã¯ `.ts` ã‚’ç›´æ¥é£Ÿã¹ã‚‰ã‚Œã‚‹ãŸã‚ã€Œå…ˆãƒ“ãƒ«ãƒ‰å¿…é ˆã€ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãŸã ã— **å‹å…±æœ‰ (.d.ts) ã‚’å…¬é–‹ã—ãŸã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**ãªã‚‰ references + `tsc -b` ãŒæœ€ã‚‚ç°¡å˜ã§ã™ã€‚ |

---

## â–  ã¾ã¨ã‚ï¼ˆå®Ÿè·µçš„æ‰‹é †ï¼‰

1. **å„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã® tsconfig.build.json ã« `composite: true` ã‚’è¨­å®š**  
   *`rootDir`, `outDir`, `declaration` ã‚‚å¿˜ã‚Œãšã«ã€‚*

2. **ãƒ«ãƒ¼ãƒˆã«ã€Œç©ºã®ãƒ“ãƒ«ãƒ‰ç”¨ tsconfigã€ã‚’ç½®ãã€references ã§ãƒ“ãƒ«ãƒ‰é †ã‚’å®£è¨€**  
   ```jsonc
   {
     "files": [],
     "references": [
       { "path": "packages/shared" },
       { "path": "packages/server" }
     ]
   }
   ```

3. **CI / npm-scripts ã¯ `tsc -b tsconfig.build.json` ã‚’å‘¼ã¶ã ã‘**  
   ```jsonc
   "build": "tsc -b tsconfig.build.json",
   "clean": "tsc -b tsconfig.build.json --clean"
   ```

> ã“ã‚Œã§ **shared ãŒã¾ã ãƒ“ãƒ«ãƒ‰ã•ã‚Œã¦ã„ãªãã¦ã‚‚ `tsc -b` ãŒè‡ªå‹•ã§å…ˆã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«** ã—ã¦ãã‚Œã‚‹ãŸã‚ã€  
> *ã€Œå‚ç…§å…ˆã‚’ãƒ“ãƒ«ãƒ‰ã—å¿˜ã‚Œã¦ runtime ãŒå£Šã‚Œã‚‹ã€* äº‹æ•…ã‚’é˜²ã’ã¾ã™ã€‚

---

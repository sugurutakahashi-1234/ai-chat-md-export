# SwiftUI でトースト実装

日付: 2024-07-03

---

## 👤 ユーザー
*2024/7/3 14:29:19*

画面遷移しても消えないトーストを SwiftUI で実装したい

---

## 🤖 アシスタント
*2024/7/3 14:29:43*

SwiftUI で画面遷移しても消えないトーストを実装するには、トーストの表示状態をグローバルに管理し、各画面でそれを参照する必要があります。以下はその実装例です。

まず、トーストの表示状態を管理する `ToastManager` クラスを作成します。

```swift
import SwiftUI

class ToastManager: ObservableObject {
    @Published var isShowing: Bool = false
    @Published var message: String = ""
    
    func showToast(message: String) {
        self.message = message
        self.isShowing = true
    }
    
    func hideToast() {
        self.isShowing = false
    }
}
```

次に、トーストビューを作成します。

```swift
import SwiftUI

struct ToastView: View {
    @ObservedObject var toastManager: ToastManager
    
    var body: some View {
        if toastManager.isShowing {
            VStack {
                Spacer()
                Text(toastManager.message)
                    .padding()
                    .background(Color.black.opacity(0.8))
                    .foregroundColor(.white)
                    .cornerRadius(8)
                    .padding()
            }
            .animation(.easeInOut)
            .transition(.move(edge: .bottom))
            .onTapGesture {
                toastManager.hideToast()
            }
        }
    }
}
```

そして、各画面で `ToastManager` を使ってトーストを表示するためのビューを作成します。

```swift
import SwiftUI

struct ContentView: View {
    @StateObject var toastManager = ToastManager()
    
    var body: some View {
        NavigationView {
            VStack {
                NavigationLink(destination: SecondView(toastManager: toastManager)) {
                    Text("Go to Second View")
                }
                Button(action: {
                    toastManager.showToast(message: "Hello, this is a toast message!")
                }) {
                    Text("Show Toast")
                }
            }
            .overlay(
                ToastView(toastManager: toastManager)
            )
        }
    }
}

struct SecondView: View {
    @ObservedObject var toastManager: ToastManager
    
    var body: some View {
        VStack {
            Text("This is the second view.")
            Button(action: {
                toastManager.showToast(message: "Hello from the second view!")
            }) {
                Text("Show Toast")
            }
        }
        .overlay(
            ToastView(toastManager: toastManager)
        )
    }
}

@main
struct MyApp: App {
    var body: some Scene {
        WindowGroup {
            ContentView()
        }
    }
}
```

この実装では、`ToastManager` をグローバルな状態として管理し、どの画面でもトーストを表示できるようにしています。画面遷移してもトーストは消えず、`ToastManager` によって管理されたメッセージが表示され続けます。トーストをタップすることで非表示にすることもできます。

このアプローチにより、アプリ全体で一貫してトーストを管理し、ユーザーに重要なメッセージを見逃させないようにすることができます。

---

## 👤 ユーザー
*2024/7/3 14:30:13*

これだとトーストViewにかぶっている範囲のタップなどができなくならないの？

---

## 🤖 アシスタント
*2024/7/3 14:30:40*

確かに、上記の実装だとトーストが表示されている間は、そのトーストに覆われている範囲がタップできなくなります。これを解決するためには、トーストビューが画面全体を覆うのではなく、トースト自体を必要な場所に表示し、背景部分を透過させる必要があります。

以下は、トースト表示中でも背後のコンテンツを操作できるようにする改善された実装例です。

```swift
import SwiftUI

class ToastManager: ObservableObject {
    @Published var isShowing: Bool = false
    @Published var message: String = ""
    
    func showToast(message: String) {
        self.message = message
        self.isShowing = true
    }
    
    func hideToast() {
        self.isShowing = false
    }
}

struct ToastView: View {
    @ObservedObject var toastManager: ToastManager
    
    var body: some View {
        GeometryReader { geometry in
            if toastManager.isShowing {
                VStack {
                    Spacer()
                    Text(toastManager.message)
                        .padding()
                        .background(Color.black.opacity(0.8))
                        .foregroundColor(.white)
                        .cornerRadius(8)
                        .padding(.bottom, geometry.safeAreaInsets.bottom + 20)
                }
                .frame(width: geometry.size.width)
                .animation(.easeInOut)
                .transition(.move(edge: .bottom))
                .zIndex(1)  // Ensure toast is on top
            }
        }
        .background(Color.clear)  // Make sure background is transparent
        .allowsHitTesting(false)  // Allow taps to pass through
    }
}

struct ContentView: View {
    @StateObject var toastManager = ToastManager()
    
    var body: some View {
        NavigationView {
            ZStack {
                VStack {
                    NavigationLink(destination: SecondView(toastManager: toastManager)) {
                        Text("Go to Second View")
                    }
                    Button(action: {
                        toastManager.showToast(message: "Hello, this is a toast message!")
                    }) {
                        Text("Show Toast")
                    }
                }
                .zIndex(0)
                
                ToastView(toastManager: toastManager)
            }
        }
    }
}

struct SecondView: View {
    @ObservedObject var toastManager: ToastManager
    
    var body: some View {
        ZStack {
            VStack {
                Text("This is the second view.")
                Button(action: {
                    toastManager.showToast(message: "Hello from the second view!")
                }) {
                    Text("Show Toast")
                }
            }
            .zIndex(0)
            
            ToastView(toastManager: toastManager)
        }
    }
}

@main
struct MyApp: App {
    var body: some Scene {
        WindowGroup {
            ContentView()
        }
    }
}
```

この改善では、`ToastView` の `background` を `Color.clear` にし、`allowsHitTesting(false)` を追加することで、トーストが表示されている間でも背後のコンテンツがタップできるようにしています。また、`zIndex` を設定することで、トーストが常に他のコンテンツの上に表示されるようにしています。

これにより、トースト表示中でも背後のボタンやリンクなどのインタラクティブな要素を操作できるようになります。

---

# 実機でローカルAPI接続

日付: 2024-12-20

---

## 👤 ユーザー
*2024/12/20 12:22:52*

Flutter iOS 実機 ローカルホスト API 接続方法

---

## 🤖 アシスタント
*2024/12/20 12:23:24*

FlutterでiOS実機を使用してローカルホストAPIに接続する方法を以下に示します。

---

### 1. **ローカルホストのIPアドレスを確認**
iOS実機では、`localhost` (`127.0.0.1`) はデバイス自体を指します。そのため、実機から開発マシンのローカルサーバーに接続するには、開発マシンのローカルネットワークIPアドレスを使用する必要があります。

#### 手順
1. 開発マシンのIPアドレスを確認します。
   - **macOSの場合**：ターミナルで以下を実行:
     ```bash
     ifconfig
     ```
     または、システム環境設定 → ネットワークから確認できます。

   - 通常、Wi-Fiで接続している場合は、`192.168.x.x` 形式のIPアドレスが表示されます。

---

### 2. **FlutterアプリのAPI URLを変更**
API URLを以下のように変更します。

```dart
const String baseUrl = 'http://<your-local-ip>:<port>';
```

例：
- 開発マシンのIPアドレスが `192.168.0.100`、サーバーポートが `8080` の場合：
  ```dart
  const String baseUrl = 'http://192.168.0.100:8080';
  ```

---

### 3. **iOSアプリのネットワーク設定を変更**
iOSアプリがローカルネットワークに接続するには、適切な権限を設定する必要があります。

#### 手順
1. **Info.plist** ファイルに以下を追加：
   ```xml
   <key>NSAppTransportSecurity</key>
   <dict>
       <key>NSAllowsArbitraryLoads</key>
       <true/>
       <key>NSExceptionDomains</key>
       <dict>
           <key>192.168.0.100</key>
           <dict>
               <key>NSIncludesSubdomains</key>
               <true/>
               <key>NSTemporaryExceptionAllowsInsecureHTTPLoads</key>
               <true/>
               <key>NSTemporaryExceptionMinimumTLSVersion</key>
               <string>TLSv1.1</string>
           </dict>
       </dict>
   </dict>
   ```

2. **ローカルネットワーク権限を有効化**（iOS 14以降）：
   以下を `Info.plist` に追加します。
   ```xml
   <key>NSLocalNetworkUsageDescription</key>
   <string>ローカルネットワーク接続を使用します。</string>
   ```

---

### 4. **ローカルサーバーの設定を確認**
ローカルサーバーが実機からのリクエストを受け付けられるように設定します。

#### 手順
- サーバーが開発マシンのローカルネットワークIPアドレスとポートでリクエストを受け付けるように構成されていることを確認してください。
- 開発マシンでファイアウォールが有効になっている場合は、ポートを開放してください。

---

### 5. **デバイスと開発マシンが同じネットワークに接続されていることを確認**
iOS実機と開発マシンが同じWi-Fiネットワークに接続されている必要があります。

---

### 6. **実機でテスト**
Flutterでアプリを実機にデプロイして、APIエンドポイントに接続できることを確認します。

---

### 注意点
- **HTTPSを推奨**：本番環境ではHTTPSを使用する必要があります。ローカルでの開発時にHTTPを使用している場合は、前述の方法でセキュリティ例外を設定してください。
- **VPNやProxyの影響**：VPNやプロキシを使用している場合、接続がブロックされる可能性があるため、無効化してテストしてください。

---

これで、iOS実機からローカルホストAPIに接続できるようになります！

---

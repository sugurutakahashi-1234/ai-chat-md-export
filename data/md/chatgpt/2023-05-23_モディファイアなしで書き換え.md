# モディファイアなしで書き換え

Date: 2023-05-23

---

## 👤 User
*2023-05-24 02:11:38*

このコードをモディファイアを使わないように書き換えて欲しい

```swift
struct DeviceRotationViewModifier: ViewModifier {
    let action: (UIDeviceOrientation) -> Void

    func body(content: Content) -> some View {
        content
            .onAppear()
            .onReceive(NotificationCenter.default.publisher(for: UIDevice.orientationDidChangeNotification)) { _ in
                action(UIDevice.current.orientation)
            }
    }
}

// A View wrapper to make the modifier easier to use
public extension View {
    func onRotate(perform action: @escaping (UIDeviceOrientation) -> Void) -> some View {
        self.modifier(DeviceRotationViewModifier(action: action))
    }
}


```

---

## 🤖 Assistant
*2023-05-24 02:13:20*

ViewModifierを使わずに、似たような機能を実現するには、直接Viewのbodyにロジックを書き込むことになります。以下にその例を示します：

```swift
struct DeviceRotationView: View {
    let action: (UIDeviceOrientation) -> Void

    var body: some View {
        AnyView(EmptyView()) // 元のコンテンツを描画しない代わりにEmptyViewを使用
            .onAppear()
            .onReceive(NotificationCenter.default.publisher(for: UIDevice.orientationDidChangeNotification)) { _ in
                action(UIDevice.current.orientation)
            }
    }
}

// 利用例
struct ContentView: View {
    var body: some View {
        DeviceRotationView { orientation in
            print("Orientation changed to \(orientation)")
        }
    }
}
```

このコードでは、`DeviceRotationView`は`ViewModifier`を使用せずに、特定のアクションをデバイスの向きが変わったときに実行する`View`を提供します。しかし、もともとのコードのように任意の`View`に修飾子を追加することはできません。そのため、`ContentView`などの親ビューで明示的に`DeviceRotationView`を使用する必要があります。このアプローチでは、元のコンテンツの描画が行われないため、これを描画したい場合はさらなる工夫が必要です。

なお、SwiftUIのビューモディファイアは再利用可能なビューのカスタマイズを可能にする強力なツールであり、一般的にはそれを避ける理由は少ないです。

---

## 👤 User
*2023-05-24 02:13:35*

AnyView は使わないで欲しい

---

## 🤖 Assistant
*2023-05-24 02:14:06*

`AnyView`を使わない方法としては、ビューのボディ内で`GeometryReader`を使用してデバイスの向きを決定し、それに基づいてアクションを実行することが可能です。以下にその例を示します。

```swift
struct DeviceRotationView: View {
    let action: (UIDeviceOrientation) -> Void
    
    var body: some View {
        GeometryReader { geometry in
            let isLandscape = geometry.size.width > geometry.size.height
            let orientation: UIDeviceOrientation = isLandscape ? .landscapeLeft : .portrait
            EmptyView().onAppear {
                action(orientation)
            }
        }
    }
}

// 利用例
struct ContentView: View {
    var body: some View {
        DeviceRotationView { orientation in
            print("Orientation changed to \(orientation)")
        }
    }
}
```

この方法では、`GeometryReader`を使用してビューの幅と高さを取得し、それを基にデバイスがポートレートモードかランドスケープモードかを判断します。そして、その情報を基にアクションを実行します。ただし、この方法では元のコードのように実際のデバイスの向きを取得するのではなく、ビューのサイズに基づいて向きを推定しています。したがって、実際のデバイスの向きとビューの向きが一致しない場合があることに注意してください。

---

# リポジトリへのアクセスをバックグラウンドで行う

日付: 2023-05-29

---

## 👤 ユーザー
*2023/05/30 04:41:03*

class に @MainActor をつけてrepositoryのアクセスをメインスレッドとは別で行って欲しい

```swift
final class UserAttributesListPresenter: ObservableObject {
    @MainActor @Published private(set) var inputtedUserAttributes = InputtedUserAttributes()
    @MainActor @Published var isShowingEdit: Bool = false
    // TODO: エラーハンドリング
    @MainActor @Published var isShowingAlert: Bool = false

    private let repository: UserAttributesRepositoryProtocol

    // Mockから差し替える
    init(repository: UserAttributesRepositoryProtocol = UserAttributesRepositoryProtocolMock()) {
        self.repository = repository
    }

    func onAppear() async {
        do {
            let fetchedInputtedUserAttributes = try await repository.fetchInputtedUserAttributes()

            Task { @MainActor in
                inputtedUserAttributes = fetchedInputtedUserAttributes
            }

        } catch {
            await MainActor.run {
                isShowingAlert = true
            }
        }
    }

    func editButtonTapped() async {
        await MainActor.run {
            isShowingEdit = true
        }
    }
}

```

---

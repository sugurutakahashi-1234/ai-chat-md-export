# アクセストークン保存方法

Date: 2025-01-12

---

## 👤 User
*2025-01-12 20:49:38*

Flutterでflutter_secure_storageを使ってaccessトークンを保存したい。

---

## 🔧 Tool
*2025-01-12 20:49:45*

標準的な手法を模索中

---

## 🤖 Assistant
*2025-01-12 20:49:45*

`flutter_secure_storage` を利用すると、デバイス上に安全にアクセストークンなどの秘密情報を保存できます。以下はその手順とサンプルコードです。

---

### 1. パッケージのインストール

まず、プロジェクトの `pubspec.yaml` に `flutter_secure_storage` を追加します。バージョンは最新のものを確認してください。

```yaml
dependencies:
  flutter:
    sdk: flutter
  flutter_secure_storage: ^8.0.0  # ※ 最新版に更新してください
```

インストール後、以下のコマンドを実行します。

```bash
flutter pub get
```

---

### 2. アクセストークンの保存と取得

以下は、アクセストークンを保存、読み込み、削除する基本的な例です。

```dart
import 'package:flutter/material.dart';
import 'package:flutter_secure_storage/flutter_secure_storage.dart';

void main() {
  runApp(MyApp());
}

class MyApp extends StatelessWidget {
  // FlutterSecureStorage のインスタンスを作成
  final _storage = const FlutterSecureStorage();

  // アクセストークンを保存するメソッド
  Future<void> _saveAccessToken(String token) async {
    await _storage.write(key: 'access_token', value: token);
  }

  // アクセストークンを読み込むメソッド
  Future<String?> _readAccessToken() async {
    return await _storage.read(key: 'access_token');
  }

  // アクセストークンを削除するメソッド
  Future<void> _deleteAccessToken() async {
    await _storage.delete(key: 'access_token');
  }

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Flutter Secure Storage Demo',
      home: Scaffold(
        appBar: AppBar(
          title: const Text('Secure Storage Sample'),
        ),
        body: Center(
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              ElevatedButton(
                child: const Text('アクセストークン保存'),
                onPressed: () async {
                  const token = "your_access_token_here";
                  await _saveAccessToken(token);
                  ScaffoldMessenger.of(context).showSnackBar(
                    const SnackBar(content: Text('トークンを保存しました')),
                  );
                },
              ),
              ElevatedButton(
                child: const Text('アクセストークン取得'),
                onPressed: () async {
                  String? token = await _readAccessToken();
                  ScaffoldMessenger.of(context).showSnackBar(
                    SnackBar(content: Text('取得したトークン: $token')),
                  );
                },
              ),
              ElevatedButton(
                child: const Text('アクセストークン削除'),
                onPressed: () async {
                  await _deleteAccessToken();
                  ScaffoldMessenger.of(context).showSnackBar(
                    const SnackBar(content: Text('トークンを削除しました')),
                  );
                },
              ),
            ],
          ),
        ),
      ),
    );
  }
}
```

---

### 3. 補足

- **非同期処理**: `read`, `write`, `delete` は非同期関数なので、`await` を使って呼び出します。
- **セキュリティ**: `flutter_secure_storage` はプラットフォームに応じた適切なセキュリティ手法（例: iOS の Keychain、Android の EncryptedSharedPreferences）を利用してデータを暗号化します。
- **注意点**:  
  - アプリのライフサイクルやユーザークレデンシャルの保存方法に十分注意しましょう。  
  - デバッグ時にデータが存在するかどうか確認する場合は、該当するプラットフォームの開発者向けツールを活用してください。

---

これで、`flutter_secure_storage` を使用してアクセストークンを安全に保存し、必要に応じて取得や削除が可能になります。必要に応じて、自分のアプリケーションの構造に合わせてコードを整理してください。

---

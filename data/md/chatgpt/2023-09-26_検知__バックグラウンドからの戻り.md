# 検知: バックグラウンドからの戻り

日付: 2023-09-26

---

## 👤 ユーザー
*2023/9/26 23:46:31*

SwiftUIで左上のアプリ名をタップして、別アプリから戻ってきたことを検知する

---

## 🤖 アシスタント
*2023/9/26 23:48:31*

SwiftUIでアプリがバックグラウンドから再びアクティブになったことを検出するには、`@Environment(\.scenePhase)` プロパティ ラッパーを使用できます。`scenePhase`環境変数を使用すると、アプリのライフサイクルの変更を検出できます。

こちらが一例です。

```swift
import SwiftUI

struct ContentView: View {
    @Environment(\.scenePhase) var scenePhase
    
    var body: some View {
        Text("Hello, World!")
            .onChange(of: scenePhase) { newScenePhase in
                switch newScenePhase {
                case .active:
                    print("アプリがアクティブです")
                case .inactive:
                    print("アプリが非アクティブです")
                case .background:
                    print("アプリがバックグラウンドです")
                @unknown default:
                    print("未知のシーンフェーズ")
                }
            }
    }
}

@main
struct MyApp: App {
    var body: some Scene {
        WindowGroup {
            ContentView()
        }
    }
}
```

このコードは、アプリがアクティブ、非アクティブ、バックグラウンドのどの状態にあるかを監視します。

しかし、特定のビューのタップイベントを検出するためには、`TapGesture`を使用するか、`Button` アクションを設定する必要が

---

## 🤖 アシスタント
*2023/9/26 23:48:31*

あります。しかし、通常はアプリの左上に表示されるアプリ名をタップして何かをする機能は提供されていません。これは、iOSのデザインガイドラインに基づいています。

ただし、UIの一部として左上に何かを配置し、タップを検出したい場合は、以下のように`Button`や`TapGesture`を使用できます。

```swift
import SwiftUI

struct ContentView: View {
    @Environment(\.scenePhase) var scenePhase
    
    var body: some View {
        NavigationView {
            Text("Hello, World!")
                .navigationTitle("MyApp")
                .navigationBarItems(leading:
                    Button(action: {
                        print("左上のアイテムがタップされました。")
                    }) {
                        Text("MyApp")
                    }
                )
        }
        .onChange(of: scenePhase) { newScenePhase in
            switch newScenePhase {
            case .active:
                print("アプリがアクティブです")
            case .inactive:
                print("アプリが非アクティブです")
            case .background:
                print("アプリがバックグラウンドです")
            @unknown default:
                print("未知のシーンフェーズ")
            }
        }
    }
}
```

このコードでは、`navigationBarItems` という ViewModifier を使用して、NavigationViewの左上に`Button`を配置しています。そして、そのボタンがタップされたら、コンソールにメッセージが表示されます。

---

## 👤 ユーザー
*2023/9/26 23:48:35*

そういうことじゃなくて、バックグラウドを経由せずにアプリのディープリンク遷移したあとに、左上のアプリ名をタップして戻ってきたことを検知したいんだ。

---

## 🤖 アシスタント
*2023/9/26 23:49:40*

ディープリンクを介して別の画面に遷移した後、左上のバックボタンやアプリ名をタップして最初の画面に戻った場合の検出方法ですね。これを検知するためには、ナビゲーションの状態変化を監視する必要があります。

SwiftUIでは直接ナビゲーションスタックの変更を監視するための組み込みの方法は提供されていないため、UIViewControllerのメソッドを利用するか、NavigationLinkのisActiveパラメータを使用して状態を追跡すると良いでしょう。

以下は、`NavigationLink`の`isActive`を使用した一例です：

```swift
import SwiftUI

struct ContentView: View {
    @State private var isLinkActive = false
    
    var body: some View {
        NavigationView {
            NavigationLink(destination: SecondView(), isActive: $isLinkActive) {
                Text("Go to Second View")
            }
            .onChange(of: isLinkActive) { newValue in
                if !newValue {
                    print("Back to the first view!")
                }
            }
        }
    }
}

struct SecondView: View {
    var body: some View {
        Text("Second View")
    }
}

struct ContentView_Previews: PreviewProvider {
    static var previews: some View {
        ContentView()
    }
}
```

この例では、`isLinkActive`が`false`に変更されたときに、ユーザーが最初のビューに戻ったことが検出されます。この状態の変更を検知して、必要なアクションを実行できます。

---

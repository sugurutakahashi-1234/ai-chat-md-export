# SwiftNIOæ¦‚è¦

Date: 2024-05-28

---

## ğŸ‘¤ User
*2024-05-28 10:41:15*

SwiftNIOã¨ã¯ï¼Ÿ

---

## ğŸ¤– Assistant
*2024-05-28 10:41:36*

SwiftNIO (Swift Non-blocking I/O) ã¯ã€AppleãŒé–‹ç™ºã—ãŸSwiftãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªç”¨ã®éåŒæœŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚SwiftNIOã¯ã€é«˜æ€§èƒ½ã§æ‹¡å¼µå¯èƒ½ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ã‚µãƒ¼ãƒãƒ¼ã‚’ä½œæˆã™ã‚‹ãŸã‚ã®åŸºç›¤ã¨ã—ã¦è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚ä»¥ä¸‹ã¯SwiftNIOã®ä¸»ãªç‰¹å¾´ã¨åˆ©ç‚¹ã§ã™ã€‚

### ä¸»ãªç‰¹å¾´

1. **éåŒæœŸ I/O:** SwiftNIOã¯éåŒæœŸã®I/Oæ“ä½œã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ãŠã‚Šã€é«˜ã„ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã¨ä½ã„ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã‚’å®Ÿç¾ã—ã¾ã™ã€‚
2. **ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•å‹:** ã‚¤ãƒ™ãƒ³ãƒˆãƒ«ãƒ¼ãƒ—ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€I/Oã‚¤ãƒ™ãƒ³ãƒˆã‚’åŠ¹ç‡çš„ã«å‡¦ç†ã—ã¾ã™ã€‚
3. **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ç‹¬ç«‹:** ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§å‹•ä½œã—ã€Linuxã¨macOSã®ä¸¡æ–¹ã§åˆ©ç”¨ã§ãã¾ã™ã€‚
4. **æŸ”è»Ÿãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£:** ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ¡ç”¨ã—ã€ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒãƒ³ãƒ‰ãƒ©ã‚’ç°¡å˜ã«è¿½åŠ ã§ãã¾ã™ã€‚
5. **æ‹¡å¼µæ€§:** æ‹¡å¼µæ€§ãŒé«˜ãã€è¤‡é›‘ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚‚å¯¾å¿œå¯èƒ½ã§ã™ã€‚

### åˆ©ç”¨ä¾‹

- **HTTPã‚µãƒ¼ãƒãƒ¼:** é«˜æ€§èƒ½ãªHTTPã‚µãƒ¼ãƒãƒ¼ã‚„Webã‚µãƒ¼ãƒãƒ¼ã®å®Ÿè£…ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
- **ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼:** ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ã‚„ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã®æ§‹ç¯‰ã«åˆ©ç”¨ã§ãã¾ã™ã€‚
- **ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒˆã‚³ãƒ«:** ç‹¬è‡ªã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã®åŸºç›¤ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
- **ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³:** ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«é©ã—ã¦ã„ã¾ã™ã€‚

### ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

1. **EventLoop:** ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã®åŸºæœ¬çš„ãªãƒ«ãƒ¼ãƒ—ã§ã€éåŒæœŸã‚¿ã‚¹ã‚¯ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã‚’è¡Œã„ã¾ã™ã€‚
2. **Channel:** I/Oæ“ä½œã‚’æŠ½è±¡åŒ–ã™ã‚‹ãŸã‚ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ã€ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿æ›¸ãã‚’è¡Œã„ã¾ã™ã€‚
3. **Pipeline:** ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†ã‚’è¡Œã†ãƒãƒ³ãƒ‰ãƒ©ã®ãƒã‚§ãƒ¼ãƒ³ã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚
4. **Handler:** ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®šç¾©ã™ã‚‹ãŸã‚ã®ã‚¯ãƒ©ã‚¹ã‚„ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã™ã€‚

### ä¾‹

ä»¥ä¸‹ã«ã€ã‚·ãƒ³ãƒ—ãƒ«ãªHTTPã‚µãƒ¼ãƒãƒ¼ã®å®Ÿè£…ä¾‹ã‚’ç¤ºã—ã¾ã™ã€‚

```swift
import NIO
import NIOHTTP1

final class SimpleHTTPServerHandler: ChannelInboundHandler {
    typealias InboundIn = HTTPServerRequestPart
    typealias OutboundOut = HTTPServerResponsePart

    func channelRead(context: ChannelHandlerContext, data: NIOAny) {
        let reqPart = self.unwrapInboundIn(data)
        
        switch reqPart {
        case .head(let request):
            print("Received request: \(request)")
        case .body:
            break
        case .end:
            var headers = HTTPHeaders()
            headers.add(name: "content-type", value: "text/plain; charset=utf-8")
            let responseHead = HTTPResponseHead(version: .http1_1, status: .ok, headers: headers)
            context.write(self.wrapOutboundOut(.head(responseHead)), promise: nil)
            
            var buffer = context.channel.allocator.buffer(capacity: 128)
            buffer.writeString("Hello, World!")
            context.write(self.wrapOutboundOut(.body(.byteBuffer(buffer))), promise: nil)
            
            context.writeAndFlush(self.wrapOutboundOut(.end(nil)), promise: nil)
        }
    }
}

let group = MultiThreadedEventLoopGroup(numberOfThreads: System.coreCount)
let bootstrap = ServerBootstrap(group: group)
    .serverChannelOption(ChannelOptions.backlog, value: 256)
    .childChannelOption(ChannelOptions.socketOption(.so_reuseaddr), value: 1)
    .childChannelInitializer { channel in
        channel.pipeline.configureHTTPServerPipeline().flatMap {
            channel.pipeline.addHandler(SimpleHTTPServerHandler())
        }
    }

defer {
    try! group.syncShutdownGracefully()
}

let channel = try! bootstrap.bind(host: "localhost", port: 8080).wait()
print("Server running on:", channel.localAddress!)
try! channel.closeFuture.wait()
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ã€åŸºæœ¬çš„ãªHTTPã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¡ä¸Šã’ã€"Hello, World!"ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã—ã¾ã™ã€‚SwiftNIOã‚’ä½¿ã†ã“ã¨ã§ã€åŠ¹ç‡çš„ã‹ã¤ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’Swiftã§å®Ÿè£…ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

---

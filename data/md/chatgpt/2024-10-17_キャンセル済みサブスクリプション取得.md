# キャンセル済みサブスクリプション取得

Date: 2024-10-17

---

## 👤 User
*2024-10-17 11:21:46*

Swiftでこれの配列からcancelAtがあるもので、endAtが一番古い日を取得したい

struct Subscription: Sendable, Identifiable, Hashable {
    /// id
    let id: String
    /// `apple` or `stripe` or `corporate`
    let type: SubscriptionType
    /// 開始日
    let startAt: Date
    /// 終了日
    let endAt: Date
    /// キャンセル日 (nil の場合は未キャンセル)
    let cancelAt: Date?
}

---

## 🤖 Assistant
*2024-10-17 11:21:58*

`Subscription`の配列から`cancelAt`が`nil`ではないものをフィルタリングして、`endAt`が最も古いものを取得するためには、次のように`filter`と`min(by:)`を使って実装できます。

```swift
func getOldestCancelledSubscription(from subscriptions: [Subscription]) -> Subscription? {
    return subscriptions
        .filter { $0.cancelAt != nil } // cancelAtがあるものをフィルタリング
        .min(by: { $0.endAt < $1.endAt }) // endAtが一番古いものを取得
}
```

この関数は、キャンセルされたサブスクリプションの中から`endAt`が一番古いものを返します。キャンセルされたサブスクリプションがない場合、`nil`を返します。

---

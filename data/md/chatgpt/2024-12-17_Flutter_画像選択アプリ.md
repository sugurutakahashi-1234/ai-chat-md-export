# Flutter 画像選択アプリ

日付: 2024-12-17

---

## 👤 ユーザー
*2024/12/17 09:12:35*

flutterでiOSとAndroidでデバイスの中の画像から一つを選択して画面に表示するようなアプリを作りたい

---

## 🤖 アシスタント
*2024/12/17 09:13:20*

Flutterで、iOSとAndroidの両方で動作する画像選択アプリを作成するには、以下の手順を踏むと簡単です。`image_picker`パッケージを使用するのがおすすめです。このパッケージは、デバイス内の画像を選択する機能を提供します。

---

### 1. **プロジェクトの作成**
```bash
flutter create image_picker_example
cd image_picker_example
```

---

### 2. **必要なパッケージをインストール**
`pubspec.yaml` に以下の依存関係を追加します：

```yaml
dependencies:
  flutter:
    sdk: flutter
  image_picker: ^0.8.8+7 # 最新バージョンを確認して更新してください
```

その後、パッケージをインストールします：
```bash
flutter pub get
```

---

### 3. **画像選択ロジックの実装**
`lib/main.dart` に以下のコードを記述します：

```dart
import 'package:flutter/material.dart';
import 'package:image_picker/image_picker.dart';
import 'dart:io';

void main() {
  runApp(const MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Image Picker Example',
      theme: ThemeData(primarySwatch: Colors.blue),
      home: const ImagePickerScreen(),
    );
  }
}

class ImagePickerScreen extends StatefulWidget {
  const ImagePickerScreen({super.key});

  @override
  _ImagePickerScreenState createState() => _ImagePickerScreenState();
}

class _ImagePickerScreenState extends State<ImagePickerScreen> {
  File? _selectedImage;
  final ImagePicker _picker = ImagePicker();

  Future<void> _pickImage() async {
    final XFile? pickedFile = await _picker.pickImage(source: ImageSource.gallery);

    if (pickedFile != null) {
      setState(() {
        _selectedImage = File(pickedFile.path);
      });
    } else {
      // キャンセルされた場合の処理
      debugPrint('画像選択がキャンセルされました');
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: const Text('画像選択')),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            _selectedImage != null
                ? Image.file(_selectedImage!, height: 300)
                : const Text('画像が選択されていません'),
            const SizedBox(height: 20),
            ElevatedButton(
              onPressed: _pickImage,
              child: const Text('画像を選択'),
            ),
          ],
        ),
      ),
    );
  }
}
```

---

### 4. **プラットフォームごとの設定**
#### iOS
`ios/Runner/Info.plist` に以下を追加します：

```xml
<key>NSPhotoLibraryUsageDescription</key>
<string>アプリで画像を選択するためにフォトライブラリへのアクセスが必要です。</string>
```

#### Android
`android/app/src/main/AndroidManifest.xml` に以下を追加します：

```xml
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE"/>
<uses-permission android:name="android.permission.CAMERA"/>
```

---

### 5. **アプリのビルドと実行**
iOSまたはAndroidデバイスでアプリを実行します：

```bash
flutter run
```

---

### 実行結果
- アプリが起動すると、ボタンが表示されます。
- 「画像を選択」ボタンを押すと、デバイス内のフォトライブラリが開きます。
- 選択した画像が画面に表示されます。

---

### 必要に応じた拡張
- **カメラから画像を撮影したい場合**：
  ```dart
  final XFile? pickedFile = await _picker.pickImage(source: ImageSource.camera);
  ```
  に変更するだけでカメラから画像を取得できます。
  
- **画像のサイズや形式を制御**：
  `pickImage` メソッドのオプションを利用して、品質や解像度を制限できます：
  ```dart
  await _picker.pickImage(
    source: ImageSource.gallery,
    maxWidth: 600,
    imageQuality: 80,
  );
  ``` 

これで、基本的な画像選択アプリは完成です！

---

## 👤 ユーザー
*2024/12/17 09:13:48*

statefullウィジェットではなくhooksを使って欲しい

---

## 🤖 アシスタント
*2024/12/17 09:14:20*

`flutter_hooks` パッケージを使用して、状態管理をフックに置き換えたバージョンを以下に示します。`flutter_hooks`を利用すると、コードが簡潔になり、再利用可能なロジックを作成するのが容易になります。

---

### 1. **パッケージの追加**
まず、`pubspec.yaml` に以下の依存関係を追加します。

```yaml
dependencies:
  flutter:
    sdk: flutter
  flutter_hooks: ^0.18.6  # 最新バージョンを確認してください
  image_picker: ^0.8.8+7 # 最新バージョンを確認してください
```

その後、以下を実行してパッケージを取得します：
```bash
flutter pub get
```

---

### 2. **`flutter_hooks` を使用したコード**

以下は、`flutter_hooks`を使ったコード例です。

```dart
import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:image_picker/image_picker.dart';
import 'dart:io';

void main() {
  runApp(const MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Image Picker with Hooks',
      theme: ThemeData(primarySwatch: Colors.blue),
      home: const ImagePickerScreen(),
    );
  }
}

class ImagePickerScreen extends HookWidget {
  const ImagePickerScreen({super.key});

  @override
  Widget build(BuildContext context) {
    // フックで状態を管理
    final selectedImage = useState<File?>(null);
    final picker = useMemoized(() => ImagePicker());

    Future<void> pickImage() async {
      final XFile? pickedFile = await picker.pickImage(source: ImageSource.gallery);

      if (pickedFile != null) {
        selectedImage.value = File(pickedFile.path);
      } else {
        debugPrint('画像選択がキャンセルされました');
      }
    }

    return Scaffold(
      appBar: AppBar(title: const Text('画像選択')),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            selectedImage.value != null
                ? Image.file(selectedImage.value!, height: 300)
                : const Text('画像が選択されていません'),
            const SizedBox(height: 20),
            ElevatedButton(
              onPressed: pickImage,
              child: const Text('画像を選択'),
            ),
          ],
        ),
      ),
    );
  }
}
```

---

### 3. **説明**
#### フックを使ったポイント：
1. **状態管理 (`useState`)**:
   - `selectedImage`を`useState`で管理しています。これにより、StatefulWidgetを使用せずに状態を簡単に扱えます。

   ```dart
   final selectedImage = useState<File?>(null);
   ```

2. **ImagePickerのインスタンス生成

---

## 👤 ユーザー
*2024/12/17 09:14:24*

statefullウィジェットではなくhooksを使って欲しい

---

## 🤖 アシスタント
*2024/12/17 09:14:38*

以下は、`flutter_hooks`を使った完全な実装例です。StatefulWidgetを使わずにフックで状態を管理する方法を示しています。

---

### 完全なコード例

```dart
import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:image_picker/image_picker.dart';
import 'dart:io';

void main() {
  runApp(const MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Image Picker with Hooks',
      theme: ThemeData(primarySwatch: Colors.blue),
      home: const ImagePickerScreen(),
    );
  }
}

class ImagePickerScreen extends HookWidget {
  const ImagePickerScreen({super.key});

  @override
  Widget build(BuildContext context) {
    // フックで状態を管理
    final selectedImage = useState&lt;File?&gt;(null); // 選択した画像の状態
    final picker = useMemoized(() =&gt; ImagePicker()); // ImagePickerインスタンスをキャッシュ

    // 画像を選択する非同期関数
    Future&lt;void&gt; pickImage() async {
      final XFile? pickedFile = await picker.pickImage(source: ImageSource.gallery);
      if (pickedFile != null) {
        selectedImage.value = File(p

---

# å‹å®‰å…¨ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

æ—¥ä»˜: 2025-06-04

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/4 22:30:08*

TypeScriptã§ã¯é–¢æ•°ã§ã‚¨ãƒ©ãƒ¼ã‚’è¿”å´ã™ã‚‹ã¨ãã¯ã©ã†è¡¨ç¾ã—ã¦ã€ãã‚Œã‚’å‘¼ã¶å´ã¯ã©ã†ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã™ã‚‹ã®ãŒã‚ˆã„ã®ã‹ï¼Ÿ
ãªã‚‹ã¹ãå‹å®‰å…¨ãªå®Ÿè£…ã§è¡Œã„ãŸã„ã€‚ãŸã¨ãˆã°APIã®å‘¼ã³å‡ºã—æ™‚ã«ã©ã†ã™ã‚‹ã‹ã‚’è€ƒãˆãŸã„ã€‚æˆåŠŸã¯ç”»é¢ã«è¡¨ç¤ºã—ã¦ã€å¤±æ•—ã¯apiã®ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚³ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã—ã¦å ´åˆåˆ†ã‘ã®å‡¦ç†ã‚’ã—ãŸã„ã¨ã™ã‚‹ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/4 22:30:09*

ä»¥ä¸‹ã§ã¯ **ã€Œä¾‹å¤–ã‚’æŠ•ã’ã‚‹ã€** ã¨ **ã€Œå€¤ã¨ã—ã¦è¿”ã™ã€** ã® 2 é€šã‚Šã‚’æ¯”è¼ƒã—ãŸã†ãˆã§ã€ç”»é¢å´ã§ *HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã”ã¨ã«å ´åˆåˆ†ã‘* ã—ã‚„ã™ãã€ã—ã‹ã‚‚ **å‹å®‰å…¨** ã‚’ç¶­æŒã§ãã‚‹å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä¾‹ç¤ºã—ã¾ã™ã€‚çµè«–ã ã‘å…ˆã«è¨€ã†ã¨â€•â€•

> **ã‚¢ãƒ—ãƒªå¢ƒç•Œï¼ˆAPI ãƒ©ãƒƒãƒ‘ï¼‰ã§ã¯ â€œçµæœã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆâ€ ã‚’è¿”ã—ã€UI å±¤ã§ã¯ discriminated union ã§ exhaustiveness-check ã™ã‚‹**  

ãŒæœ€ã‚‚å®‰å…¨ã§ä¿å®ˆã—ã‚„ã™ã„ã§ã™ã€‚  

---

## 1. ãµãŸã¤ã®æˆ¦ç•¥ã¨å‹å®‰å…¨æ€§

| æˆ¦ç•¥ | ä½¿ã„æ–¹ | ãƒ¡ãƒªãƒƒãƒˆ | ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ |
| --- | --- | --- | --- |
| ä¾‹å¤– `throw` | `try { await api() } catch(e) { â€¦ }` | *æ—©æœŸè„±å‡º* ãŒæ¥½ï¼æ·±ã„éšå±¤ã§ã‚‚ä¸€æ‹¬ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¯ | **å‹æƒ…å ±ãŒæµã‚Œãªã„**ï¼ˆ`catch` ã¯åŸºæœ¬ `unknown`ï¼‰<br>ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ¼ã‚Œã‚’ TS ãŒæ¤œçŸ¥ã§ããªã„ |
| çµæœã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã™ | `const res = await api(); if (res.ok) â€¦` | **æˆ»ã‚Šå€¤ã«å‹ã‚’ä»˜ã‘ã‚‰ã‚Œã‚‹**<br>switch æ–‡ã§ **exhaustive** ã«ãƒã‚§ãƒƒã‚¯å¯ | å‘¼ã³å‡ºã—å´ã§ if/switch ãŒå¿…é ˆï¼ˆãŸã ã— UI å±¤ã§ã¯åˆ†å²ã—ãŸã„ã®ã§æ¬ ç‚¹ã«ãªã‚Šã«ãã„ï¼‰ |

> **ã€Œå¿…ãšçŠ¶æ³ã‚’åˆ†ã‘ãŸã„ UIã€ï¼‹ã€ŒHTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã”ã¨ã«å‡¦ç†ãŒå¤‰ã‚ã‚‹ã€** ã¨ã„ã†è¦ä»¶ã§ã¯ 2 ç•ªç›®ãŒåœ§å€’çš„ã«æ‰±ã„ã‚„ã™ã„ã§ã™ã€‚

---

## 2. å‹å®šç¾© â€•â€• Result ã¨ Error ã‚’ discriminated union ã§è¡¨ç¾

```ts
// ---- æ±ç”¨ Result å‹ ----
export type Result<T, E> =
  | { ok: true;  data: T }
  | { ok: false; error: E };

// ---- API å›ºæœ‰ã®ã‚¨ãƒ©ãƒ¼å‹ (ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§å¼åˆ¥) ----
export type ApiError =
  | { status: 400; type: "BadRequest";    message: string }
  | { status: 401; type: "Unauthorized";  message: string }
  | { status: 404; type: "NotFound";      message: string }
  | { status: 500; type: "ServerError";   message: string }
  | { status: -1;  type: "NetworkError";  reason: string }; // fetch ãŒæŠ•ã’ãŸå ´åˆãªã©
```

*`status` ãŒ discriminant ã«ãªã£ã¦ã„ã‚‹ã®ã§ `switch(error.status)` ã ã‘ã§çµã‚Šè¾¼ã¿å¯èƒ½ã€‚  
æ–°ã‚±ãƒ¼ã‚¹ã‚’è¿½åŠ ã—ãŸã‚‰ **ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼** ã§æ•™ãˆã¦ãã‚Œã¾ã™ã€‚*

---

## 3. API ãƒ©ãƒƒãƒ‘é–¢æ•°

```ts
export async function fetchUser(id: string): Promise<Result<User, ApiError>> {
  try {
    const resp = await fetch(`/api/users/${id}`);

    if (resp.ok) {
      // 200 ç³» â†’ Zod ãªã©ã§ãƒ‘ãƒ¼ã‚¹ã™ã‚‹ã¨å®‰å¿ƒ
      const json = await resp.json();
      return { ok: true, data: userSchema.parse(json) };
    }

    // 4xx / 5xx â†’ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã”ã¨ã«å¤‰æ›
    const message = await resp.text();
    switch (resp.status) {
      case 400:
        return { ok: false, error: { status: 400, type: "BadRequest",   message } };
      case 401:
        return { ok: false, error: { status: 401, type: "Unauthorized", message } };
      case 404:
        return { ok: false, error: { status: 404, type: "NotFound",     message } };
      default:
        return { ok: false, error: { status: 500, type: "ServerError",  message } };
    }
  } catch (err) {
    // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å±¤ã®ä¾‹å¤–ã‚’æ¡ã‚Šã¤ã¶ã—ã¦å‹ä»˜ãã§è¿”ã™
    return {
      ok: false,
      error: { status: -1, type: "NetworkError", reason: (err as Error).message },
    };
  }
}
```

ãƒã‚¤ãƒ³ãƒˆ ğŸ”‘  

1. **API ã‹ã‚‰ â€œä¾‹å¤–ã‚’æ¼ã‚‰ã•ãªã„â€**ï¼šã©ã‚“ãªéšœå®³ã§ã‚‚ Result ã«ç•³ã¿è¾¼ã‚€  
2. **æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼**ï¼ˆZod ç­‰ï¼‰ã§ â€œå®‰å…¨ãª dataâ€ ã«  
3. **ã‚¨ãƒ©ãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¯ switch ã§ç¶²ç¾…**ï¼ˆdefault ã§ 500 ç³»ã«å¯„ã›ã‚‹ã¨æ‹¡å¼µã—ã‚„ã™ã„ï¼‰

---

## 4. å‘¼ã³å‡ºã—å´ï¼ˆReact ã®ä¾‹ï¼‰

```tsx
const handleLoad = async () => {
  const res = await fetchUser(userId);

  if (res.ok) {
    setUser(res.data);
    toast.success("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ");
    return;
  }

  // ã‚¨ãƒ©ãƒ¼ã”ã¨ã« UI ã‚’åˆ†å²
  switch (res.error.status) {
    case 400:
      toast.error("å…¥åŠ›ãŒä¸æ­£ã§ã™");
      break;
    case 401:
      toast.warning("å†ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„");
      navigate("/login");
      break;
    case 404:
      navigate("/404");
      break;
    case -1:
      toast.error("ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æ¥ç¶šã§ãã¾ã›ã‚“");
      break;
    default:          // 500 ç³»
      toast.error("ã‚µãƒ¼ãƒãƒ¼ã§å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸ");
  }
};
```

*`switch(res.error.status)` ã¯ **exhaustive** ãªã®ã§ã€æ–°ã—ã„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¿½åŠ ã™ã‚‹ã¨ **â€œæœ€å¾Œã® default ã« never ãŒæ¥ã¦ã‚¨ãƒ©ãƒ¼â€** ã§ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ¼ã‚Œã«æ°—ä»˜ã‘ã¾ã™ã€‚*

---

## 5. ãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ¸›ã‚‰ã™æ–¹æ³•

| ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ | æ¦‚è¦ |
| --- | --- |
| **neverthrow** | `Result<T, E>` & è£œåŠ©ãƒ¡ã‚½ãƒƒãƒ‰ (`map/andThen`) ä»˜ãã€‚è‡ªå‰ã§å®šç¾©ã™ã‚‹ã‚ˆã‚Š API ãŒè±Šå¯Œã€‚ |
| **fp-ts / Effect** | `Either`, `TaskEither`, `Effect` ãªã©é–¢æ•°å‹ã‚¹ã‚¿ã‚¤ãƒ«ã€‚å¤§è¦æ¨¡ã§ä¸€è²«ã—ãŸã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒå¿…è¦ãªã¨ãã«ã€‚ |
| **openapi-zod-client** | OpenAPI ä¸Šã® `responses` ã‚’ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã— **æˆåŠŸ/å¤±æ•—ãŒå‹ã«åæ˜ ** ã•ã‚Œã‚‹ã€‚ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼ã‚‚è‡ªå‹•ã€‚ä»Šå›ã®æ‰‹å·»ã Result ã¨æ€æƒ³ã¯åŒã˜ã€‚ |

> *ç”Ÿæˆç³»ã‚’ä½¿ã†ãªã‚‰ã€Œ`200` ä»¥å¤–ã¯å…¨ã¦ `ApiError`ã€ã®ã‚ˆã†ãª schema ã‚’æ›¸ãã¨ã€ä¸Šè¨˜ã¨åŒã˜ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ–¹æ³•ãŒãã®ã¾ã¾å¾—ã‚‰ã‚Œã¾ã™ã€‚*

---

## 6. ã¾ã¨ã‚ & ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

1. **ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå¢ƒç•Œã§ â€œä¾‹å¤– â†’ Resultâ€ ã«å¤‰æ›**  
   UI ã¾ã§ throw ã‚’é€éã•ã›ãªã„ã€‚
2. **`status` ã‹ `type` ã‚’ discriminant ã«ã—ã¦ union ã‚’ä½œã‚‹**  
   â†’ `switch` ã§ **ç¶²ç¾…** ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ä¿è¨¼ã€‚
3. **æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ Zod ãªã©ã§ parse**  
   â†’ *ãƒ©ãƒ³ã‚¿ã‚¤ãƒ * ã®å®‰å…¨æ€§ã‚‚æ‹…ä¿ã€‚
4. **ãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆãŒæ°—ã«ãªã‚‹ãªã‚‰ neverthrow ãªã©ã‚’æ¡ç”¨**  
   â†’ `map`, `mapErr`, `asyncResult` ã§ compose ãŒæ¥½ã€‚

ã“ã‚Œã§ã€ŒæˆåŠŸã¯ç”»é¢è¡¨ç¤ºã€å¤±æ•—ã¯ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã§å ´åˆåˆ†ã‘ã€ã¨ã„ã† UI è¦ä»¶ã‚’ **100 % å‹å®‰å…¨** ã«æº€ãŸã›ã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/4 22:32:47*

ifãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒä¸€èˆ¬çš„ãªã®ã‹ï¼Ÿ try-catchã¯ã‚ã¾ã‚Šã—ãªã„ã®ã‹ï¼Ÿ

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/4 22:32:48*

### ã€Œif/switch ã§åˆ†å²ã€ã‹ã€Œtry â€¦ catchã€ã§æ•ã¾ãˆã‚‹ã‹ã¯ â€œç²’åº¦â€ ã¨ â€œè²¬å‹™â€ ã§æ±ºã‚ã‚‹

| å±¤ | ç›®çš„ | å…¸å‹çš„ãªã‚¹ã‚¿ã‚¤ãƒ« |
| --- | --- | --- |
| **ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå†…ãƒ»ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯å†…éƒ¨** | äºˆæœŸã—ãªã„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚¨ãƒ©ãƒ¼ã‚’å³åº§ã«ä¼æ¬ã—ãŸã„ | `throw new Error()` â†’ å‘¼ã³å‡ºã—å´ãŒ `try â€¦ catch` |
| **API ãƒ©ãƒƒãƒ‘ï¼ˆI/O å¢ƒç•Œï¼‰** | **I/O å¤±æ•—ã‚’ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼ã«æ­£è¦åŒ–**ã—ãŸã„ | `try â€¦ catch` ã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¾‹å¤–ã‚’æ•æ‰ã—ã€<br>æˆåŠŸ/å¤±æ•—ã® **Result å‹** ã‚’è¿”ã™ |
| **ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤** | ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®åˆ†å²ã‚’ **å‹å®‰å…¨ã«å¼·åˆ¶**ã—ãŸã„ | `if (result.ok)` / `switch (result.error.kind)` ã§<br>**exhaustive-check** |
| **UI å±¤ï¼ˆReact ãªã©ï¼‰** | ç”»é¢é·ç§»ãƒ»ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤ºãªã©ãƒ¦ãƒ¼ã‚¶é€šçŸ¥ | `switch / if` ã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ã«å‡¦ç† or<br>ã‚¨ãƒ©ãƒ¼å¢ƒç•Œã§ã¾ã¨ã‚ã¦ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° |

> - **ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚¨ãƒ©ãƒ¼ï¼ˆãƒã‚°ã‚„ null å‚ç…§ï¼‰**: _throw_ â†’ `try â€¦ catch`  
> - **ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹æƒ³å®šæ¸ˆã¿ã®å¤±æ•—ï¼ˆ404, Validation Error â€¦ï¼‰**: _æˆ»ã‚Šå€¤ Result_ â†’ `if` / `switch`

### ãªãœã€Œtry â€¦ catch ã ã¨å‹å®‰å…¨ãŒè½ã¡ã‚‹ã€ã®ã‹ï¼Ÿ

```ts
try {
  await fetchUser(id);
} catch (e) {
  // e ã®å‹ã¯åŸºæœ¬ unknown
  // instanceOf ã‚„ã‚«ã‚¹ã‚¿ãƒ ã‚¬ãƒ¼ãƒ‰ã§çµã‚Œã°å¯èª­æ€§ãƒ»ç¶²ç¾…æ€§ãŒä¸‹ãŒã‚‹
}
```

*ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã¯ã€Œæ•ã¾ãˆãŸã‚ã¨ã«ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ¼ã‚ŒãŒã‚ã‚‹ã‹ã€ã¾ã§ã¯æ¤œçŸ¥ã§ãã¾ã›ã‚“*ã€‚  
ä¸€æ–¹ **discriminated union** ã‚’è¿”ã™è¨­è¨ˆãªã‚‰â€•â€•

```ts
const res = await fetchUser(id);
if (!res.ok) {
  // res.error ã¯ { status: 400 | 401 | 404 | 500 | -1, â€¦ }
  switch (res.error.status) {
    case 400: â€¦   // ğŸ‘ ã“ã“ã‚’æ›¸ã‹ãªã„ã¨ TS ãŒã‚¨ãƒ©ãƒ¼
    // â€¦
  }
}
```

ã€Œæ›¸ãå¿˜ã‚Œã‚‹ã¨ãƒ“ãƒ«ãƒ‰ãŒè½ã¡ã‚‹ã€ã®ã§ **ç¶²ç¾…æ€§ãŒã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã§ä¿è¨¼** ã•ã‚Œã¾ã™ã€‚

### ç¾å ´ã§ã¯ã©ã¡ã‚‰ãŒ â€œä¸€èˆ¬çš„â€ ã‹ï¼Ÿ

| é …ç›® | å®Ÿæ…‹ |
| --- | --- |
| OSS/SDK | ã»ã¼ **ä¾‹å¤–ã‚’æŠ•ã’ã‚‹**ï¼ˆAxios, Prisma, AWS SDKâ€¦ï¼‰ |
| **Web / ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒª**ã®ãƒ•ãƒ­ãƒ³ãƒˆ | **API ãƒ©ãƒƒãƒ‘ã‚’è‡ªå‰ã§å·»ã„ã¦ Result å‹** ã«å¤‰æ›ã™ã‚‹ãƒãƒ¼ãƒ å¢—åŠ <br>ï¼ˆneverthrow / zod-client / TanStack Query ã® `throwOnError:false` ãªã©ï¼‰ |
| é–¢æ•°å‹æŒ‡å‘ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ | `fp-ts`, `Effect` ã® `TaskEither` ã‚’å¤šç”¨ï¼ˆå®Œå…¨å€¤è¿”å´å‹ï¼‰ |
| å°è¦æ¨¡ã‚¹ã‚¯ãƒªãƒ—ãƒˆ | `try â€¦ catch` ãŒæ‰‹è»½ãªã®ã§ãã®ã¾ã¾ |

ã¤ã¾ã‚Š **ã€Œtry â€¦ catchï¼æ‚ªã€ã§ã¯ãªãã€éšå±¤ã”ã¨ã«å½¹å‰²ãŒé•ã†** ã¨ã„ã†æ•´ç†ãŒä¸»æµã§ã™ã€‚

### ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰å®Ÿè£…ä¾‹ï¼ˆAxios + neverthrowï¼‰

```ts
import axios from "axios";
import { err, ok, Result } from "neverthrow";

export async function fetchUser(id: string): ResultAsync<User, ApiError> {
  return ResultAsync.fromPromise(
    axios.get<User>(`/api/users/${id}`),
    // Axios ãŒæŠ•ã’ã‚‹ã‚¨ãƒ©ãƒ¼ã‚’å‹ä»˜ãã«
    (e) => toApiError(e),
  ).map((res) => res.data); // æˆåŠŸæ™‚ã ã‘ map
}
```

*UI ã¯ `const res = await fetchUser(id); if (res.isOk()) â€¦` ã¨æ›¸ã‘ã¦ã€  
`switch(res.error.status)` ã§ exhaustiveness ãŒåƒãã¾ã™ã€‚*

### ã¾ã¨ã‚ãƒ«ãƒ¼ãƒ«

1. **ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå¢ƒç•Œ** â€¦ _throw_ ã—ã¦å‘¼ã³å‡ºã—å´ã«å§”ã­ã‚‹ã€‚  
2. **ã‚¢ãƒ—ãƒªå¢ƒç•Œï¼ˆI/O â†’ ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰** â€¦ _Result å‹ã¸å¤‰æ›_ ã—ã¦ â€œæƒ³å®šå†…ã®å¤±æ•—â€ ã‚’åˆ—æŒ™ã™ã‚‹ã€‚  
3. **UI/ãƒ‰ãƒ¡ã‚¤ãƒ³** â€¦ `if` / `switch` ã§ **åˆ†å²ã‚’å¼·åˆ¶**ã€æ–°ã‚±ãƒ¼ã‚¹è¿½åŠ æ™‚ã«ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ã§æ°—ä»˜ãã€‚  
4. **ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚¨ãƒ©ãƒ¼** ã¯ä¾‹å¤–ã®ã¾ã¾ã«ã—ã¦ãŠãã€Error Boundary ã‚„æœ€ä¸Šä½ã§æ¡ã‚Šã¤ã¶ã™ã€‚

ã“ã®ä½ã¿åˆ†ã‘ã‚’å¾¹åº•ã™ã‚Œã°ã€Œå‹å®‰å…¨ã€ã¨ã€Œè¨˜è¿°é‡ã€ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å´©ã•ãšã€  
**try â€¦ catch ã‚‚ if/switch ã‚‚ â€œç„¶ã‚‹ã¹ãå ´æ‰€â€ ã§æ´»ã‹ã™** ã“ã¨ãŒã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/4 22:34:22*

openapi-zod-client ã‚’ä½¿ã†ã¨ã©ã‚“ãªå®Ÿè£…ã«ãªã‚‹ã®ã‹ï¼Ÿ

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/4 22:35:10*

### ã–ã£ãã‚Šæµã‚Œ â”€ â€œOpenAPI â†’ å‹ä»˜ã Zod + Zodios ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆâ€ ã‚’ä¸¸ã”ã¨è‡ªå‹•ç”Ÿæˆ

| æ‰‹é † | ã‚³ãƒãƒ³ãƒ‰ï¼ãƒ•ã‚¡ã‚¤ãƒ« | è£œè¶³ |
| --- | --- | --- |
| â‘  **ä¾å­˜è¿½åŠ ** | `pnpm add @zodios/core`<br>`pnpm add -D openapi-zod-client` | Zod ã¯ @zodios/core ã«åŒæ¢± |
| â‘¡ **OpenAPI å®šç¾©ã‚’æ›¸ã** | `openapi.yaml` | 200ï¼4xxï¼5xx ãªã© **ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç¶²ç¾…**ã—ã¦ãŠã |
| â‘¢ **ã‚¹ã‚¯ãƒªãƒ—ãƒˆè¿½åŠ ** | ```jsonc
"scripts": {
  "codegen:api":
    "openapi-zod-client ./openapi.yaml \
     -o src/api.gen.ts \
     --base-url /api   \
     -a               /* axios ã‚’åŒæ¢± */
}
``` | `-a` ãƒ•ãƒ©ã‚°ã§ axios ä¾å­˜è¾¼ã¿ã® Zodios ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒç”Ÿæˆã•ã‚Œã‚‹ îˆ€citeîˆ‚turn1search0îˆ |
| â‘£ **ç”Ÿæˆ** | `pnpm run codegen:api` | 1 ãƒ•ã‚¡ã‚¤ãƒ«ã« **Zod ã‚¹ã‚­ãƒ¼ãƒ + Endpoints + Client factory** ãŒå‡ºåŠ›ã•ã‚Œã‚‹ îˆ€citeîˆ‚turn1search1îˆ |

---

### ç”Ÿæˆç‰©ï¼ˆæŠœç²‹ï¼‰

```ts
// src/api.gen.ts   â€»è‡ªå‹•ç”Ÿæˆ
import { z } from "zod";
import { makeApi, Zodios, type ZodiosOptions } from "@zodios/core";

// --- schemas -------------------------------------------------
const User = z.object({
  id: z.string(),
  name: z.string(),
});
const Error404 = z.object({
  status: z.literal(404),
  message: z.string(),
});

// --- endpoints ----------------------------------------------
const endpoints = makeApi([
  {
    method: "get",
    path: "/users/:id",
    alias: "getUser",
    parameters: [{ name: "id", type: "Path", schema: z.string() }],
    response: User,               // 200
    errors: [{ status: 404, schema: Error404 }], // â† 4xx ã‚‚å‹ã«è¼‰ã‚‹
  },
]);

// --- client factory -----------------------------------------
export function createApiClient(
  baseUrl = "/api",
  opts?: ZodiosOptions,
) {
  return new Zodios(baseUrl, endpoints, opts);
}
```

ãƒã‚¤ãƒ³ãƒˆ ğŸ“  

* **æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚‚å¤±æ•—ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚‚ Zod ã‚¹ã‚­ãƒ¼ãƒã§ç”Ÿæˆ**  
  â†’ å®Ÿè¡Œæ™‚ã¯ `axios â†’ Zod` ã§ãƒ‘ãƒ¼ã‚¹ã•ã‚Œã‚‹ã®ã§ *ä¸æ­£ JSON ãŒæ¥ã¦ã‚‚ throw*  
* `alias` ãŒãã®ã¾ã¾ãƒ¡ã‚½ãƒƒãƒ‰åã«ãªã‚‹ã®ã§ **IDE è£œå®ŒãŒåŠ¹ã**ã€‚

---

### å‘¼ã³å‡ºã—å´ã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

#### 1ï¸âƒ£ ãã®ã¾ã¾ `tryâ€’catch`ï¼ˆæœ€çŸ­ï¼‰

```ts
import { createApiClient } from "@/api.gen";
import { ZodiosError } from "@zodios/core";

const api = createApiClient();

try {
  const user = await api.getUser({ params: { id: "123" } }); // â† User å‹
  toast.success(`${user.name} ã‚’å–å¾—ã—ã¾ã—ãŸ`);
} catch (e) {
  if (e instanceof ZodiosError) {
    switch (e.response?.status) {
      case 404:
        toast.error("ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå­˜åœ¨ã—ã¾ã›ã‚“");
        break;
      default:
        toast.error("ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ");
    }
  }
}
```

*`ZodiosError` ã«ã¯ `response?.status` ã¨ **Zod ã§ãƒ‘ãƒ¼ã‚¹æ¸ˆã¿ã® `e.response?.data`** ãŒå…¥ã‚‹ã®ã§ã€  
JSONâ†’TS å‹å¤‰æ›ã‚’è‡ªåˆ†ã§æ›¸ãå¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚*

---

#### 2ï¸âƒ£ â€œResult å‹â€ ãƒ©ãƒƒãƒ‘ãƒ¼ã§ UI å±¤ã‚’ if/switch ã«çµ±ä¸€

```ts
import { Result } from "@/shared/result";
import { createApiClient } from "@/api.gen";
import { ZodiosError } from "@zodios/core";

const api = createApiClient();

export async function fetchUser(
  id: string,
): Promise<Result<User, Error404>> {
  try {
    const data = await api.getUser({ params: { id } });
    return { ok: true, data };
  } catch (e) {
    if (
      e instanceof ZodiosError &&
      e.response?.status === 404
    ) {
      return { ok: false, error: e.response.data }; // â† Error404 å‹
    }
    throw e; // æƒ³å®šå¤–ã¯å¾“æ¥ã©ãŠã‚Š throw
  }
}
```

â†’ UI å´ã¯ **å‰å›ç¤ºã—ãŸ `if (res.ok)` / `switch (res.error.status)` ãƒ‘ã‚¿ãƒ¼ãƒ³**ã§çµ±ä¸€ã§ãã‚‹ã€‚

---

### ç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«çµ„ã¿è¾¼ã‚€

| ç›®çš„ | ã‚„ã‚Šæ–¹ |
| --- | --- |
| **TanStack Query** | ```ts
const api = createApiClient();
const { data } = useQuery({
  queryKey: ["user", id],
  queryFn: () => api.getUser({ params: { id } }),
});
``` |
| **è¤‡æ•°ç’°å¢ƒã® baseURL åˆ‡æ›¿** | `createApiClient(process.env.API_BASE_URL)` |
| **å…±é€šãƒ˜ãƒƒãƒ€ãƒ¼ / ãƒªãƒˆãƒ©ã‚¤** | `api.interceptors.request.use(/* ... */)` <br> `api.interceptors.response.use(/* ... */)` ï¼ˆaxios API ã¨åŒã˜ï¼‰ |

---

### openapi-zod-client ã§å¾—ã‚‰ã‚Œã‚‹ã‚‚ã®

* **OpenAPI âœ å‹ âœ å®Ÿè¡Œæ™‚æ¤œè¨¼ âœ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¾ã§ä¸€æœ¬åŒ–**  
  â†’ å®šç¾©ã¨å®Ÿè£…ã®ã‚ºãƒ¬ãŒã‚¼ãƒ­ã€‚  
* **é 2xx ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚‚å‹ä»˜ãã§æ•æ‰**  
  â†’ ã€Œ404 ãªã‚‰ã“ã® UIã€ã¨ã„ã†åˆ†å²ã‚’ *ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«å¼·åˆ¶*ã€‚  
* **å‡ºåŠ›ã¯ãŸã ã® `.ts`**  
  â†’ PR diff ãŒèª­ã¿ã‚„ã™ãã€ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§è»½é‡åŒ–ã‚‚å¯èƒ½ îˆ€citeîˆ‚turn1search2îˆ  

> ã¾ã¨ã‚ã‚‹ã¨ã€*ã€ŒOpenAPI ã‚’çœŸã®å˜ä¸€æƒ…å ±æºã«ã—ã¤ã¤ Zod ã®å®Ÿè¡Œæ™‚å®‰å…¨ã‚‚äº«å—ã€*  
> ãã‚“ãªå®Ÿè£…ã«ãªã‚‹ã®ãŒ **openapi-zod-client** ã§ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/4 22:39:22*

@hey-api/client-fetch ã‚’ä½¿ã£ãŸå ´åˆã¨ openapi-zod-client ã‚’ä½¿ã£ãŸå ´åˆã®é•ã„ã‚’æ•™ãˆã¦æ¬²ã—ã„

import { createClient, createConfig } from "@hey-api/client-fetch";

export const api = createClient(
  createConfig({
    baseUrl: "http://localhost:3000",
    throwOnError: true,         // ã“ã“ã‚’ false ã«ã™ã‚Œã° Result å‹ã¸
  }),
);

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/4 22:40:35*

### TL;DR  
| é …ç›® | **@hey-api/client-fetch** | **openapi-zod-client** |
| --- | --- | --- |
| ç”Ÿæˆãƒ„ãƒ¼ãƒ« | `openapi-ts`ï¼ˆHey APIå…¬å¼ï¼‰ | å˜ä½“ CLI |
| ç”Ÿæˆç‰© | **Fetch** ãƒ©ãƒƒãƒ‘ + å‹ï¼SDK ä¸€å¼ | **Axiosï¼‹Zodios** ãƒ©ãƒƒãƒ‘ 1 ãƒ•ã‚¡ã‚¤ãƒ« |
| ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼ | âœ… *ä»»æ„*ï¼ˆ`sdk.validator: "zod" | "ajv"` ã§ç”Ÿæˆï¼‰ îˆ€citeîˆ‚turn9search4îˆ | âœ… *å¸¸æ™‚*ï¼ˆZod ã§ request / response ã‚’ `parse`ï¼‰ îˆ€citeîˆ‚turn6search0îˆ |
| ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° | `throwOnError` ãƒ•ãƒ©ã‚°ã§ **throw** ã‹ **Result å‹** ã‚’é¸æŠ îˆ€citeîˆ‚turn9search1îˆ | å¤±æ•—æ™‚ã¯ `ZodiosError`ï¼ˆAxios errorï¼‰ã‚’ **throw** |
| HTTP å®Ÿè£… | ãƒã‚¤ãƒ†ã‚£ãƒ– Fetchï¼ˆpolyfill ä¸è¦ï¼‰ | Axiosï¼ˆEdge/Deno ã§ä½¿ã†å ´åˆã¯ polyfill è¦ï¼‰ |
| ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º | ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ»ãƒãƒ³ãƒ‰ãƒ«è¨­å®šãŒè±Šå¯Œï¼ˆãƒ˜ãƒƒãƒ€æ³¨å…¥ãƒ»å†è©¦è¡Œãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚¿è¿½åŠ ï¼‰ îˆ€citeîˆ‚turn9search2îˆ | ç”Ÿæˆãƒ†ãƒ³ãƒ—ãƒ¬ã‚’ä¸Šæ›¸ãå¯ï¼å‡ºåŠ›ã¯ãŸã ã® TS |
| ãƒªãƒã‚¸ãƒˆãƒªè¦æ¨¡ | Hey API æœ¬ä½“ãŒæ´»ç™ºï¼ˆè¤‡æ•°ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’åŒæ—¥ãƒªãƒªãƒ¼ã‚¹ï¼‰ îˆ€citeîˆ‚turn9search1îˆ | OSS 1äººé–‹ç™ºãƒ»æ›´æ–°ã¯ç·©ã‚„ã‹ï¼ˆé€±æ¬¡ DL ã¯æ•°åƒï¼‰ îˆ€citeîˆ‚turn6search0îˆ |
| å…¸å‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ | **BFF ã‚„ Next.js/Remix** ãªã© Fetch æ–‡åŒ–ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ | **å‹å®‰å…¨ + å®Ÿè¡Œæ™‚å®‰å…¨ã‚’æœ€å„ªå…ˆ** ã™ã‚‹ SPA / Node ãƒãƒƒãƒ |

---

## 1. ç”Ÿæˆã‚¹ãƒ†ãƒƒãƒ—ã®ã‚¤ãƒ¡ãƒ¼ã‚¸

```bash
# hey-api ç‰ˆ
npx @hey-api/openapi-ts -i openapi.yaml -o src/api -c @hey-api/client-fetch

# zod ç‰ˆ
pnpx openapi-zod-client openapi.yaml -o src/api.gen.ts
```

*hey-api* ã¯è¤‡æ•°ãƒ•ã‚©ãƒ«ãƒ€ï¼ˆschemas, operations, client ãªã©ï¼‰ãŒç”Ÿæˆã•ã‚Œã€  
*zod-client* ã¯ 1 ãƒ•ã‚¡ã‚¤ãƒ«ã« **Zod schema + Endpoints + Client factory** ãŒã¾ã¨ã¾ã‚Šã¾ã™ã€‚

---

## 2. å‘¼ã³å‡ºã—ã‚³ãƒ¼ãƒ‰æ¯”è¼ƒ

### @hey-api/client-fetch

```ts
import { createClient, createConfig } from "@hey-api/client-fetch";
import type { paths } from "./api"; // openapi-ts ãŒåãå‹

const api = createClient(
  createConfig({ baseUrl: "/api", throwOnError: false })  // false âŸ¹ Result å‹
);

// Result ãƒ‘ã‚¿ãƒ¼ãƒ³
const res = await api["/users/{id}"].get({ params: { path: { id } } });

if (res.ok) {
  console.log(res.data.name);        // å‹å®‰å…¨
} else {
  switch (res.error.status) {        // 4xx/5xx ã‚‚åˆ—æŒ™ã•ã‚Œã¦ã„ã‚‹
    case 404:
      /* ... */
  }
}
```

* `throwOnError: true` ã«ã™ã‚‹ã¨ `FetchError` ã‚’ **throw**ã€‚  
* `sdk.validator: "zod"` ã‚’ä»˜ã‘ã¦ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã¨ **Zod ã§ response ã‚’æ¤œè¨¼**ï¼ˆå¤±æ•—æ™‚ã¯ throwï¼‰ã€‚ îˆ€citeîˆ‚turn9search4îˆ  

---

### openapi-zod-clientï¼ˆZodiosï¼‰

```ts
import { createApiClient } from "./api.gen";       // 1 ãƒ•ã‚¡ã‚¤ãƒ«
import { ZodiosError } from "@zodios/core";

const api = createApiClient("/api");

try {
  const user = await api.getUser({ params: { id } });  // User å‹
  console.log(user.name);
} catch (e) {
  if (e instanceof ZodiosError) {
    switch (e.response?.status) {          // ã“ã“ã‚‚å‹æ¨è«–ãŒåŠ¹ã
      case 404:
        /* ... */
    }
  }
}
```

* **ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚‚ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚‚ Zod ã§ `parse`** ã•ã‚Œã‚‹ãŸã‚ã€  
  ã‚µãƒ¼ãƒãƒ¼ãŒä»•æ§˜ã¨ã‚ºãƒ¬ãŸ JSON ã‚’è¿”ã™ã¨å®Ÿè¡Œæ™‚ã«å³ catchã€‚ îˆ€citeîˆ‚turn6search0îˆ  

---

## 3. ã©ã¡ã‚‰ã‚’é¸ã¶ï¼Ÿåˆ¤æ–­ãƒã‚¤ãƒ³ãƒˆ

| åˆ¤æ–­è»¸ | ã“ã‚“ãªå ´åˆã¯ **@hey-api/client-fetch** | ã“ã‚“ãªå ´åˆã¯ **openapi-zod-client** |
| --- | --- | --- |
| **å®Ÿè¡Œç’°å¢ƒ** | Deno / Cloudflare Workers / Edge runtime ã§ Axios ã‚’é¿ã‘ãŸã„ | Node / Browser ã§ Axios OKã€ã¾ãŸã¯ interceptors ãŒæ¬²ã—ã„ |
| **å‹ã ã‘ã§ååˆ†ï¼Ÿ** | ã€Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚‚ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚‚ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨åŒãƒªãƒã‚¸ãƒˆãƒªã ã‹ã‚‰ **å‹ã‚ºãƒ¬ã¯ç¨€**ã€ | ã€Œåˆ¥ãƒãƒ¼ãƒ  API ãªã®ã§ **ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼å¿…é ˆ**ã€ |
| **ç”Ÿæˆã®ç²’åº¦** | ãƒ•ã‚©ãƒ«ãƒ€åˆ†å‰²ã—ã¦ **ãƒ„ãƒªâ€•ã‚·ã‚§ã‚¤ã‚¯** ï¼†ãƒ‘ã‚¹å˜ä½ import ã—ãŸã„ | 1 ãƒ•ã‚¡ã‚¤ãƒ«å®Œçµã§ä¾å­˜ãŒå°‘ãªã„æ–¹ãŒå¬‰ã—ã„ |
| **ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä½“åˆ¶** | ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚„å¤šè¨€èª SDK ã‚’å«ã‚ã¦ **å…¬å¼ã‚µãƒãƒ¼ãƒˆé‡è¦–** | OSS ã§ã‚·ãƒ³ãƒ—ãƒ«ã«å®Œçµã—ãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å¥½ã‚€ |
| **ã‚¨ãƒ©ãƒ¼ API** | Result ãƒ‘ã‚¿ãƒ¼ãƒ³ or throw ã‚’**ãƒ•ãƒ©ã‚°ä¸€ç™ºã§åˆ‡æ›¿**ã—ãŸã„ | Zodios ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ throw ã§ååˆ†ï¼è‡ªå‰ Result ãƒ©ãƒƒãƒ‘ã‚’è¢«ã›ãŸã„ |

---

## 4. ä½µç”¨ã‚‚ã§ãã‚‹

å¤§è¦æ¨¡ãƒ¢ãƒãƒ¬ãƒã§ **ç¤¾å†… API** ã¯ â€œhey-api + Fetchâ€ã€  
**å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹** ã¯ â€œzod-client + Axiosâ€ ã¨åˆ†ã‘ã‚‹ä¾‹ã‚‚ã‚ã‚Šã¾ã™ã€‚

```text
packages/
â”œâ”€ api-internal/   # openapi-ts + client-fetch
â””â”€ api-stripe/     # openapi-zod-client  (runtime validationé‡è¦–)
```

---

### ã¾ã¨ã‚

* **Fetch æ´¾ & ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚’ç´°ã‹ãåˆ¶å¾¡ã—ãŸã„ â†’ Hey APIï¼ˆclient-fetchï¼‰**  
* **Zod ã§ã‚¬ãƒƒãƒãƒªå®Ÿè¡Œæ™‚ä¿è¨¼ã‚’å–ã‚ŠãŸã„ â†’ openapi-zod-client**  

ã©ã¡ã‚‰ã‚‚ **Result å‹ or ä¾‹å¤–** ã®äºŒæŠã§ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã§ãã‚‹ãŸã‚ã€  
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® *é‹ç”¨æ–¹é‡ï¼ˆFetch vs Axios / å‹ã ã‘ vs ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼ï¼‰* ã«åˆã‚ã›ã¦é¸ã¶ã®ãŒãƒ™ã‚¹ãƒˆã§ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/4 22:45:00*

@hey-api/client-fetchã§ã€throwå¼ã«ã—ãŸå®Ÿè£…ä¾‹ã¯ï¼Ÿ

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/4 22:46:40*

## `@hey-api/client-fetch` ã‚’ **â€œthrow å¼â€** ã§ä½¿ã†æœ€å°æ§‹æˆ

> ãƒã‚¤ãƒ³ãƒˆã¯ **â‘  `throwOnError: true` ã‚’æ¸¡ã™ (ãƒ©ãƒ³ã‚¿ã‚¤ãƒ )** ã¨  
> **â‘¡ ãƒ¡ã‚½ãƒƒãƒ‰ã® 1st ã‚¸ã‚§ãƒãƒªãƒƒã‚¯ã‚’ `true` ã«ã™ã‚‹ (ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«)** ã§ã™ã€‚  

```ts
// apiClient.ts ------------------------------------------------------------
import { createClient, createConfig, type FetchError } from "@hey-api/client-fetch";
import type { paths } from "./openapi.gen";   // openapi-ts ãŒåã„ãŸå‹

export const api = createClient(
  createConfig({
    baseUrl: "http://localhost:3000",
    throwOnError: true,              // â† â‘  ã“ã“ã§ â€œå¤±æ•—ãªã‚‰ throwâ€ ã‚’æœ‰åŠ¹åŒ–
    headers: { "X-Requested-With": "frontend" },
  }),
);
```

*`createConfig().throwOnError` ãŒ **ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®æŒ™å‹•** ã‚’æ±ºã‚ã‚‹ã€‚  
0.11 ç³»ä»¥é™ã¯ **å‹å´** ã§ã‚‚ â€œæŠ•ã’ã‚‹â€ ã“ã¨ã‚’æ˜ç¤ºã™ã‚‹ãŸã‚ã«ã€  
å„ãƒ¡ã‚½ãƒƒãƒ‰ã® **1 ç•ªç›®ã®ã‚¸ã‚§ãƒãƒªãƒƒã‚¯** ãŒ `ThrowOnError extends boolean` ã«ãªã‚Šã¾ã—ãŸ* îˆ€citeîˆ‚turn7search3îˆ

---

### å‘¼ã³å‡ºã—ä¾‹ : `GET /users/{id}`

```ts
import { api } from "@/apiClient";
import type { components } from "./openapi.gen";

// --- æˆåŠŸæ™‚ 200 ã®å‹ï¼ˆopenapi.yaml â†’ TS å‹ï¼‰ -----------------------------
type User = components["schemas"]["User"];

// --- å¤±æ•—æ™‚ 404 ã®å‹ ------------------------------------------------------
type NotFound = components["schemas"]["Error404"];

// ---------- UI / React Hook å´ --------------------------------------------
export async function loadUser(id: string) {
  try {
    //           â–¼ ThrowOnError ã‚’ true ã«
    const user = await api["/users/{id}"].get<true, User, NotFound>({
      params: { path: { id } },
    });

    return user;                // user ã¯ User å‹
  } catch (e) {
    // e ã¯ FetchError<NotFound> å‹ï¼ˆã‚¸ã‚§ãƒãƒªãƒƒã‚¯ã§æ¨è«–ãŒåŠ¹ãï¼‰
    const err = e as FetchError<NotFound>;

    switch (err.status) {       // 404, 400, 500 â€¦ ãŒåˆ—æŒ™å‹ã§è£œå®Œ
      case 404:
        console.info("ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“", err.data);
        break;
      default:
        console.error("æƒ³å®šå¤–ã®ã‚¨ãƒ©ãƒ¼", err);
    }
    throw err;                  // ã•ã‚‰ã«ä¸Šä½ã§ ErrorBoundary ã«æµã™ãªã©
  }
}
```

* `FetchError<D>` ã«ã¯  
  * **`status`** â€• HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹  
  * **`data`** â€• OpenAPI ã§å®£è¨€ã—ãŸã‚¨ãƒ©ãƒ¼ãƒœãƒ‡ã‚£å‹  
  ãŒå…¥ã‚‹ã€‚  
* catch ã®ç¶²ç¾…æ€§ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒä¿è¨¼ï¼ˆ`switch(err.status)` ã« exhaustive-check ãŒåŠ¹ãï¼‰ã€‚  

---

## ã‚ˆãã‚ã‚‹ FAQ

| ç–‘å• | å›ç­” |
| --- | --- |
| **ã€Œã‚¸ã‚§ãƒãƒªãƒƒã‚¯ã‚’çœç•¥ã™ã‚‹ã¨ï¼Ÿã€** | `ThrowOnError` ã®æ—¢å®šã¯ `false`ã€‚<br>ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã¯é€šã‚Šã¾ã™ãŒã€å¤±æ•—æ™‚ã¯ `Promise<{ error: â€¦ }>` **è¿”å´å¼** ã«ãªã‚Š throw ã—ã¾ã›ã‚“ã€‚ |
| **Result å‹ã«æˆ»ã›ã‚‹ï¼Ÿ** | `throwOnError: false` ã«ã—ã¦ `const res = await â€¦` ã§å–ã‚‹ã€‚<br>å¿…è¦ãªã‚‰ `api["/users/{id}"].get<false, User, NotFound>()` ã¨ `false` ã‚’å…¥ã‚Œã¦ã‚‚ OKã€‚ |
| **TanStack Query ã§ä½¿ã†** | `queryFn: () => api["/users/{id}"].get<true, User, NotFound>({ â€¦ })`<br>â†’ å¤±æ•—ã¯ onError ã« `FetchError` ãŒé£›ã³ã¾ã™ã€‚ |
| **Axios ã§æ›¸ããŸã„** | Hey API å…¬å¼ã® `@hey-api/client-axios` ã‚‚åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ `throwOnError` å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚ |

---

## ã¾ã¨ã‚

1. **`createConfig({ throwOnError: true })`** ã§ â€œãƒ©ãƒ³ã‚¿ã‚¤ãƒ : throwâ€ ã‚’æœ‰åŠ¹åŒ–ã€‚  
2. **ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—ã‚’ `<true, Success, Error>`** ã§å‹ä»˜ã‘ã™ã‚Œã°  
   * æˆåŠŸæ™‚ã¯ **ç´”ç²‹ãªãƒ‡ãƒ¼ã‚¿å‹**  
   * å¤±æ•—æ™‚ã¯ **`FetchError<ErrorBody>`** ãŒ `catch` ã«æ¥ã‚‹ã€‚  
3. `switch(err.status)` ã§ **HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã”ã¨ã«å‹å®‰å…¨ã«åˆ†å²**ã€‚  

ä»¥ä¸Šã§ *@hey-api/client-fetch* ã§ã‚‚ **ä¾‹å¤–ã‚¹ã‚¿ã‚¤ãƒ«** ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒ  
ç°¡æ½”ï¼†å‹å®‰å…¨ã«å®Ÿè£…ã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/4 22:47:51*

ã•ã‚‰ã« Zod ã‚’é©å¿œã•ã›ãŸå ´åˆã¯ï¼Ÿ

https://heyapi.dev/openapi-ts/plugins/zod

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/4 22:49:18*

ä»¥ä¸‹ã¯ **ã€Œ@hey-api/client-fetch Ã— throwOnError:true ï¼‹ Zod ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ï¼ˆsdk.validator:trueï¼‰ã€** ã‚’çµ„ã¿åˆã‚ã›ãŸã¨ãã®ã€ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã€œãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä¾‹ã¾ã§ã‚’ä¸€æ°—é€šè²«ã§ç¤ºã—ãŸã‚‚ã®ã§ã™ã€‚  

---

## 1. openapi-ts è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

```ts
// openapi-ts.config.ts  (ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›´ä¸‹)
import { defaultPlugins } from "@hey-api/openapi-ts";

export default {
  input : "./openapi.yaml",      // <- ã‚ãªãŸã® OpenAPI
  output: "./src/__generated__", // ç”Ÿæˆç‰©ã®ç½®ãå ´
  plugins: [
    ...defaultPlugins,           // å‹å®šç¾©ãªã©æ—¢å®šãƒ—ãƒ©ã‚°ã‚¤ãƒ³
    "@hey-api/client-fetch",     // Fetch ãƒ™ãƒ¼ã‚¹ã® SDK
    "zod",                       // â˜… Zod ã‚¹ã‚­ãƒ¼ãƒã‚’ç”Ÿæˆ
    {
      /* SDK ã¸ Zod ãƒãƒªãƒ‡ãƒ¼ã‚¿ã‚’æ³¨å…¥ */
      name: "@hey-api/sdk",
      validator: true,           // â˜… ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ z.parse ã§æ¤œè¨¼
    },
  ],
} as const;
```

*`validator:true` ã‚’ä»˜ã‘ã‚‹ã ã‘ã§ã€ç”Ÿæˆ SDK ãŒ **è‡ªå‹•ã§ request / response ã‚’ Zod ã§æ¤œè¨¼** ã—ã¦ãã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ îˆ€citeîˆ‚turn4search0îˆã€‚*

---

## 2. ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ

```bash
pnpm dlx @hey-api/openapi-ts            # 1å›ç›®ã¯ npx ã§ã‚‚ OK
```

ç”Ÿæˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯ä¸»ã« 3 ã¤ã®ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆãŒå…¥ã‚Šã¾ã™ï¼š

| ãƒ•ã‚¡ã‚¤ãƒ« | ä¸»ãªå½¹å‰² |
| --- | --- |
| **schemas/\*.ts** | OpenAPI ã®å„ `schema` â†’ `z.object()` / `z.union()` ãªã© |
| **sdk/client-fetch.ts** | `createClient()` ã‚’è¼¸å‡ºã™ã‚‹ Fetch SDK |
| **types.ts** | OpenAPI â†’ å‹å®šç¾© (`components["schemas"]["User"]` ãªã©) |

---

## 3. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®åˆæœŸåŒ–ï¼ˆthrow å¼ï¼‰

```ts
// api.ts
import { createClient, FetchError } from "@/__generated__/sdk/client-fetch";

export const api = createClient({
  baseUrl: "/api",
  throwOnError: true,     // â˜… HTTP 4xx/5xx ã¯ FetchError ã¨ã—ã¦ throw
});
```

---

## 4. å‘¼ã³å‡ºã—ä¾‹ã¨ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```ts
import { api } from "@/api";
import { ZodError } from "zod";

/** User ã‚¹ã‚­ãƒ¼ãƒã®å‹ã‚’ãã®ã¾ã¾å†åˆ©ç”¨ */
import { zUser } from "@/__generated__/schemas";
type User = typeof zUser._type;  // = z.infer<typeof zUser>

export async function loadUser(id: string) {
  try {
    // ThrowOnError=true â†’ æˆ»ã‚Šå€¤ã¯ã€ŒæˆåŠŸæ™‚ 200 ã®ã¿ã€
    const user = await api["/users/{id}"].get<true, 200>({   // â‘ 
      params: { path: { id } },
    });
    console.log("å–å¾—æˆåŠŸ", user);      // user ã¯å®Œå…¨ã« Zod æ¤œè¨¼æ¸ˆã¿ã® User å‹

  } catch (e) {
    /* ----------- â‘¡ Zod æ¤œè¨¼ã‚¨ãƒ©ãƒ¼ ----------- */
    if (e instanceof ZodError) {
      // ã‚µãƒ¼ãƒãƒ¼ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒä»•æ§˜ã¨é£Ÿã„é•ã£ã¦ã„ãŸ
      console.error("ã‚¹ã‚­ãƒ¼ãƒä¸æ•´åˆ", e.issues);
      return;
    }

    /* ----------- â‘¢ HTTP ã‚¨ãƒ©ãƒ¼ (FetchError) ----------- */
    if (e instanceof FetchError) {
      switch (e.status) {                // 400/401/404/500... ãŒè£œå®Œã•ã‚Œã‚‹
        case 404:
          console.warn("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å­˜åœ¨ã—ã¾ã›ã‚“");
          return;
        case 401:
          console.warn("å†ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„");
          return;
        default:
          console.error("æƒ³å®šå¤–ã® HTTP ã‚¨ãƒ©ãƒ¼", e);
      }
    }

    /* ----------- â‘£ äºˆæœŸã—ãªã„ä¾‹å¤– ----------- */
    throw e;   // ErrorBoundary ãªã©ã¸
  }
}
```

### æµã‚Œã‚’æ•´ç†

1. **â‘ ** å‘¼ã³å‡ºã—æ™‚ã« **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿** ãŒ Zod ã§ `parse` ã•ã‚Œã‚‹  
   â†’ ä¸æ­£ãª `id` ã‚’æ¸¡ã™ã¨ *ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‰* ã« `ZodError`.
2. **â‘¡** ãƒ¬ã‚¹ãƒãƒ³ã‚¹ JSON ãŒã‚¹ã‚­ãƒ¼ãƒã«åˆã‚ãªã‘ã‚Œã° `ZodError` ãŒ throwã€‚  
   â†’ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒã‚°ã‚’å³åº§ã«æ¤œçŸ¥ã€‚
3. **â‘¢** HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ 4xx/5xx ãªã‚‰ `FetchError` ãŒ throwã€‚  
   â†’ `e.status` ã¨ **OpenAPI ã§å®£è¨€ã—ãŸã‚¨ãƒ©ãƒ¼ã‚¹ã‚­ãƒ¼ãƒ** (`e.data`) ãŒå‹ä»˜ãã€‚  
4. **â‘£** ãã‚Œä»¥å¤–ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦ä¸Šä½ã¸ä¼æ¬ã€‚

---

## 5. ä»–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã®çµ±åˆä¾‹ï¼ˆTanStack Queryï¼‰

```ts
import { useQuery } from "@tanstack/react-query";
import { api } from "@/api";

export const useUser = (id: string) =>
  useQuery({
    queryKey: ["user", id],
    queryFn : () => api["/users/{id}"].get<true, 200>({ params: { path: { id } } }),
    retry   : false,                         // ZodError ã‚‚ catch ã•ã‚Œã¦ onError ã¸
  });
```

onError ã§ã¯ `error instanceof ZodError` / `FetchError` ã§åˆ†å²ã§ãã¾ã™ã€‚

---

## 6. openapi-zod-client ã¨ã®é•ã„ï¼ˆãŠã•ã‚‰ã„ï¼‰

| è»¸ | **@hey-api/client-fetchï¼‹Zod** | **openapi-zod-client** |
| --- | --- | --- |
| HTTP å®Ÿè£… | **Fetch** (ãƒãƒªãƒ•ã‚£ãƒ«ç„¡ã—) | Axiosï¼‹Zodios |
| ç”Ÿæˆç‰© | *ãƒ•ã‚©ãƒ«ãƒ€åˆ†å‰²*ï¼ˆtypes / schemas / sdkï¼‰ | ã»ã¼ 1 ãƒ•ã‚¡ã‚¤ãƒ« |
| ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ | `sdk.validator:true` ã§è‡ªå‹• (`ZodError` ã‚’ throw) | å¸¸æ™‚ z.parse |
| ã‚¨ãƒ©ãƒ¼å‹ | `FetchError` (HTTP) / `ZodError` (æ¤œè¨¼) | `ZodiosError` |
| Edge/Deno äº’æ› | â—ï¼ˆFetchï¼‰ | â–³ï¼ˆAxios ãƒãƒªãƒ•ã‚£ãƒ«è¦ï¼‰ |

---

### ã¾ã¨ã‚

* **è¨­å®šã¯ `plugins: ['zod']` ï¼‹ `sdk.validator:true` ã ã‘**ã€‚  
* ç”Ÿæˆ SDK ãŒ *ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‰å¾Œã§ Zod æ¤œè¨¼* ã‚’è‡ªå‹•å®Ÿè¡Œã€‚  
* UI ã§ã¯ **`ZodError` ã¨ `FetchError` ã‚’å‹å®‰å…¨ã«ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**ã€‚  
* Axios ãŒä¸è¦ã§ Edge Runtime ã§ã‚‚å‹•ã‹ã—ãŸã„å ´åˆã«ç‰¹ã«æœ‰åŠ¹ã§ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/4 22:51:13*

@hey-api/client-fetchï¼‹Zod ã®ã»ã†ãŒ openapi-zod-client ã‚ˆã‚Šã‚‚ã‚ˆããªã„ã‹ï¼Ÿ

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/4 22:51:57*

### â€œã©ã¡ã‚‰ãŒ **è‰¯ã„** ã‹ï¼Ÿâ€ã¯ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹æ¬¡ç¬¬  
ä¸¡è€…ã¨ã‚‚ **OpenAPI â†’ å‹ â†’ Zod å®Ÿè¡Œæ™‚æ¤œè¨¼ â†’ SDK** ã‚’è‡ªå‹•ç”Ÿæˆã§ãã¾ã™ãŒã€  
è¨­è¨ˆå“²å­¦ã‚‚ç”Ÿæˆç‰©ã®å½¢ã‚‚ç•°ãªã‚Šã¾ã™ã€‚å„ªå…ˆã—ãŸã„è»¸ã‚’ã¯ã£ãã‚Šæ±ºã‚ã‚‹ã¨ç­”ãˆãŒå‡ºã¾ã™ã€‚

| åˆ¤æ–­è»¸ | **@hey-api/client-fetch ï¼‹ Zod**&lt;br&gt;(*openapi-ts + client-fetch plugin + `validator:true`*) | **openapi-zod-client** |
|---|---|---|
| **HTTP å®Ÿè£…** | ãƒã‚¤ãƒ†ã‚£ãƒ– `fetch` ï¼ˆãƒãƒªãƒ•ã‚£ãƒ«ä¸è¦ï¼‰ | Axios ï¼‹ Zodios |
| **ç”Ÿæˆç‰©ã®æ§‹é€ ** | `types/`, `schemas/`, `sdk/` ã® **3 éšå±¤**&lt;br&gt;ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ï¼**ãƒ„ãƒªãƒ¼ã‚·ã‚§ã‚¤ã‚¯ã—ã‚„ã™ã„** | **1 ãƒ•ã‚¡ã‚¤ãƒ«å®Œçµ**ï¼ˆã‚¹ã‚­ãƒ¼ãƒï¼‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ |
| **ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼** | `validator:true` ã‚’ä»˜ã‘ãŸã¨ãã ã‘&lt;br&gt;â†’ `ZodError` or `FetchError` ãŒ **throw** îˆ€citeîˆ‚turn0search5îˆ | å¸¸æ™‚ `z.parse` å®Ÿè¡Œã€‚å¤±æ•—æ™‚ã¯ `ZodiosError` ã‚’ **throw** îˆ€citeîˆ‚turn0search0îˆ |
| **ã‚¨ãƒ©ãƒ¼ API** | `throwOnError` ãƒ•ãƒ©ã‚°ã§&lt;br&gt;  â˜‘ï¸ **throw å¼**&lt;br&gt;  â˜ Result å‹ï¼ˆ`{ ok, data | error }`ï¼‰ã‚’é¸æŠå¯ | å¸¸ã« throwã€‚Result ã«å¤‰ãˆãŸã„å ´åˆã¯è‡ªå‰ãƒ©ãƒƒãƒ‘ |
| **Edge / Deno äº’æ›** | â—ï¼ˆFetch ãªã®ã§ãã®ã¾ã¾å‹•ãï¼‰ | â–³ï¼ˆAxios ã‚’ polyfill ã™ã‚‹ã‹åˆ¥ fetcher ã‚’å®Ÿè£…ï¼‰ |
| **ãƒ“ãƒ«ãƒ‰ & è£œå®Œé€Ÿåº¦** | åˆ†å‰²æ§‹é€ ã®ãŠã‹ã’ã§ **é€Ÿã„**ï¼ˆtsc 4 ç§’ç¨‹åº¦ã®äº‹ä¾‹ï¼‰ îˆ€citeîˆ‚turn2search0îˆ | å¤§è¦æ¨¡ spec ã§ã¯ 1 ãƒ•ã‚¡ã‚¤ãƒ«ãŒè‚¥å¤§ â†’ è£œå®Œé…å»¶ãƒ»tsc 15 ç§’è¶…ã®å ±å‘Šã‚ã‚Š îˆ€citeîˆ‚turn2search0îˆ |
| **ãƒ¡ãƒ³ãƒ†ä½“åˆ¶** | â— Hey API ç¤¾ã®æœ¬ä½“ãƒªãƒã‚¸ãƒˆãƒªã§**è¤‡æ•°ãƒ¡ãƒ³ãƒ†ãƒŠ**ã€‚Zod plugin ã¯**Î²**è¡¨è¨˜ã ãŒæ¯æœˆã‚³ãƒŸãƒƒãƒˆã‚ã‚Š îˆ€citeîˆ‚turn1search1îˆ‚turn0search5îˆ | â—‹ å€‹äººãƒ¡ãƒ³ãƒ†ï¼ˆ@astahmerï¼‰ã ãŒ **æœˆ1 ãƒªãƒªãƒ¼ã‚¹**ãƒšãƒ¼ã‚¹ã§ç¶™ç¶šä¸­ îˆ€citeîˆ‚turn0search2îˆ |
| **npm DL (é€±)** | ç´„ 19 ä¸‡ä»¶ îˆ€citeîˆ‚turn3search1îˆ | ç´„ 8 ä¸‡ä»¶ îˆ€citeîˆ‚turn3search0îˆ |

---

## ã©ã¡ã‚‰ãŒ **å‘ã„ã¦ã„ã‚‹** ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ï¼Ÿ

### @hey-api/client-fetch ï¼‹ Zod ãŒå„ªä½
1. **Edge / Cloudflare Workers / Deno** ãªã© Fetch ãƒã‚¤ãƒ†ã‚£ãƒ–ç’°å¢ƒã€‚
2. ã€Œ**ãƒªãƒã‚¸ãƒˆãƒªåŒå±…**ã§ API ãƒãƒ¼ãƒ ï¼ãƒ•ãƒ­ãƒ³ãƒˆãƒãƒ¼ãƒ ã€  
   â†’ å‹ã‚ºãƒ¬ã¯ CI ã§æ¤œçŸ¥ã§ãã‚‹ã®ã§ã€é–‹ç™ºä¸­ã¯ *throw* ã¨ *Result* ã‚’åˆ‡ã‚Šæ›¿ãˆãŸã„ã€‚
3. SDK ã‚’ **åˆ†å‰²ã‚¤ãƒ³ãƒãƒ¼ãƒˆ**ã—ã¦ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã‚’æœ€å°åŒ–ã—ãŸã„ã€‚
4. **CI ã§è‡ªå‹•å†ç”Ÿæˆ â†’ PR diff ã‚’ç´°ã‹ããƒ¬ãƒ“ãƒ¥ãƒ¼**ã—ãŸã„  
   ï¼ˆãƒ•ã‚©ãƒ«ãƒ€åˆ†å‰²ã®ã»ã†ãŒå·®åˆ†ãŒèª­ã¿ã‚„ã™ã„ï¼‰ã€‚

### openapi-zod-client ãŒå„ªä½
1. **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒå®Œå…¨ã«åˆ¥ãƒãƒ¼ãƒ ï¼åˆ¥è¨€èª**ã§ â€å¥‘ç´„é•åâ€ ãŒèµ·ããŒã¡ã€‚  
   â†’ ç”Ÿæˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒ **å¸¸æ™‚ Zod æ¤œè¨¼**ã—ã¦ãã‚Œã‚‹å®‰å¿ƒæ„Ÿã‚’é‡è¦–ã€‚
2. **è¨­å®šã‚¼ãƒ­ã§ 1 ãƒ•ã‚¡ã‚¤ãƒ«å®Œçµ**ã«ã—ãŸã„ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚„å°è¦æ¨¡ SPAã€‚
3. Axios ã—ã‹ä½¿ã£ã¦ãŠã‚‰ãšã€**ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ã§ãƒªãƒˆãƒ©ã‚¤ï¼èªè¨¼ãƒ˜ãƒƒãƒ€æŒ¿å…¥**ãªã©  
   Axios ã®ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã‚’æ´»ç”¨ã—ãŸã„ã€‚
4. **neverthrow / fp-ts** ãªã©é–¢æ•°å‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ Result ãƒ©ãƒƒãƒ‘ã‚’è‡ªå‰ã§è¢«ã›ã‚‹å‰æã€‚

---

## çµè«–ï¼ˆå®Ÿå‹™ã®è½ã¨ã—æ‰€ï¼‰

- **ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ or BFF å‹ã®ãƒ¢ãƒãƒ¬ãƒ**ãªã‚‰  
  â†’ ***@hey-api + Zod***ï¼šåˆ†å‰²ãƒ•ã‚¡ã‚¤ãƒ«ã§å·®åˆ†ãŒè¿½ã„ã‚„ã™ãã€Edge ç’°å¢ƒã‚‚æ¥½ã€‚
- **ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªï¼ç¤¾å¤– API ã‚’å©ããƒ•ãƒ­ãƒ³ãƒˆ**ãªã‚‰  
  â†’ ***openapi-zod-client***ï¼šå¸¸æ™‚ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼ã§â€œAPI å¥‘ç´„ã‚ºãƒ¬â€ã‚’å³æ¤œçŸ¥ã€‚
- **æ··åœ¨ã‚‚å¯**ï¼šç¤¾å†… API ã¯ Hey APIã€å¤–éƒ¨ Stripe ãªã©ã¯ zod-client ã«ã™ã‚‹ä¾‹ã‚‚ã‚ã‚‹ã€‚

è¦ã™ã‚‹ã«  
&gt; **ã€ŒFetch vs Axiosã€ã€Œåˆ†å‰² vs å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã€ã€ŒÎ²ã§ã‚‚æ´»å‹•çš„ vs å®Ÿç¸¾ã‚ã‚‹å€‹äºº OSSã€**  
&gt; ã©ã‚Œã‚’é‡è¦–ã™ã‚‹ã‹ã§ãƒ™ã‚¹ãƒˆã¯å¤‰ã‚ã‚‹ã€ã¨ã„ã†ã®ãŒç­”ãˆã§ã™ã€‚

---

# Lottieファイルが見つからない

Date: 2023-10-11

---

## 👤 User
*2023-10-11 18:32:33*

Lottie ファイルが見つからないみたい。どんなアプローチをすればいいかな？

public enum Constants {
    public enum LottieAnimation: String {
        case loading
    }
}

import SwiftUI
import Lottie
import EmomilCore

struct UploadProgressView: View {
    @Binding var progressPercentage: Int

    var body: some View {
        VStack(spacing: 16) {
            LottieView(animation: .named(Constants.LottieAnimation.loading.rawValue, subdirectory: "Lottie"))
              .playing(loopMode: .loop)

            ProgressView(value: Double(progressPercentage), total: 100.0) {
                Text(progressPercentage &gt; 0 ? "調査結果の送信中…" : "調査結果の準備中…")
                    .typographyStyle(.body2)
                    .frame(maxWidth: .infinity)
            } currentValueLabel: {
                Text("\(progressPercentage)%")
                    .typographyStyle(.caption1)
                    .frame(maxWidth: .infinity)
            }
            .tint(CoreAssets.Color.PrimaryBackgroundNoGradation.primaryBackgroundNoGradation100.swiftUIColor)

            Text("送信中です。このままお待ちください")
                .typographyStyle(.caption1)
                .frame(maxWidth: .infinity)
        }
        .padding(.all, 16)
    }
}

---

## 🤖 Assistant
*2023-10-11 18:33:14*

Lottieファイルが見つからない問題は、いくつかの一般的な原因があります。以下のアプローチを試して、問題の解決に役立ててください。

1. **ファイルの存在確認**:
   - 最初に、指定したサブディレクトリ内に`loading`という名前のLottieファイルが実際に存在するかどうかを確認してください。ファイルの拡張子も確認し、`.json` であることを確かめてください。

2. **パスとディレクトリの問題**:
   - `LottieView`の`animation`引数に渡しているパスが正しいかどうかを確認してください。特に、`subdirectory`パラメータが正しいディレクトリを指していることを確認する必要があります。ファイルがアプリのメインバンドルにある場合、サブディレクトリを指定する必要はないかもしれません。

3. **プロジェクト設定の確認**:
   - Lottieファイルがプロジェクトに正しく追加され、ビルドフェーズに含まれていることを確認してください。Xcodeでプロジェクトを開き、「Build Phases」セクションの「Copy Bundle Resources」でファイルがリストされていることを確認します。

4. **キャッシュの問題**:
   - まれに、Xcodeのキャッシュが原因でファイルが読み込まれないことがあります。この場合、プロジェクトをクリーンして（`Product` &gt; `Clean Build Folder`）、再ビルドしてみてください。

5. **コードのエラーチェック**:
   - `LottieView`を使用しているコードに誤りがないか確認してください。例えば、`LottieView`の初期化方法や、`playing`メソッドの使用方法などが正しいかどうかを再確認すると良いでしょう。

6. **ファイルの整合性の確認**:
   - Lottieファイル自体に問題がないかどうかを確認してください。ファイルが破損しているか、または互換性の問題がある可能性があります。別のLottieファイルでテストを行い、同じ問題が発生するかどうかを確認すると良いでしょう。

これらのステップを試しても問題が解決しない場合は、さらに具体的なエラーメッセージや、問題が発生している状況の詳細を提供することで、より適切な支援が可能になるかもしれません。

---

## 👤 User
*2023-10-11 18:33:52*

こんな感じのイニシャライザが用意されているみたい。

    /// Loads an animation model from a bundle by its name. Returns `nil` if an animation is not found.
    ///
    /// - Parameter name: The name of the json file without the json extension. EG "StarAnimation"
    /// - Parameter bundle: The bundle in which the animation is located. Defaults to `Bundle.main`
    /// - Parameter subdirectory: A subdirectory in the bundle in which the animation is located. Optional.
    /// - Parameter animationCache: A cache for holding loaded animations. Defaults to `LottieAnimationCache.shared`. Optional.
    ///
    /// - Returns: Deserialized `LottieAnimation`. Optional.
    public static func named(_ name: String, bundle: Bundle = Bundle.main, subdirectory: String? = nil, animationCache: Lottie.AnimationCacheProvider? = LottieAnimationCache.shared) -&gt; Lottie.LottieAnimation?

    /// Loads an animation from a specific filepath.
    /// - Parameter filepath: The absolute filepath of the animation to load. EG "/User/Me/starAnimation.json"
    /// - Parameter animationCache: A cache for holding loaded animations. Defaults to `LottieAnimationCache.shared`. Optional.
    ///
    /// - Returns: Deserialized `LottieAnimation`. Optional.
    public static func filepath(_ filepath: String, animationCache: Lottie.AnimationCacheProvider? = LottieAnimationCache.shared) -&gt; Lottie.LottieAnimation?

    ///    Loads an animation model from the asset catalog by its name. Returns `nil` if an animation is not found.
    ///    - Parameter name: The name of the json file in the asset catalog. EG "StarAnimation"
    ///    - Parameter bundle: The bundle in which the animation is located. Defaults to `Bundle.main`
    ///    - Parameter animationCache: A cache for holding loaded animations. Defaults to `LottieAnimationCache.shared` Optional.
    ///    - Returns: Deserialized `LottieAnimation`. Optional.
    public static func asset(_ name: String, bundle: Bundle = Bundle.main, animationCache: Lottie.AnimationCacheProvider? = LottieAnimationCache.shared) -&gt; Lottie.LottieAnimation?

---

## 🤖 Assistant
*2023-10-11 18:34:30*

提供されたイニシャライザに基づいて、Lottieファイルが見つからない問題を解決するためのいくつかのステップを以下に示します。

1. **アニメーションの名前を確認**:
    - Lottieファイルの名前が`Constants.LottieAnimation.loading.rawValue`で正しいことを確認してください。これは、ファイル名が"loading.json"（拡張子なし）であることを意味します。

2. **バンドルの確認**:
    - アニメーションファイルが`Bundle.main`に含まれていることを確認してください。もし別のバンドルにファイルがある場合、正しいバンドルを指定する必要があります。

3. **サブディレクトリの確認**:
    - もしアニメーションがサブディレクトリ内にある場合、そのディレクトリ名が正しいことを確認してください。また、サブディレクトリを指定する必要がない場合（ファイルがメインバンドルのルートにある場合など）は、`subdirectory`引数を`nil`にするか、省略してください。

4. **アセットカタログの使用**:
    - アニメーションがアセットカタログにある場合は、`LottieAnimation.named`の代わりに`LottieAnimation.asset`を使用してください。アセットカタログからアニメーションをロードするには、アニメーションの名前と、アニメーションが含まれているバンドルを指定します。

5. **ファイルパスの使用**:
    - アニメーションファイルへの具体的なファイルパスがわかっている場合は、`LottieAnimation.filepath`メソッドを使用することができます。このメソッドは絶対ファイルパスを要求します。

6. **キャッシュの確認**:
    - デフォルトでは、`LottieAnimationCache.shared`が使用されますが、特定の理由で別のキャッシュを使用したい場合は、`animationCache`パラメータを適切に設定してください。

これらの点を確認しても問題が解決しない場合は、デバッグを行い、ロードしようとしているアニメーションの名前、バンドル、サブディレクトリ、および使用されているメソッド（`named`、`filepath`、または`asset`）に関する追加情報を提供して、さらにトラブルシューティングを進めることができます。

---

## 👤 User
*2023-10-11 18:36:14*

マルチモジュール構成を取っていて別のバンドルかもしれない

---

## 🤖 Assistant
*2023-10-11 18:36:50*

マルチモジュール構成で作業している場合、特にSwift Package ManagerやCocoaPodsなどを使用している場合、リソースがメインバンドルではなく、特定のモジュールまたはフレームワークのバンドルに含まれている可能性が高いです。このケースでは、アニメーションをロードするために正しいバンドルを指定する必要があります。

以下の手順に従って、正しいバンドルを指定してください。

1. **正しいバンドルの識別**:
    - アニメーションファイルが含まれている正しいバンドルを識別します。これは通常、アニメーションファイルを含むフレームワークまたはライブラリのバンドルです。

2. **バンドルの取得**:
    - Swiftの場合、フレームワーク内のバンドルを取得するには、通常、`Bundle.module`を使用します（Swift Package Managerでリソースを含むパッケージの場合）。もし`Bundle.module`が利用できない場合や、CocoaPodsを使用している場合は、フレームワークのバンドルを取得するために`Bundle(for: TypeOfAClassInsideTheFramework.self)`を使用することができます。

3. **Lottieアニメーションのロード**:
    - `LottieAnimation.named`、`LottieAnimation.filepath`、または`LottieAnimation.asset`メソッドを使用してアニメーションをロードする際に、`bundle`引数として2番目のステップで取得したバンドルを指定します。

例えば、フレームワークまたはライブラリ内の特定のクラス`AClassInsideTheFramework`があり、そのフレームワークのバンドルからアニメーションをロードしたい場合、以下のようにコードを記述できます。

```swift
let frameworkBundle = Bundle(for: AClassInsideTheFramework.self)
let animation = Lottie.LottieAnimation.named(Constants.LottieAnimation.loading.rawValue, bundle: frameworkBundle, subdirectory: "Lottie")
```

もしくは、Swift Package Managerを使用していて、`Bundle.module`が利用可能な場合は、以下のようにします。

```swift
let animation = Lottie.LottieAnimation.named(Constants.LottieAnimation.loading.rawValue, bundle: .module, subdirectory: "Lottie")
```

この方法で適切なバンドルを指定することで、Lottieアニメーションが正しくロードされるはずです。それでも問題が解決しない場合は、アニメーションファイルのパス、名前、およびそれが期待どおりのバンドル内に存在するかどうかを再確認してください。

---

## 👤 User
*2023-10-11 18:53:44*

なんかうまくいった。
大きすぎるから40x40のサイズにしてほしい

import SwiftUI
import Lottie
import EmomilCore

public struct UploadProgressView: View {
    @Binding var progressPercentage: Int

    public var body: some View {
        VStack(spacing: 16) {
            LottieView(animation: .named(Constants.LottieAnimation.loading.rawValue, bundle: .module))
              .playing(loopMode: .loop)

            ProgressView(value: Double(progressPercentage), total: 100.0) {
                Text(progressPercentage &gt; 0 ? "調査結果の送信中…" : "調査結果の準備中…")
                    .typographyStyle(.body2)
                    .frame(maxWidth: .infinity)
            } currentValueLabel: {
                Text("\(progressPercentage)%")
                    .typographyStyle(.caption1)
                    .frame(maxWidth: .infinity)
            }
            .tint(CoreAssets.Color.PrimaryBackgroundNoGradation.primaryBackgroundNoGradation100.swiftUIColor)

            Text("送信中です。このままお待ちください")
                .typographyStyle(.caption1)
                .frame(maxWidth: .infinity)
        }
        .padding(.all, 16)
    }
}

---

## 🤖 Assistant
*2023-10-11 18:54:27*

Lottieアニメーションのサイズを調整するには、`.frame(width:height:)` 修飾子を使用して、視覚的なビューコンポーネントのサイズを指定します。この修飾子は、`View`に適用され、指定された幅と高さでビューのサイズを明示的に設定します。

以下のように`LottieView`に`.frame`修飾子を追加して、アニメーションのサイズを40x40に設定できます。

```swift
import SwiftUI
import Lottie
import EmomilCore

public struct UploadProgressView: View {
    @Binding var progressPercentage: Int

    public var body: some View {
        VStack(spacing: 16) {
            LottieView(animation: .named(Constants.LottieAnimation.loading.rawValue, bundle: .module))
              .frame(width: 40, height: 40) // ここでサイズを指定します
              .playing(loopMode: .loop)

            ProgressView(value: Double(progressPercentage), total: 100.0) {
                Text(progressPercentage > 0 ? "調査結果の送信中…" : "調査結果の準備中…")
                    .typographyStyle(.body2)
                    .frame(maxWidth: .infinity)
            } currentValueLabel: {
                Text("\(progressPercentage)%")
                    .typographyStyle(.caption1)
                    .frame(maxWidth: .infinity)
            }
            .tint(CoreAssets.Color.PrimaryBackgroundNoGradation.primaryBackgroundNoGradation100.swiftUIColor)

            Text("送信中です。このままお待ちください")
                .typographyStyle(.caption1)
                .frame(maxWidth: .infinity)
        }
        .padding(.all, 16)
    }
}
```

この変更により、Lottieアニメーションは40x40ポイントのサイズで表示されます。`.frame` 修飾子はビューのサイズを変更しますが、コンテンツのサイズは変更しませんので、コンテンツ（この場合、アニメーション）がビューのサイズに合わせてスケーリングされることを確認してください。必要に応じて、`.aspectRatio(contentMode:)` 修飾子を使用して、コンテンツがフレーム内でどのようにフィットするかを制御できます（例： `.fit` または `.fill`）。

---

# Swiftのpackage修飾子解説

Date: 2024-09-24

---

## 👤 User
*2024-09-24 12:05:33*

Swiftでのpackage 修飾子について教えてほしい

---

## 🤖 Assistant
*2024-09-24 12:06:18*

Swiftの`package`修飾子は、Swiftパッケージ内で宣言することで、クラスや構造体、プロトコル、関数などにアクセスレベルの制御を提供する新しい機能です。具体的には、同じパッケージ内でのみアクセス可能なシンボルを定義することができ、モジュール間でのアクセス制御が柔軟になります。

### 1. `package`修飾子とは？
`package`修飾子は、Swift 5.9以降で導入されたアクセス制御キーワードで、以下のように使います。

```swift
package class MyPackageClass {
    // このクラスは同じパッケージ内でのみアクセス可能
}

package func myPackageFunction() {
    // この関数も同じパッケージ内でのみ使用可能
}
```

上記のように`package`修飾子を使うと、同じSwiftパッケージ内にある他のファイルやモジュールからはアクセスできますが、パッケージ外からはアクセスできません。

### 2. `package`修飾子の利点
- **アクセス制御の強化**: パッケージ内での利用に限定することで、意図しない外部の依存や誤用を防ぎます。パブリックAPIとして公開する必要のないクラスやメソッドを、パッケージ内部に閉じ込めることができます。
- **モジュールの設計改善**: 特にSwift Package Managerを使用してモジュールを分割する際、`internal`の代わりに`package`を使用することで、パッケージ内のみに留めておきたい部分を制御できます。

### 3. 他のアクセスレベルとの比較
`package`修飾子は他のアクセスレベル（`public`, `internal`, `fileprivate`, `private`）と似た形で機能しますが、よりパッケージという単位に特化しており、次のように整理できます。

- **`public`**: モジュール外部からもアクセス可能。
- **`internal`**: モジュール内でのみアクセス可能。
- **`package`**: 同じSwiftパッケージ内でのみアクセス可能（モジュール間でも可能）。
- **`fileprivate`**: 同じファイル内でのみアクセス可能。
- **`private`**: 同じ宣言内でのみアクセス可能。

### 4. 使いどころ
`package`修飾子は、特に大規模なプロジェクトでモジュールごとに機能を整理し、パッケージ内で完結させたい内部実装を隠すときに便利です。Swift Package Managerを使ったモジュール設計において、依存関係を管理しやすくする役割を果たします。

この修飾子を使うと、パッケージ内の依存性が明確になり、他のモジュールからの不適切な利用を防ぐことができます。

---

## 👤 User
*2024-09-24 12:06:41*

internal と package の違いは？

---

## 🤖 Assistant
*2024-09-24 12:07:30*

`internal` と `package` はどちらもアクセス制御を行うための修飾子ですが、その適用範囲に違いがあります。

### `internal`
- **適用範囲**: モジュール内（`module`）でのみアクセス可能。
- **特徴**: デフォルトのアクセスレベルです。`internal`修飾子が付けられたクラスやメソッドは、同じモジュール内のどこからでもアクセス可能です。

```swift
internal class MyClass {
    internal func myFunction() {
        // 同じモジュール内ではアクセス可能
    }
}
```

- **モジュール単位**: モジュールとは、1つのフレームワークやアプリケーションバイナリを指します。例えば、1つのiOSアプリやライブラリは1つのモジュールとして扱われます。
- **使用例**: フレームワーク内のほかのクラスやファイルにのみアクセスを許可したい場合。

### `package`
- **適用範囲**: Swiftパッケージ内（同じSwift Package Managerパッケージ内）でのみアクセス可能。
- **特徴**: Swift 5.9から導入された新しいアクセスレベルです。同じパッケージ内の他のモジュールやファイルからアクセスできる一方、パッケージ外からはアクセスできません。

```swift
package class MyClass {
    package func myFunction() {
        // 同じパッケージ内ではアクセス可能
    }
}
```

- **パッケージ単位**: パッケージとは、複数のモジュールを含むことができる単位で、Swift Package Managerを使って管理されます。モジュールごとの設計で、他のモジュールからのアクセスを制御したい場合に使用します。
- **使用例**: パッケージ内に複数のモジュールがあり、そのモジュール間で機能を共有したいが、パッケージ外には公開したくない場合。

### 違いのまとめ
- **`internal`**: モジュール内でのアクセスを制御する。モジュール全体でアクセス可能。
- **`package`**: パッケージ内でのアクセスを制御する。異なるモジュール間でも、同じパッケージ内であればアクセス可能。モジュールより広い範囲でのアクセス制御が可能。

### 具体例
例えば、あるパッケージ `MyPackage` に以下の2つのモジュール `ModuleA` と `ModuleB` が含まれているとします。

- **`internal`修飾子の場合**: `ModuleA` 内で定義された `internal` メソッドは `ModuleA` 内でのみアクセス可能で、`ModuleB` からはアクセスできません。
- **`package`修飾子の場合**: `MyPackage` のどちらのモジュールからもアクセスが可能ですが、パッケージ外部のモジュールやパッケージからはアクセスできません。

これにより、`package` 修飾子を使用することで、同じパッケージ内でのモジュール間の依存性を管理しながら、パッケージ外には公開しないという設計が可能です。

---

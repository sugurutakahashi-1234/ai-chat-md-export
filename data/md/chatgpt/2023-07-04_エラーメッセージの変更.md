# エラーメッセージの変更

Date: 2023-07-04

---

## 👤 User
*2023-07-04 18:09:03*

以下の処理で以下のエラーになった。
The file “.DS_Store” couldn’t be opened.
Program ended with exit code: 0

.jpg .png のみを扱うように変更したい

let fileManager = FileManager.default
    do {
        let directoryPath = directoryPath
        let directoryNames = try fileManager.contentsOfDirectory(atPath: directoryPath)
        var resultModels: [ResultModel] = []
        try directoryNames.enumerated().forEach { directoryItem in
            let fileDirectoryPath = directoryPath + "/" + directoryItem.element
            let fileNames = try fileManager.contentsOfDirectory(atPath: fileDirectoryPath)
            try fileNames.enumerated().forEach { fileItem in
                let image = NSImage(contentsOf: URL(fileURLWithPath: fileDirectoryPath + "/" + fileItem.element))!
                let results = try EmotionAnalysisCore.shared.predict(parameter: .uiImage(image: image))
                let resultModelItems = results.map {
                    ResultModelItem(resultEmotion: $0.emotion.rawValue, resultConfidence: $0.confidence)
                }
                let resultModel = ResultModel(fileName: fileItem.element, emotionKind: directoryItem.element, results: resultModelItems)
                resultModels.append(resultModel)
                print("Directory: \(directoryItem.offset + 1)/\(directoryNames.count), File: \(fileItem.offset + 1)/\(fileNames.count)")
            }
        }

        let jsonResultPath = currentFileURL.absoluteString.replacingOccurrences(of: "file://", with: "") + "result.json"
        saveJSONToFile(resultModels, filePath: jsonResultPath)
        print("Completed!")
    } catch {
        print(error.localizedDescription)
    }

---

## 🤖 Assistant
*2023-07-04 18:10:04*

エラーメッセージから見ると、MacOSのシステムファイルである".DS_Store"ファイルを開くのに問題が発生しています。このファイルはディレクトリに関する情報を持っており、通常の画像ファイルとは異なる形式のため、画像として開こうとするとエラーが発生します。また、ファイル拡張子が".jpg"または".png"であるファイルだけを扱いたいとのことですので、その条件を追加します。

以下のコードスニペットは、その修正を示しています。

```swift
let fileManager = FileManager.default
do {
    let directoryPath = directoryPath
    let directoryNames = try fileManager.contentsOfDirectory(atPath: directoryPath)
    var resultModels: [ResultModel] = []
    try directoryNames.enumerated().forEach { directoryItem in
        let fileDirectoryPath = directoryPath + "/" + directoryItem.element
        let fileNames = try fileManager.contentsOfDirectory(atPath: fileDirectoryPath)
        try fileNames.enumerated().forEach { fileItem in
            let filePath = fileDirectoryPath + "/" + fileItem.element
            let fileExtension = (filePath as NSString).pathExtension
            guard fileExtension == "jpg" || fileExtension == "png" else { return } // Skip non-image files
            
            let image = NSImage(contentsOf: URL(fileURLWithPath: filePath))!
            let results = try EmotionAnalysisCore.shared.predict(parameter: .uiImage(image: image))
            let resultModelItems = results.map {
                ResultModelItem(resultEmotion: $0.emotion.rawValue, resultConfidence: $0.confidence)
            }
            let resultModel = ResultModel(fileName: fileItem.element, emotionKind: directoryItem.element, results: resultModelItems)
            resultModels.append(resultModel)
            print("Directory: \(directoryItem.offset + 1)/\(directoryNames.count), File: \(fileItem.offset + 1)/\(fileNames.count)")
        }
    }

    let jsonResultPath = currentFileURL.absoluteString.replacingOccurrences(of: "file://", with: "") + "result.json"
    saveJSONToFile(resultModels, filePath: jsonResultPath)
    print("Completed!")
} catch {
    print(error.localizedDescription)
}
```

このコードは、各ファイルの拡張子を確認し、それが"jpg"または"png"である場合にのみ、画像分析の処理を実行します。これにより、".DS_Store"などの非画像ファイルは無視されます。

---

# ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å¤‰æ›´

Date: 2023-07-04

---

## ğŸ‘¤ User
*2023-07-04 18:09:03*

ä»¥ä¸‹ã®å‡¦ç†ã§ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ã«ãªã£ãŸã€‚
The file â€œ.DS_Storeâ€ couldnâ€™t be opened.
Program ended with exit code: 0

.jpg .png ã®ã¿ã‚’æ‰±ã†ã‚ˆã†ã«å¤‰æ›´ã—ãŸã„

let fileManager = FileManager.default
    do {
        let directoryPath = directoryPath
        let directoryNames = try fileManager.contentsOfDirectory(atPath: directoryPath)
        var resultModels: [ResultModel] = []
        try directoryNames.enumerated().forEach { directoryItem in
            let fileDirectoryPath = directoryPath + "/" + directoryItem.element
            let fileNames = try fileManager.contentsOfDirectory(atPath: fileDirectoryPath)
            try fileNames.enumerated().forEach { fileItem in
                let image = NSImage(contentsOf: URL(fileURLWithPath: fileDirectoryPath + "/" + fileItem.element))!
                let results = try EmotionAnalysisCore.shared.predict(parameter: .uiImage(image: image))
                let resultModelItems = results.map {
                    ResultModelItem(resultEmotion: $0.emotion.rawValue, resultConfidence: $0.confidence)
                }
                let resultModel = ResultModel(fileName: fileItem.element, emotionKind: directoryItem.element, results: resultModelItems)
                resultModels.append(resultModel)
                print("Directory: \(directoryItem.offset + 1)/\(directoryNames.count), File: \(fileItem.offset + 1)/\(fileNames.count)")
            }
        }

        let jsonResultPath = currentFileURL.absoluteString.replacingOccurrences(of: "file://", with: "") + "result.json"
        saveJSONToFile(resultModels, filePath: jsonResultPath)
        print("Completed!")
    } catch {
        print(error.localizedDescription)
    }

---

## ğŸ¤– Assistant
*2023-07-04 18:10:04*

ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰è¦‹ã‚‹ã¨ã€MacOSã®ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚ã‚‹".DS_Store"ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã®ã«å•é¡ŒãŒç™ºç”Ÿã—ã¦ã„ã¾ã™ã€‚ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é–¢ã™ã‚‹æƒ…å ±ã‚’æŒã£ã¦ãŠã‚Šã€é€šå¸¸ã®ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã¨ã¯ç•°ãªã‚‹å½¢å¼ã®ãŸã‚ã€ç”»åƒã¨ã—ã¦é–‹ã“ã†ã¨ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚ã¾ãŸã€ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­ãŒ".jpg"ã¾ãŸã¯".png"ã§ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ã‚’æ‰±ã„ãŸã„ã¨ã®ã“ã¨ã§ã™ã®ã§ã€ãã®æ¡ä»¶ã‚’è¿½åŠ ã—ã¾ã™ã€‚

ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚¹ãƒ‹ãƒšãƒƒãƒˆã¯ã€ãã®ä¿®æ­£ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

```swift
let fileManager = FileManager.default
do {
    let directoryPath = directoryPath
    let directoryNames = try fileManager.contentsOfDirectory(atPath: directoryPath)
    var resultModels: [ResultModel] = []
    try directoryNames.enumerated().forEach { directoryItem in
        let fileDirectoryPath = directoryPath + "/" + directoryItem.element
        let fileNames = try fileManager.contentsOfDirectory(atPath: fileDirectoryPath)
        try fileNames.enumerated().forEach { fileItem in
            let filePath = fileDirectoryPath + "/" + fileItem.element
            let fileExtension = (filePath as NSString).pathExtension
            guard fileExtension == "jpg" || fileExtension == "png" else { return } // Skip non-image files
            
            let image = NSImage(contentsOf: URL(fileURLWithPath: filePath))!
            let results = try EmotionAnalysisCore.shared.predict(parameter: .uiImage(image: image))
            let resultModelItems = results.map {
                ResultModelItem(resultEmotion: $0.emotion.rawValue, resultConfidence: $0.confidence)
            }
            let resultModel = ResultModel(fileName: fileItem.element, emotionKind: directoryItem.element, results: resultModelItems)
            resultModels.append(resultModel)
            print("Directory: \(directoryItem.offset + 1)/\(directoryNames.count), File: \(fileItem.offset + 1)/\(fileNames.count)")
        }
    }

    let jsonResultPath = currentFileURL.absoluteString.replacingOccurrences(of: "file://", with: "") + "result.json"
    saveJSONToFile(resultModels, filePath: jsonResultPath)
    print("Completed!")
} catch {
    print(error.localizedDescription)
}
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ã€å„ãƒ•ã‚¡ã‚¤ãƒ«ã®æ‹¡å¼µå­ã‚’ç¢ºèªã—ã€ãã‚ŒãŒ"jpg"ã¾ãŸã¯"png"ã§ã‚ã‚‹å ´åˆã«ã®ã¿ã€ç”»åƒåˆ†æã®å‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€".DS_Store"ãªã©ã®éç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã¯ç„¡è¦–ã•ã‚Œã¾ã™ã€‚

---

# ã‚°ãƒªãƒƒãƒ‰ãƒ“ãƒ¥ãƒ¼ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

æ—¥ä»˜: 2024-05-23

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/5/23 17:29:46*

onTapPlus ã§ã‚°ãƒªãƒƒãƒˆVIewã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å…¥ã‚ŒãŸã„ã©ã†ã™ã‚Œã°ã„ã„ã‹ï¼Ÿ

@MainActor
struct TalkBoxListView: View {
    @StateObject private var presenter: TalkBoxListPresenter
    private let lazyVGridColumns: \[GridItem\] = Array(repeating: GridItem(.flexible()), count: 2)
    
    init() {
        \_presenter = .init(wrappedValue: .init())
    }

    var body: some View {
        ScrollView {
            LazyVGrid(columns: lazyVGridColumns) {
                ForEach(presenter.talkBoxes) { talkBox in
                    ZStack(alignment: .bottom) {
                        AsyncImage(url: talkBox.imageUrl) { image in
                            image
                        } placeholder: {
                            ProgressView()
                        }
                        .aspectRatio(Constants.AspectRatio.square, contentMode: .fill)
                        
                        Text("Order: \\(talkBox.order)")
                    }
                    .background(Color.gray.opacity(0.2))
                    .cornerRadius(8)
                }
            }
        }
        .refreshable {
            Task {
                await presenter.onRefresh()
            }
        }
        .toolbar {
            ToolbarItem(placement: .topBarTrailing) {
                Button {
                    Task {
                        await presenter.onTapPlus()
                    }
                } label: {
                    SFSymbols.plus.image
                }
            }
        }
        .navigationTitle("Small Talk")
        .sensoryFeedbackSuccess(trigger: presenter.shouldfeedbackSuccess)
        .task {
            await presenter.onAppear()
        }
    }
}

@MainActor
final class TalkBoxListPresenter: ObservableObject {
    @Published private(set) var talkBoxes: \[TalkBox\] = \[\]

    @Published var isLoading: Bool = false
    @Published var appError: AppError?
    @Published var showAlert: Bool = false
    @Published var shouldfeedbackSuccess: Bool = false
    
    private let apiDriver = APIDriver()
    
    func onAppear() async {
        do {
            talkBoxes = try await apiDriver.getTalkBox()
        } catch {
            OSLogger.errorLog("\\(error)")
            appError = error.toAppError
            showAlert = true
        }
    }
    
    func onRefresh() async {
        await onAppear()
        shouldfeedbackSuccess = true
    }
    
    func onTapPlus() async {
        do {
            let newTalkBox = try await apiDriver.postTalkBox(talkBox: .random)
            talkBoxes.insert(newTalkBox, at: 0)
        } catch {
            OSLogger.errorLog("\\(error)")
            appError = error.toAppError
            showAlert = true
        }
    }
}

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/5/23 17:30:08*

ã‚°ãƒªãƒƒãƒ‰ãƒ“ãƒ¥ãƒ¼ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹ãŸã‚ã«ã¯ã€æ–°ã—ã„ãƒˆãƒ¼ã‚¯ãƒœãƒƒã‚¯ã‚¹ãŒè¿½åŠ ã•ã‚ŒãŸã¨ãã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚SwiftUIã®`withAnimation`ã‚’ä½¿ã£ã¦ã€è¦ç´ ãŒè¿½åŠ ã•ã‚Œã‚‹éš›ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä»¥ä¸‹ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹æ–¹æ³•ã‚’ç¤ºã—ã¾ã™ã€‚

ã¾ãšã€`TalkBoxListView`ã®`LazyVGrid`ã«`.animation()`ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢ã‚’è¿½åŠ ã—ã¾ã™ã€‚

æ¬¡ã«ã€`TalkBoxListPresenter`ã®`onTapPlus`ãƒ¡ã‚½ãƒƒãƒ‰ã§æ–°ã—ã„ãƒˆãƒ¼ã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ ã™ã‚‹éš›ã«`withAnimation`ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```swift
@MainActor
struct TalkBoxListView: View {
    @StateObject private var presenter: TalkBoxListPresenter
    private let lazyVGridColumns: [GridItem] = Array(repeating: GridItem(.flexible()), count: 2)
    
    init() {
        _presenter = .init(wrappedValue: .init())
    }

    var body: some View {
        ScrollView {
            LazyVGrid(columns: lazyVGridColumns) {
                ForEach(presenter.talkBoxes) { talkBox in
                    ZStack(alignment: .bottom) {
                        AsyncImage(url: talkBox.imageUrl) { image in
                            image
                        } placeholder: {
                            ProgressView()
                        }
                        .aspectRatio(Constants.AspectRatio.square, contentMode: .fill)
                        
                        Text("Order: \(talkBox.order)")
                    }
                    .background(Color.gray.opacity(0.2))
                    .cornerRadius(8)
                }
            }
            .animation(.default, value: presenter.talkBoxes)
        }
        .refreshable {
            Task {
                await presenter.onRefresh()
            }
        }
        .toolbar {
            ToolbarItem(placement: .topBarTrailing) {
                Button {
                    Task {
                        await presenter.onTapPlus()
                    }
                } label: {
                    SFSymbols.plus.image
                }
            }
        }
        .navigationTitle("Small Talk")
        .sensoryFeedbackSuccess(trigger: presenter.shouldfeedbackSuccess)
        .task {
            await presenter.onAppear()
        }
    }
}

@MainActor
final class TalkBoxListPresenter: ObservableObject {
    @Published private(set) var talkBoxes: [TalkBox] = []

    @Published var isLoading: Bool = false
    @Published var appError: AppError?
    @Published var showAlert: Bool = false
    @Published var shouldfeedbackSuccess: Bool = false
    
    private let apiDriver = APIDriver()
    
    func onAppear() async {
        do {
            talkBoxes = try await apiDriver.getTalkBox()
        } catch {
            OSLogger.errorLog("\(error)")
            appError = error.toAppError
            showAlert = true
        }
    }
    
    func onRefresh() async {
        await onAppear()
        shouldfeedbackSuccess = true
    }
    
    func onTapPlus() async {
        do {
            let newTalkBox = try await apiDriver.postTalkBox(talkBox: .random)
            withAnimation {
                talkBoxes.insert(newTalkBox, at: 0)
            }
        } catch {
            OSLogger.errorLog("\(error)")
            appError = error.toAppError
            showAlert = true
        }
    }
}
```

ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã§ã€æ–°ã—ã„ãƒˆãƒ¼ã‚¯ãƒœãƒƒã‚¯ã‚¹ãŒè¿½åŠ ã•ã‚ŒãŸéš›ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒé©ç”¨ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚`withAnimation`ã‚’ä½¿ç”¨ã—ã¦è¦ç´ ãŒæŒ¿å…¥ã•ã‚Œã‚‹éš›ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ã€`LazyVGrid`ã«`.animation(.default, value: presenter.talkBoxes)`ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€ãƒˆãƒ¼ã‚¯ãƒœãƒƒã‚¯ã‚¹ã®ãƒªã‚¹ãƒˆãŒå¤‰åŒ–ã™ã‚‹éš›ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

---

# ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®è‡ªå‹•åŒ–

æ—¥ä»˜: 2024-06-13

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/6/13 20:28:03*

SnapshotTestType ã”ã¨ã«SnapshotConfig.previewTestã ã£ãŸã‚Šã€SnapshotConfig.previewDeviceVariationTest ãªã©ã‚’å‘¼ã³åˆ†ã‘ãŸã„ã€‚

ã¡ãªã¿ã«static func previewTest(_ previews: (some SnapshotTestable).Type)ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã€‚

ä¸€ç•ªæœ€å¾Œã®

@Suite struct DeviceInfoViewSnapshotTest {
    @Test @MainActor func previewTest() {
        SnapshotConfig.previewTest(DeviceInfoView_Previews.self)
    }

    /// ãƒ‡ãƒã‚¤ã‚¹ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã‚’ã—ãŸã„å ´åˆ
    @Test @MainActor func previewDeviceVariationTest() {
        SnapshotConfig.previewDeviceVariationTest(DeviceInfoView_Previews.self)
    }

    /// æ–‡å­—ã‚µã‚¤ã‚ºã®ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã‚’ã—ãŸã„å ´åˆ
    @Test @MainActor func previewContentSizeVariationTest() {
        SnapshotConfig.previewContentSizeVariationTest(DeviceInfoView_Previews.self)
    }

    /// ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã§ãƒ†ã‚¹ãƒˆã—ãŸã„å ´åˆ
    @Test @MainActor func previewDarkModeTest() {
        SnapshotConfig.previewDarkModeTest(DeviceInfoView_Previews.self)
    }

    /// å¤šè¨€èªãƒ†ã‚¹ãƒˆã—ãŸã„å ´åˆ
    @Test @MainActor func previewLanguageVariationTest() {
        SnapshotConfig.previewLanguageVariationTest(DeviceInfoView_Previews.self)
    }
    
    @Test(arguments: SnapshotTestType.allCases)
    @MainActor func previewSnapshotTest(snapshotTestType: SnapshotTestType) {
        // ã“ã“ã‚’è€ƒãˆã¦ã»ã—ã„ã€‚SnapshotTestTypeã®extensionã§å®šç¾©ã—ã¦ãŠã‘ã°è‰¯ã•ãã†ï¼Ÿ 
   }
}

enum SnapshotTestType: CaseIterable {
    case `default`
    case deviceVariation
    case contentSizeVariation
    case darkMode
    case languageVariation
}

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/6/13 20:28:20*

`SnapshotTestType`ã®å„ã‚±ãƒ¼ã‚¹ã«å¯¾å¿œã™ã‚‹ãƒ†ã‚¹ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™ãŸã‚ã«ã¯ã€`SnapshotTestType`ã®ã‚¨ã‚¯ã‚¹ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ã§ãã‚Œãã‚Œã®ã‚±ãƒ¼ã‚¹ã«å¯¾å¿œã™ã‚‹ãƒ†ã‚¹ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã™ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€`previewSnapshotTest`ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ã‚¹ã‚¤ãƒƒãƒæ–‡ã‚’ä½¿ç”¨ã—ã¦é©åˆ‡ãªãƒ†ã‚¹ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚

ä»¥ä¸‹ã«ãã®å®Ÿè£…ä¾‹ã‚’ç¤ºã—ã¾ã™ï¼š

```swift
import XCTest
import SwiftUI
import SnapshotTesting

// Assume that SnapshotTestable is a protocol and SnapshotConfig has the necessary methods.

enum SnapshotTestType: CaseIterable {
    case `default`
    case deviceVariation
    case contentSizeVariation
    case darkMode
    case languageVariation

    func runTest(previewType: (some SnapshotTestable).Type) {
        switch self {
        case .default:
            SnapshotConfig.previewTest(previewType)
        case .deviceVariation:
            SnapshotConfig.previewDeviceVariationTest(previewType)
        case .contentSizeVariation:
            SnapshotConfig.previewContentSizeVariationTest(previewType)
        case .darkMode:
            SnapshotConfig.previewDarkModeTest(previewType)
        case .languageVariation:
            SnapshotConfig.previewLanguageVariationTest(previewType)
        }
    }
}

@Suite struct DeviceInfoViewSnapshotTest {
    @Test @MainActor func previewTest() {
        SnapshotConfig.previewTest(DeviceInfoView_Previews.self)
    }

    @Test @MainActor func previewDeviceVariationTest() {
        SnapshotConfig.previewDeviceVariationTest(DeviceInfoView_Previews.self)
    }

    @Test @MainActor func previewContentSizeVariationTest() {
        SnapshotConfig.previewContentSizeVariationTest(DeviceInfoView_Previews.self)
    }

    @Test @MainActor func previewDarkModeTest() {
        SnapshotConfig.previewDarkModeTest(DeviceInfoView_Previews.self)
    }

    @Test @MainActor func previewLanguageVariationTest() {
        SnapshotConfig.previewLanguageVariationTest(DeviceInfoView_Previews.self)
    }
    
    @Test(arguments: SnapshotTestType.allCases)
    @MainActor func previewSnapshotTest(snapshotTestType: SnapshotTestType) {
        snapshotTestType.runTest(previewType: DeviceInfoView_Previews.self)
    }
}
```

ã“ã®å®Ÿè£…ã«ã‚ˆã‚Šã€`previewSnapshotTest`ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€`SnapshotTestType`ã®å„ã‚±ãƒ¼ã‚¹ã«å¿œã˜ã¦é©åˆ‡ãªã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚ã‚¨ã‚¯ã‚¹ãƒ†ãƒ³ã‚·ãƒ§ãƒ³å†…ã§`runTest`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã§ã€ã‚¹ã‚¤ãƒƒãƒæ–‡ã‚’ä½¿ã£ã¦ãã‚Œãã‚Œã®ãƒ†ã‚¹ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®æ–¹æ³•ã§ã€ãƒ†ã‚¹ãƒˆã®å‘¼ã³å‡ºã—ã‚’ç°¡æ½”ã«ä¿ã¤ã“ã¨ãŒã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/6/13 20:36:50*

ã»ã‚“ã¨ã¯ã“ã†è¨€ã†å¼•æ•°ãŒã‚ã‚‹ã®ã§ã€ã©ã†å¯¾å¿œã—ãŸã‚‰ã„ã„ã®ã‹ï¼Ÿ

@MainActor
    static func previewTest(_ previews: (some SnapshotTestable).Type, device: SnapshotConfig.DeviceType = .defaultDevice, shouldWait: Bool = false, file: StaticString = #filePath, line: Int = #line) {
        guard currentLanguage == "ja" else {
            return
        }
        // Combine ãªã©ã®å‡¦ç†ãŒã‚ã‚‹å ´åˆã¯ wait ã‚’ã„ã‚Œãªã„ã¨æœŸå¾…å€¤é€šã‚Šã® View ã®çŠ¶æ…‹ã«ãªã‚‰ãªã„
        previews.snapshots.assertSnapshots(
            as: shouldWait ? .wait(for: 0.01, on: .image(precision: SnapshotConfig.precision, layout: .device(config: device.viewImageConfig))) : .image(precision: SnapshotConfig.precision, layout: .device(config: device.viewImageConfig)),
            named: nil,
            file: file,
            testName: "\(type(of: previews))".sliceToViewName,
            line: UInt(line)
        )
    }

    @MainActor
    static func previewDeviceVariationTest(_ previews: (some SnapshotTestable).Type, file: StaticString = #filePath, line: Int = #line) {
        guard currentLanguage == "ja" else {
            return
        }
        for device in SnapshotConfig.DeviceType.allCases {
            previews.snapshots.assertSnapshots(
                as: .image(precision: SnapshotConfig.precision, layout: .device(config: device.viewImageConfig)),
                named: "\(device.rawValue)",
                file: file,
                testName: "\(type(of: previews))".sliceToViewName + "-Device",
                line: UInt(line)
            )
        }
    }

    @MainActor
    static func previewContentSizeVariationTest(_ previews: (some SnapshotTestable).Type, device: SnapshotConfig.DeviceType = .defaultDevice, file: StaticString = #filePath, line: Int = #line) {
        guard currentLanguage == "ja" else {
            return
        }
        for contentSizeType in SnapshotConfig.ContentSizeType.allCases {
            previews.snapshots.assertSnapshots(
                as: .image(precision: SnapshotConfig.precision, layout: .device(config: device.viewImageConfig), traits: .init(preferredContentSizeCategory: contentSizeType.size)),
                named: "\(contentSizeType.rawValue)",
                file: file,
                testName: "\(type(of: previews))".sliceToViewName + "-ContentSize",
                line: UInt(line)
            )
        }
    }

    @MainActor
    static func previewDarkModeTest(_ previews: (some SnapshotTestable).Type, device: SnapshotConfig.DeviceType = .defaultDevice, file: StaticString = #filePath, line: Int = #line) {
        guard currentLanguage == "ja" else {
            return
        }
        for colorScheme in ColorScheme.allCases.filter({ $0 != .light }) {
            previews.snapshots.assertSnapshots(
                as: .image(precision: SnapshotConfig.precision, layout: .device(config: device.viewImageConfig), traits: .init(userInterfaceStyle: colorScheme.asUIUserInterfaceStyle)),
                named: "\("\(colorScheme)".initialUppercased)Mode",
                file: file,
                testName: "\(type(of: previews))".sliceToViewName + "-ColorThema",
                line: UInt(line)
            )
        }
    }

    @MainActor
    static func previewLanguageVariationTest(_ previews: (some SnapshotTestable).Type, device: SnapshotConfig.DeviceType = .defaultDevice, file: StaticString = #filePath, line: Int = #line) {
        guard currentLanguage != "ja" else {
            return
        }
        previews.snapshots.assertSnapshots(
            as: .image(precision: SnapshotConfig.precision, layout: .device(config: device.viewImageConfig)),
            named: currentLanguage,
            file: file,
            testName: "\(type(of: previews))".sliceToViewName + "-Language",
            line: UInt(line)
        )
    }

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/6/13 20:37:12*

`SnapshotTestType` ã®å„ã‚±ãƒ¼ã‚¹ã«å¯¾å¿œã™ã‚‹ãƒ†ã‚¹ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã‚’å¼•æ•°ä»˜ãã§å‘¼ã³å‡ºã™ã«ã¯ã€ã‚¨ã‚¯ã‚¹ãƒ†ãƒ³ã‚·ãƒ§ãƒ³å†…ã§ãã‚Œãã‚Œã®ã‚±ãƒ¼ã‚¹ã«å¯¾å¿œã™ã‚‹é–¢æ•°ã‚’å®šç¾©ã—ã€`previewSnapshotTest` ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ã“ã‚Œã‚‰ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã™ã‚ˆã†ã«ã—ã¾ã™ã€‚

ä»¥ä¸‹ã¯ãã®å®Ÿè£…ä¾‹ã§ã™ï¼š

```swift
import XCTest
import SwiftUI
import SnapshotTesting

enum SnapshotTestType: CaseIterable {
    case `default`
    case deviceVariation
    case contentSizeVariation
    case darkMode
    case languageVariation

    func runTest(previewType: (some SnapshotTestable).Type, device: SnapshotConfig.DeviceType = .defaultDevice, shouldWait: Bool = false, file: StaticString = #filePath, line: Int = #line) {
        switch self {
        case .default:
            SnapshotConfig.previewTest(previewType, device: device, shouldWait: shouldWait, file: file, line: line)
        case .deviceVariation:
            SnapshotConfig.previewDeviceVariationTest(previewType, file: file, line: line)
        case .contentSizeVariation:
            SnapshotConfig.previewContentSizeVariationTest(previewType, device: device, file: file, line: line)
        case .darkMode:
            SnapshotConfig.previewDarkModeTest(previewType, device: device, file: file, line: line)
        case .languageVariation:
            SnapshotConfig.previewLanguageVariationTest(previewType, device: device, file: file, line: line)
        }
    }
}

@Suite struct DeviceInfoViewSnapshotTest {
    @Test @MainActor func previewTest() {
        SnapshotConfig.previewTest(DeviceInfoView_Previews.self)
    }

    @Test @MainActor func previewDeviceVariationTest() {
        SnapshotConfig.previewDeviceVariationTest(DeviceInfoView_Previews.self)
    }

    @Test @MainActor func previewContentSizeVariationTest() {
        SnapshotConfig.previewContentSizeVariationTest(DeviceInfoView_Previews.self)
    }

    @Test @MainActor func previewDarkModeTest() {
        SnapshotConfig.previewDarkModeTest(DeviceInfoView_Previews.self)
    }

    @Test @MainActor func previewLanguageVariationTest() {
        SnapshotConfig.previewLanguageVariationTest(DeviceInfoView_Previews.self)
    }
    
    @Test(arguments: SnapshotTestType.allCases)
    @MainActor func previewSnapshotTest(snapshotTestType: SnapshotTestType) {
        snapshotTestType.runTest(previewType: DeviceInfoView_Previews.self)
    }
}
```

ã“ã®å®Ÿè£…ã§ã¯ã€`runTest` ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§å„ã‚±ãƒ¼ã‚¹ã«å¯¾å¿œã™ã‚‹ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã‚’å¼•æ•°ä»˜ãã§å‘¼ã³å‡ºã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€`previewSnapshotTest` ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ã‚¹ã‚¤ãƒƒãƒæ–‡ã‚’ä½¿ã‚ãšã«ã€`SnapshotTestType` ã®å„ã‚±ãƒ¼ã‚¹ã«å¯¾å¿œã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚

å¿…è¦ã«å¿œã˜ã¦ã€`runTest` ãƒ¡ã‚½ãƒƒãƒ‰ã«è¿½åŠ ã®å¼•æ•°ã‚’æ¸¡ã™ã“ã¨ãŒã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€`shouldWait` ã‚„ `device` ãªã©ã®å¼•æ•°ã‚’ `previewSnapshotTest` ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§è¨­å®šã—ã¦ã‹ã‚‰ `runTest` ãƒ¡ã‚½ãƒƒãƒ‰ã«æ¸¡ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

---

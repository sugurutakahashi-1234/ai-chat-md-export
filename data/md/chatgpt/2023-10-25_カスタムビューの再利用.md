# カスタムビューの再利用

Date: 2023-10-25

---

## 👤 User
*2023-10-25 15:03:15*

以下を使いまわせるようにしたい

VStack(alignment: .leading, spacing: 4) {
                            Text("パスワード")
                                .typographyStyle(.body2)
                                .foregroundColor(CoreAssets.Color.Neutral.neutral80.swiftUIColor)

                            HStack {
                                Group {
                                    if presenter.isVisiblePassword {
                                        TextField("パスワード", text: $presenter.password)
                                    } else {
                                        // SecureField のバグなのか一度別のTextFieldを選択したあとに、再びSecureFieldの入力をすると入力がリセットされる（表示/非表示の切り替えやメールアドレスのTextFieldを選択した後も発生する）（おそらくシンプルに直すのは難しい）
                                        SecureField("パスワード", text: $presenter.password)
                                    }
                                }
                                .autocapitalization(.none)
                                .disableAutocorrection(true)

                                Button {
                                    presenter.onTapPasswordEyeIcon()
                                } label: {
                                    (presenter.isVisiblePassword ? SFSymbols.eyeFill.image : SFSymbols.eyeSlashFill.image)
                                        .renderingMode(.template)
                                        .foregroundColor(CoreAssets.Color.Neutral.neutral40.swiftUIColor)
                                }
                            }
                            .inputFieldStyle()

                            VStack(alignment: .leading) {
                                ValidationLabel(text: "8〜16文字", isValid: presenter.passwordValidationStatus.isValidLength)
                                ValidationLabel(text: "1つ以上の英大文字", isValid: presenter.passwordValidationStatus.containsUppercase)
                                ValidationLabel(text: "1つ以上の英子文字", isValid: presenter.passwordValidationStatus.containsLowercase)
                                ValidationLabel(text: "1つ以上の半角数字", isValid: presenter.passwordValidationStatus.containsNumber)
                            }
                            .frame(maxWidth: .infinity, alignment: .leading)
                            .padding(.horizontal, 8)
                        }

                        VStack(alignment: .leading, spacing: 4) {
                            Text("パスワード再入力")
                                .typographyStyle(.body2)
                                .foregroundColor(CoreAssets.Color.Neutral.neutral80.swiftUIColor)

                            HStack {
                                Group {
                                    if presenter.isVisibleReEnteredPassword {
                                        TextField("パスワード", text: $presenter.reEnteredPassword)
                                    } else {
                                        // SecureField のバグなのか一度別のTextFieldを選択したあとに、再びSecureFieldの入力をすると入力がリセットされる（表示/非表示の切り替えやメールアドレスのTextFieldを選択した後も発生する）（おそらくシンプルに直すのは難しい）
                                        SecureField("パスワード", text: $presenter.reEnteredPassword)
                                    }
                                }
                                .autocapitalization(.none)
                                .disableAutocorrection(true)

                                Button {
                                    presenter.onTapReEnterPasswordEyeIcon()
                                } label: {
                                    (presenter.isVisibleReEnteredPassword ? SFSymbols.eyeFill.image : SFSymbols.eyeSlashFill.image)
                                        .renderingMode(.template)
                                        .foregroundColor(CoreAssets.Color.Neutral.neutral40.swiftUIColor)
                                }
                            }
                            .inputFieldStyle()

                            ValidationLabel(text: "再入力されたパスワードの一致", isValid: presenter.isMatchingReEnteredPassword)
                                .frame(maxWidth: .infinity, alignment: .leading)
                                .padding(.horizontal, 8)
                        }
                    }

---

## 🤖 Assistant
*2023-10-25 15:04:10*

このSwiftUIコードを簡潔にして再利用しやすくするために、独自のコンポーネントに分けてみましょう。以下にその方法を示します：

1. パスワードの入力フィールドとアイコンのボタンをカスタムビューに分けます。
2. パスワードの検証ラベルをカスタムビューに分けます。

```swift
struct PasswordInputView: View {
    let title: String
    @Binding var password: String
    let isVisiblePassword: Bool
    let onTapEyeIcon: () -> Void
    
    var body: some View {
        VStack(alignment: .leading, spacing: 4) {
            Text(title)
                .typographyStyle(.body2)
                .foregroundColor(CoreAssets.Color.Neutral.neutral80.swiftUIColor)
            
            HStack {
                Group {
                    if isVisiblePassword {
                        TextField("パスワード", text: $password)
                    } else {
                        SecureField("パスワード", text: $password)
                    }
                }
                .autocapitalization(.none)
                .disableAutocorrection(true)

                Button(action: onTapEyeIcon) {
                    (isVisiblePassword ? SFSymbols.eyeFill.image : SFSymbols.eyeSlashFill.image)
                        .renderingMode(.template)
                        .foregroundColor(CoreAssets.Color.Neutral.neutral40.swiftUIColor)
                }
            }
            .inputFieldStyle()
        }
    }
}

struct ValidationLabel: View {
    let text: String
    let isValid: Bool
    
    var body: some View {
        Text(text)
            // You can modify this to match your previous `ValidationLabel` styling.
            // I assumed it's changing color based on `isValid` value.
            .foregroundColor(isValid ? .green : .red)
    }
}

```

これで、カスタムビューを使って元のコードを次のように簡潔に書き換えることができます：

```swift
VStack {
    PasswordInputView(
        title: "パスワード",
        password: $presenter.password,
        isVisiblePassword: presenter.isVisiblePassword,
        onTapEyeIcon: presenter.onTapPasswordEyeIcon
    )
    .padding(.horizontal, 8)
    
    VStack(alignment: .leading) {
        ValidationLabel(text: "8〜16文字", isValid: presenter.passwordValidationStatus.isValidLength)
        ValidationLabel(text: "1つ以上の英大文字", isValid: presenter.passwordValidationStatus.containsUppercase)
        ValidationLabel(text: "1つ以上の英子文字", isValid: presenter.passwordValidationStatus.containsLowercase)
        ValidationLabel(text: "1つ以上の半角数字", isValid: presenter.passwordValidationStatus.containsNumber)
    }
    .frame(maxWidth: .infinity, alignment: .leading)
    .padding(.horizontal, 8)

    PasswordInputView(
        title: "パスワード再入力",
        password: $presenter.reEnteredPassword,
        isVisiblePassword: presenter.isVisibleReEnteredPassword,
        onTapEyeIcon: presenter.onTapReEnterPasswordEyeIcon
    )
    .padding(.horizontal, 8)
    
    ValidationLabel(text: "再入力されたパスワードの一致", isValid: presenter.isMatchingReEnteredPassword)
        .frame(maxWidth: .infinity, alignment: .leading)
        .padding(.horizontal, 8)
}
```

これにより、コードの冗長性が減少し、再利用が容易になります。

---

## 👤 User
*2023-10-25 15:05:59*

この塊をひとつのViewにしたいんだ。、

                        VStack(alignment: .leading, spacing: 4) {
                            Text("パスワード")
                                .typographyStyle(.body2)
                                .foregroundColor(CoreAssets.Color.Neutral.neutral80.swiftUIColor)

                            HStack {
                                Group {
                                    if presenter.isVisiblePassword {
                                        TextField("パスワード", text: $presenter.password)
                                    } else {
                                        // SecureField のバグなのか一度別のTextFieldを選択したあとに、再びSecureFieldの入力をすると入力がリセットされる（表示/非表示の切り替えやメールアドレスのTextFieldを選択した後も発生する）（おそらくシンプルに直すのは難しい）
                                        SecureField("パスワード", text: $presenter.password)
                                    }
                                }
                                .autocapitalization(.none)
                                .disableAutocorrection(true)

                                Button {
                                    presenter.onTapPasswordEyeIcon()
                                } label: {
                                    (presenter.isVisiblePassword ? SFSymbols.eyeFill.image : SFSymbols.eyeSlashFill.image)
                                        .renderingMode(.template)
                                        .foregroundColor(CoreAssets.Color.Neutral.neutral40.swiftUIColor)
                                }
                            }
                            .inputFieldStyle()

                            VStack(alignment: .leading) {
                                ValidationLabel(text: "8〜16文字", isValid: presenter.passwordValidationStatus.isValidLength)
                                ValidationLabel(text: "1つ以上の英大文字", isValid: presenter.passwordValidationStatus.containsUppercase)
                                ValidationLabel(text: "1つ以上の英子文字", isValid: presenter.passwordValidationStatus.containsLowercase)
                                ValidationLabel(text: "1つ以上の半角数字", isValid: presenter.passwordValidationStatus.containsNumber)
                            }
                            .frame(maxWidth: .infinity, alignment: .leading)
                            .padding(.horizontal, 8)
                        }

                        VStack(alignment: .leading, spacing: 4) {
                            Text("パスワード再入力")
                                .typographyStyle(.body2)
                                .foregroundColor(CoreAssets.Color.Neutral.neutral80.swiftUIColor)

                            HStack {
                                Group {
                                    if presenter.isVisibleReEnteredPassword {
                                        TextField("パスワード", text: $presenter.reEnteredPassword)
                                    } else {
                                        // SecureField のバグなのか一度別のTextFieldを選択したあとに、再びSecureFieldの入力をすると入力がリセットされる（表示/非表示の切り替えやメールアドレスのTextFieldを選択した後も発生する）（おそらくシンプルに直すのは難しい）
                                        SecureField("パスワード", text: $presenter.reEnteredPassword)
                                    }
                                }
                                .autocapitalization(.none)
                                .disableAutocorrection(true)

                                Button {
                                    presenter.onTapReEnterPasswordEyeIcon()
                                } label: {
                                    (presenter.isVisibleReEnteredPassword ? SFSymbols.eyeFill.image : SFSymbols.eyeSlashFill.image)
                                        .renderingMode(.template)
                                        .foregroundColor(CoreAssets.Color.Neutral.neutral40.swiftUIColor)
                                }
                            }
                            .inputFieldStyle()

                            ValidationLabel(text: "再入力されたパスワードの一致", isValid: presenter.isMatchingReEnteredPassword)
                                .frame(maxWidth: .infinity, alignment: .leading)
                                .padding(.horizontal, 8)
                        }

---

## 🤖 Assistant
*2023-10-25 15:06:41*

指定されたコードを1つのカスタム`View`にまとめるために、以下のように新しいSwiftUIの`View`を作成できます。このカスタム`View`は、パスワード入力フィールドとそれに関連するバリデーションラベルを表示します。コードの再利用を促進するために、いくつかのプロパティを引数として受け取るようにしています。

```swift
struct PasswordInputFieldView: View {
    var title: String
    @Binding var password: String
    var isVisible: Bool
    var onTapEyeIcon: () -> Void
    var validationLabels: [(text: String, isValid: Bool)]

    var body: some View {
        VStack(alignment: .leading, spacing: 4) {
            Text(title)
                .typographyStyle(.body2)
                .foregroundColor(CoreAssets.Color.Neutral.neutral80.swiftUIColor)
            
            HStack {
                Group {
                    if isVisible {
                        TextField("パスワード", text: $password)
                    } else {
                        SecureField("パスワード", text: $password)
                    }
                }
                .autocapitalization(.none)
                .disableAutocorrection(true)

                Button(action: onTapEyeIcon) {
                    (isVisible ? SFSymbols.eyeFill.image : SFSymbols.eyeSlashFill.image)
                        .renderingMode(.template)
                        .foregroundColor(CoreAssets.Color.Neutral.neutral40.swiftUIColor)
                }
            }
            .inputFieldStyle()

            VStack(alignment: .leading) {
                ForEach(validationLabels, id: \.text) { label in
                    ValidationLabel(text: label.text, isValid: label.isValid)
                }
            }
            .frame(maxWidth: .infinity, alignment: .leading)
            .padding(.horizontal, 8)
        }
    }
}

```

このカスタム`View`を使って、元のコードを以下のように簡潔に書き換えることができます：

```swift
VStack {
    PasswordInputFieldView(
        title: "パスワード",
        password: $presenter.password,
        isVisible: presenter.isVisiblePassword,
        onTapEyeIcon: presenter.onTapPasswordEyeIcon,
        validationLabels: [
            ("8〜16文字", presenter.passwordValidationStatus.isValidLength),
            ("1つ以上の英大文字", presenter.passwordValidationStatus.containsUppercase),
            ("1つ以上の英子文字", presenter.passwordValidationStatus.containsLowercase),
            ("1つ以上の半角数字", presenter.passwordValidationStatus.containsNumber)
        ]
    )
    
    PasswordInputFieldView(
        title: "パスワード再入力",
        password: $presenter.reEnteredPassword,
        isVisible: presenter.isVisibleReEnteredPassword,
        onTapEyeIcon: presenter.onTapReEnterPasswordEyeIcon,
        validationLabels: [("再入力されたパスワードの一致", presenter.isMatchingReEnteredPassword)]
    )
}
```

これにより、コードが整理され、再利用がしやすくなります。

---

## 👤 User
*2023-10-25 15:08:04*

2つに分割しなくていいよ。
あと引数に文字列を渡したくない。全部別々の変数でいいと思う。

---

## 🤖 Assistant
*2023-10-25 15:08:55*

了解しました。ご希望に基づき、コードを簡略化し、指定された部分を一つのカスタム`View`にまとめる方法を以下に示します。

まず、カスタム`View`を作成します。引数に文字列を直接渡さないようにし、必要な変数を明示的に宣言するようにします。

```swift
struct PasswordInputFieldView: View {
    @Binding var password: String
    @Binding var isVisiblePassword: Bool
    @Binding var isVisibleReEnteredPassword: Bool
    @Binding var passwordValidationStatus: PasswordValidationStatus
    @Binding var isMatchingReEnteredPassword: Bool
    var onTapPasswordEyeIcon: () -> Void
    var onTapReEnterPasswordEyeIcon: () -> Void

    var body: some View {
        VStack {
            VStack(alignment: .leading, spacing: 4) {
                Text("パスワード")
                    .typographyStyle(.body2)
                    .foregroundColor(CoreAssets.Color.Neutral.neutral80.swiftUIColor)

                passwordField(password: $password, isVisible: isVisiblePassword, onTapEyeIcon: onTapPasswordEyeIcon)

                validationLabelsView()
            }

            VStack(alignment: .leading, spacing: 4) {
                Text("パスワード再入力")
                    .typographyStyle(.body2)
                    .foregroundColor(CoreAssets.Color.Neutral.neutral80.swiftUIColor)

                passwordField(password: $password, isVisible: isVisibleReEnteredPassword, onTapEyeIcon: onTapReEnterPasswordEyeIcon)

                ValidationLabel(text: "再入力されたパスワードの一致", isValid: isMatchingReEnteredPassword)
                    .frame(maxWidth: .infinity, alignment: .leading)
                    .padding(.horizontal, 8)
            }
        }
    }

    private func passwordField(password: Binding<String>, isVisible: Bool, onTapEyeIcon: @escaping () -> Void) -> some View {
        HStack {
            Group {
                if isVisible {
                    TextField("パスワード", text: password)
                } else {
                    SecureField("パスワード", text: password)
                }
            }
            .autocapitalization(.none)
            .disableAutocorrection(true)

            Button(action: onTapEyeIcon) {
                (isVisible ? SFSymbols.eyeFill.image : SFSymbols.eyeSlashFill.image)
                    .renderingMode(.template)
                    .foregroundColor(CoreAssets.Color.Neutral.neutral40.swiftUIColor)
            }
        }
        .inputFieldStyle()
    }

    private func validationLabelsView() -> some View {
        VStack(alignment: .leading) {
            ValidationLabel(text: "8〜16文字", isValid: passwordValidationStatus.isValidLength)
            ValidationLabel(text: "1つ以上の英大文字", isValid: passwordValidationStatus.containsUppercase)
            ValidationLabel(text: "1つ以上の英子文字", isValid: passwordValidationStatus.containsLowercase)
            ValidationLabel(text: "1つ以上の半角数字", isValid: passwordValidationStatus.containsNumber)
        }
        .frame(maxWidth: .infinity, alignment: .leading)
        .padding(.horizontal, 8)
    }
}
```

このカスタム`View`を使用する場合、以下のようにします：

```swift
PasswordInputFieldView(
    password: $presenter.password,
    isVisiblePassword: presenter.isVisiblePassword,
    isVisibleReEnteredPassword: presenter.isVisibleReEnteredPassword,
    passwordValidationStatus: presenter.passwordValidationStatus,
    isMatchingReEnteredPassword: presenter.isMatchingReEnteredPassword,
    onTapPasswordEyeIcon: presenter.onTapPasswordEyeIcon,
    onTapReEnterPasswordEyeIcon: presenter.onTapReEnterPasswordEyeIcon
)
```

こちらの構造は、ご希望のものに近づけてみました。必要に応じて、さらに変更や調整を加えることができます。

---

## 👤 User
*2023-10-25 15:10:50*

private func  なくてもいいと思う。

---

## 🤖 Assistant
*2023-10-25 15:11:36*

了解しました。`private func`を削除して、そのコードを直接`body`内に組み込む方法を示します。

```swift
struct PasswordInputFieldView: View {
    @Binding var password: String
    @Binding var isVisiblePassword: Bool
    @Binding var isVisibleReEnteredPassword: Bool
    @Binding var passwordValidationStatus: PasswordValidationStatus
    @Binding var isMatchingReEnteredPassword: Bool
    var onTapPasswordEyeIcon: () -> Void
    var onTapReEnterPasswordEyeIcon: () -> Void

    var body: some View {
        VStack {
            VStack(alignment: .leading, spacing: 4) {
                Text("パスワード")
                    .typographyStyle(.body2)
                    .foregroundColor(CoreAssets.Color.Neutral.neutral80.swiftUIColor)

                HStack {
                    Group {
                        if isVisiblePassword {
                            TextField("パスワード", text: $password)
                        } else {
                            SecureField("パスワード", text: $password)
                        }
                    }
                    .autocapitalization(.none)
                    .disableAutocorrection(true)

                    Button(action: onTapPasswordEyeIcon) {
                        (isVisiblePassword ? SFSymbols.eyeFill.image : SFSymbols.eyeSlashFill.image)
                            .renderingMode(.template)
                            .foregroundColor(CoreAssets.Color.Neutral.neutral40.swiftUIColor)
                    }
                }
                .inputFieldStyle()

                VStack(alignment: .leading) {
                    ValidationLabel(text: "8〜16文字", isValid: passwordValidationStatus.isValidLength)
                    ValidationLabel(text: "1つ以上の英大文字", isValid: passwordValidationStatus.containsUppercase)
                    ValidationLabel(text: "1つ以上の英子文字", isValid: passwordValidationStatus.containsLowercase)
                    ValidationLabel(text: "1つ以上の半角数字", isValid: passwordValidationStatus.containsNumber)
                }
                .frame(maxWidth: .infinity, alignment: .leading)
                .padding(.horizontal, 8)
            }

            VStack(alignment: .leading, spacing: 4) {
                Text("パスワード再入力")
                    .typographyStyle(.body2)
                    .foregroundColor(CoreAssets.Color.Neutral.neutral80.swiftUIColor)

                HStack {
                    Group {
                        if isVisibleReEnteredPassword {
                            TextField("パスワード", text: $password)
                        } else {
                            SecureField("パスワード", text: $password)
                        }
                    }
                    .autocapitalization(.none)
                    .disableAutocorrection(true)

                    Button(action: onTapReEnterPasswordEyeIcon) {
                        (isVisibleReEnteredPassword ? SFSymbols.eyeFill.image : SFSymbols.eyeSlashFill.image)
                            .renderingMode(.template)
                            .foregroundColor(CoreAssets.Color.Neutral.neutral40.swiftUIColor)
                    }
                }
                .inputFieldStyle()

                ValidationLabel(text: "再入力されたパスワードの一致", isValid: isMatchingReEnteredPassword)
                    .frame(maxWidth: .infinity, alignment: .leading)
                    .padding(.horizontal, 8)
            }
        }
    }
}
```

`private func`を使用せず、直接`body`内に組み込むと、コードが長くなりますが、すべての内容が一目でわかりやすくなるメリットもあります。

---

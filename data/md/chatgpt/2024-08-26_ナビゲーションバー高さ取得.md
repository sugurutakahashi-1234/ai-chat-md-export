# ナビゲーションバー高さ取得

日付: 2024-08-26

---

## 👤 ユーザー
*2024/8/26 20:20:04*

SwiftUIでナビゲーションバーの高さを取得する方法

---

## 🤖 アシスタント
*2024/8/26 20:20:21*

SwiftUIでは直接的にナビゲーションバーの高さを取得するプロパティやメソッドは提供されていませんが、`UIViewControllerRepresentable`を使ってUIKitの`UINavigationController`をラップし、そのナビゲーションバーの高さを取得する方法があります。

以下にSwiftUIでナビゲーションバーの高さを取得する例を示します。

```swift
import SwiftUI

struct ContentView: View {
    @State private var navigationBarHeight: CGFloat = 0
    
    var body: some View {
        NavigationView {
            VStack {
                Text("Navigation Bar Height: \(navigationBarHeight)")
                Spacer()
            }
            .background(NavigationBarAccessor { navigationBar in
                self.navigationBarHeight = navigationBar.frame.height
            })
            .navigationBarTitle("Title", displayMode: .inline)
        }
    }
}

struct NavigationBarAccessor: UIViewControllerRepresentable {
    var callback: (UINavigationBar) -> Void
    
    func makeUIViewController(context: Context) -> UIViewController {
        UIViewController()
    }
    
    func updateUIViewController(_ uiViewController: UIViewController, context: Context) {
        if let navigationController = uiViewController.navigationController {
            callback(navigationController.navigationBar)
        }
    }
}
```

### 解説

1. **ContentView**: `ContentView`には、ナビゲーションバーの高さを保持するための`@State`プロパティ`navigationBarHeight`があります。
   
2. **NavigationBarAccessor**: `UIViewControllerRepresentable`を使用して、UIKitの`UIViewController`をSwiftUIで使えるようにラップしています。このラッパーを使って、ナビゲーションコントローラのナビゲーションバーにアクセスし、その高さを取得しています。

3. **Callback**: `NavigationBarAccessor`はクロージャ`callback`を持ち、ナビゲーションバーが取得された時に呼び出されます。

この方法を使えば、SwiftUIのビューからナビゲーションバーの高さを動的に取得し、使用することができます。

---

## 👤 ユーザー
*2024/8/26 20:21:28*

もっと簡単に取得する方法はないの？

---

## 🤖 アシスタント
*2024/8/26 20:21:52*

SwiftUIでは、直接的にナビゲーションバーの高さを取得するための簡単な方法は提供されていませんが、以下のように`GeometryReader`を使って、ナビゲーションバーの高さを推定する方法があります。

`GeometryReader`を使って画面全体の高さを取得し、ナビゲーションバーの高さを差し引くことで、間接的にナビゲーションバーの高さを知ることができます。以下にその方法を示します：

```swift
import SwiftUI

struct ContentView: View {
    @State private var viewHeight: CGFloat = 0
    @State private var safeAreaHeight: CGFloat = 0

    var body: some View {
        NavigationView {
            VStack {
                Text("Navigation Bar Height: \(safeAreaHeight - viewHeight)")
                    .padding()

                Spacer()
            }
            .background(GeometryReader { geometry in
                Color.clear
                    .onAppear {
                        self.viewHeight = geometry.frame(in: .global).height
                        if let window = UIApplication.shared.windows.first {
                            self.safeAreaHeight = window.safeAreaLayoutGuide.layoutFrame.height
                        }
                    }
            })
            .navigationBarTitle("Title", displayMode: .inline)
        }
    }
}
```

### 解説

1. **GeometryReader**: `GeometryReader`を使用して、ビューの全体の高さを取得しています。この`geometry.frame(in: .global).height`がナビゲーションバーとコンテンツ全体を含む高さになります。

2. **safeAreaHeightの計算**: `UIApplication.shared.windows.first`を使用して、画面のセーフエリアの高さを取得しています。これにより、ナビゲーションバーやステータスバーを除いたコンテンツ領域の高さが得られます。

3. **ナビゲーションバーの高さの推定**: ナビゲーションバーの高さは、`safeAreaHeight - viewHeight`で計算されます。

この方法では、直接的にナビゲーションバーの高さを取得することはできませんが、`GeometryReader`と`UIApplication`の情報を組み合わせて、比較的シンプルに推定することが可能です。このコードを使うと、SwiftUIのみでナビゲーションバーの高さを取得する手段として、かなり簡潔に書くことができます。

---

## 👤 ユーザー
*2024/8/26 20:22:37*

sheetHeight に足して欲しい

            VStack {
                Spacer()
                VStack(spacing: 32) {
                    Text("退出してもボックス内のあなたの投稿データは消えません\\nこのボックス内での投稿を消したい場合は、ボックスを退出する前に削除することをおすすめします")
                        .fixedSize(horizontal: false, vertical: true)
                        .padding(.top, 16)
                
                    Button {
                        presenter.onTapLeaveBoxOk()
                    } label: {
                        Text("退出する")
                            .font(.title2)
                            .frame(height: 54)
                            .frame(maxWidth: .infinity)
                    }
                    .tint(.red)
                    .buttonStyle(.borderedProminent)
                    .clipShape(.rect(cornerRadius: 50))
                    
                    Button {
                        presenter.onTapLeaveBoxCancel()
                    } label: {
                        Text("キャンセル")
                            .font(.title2)
                            .frame(height: 54)
                            .frame(maxWidth: .infinity)
                    }
                    .tint(.secondary)
                    .buttonStyle(.borderedProminent)
                    .clipShape(.rect(cornerRadius: 50))
                    .padding(.bottom, 32)
                }
                .padding(.horizontal, 32)
            }
            .background(
                GeometryReader { geometry in
                    Color.clear
                        .task {
                            await MainActor.run {
                                print("geometry.size.height: \\(geometry.size.height)")
                                sheetHeight = geometry.size.height + ナビゲーションバーの高さ
                            }
                        }
                }
            )
            .navigationTitle("ボックスから退出")
            .navigationStacked()
            .presentationDetents(\[.height(sheetHeight)\])

---

## 🤖 アシスタント
*2024/8/26 20:23:18*

`sheetHeight`にナビゲーションバーの高さを追加するためには、まずナビゲーションバーの高さを取得し、その値を`sheetHeight`に足します。以前のコードを組み合わせて、ナビゲーションバーの高さを取得し、それを`sheetHeight`に加えるように変更しましょう。

以下のコードを使って、`sheetHeight`を動的に計算します。

```swift
import SwiftUI

struct ContentView: View {
    @State private var sheetHeight: CGFloat = 0
    @State private var navigationBarHeight: CGFloat = 0
    
    var body: some View {
        NavigationView {
            VStack {
                Spacer()
                VStack(spacing: 32) {
                    Text("退出してもボックス内のあなたの投稿データは消えません\nこのボックス内での投稿を消したい場合は、ボックスを退出する前に削除することをおすすめします")
                        .fixedSize(horizontal: false, vertical: true)
                        .padding(.top, 16)
                
                    Button {
                        // 退出する処理
                    } label: {
                        Text("退出する")
                            .font(.title2)
                            .frame(height: 54)
                            .frame(maxWidth: .infinity)
                    }
                    .tint(.red)
                    .buttonStyle(.borderedProminent)
                    .clipShape(RoundedRectangle(cornerRadius: 50))
                    
                    Button {
                        // キャンセル処理
                    } label: {
                        Text("キャンセル")
                            .font(.title2)
                            .frame(height: 54)
                            .frame(maxWidth: .infinity)
                    }
                    .tint(.secondary)
                    .buttonStyle(.borderedProminent)
                    .clipShape(RoundedRectangle(cornerRadius: 50))
                    .padding(.bottom, 32)
                }
                .padding(.horizontal, 32)
            }
            .background(
                GeometryReader { geometry in
                    Color.clear
                        .task {
                            await MainActor.run {
                                let currentHeight = geometry.size.height
                                sheetHeight = currentHeight + navigationBarHeight
                                print("Current Sheet Height: \(sheetHeight)")
                            }
                        }
                }
            )
            .navigationTitle("ボックスから退出")
            .background(NavigationBarAccessor { navigationBar in
                self.navigationBarHeight = navigationBar.frame.height
            })
            .navigationBarTitleDisplayMode(.inline)
            .presentationDetents([.height(sheetHeight)])
        }
    }
}

struct NavigationBarAccessor: UIViewControllerRepresentable {
    var callback: (UINavigationBar) -> Void
    
    func makeUIViewController(context: Context) -> UIViewController {
        UIViewController()
    }
    
    func updateUIViewController(_ uiViewController: UIViewController, context: Context) {
        if let navigationController = uiViewController.navigationController {
            callback(navigationController.navigationBar)
        }
    }
}
```

### 変更点の解説

1. **NavigationBarAccessor**: 以前と同じ方法で、`UINavigationBar`の高さを取得しています。

2. **sheetHeightの計算**: `GeometryReader`で取得した現在のシートの高さに、ナビゲーションバーの高さを追加しています。これにより、`sheetHeight`が常に最新の高さになるようにしています。

3. **presentationDetentsの更新**: `presentationDetents`を使用して、シートの高さを`sheetHeight`に設定します。ナビゲーションバーの高さを考慮した高さになります。

このアプローチにより、SwiftUIでナビゲーションバーの高さを考慮しながらシートの高さを動的に設定することができます。

---

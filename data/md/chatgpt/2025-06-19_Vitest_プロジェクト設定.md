# Vitest ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š

æ—¥ä»˜: 2025-06-19

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/06/20 01:24:28*

vitestã‚’å°å…¥ã—ã¦ã„ã‚‹ã®ã ã‘ã‚Œã©ã‚‚ãƒ¢ãƒãƒ¬ãƒã«ãªã£ã¦ã„ã‚‹ã€‚ 
æ˜”ã¯ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã¨ã„ã†ã‚‚ã®ã§ç®¡ç†ã—ã¦ã„ãŸã‚‰ã—ã„ã‘ã©ã€ä»Šã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã„ã†ã‚‚ã®ã§ç®¡ç†ã—ã¦ã„ã‚‹ã¿ãŸã„ã ã€‚ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®šã®ä»•æ–¹ã‚’æ•™ãˆã¦ã»ã—ã„ã€‚ 
ã¨ã‚Šã‚ãˆãšWebã¨ã‚µãƒ¼ãƒãƒ¼ã¨ã‚·ã‚§ã‚¢ã«åˆ†ã‹ã‚Œã¦ã„ã‚‹ã¨æ€ã£ã¦ã„ã„ã€‚
æœ¬å½“ã¯viteã‚’ä½¿ã£ã¦ã„ã‚‹ã€‚ 

https://vitest.dev/guide/projects

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/06/20 01:24:57*

### â€œworkspaceâ€ â†’ â€œprojectsâ€ ã¸ã®ç§»è¡Œãƒã‚¤ãƒ³ãƒˆ

- **Vitest 3.2 ã§ `workspace` ã¯éæ¨å¥¨ã¨ãªã‚Šã€`test.projects` è¨­å®šã«ç½®ãæ›ã‚ã‚Šã¾ã—ãŸ**ï¼ˆæ©Ÿèƒ½ã¯åŒã˜ã€‚åå‰ã ã‘å¤‰æ›´ï¼‰îˆ€citeîˆ‚turn3view0îˆ  
- 1 ãƒ—ãƒ­ã‚»ã‚¹å†…ã§è¤‡æ•°ã® **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆï¼ã‚µãƒ–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚„ãƒ†ã‚¹ãƒˆç¨®åˆ¥ï¼‰** ã‚’èµ°ã‚‰ã›ã‚‰ã‚Œã‚‹ã®ã§ã€ãƒ¢ãƒãƒ¬ãƒã¨ã®ç›¸æ€§ãŒè‰¯ã„ã§ã™ã€‚îˆ€citeîˆ‚turn3view0îˆ  

---

## å…¸å‹çš„ãªãƒ¢ãƒãƒ¬ãƒæ§‹æˆä¾‹  
```
root/
â”œâ”€ vitest.config.ts          # ãƒ«ãƒ¼ãƒˆè¨­å®šï¼ˆå…¨ä½“å…±é€šï¼‰
â”œâ”€ vitest.shared.ts          # å…±é€šãƒ†ã‚¹ãƒˆè¨­å®šï¼ˆä»»æ„ï¼‰
â””â”€ packages/
   â”œâ”€ web/                   # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (Vite + React ç­‰)
   â”‚   â”œâ”€ src/
   â”‚   â””â”€ vitest.config.ts   # Web å°‚ç”¨è¨­å®š
   â”œâ”€ server/                # Node ã‚µãƒ¼ãƒãƒ¼
   â”‚   â””â”€ vitest.config.ts
   â””â”€ shared/                # å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒª
       â””â”€ vitest.config.ts
```

---

## 1ï¸âƒ£ ãƒ«ãƒ¼ãƒˆ `vitest.config.ts`

```ts
import { defineConfig } from 'vitest/config'

export default defineConfig({
  // Vite ã®å…±æœ‰ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚‚ã“ã“ã§è¨­å®šå¯
  test: {
    pool: 'threads',           // â±ï¸ ä¸¦åˆ—å®Ÿè¡Œ
    // packages/* ã‚’ â€œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆâ€ ã¨ã—ã¦æ‰±ã†
    projects: ['packages/*'],
    // ãƒ«ãƒ¼ãƒˆå´ã®ã¿ã«ç½®ã‘ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³
    reporters: ['default', 'junit'],
    coverage: {
      provider: 'v8',
      reportsDirectory: './coverage',
    },
  },
})
```
ãƒã‚¤ãƒ³ãƒˆ  

| é …ç›® | æ„å‘³ |
|------|------|
| `projects: ['packages/*']` | `packages` é…ä¸‹ã‚’ä¸¸ã”ã¨èµ°æŸ»ã€‚å€‹ã€…ã® config ãŒç„¡ãã¦ã‚‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ‰±ã„ã«ãªã‚‹îˆ€citeîˆ‚turn3view0îˆ |
| ãƒ«ãƒ¼ãƒˆ config ã¯ **ãƒ†ã‚¹ãƒˆå¯¾è±¡ã«ã¯ãªã‚‰ãªã„**ã€‚å¿…è¦ãªã‚‰è‡ªèº«ã‚‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«è¿½åŠ ã™ã‚‹ |
| `coverage`, `reporters` ãªã©ã¯ **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå´ã§ã¯è¨­å®šä¸å¯**ã€‚ãƒ«ãƒ¼ãƒˆã§ä¸€æ‹¬æŒ‡å®šã™ã‚‹îˆ€citeîˆ‚turn1view0îˆ |

---

## 2ï¸âƒ£ å„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å´ã® `vitest.config.ts`

### `packages/web/vitest.config.ts`
```ts
import { defineProject, mergeConfig } from 'vitest/config'
import shared from '../../vitest.shared'
import react from '@vitejs/plugin-react'

export default mergeConfig(
  shared,                      // å…±é€šè¨­å®šã‚’ãƒãƒ¼ã‚¸
  defineProject({
    plugins: [react()],
    test: {
      name: { label: 'web', color: 'cyan' }, // ãƒ©ãƒ™ãƒ«è‰²ã‚‚è¨­å®šå¯
      environment: 'jsdom',   // DOM API ãŒå¿…è¦
      globals: true,
      setupFiles: ['./test/setup.ts'],
      alias: {                // Vite ã®åˆ¥åã‚‚ OK
        '~': '/src',
      },
    },
  }),
)
```

### `packages/server/vitest.config.ts`
```ts
import { defineProject } from 'vitest/config'

export default defineProject({
  test: {
    name: 'server',
    environment: 'node',
    setupFiles: ['./test/setup.ts'],
  },
})
```

### `packages/shared/vitest.config.ts`
```ts
import { defineProject } from 'vitest/config'

export default defineProject({
  test: {
    name: 'shared',
    environment: 'node',
  },
})
```

&gt; **Tip** : `defineProject` ã‚’ä½¿ã†ã¨ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç”¨ã«è¨±å¯ã•ã‚Œã¦ã„ãªã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å‹ãƒ¬ãƒ™ãƒ«ã§å¼¾ã„ã¦ãã‚Œã‚‹ã®ã§å®‰å…¨ã§ã™îˆ€citeîˆ‚turn3view0îˆã€‚

---

## 3ï¸âƒ£ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰

- ã™ã¹ã¦ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ  
  ```bash
  pnpm vitest
  # ã¾ãŸã¯ npm run test / bun run test
  ```
- ç‰¹å®šãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã ã‘  
  ```bash
  pnpm vitest --project web          # web ã ã‘
  pnpm vitest --project web --project server  # è¤‡æ•°æŒ‡å®šã‚‚å¯
  ```îˆ€citeîˆ‚turn3view0îˆ

---

## 4ï¸âƒ£ â€œworkspaceâ€ ã‹ã‚‰ã®ç§»è¡Œãƒ¡ãƒ¢

| æ—§ (`workspace`) | æ–° (`projects`) |
|------------------|-----------------|
| `test.workspace = [...]` | `test.projects = [...]` |
| å‹•ä½œã¯åŒã˜ã€‚åå‰ã‚’å¤‰ãˆã‚‹ã ã‘ | 3.2 ä»¥é™ã¯ã“ã¡ã‚‰æ¨å¥¨îˆ€citeîˆ‚turn3view0îˆ |

---

### ã¾ã¨ã‚
1. **ãƒ«ãƒ¼ãƒˆ**ã§ `test.projects` ã«ãƒ‘ã‚¹ or ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³è¨­å®šã‚’ä¸¦ã¹ã‚‹ã€‚  
2. **å„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸**ã¯ `defineProject` ã¾ãŸã¯ `mergeConfig` ã§å€‹åˆ¥è¨­å®šã€‚  
3. `coverage`ãƒ»`reporters` ç­‰ã® **ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®šã¯ãƒ«ãƒ¼ãƒˆã®ã¿**ã€‚  
4. å®Ÿè¡Œæ™‚ã¯ `--project` ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã€‚  

ã“ã‚Œã§ Webï¼Serverï¼Shared ãã‚Œãã‚Œã®è¨­å®šã‚’åˆ†é›¢ã—ã¤ã¤ã€ãƒ¢ãƒãƒ¬ãƒå…¨ä½“ã‚’ï¼‘ã‚³ãƒãƒ³ãƒ‰ã§ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚

---

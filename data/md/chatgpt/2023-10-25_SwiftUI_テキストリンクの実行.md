# SwiftUI テキストリンクの実行

Date: 2023-10-25

---

## 👤 User
*2023-10-25 15:55:48*

SwiftUIで埋め込みのテキストリンクを使って、そのリンクをタップすると関数を実行するようにしたい。どうすればいいか。

---

## 🤖 Assistant
*2023-10-25 15:56:08*

SwiftUIで埋め込みのテキストリンクを使って関数を実行するには、`Text`ビューの中に`TapGesture`を使用する方法が考えられます。以下はその例です：

```swift
import SwiftUI

struct ContentView: View {
    
    var body: some View {
        Text("これは")
            + Text("リンク").underline().foregroundColor(.blue)
                .onTapGesture {
                    linkTapped()
                }
            + Text("のサンプルです。")
    }
    
    func linkTapped() {
        print("リンクがタップされました。")
        // 他の処理をここに追加
    }
}

struct ContentView_Previews: PreviewProvider {
    static var previews: some View {
        ContentView()
    }
}
```

この例では、"リンク"というテキストがアンダーラインを引かれ、青色になっています。それをタップすると`linkTapped`関数が実行されます。これでテキスト内に埋め込んだリンクをタップして関数を実行することができます。

---

## 👤 User
*2023-10-25 15:56:29*

これって適切に改行されるのかな？’

---

## 🤖 Assistant
*2023-10-25 15:57:03*

すみません、おっしゃる通り、上記の例ではテキストが横に並ぶだけです。複数行にわたるテキストでのリンクを埋め込む場合や、テキストが自動的に改行されるべき場面での動作を確認するための適切な方法は、`Text` ビューを結合するのではなく、`AttributedString` を使用することです。

SwiftUI 3.0 (iOS 15以降) では、`AttributedString` を使用してテキストの中にアクションを埋め込むことができます。

以下は、`AttributedString` を使用して、テキストの中の特定の部分にリンクを埋め込む例です：

```swift
import SwiftUI

struct ContentView: View {
    @State private var text = AttributedString("これはリンクのサンプルです。")

    init() {
        let linkRange = text.range(of: "リンク")
        
        if let range = linkRange {
            text[range].link = "action://linkTapped"
            text[range].underline = .single
            text[range].foregroundStyle = .color(.blue)
        }
    }

    var body: some View {
        AttributedText(text)
            .onLinkDetection { link in
                if link == "action://linkTapped" {
                    linkTapped()
                }
            }
    }

    func linkTapped() {
        print("リンクがタップされました。")
        // 他の処理をここに追加
    }
}

struct ContentView_Previews: PreviewProvider {
    static var previews: some View {
        ContentView()
    }
}
```

この方法では、テキストが適切に改行され、リンク部分も正しく動作します。

---

## 👤 User
*2023-10-25 15:59:23*

onLinkDetectionってなに？

---

## 🤖 Assistant
*2023-10-25 16:00:07*

申し訳ございません、私が提供したコードの中に誤りが含まれていました。`onLinkDetection` はSwiftUIには存在しないプロパティです。

正確には、`AttributedString` にリンクを埋め込む際に、URLScheme を使用することができ、`Link` とともに使うことでタップを検知することができますが、それを直接テキスト内部でのタップイベントとして取得する公式の手法は存在しないため、カスタムの機能を組み込む必要があります。

ただし、以下のように簡易的に`AttributedString` と `Link` を使用してリンクの動作を模倣することはできます。

```swift
import SwiftUI

struct ContentView: View {
    var body: some View {
        VStack(alignment: .leading) {
            Text("これは")
            Link("リンク", destination: URL(string: "https://www.example.com")!)
                .onTapGesture {
                    linkTapped()
                }
            Text("のサンプルです。")
        }
    }

    func linkTapped() {
        print("リンクがタップされました。")
        // 他の処理をここに追加
    }
}

struct ContentView_Previews: PreviewProvider {
    static var previews: some View {
        ContentView()
    }
}
```

この方法では、`Link` のタップを検知して `linkTapped` 関数を呼び出しますが、見た目としては `Link` が独立した行に表示されるため、完全に埋め込みのテキストリンクとしての見た目を実現するのは難しいです。

完全な埋め込みのテキストリンクとしての動作を求める場合、カスタムのビューを作成するなど、さらなる工夫が必要となります。

---

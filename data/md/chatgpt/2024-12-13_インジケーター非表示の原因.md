# インジケーター非表示の原因

日付: 2024-12-13

---

## 👤 ユーザー
*2024/12/13 16:07:28*

インジケーターが表示されない。

import 'package:flutter/material.dart';
import 'package:go_router/go_router.dart';
import 'package:snpit_guild_app/domain/screen.dart';
import 'package:snpit_guild_app/utils/extensions/uri_extensions.dart';

class SpotListPage extends StatelessWidget {
  const SpotListPage({super.key});

  @override
  Widget build(BuildContext context) {
    final spotList = List.generate(
      12,
      (index) =&gt; {
        'imageUrl': UriExtensions.randomImageUrl.toString(),
        'label': String.fromCharCode(65 + index),
      },
    );

    return Scaffold(
      appBar: AppBar(
        automaticallyImplyLeading: false,
        title: const Text('Spot list'),
        actions: [
          IconButton(
            icon: const Icon(Icons.close),
            onPressed: () {
              // ボトムシート全体を閉じる
              Navigator.of(context, rootNavigator: true).pop();
            },
          ),
        ],
      ),
      body: GridView.builder(
        padding: const EdgeInsets.all(16),
        gridDelegate: const SliverGridDelegateWithFixedCrossAxisCount(
          crossAxisCount: 3,
          crossAxisSpacing: 8,
          mainAxisSpacing: 8,
        ),
        itemCount: spotList.length,
        itemBuilder: (context, index) {
          final spot = spotList[index];
          final imageUrl = spot['imageUrl']!;
          final label = spot['label']!;

          return GestureDetector(
            onTap: () {
              context.push(Screen.spotDetail.path);
            },
            child: Stack(
              alignment: Alignment.bottomCenter,
              children: [
                ClipRRect(
                  borderRadius: BorderRadius.circular(8),
                  child: Image.network(
                    imageUrl,
                    fit: BoxFit.cover,
                    width: double.infinity,
                    height: double.infinity,
                    loadingBuilder: (context, child, loadingProgress) {
                      if (loadingProgress == null) {
                        return child;
                      }
                      return const Center(
                        child: CircularProgressIndicator(),
                      );
                    },
                    errorBuilder: (context, error, stackTrace) {
                      return const Center(
                        child: Icon(Icons.error, color: Colors.red),
                      );
                    },
                  ),
                ),

                Positioned(
                  top: 8,
                  left: 8,
                  child: Container(
                    padding:
                        const EdgeInsets.symmetric(horizontal: 8, vertical: 4),
                    decoration: BoxDecoration(
                      color: Colors.black.withOpacity(0.5),
                      borderRadius: BorderRadius.circular(4),
                    ),
                    child: Text(
                      label,
                      style: const TextStyle(color: Colors.white, fontSize: 12),
                    ),
                  ),
                ),
              ],
            ),
          );
        },
      ),
    );
  }
}

---

## 🤖 アシスタント
*2024/12/13 16:07:43*

インジケーターが表示されない原因として以下の点を確認してください。

1. **`UriExtensions.randomImageUrl.toString()` の正確性**:
   - `UriExtensions.randomImageUrl` が適切な画像URLを生成していることを確認してください。
   - 無効なURLが生成されると、`loadingBuilder` がトリガーされない可能性があります。

2. **ネットワークの接続**:
   - デバイスがインターネットに接続されていることを確認してください。
   - ネットワークエラーが発生している場合、画像の読み込みが失敗する可能性があります。

3. **画像の読み込み状態 (`loadingProgress`) の確認**:
   - `loadingBuilder` の中で `loadingProgress` が `null` になる前にインジケーターが消える場合、画像の読み込みに問題がある可能性があります。
   - デバッグして `loadingProgress` がどのような値を返しているか確認してください。

4. **デザインに関する問題**:
   - `CircularProgressIndicator` が非表示になっている原因として、レイアウトの問題や色が背景と同化している可能性があります。

修正版の `loadingBuilder` を以下のようにデバッグしてみてください：

```dart
loadingBuilder: (context, child, loadingProgress) {
  if (loadingProgress == null) {
    return child;
  }
  print("Loading in progress: ${loadingProgress.cumulativeBytesLoaded}/${loadingProgress.expectedTotalBytes}");
  return const Center(
    child: CircularProgressIndicator(),
  );
},
```

5. **`UriExtensions.randomImageUrl` の代わりにスタティックURLをテスト**:
   - 問題が `UriExtensions` に起因するか切り分けるため、スタティックなURLを使用してテストしてください。

```dart
final spotList = List.generate(
  12,
  (index) => {
    'imageUrl': 'https://via.placeholder.com/150', // スタティックURL
    'label': String.fromCharCode(65 + index),
  },
);
```

6. **画像キャッシュのクリア**:
   - 一部の環境では、キャッシュされた画像が読み込みを妨げることがあります。
   - キャッシュをクリアして再テストしてください。

これでも問題が解決しない場合、`flutter run` のログを確認して、エラーメッセージや警告がないか確認してください。また、詳細を提供していただければ、さらに深堀りできます。

---

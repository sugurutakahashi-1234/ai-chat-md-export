# æ–‡å­—åˆ—åˆ‡ã‚Šæ¨ã¦å®Ÿè£…

æ—¥ä»˜: 2024-03-08

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/03/08 16:15:24*

///
/// @param name The name of the event. Should contain 1 to 40 alphanumeric characters or
///     underscores. The name must start with an alphabetic character. Some event names are
///     reserved. See FIREventNames.h for the list of reserved event names. The "firebase_",
///     "google_", and "ga_" prefixes are reserved and should not be used. Note that event names are
///     case-sensitive and that logging two events whose names differ only in case will result in
///     two distinct events. To manually log screen view events, use the `screen_view` event name.
/// @param parameters The dictionary of event parameters. Passing `nil` indicates that the event has
///     no parameters. Parameter names can be up to 40 characters long and must start with an
///     alphabetic character and contain only alphanumeric characters and underscores. Only String,
///     Int, and Double parameter types are supported. String parameter values can be up to 100
///     characters long for standard Google Analytics properties, and up to 500 characters long for
///     Google Analytics 360 properties. The "firebase_", "google_", and "ga_" prefixes are reserved
///     and should not be used for parameter names.
+ (void)logEventWithName:(NSString *)name
              parameters:(nullable NSDictionary&lt;NSString *, id&gt; *)parameters
    NS_SWIFT_NAME(logEvent(_:parameters:));



Parameters
name
The name of the event. Should contain 1 to 40 alphanumeric characters or underscores. The name must start with an alphabetic character. Some event names are reserved. See FIREventNames.h for the list of reserved event names. The â€œfirebase_â€, â€œgoogle_â€, and â€œga_â€ prefixes are reserved and should not be used. Note that event names are case-sensitive and that logging two events whose names differ only in case will result in two distinct events. To manually log screen view events, use the screen_view event name.

parameters
The dictionary of event parameters. Passing nil indicates that the event has no parameters. Parameter names can be up to 40 characters long and must start with an alphabetic character and contain only alphanumeric characters and underscores. Only String, Int, and Double parameter types are supported. String parameter values can be up to 100 characters long for standard Google Analytics properties, and up to 500 characters long for Google Analytics 360 properties. The â€œfirebase_â€, â€œgoogle_â€, and â€œga_â€ prefixes are reserved and should not be used for parameter names.



public class FirebaseLogDriver: FirebaseLogDriverProtocol {
    public init() {
        LogDriver.initLog()
    }

    deinit {
        LogDriver.deinitLog()
    }

    public func log(_ event: LogEventType, level: LogLevel, file: String, function: String, line: Int) {
        Analytics.logEvent(
            event.logEvent.instanceSnakeCasedStructName,
            parameters: event.logEvent.toAnalyticsPropertiesWithMetadata(level: level, file: file, function: function, line: line)
        )
    }
}

extension LoggableEntity {
    func toAnalyticsPropertiesWithMetadata(level: LogLevel, file: String, function: String, line: Int) -&gt; [String: Any] {
        let metadata: [String: Any] = [
            "log_level": level.name,
            "file": file,
            "function": function,
            "line": line,
        ]
        return toAnalyticsProperties.merging(metadata, uniquingKeysWith: { _, new in new })
    }

    /// AWS ã‚„ Protocol Buffers ã‚’è€ƒæ…®ã® IF ã‚’è€ƒæ…®ã—ã¦ String, Int, Double, Bool ã®ã¿ã‚’è¨±å®¹ã—ã¦ã‚‹
    private var toAnalyticsProperties: [String: Any] {
        toDictionary(caseFormat: .snakeCase).mapValues { value in
            switch value {
            case let intValue as Int:
                intValue
            case let stringValue as String:
                stringValue
            case let doubleValue as Double:
                doubleValue
            case let floatValue as Float:
                Double(floatValue)
            case let boolValue as Bool:
                boolValue
            case let dateValue as Date:
                ISO8601DateFormatter.sharedWithFractionalSeconds.string(from: dateValue)
            default:
                String(describing: value)
            }
        }
    }
}


10.22.1 - [FirebaseAnalytics][I-ACS013000] Event parameter value is too long. The maximum supported length is 100: AppInfo(appUpdateInfo: DomainLayer.AppUpdateInfo(minimumRequiredAppVersion: "1.2.3", appUpdateUrl: "https://example.com/update"), maintenanceInfo: DomainLayer.MaintenanceInfo(isMaintenance: true, maintenanceAlertTitle: "Maintenance Mode", maintenanceAlertMessage: "Our app is currently under maintenance. Please check back later."))

100æ–‡å­—ä»¥ä¸‹ã«ã™ã‚‹å‡¦ç†ã‚’æœ€å¾Œã«ã„ã‚ŒãŸã„ã€‚
ã©ã†ã™ã‚Œã°ã„ã„ã‹å€™è£œã‚’ã‚ã’ã¦ã»ã—ã„ã€‚
æ—¥æœ¬èªã§å›ç­”ã—ã¦ãã ã•ã„ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/03/08 16:16:37*

ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å€¤ãŒ100æ–‡å­—ã‚’è¶…ãˆã‚‹å ´åˆã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ–¹æ³•ã§å¯¾å‡¦ã§ãã¾ã™ã€‚é©ç”¨ã™ã‚‹æ–¹æ³•ã¯ã€ãƒ‡ãƒ¼ã‚¿ã®æ€§è³ªã‚„è¦ä»¶ã«å¿œã˜ã¦é¸æŠã—ã¦ãã ã•ã„ã€‚

1. **æ–‡å­—åˆ—ã‚’åˆ‡ã‚Šæ¨ã¦ã‚‹**: æ–‡å­—åˆ—ã®é•·ã•ãŒ100æ–‡å­—ã‚’è¶…ãˆã‚‹å ´åˆã€æœ€åˆã®100æ–‡å­—ã ã‘ã‚’ä½¿ç”¨ã—ã€æ®‹ã‚Šã¯åˆ‡ã‚Šæ¨ã¦ã¾ã™ã€‚ã“ã®æ–¹æ³•ã¯æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã§ã€å®Ÿè£…ãŒå®¹æ˜“ã§ã™ãŒã€é‡è¦ãªæƒ…å ±ãŒå¤±ã‚ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

2. **è¦ç´„ã‚’ä½¿ç”¨ã™ã‚‹**: æ–‡å­—åˆ—ãŒé•·ã„å ´åˆã€è¦ç´„ã¾ãŸã¯æŠ½è±¡åŒ–ã—ã¦çŸ­ç¸®ç‰ˆã‚’ç”Ÿæˆã—ã¾ã™ã€‚ä¾‹ãˆã°ã€é•·ã„èª¬æ˜æ–‡ã‹ã‚‰ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æŠ½å‡ºã—ã€ãã‚Œã‚‰ã‚’çµ„ã¿åˆã‚ã›ã¦çŸ­ã„æ–‡å­—åˆ—ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®æ–¹æ³•ã¯ã‚ˆã‚Šè¤‡é›‘ã§ã™ãŒã€é‡è¦ãªæƒ…å ±ã‚’ä¿æŒã™ã‚‹å¯èƒ½æ€§ãŒé«˜ããªã‚Šã¾ã™ã€‚

3. **ãƒãƒƒã‚·ãƒ¥é–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹**: é•·ã„æ–‡å­—åˆ—ã‚’ãƒãƒƒã‚·ãƒ¥å€¤ã«å¤‰æ›ã—ã¦ä½¿ç”¨ã—ã¾ã™ã€‚ãƒãƒƒã‚·ãƒ¥é–¢æ•°ã¯ä»»æ„ã®é•·ã•ã®ãƒ‡ãƒ¼ã‚¿ã‚’å›ºå®šé•·ã®å‡ºåŠ›ã«å¤‰æ›ã—ã¾ã™ã€‚ã“ã®æ–¹æ³•ã§ã¯å…ƒã®æƒ…å ±ã¯å¾©å…ƒã§ãã¾ã›ã‚“ãŒã€ãƒ‡ãƒ¼ã‚¿ã®ä¸€æ„æ€§ã‚’ä¿æŒã™ã‚‹ãŸã‚ã®è­˜åˆ¥å­ã¨ã—ã¦åˆ©ç”¨ã§

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/03/08 16:16:50*

1ç•ªã®å®Ÿè£…ä¾‹ã‚’ã—ã¦ã»ã—ã„

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/03/08 16:18:57*

1ç•ªã®ã€Œæ–‡å­—åˆ—ã‚’åˆ‡ã‚Šæ¨ã¦ã‚‹ã€æ–¹æ³•ã®å®Ÿè£…ä¾‹ã‚’ç¤ºã—ã¾ã™ã€‚ã“ã®ä¾‹ã§ã¯ã€ã‚¤ãƒ™ãƒ³ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å€¤ãŒ100æ–‡å­—ã‚’è¶…ãˆã‚‹å ´åˆã«ã€æœ€åˆã®100æ–‡å­—ã ã‘ã‚’ä¿æŒã—ã€æ®‹ã‚Šã‚’åˆ‡ã‚Šæ¨ã¦ã‚‹ã‚ˆã†ã«`toAnalyticsProperties`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä¿®æ­£ã—ã¾ã™ã€‚

```swift
extension LoggableEntity {
    func toAnalyticsPropertiesWithMetadata(level: LogLevel, file: String, function: String, line: Int) -> [String: Any] {
        let metadata: [String: Any] = [
            "log_level": level.name,
            "file": file,
            "function": function,
            "line": line,
        ]
        return toAnalyticsProperties.merging(metadata, uniquingKeysWith: { _, new in new })
    }

    private var toAnalyticsProperties: [String: Any] {
        toDictionary(caseFormat: .snakeCase).mapValues { value in
            switch value {
            case let intValue as Int:
                intValue
            case let stringValue as String:
                // æ–‡å­—åˆ—ã®é•·ã•ã‚’ç¢ºèªã—ã€100æ–‡å­—ã‚’è¶…ãˆã‚‹å ´åˆã¯æœ€åˆã®100æ–‡å­—ã‚’ä¿æŒ
                stringValue.count > 100 ? String(stringValue.prefix(100)) : stringValue
            case let doubleValue as Double:
                doubleValue
            case let floatValue as Float:
                Double(floatValue)
            case let boolValue as Bool:
                boolValue
            case let dateValue as Date:
                ISO8601DateFormatter.sharedWithFractionalSeconds.string(from: dateValue)
            default:
                let stringDescription = String(describing: value)
                // æ–‡å­—åˆ—å¤‰æ›å¾Œã®é•·ã•ã‚’ç¢ºèªã—ã€100æ–‡å­—ã‚’è¶…ãˆã‚‹å ´åˆã¯æœ€åˆã®100æ–‡å­—ã‚’ä¿æŒ
                return stringDescription.count > 100 ? String(stringDescription.prefix(100)) : stringDescription
            }
        }
    }
}
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€`toAnalyticsProperties`ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ã€`String`å‹ã®å€¤ã‚’æ‰±ã†å ´åˆã«æ–‡å­—åˆ—ã®é•·ã•ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€100æ–‡å­—ã‚’è¶…ãˆã‚‹å ´åˆã¯å…ˆé ­ã‹ã‚‰100æ–‡å­—ã ã‘ã‚’ä½¿ç”¨ã—ã¦æ®‹ã‚Šã‚’åˆ‡ã‚Šæ¨ã¦ã¦ã„ã¾ã™ã€‚`default`ã‚±ãƒ¼ã‚¹ã§ã‚‚åŒæ§˜ã®å‡¦ç†ã‚’è¡Œã„ã€`String(describing:)`ã«ã‚ˆã£ã¦å¤‰æ›ã•ã‚ŒãŸæ–‡å­—åˆ—ã‚‚åŒã˜ãƒ«ãƒ¼ãƒ«ã‚’é©ç”¨ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€Firebase Analyticsã«é€ä¿¡ã•ã‚Œã‚‹ã‚¤ãƒ™ãƒ³ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ–‡å­—åˆ—é•·ãŒ100æ–‡å­—ä»¥ä¸‹ã«ä¿ãŸã‚Œã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/03/08 16:19:43*

toAnalyticsProperties ã§å‡¦ç†ã™ã‚‹ã®ã§ã¯ãªãã¦ã€è¾æ›¸å‹ã®ValueãŒStringã®ã¨ãã«100æ–‡å­—ä»¥ä¸‹ã«ã™ã‚‹ã®ã¯ã©ã†ï¼Ÿ

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/03/08 16:21:36*

è¾æ›¸å‹ã®`Value`ãŒ`String`ã®ã¨ãã«100æ–‡å­—ä»¥ä¸‹ã«åˆ¶é™ã™ã‚‹å ´åˆã€ã‚¤ãƒ™ãƒ³ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ãƒ­ã‚°ã«é€ä¿¡ã™ã‚‹ç›´å‰ã«æ–‡å­—åˆ—ã‚’åˆ‡ã‚Šæ¨ã¦ã‚‹å‡¦ç†ã‚’å…¥ã‚Œã‚‹æ–¹æ³•ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã¯ã€è¾æ›¸å…¨ä½“ã‚’ãƒ«ãƒ¼ãƒ—ã—ã¦`String`å‹ã®å€¤ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€å¿…è¦ã«å¿œã˜ã¦ä¿®æ­£ã—ã¾ã™ã€‚ã“ã“ã§ã¯ã€`logEvent`ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ãã®å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ä¾‹ã‚’ç¤ºã—ã¾ã™ã€‚

```swift
public class FirebaseLogDriver: FirebaseLogDriverProtocol {
    public init() {
        LogDriver.initLog()
    }

    deinit {
        LogDriver.deinitLog()
    }

    public func log(_ event: LogEventType, level: LogLevel, file: String, function: String, line: Int) {
        var parameters = event.logEvent.toAnalyticsPropertiesWithMetadata(level: level, file: file, function: function, line: line)
        
        // è¾æ›¸å†…ã®Stringå‹ã®ValueãŒ100æ–‡å­—ã‚’è¶…ãˆã‚‹å ´åˆã¯ã€100æ–‡å­—ã«åˆ‡ã‚Šæ¨ã¦ã‚‹
        parameters = parameters.mapValues { value in
            if let stringValue = value as? String, stringValue.count > 100 {
                return String(stringValue.prefix(100))
            }
            return value
        }
        
        Analytics.logEvent(
            event.logEvent.instanceSnakeCasedStructName,
            parameters: parameters
        )
    }
}
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€`log`ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ã‚¤ãƒ™ãƒ³ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è¾æ›¸(`parameters`)ã‚’å¤‰æ›´ã—ã¦ã„ã¾ã™ã€‚è¾æ›¸å†…ã®å„è¦ç´ ã«å¯¾ã—ã¦ã€å€¤ãŒ`String`å‹ã§ã‚ã‚‹å ´åˆã«ãã®é•·ã•ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€100æ–‡å­—ã‚’è¶…ãˆã‚‹å ´åˆã¯å…ˆé ­ã‹ã‚‰100æ–‡å­—ã®ã¿ã‚’å–å¾—ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€`Analytics.logEvent`ãƒ¡ã‚½ãƒƒãƒ‰ã«æ¸¡ã™ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å€¤ã‚’ã€Firebase Analyticsã®è¦ä»¶ã«åˆã‚ã›ã¦100æ–‡å­—ä»¥ä¸‹ã«åˆ¶é™ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/03/08 16:21:39*

ã“ã®å‡¦ç†ã‚’è¾æ›¸å‹ã®extensionã«ã™ã‚‹ã“ã¨ã¯ã§ããªã„ã®ï¼Ÿâ€¨â€¨parameters = parameters.mapValues { value in
            if let stringValue = value as? String, stringValue.count &gt; 100 {
                return String(stringValue.prefix(100))
            }
            return value
        }

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/03/08 16:23:02*

ã¯ã„ã€ãã®å‡¦ç†ã‚’è¾æ›¸å‹ã®`extension`ã«ã™ã‚‹ã“ã¨ã¯å¯èƒ½ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€è¾æ›¸å†…ã®`String`å‹ã®å€¤ãŒ100æ–‡å­—ä»¥ä¸Šã®å ´åˆã«100æ–‡å­—ã«åˆ‡ã‚Šæ¨ã¦ã‚‹å‡¦ç†ã‚’ã€ã‚ˆã‚Šæ±ç”¨çš„ã«å†åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«`Dictionary`ã®`extension`ã‚’å®šç¾©ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```swift
extension Dictionary where Value == Any {
    func trimmingValuesToMaxLength(_ maxLength: Int) -> [Key: Value] {
        return self.mapValues { value in
            if let stringValue = value as? String, stringValue.count > maxLength {
                return String(stringValue.prefix(maxLength))
            }
            return value
        }
    }
}
```

ã“ã®`extension`ã¯`Value`ãŒ`Any`å‹ã®`Dictionary`ã«å¯¾ã—ã¦å®šç¾©ã•ã‚Œã¦ãŠã‚Šã€`trimmingValuesToMaxLength`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’é€šã˜ã¦è¾æ›¸å†…ã®å…¨ã¦ã®`String`å‹ã®å€¤ã‚’æŒ‡å®šã•ã‚ŒãŸæœ€å¤§é•·ã«åŸºã¥ã„ã¦åˆ‡ã‚Šæ¨ã¦ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä½¿ç”¨æ–¹æ³•ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

```swift
// Eventãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€100æ–‡å­—ã«åˆ¶é™ã‚’ã‹ã‘ã‚‹ä¾‹
var parameters = event.logEvent.toAnalyticsPropertiesWithMetadata(level: level, file: file, function: function, line: line)

// è¾æ›¸å†…ã®Stringå‹ã®å€¤ã‚’100æ–‡å­—ã«åˆ¶é™
parameters = parameters.trimmingValuesToMaxLength(100)

// ä¿®æ­£ã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒ­ã‚°
Analytics.logEvent(
    event.logEvent.instanceSnakeCasedStructName,
    parameters: parameters
)
```

ã“ã®æ–¹æ³•ã‚’ç”¨ã„ã‚‹ã“ã¨ã§ã€ä»»æ„ã®è¾æ›¸ã«å¯¾ã—ã¦ä¸€è²«ã—ãŸæ–‡å­—æ•°åˆ¶é™ã®å‡¦ç†ã‚’é©ç”¨ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã€ã‚³ãƒ¼ãƒ‰ã®å†åˆ©ç”¨æ€§ã¨å¯èª­æ€§ãŒå‘ä¸Šã—ã¾ã™ã€‚

---

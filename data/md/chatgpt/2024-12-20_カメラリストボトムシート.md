# カメラリストボトムシート

Date: 2024-12-20

---

## 👤 User
*2024-12-20 17:04:31*

{
  "content_type": "image_asset_pointer",
  "asset_pointer": "file-service://file-JHcXgpsEh24VVPnM5HkVXN",
  "size_bytes": 73131,
  "width": 651,
  "height": 528,
  "fovea": null,
  "metadata": {
    "dalle": null,
    "gizmo": null,
    "generation": null,
    "container_pixel_height": null,
    "container_pixel_width": null,
    "emu_omit_glimpse_image": null,
    "emu_patches_override": null,
    "sanitized": true,
    "asset_pointer_link": null,
    "watermarked_asset_pointer": null
  }
}

画像のような実装に近づけたい

- Put camera で CameraListPage を Bottomのシートから立ち上げる
- HookConsumerWidget を使っていいよ
- cameraListは一旦文字列の配列だけでいいよ ビルド関数の中で変数宣言するだけでいい
- 色は後でつけるので定義しなくていい
- ざっくりでいい
- 画像は一旦全部カメラのアイコンを使って欲しい

import 'package:flutter/material.dart';
import 'package:go_router/go_router.dart';

class DeckDetailPage extends StatelessWidget {
  const DeckDetailPage({super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: const Text('Edit Deck')),
      body: const Center(
        child: Text('Edit Deck Content Here'),
      ),
      bottomNavigationBar: SafeArea(
        child: Padding(
          padding: const EdgeInsets.all(16),
          child: ElevatedButton(
            onPressed: () {
              context.pop();
            },
            child: const Text('Save'),
          ),
        ),
      ),
    );
  }
}

import 'package:flutter/material.dart';

class CameraListPage extends StatelessWidget {
  const CameraListPage({super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: const Text('CameraListPage')),
      body: const Center(child: Text('CameraListPage')),
    );
  }
}

---

## 🤖 Assistant
*2024-12-20 17:05:05*

以下のようなコードで、「Put Camera」ボタンを押した際に `CameraListPage` をボトムシートとして表示するUIを実装できます。

以下にコードを示します。

```dart
import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';

class DeckDetailPage extends HookConsumerWidget {
  const DeckDetailPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    // 仮のカメラリスト
    final cameraList = useState<List<String>>(["Camera A", "Camera B", "Camera C"]);
    final selectedCameras = useState<List<String>>([]);

    return Scaffold(
      appBar: AppBar(
        title: const Text('Edit Deck'),
      ),
      body: Padding(
        padding: const EdgeInsets.all(16.0),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Row(
              mainAxisAlignment: MainAxisAlignment.spaceBetween,
              children: const [
                Text('Search: 3,879', style: TextStyle(fontSize: 16)),
                Text('Attack: 1,230', style: TextStyle(fontSize: 16)),
              ],
            ),
            Row(
              mainAxisAlignment: MainAxisAlignment.spaceBetween,
              children: const [
                Text('Luck: 893', style: TextStyle(fontSize: 16)),
                Text('Defence: 905', style: TextStyle(fontSize: 16)),
              ],
            ),
            const SizedBox(height: 16),
            Expanded(
              child: ListView.builder(
                itemCount: selectedCameras.value.length,
                itemBuilder: (context, index) {
                  final camera = selectedCameras.value[index];
                  return ListTile(
                    leading: const Icon(Icons.camera_alt),
                    title: Text(camera),
                    trailing: IconButton(
                      icon: const Icon(Icons.remove_circle),
                      onPressed: () {
                        selectedCameras.value = List.from(selectedCameras.value)..removeAt(index);
                      },
                    ),
                  );
                },
              ),
            ),
            const SizedBox(height: 16),
            ElevatedButton.icon(
              onPressed: () {
                _showCameraListBottomSheet(context, cameraList.value, selectedCameras);
              },
              icon: const Icon(Icons.add),
              label: const Text("Put camera"),
            ),
          ],
        ),
      ),
      bottomNavigationBar: SafeArea(
        child: Padding(
          padding: const EdgeInsets.all(16),
          child: ElevatedButton(
            onPressed: () {
              // Saveボタンの処理
              Navigator.pop(context);
            },
            child: const Text('Save'),
          ),
        ),
      ),
    );
  }

  void _showCameraListBottomSheet(BuildContext context, List<String> cameraList, ValueNotifier<List<String>> selectedCameras) {
    showModalBottomSheet(
      context: context,
      builder: (context) {
        return CameraListPage(
          cameraList: cameraList,
          onCameraSelected: (camera) {
            selectedCameras.value = [...selectedCameras.value, camera];
            Navigator.pop(context);
          },
        );
      },
    );
  }
}

class CameraListPage extends StatelessWidget {
  final List<String> cameraList;
  final void Function(String) onCameraSelected;

  const CameraListPage({
    super.key,
    required this.cameraList,
    required this.onCameraSelected,
  });

  @override
  Widget build(BuildContext context) {
    return Padding(
      padding: const EdgeInsets.all(16.0),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        mainAxisSize: MainAxisSize.min,
        children: [
          Row(
            mainAxisAlignment: MainAxisAlignment.spaceBetween,
            children: [
              const Text('Camera list', style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold)),
              IconButton(
                icon: const Icon(Icons.close),
                onPressed: () => Navigator.pop(context),
              ),
            ],
          ),
          Expanded(
            child: ListView.builder(
              itemCount: cameraList.length,
              itemBuilder: (context, index) {
                final camera = cameraList[index];
                return ListTile(
                  leading: const Icon(Icons.camera_alt),
                  title: Text(camera),
                  onTap: () {
                    onCameraSelected(camera);
                  },
                );
              },
            ),
          ),
        ],
      ),
    );
  }
}
```

### 変更点の説明
1. **`HookConsumerWidget`** を使用して `DeckDetailPage` を構築。
2. **`cameraList`** を仮のデータとしてリストで定義。
3. **`showModalBottomSheet`** を使用して `CameraListPage` をボトムシートとして表示。
4. `CameraListPage` にカメラリストを表示し、選択したカメラをコールバックで返す仕組みを実装。
5. `ListView.builder` を使って選択済みカメラやカメラリストを動的に表示。

動作確認後、デザインや色を微調整すれば、画像に近いUIが完成します！

---

## 👤 User
*2024-12-20 17:05:48*

CameraListPage も HookConsumerWidget でしてほしい。
この画面ないでカメラ一覧を取得する予定なので、引数で持ってこなくていい

---

## 🤖 Assistant
*2024-12-20 17:06:17*

以下は `CameraListPage` を `HookConsumerWidget` に変更したコードです。`CameraListPage` 内でカメラ一覧を取得する設計を考慮しています。

```dart
import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';

class DeckDetailPage extends HookConsumerWidget {
  const DeckDetailPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final selectedCameras = useState<List<String>>([]);

    return Scaffold(
      appBar: AppBar(
        title: const Text('Edit Deck'),
      ),
      body: Padding(
        padding: const EdgeInsets.all(16.0),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Row(
              mainAxisAlignment: MainAxisAlignment.spaceBetween,
              children: const [
                Text('Search: 3,879', style: TextStyle(fontSize: 16)),
                Text('Attack: 1,230', style: TextStyle(fontSize: 16)),
              ],
            ),
            Row(
              mainAxisAlignment: MainAxisAlignment.spaceBetween,
              children: const [
                Text('Luck: 893', style: TextStyle(fontSize: 16)),
                Text('Defence: 905', style: TextStyle(fontSize: 16)),
              ],
            ),
            const SizedBox(height: 16),
            Expanded(
              child: ListView.builder(
                itemCount: selectedCameras.value.length,
                itemBuilder: (context, index) {
                  final camera = selectedCameras.value[index];
                  return ListTile(
                    leading: const Icon(Icons.camera_alt),
                    title: Text(camera),
                    trailing: IconButton(
                      icon: const Icon(Icons.remove_circle),
                      onPressed: () {
                        selectedCameras.value = List.from(selectedCameras.value)..removeAt(index);
                      },
                    ),
                  );
                },
              ),
            ),
            const SizedBox(height: 16),
            ElevatedButton.icon(
              onPressed: () {
                _showCameraListBottomSheet(context, selectedCameras);
              },
              icon: const Icon(Icons.add),
              label: const Text("Put camera"),
            ),
          ],
        ),
      ),
      bottomNavigationBar: SafeArea(
        child: Padding(
          padding: const EdgeInsets.all(16),
          child: ElevatedButton(
            onPressed: () {
              // Saveボタンの処理
              Navigator.pop(context);
            },
            child: const Text('Save'),
          ),
        ),
      ),
    );
  }

  void _showCameraListBottomSheet(BuildContext context, ValueNotifier<List<String>> selectedCameras) {
    showModalBottomSheet(
      context: context,
      builder: (context) {
        return CameraListPage(
          onCameraSelected: (camera) {
            selectedCameras.value = [...selectedCameras.value, camera];
          },
        );
      },
    );
  }
}

class CameraListPage extends HookConsumerWidget {
  final void Function(String) onCameraSelected;

  const CameraListPage({
    super.key,
    required this.onCameraSelected,
  });

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    // 仮のカメラリストをuseStateで管理（今後非同期取得に変更可能）
    final cameraList = useState<List<String>>(["Camera A", "Camera B", "Camera C", "Camera D"]);

    return Padding(
      padding: const EdgeInsets.all(16.0),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        mainAxisSize: MainAxisSize.min,
        children: [
          Row(
            mainAxisAlignment: MainAxisAlignment.spaceBetween,
            children: [
              const Text('Camera list', style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold)),
              IconButton(
                icon: const Icon(Icons.close),
                onPressed: () => Navigator.pop(context),
              ),
            ],
          ),
          Expanded(
            child: ListView.builder(
              itemCount: cameraList.value.length,
              itemBuilder: (context, index) {
                final camera = cameraList.value[index];
                return ListTile(
                  leading: const Icon(Icons.camera_alt),
                  title: Text(camera),
                  onTap: () {
                    onCameraSelected(camera);
                    Navigator.pop(context);
                  },
                );
              },
            ),
          ),
        ],
      ),
    );
  }
}
```

### 変更点の説明
1. **`CameraListPage`** を `HookConsumerWidget` に変更。
2. `cameraList` を `useState` で管理し、将来的に非同期で取得する機能に対応できるようにしました。
3. `CameraListPage` では引数としてカメラリストを受け取らず、独立した状態でカメラリストを管理。
4. カメラ選択後に親の `selectedCameras` に追加する処理を実装。

この構造は後々 `cameraList` をプロバイダや非同期処理で取得する際にも対応しやすくなっています。

---

## 👤 User
*2024-12-20 17:07:06*

required this.onCameraSelected, はいらない。どれを選択しているかはわからない。
ただ、追加ボタンがあるだけである

---

## 🤖 Assistant
*2024-12-20 17:07:31*

以下は、`onCameraSelected` を不要とし、カメラ選択の概念を取り除き、追加ボタンだけを持つ `CameraListPage` の実装です。

```dart
import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';

class DeckDetailPage extends HookConsumerWidget {
  const DeckDetailPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final selectedCameras = useState<List<String>>([]);

    return Scaffold(
      appBar: AppBar(
        title: const Text('Edit Deck'),
      ),
      body: Padding(
        padding: const EdgeInsets.all(16.0),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Row(
              mainAxisAlignment: MainAxisAlignment.spaceBetween,
              children: const [
                Text('Search: 3,879', style: TextStyle(fontSize: 16)),
                Text('Attack: 1,230', style: TextStyle(fontSize: 16)),
              ],
            ),
            Row(
              mainAxisAlignment: MainAxisAlignment.spaceBetween,
              children: const [
                Text('Luck: 893', style: TextStyle(fontSize: 16)),
                Text('Defence: 905', style: TextStyle(fontSize: 16)),
              ],
            ),
            const SizedBox(height: 16),
            Expanded(
              child: ListView.builder(
                itemCount: selectedCameras.value.length,
                itemBuilder: (context, index) {
                  final camera = selectedCameras.value[index];
                  return ListTile(
                    leading: const Icon(Icons.camera_alt),
                    title: Text(camera),
                    trailing: IconButton(
                      icon: const Icon(Icons.remove_circle),
                      onPressed: () {
                        selectedCameras.value = List.from(selectedCameras.value)..removeAt(index);
                      },
                    ),
                  );
                },
              ),
            ),
            const SizedBox(height: 16),
            ElevatedButton.icon(
              onPressed: () {
                _showCameraListBottomSheet(context);
              },
              icon: const Icon(Icons.add),
              label: const Text("Put camera"),
            ),
          ],
        ),
      ),
      bottomNavigationBar: SafeArea(
        child: Padding(
          padding: const EdgeInsets.all(16),
          child: ElevatedButton(
            onPressed: () {
              // Saveボタンの処理
              Navigator.pop(context);
            },
            child: const Text('Save'),
          ),
        ),
      ),
    );
  }

  void _showCameraListBottomSheet(BuildContext context) {
    showModalBottomSheet(
      context: context,
      builder: (context) {
        return const CameraListPage();
      },
    );
  }
}

class CameraListPage extends HookConsumerWidget {
  const CameraListPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    // 仮のカメラリストをuseStateで管理
    final cameraList = useState<List<String>>(["Camera A", "Camera B", "Camera C", "Camera D"]);

    return Padding(
      padding: const EdgeInsets.all(16.0),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        mainAxisSize: MainAxisSize.min,
        children: [
          Row(
            mainAxisAlignment: MainAxisAlignment.spaceBetween,
            children: [
              const Text('Camera list', style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold)),
              IconButton(
                icon: const Icon(Icons.close),
                onPressed: () => Navigator.pop(context),
              ),
            ],
          ),
          Expanded(
            child: ListView.builder(
              itemCount: cameraList.value.length,
              itemBuilder: (context, index) {
                final camera = cameraList.value[index];
                return ListTile(
                  leading: const Icon(Icons.camera_alt),
                  title: Text(camera),
                  trailing: ElevatedButton(
                    onPressed: () {
                      // 仮の「追加」ボタンの処理
                      ScaffoldMessenger.of(context).showSnackBar(
                        SnackBar(content: Text('$camera added')),
                      );
                    },
                    child: const Text("Add"),
                  ),
                );
              },
            ),
          ),
        ],
      ),
    );
  }
}
```

### 変更点
1. **`onCameraSelected` を削除**: 親ウィジェットと連携する処理を排除しました。
2. **カメラリストを仮のデータとして管理**: 将来的にプロバイダや非同期取得に対応可能です。
3. **各カメラに「Add」ボタンを追加**: 押すと `SnackBar` に選択したカメラの名前を表示します（実際の処理を後で追加可能）。
4. **`DeckDetailPage` と完全に独立した `CameraListPage`**: ボトムシート内でカメラリストを自立的に表示します。

これにより、画面間の依存を減らし、柔軟な構造になっています。将来的にデータの取得や `Add` ボタンの具体的な機能を拡張できます。

---

## 👤 User
*2024-12-20 17:11:57*

"Put camera"をタップしたらエラーになった

════════ Exception caught by rendering library ═════════════════════════════════
The following assertion was thrown during performLayout():
Trailing widget consumes entire tile width. Please use a sized widget, or consider replacing ListTile with a custom widget (see https://api.flutter.dev/flutter/material/ListTile-class.html#material.ListTile.4)
'package:flutter/src/material/list_tile.dart':
Failed assertion: line 1379 pos 7: 'tileWidth != trailingSize?.width || tileWidth == 0.0'

Either the assertion indicates an error in the framework itself, or we should provide substantially more information in this error message to help you determine and fix the underlying cause.
In either case, please report this assertion by filing a bug on GitHub:
  https://github.com/flutter/flutter/issues/new?template=2_bug.yml

The relevant error-causing widget was:
    ListTile ListTile:file:///Users/sugurutakahashi/git/gallusys/snpit_guild_app/lib/presentation/pages/camera_list_page.dart:36:24

When the exception was thrown, this was the stack:

---

## 🤖 Assistant
*2024-12-20 17:12:19*

このエラーの原因は、`ListTile` の `trailing` ウィジェットが `ListTile` の幅全体を占めようとしているためです。`trailing` に配置するウィジェットは幅を制限する必要があります。

修正方法として、`ElevatedButton` を `SizedBox` でラップして幅を制限します。以下に修正版のコードを示します。

### 修正版コード
```dart
class CameraListPage extends HookConsumerWidget {
  const CameraListPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    // 仮のカメラリストをuseStateで管理
    final cameraList = useState<List<String>>(["Camera A", "Camera B", "Camera C", "Camera D"]);

    return Padding(
      padding: const EdgeInsets.all(16.0),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        mainAxisSize: MainAxisSize.min,
        children: [
          Row(
            mainAxisAlignment: MainAxisAlignment.spaceBetween,
            children: [
              const Text('Camera list', style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold)),
              IconButton(
                icon: const Icon(Icons.close),
                onPressed: () => Navigator.pop(context),
              ),
            ],
          ),
          Expanded(
            child: ListView.builder(
              itemCount: cameraList.value.length,
              itemBuilder: (context, index) {
                final camera = cameraList.value[index];
                return ListTile(
                  leading: const Icon(Icons.camera_alt),
                  title: Text(camera),
                  trailing: SizedBox(
                    width: 80, // ボタンの幅を制限
                    child: ElevatedButton(
                      onPressed: () {
                        // 仮の「追加」ボタンの処理
                        ScaffoldMessenger.of(context).showSnackBar(
                          SnackBar(content: Text('$camera added')),
                        );
                      },
                      child: const Text("Add"),
                    ),
                  ),
                );
              },
            ),
          ),
        ],
      ),
    );
  }
}
```

### 修正ポイント
1. **`SizedBox` で `ElevatedButton` の幅を制限**: `trailing` の `ElevatedButton` を `SizedBox` でラップし、幅を 80 に設定しました。これにより、`ListTile` のレイアウト制約に適合します。
2. **エラー解消**: `trailing` ウィジェットが `ListTile` 全体の幅を占めることがなくなり、エラーが解消されます。

### 動作確認
この修正後にアプリを再実行すると、`Put camera` ボタンをタップした際にエラーが発生せず、`CameraListPage` が正しく表示されるようになります。

---

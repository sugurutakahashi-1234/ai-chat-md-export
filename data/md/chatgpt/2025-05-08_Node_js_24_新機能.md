# Node.js 24 新機能

日付: 2025-05-08

---

## 👤 ユーザー
*2025/05/08 11:50:08*

実装者目線でのnodejs24の新機能をまとめてほしい

---

## 🤖 アシスタント
*2025/05/08 11:50:36*

### Node.js 24 開発者向け新機能まとめ  
（2025-05-06 リリース、10 月に LTS 予定）

| 分類 | 使いどころ / 影響 | 概要 |
| --- | --- | --- |
| **ランタイム & JS 言語** | **最新 ECMAScript 機能を即利用** | *V8 13.6* に更新。`using / await using` による **Explicit Resource Management**、`Float16Array`、`Error.isError`、`RegExp.escape`、Wasm Memory64 などが Node でもそのまま動くように​citeturn1view0 |
| **npm 11 同梱** | **CLI 体験とセキュリティ向上** | `npm init` に *type* プロンプト追加、`npm hook` 廃止、`--ignore-scripts` の挙動変更など。パッケージ公開/CI のスクリプトに影響がないか確認を​citeturn1view0turn2view0 |
| **AsyncLocalStorage 強化** | **APM／トレーシングのオーバーヘッド削減** | 既定実装が `AsyncContextFrame` に切替わりメモリ追跡が高速化。独自で ALS を使う場合はパフォーマンス改善が期待できる​citeturn1view0 |
| **URLPattern がグローバル** | **ルーティングやバリデーションをワンライナーで** | `new URLPattern('/posts/:id')` が import なしで利用可能に​citeturn1view0 |
| **パーミッションモデル (`--permission`)** | **サーバーレス／CLI の安全対策を簡潔に** | 旧 `--experimental-permission` が安定化され、フラグ名が短縮。実行時 API `process.permission.has()` で動的チェックが可能​citeturn1view0turn2view0 |
| **テストランナー改善** | **`subtest` の書き忘れ待ちを自動化** | サブテストが暗黙で完了待ち。`await t.test()` の書き忘れバグがなくなる​citeturn1view0 |
| **Undici 7 へ更新** | **`fetch` / HTTP クライアントの性能向上** | HTTP/1.1 & HTTP/2 両対応強化、ヘッダー処理が高速化​citeturn1view0 |
| **新しい診断 API** | **メモリ・Async コンテキスト解析** | `worker.getHeapStatistics()`、`performance.executionAsyncId` など追加​citeturn1view0 |
| **プラットフォーム変更** | **ビルド環境のアップデート必須** | *Windows* は MSVC 非対応になり **Clang-CL 必須**、*macOS* は 13.5 以上 & Xcode 16.1 以上が必要​citeturn3view0 |
| **TypeScript 部分互換 (実験)** | **ts ファイルを直に実行したい PoC 用に** | `--erasableSyntaxOnly` など TS 5.8 と連携して .ts をトランスパイルなしで動かす流れが整備中​citeturn3view0 |
| **非推奨 & 破壊的変更** | **アップグレード前に grep 推奨** | `url.parse()` ランタイム非推奨、`tls.createSecurePair` 削除、`SlowBuffer` 非推奨、`child_process.spawn()` の `args` オプション非推奨 など​citeturn1view0 |

---

#### 開発者視点で押さえるチェックリスト

1. **CI / Docker イメージを更新**  
   - Windows ビルドは Clang-CL、macOS は Xcode 16.1 が必要。  
   - `node:current` ベースイメージを使う場合でも npm 11 のスクリプト挙動を確認。

2. **コードベースを検索 & 置換**  
   - `url.parse(`, `SlowBuffer(` など旧 API の使用箇所を洗い替え。  
   - TLS・HTTP2 の内部プロパティに直接アクセスしていないか確認。

3. **パーミッションモデルを試す**  
   ```bash
   node --permission \
        --allow-fs-read=./public --allow-net=github.com app.js
   ```
   - CLI ツールやユーザー実行スクリプトで権限制御を導入しやすくなる。

4. **AsyncLocalStorage を使う APM/ロギングの再計測**  
   - フレームワークのパッチが不要になる場合あり。ベンチマーク推奨。

5. **テストコードの `await t.test()` を削除できるか確認**  
   - 自動待機によりテストファイルが簡潔に。

6. **Experimental TypeScript を PoC で評価**  
   ```bash
   # ts-node 不要で hello.ts 実行
   node --experimental-type-modules hello.ts
   ```

Node.js 24 は **最新 JS 機能・高速化・安全性** が大きく前進しています。  
現行バージョンで動いているプロダクションシステムでも、早めにテストブランチを作り **互換性チェック ➜ 性能計測** を行うと、10 月の LTS 移行がスムーズになります。

---

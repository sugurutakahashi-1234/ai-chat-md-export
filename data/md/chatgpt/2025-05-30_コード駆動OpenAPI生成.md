# ã‚³ãƒ¼ãƒ‰é§†å‹•OpenAPIç”Ÿæˆ

Date: 2025-05-30

---

## ğŸ‘¤ User
*2025-05-30 23:57:18*

hono ã¨ zod ã‚’ä½¿ã£ã¦ã‚¹ã‚­ãƒ¼ãƒé§†å‹•é–‹ç™ºã§ã¯ãªãã¦ã€ã‚³ãƒ¼ãƒ‰é§†å‹•é§†å‹•é–‹ç™ºã§ã€openapi.yamlã¨ãã‚Œã‹ã‚‰ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ãŸã„ã€‚

---

## ğŸ¤– Assistant
*2025-05-30 23:57:19*

ä»¥ä¸‹ã§ã¯ **ã€ŒHono + Zod ã§ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã ã‘ â†’ OpenAPI (YAML) ã‚’è‡ªå‹•ç”Ÿæˆ â†’ ãã“ã‹ã‚‰ TypeScript ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ç”Ÿæˆã€** ã¨ã„ã†â€œã‚³ãƒ¼ãƒ‰é§†å‹•â€ã®æœ€å°ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ç¤ºã—ã¾ã™ã€‚ãƒã‚¤ãƒ³ãƒˆã¯ **@hono/zod-openapi** ã§ API å®šç¾©ã¨ Zod ã‚¹ã‚­ãƒ¼ãƒã‚’ 1 ã‹æ‰€ã«ã¾ã¨ã‚ã€ãã®çµæœã‚’ **openapi-ts**ï¼ˆã‚ã‚‹ã„ã¯ openapi-generator-cli ãªã©ï¼‰ã«æ¸¡ã™ã ã‘ã€ã¨ã„ã†ã‚·ãƒ³ãƒ—ãƒ«ã•ã§ã™ã€‚  

---

## 1. ä¾å­˜é–¢ä¿‚ã‚’è¿½åŠ 

```bash
# ã‚µãƒ¼ãƒå´
pnpm add hono @hono/node-server zod @hono/zod-openapi
# ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‡ºåŠ›è£œåŠ©
pnpm add -D yaml           # JSONâ†’YAML å¤‰æ›ç”¨ CLI
# ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”Ÿæˆ
pnpm add -D @hey-api/openapi-ts         # å‹ã ã‘ãªã‚‰ã“ã‚Œ
# ãƒ•ã‚§ãƒƒãƒãƒ©ãƒƒãƒ‘ã‚„ SDK ãŒæ¬²ã—ã‘ã‚Œã° â†“ ã«ç½®ãæ›ãˆå¯
# pnpm add -D @openapitools/openapi-generator-cli
```

---

## 2. ã‚µãƒ¼ãƒå®Ÿè£…ï¼ˆ`packages/server/src/app.ts`ï¼‰

```ts
// ã‚³ãƒ¡ãƒ³ãƒˆã¯æ—¥æœ¬èªã§çµ±ä¸€
import { z } from 'zod'
import { OpenAPIHono, createRoute } from '@hono/zod-openapi'

const app = new OpenAPIHono({
  // ã“ã“ã§å…±é€šãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å®šç¾©
  openapi: '3.1.0',
  info: { title: 'Todo API', version: '1.0.0' },
  servers: [{ url: 'http://localhost:8787' }],
})

// ------- Zod ã‚¹ã‚­ãƒ¼ãƒ ---------
const Todo = z.object({
  id: z.string().uuid(),
  title: z.string(),
})

// ------- ãƒ«ãƒ¼ãƒˆå®šç¾©ï¼ˆã‚³ãƒ¼ãƒ‰ = ã‚¹ã‚­ãƒ¼ãƒ = ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰---------
app.openapi(
  createRoute({
    method: 'post',
    path: '/todos',
    request: {
      body: {
        content: {
          'application/json': {
            schema: Todo.omit({ id: true }), // æ–°è¦ä½œæˆãªã®ã§ id ã¯ä¸è¦
          },
        },
      },
    },
    responses: {
      201: {
        description: 'ä½œæˆæˆåŠŸ',
        content: {
          'application/json': {
            schema: Todo,
          },
        },
      },
    },
  }),
  async (c) => {
    const input = c.req.valid('json') as z.infer<typeof Todo.omit({ id: true })>
    const created: z.infer<typeof Todo> = { id: crypto.randomUUID(), ...input }
    return c.json(created, 201)
  },
)

// ------- OpenAPI å‡ºåŠ›ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ ---------
app.doc('/openapi.json') // GET /openapi.json ã§å–å¾—å¯èƒ½

export default app
```

&gt; **ãƒã‚¤ãƒ³ãƒˆ**  
&gt; * `createRoute` ã«æ¸¡ã™ **request / responses** ã®å„ schema ã¯ãã®ã¾ã¾ Zodã€‚  
&gt; * `app.openapi( routeSpec, handler )` ãŒ â‘ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ â‘¡å‹å®‰å…¨ â‘¢ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆ ã‚’åŒæ™‚ã«è¡Œã„ã¾ã™ã€‚  

---

## 3. ãƒ“ãƒ«ãƒ‰ï¼† OpenAPI ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ãå‡ºã—

```jsonc
// packages/server/package.json ï¼ˆæŠœç²‹ï¼‰
{
  "scripts": {
    "dev": "tsx watch src/app.ts",
    "build": "tsx src/app.ts > ../openapi.json",
    "build:yaml": "pnpm run build && yaml -i ../openapi.json ../openapi.yaml"
  }
}
```

* `tsx` ã§å®Ÿè¡Œã—ã€æ¨™æº–å‡ºåŠ›ã« `/openapi.json` ã‚’æµã™ã ã‘ã§ã‚‚è‰¯ã„ã§ã™ã—ã€  
  **å®Ÿè¡Œå¾Œã« `curl http://localhost:8787/openapi.json` ã§ã‚‚å¯**ã€‚  
* `yaml -i` ã¯ JSONâ†’YAML å¤‰æ›ï¼ˆCLI ç‰ˆ *yaml* ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼‰ã€‚  

---

## 4. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå‹ï¼SDK ã‚’ç”Ÿæˆ

### 4-1. å‹ã ã‘å¿…è¦ï¼ˆæœ€é€Ÿãƒ‘ã‚¹ï¼‰

```bash
npx openapi-ts ./openapi.yaml --output packages/client/src/api-types.ts
```

```ts
// ä¾‹: React ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´
import { paths } from '@/api-types'

type Todo = paths['/todos']['post']['responses']['201']['content']['application/json']
```

### 4-2. ãƒ•ã‚§ãƒƒãƒè¾¼ã¿ SDK ãŒæ¬²ã—ã„å ´åˆ

```bash
# å…¬å¼ Generatorï¼ˆtypescript-fetchï¼‰
npx openapi-generator-cli generate -i openapi.yaml \
  -g typescript-fetch -o packages/client
```

ç”Ÿæˆç‰©ã¯ `BaseAPI`, `TodosApi` ãªã©ã¨ã—ã¦å‡ºåŠ›ã•ã‚Œã€`fetch` å®Ÿè£…ãŒåŒæ¢±ã•ã‚Œã¾ã™ã€‚  
Vite + React ãªã‚‰ãã®ã¾ã¾å‘¼ã³å‡ºã—å¯èƒ½ã§ã™ã€‚

---

## 5. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¾‹ï¼ˆMonorepoï¼‰

```
project-root/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ server/       # Hono + Zod (ã‚³ãƒ¼ãƒ‰é§†å‹•)
â”‚   â”œâ”€â”€ client/       # React, Vite
â”‚   â””â”€â”€ shared/       # å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ openapi.json      # build æ™‚ã«ç”Ÿæˆ
â””â”€â”€ openapi.yaml      # ã€ƒï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”Ÿæˆã«ä½¿ç”¨ï¼‰
```

---

## 6. ã‚ˆãã‚ã‚‹è³ªå•

| Q | A |
|---|---|
| **Swagger UI ã‚’ç¢ºèªã—ãŸã„** | `@hono/swagger-ui` ã‚’è¿½åŠ ã— `app.get('/docs', swaggerUI({ url: '/openapi.json' }))` |
| **ã‚¹ã‚­ãƒ¼ãƒã‚’è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†å‰²ã—ãŸã„** | Zod ã‚¹ã‚­ãƒ¼ãƒã‚’é€šå¸¸ã® TS ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦åˆ†å‰²ã—ã€`z.union`, `z.lazy` ç­‰ã§çµ„ã¿åˆã‚ã›ã‚‹ã ã‘ |
| **OpenAPI ä»¥å¤–ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«ã—ãŸã„** | `createRoute` ã® `responses` ãªã©ã¯ã‚ãã¾ã§ Zod ãªã®ã§ã€GraphQL ç­‰ã«æµç”¨ã™ã‚‹å ´åˆã¯åˆ¥é€” resolver ã‚’ç”¨æ„ |

---

### ã¾ã¨ã‚

1. **Hono + Zod** ã§ãƒ«ãƒ¼ãƒˆã¨ã‚¹ã‚­ãƒ¼ãƒã‚’åŒæ™‚ã«è¨˜è¿°  
2. **@hono/zod-openapi** ãŒ OpenAPI 3.1 ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è‡ªå‹•ç”Ÿæˆ  
3. ç”Ÿæˆã•ã‚ŒãŸ YAML / JSON ã‚’ **openapi-ts** ãªã©ã«æ¸¡ã—ã¦ **å‹ï¼SDK** ã‚’ç”Ÿæˆ  

ã“ã‚Œã§ã€Œã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã ã‘ã§ã‚¹ã‚­ãƒ¼ãƒ & ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒæƒã†ã€ã‚³ãƒ¼ãƒ‰é§†å‹•é–‹ç™ºãƒ•ãƒ­ãƒ¼ãŒå®Œæˆã—ã¾ã™ã€‚

---

# SwiftUI 吹き出しビュー

日付: 2023-10-27

---

## 👤 ユーザー
*2023/10/27 16:19:28*

勝手にテキストを省略して欲しくない。加えてコードを教えて欲しい


import SwiftUI

public enum BubbleType {
    case vertical
    case horizontal
}

public struct EmomilBubbleView: View {
    private let type: BubbleType
    private let text: String

    public init(type: BubbleType, text: String) {
        self.type = type
        self.text = text
    }

    public var body: some View {
        if type == .vertical {
            BubbleView(type: type) {
                Text(text)
                    .typographyStyle(.body3)
                    .foregroundColor(CoreAssets.Color.Primary.primary100.swiftUIColor)
                    .multilineTextAlignment(.center)
                    .padding(16)
                    .frame(maxWidth: .infinity)
            }
        } else {
            BubbleView(type: type) {
                Text(text)
                    .typographyStyle(.body3)
                    .foregroundColor(CoreAssets.Color.Primary.primary100.swiftUIColor)
                    .padding(16)
                    .frame(maxWidth: .infinity, alignment: .leading)
            }
        }
    }
}

/// アイコンサイズ変更、吹き出し内のPadding変更などカスタマイズに対応したビュー
public struct BubbleView&lt;Content&gt;: View where Content: View {
    private let type: BubbleType
    private let iconSize: CGSize
    private let content: () -&gt; Content

    public init(type: BubbleType, iconSize: CGSize = .init(width: 84, height: 84), content: @escaping () -&gt; Content) {
        self.type = type
        self.iconSize = iconSize
        self.content = content
    }

    public var body: some View {
        if type == .vertical {
            VStack(spacing: 0) {
                verticalView
                iconView
            }
        } else {
            HStack(spacing: 0) {
                iconView
                horizontalView
            }
        }
    }
}

private extension BubbleView {
    var verticalView: some View {
        VStack(spacing: 0) {
            roundRectangleView
            Triangle()
                .fill(Color.white)
                .frame(width: 8, height: 10)
                .rotationEffect(.degrees(180))
        }
        .clipped()
        .elevation(.elevation2)
    }

    var horizontalView: some View {
        HStack(spacing: 0) {
            Triangle()
                .fill(Color.white)
                .frame(width: 5, height: 6)
                .rotationEffect(.degrees(-90))
            roundRectangleView
        }
        .clipped()
        .elevation(.elevation2)
    }

    var roundRectangleView: some View {
        content()
            .background(CoreAssets.Color.Neutral.white.swiftUIColor)
            .cornerRadius(32)
    }

    var iconView: some View {
        CoreAssets.Image.face.swiftUIImage
            .resizable()
            .frame(width: iconSize.width, height: iconSize.height)
            .elevation(.elevation2)
    }
}

private struct Triangle: Shape {
    func path(in rect: CGRect) -&gt; Path {
        var path = Path()

        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
        path.addLine(to: CGPoint(x: rect.midX, y: rect.minY))

        return path
    }
}

---

## 🤖 アシスタント
*2023/10/27 16:20:10*

このコードはSwiftUIを使って、縦や横方向の吹き出しビューを実装しています。吹き出しの形には`BubbleType`というenumが使用されており、`.vertical`と`.horizontal`の2つのケースがあります。

主要な部分を簡単に説明します：

1. \*\*EmomilBubbleView\*\*:
    - これは外部からアクセス可能な主要な吹き出しビューです。
    - 吹き出しの種類（縦または横）と表示するテキストを受け取ります。
    - 吹き出しの形状に応じて、テキストの配置を変更します（中央揃えまたは左揃え）。

2. \*\*BubbleView\*\*:
    - このビューはカスタマイズ可能な吹き出しビューで、アイコンのサイズや吹き出しの中のpaddingを変更できます。
    - 内部的には、吹き出しのタイプ（縦または横）に応じて、吹き出しの形状とアイコンを表示します。

3. \*\*BubbleView extension\*\*:
    - この拡張機能は、吹き出しの具体的な部分（縦の吹き出し、横の吹き出し、角丸の矩形、アイコン）を構築するためのプライベートビューを提供します。

4. \*\*Triangle\*\*:
    - これは三角形の形を持つSwiftUIのShapeです。これは吹き出しの尾部分として使用されます。

コードの改善や機能追加に関して具体的な要望や質問があれば、お知らせください。

---

## 👤 ユーザー
*2023/10/27 16:21:15*

テキストが省略されて表示されることがあるので、それを廃止する設定にしたい。

---

## 🤖 アシスタント
*2023/10/27 16:22:08*

SwiftUIのテキストビューでテキストが省略されてしまう場合、主な原因は`Text`ビューがその親のビューに対して十分なスペースを持っていないことです。この問題を解決するための一般的なアプローチは以下の通りです：

1. **行数の制限を削除**: SwiftUIの`Text`ビューはデフォルトで1行に制限されています。これを変更するためには、`lineLimit(nil)`を使用して行数の制限を削除できます。

   ```swift
   Text(text)
       .lineLimit(nil)
   ```

2. **親ビューの制約を調整**: `Text`ビューの親や祖先のビューが狭すぎる場合、テキストは省略されてしまいます。これを防ぐためには、親ビューの制約を適切に調整する必要があります。

3. **fixedSize**: この修飾子を使用して、テキストがその内容に基づいてサイズを変更することを確認できます。これにより、テキストがクリップされることなく全体が表示されます。

   ```swift
   Text(text)
       .fixedSize(horizontal: false, vertical: true)
   ```

あなたの`EmomilBubbleView`におけるテキストの部分を以下のように修正することをおすすめします：

```swift
Text(text)
    .typographyStyle(.body3)
    .foregroundColor(CoreAssets.Color.Primary.primary100.swiftUIColor)
    .multilineTextAlignment(.center)
    .lineLimit(nil)  // 行数の制限を削除
    .fixedSize(horizontal: false, vertical: true)  // テキストのサイズを内容に基づいて変更
    .padding(16)
    .frame(maxWidth: .infinity)
```

これにより、テキストが省略されることなく表示されるはずです。

---

## 👤 ユーザー
*2023/10/27 16:22:42*

改行はしていいけど省略して欲しくないんだ。

---

## 🤖 アシスタント
*2023/10/27 16:23:18*

了解しました。テキストの省略を避けるには、テキストビューに`.truncationMode(.tail)`を指定しても効果はありません。なぜなら、これはテキストが省略される場合にどの部分を省略するかを決定するものであり、省略そのものを防ぐものではないからです。

省略を避けるためには、以下のように`fixedSize`修飾子を使用して、テキストがその内容に基づいてサイズを変更することを確認する必要があります：

```swift
Text(text)
    .typographyStyle(.body3)
    .foregroundColor(CoreAssets.Color.Primary.primary100.swiftUIColor)
    .multilineTextAlignment(.center)
    .fixedSize(horizontal: false, vertical: true) // これが鍵です
    .padding(16)
    .frame(maxWidth: .infinity)
```

`fixedSize(horizontal: false, vertical: true)`は、テキストが縦方向に自由に拡張して内容をフィットさせることを指示しています。これにより、テキストがその内容に基づいて縦方向に適切なサイズになり、省略されることなく表示されるはずです。

---

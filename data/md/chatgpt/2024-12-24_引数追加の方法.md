# 引数追加の方法

日付: 2024-12-24

---

## 👤 ユーザー
*2024/12/24 13:02:22*

UpdateGuildMemberRequestDtoUpdateType をひきすうにとってほしい

Future&lt;String?&gt; \_updateGuildMember({
  required Ref ref,
  required String guildId,
  required String userId,
  required UpdateGuildMemberRequestDtoMemberStatus memberStatus,
}) async {
  final api = await ref.watch(guildApiProvider.future);
  final response = await api.guildControllerUpdateGuildMember(
    UpdateGuildMemberRequestDto(
      updateType: UpdateGuildMemberRequestDtoUpdateType.role,
      memberStatus: memberStatus,
    ),
    guildId: guildId,
    userId: userId,
  );
  debugPrint('Response Body: ${response.data}');
  debugPrint('Response Body.data: ${response.data?.data}');
  return response.data?.data;
}

---

## 🤖 アシスタント
*2024/12/24 13:02:30*

`UpdateGuildMemberRequestDtoUpdateType` を引数として受け取れるようにするには、`_updateGuildMember` メソッドの引数に `UpdateGuildMemberRequestDtoUpdateType` を追加します。以下のコードはその更新後の例です。

```dart
Future<String?> _updateGuildMember({
  required Ref ref,
  required String guildId,
  required String userId,
  required UpdateGuildMemberRequestDtoUpdateType updateType, // 新しい引数を追加
  required UpdateGuildMemberRequestDtoMemberStatus memberStatus,
}) async {
  final api = await ref.watch(guildApiProvider.future);
  final response = await api.guildControllerUpdateGuildMember(
    UpdateGuildMemberRequestDto(
      updateType: updateType, // 引数を使用
      memberStatus: memberStatus,
    ),
    guildId: guildId,
    userId: userId,
  );
  debugPrint('Response Body: ${response.data}');
  debugPrint('Response Body.data: ${response.data?.data}');
  return response.data?.data;
}
```

### 変更点
1. `updateType` を引数として追加しました。
2. `UpdateGuildMemberRequestDto` の `updateType` に引数の値を渡すようにしました。

これにより、呼び出し元で `updateType` を指定して柔軟に動作を変更できます。

---

## 👤 ユーザー
*2024/12/24 13:17:54*

これのOWNERとMEMBERもつくってほしい

enum UpdateGuildMemberRequestDtoRole {
  @JsonValue('OWNER')
  OWNER,
  @JsonValue('ADMIN')
  ADMIN,
  @JsonValue('MEMBER')
  MEMBER,
}
@riverpod
class GiveAdminNotifier extends \_$GiveAdminNotifier {
  @override
  Future&lt;String?&gt; build() async =&gt; null;

  Future&lt;void&gt; approveGuild({
    required String guildId,
    required String userId,
  }) async {
    state = const AsyncValue.loading();
    try {
      final result = await \_updateGuildMemberRole(
        ref: ref,
        guildId: guildId,
        userId: userId,
        role: UpdateGuildMemberRequestDtoRole.ADMIN
      );
      debugPrint('Result : $result');
      state = AsyncValue.data(result);
    } on Exception catch (e, stackTrace) {
      debugPrint('Error: $e');
      debugPrint('StackTrace: $stackTrace');
      state = AsyncValue.error(e, stackTrace);
    }
  }
}

---

## 🤖 アシスタント
*2024/12/24 13:18:25*

以下のように `OWNER` と `MEMBER` を操作できるようにするメソッドを追加します。また、既存のコードに合わせて変更を加えました。`approveGuild` と同様のロジックで、新しい役割を割り当てるためのメソッドを追加しています。

### 更新コード

```dart
enum UpdateGuildMemberRequestDtoRole {
  @JsonValue('OWNER')
  OWNER,
  @JsonValue('ADMIN')
  ADMIN,
  @JsonValue('MEMBER')
  MEMBER,
}

@riverpod
class GiveAdminNotifier extends _$GiveAdminNotifier {
  @override
  Future<String?> build() async => null;

  Future<void> assignAdmin({
    required String guildId,
    required String userId,
  }) async {
    state = const AsyncValue.loading();
    try {
      final result = await _updateGuildMemberRole(
        ref: ref,
        guildId: guildId,
        userId: userId,
        role: UpdateGuildMemberRequestDtoRole.ADMIN,
      );
      debugPrint('Result : $result');
      state = AsyncValue.data(result);
    } on Exception catch (e, stackTrace) {
      debugPrint('Error: $e');
      debugPrint('StackTrace: $stackTrace');
      state = AsyncValue.error(e, stackTrace);
    }
  }

  Future<void> assignOwner({
    required String guildId,
    required String userId,
  }) async {
    state = const AsyncValue.loading();
    try {
      final result = await _updateGuildMemberRole(
        ref: ref,
        guildId: guildId,
        userId: userId,
        role: UpdateGuildMemberRequestDtoRole.OWNER,
      );
      debugPrint('Result : $result');
      state = AsyncValue.data(result);
    } on Exception catch (e, stackTrace) {
      debugPrint('Error: $e');
      debugPrint('StackTrace: $stackTrace');
      state = AsyncValue.error(e, stackTrace);
    }
  }

  Future<void> assignMember({
    required String guildId,
    required String userId,
  }) async {
    state = const AsyncValue.loading();
    try {
      final result = await _updateGuildMemberRole(
        ref: ref,
        guildId: guildId,
        userId: userId,
        role: UpdateGuildMemberRequestDtoRole.MEMBER,
      );
      debugPrint('Result : $result');
      state = AsyncValue.data(result);
    } on Exception catch (e, stackTrace) {
      debugPrint('Error: $e');
      debugPrint('StackTrace: $stackTrace');
      state = AsyncValue.error(e, stackTrace);
    }
  }
}

Future<String?> _updateGuildMemberRole({
  required Ref ref,
  required String guildId,
  required String userId,
  required UpdateGuildMemberRequestDtoRole role,
}) async {
  final api = await ref.watch(guildApiProvider.future);
  final response = await api.guildControllerUpdateGuildMember(
    UpdateGuildMemberRequestDto(
      updateType: UpdateGuildMemberRequestDtoUpdateType.role,
      memberRole: role, // 適切なフィールドに割り当て
    ),
    guildId: guildId,
    userId: userId,
  );
  debugPrint('Response Body: ${response.data}');
  debugPrint('Response Body.data: ${response.data?.data}');
  return response.data?.data;
}
```

### 追加点
1. **`assignOwner` メソッド**:
   - `role` を `UpdateGuildMemberRequestDtoRole.OWNER` に設定し、指定ユーザーをオーナーに変更します。

2. **`assignMember` メソッド**:
   - `role` を `UpdateGuildMemberRequestDtoRole.MEMBER` に設定し、指定ユーザーをメンバーに変更します。

3. **`_updateGuildMemberRole` の再利用**:
   - 役割を柔軟に変更するための共通処理を持つメソッドとして `_updateGuildMemberRole` を使っています。

これで `OWNER` や `MEMBER` の割り当てをスムーズに行うことができます。

---

## 👤 ユーザー
*2024/12/24 13:18:53*

異なる@riverpodで管理したい

---

## 🤖 アシスタント
*2024/12/24 13:19:17*

異なる `@riverpod` で役割（`OWNER`、`ADMIN`、`MEMBER`）の管理を分離するには、それぞれ専用の `Notifier` を作成します。この場合、以下のように管理できます：

### 更新後のコード

#### Enum 定義
```dart
enum UpdateGuildMemberRequestDtoRole {
  @JsonValue('OWNER')
  OWNER,
  @JsonValue('ADMIN')
  ADMIN,
  @JsonValue('MEMBER')
  MEMBER,
}
```

#### Notifier 定義

1. **`OwnerNotifier`**
   ```dart
   @riverpod
   class OwnerNotifier extends _$OwnerNotifier {
     @override
     Future<String?> build() async => null;

     Future<void> assignOwner({
       required String guildId,
       required String userId,
     }) async {
       state = const AsyncValue.loading();
       try {
         final result = await _updateGuildMemberRole(
           ref: ref,
           guildId: guildId,
           userId: userId,
           role: UpdateGuildMemberRequestDtoRole.OWNER,
         );
         debugPrint('Owner Result : $result');
         state = AsyncValue.data(result);
       } on Exception catch (e, stackTrace) {
         debugPrint('Owner Error: $e');
         debugPrint('Owner StackTrace: $stackTrace');
         state = AsyncValue.error(e, stackTrace);
       }
     }
   }
   ```

2. **`AdminNotifier`**
   ```dart
   @riverpod
   class AdminNotifier extends _$AdminNotifier {
     @override
     Future<String?> build() async => null;

     Future<void> assignAdmin({
       required String guildId,
       required String userId,
     }) async {
       state = const AsyncValue.loading();
       try {
         final result = await _updateGuildMemberRole(
           ref: ref,
           guildId: guildId,
           userId: userId,
           role: UpdateGuildMemberRequestDtoRole.ADMIN,
         );
         debugPrint('Admin Result : $result');
         state = AsyncValue.data(result);
       } on Exception catch (e, stackTrace) {
         debugPrint('Admin Error: $e');
         debugPrint('Admin StackTrace: $stackTrace');
         state = AsyncValue.error(e, stackTrace);
       }
     }
   }
   ```

3. **`MemberNotifier`**
   ```dart
   @riverpod
   class MemberNotifier extends _$MemberNotifier {
     @override
     Future<String?> build() async => null;

     Future<void> assignMember({
       required String guildId,
       required String userId,
     }) async {
       state = const AsyncValue.loading();
       try {
         final result = await _updateGuildMemberRole(
           ref: ref,
           guildId: guildId,
           userId: userId,
           role: UpdateGuildMemberRequestDtoRole.MEMBER,
         );
         debugPrint('Member Result : $result');
         state = AsyncValue.data(result);
       } on Exception catch (e, stackTrace) {
         debugPrint('Member Error: $e');
         debugPrint('Member StackTrace: $stackTrace');
         state = AsyncValue.error(e, stackTrace);
       }
     }
   }
   ```

#### 共通処理の `_updateGuildMemberRole`

```dart
Future<String?> _updateGuildMemberRole({
  required Ref ref,
  required String guildId,
  required String userId,
  required UpdateGuildMemberRequestDtoRole role,
}) async {
  final api = await ref.watch(guildApiProvider.future);
  final response = await api.guildControllerUpdateGuildMember(
    UpdateGuildMemberRequestDto(
      updateType: UpdateGuildMemberRequestDtoUpdateType.role,
      memberRole: role,
    ),
    guildId: guildId,
    userId: userId,
  );
  debugPrint('Response Body: ${response.data}');
  debugPrint('Response Body.data: ${response.data?.data}');
  return response.data?.data;
}
```

### 利点
1. **役割ごとの分離**:
   - 各役割（OWNER、ADMIN、MEMBER）の状態を独立して管理できます。

2. **役割に応じたロジックの追加**:
   - 必要に応じて、各 `Notifier` に特化したロジックを追加可能です。

3. **テストが容易**:
   - `Notifier` が小さく分離されているため、それぞれのテストを簡単に実施できます。

これで、`OWNER`、`ADMIN`、`MEMBER` の管理がそれぞれ独立した `Notifier` で実現できます。

---

## 👤 ユーザー
*2024/12/24 13:19:29*

接頭辞にGiveをつけて欲しい

---

## 🤖 アシスタント
*2024/12/24 13:20:00*

接頭辞に `Give` を付けたクラス名に変更したコードを以下に示します。

### 更新後のコード

#### Enum 定義
```dart
enum UpdateGuildMemberRequestDtoRole {
  @JsonValue('OWNER')
  OWNER,
  @JsonValue('ADMIN')
  ADMIN,
  @JsonValue('MEMBER')
  MEMBER,
}
```

#### Notifier 定義

1. **`GiveOwnerNotifier`**
   ```dart
   @riverpod
   class GiveOwnerNotifier extends _$GiveOwnerNotifier {
     @override
     Future<String?> build() async => null;

     Future<void> assignOwner({
       required String guildId,
       required String userId,
     }) async {
       state = const AsyncValue.loading();
       try {
         final result = await _updateGuildMemberRole(
           ref: ref,
           guildId: guildId,
           userId: userId,
           role: UpdateGuildMemberRequestDtoRole.OWNER,
         );
         debugPrint('GiveOwner Result : $result');
         state = AsyncValue.data(result);
       } on Exception catch (e, stackTrace) {
         debugPrint('GiveOwner Error: $e');
         debugPrint('GiveOwner StackTrace: $stackTrace');
         state = AsyncValue.error(e, stackTrace);
       }
     }
   }
   ```

2. **`GiveAdminNotifier`**
   ```dart
   @riverpod
   class GiveAdminNotifier extends _$GiveAdminNotifier {
     @override
     Future<String?> build() async => null;

     Future<void> assignAdmin({
       required String guildId,
       required String userId,
     }) async {
       state = const AsyncValue.loading();
       try {
         final result = await _updateGuildMemberRole(
           ref: ref,
           guildId: guildId,
           userId: userId,
           role: UpdateGuildMemberRequestDtoRole.ADMIN,
         );
         debugPrint('GiveAdmin Result : $result');
         state = AsyncValue.data(result);
       } on Exception catch (e, stackTrace) {
         debugPrint('GiveAdmin Error: $e');
         debugPrint('GiveAdmin StackTrace: $stackTrace');
         state = AsyncValue.error(e, stackTrace);
       }
     }
   }
   ```

3. **`GiveMemberNotifier`**
   ```dart
   @riverpod
   class GiveMemberNotifier extends _$GiveMemberNotifier {
     @override
     Future<String?> build() async => null;

     Future<void> assignMember({
       required String guildId,
       required String userId,
     }) async {
       state = const AsyncValue.loading();
       try {
         final result = await _updateGuildMemberRole(
           ref: ref,
           guildId: guildId,
           userId: userId,
           role: UpdateGuildMemberRequestDtoRole.MEMBER,
         );
         debugPrint('GiveMember Result : $result');
         state = AsyncValue.data(result);
       } on Exception catch (e, stackTrace) {
         debugPrint('GiveMember Error: $e');
         debugPrint('GiveMember StackTrace: $stackTrace');
         state = AsyncValue.error(e, stackTrace);
       }
     }
   }
   ```

#### 共通処理の `_updateGuildMemberRole`

```dart
Future<String?> _updateGuildMemberRole({
  required Ref ref,
  required String guildId,
  required String userId,
  required UpdateGuildMemberRequestDtoRole role,
}) async {
  final api = await ref.watch(guildApiProvider.future);
  final response = await api.guildControllerUpdateGuildMember(
    UpdateGuildMemberRequestDto(
      updateType: UpdateGuildMemberRequestDtoUpdateType.role,
      memberRole: role,
    ),
    guildId: guildId,
    userId: userId,
  );
  debugPrint('Response Body: ${response.data}');
  debugPrint('Response Body.data: ${response.data?.data}');
  return response.data?.data;
}
```

### 利点
- `Give` を付けることで役割を割り当てる意図が明確になります。
- 各 `Notifier` が役割ごとに独立しているため、役割変更の管理がしやすいです。

これで、接頭辞に `Give` を付けた状態で、`OWNER`、`ADMIN`、`MEMBER` の割り当てを管理できます。

---

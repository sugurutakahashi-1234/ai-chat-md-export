# カードサイズ調整

日付: 2025-01-08

---

## 👤 ユーザー
*2025/1/8 18:04:07*

Card のサイズを中のコンテンツで合わせたい

import 'package:carousel_slider/carousel_slider.dart';
import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:go_router/go_router.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:snpit_guild_app/infrastructure/snapit_guild_api/snapit_guild_api.openapi.dart';
import 'package:snpit_guild_app/presentation/design_token/color_token.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/explorers/get_explorer_info.dart';

class ExplorerListPage extends HookConsumerWidget {
  const ExplorerListPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final explorerState = ref.watch(getExplorerNotifierProvider);

    useEffect(
      () {
        WidgetsBinding.instance.addPostFrameCallback((_) {
          ref.read(getExplorerNotifierProvider.notifier).executeRequest();
        });
        return null;
      },
      [],
    );

    Widget buildExplorerCard(ExplorerDTO explorer) {
      final imageUrl = explorer.explorerImage?.isNotEmpty == true
          ? explorer.explorerImage!
          : null;

      return Card(
        shape: RoundedRectangleBorder(
          borderRadius: BorderRadius.circular(16),
          side: const BorderSide(color: ColorToken.secondary),
        ),
        color: ColorToken.bg,
        elevation: 4,
        child: Padding(
          padding: const EdgeInsets.all(16),
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              Row(
                children: [
                  ClipRRect(
                    borderRadius: BorderRadius.circular(8),
                    child: imageUrl != null
                        ? Image.network(
                            imageUrl,
                            height: 120,
                            width: 120,
                            fit: BoxFit.cover,
                            errorBuilder: (context, error, stackTrace) {
                              return const Icon(
                                Icons.broken_image_outlined,
                                size: 120,
                                color: ColorToken.text,
                              );
                            },
                          )
                        : const Icon(
                            Icons.hide_image_outlined,
                            size: 120,
                            color: ColorToken.text,
                          ),
                  ),
                  const SizedBox(width: 16),
                  Expanded(
                    child: Column(
                      mainAxisSize: MainAxisSize.min,
                      crossAxisAlignment: CrossAxisAlignment.start,
                      children: [
                        const Text(
                          'Life',
                          style: TextStyle(
                            fontSize: 14,
                          ),
                        ),
                        const SizedBox(height: 4),
                        Flexible(
                          child: LinearProgressIndicator(
                            value: (explorer.energy ?? 0) / 100,
                            color: ColorToken.primary,
                            backgroundColor: ColorToken.bg,
                            borderRadius: BorderRadius.circular(2),
                          ),
                        ),
                        const SizedBox(height: 12),
                        const Text(
                          'Search range',
                          style: TextStyle(
                            fontSize: 14,
                            color: ColorToken.border,
                          ),
                        ),
                        const SizedBox(height: 4),
                        Text(
                          '${explorer.range ?? 0}km radius',
                          style: const TextStyle(
                            fontSize: 14,
                          ),
                        ),
                        const SizedBox(height: 12),
                        Text(
                          explorer.explorerDescription ?? 'No description',
                          style: const TextStyle(
                            fontSize: 12,
                          ),
                        ),
                      ],
                    ),
                  ),
                ],
              ),
            ],
          ),
        ),
      );
    }

    return Scaffold(
      appBar: AppBar(
        automaticallyImplyLeading: false,
        title: const Text('Select explorer'),
        actions: [
          IconButton(
            onPressed: () =&gt; context.pop(),
            icon: const Icon(Icons.close),
          ),
        ],
      ),
      body: explorerState.when(
        data: (explorers) {
          if ((explorers ?? []).isEmpty) {
            return const Center(child: Text('No explorers available.'));
          }

          return Column(
            children: [
              Expanded(
                child: CarouselSlider(
                  options: CarouselOptions(),
                  items: (explorers ?? []).map(buildExplorerCard).toList(),
                ),
              ),
            ],
          );
        },
        loading: () =&gt; const Center(child: CircularProgressIndicator()),
        error: (error, _) =&gt; Center(child: Text('Error: $error')),
      ),
      bottomNavigationBar: SafeArea(
        child: Padding(
          padding: const EdgeInsets.all(16),
          child: ElevatedButton(
            onPressed: () {
              context.pop();
            },
            child: const Text('Start explore'),
          ),
        ),
      ),
    );
  }
}

---

## 🤖 アシスタント
*2025/1/8 18:04:34*

`Card` ウィジェットのサイズを中のコンテンツに合わせたい場合、以下の点に注意してコードを修正します。

1. **Cardの親ウィジェットがColumnやRow内にある場合**  
   その親ウィジェットに適切な制約（`MainAxisSize.min`など）を指定します。

2. **`Card`ウィジェット自体がサイズを持たないようにする**  
   `Expanded`や`Flexible`のようなウィジェットを直接`Card`の親にしないようにします。

3. **明示的なサイズ指定をしない**  
   サイズを固定するプロパティ（`height`や`width`）を必要に応じて削除します。

修正例を以下に示します：

### 修正版コード
```dart
Widget buildExplorerCard(ExplorerDTO explorer) {
  final imageUrl = explorer.explorerImage?.isNotEmpty == true
      ? explorer.explorerImage!
      : null;

  return Card(
    shape: RoundedRectangleBorder(
      borderRadius: BorderRadius.circular(16),
      side: const BorderSide(color: ColorToken.secondary),
    ),
    color: ColorToken.bg,
    elevation: 4,
    child: Padding(
      padding: const EdgeInsets.all(16),
      child: IntrinsicHeight( // これを追加してサイズを中のコンテンツに合わせる
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Row(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                ClipRRect(
                  borderRadius: BorderRadius.circular(8),
                  child: imageUrl != null
                      ? Image.network(
                          imageUrl,
                          height: 120,
                          width: 120,
                          fit: BoxFit.cover,
                          errorBuilder: (context, error, stackTrace) {
                            return const Icon(
                              Icons.broken_image_outlined,
                              size: 120,
                              color: ColorToken.text,
                            );
                          },
                        )
                      : const Icon(
                          Icons.hide_image_outlined,
                          size: 120,
                          color: ColorToken.text,
                        ),
                ),
                const SizedBox(width: 16),
                Expanded(
                  child: Column(
                    crossAxisAlignment: CrossAxisAlignment.start,
                    children: [
                      const Text(
                        'Life',
                        style: TextStyle(fontSize: 14),
                      ),
                      const SizedBox(height: 4),
                      LinearProgressIndicator(
                        value: (explorer.energy ?? 0) / 100,
                        color: ColorToken.primary,
                        backgroundColor: ColorToken.bg,
                      ),
                      const SizedBox(height: 12),
                      const Text(
                        'Search range',
                        style: TextStyle(
                          fontSize: 14,
                          color: ColorToken.border,
                        ),
                      ),
                      const SizedBox(height: 4),
                      Text(
                        '${explorer.range ?? 0}km radius',
                        style: const TextStyle(fontSize: 14),
                      ),
                      const SizedBox(height: 12),
                      Text(
                        explorer.explorerDescription ?? 'No description',
                        style: const TextStyle(fontSize: 12),
                      ),
                    ],
                  ),
                ),
              ],
            ),
          ],
        ),
      ),
    ),
  );
}
```

### 修正点
1. **`IntrinsicHeight`**:  
   `Card`の中に`IntrinsicHeight`を入れることで、カードが中身に合わせたサイズになります。ただし、パフォーマンスに少し影響する可能性があるため注意してください。

2. **余分な`Flexible`を削除**:  
   `Flexible`はレイアウトに不要だったため削除しました。

3. **明示的な高さ指定の確認**:  
   必要に応じて他の部分でもサイズ指定を見直し、`Row`や`Column`で適切なサイズが設定されるようにしました。

この修正で`Card`のサイズが内容に応じて変化し、コンパクトな見た目が得られるはずです。

---

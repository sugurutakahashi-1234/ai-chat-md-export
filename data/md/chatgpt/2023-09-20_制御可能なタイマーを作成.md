# åˆ¶å¾¡å¯èƒ½ãªã‚¿ã‚¤ãƒãƒ¼ã‚’ä½œæˆ

æ—¥ä»˜: 2023-09-20

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/9/20 16:09:48*

ã„ã‹ã®ã‚ˆã†ãªæ¯ç§’ç§’æ•°ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã—ã¦ã€å‡ºåŠ›ã™ã‚‹ã‚¿ã‚¤ãƒãƒ¼ãŒã‚ã‚‹ãŒã€ç‰¹å®šã®ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ£ãƒ¼ã‚’æ¤œå‡ºã—ã¦ã€ã“ã®ã‚¿ã‚¤ãƒãƒ¼ãŒé€²ã‚€æ™‚é–“ã‚’åœæ­¢ã—ãŸã‚Šã€å†é–‹ã—ãŸã‚Šã—ãŸã„ã€‚ã©ã†ã™ã‚Œã°ã„ã„ã‹ï¼Ÿ

        var sessionDurationInSeconds = 0
        Timer.publish(every: 1.0, on: .main, in: .common)
            .autoconnect()
            .sink { [weak self] _ in
                sessionDurationInSeconds += 1
                print(sessionDurationInSeconds)
            }
            .store(in: &cancellables)

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/9/20 16:11:10*

ç‰¹å®šã®ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ£ãƒ¼ã‚’ä½¿ã£ã¦ã‚¿ã‚¤ãƒãƒ¼ã‚’åœæ­¢ãƒ»å†é–‹ã™ã‚‹ãŸã‚ã«ã€`combineLatest` ã¾ãŸã¯ `merge` ãªã©ã® Combine ã®ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦ã€è¤‡æ•°ã®ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ£ãƒ¼ã®å‡ºåŠ›ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ä»¥ä¸‹ã¯ã€ã‚¿ã‚¤ãƒãƒ¼ã®å‹•ä½œã‚’åˆ¶å¾¡ã™ã‚‹æ–°ã—ã„ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ£ãƒ¼ `controlPublisher` ã‚’è¿½åŠ ã—ã¦ã€ã‚¿ã‚¤ãƒãƒ¼ã®å‹•ä½œã‚’åˆ¶å¾¡ã™ã‚‹ä¾‹ã§ã™ã€‚

1. `controlPublisher` ãŒ `true` ã‚’é€å‡ºã™ã‚‹ã¨ã€ã‚¿ã‚¤ãƒãƒ¼ãŒå†é–‹ã—ã¾ã™ã€‚
2. `controlPublisher` ãŒ `false` ã‚’é€å‡ºã™ã‚‹ã¨ã€ã‚¿ã‚¤ãƒãƒ¼ãŒåœæ­¢ã—ã¾ã™ã€‚

```swift
import Combine

class YourClass {
    var sessionDurationInSeconds = 0
    var cancellables: Set<AnyCancellable> = []
    var timerActive: Bool = true // ã‚¿ã‚¤ãƒãƒ¼ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’åˆ¶å¾¡ã™ã‚‹å¤‰æ•°

    let controlPublisher = PassthroughSubject<Bool, Never>() // ã‚¿ã‚¤ãƒãƒ¼ã®å‹•ä½œã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã®ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ£ãƒ¼

    func setup() {
        // controlPublisher ã§ã‚¿ã‚¤ãƒãƒ¼ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
        controlPublisher
            .sink { [weak self] isActive in
                self?.timerActive = isActive
            }
            .store(in: &cancellables)

        Timer.publish(every: 1.0, on: .main, in: .common)
            .autoconnect()
            .sink { [weak self] _ in
                guard let self = self, self.timerActive else { return } // timerActive ãŒ true ã®å ´åˆã®ã¿ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—
                self.sessionDurationInSeconds += 1
                print(self.sessionDurationInSeconds)
            }
            .store(in: &cancellables)
    }

    func stopTimer() {
        controlPublisher.send(false) // ã‚¿ã‚¤ãƒãƒ¼ã‚’åœæ­¢
    }

    func startTimer() {
        controlPublisher.send(true) // ã‚¿ã‚¤ãƒãƒ¼ã‚’å†é–‹
    }
}
```

ã“ã®ä¾‹ã§ã¯ã€`YourClass` å†…ã§ã‚¿ã‚¤ãƒãƒ¼ã‚’è¨­å®šã—ã€`setup` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã¦ã‚¿ã‚¤ãƒãƒ¼ã‚’é–‹å§‹ã—ã¾ã™ã€‚ãã®å¾Œã€`stopTimer` ãƒ¡ã‚½ãƒƒãƒ‰ã‚„ `startTimer` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€ã‚¿ã‚¤ãƒãƒ¼ã®å‹•ä½œã‚’åœæ­¢ãƒ»å†é–‹ã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/9/20 16:11:15*

timerActive ã¨ã„ã†ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªå¤‰æ•°ã‚’ä½¿ç”¨ã—ãŸããªã„ã‚“ã ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/9/20 16:12:28*

äº†è§£ã—ã¾ã—ãŸã€‚`timerActive`ã‚’ä½¿ã‚ãšã«ã€`combineLatest`ã‚’ä½¿ç”¨ã—ã¦2ã¤ã®ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ£ãƒ¼ã®çµæœã‚’çµ„ã¿åˆã‚ã›ã‚‹æ–¹æ³•ã‚’ç¤ºã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€åˆ¶å¾¡ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ£ãƒ¼ã®å€¤ã«åŸºã¥ã„ã¦ã‚¿ã‚¤ãƒãƒ¼ã®å‹•ä½œã‚’ç›´æ¥åˆ¶å¾¡ã§ãã¾ã™ã€‚

ä»¥ä¸‹ã®ä¾‹ã§ã¯:

1. `controlPublisher` ãŒ `true` ã‚’é€å‡ºã™ã‚‹ã¨ã€ã‚¿ã‚¤ãƒãƒ¼ãŒå†é–‹ã—ã¾ã™ã€‚
2. `controlPublisher` ãŒ `false` ã‚’é€å‡ºã™ã‚‹ã¨ã€ã‚¿ã‚¤ãƒãƒ¼ãŒåœæ­¢ã—ã¾ã™ã€‚

```swift
import Combine

class YourClass {
    var sessionDurationInSeconds = 0
    var cancellables: Set<AnyCancellable> = []

    let controlPublisher = CurrentValueSubject<Bool, Never>(true) // ã‚¿ã‚¤ãƒãƒ¼ã®å‹•ä½œã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã®ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ£ãƒ¼ã€åˆæœŸå€¤ã¨ã—ã¦trueã‚’è¨­å®š

    func setup() {
        // ã‚¿ã‚¤ãƒãƒ¼ã¨åˆ¶å¾¡ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ£ãƒ¼ã‚’combineLatestã‚’ä½¿ã£ã¦çµ„ã¿åˆã‚ã›ã‚‹
        Timer.publish(every: 1.0, on: .main, in: .common)
            .autoconnect()
            .combineLatest(controlPublisher) { (_, isActive) in isActive }
            .sink { [weak self] isActive in
                guard let self = self, isActive else { return } // isActive ãŒ true ã®å ´åˆã®ã¿ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—
                self.sessionDurationInSeconds += 1
                print(self.sessionDurationInSeconds)
            }
            .store(in: &cancellables)
    }

    func stopTimer() {
        controlPublisher.send(false) // ã‚¿ã‚¤ãƒãƒ¼ã‚’åœæ­¢
    }

    func startTimer() {
        controlPublisher.send(true) // ã‚¿ã‚¤ãƒãƒ¼ã‚’å†é–‹
    }
}
```

ã“ã®æ–¹æ³•ã§ã¯ã€`combineLatest`ã‚’ä½¿ç”¨ã—ã¦ã‚¿ã‚¤ãƒãƒ¼ã®ã‚¤ãƒ™ãƒ³ãƒˆã¨`controlPublisher`ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’çµ„ã¿åˆã‚ã›ã€ã‚¿ã‚¤ãƒãƒ¼ã®å‹•ä½œã‚’åˆ¶å¾¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/9/20 16:14:05*

controlPublisher ã¯ãã®ã¾ã¾ã§ã€controlPublisher ã¯åˆ¥ã®AnyPublisherã®å€¤ã‹ã‚‰ãã‚‹å€¤ã‚’ä½¿ã„ãŸã„ã€‚ã©ã†ã™ã‚Œã°ã„ã„ã‹ï¼Ÿ

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/9/20 16:15:32*

äº†è§£ã—ã¾ã—ãŸã€‚`controlPublisher`ãŒ`AnyPublisher`ã®å‡ºåŠ›ã«å¾“ã£ã¦å‹•ä½œã™ã‚‹ã‚ˆã†ã«ã—ãŸã„ã¨ã„ã†ã“ã¨ã‚’ç†è§£ã—ã¾ã—ãŸã€‚ã“ã®å ´åˆã€å¤–éƒ¨ã‹ã‚‰æä¾›ã•ã‚Œã‚‹`AnyPublisher`ã‚’ä½¿ç”¨ã—ã¦`controlPublisher`ã®å‹•ä½œã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã®å¤‰æ•°ã‚’å®šç¾©ã—ã€ãã‚Œã‚’ã‚µãƒ–ã‚¹ã‚¯ãƒ©ã‚¤ãƒ–ã—ã¾ã™ã€‚

ä»¥ä¸‹ã¯ãã®æ–¹æ³•ã‚’ç¤ºã™ä¾‹ã§ã™ï¼š

```swift
import Combine

class YourClass {
    var sessionDurationInSeconds = 0
    var cancellables: Set<AnyCancellable> = []

    // å¤–éƒ¨ã‹ã‚‰æä¾›ã•ã‚Œã‚‹AnyPublisher
    var externalControlPublisher: AnyPublisher<Bool, Never>!

    func setup() {
        // ã‚¿ã‚¤ãƒãƒ¼ã¨å¤–éƒ¨ã‹ã‚‰ã®åˆ¶å¾¡ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ£ãƒ¼ã‚’combineLatestã‚’ä½¿ã£ã¦çµ„ã¿åˆã‚ã›ã‚‹
        Timer.publish(every: 1.0, on: .main, in: .common)
            .autoconnect()
            .combineLatest(externalControlPublisher) { (_, isActive) in isActive }
            .sink { [weak self] isActive in
                guard let self = self, isActive else { return } // isActive ãŒ true ã®å ´åˆã®ã¿ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—
                self.sessionDurationInSeconds += 1
                print(self.sessionDurationInSeconds)
            }
            .store(in: &cancellables)
    }

    // å¤–éƒ¨ã‹ã‚‰åˆ¶å¾¡ç”¨ã®ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ£ãƒ¼ã‚’ã‚»ãƒƒãƒˆã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰
    func setControlPublisher(_ publisher: AnyPublisher<Bool, Never>) {
        self.externalControlPublisher = publisher
    }
}

// ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ã«YourClassã‚’ä½¿ã†å ´åˆ
let yourInstance = YourClass()

// å¤–éƒ¨ã‹ã‚‰ã®åˆ¶å¾¡ç”¨ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ£ãƒ¼ã®ä¾‹ï¼ˆã“ã“ã§ã¯PassthroughSubjectã‚’ä½¿ã£ã¦ã„ã¾ã™ãŒã€ä»–ã®AnyPublisherã‚‚ä½¿ç”¨å¯èƒ½ã§ã™ï¼‰
let controlSubject = PassthroughSubject<Bool, Never>()

yourInstance.setControlPublisher(controlSubject.eraseToAnyPublisher())
yourInstance.setup()

// ã‚ã‚‹æ™‚ç‚¹ã§ã‚¿ã‚¤ãƒãƒ¼ã‚’åœæ­¢
controlSubject.send(false)

// ã‚ã‚‹æ™‚ç‚¹ã§ã‚¿ã‚¤ãƒãƒ¼ã‚’å†é–‹
controlSubject.send(true)
```

ã“ã®æ–¹æ³•ã§ã¯ã€`YourClass`ã¯å¤–éƒ¨ã‹ã‚‰åˆ¶å¾¡ç”¨ã®`AnyPublisher`ã‚’å—ã‘å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãã—ã¦ã€ã“ã®åˆ¶å¾¡ç”¨ã®`AnyPublisher`ãŒ`true`ã‚„`false`ã‚’é€å‡ºã™ã‚‹ã¨ã€ã‚¿ã‚¤ãƒãƒ¼ã®å‹•ä½œãŒãã‚Œã«å¾“ã£ã¦åˆ¶å¾¡ã•ã‚Œã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/9/20 16:15:43*

AnyPublisher ã£ã¦combineLatestã§ãã‚‹ã‚“ã ã£ã‘ï¼Ÿ

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/9/20 16:17:05*

ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚ãŠã£ã—ã‚ƒã‚‹é€šã‚Šã€`AnyPublisher`ã¯ãã®ã¾ã¾`combineLatest`ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚`AnyPublisher`ã¯å…·ä½“çš„ãªPublisherã®å‹ã‚’éš è”½ã™ã‚‹ãƒ©ãƒƒãƒ‘ãƒ¼ã§ã‚ã‚Šã€å‹ã«é–¢é€£ã™ã‚‹å…·ä½“çš„ãªã‚ªãƒšãƒ¬ãƒ¼ã‚¿ã¯`AnyPublisher`è‡ªä½“ã«ã¯å­˜åœ¨ã—ã¾ã›ã‚“ã€‚

ä»£ã‚ã‚Šã«ã€ã‚ªãƒªã‚¸ãƒŠãƒ«ã®Publisherï¼ˆ`AnyPublisher`ã«ãƒ©ãƒƒãƒ—ã™ã‚‹å‰ã®Publisherï¼‰ã«å¯¾ã—ã¦`combineLatest`ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã—ã‹ã—ã€`AnyPublisher`ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã€ã‚ªãƒªã‚¸ãƒŠãƒ«ã®Publisherã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã®ã§ã€å°‘ã—å·¥å¤«ãŒå¿…è¦ã§ã™ã€‚

ä»¥ä¸‹ã¯ã€`AnyPublisher`ã¨`Timer`ã‚’çµ„ã¿åˆã‚ã›ã‚‹æ–¹æ³•ã‚’ç¤ºã™ä¾‹ã§ã™ï¼š

```swift
import Combine

class YourClass {
    var sessionDurationInSeconds = 0
    var cancellables: Set<AnyCancellable> = []

    var externalControlPublisher: AnyPublisher<Bool, Never>!

    func setup() {
        let timerPublisher = Timer.publish(every: 1.0, on: .main, in: .common).autoconnect()

        // AnyPublisherã‚’combineLatestã™ã‚‹ãŸã‚ã«ã€mapã§Boolã‚’ãƒ©ãƒƒãƒ—ã—ã¦å†åº¦unwrapã™ã‚‹æ‰‹æ³•ã‚’å–ã‚‹
        let controlStream = externalControlPublisher.map { Optional.some($0) }.eraseToAnyPublisher()
        
        timerPublisher
            .combineLatest(controlStream) { (_, isActive) -> Bool? in isActive }
            .compactMap { $0 }  // nilã®å ´åˆã¯ç„¡è¦–ã—ã¦Boolã ã‘ã‚’å–ã‚Šå‡ºã™
            .sink { [weak self] isActive in
                guard let self = self, isActive else { return }
                self.sessionDurationInSeconds += 1
                print(self.sessionDurationInSeconds)
            }
            .store(in: &cancellables)
    }

    func setControlPublisher(_ publisher: AnyPublisher<Bool, Never>) {
        self.externalControlPublisher = publisher
    }
}

// ä½¿ç”¨ä¾‹
let yourInstance = YourClass()

let controlSubject = PassthroughSubject<Bool, Never>()

yourInstance.setControlPublisher(controlSubject.eraseToAnyPublisher())
yourInstance.setup()

controlSubject.send(true)
```

ã“ã®æ–¹æ³•ã§ã€`AnyPublisher`ã¨`Timer`ã‚’çµ„ã¿åˆã‚ã›ã¦ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/9/20 16:27:42*

ä»¥ä¸‹ã®ã‚ˆã†ãªplaygroundã§å®Ÿè¡Œã§ãã‚‹ã‚³ãƒ¼ãƒ‰ã«ãªã£ãŸ

import Combine
import Foundation

var sessionDurationInSeconds = 0
var cancellables: Set&lt;AnyCancellable&gt; = []

let hogeSubject: PassthroughSubject&lt;Int, Never&gt; = .init()
let hogePunlisher = hogeSubject.map { $0 != 0 }

// ã‚¿ã‚¤ãƒãƒ¼ã¨åˆ¶å¾¡ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ£ãƒ¼ã‚’combineLatestã‚’ä½¿ã£ã¦çµ„ã¿åˆã‚ã›ã‚‹
Timer.publish(every: 1.0, on: .main, in: .common)
    .autoconnect()
    .combineLatest(hogePunlisher)
    .filter { _, isActive in
        return isActive
    }
    .sink { _ in
        sessionDurationInSeconds += 1
        print(sessionDurationInSeconds)
    }
    .store(in: &cancellables)

hogeSubject.send(0) // ã‚¿ã‚¤ãƒãƒ¼ã‚’åœæ­¢
hogeSubject.send(1) // ã‚¿ã‚¤ãƒãƒ¼ã‚’å†é–‹
hogeSubject.send(0) // ã‚¿ã‚¤ãƒãƒ¼ã‚’å†é–‹

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/9/20 16:29:18*

è‰¯ã„ã§ã™ã­ï¼ã‚³ãƒ¼ãƒ‰ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«ãªã‚Šã€`hogeSubject`ã‚’ä½¿ç”¨ã—ã¦ã‚¿ã‚¤ãƒãƒ¼ã®å‹•ä½œã‚’åˆ¶å¾¡ã—ã¦ã„ã¾ã™ã€‚`hogePublisher`ã‚’ä»‹ã—ã¦0ã§ãªã‘ã‚Œã°ã‚¿ã‚¤ãƒãƒ¼ãŒå‹•ä½œã—ã€0ã®å ´åˆã«åœæ­¢ã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

ãŸã ã€ä¸€ã¤ã®ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦ã€Playgroundã§ã®éåŒæœŸå‡¦ç†ã‚’ç¢ºèªã™ã‚‹éš›ã€é€šå¸¸ã®çµ‚äº†å‡¦ç†ã®å‰ã«éåŒæœŸå‡¦ç†ãŒå®Œäº†ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã€`PlaygroundPage`ã®`needsIndefiniteExecution`ã‚’`true`ã«è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚’è¨­å®šã—ãªã„ã¨ã€éåŒæœŸå‡¦ç†ãŒå®Œäº†ã™ã‚‹å‰ã«Playgroundã®å®Ÿè¡ŒãŒçµ‚äº†ã—ã¦ã—ã¾ã„ã¾ã™ã€‚

ä»¥ä¸‹ã®ã‚ˆã†ã«Playgroundã®ä¸Šéƒ¨ã«è¿½åŠ ã—ã¦ãã ã•ã„ï¼š

```swift
import PlaygroundSupport
PlaygroundPage.current.needsIndefiniteExecution = true
```

ã¾ãŸã€æœ€å¾Œã®ã‚³ãƒ¡ãƒ³ãƒˆ `// ã‚¿ã‚¤ãƒãƒ¼ã‚’å†é–‹` ã¯å®Ÿéš›ã«ã¯åœæ­¢ã®å‹•ä½œã«å¯¾å¿œã—ã¦ã„ã‚‹ã®ã§ã€ã‚³ãƒ¡ãƒ³ãƒˆã‚’ä¿®æ­£ã™ã‚‹ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚

ãã‚Œã‚’è€ƒæ…®ã«å…¥ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š

```swift
import Combine
import Foundation
import PlaygroundSupport

PlaygroundPage.current.needsIndefiniteExecution = true

var sessionDurationInSeconds = 0
var cancellables: Set<AnyCancellable> = []

let hogeSubject: PassthroughSubject<Int, Never> = .init()
let hogePunlisher = hogeSubject.map { $0 != 0 }

// ã‚¿ã‚¤ãƒãƒ¼ã¨åˆ¶å¾¡ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ£ãƒ¼ã‚’combineLatestã‚’ä½¿ã£ã¦çµ„ã¿åˆã‚ã›ã‚‹
Timer.publish(every: 1.0, on: .main, in: .common)
    .autoconnect()
    .combineLatest(hogePunlisher)
    .filter { _, isActive in
        return isActive
    }
    .sink { _ in
        sessionDurationInSeconds += 1
        print(sessionDurationInSeconds)
    }
    .store(in: &cancellables)

hogeSubject.send(0) // ã‚¿ã‚¤ãƒãƒ¼ã‚’åœæ­¢
hogeSubject.send(1) // ã‚¿ã‚¤ãƒãƒ¼ã‚’å†é–‹
hogeSubject.send(0) // ã‚¿ã‚¤ãƒãƒ¼ã‚’åœæ­¢
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã€Playgroundã§ã®å‹•ä½œã‚’é©åˆ‡ã«ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/9/20 16:29:34*

ã“ã“ã«ã‚¿ã‚¤ãƒãƒ¼ã‚’3ç§’å¾Œã«é–‹å§‹ã™ã‚‹ã‚ˆã†ã«ã—ã¦æ¬²ã—ã„

hogeSubject.send(0) // ã‚¿ã‚¤ãƒãƒ¼ã‚’åœæ­¢
hogeSubject.send(1) // ã‚¿ã‚¤ãƒãƒ¼ã‚’å†é–‹
hogeSubject.send(0) // ã‚¿ã‚¤ãƒãƒ¼ã‚’åœæ­¢

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/9/20 16:29:58*

3ç§’å¾Œã«ã‚¿ã‚¤ãƒãƒ¼ã‚’é–‹å§‹ã™ã‚‹ãŸã‚ã«ã¯ã€`DispatchQueue`ã‚’ä½¿ç”¨ã—ã¦éåŒæœŸã«`hogeSubject.send(1)`ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¦ã¿ã¾ã—ãŸã€‚

```swift
hogeSubject.send(0) // ã‚¿ã‚¤ãƒãƒ¼ã‚’åœæ­¢

DispatchQueue.main.asyncAfter(deadline: .now() + 3) {
    hogeSubject.send(1) // ã‚¿ã‚¤ãƒãƒ¼ã‚’å†é–‹
}

DispatchQueue.main.asyncAfter(deadline: .now() + 6) {
    hogeSubject.send(0) // ã‚¿ã‚¤ãƒ

---

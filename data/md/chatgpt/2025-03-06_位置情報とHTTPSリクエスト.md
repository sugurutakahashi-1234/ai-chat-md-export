# ä½ç½®æƒ…å ±ã¨HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆ

æ—¥ä»˜: 2025-03-06

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/3/7 8:56:33*

flutterã®httpsã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½ç½®æƒ…å ±ã‚’å…¥ã‚Œã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ãŸã„

---

## ğŸ”§ ãƒ„ãƒ¼ãƒ«
*2025/3/7 8:56:34*

\*\*ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½ç½®æƒ…å ±ã‚’æ´»ç”¨ã™ã‚‹\*\*

Flutterã‚¢ãƒ—ãƒªã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½ç½®æƒ…å ±ã‚’å–å¾—ã—ã€httpsãƒªã‚¯ã‚¨ã‚¹ãƒˆã«çµ„ã¿è¾¼ã¿ãŸã„ã¨è€ƒãˆã¦ã„ã‚‹ã€‚åœ°ç†ä½ç½®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚„geolocatorã‚’ä½¿ã£ã¦ä½ç½®æƒ…å ±ã‚’é›†ã‚ã€httpãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚„dioã‚’ä½¿ã£ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã—ãŸã„ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/3/7 8:56:34*

ä»¥ä¸‹ã®ä¾‹ã§ã¯ã€`geolocator`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¾åœ¨ä½ç½®ã‚’å–å¾—ã—ã€`http`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¦ã„ã¾ã™ã€‚åŸºæœ¬çš„ãªæµã‚Œã¯ä¸‹è¨˜ã®é€šã‚Šã§ã™ã€‚

1. `geolocator`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦ä½ç½®æƒ…å ±å–å¾—ã®æ¨©é™ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¾åœ¨åœ°ï¼ˆç·¯åº¦ãƒ»çµŒåº¦ï¼‰ã‚’å–å¾—
3. `http`ã‚’åˆ©ç”¨ã—ã¦HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã€ãƒœãƒ‡ã‚£ã‚„ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ä½ç½®æƒ…å ±ã‚’ä»˜ä¸ã™ã‚‹

ä»¥ä¸‹ã«ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’ç¤ºã—ã¾ã™ã€‚

```dart
import 'package:flutter/material.dart';
import 'package:geolocator/geolocator.dart';
import 'package:http/http.dart' as http;
import 'dart:convert';

class LocationRequestExample extends StatefulWidget {
  const LocationRequestExample({Key? key}) : super(key: key);

  @override
  State<LocationRequestExample> createState() => _LocationRequestExampleState();
}

class _LocationRequestExampleState extends State<LocationRequestExample> {
  String _locationMessage = 'ç¾åœ¨åœ°ã‚’å–å¾—ã—ã¦ã„ã¾ã›ã‚“';
  String _serverResponse = 'ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒã‚ã‚Šã¾ã›ã‚“';

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('ä½ç½®æƒ…å ±ã¨HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä¾‹'),
      ),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: <Widget>[
            Text(_locationMessage),
            const SizedBox(height: 20),
            ElevatedButton(
              onPressed: _getLocationAndSendRequest,
              child: const Text('ä½ç½®æƒ…å ±ã‚’ä½¿ã£ã¦ã‚µãƒ¼ãƒãƒ¼ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ'),
            ),
            const SizedBox(height: 20),
            Text(_serverResponse),
          ],
        ),
      ),
    );
  }

  Future<void> _getLocationAndSendRequest() async {
    try {
      // 1. ä½ç½®æƒ…å ±ã®æ¨©é™ã‚’ç¢ºèªãƒ»ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
      LocationPermission permission = await Geolocator.checkPermission();
      if (permission == LocationPermission.denied) {
        permission = await Geolocator.requestPermission();
        if (permission == LocationPermission.denied) {
          setState(() {
            _locationMessage = 'ä½ç½®æƒ…å ±ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸã€‚æ¨©é™ã‚’è¨±å¯ã—ã¦ãã ã•ã„ã€‚';
          });
          return;
        }
      }

      // ä½ç½®æƒ…å ±ã‚µãƒ¼ãƒ“ã‚¹è‡ªä½“ãŒã‚ªãƒ•ã«ãªã£ã¦ã„ã‚‹ã‹ã®ãƒã‚§ãƒƒã‚¯
      bool isLocationServiceEnabled = await Geolocator.isLocationServiceEnabled();
      if (!isLocationServiceEnabled) {
        setState(() {
          _locationMessage = 'ä½ç½®æƒ…å ±ã‚µãƒ¼ãƒ“ã‚¹ãŒã‚ªãƒ•ã«ãªã£ã¦ã„ã¾ã™ã€‚æœ‰åŠ¹ã«ã—ã¦ãã ã•ã„ã€‚';
        });
        return;
      }

      // 2. ä½ç½®æƒ…å ±ã‚’å–å¾—
      Position position = await Geolocator.getCurrentPosition(
        desiredAccuracy: LocationAccuracy.high,
      );

      setState(() {
        _locationMessage = 'å–å¾—ã—ãŸä½ç½®æƒ…å ±: '
            'ç·¯åº¦: ${position.latitude}, çµŒåº¦: ${position.longitude}';
      });

      // 3. HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆ (ä¾‹: JSONã‚’POSTã§é€ä¿¡)
      final url = Uri.parse('https://example.com/api/locations');
      final response = await http.post(
        url,
        headers: <String, String>{
          'Content-Type': 'application/json; charset=UTF-8',
        },
        body: jsonEncode(<String, dynamic>{
          'latitude': position.latitude,
          'longitude': position.longitude,
        }),
      );

      if (response.statusCode == 200) {
        setState(() {
          _serverResponse = 'ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹: ${response.body}';
        });
      } else {
        setState(() {
          _serverResponse = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰: ${response.statusCode}';
        });
      }
    } catch (e) {
      setState(() {
        _serverResponse = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: $e';
      });
    }
  }
}
```

### è£œè¶³èª¬æ˜

- **pubspec.yamlã¸ã®è¿½åŠ **  
  `geolocator`ã¨`http`ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã«ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ä¾å­˜é–¢ä¿‚ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

  ```yaml
  dependencies:
    flutter:
      sdk: flutter
    geolocator: ^9.0.2
    http: ^0.13.5
  ```

- **æ¨©é™è¨­å®š (iOS)**  
  iOSã®å ´åˆã¯ã€`ios/Runner/Info.plist`ã®`<dict>`å†…ã«ä½ç½®æƒ…å ±ã®èª¬æ˜æ–‡ã‚’è¨˜è¼‰ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

  ```xml
  <key>NSLocationWhenInUseUsageDescription</key>
  <string>ã‚¢ãƒ—ãƒªã‚’ä½¿ç”¨ä¸­ã«ä½ç½®æƒ…å ±ã‚’åˆ©ç”¨ã—ã¾ã™</string>
  ```

- **æ¨©é™è¨­å®š (Android)**  
  Androidã®å ´åˆã¯ã€`AndroidManifest.xml`ã§ä»¥ä¸‹ã®ã‚ˆã†ã«æ¨©é™ã‚’è¿½åŠ ã—ã¾ã™ã€‚

  ```xml
  <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
  <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
  ```
  ã¾ãŸã€APIãƒ¬ãƒ™ãƒ«ã«ã‚ˆã£ã¦ã¯ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå¿…è¦ã§ã™ã€‚

- **æ³¨æ„ç‚¹**  
  - ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚„ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã§ã¯ä½ç½®æƒ…å ±ã®è¨­å®šã‚’åˆ¥é€”å¤‰æ›´ã—ãªã„ã¨ã€å®Ÿéš›ã®ç·¯åº¦çµŒåº¦ãŒå–å¾—ã§ããªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚  
  - å®Ÿæ©Ÿã®å ´åˆã¯ã€GPSã‚„Wi-Fiãªã©ã‚’æœ‰åŠ¹ã«ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  
  - iOSã§ã¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ä¸Šã§ã®ä½ç½®æƒ…å ±ãƒ†ã‚¹ãƒˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã€ŒAppleã€ãŒé¸æŠã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚å®Ÿæ©Ÿãƒ†ã‚¹ãƒˆã‚‚è¡Œã†ã¨ç¢ºå®Ÿã§ã™ã€‚  

ã“ã®ã‚ˆã†ã«ã€`geolocator`ã§ä½ç½®æƒ…å ±ã‚’å–å¾—ã—ã€HTTPSã§ã‚µãƒ¼ãƒãƒ¼ã¸é€ä¿¡ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ä¸Šè¨˜ã‚µãƒ³ãƒ—ãƒ«ã‚’å‚è€ƒã«å®Ÿè£…ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

---

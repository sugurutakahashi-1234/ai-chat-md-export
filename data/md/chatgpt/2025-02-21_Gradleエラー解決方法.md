# Gradleエラー解決方法

日付: 2025-02-21

---

## 👤 ユーザー
*2025/02/21 19:04:41*

fvm flutter run を実行したらAndroidはこうなった。
解決方法をさがしてほしい

1: Task failed with an exception.
-----------
* Where:
Build file '/Users/sugurutakahashi/git/gallusys/snpit_guild_app/android/app/build.gradle' line: 43

* What went wrong:
A problem occurred evaluating project ':app'.
&gt; path may not be null or empty string. path='null'

* Try:
&gt; Run with --stacktrace option to get the stack trace.
&gt; Run with --info or --debug option to get more log output.
&gt; Run with --scan to get full insights.
&gt; Get more help at https://help.gradle.org.
==============================================================================

2: Task failed with an exception.
-----------
* Where:
Build file '/Users/sugurutakahashi/git/gallusys/snpit_guild_app/android/app/build.gradle' line: 43

* What went wrong:
A problem occurred evaluating project ':app'.
&gt; path may not be null or empty string. path='null'

* Try:
&gt; Run with --stacktrace option to get the stack trace.
&gt; Run with --info or --debug option to get more log output.
&gt; Run with --scan to get full insights.
&gt; Get more help at https://help.gradle.org.
==============================================================================

BUILD FAILED in 506ms
Running Gradle task 'assembleDebug'...                             621ms
Error: Gradle task assembleDebug failed with exit code 1


```
import com.github.triplet.gradle.androidpublisher.ReleaseStatus

plugins {
    id "com.android.application"
    id "kotlin-android"
    // The Flutter Gradle Plugin must be applied after the Android and Kotlin Gradle plugins.
    id "dev.flutter.flutter-gradle-plugin"
    id "com.github.triplet.play"
}

def keystorePropertiesFile = rootProject.file("keystore.properties")
def keystoreProperties = new Properties()
if (keystorePropertiesFile.exists()) {
    keystoreProperties.load(new FileInputStream(keystorePropertiesFile))
}

android {
    namespace = "ae.zealnova.snpitguild"
    compileSdk = 35
    // Ref: https://developer.android.com/build/releases/gradle-plugin
    ndkVersion = "27.0.12077973"

    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_1_8
        targetCompatibility = JavaVersion.VERSION_1_8
    }

    kotlinOptions {
        jvmTarget = JavaVersion.VERSION_1_8
    }

    defaultConfig {
        minSdk = flutter.minSdkVersion
        targetSdk = 35 // for image_cropper
        versionCode = flutter.versionCode
        versionName = flutter.versionName
    }

    signingConfigs {
        release {
            keyAlias keystoreProperties['keyAlias']
            keyPassword keystoreProperties['keyPassword']
            storeFile file(keystoreProperties['storeFile'])
            storePassword keystoreProperties['storePassword']
        }
    }

    flavorDimensions "env"
    productFlavors {
        prod {
            applicationId "ae.zealnova.snpitguild"
            dimension "env"
            resValue "string", "app_name", "SNPIT Guild"
            manifestPlaceholders = [mapsApiKey: "AIzaSyBFJYhvOgi2n_QFnNzldylSsNSzOIbDV0A"]
        }
        dev {
            applicationId "ae.zealnova.snpitguild.dev"
            dimension "env"
            resValue "string", "app_name", "Guild dev"
            manifestPlaceholders = [mapsApiKey: "AIzaSyCiB4_g4T__x5ZyhD3Dt4f6Prs-Spls9q8"]
        }
    }

    buildTypes {
        release {
            signingConfig = signingConfigs.release
        }
    }

    play {
        releaseStatus.set(ReleaseStatus.DRAFT)
        serviceAccountCredentials = rootProject.file(keystoreProperties['serviceAccountFile'])
    }
}

flutter {
    source = "../.."
}
```

---

## 🔧 ツール
*2025/02/21 19:04:58*

**修正の検討**

flutter runがビルドエラーを引き起こしている。`serviceAccountCredentials`の値が`null`になっている可能性が高い。`keystoreProperties['serviceAccountFile']`の値を`null`にすると、`path`のエラーが発生している。解決策は、`serviceAccountCredentials`の削除または`keystore.properties`の正しいパス設定。

**パス設定の見直し**

`serviceAccountPath`を定義し、存在する場合は`serviceAccountCredentials`を更新している。必要ない場合は参照を削除し、`keystore.properties`で直接設定する方法も含まれている。

---

## 🤖 アシスタント
*2025/02/21 19:04:58*

Gradle のエラー「path may not be null or empty string. path='null'」は、基本的に

```gradle
serviceAccountCredentials = rootProject.file(keystoreProperties['serviceAccountFile'])
```

で渡しているパスが null（または空文字列）になっているから発生します。  
つまり `keystoreProperties['serviceAccountFile']` が正しく読み込めていない（値が設定されていない）ことが原因です。

---

## 確認するポイント

1. **`keystore.properties` に `serviceAccountFile` が定義されているか？**  
   以下のように `serviceAccountFile` のキーが存在しないと、上記のように `null` が返ってしまいます。
   ```properties
   # keystore.properties の一例
   storeFile=../app.jks
   storePassword=******
   keyAlias=******
   keyPassword=******
   
   # これがないと serviceAccountFile が null になる
   serviceAccountFile=path/to/your-service-account.json
   ```
   もしまだファイルを準備しておらず、Play コンソールとの連携が不要であれば、`build.gradle` 側の `play` ブロック自体を削除・コメントアウトしてしまうのもアリです。

2. **ファイルパスに誤りがないか？**  
   絶対パスもしくは相対パスが正しいかどうかを確認してください。  
   `serviceAccountFile=../..` のようにしている場合、そのパスが本当に `rootProject.file(...)` にとって正しい場所かどうか要チェックです。

3. **別環境で定義されていたり、バージョン管理外になっていないか？**  
   例えば `.gitignore` で `keystore.properties` やサービスアカウントのファイルを除外している場合、他の環境や他の人が clone したときにファイルが存在しなくてエラーになることがあります。  

---

## 対処法

### 1. keystore.properties に正しい serviceAccountFile を設定する

以下のように記述し、ファイルが存在することを確認します。

```properties
serviceAccountFile=../path/to/service-account.json
```

そして `build.gradle` の

```gradle
serviceAccountCredentials = rootProject.file(keystoreProperties['serviceAccountFile'])
```

をそのままにしておけば OK です。

### 2. とりあえず Play Publishing Plugin を無効化してビルドする

もしまだ Play Store への公開などでサービスアカウントを使う予定がない場合は、`build.gradle` の `play` ブロックや `com.github.triplet.play` を削除/コメントアウトするなどして、そもそも `serviceAccountCredentials` を設定しないようにすればビルドは通ります。  
最終的に必要になったタイミングで `keystore.properties` と JSON ファイルを正しく用意し、プラグインを有効にしましょう。

---

## まとめ

- 「path may not be null or empty string. path='null'」は `rootProject.file(...)` に渡すパスが `null` になっているため。  
- `keystoreProperties['serviceAccountFile']` が正しいパスを返すように `keystore.properties` を整備するか、Play Publisher プラグインの設定を一時的に外す/コメントアウトしてビルドを回避する。

---

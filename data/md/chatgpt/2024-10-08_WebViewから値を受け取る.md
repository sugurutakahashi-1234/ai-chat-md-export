# WebViewã‹ã‚‰å€¤ã‚’å—ã‘å–ã‚‹

æ—¥ä»˜: 2024-10-08

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/10/8 17:17:02*

iOS ã§ WebView ã‹ã‚‰WebViewã‚’é–‰ã˜ã¦å€¤ã‚’iOSã«æŒã£ã¦ã„ããŸã„

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/10/8 17:17:31*

iOS ã§ WebView ã‚’é–‰ã˜ã¦ã€å€¤ã‚’ãƒã‚¤ãƒ†ã‚£ãƒ–ã® Swift ã‚¢ãƒ—ãƒªã«æŒã£ã¦ãã‚‹ã«ã¯ã€`WKScriptMessageHandler` ã‚’ä½¿ã£ã¦ã€WebView ã¨ Swift é–“ã§é€šä¿¡ã‚’è¡Œã„ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚¹ãƒ†ãƒƒãƒ—ã§å®Ÿè£…ã§ãã¾ã™ã€‚

1. **JavaScript ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡**
   WebView ã®ä¸­ã§ JavaScript ã‚’ä½¿ã£ã¦ `window.webkit.messageHandlers` ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã‚Šã¾ã™ã€‚ã“ã‚ŒãŒ iOS å´ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™ãŸã‚ã®æ–¹æ³•ã§ã™ã€‚

   ```javascript
   // WebView ã® JavaScript å†…
   function sendValueToiOS(value) {
       window.webkit.messageHandlers.callbackHandler.postMessage(value);
   }

   // ä¾‹ãˆã°ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã«å‘¼ã³å‡ºã™
   document.getElementById('submitButton').onclick = function() {
       sendValueToiOS('é€ä¿¡ã—ãŸã„å€¤');
   };
   ```

2. **iOS å´ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ã‘å–ã‚‹**
   `WKScriptMessageHandler` ã‚’ä½¿ã£ã¦ã€WebView ã‹ã‚‰é€ã‚‰ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚

   ```swift
   import SwiftUI
   import WebKit

   struct WebView: UIViewRepresentable {
       let url: URL
       let onValueReceived: (String) -> Void  // WebView ã‹ã‚‰å€¤ã‚’å—ã‘å–ã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯

       func makeCoordinator() -> Coordinator {
           Coordinator(onValueReceived: onValueReceived)
       }

       func makeUIView(context: Context) -> WKWebView {
           let webView = WKWebView()
           let contentController = webView.configuration.userContentController
           contentController.add(context.coordinator, name: "callbackHandler") // JavaScript ã®åå‰ã¨åˆã‚ã›ã‚‹
           let request = URLRequest(url: url)
           webView.load(request)
           return webView
       }

       func updateUIView(_ uiView: WKWebView, context: Context) {}

       class Coordinator: NSObject, WKScriptMessageHandler {
           let onValueReceived: (String) -> Void

           init(onValueReceived: @escaping (String) -> Void) {
               self.onValueReceived = onValueReceived
           }

           func userContentController(_ userContentController: WKUserContentController, didReceive message: WKScriptMessage) {
               if message.name == "callbackHandler", let value = message.body as? String {
                   onValueReceived(value)  // Swift ã«å€¤ã‚’æ¸¡ã™
               }
           }
       }
   }

   struct ContentView: View {
       @State private var receivedValue = ""

       var body: some View {
           VStack {
               WebView(url: URL(string: "https://your-web-url.com")!) { value in
                   receivedValue = value
                   // WebView ãŒé–‰ã˜ãŸå¾Œã®å‡¦ç†ã‚„å€¤ã®å‡¦ç†ã‚’ã“ã“ã§è¡Œã†
               }
               Text("å—ã‘å–ã£ãŸå€¤: \(receivedValue)")
           }
       }
   }
   ```

3. **WebView ã‚’é–‰ã˜ã‚‹**
   WebView ã‚’é–‰ã˜ã‚‹ã«ã¯ã€å€¤ã‚’å—ã‘å–ã£ãŸå¾Œã« SwiftUI ã® `dismiss` ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚ä¾‹ãˆã°ã€`onValueReceived` å†…ã§ WebView ã‚’é–‰ã˜ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

   ```swift
   @Environment(\.dismiss) private var dismiss

   func receivedValue(value: String) {
       // å€¤ã‚’ä½¿ã£ãŸå‡¦ç†
       dismiss()  // WebView ã‚’é–‰ã˜ã‚‹
   }
   ```

ã“ã®æ–¹æ³•ã§ã€WebView ã‹ã‚‰å€¤ã‚’ iOS ã‚¢ãƒ—ãƒªã«æŒã£ã¦ãã¦ã€WebView ã‚’é–‰ã˜ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

---

# Guild削除処理実装

日付: 2024-12-24

---

## 👤 ユーザー
*2024/12/24 15:12:15*

onプレスで削除処理を入れて欲しい

import 'package:flutter/foundation.dart';
import 'package:riverpod\_annotation/riverpod\_annotation.dart';

import 'package:snpit\_guild\_app/presentation/providers/api\_client/guild\_api\_provider.dart';

part 'delete\_guild.g.dart';

@riverpod
class DeleteGuildNotifier extends \_$DeleteGuildNotifier {
  @override
  Future&lt;String?&gt; build() async =&gt; null;

  Future&lt;void&gt; executeRequest(String guildId) async {
    state = const AsyncValue.loading();
    try {
      final api = await ref.watch(guildApiProvider.future);
      final response = await api.guildControllerDeleteGuild(guildId: guildId);
      debugPrint('Response Body: ${response.data}');
      state = AsyncValue.data(response.data?.data);
    } on Exception catch (e, stackTrace) {
      debugPrint('Error: $e');
      debugPrint('StackTrace: $stackTrace');
      state = AsyncValue.error(e, stackTrace);
    }
  }
}

import 'package:flutter/material.dart';
import 'package:hooks\_riverpod/hooks\_riverpod.dart';

class GuildEditPage extends HookConsumerWidget {
  const GuildEditPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    return Scaffold(
      appBar: AppBar(title: const Text('Guild Edit')),
      body: Padding(
        padding: const EdgeInsets.symmetric(horizontal: 16),
        child: SingleChildScrollView(
          child: Column(
            children: \[
              ElevatedButton(
                onPressed: () {
                  // Add your delete logic here
                },
                child: const Text('Delete Guild'),
              ),
            \],
          ),
        ),
      ),
    );
  }
}

---

## 🤖 アシスタント
*2024/12/24 15:12:33*

以下のコードを基に、`DeleteGuildNotifier` を使用して削除処理を `onPressed` 内に追加しました。これにより、ボタンが押されたときに削除処理が実行されます。

```dart
import 'package:flutter/material.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:snpit_guild_app/presentation/providers/delete_guild/delete_guild.dart';

class GuildEditPage extends HookConsumerWidget {
  const GuildEditPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final deleteGuildNotifier = ref.watch(deleteGuildNotifierProvider.notifier);

    return Scaffold(
      appBar: AppBar(title: const Text('Guild Edit')),
      body: Padding(
        padding: const EdgeInsets.symmetric(horizontal: 16),
        child: SingleChildScrollView(
          child: Column(
            children: [
              ElevatedButton(
                onPressed: () async {
                  final guildId = 'your-guild-id'; // 削除対象のギルドIDを指定
                  final result = await showDialog<bool>(
                    context: context,
                    builder: (context) => AlertDialog(
                      title: const Text('Delete Guild'),
                      content: const Text('Are you sure you want to delete this guild?'),
                      actions: [
                        TextButton(
                          onPressed: () => Navigator.of(context).pop(false),
                          child: const Text('Cancel'),
                        ),
                        TextButton(
                          onPressed: () => Navigator.of(context).pop(true),
                          child: const Text('Delete'),
                        ),
                      ],
                    ),
                  );

                  if (result == true) {
                    // 削除処理の実行
                    await deleteGuildNotifier.executeRequest(guildId);
                    final state = ref.read(deleteGuildNotifierProvider);
                    state.when(
                      data: (data) {
                        ScaffoldMessenger.of(context).showSnackBar(
                          SnackBar(content: Text('Guild deleted successfully: $data')),
                        );
                      },
                      error: (e, stackTrace) {
                        ScaffoldMessenger.of(context).showSnackBar(
                          SnackBar(content: Text('Error deleting guild: $e')),
                        );
                      },
                      loading: () {
                        ScaffoldMessenger.of(context).showSnackBar(
                          const SnackBar(content: Text('Deleting guild...')),
                        );
                      },
                    );
                  }
                },
                child: const Text('Delete Guild'),
              ),
            ],
          ),
        ),
      ),
    );
  }
}
```

### 主な変更点
1. **ギルドIDの指定**: `guildId` を仮に `'your-guild-id'` として設定しています。実際には適切な値を渡してください。
2. **ダイアログによる確認**: 削除前にユーザーに確認を求めるダイアログを表示します。
3. **削除処理の呼び出し**: `DeleteGuildNotifier` の `executeRequest` メソッドを呼び出して削除を実行します。
4. **削除成功/失敗時のフィードバック**: 成功時やエラー発生時に `SnackBar` で通知します。

これにより、ユーザーがボタンを押すと、削除処理が適切に実行されます。

---

## 👤 ユーザー
*2024/12/24 15:13:09*

ref.listen&lt;AsyncValue&lt;String?&gt;&gt;( でハンドリングしてほしい

---

## 🤖 アシスタント
*2024/12/24 15:13:31*

`ref.listen<AsyncValue<String?>>` を使用して、削除処理の状態変化をリッスンしてハンドリングするコードを以下に示します。これにより、削除処理の成功や失敗を `SnackBar` で通知することができます。

```dart
import 'package:flutter/material.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:snpit_guild_app/presentation/providers/delete_guild/delete_guild.dart';

class GuildEditPage extends HookConsumerWidget {
  const GuildEditPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    // 状態の変更をリッスンしてハンドリング
    ref.listen<AsyncValue<String?>>(
      deleteGuildNotifierProvider,
      (previous, next) {
        next.when(
          data: (data) {
            ScaffoldMessenger.of(context).showSnackBar(
              SnackBar(content: Text('Guild deleted successfully: $data')),
            );
          },
          error: (e, stackTrace) {
            ScaffoldMessenger.of(context).showSnackBar(
              SnackBar(content: Text('Error deleting guild: $e')),
            );
          },
          loading: () {
            ScaffoldMessenger.of(context).showSnackBar(
              const SnackBar(content: Text('Deleting guild...')),
            );
          },
        );
      },
    );

    final deleteGuildNotifier = ref.watch(deleteGuildNotifierProvider.notifier);

    return Scaffold(
      appBar: AppBar(title: const Text('Guild Edit')),
      body: Padding(
        padding: const EdgeInsets.symmetric(horizontal: 16),
        child: SingleChildScrollView(
          child: Column(
            children: [
              ElevatedButton(
                onPressed: () async {
                  final guildId = 'your-guild-id'; // 削除対象のギルドIDを指定
                  final result = await showDialog<bool>(
                    context: context,
                    builder: (context) => AlertDialog(
                      title: const Text('Delete Guild'),
                      content: const Text('Are you sure you want to delete this guild?'),
                      actions: [
                        TextButton(
                          onPressed: () => Navigator.of(context).pop(false),
                          child: const Text('Cancel'),
                        ),
                        TextButton(
                          onPressed: () => Navigator.of(context).pop(true),
                          child: const Text('Delete'),
                        ),
                      ],
                    ),
                  );

                  if (result == true) {
                    // 削除処理の実行
                    await deleteGuildNotifier.executeRequest(guildId);
                  }
                },
                child: const Text('Delete Guild'),
              ),
            ],
          ),
        ),
      ),
    );
  }
}
```

### 主な変更点
1. **`ref.listen` を使用**:
   - `deleteGuildNotifierProvider` の状態変化をリッスンして、成功、失敗、ロード中の状態をハンドリングします。
   - 状態が変化するたびに適切な `SnackBar` を表示します。

2. **UI の簡潔化**:
   - 削除ボタンのロジックは変わらず、リッスンすることで、`onPressed` の中で状態チェックをする必要がありません。

### 利点
- `ref.listen` を使用することで、非同期の状態変化を明確に分離し、UI ロジックを簡潔に保つことができます。
- 冗長な状態管理が不要になり、アプリケーションの可読性と保守性が向上します。

これで削除処理の結果を簡単にユーザーに通知できるようになります！

---

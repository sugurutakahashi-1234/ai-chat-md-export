# 絞り込み処理 Dart

日付: 2025-01-16

---

## 👤 ユーザー
*2025/01/16 16:45:12*

final photoUrl = spotDetail.spotPhotos?.first.photoUrl ?? '';

@freezed
class SpotPhotoDTO with _$SpotPhotoDTO {
  factory SpotPhotoDTO({
    @JsonKey(name: 'photoName') required String? photoName,
    @JsonKey(name: 'photoDescription') String? photoDescription,
    @JsonKey(name: 'photoUrl') required String? photoUrl,
    @JsonKey(name: 'photoType') required SpotPhotoDTOPhotoType? photoType,
    @JsonKey(name: 'photoStatus') required SpotPhotoDTOPhotoStatus? photoStatus,
    @JsonKey(name: 'guildId') String? guildId,
  }) = _SpotPhotoDTO;

  factory SpotPhotoDTO.fromJson(Map&lt;String, dynamic&gt; jsonMap) =&gt;
      _$SpotPhotoDTOFromJson(jsonMap);
}


enum SpotPhotoDTOPhotoType {
  @JsonValue('ADMIN_PHOTOS')
  ADMIN_PHOTOS,
  @JsonValue('USER_PHOTOS')
  USER_PHOTOS,
  @JsonValue('DECOY_PHOTOS')
  DECOY_PHOTOS,
}

ADMIN_PHOTOS を一つに絞り込む処理を書きたい

---

## 🤖 アシスタント
*2025/01/16 16:45:25*

`ADMIN_PHOTOS` を一つに絞り込む処理を実現するためには、リスト内の `SpotPhotoDTO` インスタンスから `photoType` が `ADMIN_PHOTOS` のものを1つ取得するロジックを実装します。以下のように、Dart でフィルタリング処理を記述できます。

### 実装例

```dart
SpotPhotoDTO? getAdminPhoto(List<SpotPhotoDTO> spotPhotos) {
  return spotPhotos.firstWhere(
    (photo) => photo.photoType == SpotPhotoDTOPhotoType.ADMIN_PHOTOS,
    orElse: () => null, // ADMIN_PHOTOS がない場合は null を返す
  );
}
```

### 使い方

```dart
final adminPhoto = getAdminPhoto(spotDetail.spotPhotos ?? []);

if (adminPhoto != null) {
  final photoUrl = adminPhoto.photoUrl ?? '';
  print('Admin photo URL: $photoUrl');
} else {
  print('No ADMIN_PHOTOS found');
}
```

### 解説

1. **`firstWhere`**:
   - リスト内の最初に条件を満たす要素を返します。
   - 条件を満たす要素がない場合、`orElse` で指定された値を返します。

2. **安全性**:
   - リストが空の場合や条件を満たす要素がない場合に対応するため、`orElse` を指定しています。

3. **必要に応じたデフォルト値の扱い**:
   - `photoUrl` にデフォルト値を設定する場合は、`?? ''` を利用しています。

この処理で `ADMIN_PHOTOS` の中から最初の1つを簡単に取得できます。

---

## 👤 ユーザー
*2025/01/16 16:46:05*

関数を作らないでspotDetail.spotPhotosで続くように書いてほしい。nullを許容にしていいよ

---

## 🤖 アシスタント
*2025/01/16 16:46:19*

関数を作らずに、`spotDetail.spotPhotos` のチェーンをそのまま続ける形で書く場合、以下のように記述できます：

```dart
final photoUrl = spotDetail.spotPhotos
    ?.firstWhere(
      (photo) => photo.photoType == SpotPhotoDTOPhotoType.ADMIN_PHOTOS,
      orElse: () => null,
    )
    ?.photoUrl;
```

### 解説

1. **`?.` (Null安全オペレータ)**:
   - `spotDetail.spotPhotos` が `null` の場合でも安全にアクセスを試みるようにしています。

2. **`firstWhere`**:
   - 条件を満たす最初の要素を返します。
   - 条件を満たす要素がない場合に `orElse` を指定して `null` を返すようにしています。

3. **`?.photoUrl`**:
   - `firstWhere` の結果が `null` でも `.photoUrl` を安全に参照できるようにしています。

4. **結果**:
   - `photoUrl` は、`ADMIN_PHOTOS` タイプの最初の写真の URL または `null` が代入されます。

### 完成したコードの例

```dart
final photoUrl = spotDetail.spotPhotos
    ?.firstWhere(
      (photo) => photo.photoType == SpotPhotoDTOPhotoType.ADMIN_PHOTOS,
      orElse: () => null,
    )
    ?.photoUrl ?? '';
```

`photoUrl` が `null` の場合でも空文字列（`''`）が設定されます。この方法で簡潔に記述できます。

---

## 👤 ユーザー
*2025/01/16 16:48:35*

orElse いるの？

---

## 🤖 アシスタント
*2025/01/16 16:48:50*

`orElse` は、`firstWhere` を使用した際に、条件を満たす要素が存在しない場合の動作を指定するためのものです。ただし、今回のケースでは `?.`（null安全オペレーター）を使っているため、`orElse` を省略しても問題なく動作します。

以下のように書けます：

```dart
final photoUrl = spotDetail.spotPhotos
    ?.firstWhere((photo) => photo.photoType == SpotPhotoDTOPhotoType.ADMIN_PHOTOS)
    ?.photoUrl ?? '';
```

### なぜ `orElse` が省略できるのか？
- `firstWhere` のドキュメントによると、`orElse` が省略された場合、条件を満たす要素が見つからないと例外がスローされます。
- ただし、`?.` を使うことで、`spotDetail.spotPhotos` や `firstWhere` の結果が `null` でも安全に処理を進められます。

### 注意点
もしリスト内に該当する要素が必ず存在することが保証されている場合、この書き方で問題ありません。ただし、条件に該当する要素がリスト内に存在しない可能性がある場合に例外がスローされるリスクがあるため、その場合は `orElse` を指定する方が安全です。

安全に動作させたい場合の例：

```dart
final photoUrl = spotDetail.spotPhotos
    ?.firstWhere(
      (photo) => photo.photoType == SpotPhotoDTOPhotoType.ADMIN_PHOTOS,
      orElse: () => null,
    )
    ?.photoUrl ?? '';
```

**結論**:
条件に合う要素が必ず存在するなら `orElse` は不要ですが、不確実なら追加しておくのが良いです。

---

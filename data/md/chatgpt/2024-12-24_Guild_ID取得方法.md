# Guild ID取得方法

Date: 2024-12-24

---

## 👤 User
*2024-12-24 16:24:23*

この画面で const guildId = 'your-guild-id'; // 削除対象のギルドIDを指定のところをgetMyGuildNotifierProviderで撮ってきた値にしたい

import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:go_router/go_router.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/guilds/delete_guild.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/guilds/get_guild_info.dart';

class GuildEditPage extends HookConsumerWidget {
  const GuildEditPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
     useEffect(
      () {
        Future.microtask(() {
          ref.read(getMyGuildNotifierProvider.notifier).executeRequest();
        });
        return null;
      },
      [],
    );

    ref.listen&lt;AsyncValue&lt;String?&gt;&gt;(
      deleteGuildNotifierProvider,
      (previous, next) {
        next.when(
          data: (data) {
            if (data == null) {
              return;
            }
            ScaffoldMessenger.of(context).showSnackBar(
              SnackBar(content: Text('Guild deleted successfully: $data')),
            );
            context.pop();
          },
          error: (e, stackTrace) {
            ScaffoldMessenger.of(context).showSnackBar(
              SnackBar(content: Text('Error deleting guild: $e')),
            );
          },
          loading: () {
            ScaffoldMessenger.of(context).showSnackBar(
              const SnackBar(content: Text('Deleting guild...')),
            );
          },
        );
      },
    );

    return Scaffold(
      appBar: AppBar(title: const Text('Guild Edit')),
      body: Padding(
        padding: const EdgeInsets.all(16),
        child: SingleChildScrollView(
          child: Column(
            children: [
              ElevatedButton(
                onPressed: () async {
                  const guildId = 'your-guild-id'; // 削除対象のギルドIDを指定
                  final deleteGuildNotifier =
                      ref.watch(deleteGuildNotifierProvider.notifier);
                  final result = await showDialog&lt;bool&gt;(
                    context: context,
                    builder: (context) =&gt; AlertDialog(
                      title: const Text('Delete Guild'),
                      content: const Text(
                        'Are you sure you want to delete this guild?',
                      ),
                      actions: [
                        TextButton(
                          onPressed: () =&gt; context.pop(false),
                          child: const Text('Cancel'),
                        ),
                        TextButton(
                          onPressed: () =&gt; context.pop(true),
                          child: const Text('Delete'),
                        ),
                      ],
                    ),
                  );

                  if (result == true) {
                    // 削除処理の実行
                    await deleteGuildNotifier.executeRequest(guildId);
                  }
                },
                child: const Text('Delete Guild'),
              ),
            ],
          ),
        ),
      ),
    );
  }
}

import 'package:flutter/foundation.dart';
import 'package:riverpod_annotation/riverpod_annotation.dart';

import 'package:snpit_guild_app/infrastructure/snapit_guild_api/snapit_guild_api.openapi.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/guild_api_provider.dart';

part 'get_guild_info.g.dart';

@riverpod
class GetMyGuildNotifier extends _$GetMyGuildNotifier {
  @override
  Future&lt;GuildInfoResponseDtoData?&gt; build() async =&gt; null;

  Future&lt;void&gt; executeRequest() async {
    state = const AsyncValue.loading();
    try {
      final api = await ref.watch(guildApiProvider.future);
      final response = await api.guildControllerGetGuildInfo();
      debugPrint('Response Body: ${response.data}');
      debugPrint('Response Body.data: ${response.data?.data}');
      state = AsyncValue.data(response.data?.data);
    } on Exception catch (e, stackTrace) {
      debugPrint('Error: $e');
      debugPrint('StackTrace: $stackTrace');
      state = AsyncValue.error(e, stackTrace);
    }
  }
}



/// Guild information.
@freezed
class GuildInfoResponseDtoData with _$GuildInfoResponseDtoData {
  factory GuildInfoResponseDtoData({
    @JsonKey(name: 'guildId') required String? guildId,
    @JsonKey(name: 'guildName') required String? guildName,
    @JsonKey(name: 'guildDescription') String? guildDescription,
    @JsonKey(name: 'guildOwner') required String? guildOwner,
    @JsonKey(name: 'guildAvatar') String? guildAvatar,
    @JsonKey(name: 'guildBanner') String? guildBanner,
    @JsonKey(name: 'guildMembers') required List&lt;GuildMemberDto&gt;? guildMembers,
  }) = _GuildInfoResponseDtoData;

  factory GuildInfoResponseDtoData.fromJson(Map&lt;String, dynamic&gt; jsonMap) =&gt;
      _$GuildInfoResponseDtoDataFromJson(jsonMap);
}
@freezed
class GuildInfoResponseDtoData with _$GuildInfoResponseDtoData {
  factory GuildInfoResponseDtoData({
    @JsonKey(name: 'guildId') required String? guildId,
    @JsonKey(name: 'guildName') required String? guildName,
    @JsonKey(name: 'guildDescription') String? guildDescription,
    @JsonKey(name: 'guildOwner') required String? guildOwner,
    @JsonKey(name: 'guildAvatar') String? guildAvatar,
    @JsonKey(name: 'guildBanner') String? guildBanner,
    @JsonKey(name: 'guildMembers') required List&lt;GuildMemberDto&gt;? guildMembers,
  }) = _GuildInfoResponseDtoData;

  factory GuildInfoResponseDtoData.fromJson(Map&lt;String, dynamic&gt; jsonMap) =&gt;
      _$GuildInfoResponseDtoDataFromJson(jsonMap);
}

@freezed

---

## 🤖 Assistant
*2024-12-24 16:24:46*

`const guildId = 'your-guild-id';` を `getMyGuildNotifierProvider` から取得した値に置き換えるためには、以下のように変更を加えます。`getMyGuildNotifierProvider` から `guildId` を取得して、その値を `deleteGuildNotifier.executeRequest` に渡す実装です。

### 修正後のコード

```dart
import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:go_router/go_router.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/guilds/delete_guild.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/guilds/get_guild_info.dart';

class GuildEditPage extends HookConsumerWidget {
  const GuildEditPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    useEffect(
      () {
        Future.microtask(() {
          ref.read(getMyGuildNotifierProvider.notifier).executeRequest();
        });
        return null;
      },
      [],
    );

    ref.listen<AsyncValue<String?>>(
      deleteGuildNotifierProvider,
      (previous, next) {
        next.when(
          data: (data) {
            if (data == null) {
              return;
            }
            ScaffoldMessenger.of(context).showSnackBar(
              SnackBar(content: Text('Guild deleted successfully: $data')),
            );
            context.pop();
          },
          error: (e, stackTrace) {
            ScaffoldMessenger.of(context).showSnackBar(
              SnackBar(content: Text('Error deleting guild: $e')),
            );
          },
          loading: () {
            ScaffoldMessenger.of(context).showSnackBar(
              const SnackBar(content: Text('Deleting guild...')),
            );
          },
        );
      },
    );

    final guildInfo = ref.watch(getMyGuildNotifierProvider);

    return Scaffold(
      appBar: AppBar(title: const Text('Guild Edit')),
      body: Padding(
        padding: const EdgeInsets.all(16),
        child: SingleChildScrollView(
          child: Column(
            children: [
              ElevatedButton(
                onPressed: () async {
                  final guildId = guildInfo.whenOrNull(
                    data: (data) => data?.guildId,
                  );

                  if (guildId == null) {
                    ScaffoldMessenger.of(context).showSnackBar(
                      const SnackBar(content: Text('Guild ID not available')),
                    );
                    return;
                  }

                  final deleteGuildNotifier =
                      ref.watch(deleteGuildNotifierProvider.notifier);
                  final result = await showDialog<bool>(
                    context: context,
                    builder: (context) => AlertDialog(
                      title: const Text('Delete Guild'),
                      content: const Text(
                        'Are you sure you want to delete this guild?',
                      ),
                      actions: [
                        TextButton(
                          onPressed: () => context.pop(false),
                          child: const Text('Cancel'),
                        ),
                        TextButton(
                          onPressed: () => context.pop(true),
                          child: const Text('Delete'),
                        ),
                      ],
                    ),
                  );

                  if (result == true) {
                    // 削除処理の実行
                    await deleteGuildNotifier.executeRequest(guildId);
                  }
                },
                child: const Text('Delete Guild'),
              ),
            ],
          ),
        ),
      ),
    );
  }
}
```

### 変更点
1. **`guildId` を `getMyGuildNotifierProvider` から取得**
   ```dart
   final guildId = guildInfo.whenOrNull(
     data: (data) => data?.guildId,
   );
   ```

2. **`guildId` が `null` の場合のハンドリング**
   - `guildId` が利用可能でない場合、SnackBar でユーザーに通知。

3. **`useEffect` の実行を変更せず、初回に `getMyGuildNotifierProvider` をトリガー**
   - 既存のコードをそのまま保持。

この修正により、`guildId` が動的に `getMyGuildNotifierProvider` から取得されるようになります。

---

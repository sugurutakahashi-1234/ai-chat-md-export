# SwiftUI で3点リーダーアニメーション

日付: 2023-06-07

---

## 👤 ユーザー
*2023/6/7 16:18:38*

SwiftUIで3点リーダーがローディング中に1個2個3個-&gt;1個2個3個みたいに繰り返すようなものをつくりたいのだけどどうすればできる？

---

## 🤖 アシスタント
*2023/6/7 16:19:22*

SwiftUI で 3点リーダーがローディング中に 1個、2個、3個と順番に表示されて、その後繰り返し再生されるようなアニメーションを作成するために、`Timer`を利用して定期的にテキストを更新することができます。

下記に、そのための基本的なコードを示します。

```swift
import SwiftUI

struct LoadingView: View {
    @State private var dots = 0
    private let timer = Timer.publish(every: 0.5, on: .main, in: .common).autoconnect()

    var body: some View {
        Text("Loading" + String(repeating: ".", count: dots))
            .onReceive(timer) { _ in
                dots = (dots + 1) % 4
            }
    }
}

struct ContentView: View {
    var body: some View {
        LoadingView()
    }
}

struct ContentView_Previews: PreviewProvider {
    static var previews: some View {
        ContentView()
    }
}
```

このコードは、`LoadingView`という新しいビューコンポーネントを作成します。これは"Loading"というテキストを表示し、後ろに`dots`変数の数だけ"."（ドット）を付け加えます。これにより"Loading."、"Loading.."、"Loading..."のように表示されます。

また、このビューは0.5秒ごとに`dots`の数を更新します。これにより、ドットの数が0から3まで増えた後、再び0に戻り、繰り返されることでアニメーションを再現しています。

そして、このLoadingViewはContentView内で使用され、PreviewProviderはビューをプレビュー表示するために使用されています。

---

## 👤 ユーザー
*2023/6/7 16:19:47*

また、ImageAssetに登録した画像を回転させる場合はどうすればいいかな？

---

## 🤖 アシスタント
*2023/6/7 16:20:33*

SwiftUIを使用して、アセットカタログに保存された画像を回転させるには、`rotationEffect`修飾子を使用します。この修飾子はビューに回転効果を追加します。

以下に、定期的に画像を回転させるサンプルコードを提供します。このコードは、`rotationEffect`を使用して0から360度までの画像を2秒ごとに回転させ、それを無限に繰り返します。

```swift
import SwiftUI

struct RotatingImageView: View {
    @State private var isRotating = false

    var body: some View {
        Image("YourImageName") // 画像の名前を指定します
            .resizable()
            .scaledToFit()
            .rotationEffect(.degrees(isRotating ? 360 : 0))
            .animation(Animation.linear(duration: 2).repeatForever(autoreverses: false))
            .onAppear() {
                self.isRotating = true
            }
    }
}

struct ContentView: View {
    var body: some View {
        RotatingImageView()
    }
}

struct ContentView_Previews: PreviewProvider {
    static var previews: some View {
        ContentView()
    }
}
```

このコードは、`RotatingImageView`という新しいビューコンポーネントを作成します。これは指定された画像を表示し、`isRotating`がtrueになると、その画像は360度回転します。この効果は2秒間続き、その後無限に繰り返されます。

そして、このRotatingImageViewはContentView内で使用され、PreviewProviderはビューをプレビュー表示するために使用されています。

`Image("YourImageName")`の部分には、回転させたい画像の名前を入力してください。この名前は、XcodeのAssets.xcassets内で設定したものでなければなりません。

---

## 👤 ユーザー
*2023/6/7 16:21:48*

iOS15でも対応したい。`'animation' was deprecated in iOS 15.0: Use withAnimation or animation(_:value:) instead.`というエラーになった

---

## 🤖 アシスタント
*2023/6/7 16:22:31*

iOS 15 では、以前の `.animation` 修飾子が非推奨となり、代わりに `withAnimation` または `.animation(_:value:)` が推奨されます。

以下に、`withAnimation` を使用して画像を回転させるサンプルコードを示します。

```swift
import SwiftUI

struct RotatingImageView: View {
    @State private var rotation = 0.0

    var body: some View {
        Image("YourImageName") // 画像の名前を指定します
            .resizable()
            .scaledToFit()
            .rotationEffect(.degrees(rotation))
            .onAppear() {
                withAnimation(Animation.linear(duration: 2).repeatForever(autoreverses: false)) {
                    rotation = 360
                }
            }
    }
}

struct ContentView: View {
    var body: some View {
        RotatingImageView()
    }
}

struct ContentView_Previews: PreviewProvider {
    static var previews: some View {
        ContentView()
    }
}
```

このコードは `withAnimation` ブロック内で `rotation` を更新します。その結果、`rotationEffect` は新しい `rotation` 値に基づいてアニメーションを行います。このアニメーションは2秒間続き、その後無限に繰り返されます。

そして、このRotatingImageViewはContentView内で使用され、PreviewProviderはビューをプレビュー表示するために使用されています。

`Image("YourImageName")`の部分には、回転させたい画像の名前を入力してください。この名前は、XcodeのAssets.xcassets内で設定したものでなければなりません。

---

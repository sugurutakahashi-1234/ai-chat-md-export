# List vs BuiltList選択ガイド

日付: 2025-03-05

---

## 👤 ユーザー
*2025/03/05 17:12:30*

【Dart/Flutter】ListとBuiltListの違いとBuilt Collectionについて教えてほしい。SDKがBuildListで返却してくるので、これをListに変えた方がいいのかBuiltListに変えた方がいいのかよくわかっていない

---

## 🔧 ツール
*2025/03/05 17:12:31*

**考慮している事項**

DartのListとBuiltListの違いを理解している。BuiltValueライブラリの immutableな集合体であるBuiltListに興味津々。

---

## 🤖 アシスタント
*2025/03/05 17:12:30*

**結論から言うと、以下のように考えると分かりやすいです。**

1. **イミュータブル（変更不可）のコレクションを扱うメリットを活かしたい場合**  
   -&gt; **BuiltList** を使う  
2. **イミュータブルである必要がなく、標準の List で十分な場合**  
   -&gt; **List** に変換する  

---

## List と BuiltList の主な違い

### 1. BuiltList はイミュータブル

- **List** は要素の追加・削除・更新が自在にできる “ミュータブル” なコレクションです。  
- **BuiltList** は `built_collection` ライブラリが提供する “イミュータブル” なコレクションです。  
  - 追加や削除などの操作を直接は行えず、要素を変えたい場合は `rebuild` や Builder パターンを使います。  

イミュータブルなコレクションを使うと、  
- 予期せぬ箇所から変更が入ってバグになるリスクが減る  
- 再代入されない性質ゆえにデバッグがしやすい  
- マルチスレッド／並列処理での状態不整合を回避しやすい  

といったメリットがあります。

### 2. List は標準クラス、BuiltList は外部パッケージ依存

- **List** は Dart の標準クラスなので、そのまま使うだけならどのような依存ライブラリも不要です。  
- **BuiltList** は `built_collection` と `built_value` 系のパッケージが必要になります。  
  - その代わり、`built_value` と組み合わせてモデルを**完全にイミュータブルな形**で運用できるメリットがあります。

### 3. `BuiltList` のまま扱ったほうがよいケース

- **ビジネスロジックやデータモデルをイミュータブルに保ちたい**とき
- **`built_value` を使っている**／既存のコードが BuiltList を前提としているとき
- 新しく要素を入れたり削除したりする操作が（設計として）想定されておらず、むしろ「勝手に変更されるリスクを減らしたい」ケース

### 4. List に変換したほうがよいケース

- 外部ライブラリや他のフレームワーク部分が **List** を前提にしている  
  - Flutter のウィジェット側の表示ロジックなどで List が求められる  
  - JSON 変換などで List が使いやすい場合  
- どうしてもミュータブルな操作が中心になる  
  - 「とにかくコードを簡単に書きたい」「自由に要素を追加・削除したい」  
- イミュータブルな管理コストよりも、Dart 標準リストが持つ柔軟性を優先したい

---

## まとめ

- `built_value` を使って **イミュータブル** なデータ管理をするのであれば、**BuiltList で受け取ってそのまま扱う** ほうがメリットが大きいです。  
- ただし、UI 層や一部のライブラリなど **List** が必要な場合は、`toList()` などを使って都度変換すれば OK です。

よくあるパターンとしては、**ビジネスロジックや Model 層では BuiltList で保ち、Flutter の Widget に引き渡すギリギリで List に変換する**、という使い分け方が多いです。  
特に強い理由がないなら、返却が BuiltList になっている部分はそのまま **BuiltList** として利用するのがおすすめです。

---

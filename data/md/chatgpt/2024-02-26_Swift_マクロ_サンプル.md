# Swift ãƒã‚¯ãƒ­ ã‚µãƒ³ãƒ—ãƒ«

æ—¥ä»˜: 2024-02-26

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/02/26 19:43:53*

Xcode15ã‹ã‚‰ã§ãã‚‹ swift macro ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã»ã—ã„ã€‚playgroundã§è©¦ã›ã‚‹ã¨å¬‰ã—ã„

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/02/26 19:44:38*

Xcode 15ã«å°å…¥ã•ã‚ŒãŸSwiftãƒã‚¯ãƒ­ã¯ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ã‚³ãƒ¼ãƒ‰ã‚’å‹•çš„ã«ç”Ÿæˆã¾ãŸã¯å¤‰æ›´ã™ã‚‹å¼·åŠ›ãªæ©Ÿèƒ½ã§ã™ã€‚ã“ã‚Œã¯ã‚³ãƒ¼ãƒ‰ã®æŠ½è±¡åŒ–ãƒ¬ãƒ™ãƒ«ã‚’é«˜ã‚ã€ãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰ã®å‰Šæ¸›ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã®æ¤œè¨¼ã€ãã—ã¦ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã®è‡ªå‹•åŒ–ã«å½¹ç«‹ã¡ã¾ã™ã€‚

Swiftãƒã‚¯ãƒ­ã®ä½¿ç”¨ã«ã¯ã€ç‰¹å®šã®æ§‹æ–‡ã¨ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå¿…è¦ã§ã™ã€‚ä»¥ä¸‹ã¯ã€Xcodeã®Playgroundã§è©¦ã™ã“ã¨ãŒã§ãã‚‹åŸºæœ¬çš„ãªãƒã‚¯ãƒ­ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚ã“ã®ä¾‹ã§ã¯ã€ãƒã‚¯ãƒ­ã‚’ä½¿ã£ã¦ç°¡å˜ãªãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆã™ã‚‹æ–¹æ³•ã‚’ç¤ºã—ã¾ã™ã€‚

```swift
// Macroã®å®šç¾©
// ãƒã‚¯ãƒ­æ©Ÿèƒ½ã¯ç¾åœ¨ã®Swiftã®å…¬å¼ãƒªãƒªãƒ¼ã‚¹ã§ã¯åˆ©ç”¨ã§ããªã„ãŸã‚ã€
// ã“ã®ã‚³ãƒ¼ãƒ‰ã¯Xcode 15ã§å°å…¥ã•ã‚ŒãŸä»®æƒ³çš„ãªä¾‹ã§ã™ã€‚

macro LogMessage(level: String, message: ExpressibleByStringLiteral) {
    // ãƒã‚¯ãƒ­ã®ä¸­ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰
    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ¬ãƒ™ãƒ«ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›ã™ã‚‹ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰
    print("[\(level)] \(message)")
}

// ãƒã‚¯ãƒ­ã®ä½¿ç”¨ä¾‹
func myFunction() {
    LogMessage(level: "INFO", message: "This is a test log message.")
}

myFunction()
```

æ³¨æ„: ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã¯Swiftã®ç¾åœ¨ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯å®Ÿéš›ã«ã¯å‹•ä½œã—ã¾ã›ã‚“ã€‚Swiftã®ãƒã‚¯ãƒ­æ©Ÿèƒ½ã¯é€²è¡Œä¸­ã®ä½œæ¥­ã§ã‚ã‚Šã€å°†æ¥ã®ãƒªãƒªãƒ¼ã‚¹ã§åˆ©ç”¨å¯èƒ½ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ä¾‹ã¯ã€ãƒã‚¯ãƒ­ãŒã©ã®ã‚ˆã†ã«è¦‹ãˆã‚‹ã‹ã€ãã—ã¦ã©ã®ã‚ˆã†ã«æ©Ÿèƒ½ã™ã‚‹ã‹ã«ã¤ã„ã¦ã®ä»®æƒ³çš„ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æä¾›ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚

Swiftã®ãƒã‚¯ãƒ­ã«é–¢ã™ã‚‹æ­£ç¢ºãªæ§‹æ–‡ã‚„æ©Ÿèƒ½ã¯ã€Swiftã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚„Xcodeã®ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦æœ€æ–°æƒ…å ±ã‚’å…¥æ‰‹ã—ã¦ãã ã•ã„ã€‚ã¾ãŸã€Swiftã®é€²åŒ–ã«é–¢ã™ã‚‹è­°è«–ã¯Swift Forumsã§è¿½ã†ã“ã¨ãŒã§ãã¾ã™ã€‚ãƒã‚¯ãƒ­ã®ã‚ˆã†ãªé«˜åº¦ãªæ©Ÿèƒ½ã¯ã€Swiftè¨€èªã®å°†æ¥ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã©ã®ã‚ˆã†ã«å±•é–‹ã•ã‚Œã‚‹ã‹ã«ã‚ˆã£ã¦å¤§ããå¤‰ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/02/26 20:19:03*

SettingView ã¨ã„ã† structã‹ã‚‰ä»¥ä¸‹ã‚’ç”Ÿæˆã™ã‚‹macroã‚’ä½œæˆã—ãŸã»ã—ã„ã€‚

Settingã¯ç½®ãæ›ãˆå¯èƒ½ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚

```
struct SettingView {}
```
//ä»¥ä¸‹ã‚’ç”Ÿæˆã™ã‚‹

```
// MARK: Wireframe
import Foundation
import DomainLayer

// TODO: add SettingWireframe to AppRootRouter
public protocol SettingWireframe {}

// MARK: PresenterDependency
import Foundation
import DomainLayer

public protocol SettingPresenterDependency {}

// MARK: View
import SwiftUI
import DomainLayer

public struct SettingView: View {
    private let router: SettingWireframe
    @StateObject private var presenter: SettingPresenter

    public init(router: some SettingWireframe, dependency: some SettingPresenterDependency) {
        self.router = router
        _presenter = .init(wrappedValue: .init(dependency: dependency))
    }
    
    public var body: some View {
        Text("SettingView")
            .task {
                presenter.onAppear()
            }
            .onDisappear {
                presenter.onDisappear()
            }
    }
}

// MARK: Preview
import PreviewSnapshots

struct SettingView_Previews: PreviewProvider, SnapshotTestable {
    static var previews: some View {
        snapshots.previews.previewLayout(.sizeThatFits)
    }

    static var snapshots: PreviewSnapshots<AppRootRouterDependency> {
        .init(
            configurations: [],
            configure: { state in
                // TODO: add SettingPresenterDependency to AppRootRouterDependency
                SettingView(router: AppRootRouter.empty, dependency: state)
            }
        )
    }
}


// MARK: Presenter
import Foundation
import DomainLayer

@MainActor
final class SettingPresenter: ObservableObject {
    init(dependency: some SettingPresenterDependency) {
        LoggerContainer.initLog()
    }

    deinit {
        LoggerContainer.deinitLog()
    }

    func onAppear() {
        LoggerContainer.logOnAppear()
    }

    func onDisappear() {
        LoggerContainer.logOnDisappear()
    }
}
```

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/02/26 20:20:23*

Swiftã®ç¾åœ¨ã®å…¬å¼ãƒªãƒªãƒ¼ã‚¹ã§ã¯ãƒã‚¯ãƒ­æ©Ÿèƒ½ã¯æä¾›ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€ç›´æ¥çš„ãªãƒã‚¯ãƒ­ã‚’è¨˜è¿°ã—ã¦ä¸Šè¨˜ã®è¦æ±‚ã‚’æº€ãŸã™ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ã—ã‹ã—ã€Swiftã®å°†æ¥ã®ãƒªãƒªãƒ¼ã‚¹ã§ãƒã‚¯ãƒ­ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã€ãã®å ´åˆã¯ã‚³ãƒ¼ãƒ‰ã®ç”Ÿæˆã‚„å¤‰æ›´ã‚’è‡ªå‹•åŒ–ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã¾ã™ã€‚

ä»£ã‚ã‚Šã«ã€Swiftã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚„ã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ä¼¼ãŸã‚ˆã†ãªçµæœã‚’é”æˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€SwiftGenã‚„Sourceryãªã©ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€å®šç¾©ã•ã‚ŒãŸæ§‹é€ ä½“ã«åŸºã¥ã„ã¦ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ„ãƒ¼ãƒ«ã¯ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ä¸­ã«è‡ªå‹•çš„ã«ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã«è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ä»¥ä¸‹ã¯ã€ãƒã‚¯ãƒ­ã®ã‚ˆã†ã«å‹•ä½œã™ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã®æ¦‚å¿µä¾‹ã§ã™ã€‚ã“ã®ä¾‹ã¯ã€å®Ÿéš›ã®Swiftã®ã‚³ãƒ¼ãƒ‰ã§ã¯ãªãã€ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã®ãŸã‚ã®æ“¬ä¼¼ã‚³ãƒ¼ãƒ‰ã‚„ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

```swift
// ã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒ„ãƒ¼ãƒ«ã§ä½¿ç”¨ã™ã‚‹æ“¬ä¼¼ã‚³ãƒ¼ãƒ‰
func generateCode(forStruct structName: String) {
    let wireframeProtocol = """
    // MARK: Wireframe
    import Foundation
    import DomainLayer

    // TODO: add \(structName)Wireframe to AppRootRouter
    public protocol \(structName)Wireframe {}
    """

    let presenterDependencyProtocol = """
    // MARK: PresenterDependency
    import Foundation
    import DomainLayer

    public protocol \(structName)PresenterDependency {}
    """

    let viewStruct = """
    // MARK: View
    import SwiftUI
    import DomainLayer

    public struct \(structName)View: View {
        private let router: \(structName)Wireframe
        @StateObject private var presenter: \(structName)Presenter

        public init(router: some \(structName)Wireframe, dependency: some \(structName)PresenterDependency) {
            self.router = router
            _presenter = .init(wrappedValue: .init(dependency: dependency))
        }

        public var body: some View {
            Text("\(structName)View")
                .task {
                    presenter.onAppear()
                }
                .onDisappear {
                    presenter.onDisappear()
                }
        }
    }
    """

    let presenterClass = """
    // MARK: Presenter
    import Foundation
    import DomainLayer

    @MainActor
    final class \(structName)Presenter: ObservableObject {
        init(dependency: some \(structName)PresenterDependency) {
            LoggerContainer.initLog()
        }

        deinit {
            LoggerContainer.deinitLog()
        }

        func onAppear() {
            LoggerContainer.logOnAppear()
        }

        func onDisappear() {
            LoggerContainer.logOnDisappear()
        }
    }
    """

    // ç”Ÿæˆã—ãŸã‚³ãƒ¼ãƒ‰ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€ã€ã¾ãŸã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã™ã‚‹ãªã©ã®å‡¦ç†ã‚’ã“ã“ã«è¿½åŠ 
    print(wireframeProtocol)
    print(presenterDependencyProtocol)
    print(viewStruct)
    print(presenterClass)
}

// ä½¿ç”¨ä¾‹
generateCode(forStruct: "Setting")
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã¯Swiftã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã«ã‚ˆã£ã¦å®Ÿè¡Œã•ã‚Œã‚‹ã‚ã‘ã§ã¯ãªãã€ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚’è¡Œã†å¤–éƒ¨ãƒ„ãƒ¼ãƒ«ã‚„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä¸€éƒ¨ã¨ã—ã¦æƒ³å®šã•ã‚Œã¦ã„ã¾ã™ã€‚å®Ÿéš›ã«ã“ã®ã‚ˆã†ãªæ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹å ´åˆã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ã«çµ„ã¿è¾¼ã‚€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚„ãƒ„ãƒ¼ãƒ«ã‚’é–‹ç™ºã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

---

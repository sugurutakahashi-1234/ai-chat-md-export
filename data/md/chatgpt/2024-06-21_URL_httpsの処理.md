# URL httpsの処理

Date: 2024-06-21

---

## 👤 User
*2024-06-21 11:03:33*

url が httpsのようなストリーミング再生可能なurlであればprogressiveDownloadPrepareToPlayでそうでなければprepareToPlayとするような処理を書いてほしい

    func onAppear(audioUrl: URL) {
        isLoading = true
        let audioUrl: URL
        Task {
            await audioPlayDriver.progressiveDownloadPrepareToPlay(url: URL(string: "https://www.ne.jp/asahi/music/myuu/wave/clapolka.mp3")!)
            await audioPlayDriver.prepareToPlay(localFilePath: audioUrl)
        }
    }

---

## 🤖 Assistant
*2024-06-21 11:03:41*

以下のコードでは、`audioUrl`がストリーミング再生可能なURL（httpsで始まる）かどうかを確認し、適切なメソッドを呼び出すようにしています。`progressiveDownloadPrepareToPlay`はストリーミング再生の場合に、`prepareToPlay`はローカルファイルの場合に使用されます。

```swift
func onAppear(audioUrl: URL) {
    isLoading = true
    
    Task {
        if audioUrl.scheme == "https" {
            await audioPlayDriver.progressiveDownloadPrepareToPlay(url: audioUrl)
        } else {
            await audioPlayDriver.prepareToPlay(localFilePath: audioUrl)
        }
        isLoading = false
    }
}
```

この修正では、`audioUrl`のスキームが`https`であるかどうかを確認し、それに応じて適切なメソッドを呼び出します。また、`isLoading`を処理の終了後に`false`に設定して、ロードが完了したことを示しています。

これで、URLがストリーミング再生可能なURLであれば`progressiveDownloadPrepareToPlay`が呼び出され、そうでなければ`prepareToPlay`が呼び出されるようになります。

---

# 検索機能のSwiftUI実装

日付: 2023-09-08

---

## 👤 ユーザー
*2023/9/8 15:10:16*

iOSのSwiftでの実装で、検索機能を実現したい。一つはテキストでの検索で、もうひとつはenumで定義された選択肢での絞り込み機能である。リストからこれを組み合わせた検索を行いたいのであるがSwiftUIを使ってどうやって実現すればいいか教えて欲しい。enumno

---

## 🤖 アシスタント
*2023/9/8 15:11:17*

SwiftUIを使ってテキストでの検索とenumでの絞り込み機能を組み合わせる方法を以下に示します。シンプルな例として、人々の名前と彼らの職業(enumで定義)のリストを考えます。

まず、モデルとenumを定義します：

```swift
struct Person {
    let name: String
    let job: JobType
}

enum JobType: String, CaseIterable {
    case developer = "Developer"
    case designer = "Designer"
    case manager = "Manager"
}
```

次に、SwiftUIのViewを定義します。検索テキストと選択された職業のための`@State`変数も用意します。

```swift
struct SearchView: View {
    @State private var searchText: String = ""
    @State private var selectedJob: JobType? = nil

    let people: [Person] = [
        .init(name: "Alice", job: .developer),
        .init(name: "Bob", job: .manager),
        .init(name: "Charlie", job: .designer),
        //... 他の人々
    ]

    var filteredPeople: [Person] {
        people.filter { person in
            // テキストでのフィルタ
            let doesNameMatch = searchText.isEmpty || person.name.localizedCaseInsensitiveContains(searchText)
            
            // enum (職業)でのフィルタ
            let doesJobMatch = selectedJob == nil || person.job == selectedJob
            
            return doesNameMatch && doesJobMatch
        }
    }

    var body: some View {
        VStack {
            // 検索テキストフィールド
            TextField("Search by name...", text: $searchText)

            // 職業での絞り込み
            Picker("Select Job", selection: $selectedJob) {
                Text("All").tag(JobType?.none)
                ForEach(JobType.allCases, id: \.self) { job in
                    Text(job.rawValue).tag(job as JobType?)
                }
            }.pickerStyle(SegmentedPickerStyle())

            List(filteredPeople, id: \.name) { person in
                Text(person.name)
            }
        }
    }
}
```

上記のコードでは、`filteredPeople`変数を用いて、入力されたテキストと選択された職業に基づいて人々をフィルタリングします。テキストが入力されていない、または特定の職業が選択されていない場合、それらのフィルタは適用されません。

このコードをSwiftUIプロジェクトに追加すれば、テキスト検索とenumによる絞り込みの両方が可能なシンプルな検索機能が得られます。必要に応じて、モデルやUI、ロジックをカスタマイズして拡張してください。

---

## 👤 ユーザー
*2023/9/8 15:12:28*

iOS16からあるPicker はナビゲーションリンクによる選択にさせたい。

---

## 🤖 アシスタント
*2023/9/8 15:13:13*

iOS 16の詳細な変更点についての情報は、私の最後のトレーニングデータ（2021年9月のカットオフ）の後にリリースされた可能性があるため、具体的には知らせることができません。しかし、SwiftUIで`Picker`を`NavigationLink`と組み合わせて使用する方法を説明できます。

以下は、`NavigationLink`を使用して`Picker`の選択を模倣する方法の一例です：

```swift
struct ContentView: View {
    @State private var selectedJob: JobType?
    @State private var isShowingPicker = false

    var body: some View {
        NavigationView {
            VStack {
                Button("Select Job: \(selectedJob?.rawValue ?? "None")") {
                    isShowingPicker.toggle()
                }
                .sheet(isPresented: $isShowingPicker) {
                    JobPickerView(selectedJob: $selectedJob, isShowingPicker: $isShowingPicker)
                }
            }
        }
    }
}

struct JobPickerView: View {
    @Binding var selectedJob: JobType?
    @Binding var isShowingPicker: Bool

    var body: some View {
        List(JobType.allCases, id: \.self) { job in
            Button(action: {
                selectedJob = job
                isShowingPicker = false
            }) {
                Text(job.rawValue)
            }
        }
    }
}

enum JobType: String, CaseIterable {
    case developer = "Developer"
    case designer = "Designer"
    case manager = "Manager"
}
```

この例では、`ContentView`に「Select Job」というボタンが表示され、このボタンをタップすると`JobPickerView`がモーダルとして表示されます。`JobPickerView`では、利用可能な`JobType`の各項目がリストとして表示され、一つをタップすると選択が完了し、モーダルが閉じます。

この方法を使用すると、`Picker`を`NavigationLink`のような動作で模倣できます。iOS 16の具体的な新機能や変更点に関しては、公式のAppleドキュメントやリリースノートを参照してください。

---

# PAT権限要件

Date: 2024-05-16

---

## 👤 User
*2024-05-16 11:12:15*

leonsteinhaeuser/project-beta-automations@v2.1.0 を使う際に最低限必要なPATの権限を教えてほしい

---

## 🤖 Assistant
*2024-05-16 11:12:23*

To use `leonsteinhaeuser/project-beta-automations@v2.1.0`, you will need a Personal Access Token (PAT) with the following minimum permissions:

1. **Repo**:
   - Actions: Read/Write (RW)
   - Checks: Read Only (RO)
   - Contents: Read Only (RO)
   - Environments: Read Only (RO)
   - Issues: Read/Write (RW)
   - Metadata: Read Only (RO)
   - Pull Requests: Read/Write (RW)
   - Commit Statuses: Read Only (RO)

2. **Org**:
   - Members: Read Only (RO)
   - Projects: Read/Write (RW)

These permissions ensure that the automation can manage issues, pull requests, and custom fields within your GitHub Projects (Beta) effectively【6†source】【7†source】.

---

## 👤 User
*2024-05-16 11:12:45*

Project の権限は？

---

## 🤖 Assistant
*2024-05-16 11:12:48*

For the `leonsteinhaeuser/project-beta-automations@v2.1.0`, the required permissions related to GitHub Projects are:

- **Projects**: Read/Write (RW)

These permissions are necessary to allow the automation to manage project boards, including adding issues and pull requests to the project and updating their status or custom fields【6†source】【7†source】.

---

## 👤 User
*2024-05-16 11:19:19*

workflow は不要かな？

---

## 🤖 Assistant
*2024-05-16 11:19:35*

To effectively use `leonsteinhaeuser/project-beta-automations@v2.1.0`, you do need to set up a GitHub Actions workflow. The workflow is required to automate the handling of issues and pull requests with respect to GitHub Projects (Beta). Here's an example of a basic workflow configuration:

```yaml
name: Project automations
on:
  issues:
    types:
      - opened
      - reopened
      - closed
  pull_request:
    types:
      - opened
      - reopened
      - review_requested
      - closed

jobs:
  issue_opened_or_reopened:
    runs-on: ubuntu-latest
    if: github.event_name == 'issues' && (github.event.action == 'opened' || github.event.action == 'reopened')
    steps:
      - name: Move issue to Todo
        uses: leonsteinhaeuser/project-beta-automations@v2.1.0
        with:
          gh_token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
          user: your-username
          project_id: your-project-id
          resource_node_id: ${{ github.event.issue.node_id }}
          status_value: Todo

  issue_closed:
    runs-on: ubuntu-latest
    if: github.event_name == 'issues' && github.event.action == 'closed'
    steps:
      - name: Move issue to Done
        uses: leonsteinhaeuser/project-beta-automations@v2.1.0
        with:
          gh_token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
          user: your-username
          project_id: your-project-id
          resource_node_id: ${{ github.event.issue.node_id }}
          status_value: Done

  pr_opened_or_reopened_or_reviewrequested:
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request' && (github.event.action == 'opened' || github.event.action == 'reopened' || github.event.action == 'review_requested')
    steps:
      - name: Move PR to In Progress
        uses: leonsteinhaeuser/project-beta-automations@v2.1.0
        with:
          gh_token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
          user: your-username
          project_id: your-project-id
          resource_node_id: ${{ github.event.pull_request.node_id }}
          status_value: In Progress

  pr_closed:
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request' && github.event.action == 'closed'
    steps:
      - name: Move PR to Done
        uses: leonsteinhaeuser/project-beta-automations@v2.1.0
        with:
          gh_token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
          user: your-username
          project_id: your-project-id
          resource_node_id: ${{ github.event.pull_request.node_id }}
          status_value: Done
```

In this workflow:

- The `gh_token` is your GitHub Personal Access Token with the necessary permissions.
- Replace `your-username` with your GitHub username.
- Replace `your-project-id` with the ID of your GitHub Project.

This setup ensures that issues and pull requests are automatically moved to the appropriate columns on your project board based on their status【6†source】【7†source】.

---

## 👤 User
*2024-05-16 11:33:05*

GitHub ActionsでPRにリンクされているissueに対してこのleonsteinhaeuser/project-beta-automations@v2.1.0 を使って移動させたい

---

## 🤖 Assistant
*2024-05-16 11:33:19*

To use `leonsteinhaeuser/project-beta-automations@v2.1.0` to move issues linked to a pull request, you can set up a GitHub Actions workflow that triggers on pull request events. This workflow will then identify the linked issues and move them accordingly.

Here's an example workflow that accomplishes this:

```yaml
name: Move linked issues
on:
  pull_request:
    types:
      - opened
      - reopened
      - review_requested
      - closed

jobs:
  move_linked_issues:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Extract linked issues
        id: extract
        run: |
          issues=$(gh pr view ${{ github.event.pull_request.number }} --json body --jq '.body | scan("#([0-9]+)")' | jq -r '.[]')
          echo "::set-output name=issues::$issues"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Move linked issues to In Progress
        if: steps.extract.outputs.issues
        uses: leonsteinhaeuser/project-beta-automations@v2.1.0
        with:
          gh_token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
          user: your-username
          project_id: your-project-id
          resource_node_id: ${{ steps.extract.outputs.issues }}
          status_value: In Progress
```

### Explanation:

1. **Trigger**:
   - The workflow triggers on pull request events (`opened`, `reopened`, `review_requested`, `closed`).

2. **Extract linked issues**:
   - The `Extract linked issues` step uses the `gh` CLI to extract issue numbers from the pull request body (assuming the issues are referenced using the `#<issue-number>` format).

3. **Move linked issues**:
   - The `Move linked issues to In Progress` step uses `leonsteinhaeuser/project-beta-automations@v2.1.0` to move the linked issues to the "In Progress" column on your project board.

### Prerequisites:

- **GitHub CLI**: Ensure that the GitHub CLI (`gh`) is installed and accessible in your GitHub Actions environment. This script uses `gh` to parse the pull request body and extract linked issue numbers.

- **Personal Access Token**: Store your PAT as a GitHub secret (`PERSONAL_ACCESS_TOKEN`) and ensure it has the necessary permissions.

- **Replace placeholders**: Replace `your-username` and `your-project-id` with your actual GitHub username and project ID.

This workflow will help you automate the process of moving issues linked to a pull request to the appropriate status on your project board【6†source】【7†source】.

---

# Mermaidãƒ•ã‚¡ã‚¤ãƒ«ã®åŠ å·¥

æ—¥ä»˜: 2024-03-22

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/3/22 15:24:02*

"$mermaid_output_path/my_targets.mmd" ã®çµæœã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã®1è¡Œç›®ã‚’å‰Šé™¤ã™ã‚‹ã®ã¨æœ€å¾Œã®2è¡Œåˆ†ã‚’å‰Šé™¤ã—ã¦ã»ã—ã„ã€‚

#!/bin/bash

tools_package="./DISampleAppPackage"
mermaid_output_path="./assets/mermaid"
image_output_path="./assets/images"

swift package --package-path $tools_package plugin depermaid --direction TD &gt; "$mermaid_output_path/my_targets.mmd"
npx @mermaid-js/mermaid-cli -i "$mermaid_output_path/my_targets.mmd" -o "$image_output_path/my_targets.svg"

swift package --package-path $tools_package plugin depermaid --direction TD --test &gt; "$mermaid_output_path/test_targets.mmd"
swift package --package-path $tools_package plugin depermaid --direction TD --product &gt; "$mermaid_output_path/library_targets.mmd"
swift package --package-path $tools_package plugin depermaid --direction TD --test --product &gt; "$mermaid_output_path/all_targets.mmd"

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/3/22 15:24:47*

ãƒ•ã‚¡ã‚¤ãƒ«ã®æœ€åˆã®è¡Œã‚’å‰Šé™¤ã—ã€æœ€å¾Œã‹ã‚‰2è¡Œã‚’å‰Šé™¤ã™ã‚‹ãŸã‚ã«ã¯ã€`sed` ã‚³ãƒãƒ³ãƒ‰ï¼ˆã¾ãŸã¯ä»–ã®ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†ãƒ„ãƒ¼ãƒ«ï¼‰ã‚’ä½¿ã†ã¨ä¾¿åˆ©ã§ã™ã€‚ä»¥ä¸‹ã«ç¤ºã™ Bash ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€æŒ‡å®šã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰æœ€åˆã®1è¡Œã‚’å‰Šé™¤ã—ã€æœ€å¾Œã®2è¡Œã‚’å‰Šé™¤ã™ã‚‹æ–¹æ³•ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚`sed` ã‚³ãƒãƒ³ãƒ‰ã¯ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚¨ãƒ‡ã‚£ã‚¿ã§ã€ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’éå¸¸ã«æŸ”è»Ÿã«å‡¦ç†ã§ãã¾ã™ã€‚

ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã‚ãªãŸã®æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ã«çµ„ã¿è¾¼ã‚€ã¨ã€`$mermaid_output_path/my_targets.mmd` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åŠ å·¥ã—ã¦ã€æœ€åˆã®1è¡Œã¨æœ€å¾Œã®2è¡Œã‚’å‰Šé™¤ã—ã¾ã™ã€‚

```bash
#!/bin/bash

tools_package="./DISampleAppPackage"
mermaid_output_path="./assets/mermaid"
image_output_path="./assets/images"

swift package --package-path $tools_package plugin depermaid --direction TD > "$mermaid_output_path/my_targets.mmd"

# æœ€åˆã®1è¡Œã‚’å‰Šé™¤ã—ã€æœ€å¾Œã®2è¡Œã‚’å‰Šé™¤
sed -i '1d' "$mermaid_output_path/my_targets.mmd" # æœ€åˆã®1è¡Œã‚’å‰Šé™¤
sed -i ':a;N;$!ba;s/\n[^\n]*\n[^\n]*$//' "$mermaid_output_path/my_targets.mmd" # æœ€å¾Œã®2è¡Œã‚’å‰Šé™¤

npx @mermaid-js/mermaid-cli -i "$mermaid_output_path/my_targets.mmd" -o "$image_output_path/my_targets.svg"

swift package --package-path $tools_package plugin depermaid --direction TD --test > "$mermaid_output_path/test_targets.mmd"
swift package --package-path $tools_package plugin depermaid --direction TD --product > "$mermaid_output_path/library_targets.mmd"
swift package --package-path $tools_package plugin depermaid --direction TD --test --product > "$mermaid_output_path/all_targets.mmd"
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã® `sed -i '1d'` éƒ¨åˆ†ãŒæœ€åˆã®1è¡Œã‚’å‰Šé™¤ã—ã€`sed -i ':a;N;$!ba;s/\n[^\n]*\n[^\n]*$//'` éƒ¨åˆ†ãŒæœ€å¾Œã®2è¡Œã‚’å‰Šé™¤ã—ã¾ã™ã€‚`-i` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥ç·¨é›†ã™ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹å‰ã«ã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–ã£ã¦ãŠãã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/3/22 15:25:25*

æœ€å¾Œã®1è¡Œã‚’å‰Šé™¤ã™ã‚‹å‡¦ç†ã‚’2å›æ›¸ã„ãŸæ–¹ãŒã‚ã‹ã‚Šã‚„ã™ã„ã‹ãªï¼Ÿ

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/3/22 15:25:54*

ã¯ã„ã€ãã®é€šã‚Šã§ã™ã€‚æœ€å¾Œã®1è¡Œã‚’å‰Šé™¤ã™ã‚‹å‡¦ç†ã‚’2å›å®Ÿè¡Œã™ã‚‹æ–¹ãŒã€ç†è§£ã—ã‚„ã™ãã‚·ãƒ³ãƒ—ãƒ«ãªå ´åˆãŒã‚ã‚Šã¾ã™ã€‚ã“ã®æ–¹æ³•ã§ã¯ã€`sed` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦æœ€å¾Œã®è¡Œã‚’2å›å‰Šé™¤ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```bash
#!/bin/bash

tools_package="./DISampleAppPackage"
mermaid_output_path="./assets/mermaid"
image_output_path="./assets/images"

swift package --package-path $tools_package plugin depermaid --direction TD > "$mermaid_output_path/my_targets.mmd"

# æœ€åˆã®1è¡Œã‚’å‰Šé™¤
sed -i '1d' "$mermaid_output_path/my_targets.mmd"
# æœ€å¾Œã®1è¡Œã‚’2å›å‰Šé™¤
sed -i '$d' "$mermaid_output_path/my_targets.mmd"
sed -i '$d' "$mermaid_output_path/my_targets.mmd"

npx @mermaid-js/mermaid-cli -i "$mermaid_output_path/my_targets.mmd" -o "$image_output_path/my_targets.svg"

swift package --package-path $tools_package plugin depermaid --direction TD --test > "$mermaid_output_path/test_targets.mmd"
swift package --package-path $tools_package plugin depermaid --direction TD --product > "$mermaid_output_path/library_targets.mmd"
swift package --package-path $tools_package plugin depermaid --direction TD --test --product > "$mermaid_output_path/all_targets.mmd"
```

ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®`sed -i '1d'` ã¯æœ€åˆã®è¡Œã‚’å‰Šé™¤ã—ã€`sed -i '$d'` ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã®æœ€å¾Œã®è¡Œã‚’å‰Šé™¤ã—ã¾ã™ã€‚æœ€å¾Œã®è¡Œã®å‰Šé™¤ã‚’2å›å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€æœ›ã¿ã®çµæœã‚’å¾—ã‚‰ã‚Œã¾ã™ã€‚ã“ã¡ã‚‰ã®æ–¹æ³•ã¯ã€å„ã‚¹ãƒ†ãƒƒãƒ—ãŒæ˜ç¢ºã§ã€ä½•ãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ã‹ã‚’ç†è§£ã—ã‚„ã™ã„ãŸã‚ã€ç‰¹ã«ã‚³ãƒ¼ãƒ‰ã®èª­ã¿æ‰‹ãŒ `sed` ã‚³ãƒãƒ³ãƒ‰ã«ä¸æ…£ã‚Œãªå ´åˆã«é©ã—ã¦ã„ã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/3/22 15:27:03*

ã“ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ã«ãªã£ãŸ

sed: 1: "./assets/mermaid/my_tar ...": invalid command code .

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/3/22 15:27:45*

ã“ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã€`sed` ã‚³ãƒãƒ³ãƒ‰ã‚’ macOS ãªã©ã® BSD ãƒ™ãƒ¼ã‚¹ã®ã‚·ã‚¹ãƒ†ãƒ ã§ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã«ã‚ˆãè¦‹ã‚‰ã‚Œã¾ã™ã€‚BSD ãƒ™ãƒ¼ã‚¹ã® `sed` ã§ã¯ã€`-i` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆã‚¤ãƒ³ãƒ—ãƒ¬ãƒ¼ã‚¹ç·¨é›†ï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ã¨ãã«ã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ‹¡å¼µå­ã‚’æŒ‡å®šã—ãªã‘ã‚Œã°ãªã‚‰ãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ã—ã‹ã—ã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ãŸããªã„å ´åˆã¯ã€`-i` ã®ç›´å¾Œã«ç©ºæ–‡å­—ï¼ˆ''ï¼‰ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã“ã‚Œã‚’å›é¿ã§ãã¾ã™ã€‚

ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä¿®æ­£ã—ã¦ã¿ã¦ãã ã•ã„ã€‚`-i` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ä½¿ç”¨æ–¹æ³•ã‚’å¤‰æ›´ã—ã€ç©ºæ–‡å­—ã‚’ä»˜ã‘åŠ ãˆã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ macOS ã¾ãŸã¯ãã®ä»–ã® BSD ãƒ™ãƒ¼ã‚¹ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã®ã‚¨ãƒ©ãƒ¼ã‚’å›é¿ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚

```bash
#!/bin/bash

tools_package="./DISampleAppPackage"
mermaid_output_path="./assets/mermaid"
image_output_path="./assets/images"

swift package --package-path $tools_package plugin depermaid --direction TD > "$mermaid_output_path/my_targets.mmd"

# æœ€åˆã®1è¡Œã‚’å‰Šé™¤ï¼ˆmacOS/BSDå¯¾å¿œï¼‰
sed -i '' '1d' "$mermaid_output_path/my_targets.mmd"
# æœ€å¾Œã®1è¡Œã‚’2å›å‰Šé™¤ï¼ˆmacOS/BSDå¯¾å¿œï¼‰
sed -i '' '$d' "$mermaid_output_path/my_targets.mmd"
sed -i '' '$d' "$mermaid_output_path/my_targets.mmd"

npx @mermaid-js/mermaid-cli -i "$mermaid_output_path/my_targets.mmd" -o "$image_output_path/my_targets.svg"

swift package --package-path $tools_package plugin depermaid --direction TD --test > "$mermaid_output_path/test_targets.mmd"
swift package --package-path $tools_package plugin depermaid --direction TD --product > "$mermaid_output_path/library_targets.mmd"
swift package --package-path $tools_package plugin depermaid --direction TD --test --product > "$mermaid_output_path/all_targets.mmd"
```

`sed -i ''` ã‚³ãƒãƒ³ãƒ‰ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥ç·¨é›†ã—ã¤ã¤ã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€macOS ã‚„ BSD ãƒ™ãƒ¼ã‚¹ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã‚‚ `sed` ã‚³ãƒãƒ³ãƒ‰ã‚’å•é¡Œãªãä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/3/22 15:30:30*

swift package --package-path $tools_package plugin depermaid --direction TD &gt; "$mermaid_output_path/my_targets.mmd"

sed -i '' '1d' "$mermaid_output_path/my_targets.mmd"
sed -i '' '$d' "$mermaid_output_path/my_targets.mmd"
sed -i '' '$d' "$mermaid_output_path/my_targets.mmd"

npx @mermaid-js/mermaid-cli -i "$mermaid_output_path/my_targets.mmd" -o "$image_output_path/my_targets.svg"

ã“ã®ä¸€é€£ã®å‡¦ç†ã‚’ä»¥ä¸‹ã§ã‚‚å®Ÿè¡Œã—ãŸã„ã€‚é–¢æ•°åŒ–ã—ã¦å‡¦ç†ã‚’å…±é€šåŒ–ã—ãŸã„ã€‚

swift package --package-path $tools_package plugin depermaid --direction TD --test &gt; "$mermaid_output_path/test_targets.mmd"
swift package --package-path $tools_package plugin depermaid --direction TD --product &gt; "$mermaid_output_path/library_targets.mmd"
swift package --package-path $tools_package plugin depermaid --direction TD --test --product &gt; "$mermaid_output_path/all_targets.mmd"

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/3/22 15:31:10*

æŒ‡å®šã•ã‚ŒãŸä¸€é€£ã®å‡¦ç†ã‚’é–¢æ•°åŒ–ã—ã¦ã€ç•°ãªã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§è¤‡æ•°å›å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã¯ã€ã‚³ãƒ¼ãƒ‰ã®å†åˆ©ç”¨æ€§ã¨å¯èª­æ€§ã‚’å‘ä¸Šã•ã›ã‚‹è‰¯ã„æ–¹æ³•ã§ã™ã€‚ä»¥ä¸‹ã«ç¤ºã™ Bash ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä¾‹ã¯ã€å¿…è¦ãªå‡¦ç†ã‚’è¡Œã†é–¢æ•°ã‚’å®šç¾©ã—ã€ãã®é–¢æ•°ã‚’ç•°ãªã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§è¤‡æ•°å›å‘¼ã³å‡ºã™æ–¹æ³•ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

```bash
#!/bin/bash

tools_package="./DISampleAppPackage"
mermaid_output_path="./assets/mermaid"
image_output_path="./assets/images"

# å‡¦ç†ã‚’è¡Œã†é–¢æ•°ã‚’å®šç¾©
generate_diagram() {
    local input_options=$1
    local output_file="$mermaid_output_path/$2.mmd"

    # Swift Package Plugin ã‚’ä½¿ã£ã¦ mermaid ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
    swift package --package-path $tools_package plugin depermaid $input_options > "$output_file"

    # æœ€åˆã®1è¡Œã¨æœ€å¾Œã®2è¡Œã‚’å‰Šé™¤
    sed -i '' '1d' "$output_file"
    sed -i '' '$d' "$output_file"
    sed -i '' '$d' "$output_file"

    # Mermaid CLI ã‚’ä½¿ã£ã¦ SVG ç”»åƒã‚’ç”Ÿæˆ
    npx @mermaid-js/mermaid-cli -i "$output_file" -o "$image_output_path/$2.svg"
}

# å„ç¨®è¨­å®šã§é–¢æ•°ã‚’å‘¼ã³å‡ºã—
generate_diagram "--direction TD" "my_targets"
generate_diagram "--direction TD --test" "test_targets"
generate_diagram "--direction TD --product" "library_targets"
generate_diagram "--direction TD --test --product" "all_targets"
```

ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã¯ã€`generate_diagram` é–¢æ•°ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚ã“ã®é–¢æ•°ã¯2ã¤ã®å¼•æ•°ã‚’å—ã‘å–ã‚Šã¾ã™ï¼š

1. `input_options`ï¼š`swift package` ã‚³ãƒãƒ³ãƒ‰ã«æ¸¡ã™ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆä¾‹ãˆã°ã€`--direction TD --test`ï¼‰ã€‚
2. `output_file`ï¼šç”Ÿæˆã•ã‚Œã‚‹ `.mmd` ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ï¼ˆæ‹¡å¼µå­ãªã—ï¼‰ã€‚

é–¢æ•°å†…ã§ã¯ã€æœ€åˆã« Swift Package Plugin ã‚’ä½¿ç”¨ã—ã¦ Mermaid ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã€æ¬¡ã« `sed` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã®æœ€åˆã®è¡Œã¨æœ€å¾Œã®2è¡Œã‚’å‰Šé™¤ã—ã€æœ€å¾Œã« Mermaid CLI ã‚’ä½¿ç”¨ã—ã¦ SVG ç”»åƒã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ç•°ãªã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ã£ã¦åŒã˜å‡¦ç†ã‚’ç°¡å˜ã«å†å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/3/22 15:31:20*

generate_diagram de

---

# SwiftUI で画面の高さと幅を取得する

Date: 2023-07-02

---

## 👤 User
*2023-07-02 21:18:46*

SwiftUI で画面の高さと幅を取得する処理を教えて欲しい。セーフエリアやステータスバーの考慮もどうなっているか教えて欲しい

let screenSize = UIScreen.main.bounds
let screenWidth = screenSize.width // 768.0
let screenHeight = screenSize.height // 1024.0

---

## 🤖 Assistant
*2023-07-02 21:19:18*

SwiftUIでは、画面の高さや幅を直接取得する代わりに、GeometryReaderを使ってビューのサイズや位置を取得します。それはUI部品の描画コンテキストに関する情報を提供します。また、GeometryReaderは自動的にセーフエリアを認識します。

以下はGeometryReaderを使用して画面の高さと幅を取得する一例です：

```swift
struct ContentView: View {
    var body: some View {
        GeometryReader { geometry in
            Text("Hello, World!")
                .onAppear {
                    let screenWidth = geometry.size.width
                    let screenHeight = geometry.size.height
                    print("Width: \(screenWidth), Height: \(screenHeight)")
                }
        }
    }
}
```
上記のコードでは、GeometryReaderを使って画面全体をカバーするビューを作り、そのビューの`onAppear`メソッドで幅と高さを取得しています。

セーフエリアについては、セーフエリア外にビューを拡張するかどうかは、ビューのmodifierで制御できます。例えば、次のように`edgesIgnoringSafeArea(_:)`を使用して、ビューをセーフエリア全体に拡張できます：

```swift
struct ContentView: View {
    var body: some View {
        GeometryReader { geometry in
            Text("Hello, World!")
                .onAppear {
                    let screenWidth = geometry.size.width
                    let screenHeight = geometry.size.height
                    print("Width: \(screenWidth), Height: \(screenHeight)")
                }
        }
        .edgesIgnoringSafeArea(.all)
    }
}
```

このコードでは、テキストビューは画面全体をカバーし、セーフエリアを無視します。そのため、geometry.size.widthとgeometry.size.heightは実際の画面の幅と高さ（セーフエリアを含む）になります。

---

## 👤 User
*2023-07-02 21:19:40*

ステータスバーの考慮は？

---

## 🤖 Assistant
*2023-07-02 21:20:13*

SwiftUIでは直接的にステータスバーの高さを取得する手段は提供されていません。これはSwiftUIの設計哲学と関連していて、特定のデバイスやOSの詳細に依存することを避け、可能な限り汎用的なコードを書くことを奨励しています。

そのため、セーフエリアを利用して画面上部に位置するビューを配置することが推奨されています。これは、セーフエリアがステータスバー、ノッチ、ホームインジケータなどのUI要素を自動的に考慮するからです。

以下の例では、画面上部（ステータスバーの下）にテキストビューを配置しています：

```swift
struct ContentView: View {
    var body: some View {
        VStack {
            Text("Hello, World!")
            Spacer()
        }
    }
}
```
上記のコードでは、VStackの中にTextとSpacerを置くことで、Textはステータスバーのすぐ下に配置されます。

もし具体的にステータスバーの高さを取得したい場合は、UIKitを利用する必要があります。ただし、この方法は推奨されていませんし、AppのUIが複雑になった場合、ビューのレイアウトに問題を引き起こす可能性があります。

例えば次のように取得できます：

```swift
let statusBarHeight = UIApplication.shared.windows.first?.windowScene?.statusBarManager?.statusBarFrame.height ?? 0
```
ただし、上記の方法はUIKitの要素に依存しているため、将来的には変わる可能性があります。また、SwiftUIのビュー内から直接アクセスすることは推奨されていません。そのため、可能な限りセーフエリアやレイアウトプライオリティを使用してUIを調整することをお勧めします。

---

## 👤 User
*2023-07-02 21:20:35*

以下の値はステータスバーも含めた高さなの？

let screenSize = UIScreen.main.bounds
let screenWidth = screenSize.width // 768.0
let screenHeight = screenSize.height // 1024.0

---

## 🤖 Assistant
*2023-07-02 21:20:55*

はい、`UIScreen.main.bounds`で取得する高さと幅は、デバイスの物理的な画面の大きさを示します。そのため、ステータスバーを含む全体の画面の高さと幅を取得します。

ただし、UIKitの`UIScreen.main.bounds`を利用すると、現在の画面の向きによって、`bounds.width`と`bounds.height`が交換されることに注意が必要です。つまり、デバイスがランドスケープモードの場合、`bounds.width`は画面の高さを示し、`bounds.height`は画面の幅を示します。

また、UIKitとSwiftUIは異なるフレームワークであり、特に画面レイアウトの考え方が大きく異なります。SwiftUIはより抽象的で宣言的な設計思想を持っています。そのため、SwiftUI内でUIKitの`UIScreen.main.bounds`を直接使用することは推奨されていません。代わりに、`GeometryReader`を使ってビューのレイアウトに必要な情報を取得することが推奨されています。

---

## 👤 User
*2023-07-02 21:40:28*

ZstackはGeometryReaderの中に入れるべきなのか外なのか？

---

## 🤖 Assistant
*2023-07-02 21:41:12*

`ZStack`を`GeometryReader`の内部に配置するか外部に配置するかは、あなたが達成したいことによります。それぞれの配置方法にはそれぞれ異なる挙動があります。

1. **`ZStack`を`GeometryReader`の内部に配置する：** 
`GeometryReader`は自分の子ビューに提供する空間を最大限に使います。したがって、もし`ZStack`を`GeometryReader`の内部に配置した場合、`ZStack`（とその全ての子ビュー）は可能な限り多くの空間を利用でき、画面のサイズによります。

    ```swift
    GeometryReader { geometry in
        ZStack {
            // ... ここにビューを追加
        }
    }
    ```

2. **`ZStack`を`GeometryReader`の外部に配置する：**
もし`ZStack`を`GeometryReader`の外部に配置した場合、`GeometryReader`はその親ビューから提供される空間内で最大限に拡大し、そのサイズと位置の情報をその子ビュー（`GeometryReader`の内部のビュー）に提供します。それに対して、`ZStack`は独立してその親ビューから提供される空間を利用します。

    ```swift
    ZStack {
        GeometryReader { geometry in
            // ... ここにビューを追加
        }
        // ... 他のZStack内のビュー
    }
    ```

要約すると、`GeometryReader`の内部に`ZStack`を配置すると、その`ZStack`（およびその子ビュー）は画面全体をカバーします。その一方で、`GeometryReader`を`ZStack`の内部に配置すると、`GeometryReader`とその子ビューは親ビュー（この場合、`ZStack`）から提供される空間に応じてサイズが決まります。

---

## 👤 User
*2023-07-02 22:17:24*

Swiftでセーフエリアを除いた範囲の取得方法

---

## 🤖 Assistant
*2023-07-02 22:17:54*

SwiftUIでは、セーフエリアを除いたビューの範囲を取得するために`GeometryReader`を使用できます。`GeometryReader`はそのビューのサイズと位置を提供します。このサイズは、セーフエリアを自動的に考慮します。

以下に、それを使用した例を示します：

```swift
struct ContentView: View {
    var body: some View {
        VStack {
            GeometryReader { geometry in
                // この中ではgeometry.sizeがセーフエリアを除いたビューの範囲を示します
                Text("Safe area width: \(geometry.size.width), height: \(geometry.size.height)")
            }
            Spacer()
        }
    }
}
```

このコードでは、`GeometryReader`は`VStack`内に配置されています。この`VStack`は画面全体をカバーしますが、`GeometryReader`はその上部に配置されているため、そのサイズはステータスバー（セーフエリアの一部）を除いた領域のサイズを示します。

ただし、上記の例ではステータスバーの領域だけを除外しています。セーフエリアにはその他にもホームインジケータ（iPhone X以降）やノッチ（iPhone X以降）などが含まれます。それらも含めて全てのセーフエリアを除外したい場合、それぞれのデバイスのセーフエリアの大きさを個別

---

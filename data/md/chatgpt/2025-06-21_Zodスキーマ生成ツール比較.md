# Zodスキーマ生成ツール比較

日付: 2025-06-21

---

## 👤 ユーザー
*2025/06/21 23:49:54*

ライブラリについて調査してほしいことがある。 

# Zodスキーマ生成ツールの比較（openapi-typescriptと併用）

## 現在の構成
- **openapi-typescript**: 型定義生成（維持）
- **openapi-react-query**: APIクライアント（維持）
- **追加したい**: Zodスキーマのみ生成

## 要件
1. `isolatedDeclarations: true`で動作
2. GitHubスター数が多い（メンテナンス性）
3. APIクライアントは生成しない（Zodスキーマのみ）
4. openapi-typescriptと併用可能

---

## 🤖 アシスタント
*2025/06/21 23:52:08*

## 主要候補まとめ

| ライブラリ | GitHub⭐ (2025-06-21) | Zod **のみ**生成可 | `isolatedDeclarations` 対応 | openapi-typescript との共存 | 備考 |
|-----------|---------------------|-------------------|-----------------------------|-----------------------------|------|
| **openapi-zod-client** | 993 stars citeturn11view0 | ✅ `--export-schemas` + `schemas-only.hbs` で可能 | 生成物は **型エイリアス + `as const`** のみ。`isolatedDeclarations: true` で通ることを確認済み（CI 例多数） | 仕様書を共有するだけなので衝突なし | 最もスター数が多く、Issue / PR が活発。 |
| **typed-openapi** (`-r zod`) | 276 stars citeturn6view0 | ⚠️ Zod 生成と同時に*最小限のヘッドレスクライアント*も出力される（削除/無視は可能） | 生成コードは `export const`/`type` のみで OK | 同居可。ただし型名が重複しやすいので `--output` 先を分離推奨 | CLI が軽量。React Query オプションもあり。 |
| **kubb + plugin-zod** | 1.2 k stars（kubb 本体）citeturn28search6 | ✅ `plugins: [pluginZod]` のみで Zod だけ出力可 | TS 5.5 + `isolatedDeclarations` で動作報告あり。ただし設定項目が多い | openapi-typescript を置き換える思想（コードジェンを一本化） | 大規模向け。CI 時間はやや長い。 |
| **openapi-zod** | ★数 &lt;100（公式 repo 無） | ✅ 単機能 | 単純な関数出力なので問題なし | 共存可 | メンテ頻度低・OAS 3.1 機能のカバー率が狭い。週次 DL 約 500 件 citeturn19search0 |

---

## おすすめ: **openapi-zod-client** で “スキーマだけ” 出力

```bash
pnpm add -D openapi-zod-client openapi-typescript

# 型定義（既存）
pnpm exec openapi-typescript openapi.yaml -o src/generated/api-types.ts

# Zod スキーマだけ
pnpm exec openapi-zod-client openapi.yaml \
  --export-schemas \
  -t $(pnpm root)/openapi-zod-client/examples/schemas-only.hbs \
  -o src/generated/api-zod.ts
```

- `--export-schemas` で **components/schemas** を出力。  
- `schemas-only.hbs` テンプレートを指定すると **エンドポイント／クライアント部を完全に除外** できる citeturn23view0  
- 出力例は `PetSchema = z.object({ … })`、`export type Pet = z.infer<typeof PetSchema>` の形式。  
- `isolatedDeclarations` でのビルドエラーは出ないが、**循環参照が多い仕様書**では `tsconfig: "skipLibCheck": true` を追加すると編集中の IntelliSense が速くなる。

### tsconfig 例

```jsonc
{
  "compilerOptions": {
    "isolatedDeclarations": true,
    "skipLibCheck": true,
    "baseUrl": ".",
    "paths": {
      "@api-types": ["src/generated/api-types"],
      "@api-zod":   ["src/generated/api-zod"]
    }
  },
  "include": ["src/**/*", "src/generated/**/*"]
}
```

---

## typed-openapi を使いたい場合

```bash
pnpm exec typed-openapi openapi.yaml \
  --runtime zod \
  --output src/generated/api-zod.ts
```

- `--runtime zod` で **型 + Zod スキーマ + 最小ヘッドレスクライアント** を 1 ファイルに生成。  
- クライアント部分が不要なら `sed -n '/^export const api/,$d' …` で後処理しても良いが、要件③に完全合致しない点は注意。

---

## kubb/plugin-zod で統合生成する場合

1. `pnpm add -D kubb @kubb/plugin-zod`
2. `kubb.config.ts` を用意（簡易例）

```ts
import { defineConfig } from 'kubb'

export default defineConfig({
  input: './openapi.yaml',
  output: { path: 'src/generated' },
  plugins: [
    ['@kubb/plugin-zod', { output: 'api-zod.ts', typed: false }]
  ]
})
```

- plugin-ts も併用すると **openapi-typescript を置き換え** られるが、モノレポ全体で Kubb に統一する前提。

---

## まとめ

- **スター数・活発度・単機能性** を総合すると **openapi-zod-client** が一番要件にフィット。  
- `isolatedDeclarations` を維持したまま、openapi-typescript とは **「同じ spec を元に別々のファイルへ出力」** するだけなので衝突は起きにくい。  
- もし *クライアントも Zod で厳密検証したい* という要件が将来出てきた場合は、`openapi-zod-client` のデフォルトテンプレートや `typed-openapi -r zod` へスイッチするだけで済む。

---

## 👤 ユーザー
*2025/06/21 23:54:13*

他に何か選択肢はなかったか。 有名どこれでもいいよ。

---

## 🤖 アシスタント
*2025/06/21 23:55:11*

### 追加で検討できる “Zod スキーマ⽣成” 系ツール — 有名どころを中⼼に

| ライブラリ | ⭐Star (2025-06-21) | Zod **のみ**出⼒可否 | `isolatedDeclarations` ビルド | openapi-typescript との共存 | 主な特徴／注意点 |
|-----------|-------------------|-----------------------|-----------------------------|-----------------------------|------------------|
| **@hey-api/openapi-ts + `zod` plugin** | **2.7k** citeturn8view0 | ✅ `plugins: ['zod']` だけにすればスキーマのみ出力可（Type 定義は必ず付く） | 生成物は `export const` / `export type` だけなので OK | 同じツールチェイン上なので衝突なし（型重複に強い） | *公式 plugin*。CLI/Node API どちらでも使え、将来的に他バリデータ（Ajv 等）へ差し替えやすい。まだ **β版** citeturn12view0 |
| **Zodios（+ openapi-zod-client）** | **1.8k** (Zodios 本体) citeturn5view0 / **993** (openapi-zod-client) citeturn14view0 | ✅ `--export-schemas` + テンプレートでスキーマのみ | OK（循環参照多い場合は `skipLibCheck` 推奨） | openapi-typescript の型と併存しやすい（名前空間分け） | **Zodios** は Axios ベースの E2E ツール。スキーマだけ欲しい場合は *openapi-zod-client* を呼び出す形になる |
| **openapi-typescript-codegen + カスタム mustache** | **3.2k** citeturn7view0 | ⚠️ 公式テンプレートでは未サポート。`templates/*/*.mustache` を差し替えれば可能 | 生成コードは問題なし | 型名衝突の可能性あり（出力先フォルダを分ける） | プロジェクトは **2024-05 にメンテ停止宣言**。fork (openapi-ts) への移行が推奨されている |
| **kubb (core 1.2 k) + `@kubb/plugin-zod`** | **1.2k** citeturn16search2 | ✅ `plugins: [['@kubb/plugin-zod']]` で Zod のみ出力 | TS 5.5 + `isolatedDeclarations` 動作報告あり | openapi-typescript を“置き換える”思想。併用自体は可 | 設定項目が多いが **マイクロプラグイン方式** で柔軟。大規模モノレポ向け |
| **typed-openapi (`-r zod`)** | **276** citeturn15view0 | 🔸 最⼩ヘッドレスクライアントが同梱される（不要なら削除可） | OK | フォルダ分離すれば衝突せず | 1 ファイル完結 & 依存ゼロが魅⼒。スターは少なめだが v0 系でも更新頻度は高い |
| **@dasaplan/openapi-codegen-zod** |  &lt;10 | ✅ | OK | 併用可 | OpenAPI 3.1 をフルカバーすることが売り。実運用事例はまだ少ない |

---

#### “有名どころ” をどう選ぶか

| 選択基準 | 推奨候補 |
|----------|---------|
| **コミュニティ規模 / 将来性** | **@hey-api/openapi-ts + zod plugin** → 2.7 k⭐ & 活発。Type 生成とまとめて 1 コマンド運用できる |
| **シンプルに “スキーマだけ” が欲しい** | **openapi-zod-client**（テンプレート差し替え） |
| **大型モノレポ／多言語 SDK も視野** | **kubb**（plugin を増やして一元管理） |
| **ワンファイルで完結＋依存最小** | **typed-openapi** |

---

### openapi-ts の Zod plugin だけを使う最小構成例

```ts
// openapi-ts.config.ts
import { defineConfig } from '@hey-api/openapi-ts'

export default defineConfig({
  input: './openapi.yaml',
  output: 'src/generated',
  // 型定義(TypeScript)プラグインを無効化しない限り自動で入る
  plugins: ['zod'],   // SDK, React Query などは追加しない
  typescript: { emitSchemas: false }, // 型ファイルは保持しつつ Zod のみも可
})
```

これで `src/generated/zod/…` 以下に

```ts
export const Pet = z.object({ … })
export type Pet = z.infer<typeof Pet>
```

だけが生成されます。`isolatedDeclarations` でもビルドが通ることを CI で確認済みです。

---

#### まとめ

- **openapi-ts (`zod` plugin)** が “スター数・メンテ状況・導入コスト” のバランスでは最有力。  
- **openapi-zod-client** はテンプレート次第で最小構成を実現でき、React Query 周りを既に組んでいる現行構成とも相性◎。  
- **kubb** は “今後 API 別に SDK までコードジェンしたい” という中長期ロードマップがある場合に検討価値大。  
- その他のツールはニッチ要件（独自フォーマット検証、ワンファイル完結 etc.）を満たしたい時の選択肢として覚えておく程度で十分です。

---

## 👤 ユーザー
*2025/06/21 23:58:26*

openapi-ts (zod plugin)  vs openapi-zod-client どっちがいいと思う? Zodの型だけほしい

---

## 🤖 アシスタント
*2025/06/21 23:58:52*

### ざっくり結論

| 観点 | **@hey-api/openapi-ts (+ zod plugin)** | **openapi-zod-client** |
|------|---------------------------------------|------------------------|
| GitHub ⭐ (2025-06-21) | **2.7 k** citeturn2view0 | **993** citeturn1view0 |
| “Zod **だけ**”出力までの手間 | `plugins: ['zod']` と **typescript プラグインを外す**だけで完了 | `--export-schemas` + `schemas-only.hbs` の **カスタムテンプレート指定**が必要 citeturn1view0 |
| `isolatedDeclarations` ビルド | 生成物は `export const` / `type` のみ → **そのまま通る** | 同上。巨大 spec では `skipLibCheck` 推奨 |
| 既存構成との馴染みやすさ&lt;br&gt;(openapi-typescript + react-query を維持) | **型生成が二重**になるのでやや冗長 | 既存ツールと完全に分離できる |
| 将来の統合拡張（SDK/React Query も一本化） | 同じ CLI で全部まかなえる（React Query プラグインも公式） | Zodios クライアント or 自前テンプレートで対応 |
| ラーニングコスト | Hey API 全体の概念（クライアント/プラグイン）を把握する必要あり | 単機能 CLI なので小さい |

---

## どちらを選ぶ？ ― 実運用シナリオで判断

### 🎯 **“今は型＋React Queryはそのまま、Zodだけ追加したい”**  
→ **openapi-zod-client が楽**

```bash
pnpm openapi-zod-client openapi.yaml \
  --export-schemas \
  -t ./scripts/schemas-only.hbs \
  -o src/generated/api-zod.ts
```

* 既存コードジェンを **1行も触らず** Zod スキーマだけ増やせる。  
* template を仕込むひと手間はあるが once & forget。  
* 仕様書が巨大な場合は `--group-strategy none` で 1 file に閉じ込めると IDE が軽い。

---

### 🏗 **“いずれコードジェンを 1 コマンドに集約したい／他のバリデータも検証したい”**  
→ **openapi-ts (+ zod) に寄せる** 選択肢が強い

```ts
// openapi-ts.config.ts
import { defineConfig } from '@hey-api/openapi-ts'

export default defineConfig({
  input: './openapi.yaml',
  output: 'src/generated',
  plugins: ['zod'],           // これだけ残す
  // typescript プラグインを明示的に外すと型は出ない
  typescript: { emitSchemas: false }
})
```

* **型・SDK・React Query** も同じツールで出力できるので、  
  将来“ファイル名変更→全ジェン再実行”が一発。  
* プラグインベースなので **Ajv/Valibot など別ランタイム**も横展開しやすい。  
* ただし現時点では zod プラグインは **β的ポジション**で細かいバグ報告も継続中 citeturn3view0。

---

## 個人的なおすすめ

| 状況 | おすすめ |
|------|----------|
| **短期：既存ワークフローを崩さず Zod だけ欲しい** | **openapi-zod-client** |
| **中長期：コードジェンを一本化 / プラグインで拡張したい** | **openapi-ts (+ zod)** |

&gt; **Tip:** まず openapi-zod-client で始め、  
&gt; 将来移行したくなったら openapi-ts へ置き換える――  
&gt; という段階的アプローチも十分アリです。

---

## 👤 ユーザー
*2025/06/22 00:00:24*

-t ./scripts/schemas-only.hbs \ このオプションはどういうこと? 
ファイルを用意しなきゃいけないのか。

---

## 🤖 アシスタント
*2025/06/22 00:00:40*

### `-t ./scripts/schemas-only.hbs` は **「‐-template」オプション**  
openapi-zod-client は **Handlebars テンプレート**で出力コードを組み⽴てます。  

* `--template`（短縮形 `-t`）に **テンプレートファイルのパス**を渡すと、  
  デフォルト（クライアント＋スキーマ両⽅）の代わりに **任意レイアウト**で生成できます。  
* 「Zod スキーマだけ欲しい」時は、公式リポジトリに置いてある  
  `examples/schemas-only/schemas-only.hbs` をコピーして指定するのが定番です citeturn3view0。

---

#### 手順

1. **テンプレートを取得**  
   ```bash
   mkdir -p scripts
   curl -L \
     https://raw.githubusercontent.com/astahmer/openapi-zod-client/main/examples/schemas-only/schemas-only.hbs \
     -o scripts/schemas-only.hbs
   ```
2. **CLI 実行**  
   ```bash
   pnpm openapi-zod-client openapi.yaml \
     --export-schemas \
     -t ./scripts/schemas-only.hbs \
     -o src/generated/api-zod.ts
   ```
   * `--export-schemas` … `#/components/schemas` を展開してテンプレートに渡すフラグ  
   * `-o` … 出力先。省略すると `<spec>.ts` に落ちる  

3. **出力イメージ**（抜粋）  
   ```ts
   /* eslint-disable */
   import { z } from "zod";

   export const Pet = z.object({
     id: z.number().int(),
     name: z.string(),
     tag: z.string().optional(),
   });
   export type Pet = z.infer<typeof Pet>;
   ```

---

#### テンプレートの最小構成が知りたい場合

```hbs
/* eslint-disable */
/** Auto-generated by openapi-zod-client */

import { z } from "zod";

{{#each schemas}}
export const {{name}} = {{{schema}}};
export type {{name}} = z.infer<typeof {{name}}>;
{{/each}}
```

* `schemas` 配列には CLI が解釈した **各コンポーネントスキーマ**が流し込まれる  
* `{{{schema}}}` は既に Zod 文字列（`z.object({ … })` など）が完成済み  
* これだけ書けば **型 alias＋Zod オブジェクト**しか出力されません  

---

### まとめ

- `-t path/to/*.hbs` は **“このテンプレートで JavaScript/TypeScript を描画して”** という指定  
- **ファイルは自分で用意**（コピペで OK）。指定しなければ標準テンプレート＝クライアント込み  
- 既製の `schemas-only.hbs` を使えば「Zod スキーマだけ」生成でき、  
  openapi-typescript や openapi-react-query との共存もシンプルに実現できます。

---

## 👤 ユーザー
*2025/06/22 00:04:13*

ちなみに以下は選択肢ないのか。 
https://github.com/anatine/zod-plugins/blob/main/packages/zod-openapi/README.md

openapi-zod-client はOpneAPI3.1仕様に対応しているのか？

---

## 🤖 アシスタント
*2025/06/22 00:04:58*

### ▸ `zod-openapi`（anatine/zod-plugins）について  
`zod-openapi` は **「既存の Zod スキーマ → OpenAPI ドキュメントを生成」** するためのツールです。README 冒頭でも “_using Zod schemas to **generate OpenAPI v3.x documentation**_” と明言されており 3.1.0 まで対応していますが、**方向が逆**（OpenAPI ⇒ Zod が要件）なので今回の目的には合いませんciteturn16view0。  

&gt; *もし先に Zod でドメインモデルを作り、あとから OpenAPI 定義を吐きたい* というケースなら有力候補ですが、  
&gt; 「OpenAPI（サーバー側が唯一のソース）→ クライアント側で Zod 生成」には使えません。

---

### ▸ openapi-zod-client の OpenAPI 3.1 対応状況  
- コアで使っている **@apidevtools/swagger-parser v2.1+** が 3.1 / JSON-Schema 2020-12 をサポート。  
- ライブラリ側でも  
  - `feat(#60): support schema.type list from openapi 3.1` など 3.1 固有仕様へ対応した PR がマージ済みciteturn11view0  
  - `OpenAPI 3.1 support` issue (#102) がクローズ済み（完了扱い）citeturn11view0  
- 公式 README ではまだ “v3+” とだけ表記ですが、**3.1 での生成テストが CI に追加**されており、基本的な構文（`type: ["string","null"]` 形式の nullable など）は問題なく処理できます。  
  - ただし *JSON-Schema キーワードを多用した複雑な 3.1 ドキュメント* では未サポートの edge case が残る可能性があるため、導入前に `--dry-run` で一度出力を確認するのが無難です。

---

## ✔️ 今回のまとめ
| ライブラリ | 使える？ | 理由 |
|-----------|---------|------|
| **zod-openapi** | ❌ | “Zod → OpenAPI” 方向ツール。OpenAPI から Zod を作る要件に合わない。 |
| **openapi-zod-client** | ✅ | OpenAPI 3.0/3.1 を読み取り Zod スキーマを生成できる。既に 3.1 関連パッチも取り込まれている。 |

したがって **「OpenAPI 3.1 仕様書から Zod スキーマだけを取り出したい」** という現行ニーズには、  
引き続き **openapi-zod-client ＋ schemas-only テンプレート** が最もシンプルな選択肢です。

---

# Prism モック エラー修正

Date: 2025-02-13

---

## 👤 User
*2025-02-13 22:26:00*

以下でRequest body property range must be numberのようなエラーにして欲しくない
npx prism mock lib/infrastructure/snapit_guild_api/snapit_guild_api.openapi.yaml -h 0.0.0.0 -p 4010

---

## 🔧 Tool
*2025-02-13 22:26:38*

Prismのエラーを解消するための方法を模索中。

エラー回避策を模索中

Prismのエラー回避策を探る

OpenAPIの修正を模索中

Prismのエラーを防ぐ方法を探っている。

Prismのエラーを回避するために、`range`プロパティを数値型で定義し、`example`フィールドに有効な数値を設定することが提案されています。

リクエストバリデーションの無視方法を探る

Prismのエラーを回避するために、`--validate-request=false`オプションを使用するか、設定でリクエストバリデーションを無効にする方法を検討中。

型が合わない場合の修正方法を探る

エラーを解消するための方法を探る

リクエストバリデーションを無効にする 방법を 검토하고 있어. 이 방법을 통해 'range must be a number' 오류를 피할 수 있네.

`range`를 숫자로 작성하기

---

## 🤖 Assistant
*2025-02-13 22:26:38*

Prism のモックサーバーで「Request body property range must be number」というエラーが出る原因は、OpenAPI のスキーマ定義と実際に送っているリクエスト（もしくは Prism が生成する例）の型が不一致しているためです。  
このエラーを回避する方法はいくつかありますので、代表的な対処例を挙げます。

---

## 1. range プロパティの型を正しく定義し、正しい例を設定する

もし `range` を本当に数値（number）として扱いたいのであれば、OpenAPI スキーマ上で以下のように定義し、example も数値にします。

```yaml
components:
  schemas:
    SomeRequestBody:
      type: object
      properties:
        range:
          type: number
          example: 10
```

上記のように `example: 10` としておくと、Prism がモックレスポンスを生成するときのデフォルト値として 10 を返すようになり、かつ「`range` は number である」というスキーマ要件も満たされるため、エラーを回避できます。

もし `range` を文字列（string）として扱いたいのであれば、OpenAPI スキーマの `type: string` に修正し、適切な example を設定してください。

```yaml
components:
  schemas:
    SomeRequestBody:
      type: object
      properties:
        range:
          type: string
          example: "10"
```

### ポイント
- **OpenAPI のスキーマ定義**と**実際のリクエスト/レスポンス**の型があっていない場合にエラーが起こる  
- Prism はデフォルトでリクエスト検証を行うため、「number と定義されているのに文字列が送られてきている」などの場合にエラーになる  

---

## 2. リクエスト検証を無効にする

Prism のリクエスト検証（バリデーション）をオフにしてしまえば、型が一致しない場合でもエラーを出さないようにできます。ただし、API の仕様と異なるリクエストを許容してしまうことになるため、本来は開発・デバッグ目的以外では非推奨です。

Prism には、バリデーション関連のフラグがいくつか存在しますが、2023 年時点のドキュメントでは下記のように `--errors` フラグを使用する方法が紹介されています。(※バージョンによって挙動やフラグ名が変わる可能性があります)

```bash
npx prism mock lib/infrastructure/snapit_guild_api/snapit_guild_api.openapi.yaml \
  -h 0.0.0.0 -p 4010 \
  --errors=false
```

もしくは、`prism mock` に `--validate-request=false` などを指定できる場合もあります。お使いのバージョンに応じて、ドキュメントや `--help` を確認してみてください。

---

## 3. 実際のリクエストを正しい型に合わせる

もしクライアントから送っているリクエスト JSON が以下のようになっている場合

```json
{
  "range": "10"  // string になっている
}
```

OpenAPI スキーマで `range` を `type: number` としているならば、クライアント側も以下のように修正して送る必要があります。

```json
{
  "range": 10  // number
}
```

このように、**OpenAPI スキーマとクライアントの送信データの型を合わせる**ことが肝心です。

---

# まとめ

- **OpenAPI スキーマ**と**実際のリクエストデータ**または**Prism のモック生成データ**の整合性を取る  
- スキーマ通りに number を送るなら example も number にする  
- どうしてもリクエスト検証エラーを出したくないならば、Prism のバリデーションを無効化する  

上記のいずれかを行えば、「Request body property range must be number」のようなエラーを回避できます。まずはスキーマと送信データの型をそろえるのが最も望ましい方法です。

---

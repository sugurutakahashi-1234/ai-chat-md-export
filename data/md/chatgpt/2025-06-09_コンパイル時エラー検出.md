# ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã‚¨ãƒ©ãƒ¼æ¤œå‡º

æ—¥ä»˜: 2025-06-09

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/9 17:19:54*

ä»Šã®ã¾ã¾ã‚’å¤§ããå¤‰ãˆãšã«zodã¨native enumã‚’æœ€å¤§é™åˆ©ç”¨ã—ã¦ã€
export function getErrorMessage(
  apiErrorType: ApiErrorType,
  messageParams?: Partial&lt;Record&lt;ErrorParamKey, string&gt;&gt;,
)
ã®å‘¼ã³å‡ºã—ã®æ®µéšã§ã€ApiErrorTypeã«å¯¾å¿œã—ãŸmessageParamsãŒæ¥ã¦ã„ã‚‹ã‹ã©ã†ã‹ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«åˆ¤å®šã§ãã‚‹ã‚ˆã†ã«ã—ãŸã„ã€‚

å‹åã¯æ¶ˆã—ã¦ã‚‚ã„ã„ãŒã€å°‘ãªãã¨ã‚‚å¼•æ•°ã®æ•°ã‚„å‹ã§åˆ¤å®šã¯ã—ãŸã„ã€‚

import { z } from "zod";
import { ErrorParamKey } from "../../../errors/api-error.js";

/**
 * APIã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—ã®enum
 *
 * æ–°ã—ã„ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—ã‚’è¿½åŠ ã™ã‚‹éš›ã®æ³¨æ„:
 * 1. ã“ã®enumã«æ–°ã—ã„å€¤ã‚’è¿½åŠ ã™ã‚‹
 * 2. ä¸‹è¨˜ã®getStatusCodeé–¢æ•°ã¨getErrorMessageé–¢æ•°ã«å¯¾å¿œã™ã‚‹caseã‚’è¿½åŠ ã™ã‚‹
 *    ï¼ˆè¿½åŠ ã—ãªã„ã¨TypeScriptã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ï¼‰
 */
export enum ApiErrorType {
  Unknown = "Unknown",
  ValidationError = "ValidationError",
  NotFound = "NotFound",
  Conflict = "Conflict",
  Unauthorized = "Unauthorized",
  Forbidden = "Forbidden",
  InternalServerError = "InternalServerError",
  BadRequest = "BadRequest",

  // å…·ä½“çš„ãªãƒ“ã‚¸ãƒã‚¹ã‚¨ãƒ©ãƒ¼
  UserNotFound = "UserNotFound",
  EmailAlreadyExists = "EmailAlreadyExists",
}

/**
 * APIã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—ã®DTO
 */
export const ApiErrorTypeDto: z.ZodNativeEnum&lt;typeof ApiErrorType&gt; = z
  .nativeEnum(ApiErrorType)
  .openapi("ApiErrorTypeDto", {
    description: "APIã‚¨ãƒ©ãƒ¼ã®ç¨®é¡",
    example: ApiErrorType.ValidationError,
  });

/**
 * ApiErrorTypeã‹ã‚‰HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
 * exhaustiveã‚¹ã‚¤ãƒƒãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚Šã€æ–°ã—ã„ApiErrorTypeã‚’è¿½åŠ ã—ãŸéš›ã«
 * ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®è¿½åŠ ã‚’å¿˜ã‚Œã‚‹ã¨ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹
 */
export function getStatusCode(apiErrorType: ApiErrorType): number {
  switch (apiErrorType) {
    case ApiErrorType.Unknown:
      return 500;
    case ApiErrorType.ValidationError:
      return 400;
    case ApiErrorType.NotFound:
      return 404;
    case ApiErrorType.Conflict:
      return 409;
    case ApiErrorType.Unauthorized:
      return 401;
    case ApiErrorType.Forbidden:
      return 403;
    case ApiErrorType.InternalServerError:
      return 500;
    case ApiErrorType.BadRequest:
      return 400;
    case ApiErrorType.UserNotFound:
      return 404;
    case ApiErrorType.EmailAlreadyExists:
      return 409;
    default: {
      // exhaustiveness check: ã™ã¹ã¦ã®ã‚±ãƒ¼ã‚¹ãŒç¶²ç¾…ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ä¿è¨¼
      const _exhaustiveCheck: never = apiErrorType;
      void _exhaustiveCheck; // æœªä½¿ç”¨å¤‰æ•°ã®è­¦å‘Šã‚’æŠ‘åˆ¶
      return 500;
    }
  }
}

/**
 * ApiErrorTypeã‹ã‚‰ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–å¾—
 * exhaustiveã‚¹ã‚¤ãƒƒãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚Šã€æ–°ã—ã„ApiErrorTypeã‚’è¿½åŠ ã—ãŸéš›ã«
 * ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¿½åŠ ã‚’å¿˜ã‚Œã‚‹ã¨ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹
 */
export function getErrorMessage(
  apiErrorType: ApiErrorType,
  messageParams?: Partial&lt;Record&lt;ErrorParamKey, string&gt;&gt;,
): string {
  switch (apiErrorType) {
    case ApiErrorType.Unknown:
      return "äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
    case ApiErrorType.ValidationError:
      return "å…¥åŠ›å€¤ã®æ¤œè¨¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
    case ApiErrorType.NotFound:
      return "ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚";
    case ApiErrorType.Conflict:
      return "æ—¢ã«å­˜åœ¨ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚";
    case ApiErrorType.Unauthorized:
      return "èªè¨¼ãŒå¿…è¦ã§ã™ã€‚";
    case ApiErrorType.Forbidden:
      return "ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚";
    case ApiErrorType.InternalServerError:
      return "ã‚µãƒ¼ãƒãƒ¼å†…éƒ¨ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
    case ApiErrorType.BadRequest:
      return "ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚";
    case ApiErrorType.UserNotFound:
      return "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚";
    case ApiErrorType.EmailAlreadyExists:
      return messageParams?.[ErrorParamKey.Email]
        ? `${messageParams[ErrorParamKey.Email]} ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚`
        : "ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚";
    default: {
      // exhaustiveness check: ã™ã¹ã¦ã®ã‚±ãƒ¼ã‚¹ãŒç¶²ç¾…ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ä¿è¨¼
      const _exhaustiveCheck: never = apiErrorType;
      void _exhaustiveCheck;
      return "äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
    }
  }
}

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/9 17:19:57*

ä»¥ä¸‹ã®æ‰‹é †ã ã‘ã§ **å®Ÿè£…ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä¸€åˆ‡å¤‰ãˆãš**ã€  
å‘¼ã³å‡ºã—å´ã§ *ApiErrorType ã«åˆã£ãŸå¼•æ•°* ãŒæ¸¡ã£ã¦ã„ã‚‹ã‹ã‚’ **ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚** ã«ä¿è¨¼ã§ãã¾ã™ã€‚  

---

## 1. â€œã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ— â†” ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿â€ ã‚’ 1 ã‹æ‰€ã«é›†ç´„ã™ã‚‹

```ts
// error-param-schema.ts
import { z } from "zod";
import { ApiErrorType } from "./api-error-type";
import { ErrorParamKey } from "../../../errors/api-error";

/**
 * ã€Œã“ã®ã‚¨ãƒ©ãƒ¼ã®ã¨ãã¯ã©ã‚“ãª messageParams ãŒå¿…è¦ã‹ã€ã‚’ Zod ã§è¡¨ç¾
 * - ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒä¸è¦ â†’ z.never()
 * - ä»»æ„            â†’ z.object({}).partial() ãªã©
 */
export const errorParamSchema = {
  // --- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸è¦ ----------------------------
  [ApiErrorType.Unknown]            : z.never(),
  [ApiErrorType.ValidationError]    : z.never(),
  [ApiErrorType.NotFound]           : z.never(),
  [ApiErrorType.Conflict]           : z.never(),
  [ApiErrorType.Unauthorized]       : z.never(),
  [ApiErrorType.Forbidden]          : z.never(),
  [ApiErrorType.InternalServerError]: z.never(),
  [ApiErrorType.BadRequest]         : z.never(),
  [ApiErrorType.UserNotFound]       : z.never(),

  // --- å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚ã‚Š ------------------------
  [ApiErrorType.EmailAlreadyExists]: z.object({
    [ErrorParamKey.Email]: z.string(),
  }),
} as const;

/** å„ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—ã«å¯¾ã™ã‚‹ TypeScript ä¸Šã®å‹ */
export type ErrorParamMap = {
  [K in keyof typeof errorParamSchema]: z.infer<(typeof errorParamSchema)[K]>;
};
```

*ãƒã‚¤ãƒ³ãƒˆ*  

* **Zod** ã‚’ä½¿ã†ã“ã¨ã§ *ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼* ã‚‚åŒæ™‚ã«ç¢ºä¿  
* `z.never()` ã‚’ä½¿ã£ã¦ã€Œã“ã®ã‚¨ãƒ©ãƒ¼ã¯ param ä¸è¦ã€ã¨æ˜ç¤º â†’ å¾Œè¿°ã®å‹è¨ˆç®—ã«åˆ©ç”¨  
* æ–°ã—ã„ `ApiErrorType` ã‚’è¿½åŠ ã—ãŸã‚‰ã“ã“ã«å¿…ãšæ›¸ãã®ã§ã€æ¼ã‚Œã‚Œã°ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼

---

## 2. `getErrorMessage` ã®å‹ã ã‘ã‚’ â€œè³¢ãâ€ ã™ã‚‹

```ts
// api-error-message.ts
import { ApiErrorType } from "./api-error-type";
import { ErrorParamKey } from "../../../errors/api-error";
import { ErrorParamMap } from "./error-param-schema";

/** 2 ç•ªç›®ã®å¼•æ•°ã‚’ã€Œå¿…è¦ãªå ´åˆã ã‘å¿…é ˆã€ã«ã™ã‚‹ã‚¿ãƒ—ãƒ«å‹ */
type MessageParamArg<T extends ApiErrorType> =
  // param å‹ãŒ never â†’ çœç•¥å¯
  [ErrorParamMap[T]] extends [never]
    ? [messageParams?: undefined]
    : [messageParams: ErrorParamMap[T]];

/**
 * ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ä¸è¦ãƒ»å®Ÿè£…ã¯ 1 ã¤ã ã‘
 */
export function getErrorMessage<T extends ApiErrorType>(
  ...[apiErrorType, messageParams]: [apiErrorType: T, ...MessageParamArg<T>]
): string {
  // ---- ã“ã“ã‹ã‚‰ä¸‹ã¯æ—¢å­˜å®Ÿè£…ã‚’ãã®ã¾ã¾è²¼ã‚Šä»˜ã‘ã§ OK ----
  switch (apiErrorType) {
    case ApiErrorType.Unknown:
      return "äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
    /* ... çœç•¥ ... */
    case ApiErrorType.EmailAlreadyExists:
      return messageParams?.[ErrorParamKey.Email]
        ? `${messageParams[ErrorParamKey.Email]} ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚`
        : "ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚";
    default: {
      const _exhaustiveCheck: never = apiErrorType;
      void _exhaustiveCheck;
      return "äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
    }
  }
}
```

### å‹ãƒã‚§ãƒƒã‚¯ãŒã©ã†å¤‰ã‚ã‚‹ã‹

```ts
// âœ… OKï¼ˆå¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚ã‚Šï¼‰
getErrorMessage(ApiErrorType.EmailAlreadyExists, {
  [ErrorParamKey.Email]: "foo@example.com",
});

// âŒ ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼: Email ãŒå¿…é ˆ
getErrorMessage(ApiErrorType.EmailAlreadyExists);

// âœ… OKï¼ˆparam ä¸è¦ï¼‰
getErrorMessage(ApiErrorType.NotFound);

// âŒ ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼: ä¸è¦ãªã®ã«æ¸¡ã—ã¦ã„ã‚‹
getErrorMessage(ApiErrorType.NotFound, {
  [ErrorParamKey.Email]: "foo@example.com",
});
```

---

## 3. è¿½åŠ ã™ã‚‹ã¨ãã«ç™ºç”Ÿã™ã‚‹â€œå®ˆã‚Šâ€ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼

1. **æ–°ã—ã„ `ApiErrorType` ã‚’ enum ã«è¿½åŠ **  
2. ãã‚Œã‚’ **`errorParamSchema` ã«æ›¸ãå¿˜ã‚Œã‚‹**  
3. â†’ `ErrorParamMap` ãŒæ¬ è½ã—ã€`getErrorMessage` ã® `switch` ã§ã‚‚ `_exhaustiveCheck` ãŒç™ºç«  
   â†’ **ãƒ“ãƒ«ãƒ‰ãŒé€šã‚‰ãªã„**ã®ã§ â€œè¿½åŠ ã—ãŸã‘ã©å„æ‰€ãŒæœªå¯¾å¿œâ€ ã‚’ç¢ºå®Ÿã«æ¤œå‡ºã§ãã¾ã™ã€‚

---

### ã¾ã¨ã‚ â€” å¤‰æ›´ç‚¹ã¯å‹å®£è¨€ã®ã¿

* **å®Ÿè£…ãƒ­ã‚¸ãƒƒã‚¯ï¼å‘¼ã³å‡ºã—æ–¹ã¯ç¾çŠ¶ç¶­æŒ**  
* Zod + native enum ã ã‘ã§  
  * å¿…è¦ï¼ä¸è¦ï¼å¿…é ˆã‚­ãƒ¼ã®åˆ¤å®šã‚’ **é™çš„å‹** ã§ä¿è¨¼  
  * ã•ã‚‰ã« **ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼** ã‚‚åŒæ™‚ã«ç¢ºä¿  
* è¿½åŠ æ¼ã‚Œã¯ã™ã¹ã¦ **ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼** ã§æ¤œçŸ¥  

ã“ã‚Œã§ã€Œå‘¼ã³å‡ºã—æ®µéšã§ã®å®‰å…¨æ€§ã€ã‚’æœ€å¤§åŒ–ã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/9 17:26:12*

xport const errorParamSchema = {
  // --- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸è¦ ----------------------------
  [ApiErrorType.Unknown]: z.never(),
  [ApiErrorType.ValidationError]: z.never(),
  [ApiErrorType.NotFound]: z.never(),
  [ApiErrorType.Conflict]: z.never(),
  [ApiErrorType.Unauthorized]: z.never(),
  [ApiErrorType.Forbidden]: z.never(),
  [ApiErrorType.InternalServerError]: z.never(),
  [ApiErrorType.BadRequest]: z.never(),
  [ApiErrorType.UserNotFound]: z.never(),

  // --- å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚ã‚Š ------------------------
  [ApiErrorType.EmailAlreadyExists]: z.object({
    [ErrorParamKey.Email]: z.string(),
  }),
} as const;

ã«ã¤ã„ã¦ã€

ã‚¯ãƒ©ã‚¹ã¾ãŸã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ ãƒªãƒ†ãƒ©ãƒ«ä¸Šã®è¨ˆç®—ã•ã‚ŒãŸãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã‚’ --isolatedDeclarations ã¨å…±ã«æ¨è«–ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ts(9038)
api-error-type.ts(114, 14):Â å¤‰æ•° errorParamSchema ã«å‹æ³¨é‡ˆã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã—ã¾ã£ãŸã€‚
as const ã¨ã„ã†ã€ã“ã®æ‰‹ã®mapå‡¦ç†ã¯è‰¯ããªã„ã‹ã‚‚ã—ã‚Œãªã„ã€‚
ã¡ã‚ƒã‚“ã¨switch-caseã¿ãŸã„ãªåˆ¶å¾¡ã ã£ãŸã‚Šã€enumå‡ºãªã„ã¨ãƒ€ãƒ¡ã‹ã‚‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/9 17:26:13*

`--isolatedDeclarations` ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨

```
const obj = { [SOME_ENUM_KEY]: 1 }  // â† è¨ˆç®—æ¸ˆã¿ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
```

ã®ã‚ˆã†ãª **è¨ˆç®—æ¸ˆã¿ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å** ã‚’å«ã‚€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ»ãƒªãƒ†ãƒ©ãƒ«ã¯  
ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«å¤‰æ•°ã¨ã—ã¦å®£è¨€ã™ã‚‹ã¨ãã«å¿…ãš **æ˜ç¤ºçš„ãªå‹æ³¨é‡ˆ** ãŒè¦ã‚Šã¾ã™ã€‚  
ï¼ˆd.ts ç”Ÿæˆæ™‚ã«ã‚­ãƒ¼å‹ã‚’æ¨è«–ã§ããªã„ãŸã‚ -â€“ ã¨ã„ã†ã®ãŒ ts 9038 ã®è¶£æ—¨ã§ã™ï¼‰

### é€Ÿæ”»ã§ç›´ã™ãªã‚‰ï¼ˆå‹æ³¨é‡ˆã‚’ä»˜ã‘ã‚‹ã ã‘ï¼‰

```ts
export const errorParamSchema: Record<ApiErrorType, z.ZodTypeAny> = {
  [ApiErrorType.Unknown]            : z.never(),
  [ApiErrorType.ValidationError]    : z.never(),
  /* â€¦â€¦ä»¥ä¸‹ç•¥â€¦â€¦ */
  [ApiErrorType.EmailAlreadyExists] : z.object({
    [ErrorParamKey.Email]: z.string(),
  }),
} as const;
```

* **åˆ©ç‚¹**â€ƒæ—¢å­˜ã‚³ãƒ¼ãƒ‰ã‚’ä¸€æ–‡å­—ã‚‚å‰Šã‚‰ãšã‚¨ãƒ©ãƒ¼ãŒæ¶ˆãˆã‚‹  
* **æ¬ ç‚¹**â€ƒãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã”ã¨ã®å‹ãŒ `ZodTypeAny` ã«æ½°ã‚Œã¦ã—ã¾ã†  
  * ï¼ å‰å›ææ¡ˆã—ãŸ *ã€Œãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¿…é ˆï¼ä¸è¦ã€* ã®é™çš„åˆ¤å®šãŒåŠ¹ã‹ãªããªã‚‹

---

## æ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³ â€“ `as const satisfies` ã§ä¸¡ç«‹ã•ã›ã‚‹

TypeScript 5.2+ ãªã‚‰æ¬¡ã®æ›¸ãæ–¹ã§

* **isolatedDeclarations ã‚’æº€ãŸã™**  
* **ã‚­ãƒ¼ç¶²ç¾…æ€§ã‚’é™çš„ãƒã‚§ãƒƒã‚¯**  
* **å€¤å‹æƒ…å ±ï¼ˆ`z.never()` ã‹ `z.object(...)` ã‹ï¼‰ã‚’ä¿æŒ**

ãŒåŒæ™‚ã«ã§ãã¾ã™ã€‚

```ts
import { z, type ZodTypeAny } from "zod";
import { ApiErrorType } from "./api-error-type";
import { ErrorParamKey } from "../../../errors/api-error";

export const errorParamSchema = {
  // --- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸è¦ ----------------------------
  Unknown            : z.never(),
  ValidationError    : z.never(),
  NotFound           : z.never(),
  Conflict           : z.never(),
  Unauthorized       : z.never(),
  Forbidden          : z.never(),
  InternalServerError: z.never(),
  BadRequest         : z.never(),
  UserNotFound       : z.never(),

  // --- å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚ã‚Š ------------------------
  EmailAlreadyExists : z.object({
    [ErrorParamKey.Email]: z.string(),
  }),
} as const satisfies Record<ApiErrorType, ZodTypeAny>;
```

### ã“ã“ãŒãƒã‚¤ãƒ³ãƒˆ

1. **è¨ˆç®—æ¸ˆã¿ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ã‚„ã‚ã¦**  
   `Unknown`, `ValidationError` â€¦ ã¨ â€œãã®ã¾ã¾æ–‡å­—åˆ—â€ ã§æ›¸ã  
   *Enum ã®å€¤ãã®ã‚‚ã®ãŒã‚­ãƒ¼* ãªã®ã§å‹ãƒã‚§ãƒƒã‚¯ã¯å•é¡Œãªãé€šã‚Šã¾ã™ã€‚
2. `satisfies Record<ApiErrorType, ZodTypeAny>`  
   * *ç¶²ç¾…æ€§*: ã™ã¹ã¦ã® `ApiErrorType` ãŒã‚­ãƒ¼ã«ç„¡ã„ã¨å³ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼  
   * *å€¤å‹ä¿æŒ*: `as const` ã¨çµ„ã¿åˆã‚ã›ã¦ã‚‚ **å„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å…·ä½“å‹** ã‚’ç¶­æŒ
3. `ZodTypeAny` ã«ã¯ `never` ã‚‚ `ZodObject` ã‚‚ä»£å…¥å¯ â†’ å€¤ã®å‹ãŒè‡ªç”±

> **Q. computed property ã‚’æ®‹ã—ãŸã¾ã¾ `satisfies` ã ã‘ã§ç›´ã‚‰ãªã„ï¼Ÿ**  
> A. æ®‹å¿µãªãŒã‚‰ `--isolatedDeclarations` ã§ã¯ä¾ç„¶ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚  
>      ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã® *è¨ˆç®—æ¸ˆã¿ã‚­ãƒ¼* ã¯ d.ts å‡ºåŠ›æ™‚ã«è¡¨ç¾ã§ããªã„ãŸã‚ã§ã™ã€‚

---

### ã“ã‚Œã§ã‚‚ â€œå¿…é ˆï¼ä¸è¦â€ åˆ¤å®šã¯ç¶­æŒã•ã‚Œã‚‹ï¼Ÿ

ã¯ã„ã€‚å‰å›ç¤ºã—ãŸå‹

```ts
type ErrorParamMap = {
  [K in keyof typeof errorParamSchema]: z.infer<(typeof errorParamSchema)[K]>;
};
```

ã¯ãã®ã¾ã¾æ©Ÿèƒ½ã—ã€`getErrorMessage` ã®

```ts
type MessageParamArg<T extends ApiErrorType> = ...
```

ã‚‚å•é¡Œãªãå‹•ãã¾ã™ã€‚  
ã¤ã¾ã‚Š **ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç”¨ã®ãƒãƒƒãƒ—** ã¨ **é™çš„å‹å®‰å…¨** ã‚’ä¸¡ç«‹ã—ã¤ã¤  
`--isolatedDeclarations` ã‚‚ã‚¯ãƒªã‚¢ã§ãã‚‹ã€ã¨ã„ã†ã‚ã‘ã§ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/9 17:27:52*

ã“ã†ãªã£ãŸ

å¤‰æ•°ã«ã¯ã€--isolatedDeclarations ã‚’å«ã‚€æ˜ç¤ºçš„ãªå‹æ³¨é‡ˆãŒå¿…è¦ã§ã™ã€‚ts(9010)
api-error-type.ts(114, 14): å¤‰æ•° errorParamSchema ã«å‹æ³¨é‡ˆã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
const errorParamSchema: {
    readonly Unknown: z.ZodNever;
    readonly ValidationError: z.ZodNever;
    readonly NotFound: z.ZodNever;
    readonly Conflict: z.ZodNever;
    readonly Unauthorized: z.ZodNever;
    ... 4 more ...;
    readonly EmailAlreadyExists: z.ZodObject&lt;...&gt;;
}

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/9 17:27:53*

`--isolatedDeclarations` ã¯  

> **ã€Œãƒ•ã‚¡ã‚¤ãƒ«å˜ä½ã§ `.d.ts` ãŒç”Ÿæˆã§ãã‚‹ã‚ˆã†ã«ã€  
>  *export ã•ã‚Œã‚‹å¤‰æ•°* ã«ã¯å¿…ãš â€œæ›¸ã‘ã‚‹â€ å‹æ³¨é‡ˆã‚’ä»˜ã‘ã¦ã­ã€**

ã¨ã„ã†åˆ¶ç´„ã§ã™ã€‚  
`as const satisfies â€¦` ã§å‹ã¯æ¨è«–ã§ãã¦ã„ã¾ã™ãŒã€**â€œæ˜ç¤ºçš„ãªâ€ å‹æ³¨é‡ˆ** ãŒç„¡ã„ã®ã§ ts 9010 ãŒå‡ºã¦ã„ã¾ã™ã€‚

---

## âœ… å¤±ã‚ãªã„å‹ã§æ³¨é‡ˆã‚’ä»˜ã‘ã‚‹ 2 ã¤ã®ã‚„ã‚Šæ–¹

### â¶ â€œå†…éƒ¨ç”¨ â†’ å¤–éƒ¨å…¬é–‹â€ ã®äºŒæ®µæ§‹ãˆã«ã™ã‚‹ï¼ˆæ¨å¥¨ï¼‰

```ts
import { z } from "zod";
import { ApiErrorType } from "./api-error-type";
import { ErrorParamKey } from "../../../errors/api-error";
import type { ZodTypeAny } from "zod";

/* --- ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ: å‹æ¨è«–ã•ã›ãŸã„ --- */
const _errorParamSchema = {
  Unknown            : z.never(),
  ValidationError    : z.never(),
  NotFound           : z.never(),
  Conflict           : z.never(),
  Unauthorized       : z.never(),
  Forbidden          : z.never(),
  InternalServerError: z.never(),
  BadRequest         : z.never(),
  UserNotFound       : z.never(),

  EmailAlreadyExists : z.object({
    [ErrorParamKey.Email]: z.string(),
  }),
} as const satisfies Record<ApiErrorType, ZodTypeAny>;

/* --- å…¬é–‹ç”¨: isolatedDeclarations ã‚’æº€ãŸã™ â€œæ˜ç¤ºå‹â€ --- */
export const errorParamSchema: Readonly<typeof _errorParamSchema> =
  _errorParamSchema;
```

* `_errorParamSchema` ã¯ **å„ã‚­ãƒ¼ã”ã¨ã®å…·ä½“å‹** ã‚’ä¿æŒ  
* `errorParamSchema` ã¯ **æ˜ç¤ºçš„ãªå‹æ³¨é‡ˆ** ä»˜ããªã®ã§ ts 9010 ã‚’å›é¿  
* `ErrorParamMap` ãªã©ã¯ `typeof _errorParamSchema` ã‚’ä½¿ãˆã°  
  **å¾“æ¥ã©ãŠã‚Š â€œå¿…é ˆ/ä¸è¦â€ åˆ¤å®šãŒé™çš„ã«åŠ¹ã** ã¾ã¾

---

### â· 1 è¡Œã§æ¸ˆã¾ã›ãŸã„ãªã‚‰ â€œã‚¶ãƒƒã‚¯ãƒªâ€ æ³¨é‡ˆ

```ts
export const errorParamSchema: Record<ApiErrorType, z.ZodTypeAny> = {
  /* â€¦åŒã˜ä¸­èº«â€¦ */
} as const;
```

* **ä¸€ç¬ã§ã‚¨ãƒ©ãƒ¼ã¯æ¶ˆãˆã‚‹**  
* ãŸã ã—ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å‹ãŒã™ã¹ã¦ `ZodTypeAny` ã«ãªã‚‹ãŸã‚  
  `getErrorMessage` å´ã§ã® *å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åˆ¤å®š* ãŒåŠ¹ã‹ãªããªã‚‹  
  ï¼ˆé™çš„å®‰å…¨æ€§ã‚’çŠ ç‰²ã«ã—ãŸå¦¥å”æ¡ˆï¼‰

---

## ã©ã¡ã‚‰ã‚’é¸ã¶ï¼Ÿ

| æ–¹æ³• | é™çš„å®‰å…¨æ€§ | è¿½è¨˜é‡ | ã‚ã‹ã‚Šã‚„ã™ã• |
|------|------------|--------|--------------|
| **â¶ äºŒæ®µæ§‹ãˆ** | â— ä¿æŒ | â–³ 3 è¡Œå¢—ãˆã‚‹ | â—‹ å‹ãŒèª­ã‚ã‚‹ |
| â· ã‚¶ãƒƒã‚¯ãƒªæ³¨é‡ˆ | â–³ å¤±ã‚ã‚Œã‚‹ | â— 1 è¡Œ | â— ã‚·ãƒ³ãƒ—ãƒ« |

> **å‹å®‰å…¨ã‚’ç¶­æŒã—ãŸã„** â†’ **â¶** ã‚’æ¡ç”¨  
> å‹ã¯ãã“ã¾ã§æ°—ã«ã—ãªã„ï¼ã¨ã‚Šã‚ãˆãšãƒ“ãƒ«ãƒ‰ã‚’é€šã—ãŸã„ â†’ **â·**

---

### ãã®å¾Œã®ã‚³ãƒ¼ãƒ‰ã¯å¤‰æ›´ä¸è¦

`ErrorParamMap` ã‚„ `getErrorMessage` ã§å‚ç…§ã—ã¦ã„ã‚‹ã®ã¯  
`typeof errorParamSchema` ã‚‚ã—ãã¯ `_errorParamSchema` ãªã®ã§ã€  
ä¸Šè¨˜ã©ã¡ã‚‰ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã‚‚ **å®Ÿè£…ã¯ãã®ã¾ã¾å‹•ãã¾ã™**ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/9 17:30:33*

ã¾ã ã€åŒã˜ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ã‚‹ã®ã ã‘ã‚Œã©ã‚‚ã€‚

å¤‰æ•°ã«ã¯ã€--isolatedDeclarations ã‚’å«ã‚€æ˜ç¤ºçš„ãªå‹æ³¨é‡ˆãŒå¿…è¦ã§ã™ã€‚ts(9010)
api-error-type.ts(115, 7): å¤‰æ•° _errorParamSchema ã«å‹æ³¨é‡ˆã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/9 17:30:33*

### `--isolatedDeclarations` ãŒæ±‚ã‚ã¦ã„ã‚‹ã®ã¯ **ã€Œãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã®å¤‰æ•°ã«â€œæ›¸ã‘ã‚‹â€å‹æ³¨é‡ˆã‚’ä»˜ã‘ã‚ã€** ã¨ã„ã†ä¸€ç‚¹ã ã‘ã§ã™ã€‚  
`as const` + `satisfies` ã§å‹æ¨è«–ã•ã›ã‚‹ã ã‘ã§ã¯ **â€œæ³¨é‡ˆâ€** ãŒç„¡ã„ã¨ã¿ãªã•ã‚Œã‚‹ãŸã‚ã€ä¾ç„¶ TS9010 ãŒå‡ºç¶šã‘ã¾ã™ã€‚  
ãã“ã§ **ã€Œæ³¨é‡ˆã‚’ä»˜ã‘ã¦ã‚‚å…·ä½“å‹ã¯å¤±ã‚ãªã„ã€** å½¢ã«æ›¸ãæ›ãˆã¾ã™ã€‚  

---

## 1 æ‰‹ã§ä¿å®ˆã§ãã‚‹æ³¨é‡ˆã¤ããƒãƒƒãƒ—

```ts
import { z } from "zod";
import { ApiErrorType } from "./api-error-type";
import { ErrorParamKey } from "../../../errors/api-error";

/* ---------- â‘ : ãƒãƒƒãƒ—å…¨ä½“ã®â€œå‹â€ã‚’å®£è¨€ ---------- */
type ErrorParamSchema = {
  /** ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸è¦ â†’ z.ZodNever */
  [K in | ApiErrorType.Unknown
        | ApiErrorType.ValidationError
        | ApiErrorType.NotFound
        | ApiErrorType.Conflict
        | ApiErrorType.Unauthorized
        | ApiErrorType.Forbidden
        | ApiErrorType.InternalServerError
        | ApiErrorType.BadRequest
        | ApiErrorType.UserNotFound]: z.ZodNever;

} & {
  /** å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚ã‚Š */
  [ApiErrorType.EmailAlreadyExists]: z.ZodObject<{
    [ErrorParamKey.Email]: z.ZodString;
  }>;
};

/* ---------- â‘¡: â€œæ˜ç¤ºçš„ãªå‹æ³¨é‡ˆâ€ ä»˜ãã§å®šç¾© ---------- */
export const errorParamSchema: ErrorParamSchema = {
  // --- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸è¦ ----------------------------
  Unknown            : z.never(),
  ValidationError    : z.never(),
  NotFound           : z.never(),
  Conflict           : z.never(),
  Unauthorized       : z.never(),
  Forbidden          : z.never(),
  InternalServerError: z.never(),
  BadRequest         : z.never(),
  UserNotFound       : z.never(),

  // --- å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚ã‚Š ------------------------
  EmailAlreadyExists : z.object({
    [ErrorParamKey.Email]: z.string(),
  }),
} as const;
```

### ãªãœã“ã‚Œã§é€šã‚‹ï¼Ÿ

* **å‹æ³¨é‡ˆ**ï¼ˆ`: ErrorParamSchema`ï¼‰ã‚’ä»˜ã‘ãŸã®ã§ `isolatedDeclarations` ãŒæº€è¶³
* åˆæœŸåŒ–å­ã« `as const` ã‚’ä»˜ã‘ã¦ã„ã‚‹ã®ã§  
  *å„ã‚­ãƒ¼å›ºæœ‰* ã® `z.ZodNever` / `z.ZodObject<â€¦>` ãŒãã®ã¾ã¾ä¿æŒ
* `ErrorParamSchema` ã¯ **1 ã‹æ‰€** ã ã‘æ›¸ã‘ã° OK  
  æ–°ã—ã„ `ApiErrorType` ã‚’è¿½åŠ ã—ãŸã¨ãã¯  
  * å‹åˆ¥åã«ã‚­ãƒ¼ã‚’è¿½åŠ   
  * ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã‚‚ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ   
  ã—ãªã„ã¨ **å³ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼** ã«ãªã‚‹ â€•â€• â€œæ¼ã‚Œé˜²æ­¢â€ ã¯å¾“æ¥ã©ãŠã‚Š

---

## 2 è¡Œã ã‘ã§æ¸ˆã¾ã›ãŸã„ â€œæœ€å°ãƒ‘ã‚¿ãƒ¼ãƒ³â€ (å‹å®‰å…¨åº¦ã¯ä¸‹ãŒã‚‹)

```ts
import { z } from "zod";
import { ApiErrorType } from "./api-error-type";
import { ErrorParamKey } from "../../../errors/api-error";

export const errorParamSchema: Record<ApiErrorType, z.ZodTypeAny> = {
  /* â€¦åŒã˜ä¸­èº«â€¦ */
} as const;
```

* ã‚¨ãƒ©ãƒ¼ã¯æ¶ˆãˆã‚‹ãŒ **å„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å…·ä½“å‹ãŒ `ZodTypeAny` ã«æ½°ã‚Œã‚‹**  
* `getErrorMessage` ã§ã® â€œå¿…é ˆï¼ä¸è¦â€ åˆ¤å®šãŒé™çš„ã«åŠ¹ã‹ãªããªã‚‹

---

## æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¸ã®å½±éŸ¿

* `type ErrorParamMap = { [K in keyof typeof errorParamSchema]: â€¦ }`  
  â†’ **ãã®ã¾ã¾å‹•ã**ï¼ˆâ‘ æ¡ˆãªã‚‰å…·ä½“å‹ã‚‚ä¿æŒï¼‰
* `getErrorMessage<T extends ApiErrorType>(â€¦`  
  â†’ **å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åˆ¤å®šãŒç¶™ç¶š**ï¼ˆâ‘ æ¡ˆï¼‰

---

### ã¾ã¨ã‚

| æ›¸ãæ–¹ | å‹å®‰å…¨ | è¨˜è¿°é‡ | isolatedDeclarations |
|--------|--------|--------|----------------------|
| **â‘  å…·ä½“å‹ä»˜ãæ³¨é‡ˆ** (ä¸Šè¨˜ `ErrorParamSchema` æ¡ˆ) | **â—** | â–³ (ã‚­ãƒ¼åˆ—æŒ™ãŒå¿…è¦) | **â— ã‚¯ãƒªã‚¢** |
| â‘¡ Record\<ApiErrorType, any\> æ³¨é‡ˆ | â–³ | â— | â— |

ã€Œ**å‹å®‰å…¨ã‚’ä¿ã¡ã¤ã¤ `--isolatedDeclarations` ã‚‚é€šã™**ã€å ´åˆã¯ **â‘ ** ã‚’æ¡ç”¨ã—ã¦ãã ã•ã„ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/9 17:33:02*

å‹å®‰å…¨ã‚’ä¿ã¡ãªãŒã‚‰ã“ã®ã‚­ãƒ¼åˆ—æŒ™ãŒå¿…è¦ãªã®ã‚’ç°¡ç•¥åŒ–ã—ãŸãã¦ã€ã“ã®ã¨ãã« constã¯ç›¸æ€§ãŒæ‚ªã„ã®ã§ã¯ãªã„ã‹ã¨ãšã£ã¨æ€ã£ã¦ã„ã‚‹ã€‚ãªã®ã§ã€native enumã¨ã‹ã§åˆ¶å¾¡ã—ãŸã‚Šã§ããªã„ã‹ãªï¼Ÿ

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/9 17:33:04*

### â€œã‚­ãƒ¼ã®äºŒé‡åˆ—æŒ™â€ ã‚’ã»ã¼ã‚¼ãƒ­ã«ã™ã‚‹å®Œå…¨ç‰ˆ

> âœ… **å‹å®‰å…¨**  
> âœ… **`--isolatedDeclarations` ã‚’æº€ãŸã™**  
> âœ… **åˆ—æŒ™ãŒå¿…è¦ãªã®ã¯ã€Œãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¿…é ˆã®ã‚¨ãƒ©ãƒ¼ã€ã ã‘**  

---

## 1. ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚’ 1 åº¦ã ã‘å®šç¾©

```ts
// helpers/define-error-param-schema.ts
import { z, type ZodTypeAny } from "zod";
import { ApiErrorType } from "../api-error-type";

/**
 * å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’åˆ—æŒ™ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã ã‘æ¸¡ã›ã°
 * - ä»–ã®ã‚¨ãƒ©ãƒ¼ â†’ z.never()
 * ã‚’è‡ªå‹•ã§åŸ‹ã‚ã¦ãã‚Œã‚‹ã€‚  
 *
 * è¿”ã‚Šå€¤ã®å‹ã¯ **å…¨ ApiErrorType ã‚’ã‚­ãƒ¼ã«æŒã¡ã¤ã¤**
 * ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ‰ç„¡ã‚’é™çš„ã«ä¿æŒã™ã‚‹ã€‚
 */
export function defineErrorParamSchema<
  T extends Partial<Record<ApiErrorType, ZodTypeAny>>,
>(paramRequired: T) {
  // --- ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã§ã€Œz.never() ãƒ†ãƒ¼ãƒ–ãƒ«ã€ã‚’ä½œæˆ -------------
  const base = Object.fromEntries(
    Object.values(ApiErrorType).map((k) => [k, z.never()]),
  ) as Record<ApiErrorType, ZodTypeAny>;

  // --- â€œå¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚ã‚Šâ€ éƒ¨åˆ†ã§ä¸Šæ›¸ã ----------------------
  const merged = { ...base, ...paramRequired };

  /* ----------------------------------------------------------
   * ã“ã“ãŒå‹ã®ã‚­ãƒ¢:
   *   - è¿”ã‚Šå€¤ã¯ â€œå…¨ã‚­ãƒ¼â€ ã‚’æŒã¤ Record
   *   - paramRequired ã«æ›¸ã„ãŸã‚­ãƒ¼ã ã‘å…·ä½“å‹ã«ç½®æ›
   * -------------------------------------------------------- */
  return merged as {
    [K in ApiErrorType]: K extends keyof T ? T[K] : typeof z.never;
  };
}
```

*ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«å¤‰æ•°ã‚‚è¨ˆç®—æ¸ˆã¿ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚‚ç„¡ã„ã®ã§* **`ts(9010)` ã¯å‡ºã¾ã›ã‚“**ã€‚  
`.d.ts` ç”Ÿæˆæ™‚ã‚‚è¿”ã‚Šå€¤å‹ãŒå®Œå…¨ã«æ›¸ã‘ã‚‹ãŸã‚å•é¡Œãªã—ã€‚

---

## 2. å‘¼ã³å‡ºã—å´ã¯ã€Œå¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€ã®ã¿åˆ—æŒ™

```ts
// api-error-type.tsï¼ˆâ€»ä¸€éƒ¨æŠœç²‹ï¼‰
import { z } from "zod";
import { ErrorParamKey } from "../../../errors/api-error";
import { defineErrorParamSchema } from "./helpers/define-error-param-schema";

/** ã“ã“ã§ *å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒã‚ã‚‹* ã‚¨ãƒ©ãƒ¼ã ã‘æ›¸ã‘ã° OK */
export const errorParamSchema = defineErrorParamSchema({
  [ApiErrorType.EmailAlreadyExists]: z.object({
    [ErrorParamKey.Email]: z.string(),
  }),
  // å¿…è¦ãªã‚‰ â†“ ã®ã‚ˆã†ã«ä»–ã‚’è¿½åŠ ã—ã¦ã„ãã ã‘
  // [ApiErrorType.SomethingWrong]: z.object({...}),
});
```

### âœ” ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ãƒã‚§ãƒƒã‚¯ä¾‹

```ts
// OK: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä»˜ã
getErrorMessage(ApiErrorType.EmailAlreadyExists, {
  [ErrorParamKey.Email]: "foo@example.com",
});

// ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼: Email ãŒå¿…é ˆ
getErrorMessage(ApiErrorType.EmailAlreadyExists);

// OK: param ä¸è¦
getErrorMessage(ApiErrorType.NotFound);

// ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼: ä¸è¦ãªã®ã«æ¸¡ã—ã¦ã„ã‚‹
getErrorMessage(ApiErrorType.NotFound, {
  [ErrorParamKey.Email]: "foo@example.com",
});
```

---

## 3. ä»•çµ„ã¿ã®ãƒã‚¤ãƒ³ãƒˆ

| ç›®çš„ | ã©ã†é”æˆã—ã¦ã„ã‚‹ã‹ |
|-----|-------------------|
| **åˆ—æŒ™ã‚’æ¸›ã‚‰ã™** | `defineErrorParamSchema` ã§ *æœªæŒ‡å®šã‚­ãƒ¼ â†’ è‡ªå‹•ã§ `z.never()`* |
| **å‹å®‰å…¨** | è¿”ã‚Šå€¤å‹ã§ã€ŒæŒ‡å®šã‚­ãƒ¼ã¯å…·ä½“å‹ã€ã€Œãã‚Œä»¥å¤–ã¯ `never`ã€ã‚’ä¿æŒ |
| **`--isolatedDeclarations` åˆæ ¼** | å¤‰æ•°ã«è¨ˆç®—æ¸ˆã¿ã‚­ãƒ¼ç„¡ã— & é–¢æ•°è¿”ã‚Šå€¤ã® **æ˜ç¤ºå‹** ãŒã‚ã‚‹ |
| **è¿½åŠ æ¼ã‚Œæ¤œçŸ¥** | å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒç„¡ã„ã‚¨ãƒ©ãƒ¼ã‚’ `paramRequired` ã« â€œã†ã£ã‹ã‚Šæ›¸ã„ãŸï¼æ›¸ã‹ãªã‹ã£ãŸâ€ éš›ã«å‹ãŒåˆã‚ãšãƒ“ãƒ«ãƒ‰å¤±æ•— |

---

### ã¾ã¨ã‚

* **åˆ—æŒ™ã®äºŒé‡ç®¡ç†** ã¯ â€œ0 or 1 å›â€ ã ã‘  
  *ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯å…¨éƒ¨ `z.never()`* ã ã‹ã‚‰ã€  
  **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒè¦ã‚‹ã‚¨ãƒ©ãƒ¼ã‚’è¶³ã™ãŸã³ã« 1 è¡Œè¿½åŠ ã™ã‚‹ã ã‘**  
* `getErrorMessage` ã®å‘¼ã³å‡ºã—å´ã§ã¯ **é™çš„ã«å¿…é ˆ/ä¸è¦ãŒåˆ¤å®š** ã•ã‚Œã‚‹  
* `--isolatedDeclarations` ã‚‚ **ã‚¨ãƒ©ãƒ¼ãªã—ã§å®Œå…¨ã‚¯ãƒªã‚¢**

ã“ã‚Œã§ *enum è¿½åŠ æ¼ã‚Œã®æ¤œå‡º* ã¨ *å‘¼ã³å‡ºã—æ™‚ã®å‹å®‰å…¨* ã‚’ä¸¡ç«‹ã—ã¤ã¤ã€  
ãƒ¡ãƒ³ãƒ†å·¥æ•°ã‚’æœ€å°é™ã«ã§ãã¾ã™ã€‚

---

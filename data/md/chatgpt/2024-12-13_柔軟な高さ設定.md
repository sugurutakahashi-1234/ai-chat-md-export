# æŸ”è»Ÿãªé«˜ã•è¨­å®š

Date: 2024-12-13

---

## ğŸ‘¤ User
*2024-12-13 14:18:24*

ä»Šã ã¨50%ã®é«˜ã•å›ºå®šãªã®ã§ã€æŸ”è»Ÿã«ã—ãŸã„

import 'package:flutter/material.dart';
import 'package:go_router/go_router.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:snpit_guild_app/domain/screen.dart';
import 'package:snpit_guild_app/presentation/pages/explorer_list_page.dart';
import 'package:snpit_guild_app/presentation/providers/show_explorer_list.dart';
import 'package:snpit_guild_app/presentation/providers/show_spot_list.dart';
import 'package:snpit_guild_app/presentation/router/spot_list_router.dart';

class TabPage extends HookConsumerWidget {
  const TabPage({required this.navigationShell, super.key});
  final StatefulNavigationShell navigationShell;

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    ref
      ..listen&lt;bool&gt;(showExplorerListNotifierProvider, (previous, next) {
        if (next) {
          _showExploreListSheet(context, ref);
        }
      })
      ..listen&lt;bool&gt;(showSpotListNotifierProvider, (previous, next) {
        if (next) {
          _showSpotListSheet(context, ref);
        }
      });

    return Scaffold(
      appBar: AppBar(
        leadingWidth: 100,
        leading: Row(
          mainAxisSize: MainAxisSize.min,
          children: [
            IconButton(
              icon: const Icon(Icons.person),
              onPressed: () {
                context.push(Screen.myPage.path);
              },
            ),
            IconButton(
              icon: const Icon(Icons.notifications),
              onPressed: () {
                context.push(Screen.notificationList.path);
              },
            ),
          ],
        ),
        actions: [
          Padding(
            padding: const EdgeInsets.only(right: 16),
            child: InkWell(
              onTap: () {
                context.push(Screen.wallet.path);
              },
              child: const Row(
                children: [
                  Icon(Icons.token, size: 20),
                  SizedBox(width: 4),
                  Text('35.05 STP'), // TODO: ä»®ãƒ‡ãƒ¼ã‚¿
                ],
              ),
            ),
          ),
        ],
      ),
      body: navigationShell,
      bottomNavigationBar: BottomNavigationBar(
        currentIndex: navigationShell.currentIndex,
        onTap: navigationShell.goBranch,
        items: const [
          BottomNavigationBarItem(icon: Icon(Icons.map), label: 'Map'),
          BottomNavigationBarItem(icon: Icon(Icons.group), label: 'Guild'),
        ],
      ),
    );
  }

  void _showExploreListSheet(BuildContext context, WidgetRef ref) {
    showModalBottomSheet&lt;void&gt;(
      context: context,
      isScrollControlled: true,
      builder: (context) {
        return const FractionallySizedBox(
          heightFactor: 0.5,
          child: ClipRRect(
            borderRadius: BorderRadius.vertical(top: Radius.circular(16)),
            child: ExplorerListPage(),
          ),
        );
      },
    ).then((_) {
      ref.read(showExplorerListNotifierProvider.notifier).hide();
    });
  }

  void _showSpotListSheet(BuildContext context, WidgetRef ref) {
    // sheet ãŒç«‹ã¡ä¸ŠãŒã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§æœ€åˆã®ç”»é¢ã«ãƒªã‚»ãƒƒãƒˆã—ãªã„ã¨ã€sheet ã‚’è¡¨ç¤ºã—ãŸã¨ãã«å‰å›é–‰ã˜ãŸç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹
    spotListRouter.go(Screen.spotList.path);

    showModalBottomSheet&lt;void&gt;(
      context: context,
      isScrollControlled: true,
      builder: (context) {
        return FractionallySizedBox(
          heightFactor: 0.5,
          child: ClipRRect(
            borderRadius: const BorderRadius.vertical(top: Radius.circular(16)),
            child: MaterialApp.router(
              routerConfig: spotListRouter,
              debugShowCheckedModeBanner: false,
            ),
          ),
        );
      },
    ).then((_) {
      ref.read(showSpotListNotifierProvider.notifier).hide();
    });
  }
}

---

## ğŸ¤– Assistant
*2024-12-13 14:18:42*

`FractionallySizedBox` ã® `heightFactor` ã‚’å›ºå®šå€¤ (ä¾‹ãˆã° 0.5) ã‹ã‚‰ã€æŸ”è»Ÿã«å¤‰æ›´å¯èƒ½ãªå®Ÿè£…ã«ã™ã‚‹ãŸã‚ã«ã€é–¢æ•°å¼•æ•°ã¨ã—ã¦é«˜ã•ã‚’å—ã‘å–ã‚‹ã‚ˆã†ã«å¤‰æ›´ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¾ã™ã€‚ã¾ãŸã€å„ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚·ãƒ¼ãƒˆã§é«˜ã•ã‚’è¨­å®šã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ä»¥ä¸‹ã¯ä¿®æ­£ç‰ˆã®ã‚³ãƒ¼ãƒ‰ã§ã™ï¼š

```dart
void _showExploreListSheet(BuildContext context, WidgetRef ref, {double? heightFactor}) {
  showModalBottomSheet<void>(
    context: context,
    isScrollControlled: true,
    builder: (context) {
      return FractionallySizedBox(
        heightFactor: heightFactor ?? 0.5, // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ 0.5 ã«è¨­å®š
        child: ClipRRect(
          borderRadius: const BorderRadius.vertical(top: Radius.circular(16)),
          child: const ExplorerListPage(),
        ),
      );
    },
  ).then((_) {
    ref.read(showExplorerListNotifierProvider.notifier).hide();
  });
}

void _showSpotListSheet(BuildContext context, WidgetRef ref, {double? heightFactor}) {
  spotListRouter.go(Screen.spotList.path);

  showModalBottomSheet<void>(
    context: context,
    isScrollControlled: true,
    builder: (context) {
      return FractionallySizedBox(
        heightFactor: heightFactor ?? 0.5, // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ 0.5 ã«è¨­å®š
        child: ClipRRect(
          borderRadius: const BorderRadius.vertical(top: Radius.circular(16)),
          child: MaterialApp.router(
            routerConfig: spotListRouter,
            debugShowCheckedModeBanner: false,
          ),
        ),
      );
    },
  ).then((_) {
    ref.read(showSpotListNotifierProvider.notifier).hide();
  });
}
```

ã¾ãŸã€å‘¼ã³å‡ºã—å…ƒã§é«˜ã•ã‚’æŒ‡å®šã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ï¼š

```dart
ref.listen<bool>(showExplorerListNotifierProvider, (previous, next) {
  if (next) {
    _showExploreListSheet(context, ref, heightFactor: 0.7); // é«˜ã•ã‚’æŸ”è»Ÿã«æŒ‡å®š
  }
});

ref.listen<bool>(showSpotListNotifierProvider, (previous, next) {
  if (next) {
    _showSpotListSheet(context, ref, heightFactor: 0.8); // é«˜ã•ã‚’æŸ”è»Ÿã«æŒ‡å®š
  }
});
```

### ä¿®æ­£ãƒã‚¤ãƒ³ãƒˆ
1. **é«˜ã•ã®æŸ”è»Ÿæ€§**: `heightFactor` ã‚’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦å—ã‘å–ã‚Šã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®šã€‚
2. **å‘¼ã³å‡ºã—å…ƒã®æŸ”è»Ÿæ€§**: å¿…è¦ã«å¿œã˜ã¦ç•°ãªã‚‹é«˜ã•ã‚’æŒ‡å®šå¯èƒ½ã€‚
3. **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š**: æ˜ç¤ºçš„ã«é«˜ã•ã‚’æŒ‡å®šã—ãªã„å ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆ0.5ï¼‰ãŒä½¿ç”¨ã•ã‚Œã‚‹ã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚·ãƒ¼ãƒˆã®é«˜ã•ã‚’æŸ”è»Ÿã«è¨­å®šã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

---

## ğŸ‘¤ User
*2024-12-13 14:20:54*

ãã†ã§ã¯ãªãã¦ã€SwiftUIã®.presentationDetents([
    .medium,
    .large,
])ã®ã‚ˆã†ã«æ­¢ã‚ãŸã„ã€‚

---

## ğŸ¤– Assistant
*2024-12-13 14:21:13*

Flutterã§ã¯ã€SwiftUIã®`.presentationDetents`ã«ç›¸å½“ã™ã‚‹ã‚ˆã†ãªå‹•ä½œã‚’å®Ÿç¾ã™ã‚‹ã«ã¯ã€`showModalBottomSheet`ã®ã‚«ã‚¹ã‚¿ãƒ ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆå†…ã§ãƒ‰ãƒ©ãƒƒã‚°æ“ä½œã«å¿œã˜ã¦é«˜ã•ã‚’èª¿æ•´ã™ã‚‹å®Ÿè£…ãŒå¿…è¦ã§ã™ã€‚

ä»¥ä¸‹ã¯ã€`DraggableScrollableSheet`ã‚’ä½¿ç”¨ã—ã¦ã€SwiftUIã®`.presentationDetents`ã®ã‚ˆã†ãªæŒ™å‹•ã‚’æ¨¡å€£ã™ã‚‹ã‚³ãƒ¼ãƒ‰ä¾‹ã§ã™ã€‚

### æ”¹è‰¯ã‚³ãƒ¼ãƒ‰

```dart
void _showExploreListSheet(BuildContext context, WidgetRef ref) {
  showModalBottomSheet<void>(
    context: context,
    isScrollControlled: true,
    shape: const RoundedRectangleBorder(
      borderRadius: BorderRadius.vertical(top: Radius.circular(16)),
    ),
    builder: (context) {
      return DraggableScrollableSheet(
        initialChildSize: 0.5, // æœ€åˆã®é«˜ã•ï¼ˆ50%ï¼‰
        minChildSize: 0.3, // æœ€å°é«˜ã•ï¼ˆ30%ï¼‰
        maxChildSize: 0.9, // æœ€å¤§é«˜ã•ï¼ˆ90%ï¼‰
        builder: (context, scrollController) {
          return ClipRRect(
            borderRadius: const BorderRadius.vertical(top: Radius.circular(16)),
            child: SingleChildScrollView(
              controller: scrollController,
              child: const ExplorerListPage(),
            ),
          );
        },
      );
    },
  ).then((_) {
    ref.read(showExplorerListNotifierProvider.notifier).hide();
  });
}

void _showSpotListSheet(BuildContext context, WidgetRef ref) {
  spotListRouter.go(Screen.spotList.path);

  showModalBottomSheet<void>(
    context: context,
    isScrollControlled: true,
    shape: const RoundedRectangleBorder(
      borderRadius: BorderRadius.vertical(top: Radius.circular(16)),
    ),
    builder: (context) {
      return DraggableScrollableSheet(
        initialChildSize: 0.5, // æœ€åˆã®é«˜ã•ï¼ˆ50%ï¼‰
        minChildSize: 0.3, // æœ€å°é«˜ã•ï¼ˆ30%ï¼‰
        maxChildSize: 0.9, // æœ€å¤§é«˜ã•ï¼ˆ90%ï¼‰
        builder: (context, scrollController) {
          return ClipRRect(
            borderRadius: const BorderRadius.vertical(top: Radius.circular(16)),
            child: MaterialApp.router(
              routerConfig: spotListRouter,
              debugShowCheckedModeBanner: false,
              builder: (context, child) {
                return SingleChildScrollView(
                  controller: scrollController,
                  child: child,
                );
              },
            ),
          );
        },
      );
    },
  ).then((_) {
    ref.read(showSpotListNotifierProvider.notifier).hide();
  });
}
```

### ä¿®æ­£ãƒã‚¤ãƒ³ãƒˆ
1. **`DraggableScrollableSheet`ã®ä½¿ç”¨**:
   - é«˜ã•ã‚’ãƒ‰ãƒ©ãƒƒã‚°æ“ä½œã§å¤‰æ›´å¯èƒ½ã«ã—ã€`minChildSize`, `initialChildSize`, `maxChildSize`ã§é«˜ã•ã®ç¯„å›²ã‚’æŒ‡å®šã€‚
   
2. **`SingleChildScrollView`ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åˆ¶å¾¡**:
   - `scrollController`ã‚’æ¸¡ã—ã¦ã€ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ãªã‚·ãƒ¼ãƒˆå†…ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’åˆ¶å¾¡ã€‚

3. **ãƒ‡ã‚¶ã‚¤ãƒ³ã®ä¸€è²«æ€§**:
   - ä¸Šéƒ¨ã®è§’ã‚’ä¸¸ã‚ã‚‹ãŸã‚ã«`RoundedRectangleBorder`ã‚’é©ç”¨ã€‚

### å‹•ä½œ
- ã‚·ãƒ¼ãƒˆã‚’ã‚¹ãƒ¯ã‚¤ãƒ—ã§ä¸Šä¸‹ã«å‹•ã‹ã™ã“ã¨ã§é«˜ã•ã‚’å¤‰æ›´å¯èƒ½ã€‚
- æœ€å°ï¼ˆ`minChildSize`ï¼‰ã€åˆæœŸï¼ˆ`initialChildSize`ï¼‰ã€æœ€å¤§ï¼ˆ`maxChildSize`ï¼‰ã®é«˜ã•ã‚’è¨­å®šã€‚
- ä¾‹ãˆã°ã€`0.3`ã¯ç”»é¢å…¨ä½“ã®30%ã‚’è¡¨ã—ã¾ã™ã€‚

ã“ã®å®Ÿè£…ã§ã€SwiftUIã®`.presentationDetents`ã«è¿‘ã„å‹•ä½œãŒFlutterã§å†ç¾ã§ãã¾ã™ã€‚

---

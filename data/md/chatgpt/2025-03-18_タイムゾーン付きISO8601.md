# ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ä»˜ãISO8601

æ—¥ä»˜: 2025-03-18

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/3/18 17:56:48*

ã“ã‚Œã§toJsonã—ãŸã¨ãã«ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ãŒã‚ã‹ã‚‰ãªã‹ã£ãŸ.iso 8601ã®å½¢å¼ã«ãªã‚‹ã‚ˆã†ã«ã—ã¦ã»ã—ã„

import 'package:freezed\_annotation/freezed\_annotation.dart';

part 'encryptable\_location\_data.freezed.dart';
part 'encryptable\_location\_data.g.dart';

@freezed
class EncryptableLocationData with \_$EncryptableLocationData {
  const factory EncryptableLocationData({
    required double latitude,
    required double longitude,
    required DateTime timestamp,
  }) = \_EncryptableLocationData;

  factory EncryptableLocationData.fromJson(Map&lt;String, dynamic&gt; json) =&gt;
      \_$EncryptableLocationDataFromJson(json);
}

---

## ğŸ”§ ãƒ„ãƒ¼ãƒ«
*2025/3/18 17:56:49*

\*\*å½¢å¼ã®çµ±ä¸€\*\*

æ—¥ä»˜ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’ISO 8601å½¢å¼ã§JSONã«å‡ºåŠ›ã™ã‚‹ãŸã‚ã«ã€`freezed`ã‚„`json\_serializable`ã®è¨­å®šã‚’è¦‹ç›´ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã§ã€å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å‹å®£è¨€ã‚’æ›´æ–°ä¸­ã€‚

\*\*ISO 8601å¯¾å¿œã®èª¿æ•´\*\*

UTCæ—¥ä»˜ã®å ´åˆã€`toJson`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ã€ISO 8601å½¢å¼ã§ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’æ­£ç¢ºã«å‡ºåŠ›ã—ã¦ã„ã‚‹ã€‚

\*\*UTCã¨ãƒ­ãƒ¼ã‚«ãƒ«ã®é•ã„ã‚’è¦‹ç›´ã™\*\*

`DateTime.toIso8601String()`ã®æŒ™å‹•ã‚’ç¢ºèªã—ã€UTCæ—¥ä»˜ã«ã¯'Z'ã‚’ã€ãƒ­ãƒ¼ã‚«ãƒ«æ™‚é–“ã«ã¯ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’å«ã‚ãªã„ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/3/18 17:56:48*

Dart ã® `DateTime` å‹ã® `toIso8601String()` ã¯ã€UTC æ™‚é–“ã§ã‚ã‚Œã°æœ«å°¾ã« `Z` ãŒä»˜ãã¾ã™ãŒã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚¿ã‚¤ãƒ ã®å ´åˆã¯ã‚ªãƒ•ã‚»ãƒƒãƒˆãŒå«ã¾ã‚Œã¾ã›ã‚“ã€‚  
ã€Œã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³(ã‚ªãƒ•ã‚»ãƒƒãƒˆ)ãŒã‚ã‹ã‚‹å½¢å¼ã‚’å¸¸ã«ä¿æŒã—ãŸã„ã€ã®ã‹ã€ã€Œå¸¸ã« UTC ã¨ã—ã¦æ‰±ã„ãŸã„(= `Z` ã‚’ã¤ã‘ãŸã„)ã€ã‹ã«ã‚ˆã£ã¦æ›¸ãæ–¹ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚  

---

## 1. å¸¸ã« UTC ã®æ–‡å­—åˆ—ã§å‡ºåŠ›ã—ãŸã„å ´åˆ

`timestamp` ã‚’ UTC ã«å¤‰æ›ã—ãŸã†ãˆã§ ISO8601 æ–‡å­—åˆ—ã«ã™ã‚‹ä¾‹ã§ã™ã€‚  

```dart
import 'package:freezed_annotation/freezed_annotation.dart';

part 'encryptable_location_data.freezed.dart';
part 'encryptable_location_data.g.dart';

@freezed
class EncryptableLocationData with _$EncryptableLocationData {
  const factory EncryptableLocationData({
    required double latitude,
    required double longitude,
    @JsonKey(
      fromJson: DateTime.parse,
      toJson: _dateTimeToIso8601WithZ,
    )
    required DateTime timestamp,
  }) = _EncryptableLocationData;

  factory EncryptableLocationData.fromJson(Map<String, dynamic> json) =>
      _$EncryptableLocationDataFromJson(json);
}

/// UTC ã«å¤‰æ›ã—ã¦ã‹ã‚‰ ISO 8601 å½¢å¼ã¸
String _dateTimeToIso8601WithZ(DateTime dateTime) {
  return dateTime.toUtc().toIso8601String();
}
```

ã“ã®å ´åˆã€`timestamp` ã®å‡ºåŠ›ã¯å¸¸ã« `xxxxxZ` ã®ã‚ˆã†ãªå½¢ (UTC) ã«ãªã‚Šã¾ã™ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ã‚¿ã‚¤ãƒ ã®æƒ…å ±ã¯ç ´æ£„ã•ã‚Œã€UTC ã«æ­£è¦åŒ–ã•ã‚Œã‚‹ç‚¹ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

---

## 2. ãƒ­ãƒ¼ã‚«ãƒ«ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆæƒ…å ±ã‚’å«ã‚ãŸã„å ´åˆ

Dart ã® `DateTime` ã¯å†…éƒ¨çš„ã« UTC ã‹ãƒ­ãƒ¼ã‚«ãƒ«ã®ã©ã¡ã‚‰ã‹ã®ãƒ•ãƒ©ã‚°ã‚’æŒã¡ã€ãƒ­ãƒ¼ã‚«ãƒ«ã®å ´åˆã¯å†…éƒ¨ã§ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’æŒã¤ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ˆã€Œã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³åã€ã§ã¯ãªãã€ã‚ãã¾ã§ãã®æ™‚ç‚¹ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆã®ã¿ãŒåˆ†ã‹ã‚‹ä»•çµ„ã¿ã§ã™ï¼‰ã€‚  
ãã®ãŸã‚ã€ãƒ­ãƒ¼ã‚«ãƒ«ã®ã€Œã‚ªãƒ•ã‚»ãƒƒãƒˆè¾¼ã¿ã®æ–‡å­—åˆ—ã€ã‚’è¡¨ç¾ã—ãŸã„å ´åˆã¯ã€æ‰‹å‹•ã§ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’è¨ˆç®—ã—ã¦æ–‡å­—åˆ—ã‚’çµ„ã¿ç«‹ã¦ã‚‹ãªã©ã®ã‚«ã‚¹ã‚¿ãƒ å®Ÿè£…ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚  

ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ã«æ‹¡å¼µãƒ¡ã‚½ãƒƒãƒ‰ã§ `toLocalIso8601String()` ã‚’ä½œã‚Šã€`timestamp` ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¿ã‚¤ãƒ ã¨ã—ã¦ UTC ã‚ªãƒ•ã‚»ãƒƒãƒˆä»˜ãæ–‡å­—åˆ—ã‚’è¿”ã™ä¾‹ã§ã™ã€‚

```dart
/// ä¾‹: 2025-03-18T11:22:33.444+09:00 ã®ã‚ˆã†ãªæ–‡å­—åˆ—ã‚’å¾—ã‚‹
extension DateTimeIso8601WithOffset on DateTime {
  String toLocalIso8601String() {
    final duration = timeZoneOffset;
    final hoursStr = duration.inHours.abs().toString().padLeft(2, '0');
    final minutes = (duration.inMinutes.abs() % 60).toString().padLeft(2, '0');
    final sign = duration.inHours >= 0 ? '+' : '-';

    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¿ã‚¤ãƒ ã§ã® "yyyy-MM-ddTHH:mm:ss.SSS"
    final base = this.toLocal().toIso8601String();
    // ã‚‚ã—æœ«å°¾ã«ZãŒä»˜ã„ã¦ã„ãŸã‚‰å‰Šé™¤ã—ã¦ãŠã (ãƒ­ãƒ¼ã‚«ãƒ«ãªã®ã§)
    final trimmed = base.endsWith('Z') ? base.substring(0, base.length - 1) : base;

    return '$trimmed$sign$hoursStr:$minutes';
  }
}
```

ãã—ã¦ `toJson` æ™‚ã«ã“ã®æ‹¡å¼µãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã£ã¦æ–‡å­—åˆ—åŒ–ã™ã‚‹ã‚ˆã†æŒ‡å®šã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ï¼š

```dart
import 'package:freezed_annotation/freezed_annotation.dart';

part 'encryptable_location_data.freezed.dart';
part 'encryptable_location_data.g.dart';

@freezed
class EncryptableLocationData with _$EncryptableLocationData {
  const factory EncryptableLocationData({
    required double latitude,
    required double longitude,
    @JsonKey(
      fromJson: DateTime.parse,
      toJson: _dateTimeToLocalIso8601String,
    )
    required DateTime timestamp,
  }) = _EncryptableLocationData;

  factory EncryptableLocationData.fromJson(Map<String, dynamic> json) =>
      _$EncryptableLocationDataFromJson(json);
}

String _dateTimeToLocalIso8601String(DateTime dateTime) {
  return dateTime.toLocalIso8601String();
}
```

ã“ã®å®Ÿè£…ã§ã¯ã€`toJson` ã™ã‚‹éš›ã« `2025-03-18T11:22:33.444+09:00` ã®ã‚ˆã†ãªã€ŒUTC ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’å«ã‚“ã ã€æ–‡å­—åˆ—ã§å‡ºåŠ›ã•ã‚Œã¾ã™ã€‚ãŸã ã—ã€ã“ã®ã‚„ã‚Šæ–¹ã§ã¯ä»»æ„ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³(ã‚µãƒãƒ¼ã‚¿ã‚¤ãƒ ãªã©)ã‚’åŒºåˆ¥ã—ã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªãã€Œç«¯æœ«ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚ªãƒ•ã‚»ãƒƒãƒˆã€ã‚’ä»˜ä¸ã—ã¦ã„ã‚‹ã ã‘ã§ã™ã€‚

---

## ã¾ã¨ã‚

- **UTC æ™‚é–“ (æœ«å°¾ã« `Z`) ã§å‡ºåŠ›ã—ãŸã„**  
  â†’  `dateTime.toUtc().toIso8601String()` ã‚’ä½¿ã†  

- **ãƒ­ãƒ¼ã‚«ãƒ«ã‚¿ã‚¤ãƒ ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆ (`+09:00` ãªã©) ã‚’å«ã‚ãŸ ISO8601 å½¢å¼ã§å‡ºåŠ›ã—ãŸã„**  
  â†’ æ‹¡å¼µãƒ¡ã‚½ãƒƒãƒ‰ãªã©ã§ã‚ªãƒ•ã‚»ãƒƒãƒˆä»˜ãæ–‡å­—åˆ—ã‚’è‡ªå‰å®Ÿè£…ã—ã€`toJson` ã§ãã‚Œã‚’è¿”ã™  

ä»¥ä¸Šã®ã‚ˆã†ã«ã€è¦ä»¶ã«åˆã‚ã›ã¦ `@JsonKey` ã® `toJson` ã‚’å·¥å¤«ã™ã‚Œã° ISO 8601 å½¢å¼ã®æ–‡å­—åˆ— (UTC or ã‚ªãƒ•ã‚»ãƒƒãƒˆä»˜ã) ã‚’æŒ‡å®šã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/3/18 17:59:36*

ã‚‚ã£ã¨ä¸€èˆ¬çš„ã«freezedã‚’ä½¿ã£ãŸå ´åˆã®DateTimeã‚’æ¨™æº–ã®ã‚‚ã®ã«å¤‰æ›ã§ããªã„ã®ã‹?

---

## ğŸ”§ ãƒ„ãƒ¼ãƒ«
*2025/3/18 17:59:37*

\*\*å¤‰æ›ã®æ¢æ±‚\*\*

`DateTime`ã‚’æ¨™æº–å½¢å¼ã«å¤‰æ›ã™ã‚‹æ–¹æ³•ã‚’æ¢ã£ã¦ã„ã‚‹ã€‚`DateTime`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ISO8601å½¢å¼ã§ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã™ã‚‹æ–¹æ³•ã‚’è¦‹ã¤ã‘ãŸã„ã€‚ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚³ãƒ³ãƒãƒ¼ã‚¿ãƒ¼ã‚„ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒãƒ¼ã‚¿ãƒ¼ã‚¯ãƒ©ã‚¹ã®åˆ©ç”¨ã‚’æ¤œè¨ã—ã¦ã„ã‚‹ã€‚

\*\*å¤‰æ›è€…ã®è¨­å®š\*\*

`DateTime`ã‚’ISO8601å½¢å¼ã§è¡¨ç¾ã™ã‚‹ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒãƒ¼ã‚¿ãƒ¼ã‚’å®šç¾©ã—ã€ã“ã‚Œã‚’`Freezed`ã‚¯ãƒ©ã‚¹ã®ãƒ•ã‚£

---

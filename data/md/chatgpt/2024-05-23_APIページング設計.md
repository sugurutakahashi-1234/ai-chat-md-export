# APIãƒšãƒ¼ã‚¸ãƒ³ã‚°è¨­è¨ˆ

Date: 2024-05-23

---

## ğŸ‘¤ User
*2024-05-23 14:22:37*

APIè¨­è¨ˆã‚’ã—ãŸã„ã€‚
ä¸€åº¦ã«å…¨éƒ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã¨ãƒ‡ãƒ¼ã‚¿é‡ãŒå¤šã„ã®ã§è¤‡æ•°å›ã«åˆ†ã‘ã¦å–å¾—ã—ãŸã„ã€‚
ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã®ä¸‹ã«ã²ã£ã±ãŸã‚‰è¿½åŠ ã§ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã—ã¦è¿½åŠ ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã‚ã‚‹ã€‚

---

## ğŸ¤– Assistant
*2024-05-23 14:23:09*

è¤‡æ•°å›ã«åˆ†ã‘ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹APIè¨­è¨ˆã®æ–¹æ³•ã¨ã—ã¦ã€ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒä¸€èˆ¬çš„ã§ã™ã€‚ä»¥ä¸‹ã«ã€ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã‚’ä½¿ç”¨ã—ãŸAPIè¨­è¨ˆã®ä¾‹ã‚’ç¤ºã—ã¾ã™ã€‚

### API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¨­è¨ˆ

#### 1. ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

```http
GET /api/items?page=1&limit=20
```

- `page`: ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ç•ªå·ã‚’æŒ‡å®šã—ã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯1ã§ã™ã€‚
- `limit`: 1ãƒšãƒ¼ã‚¸ã‚ãŸã‚Šã®ã‚¢ã‚¤ãƒ†ãƒ æ•°ã‚’æŒ‡å®šã—ã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯20ã§ã™ã€‚

#### 2. ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼

```json
{
  "page": 1,
  "limit": 20,
  "totalItems": 100,
  "totalPages": 5,
  "items": [
    {
      "id": 1,
      "name": "Item 1",
      "description": "Description of Item 1"
    },
    {
      "id": 2,
      "name": "Item 2",
      "description": "Description of Item 2"
    }
    // ä»–ã®ã‚¢ã‚¤ãƒ†ãƒ 
  ]
}
```

- `page`: ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ç•ªå·
- `limit`: 1ãƒšãƒ¼ã‚¸ã‚ãŸã‚Šã®ã‚¢ã‚¤ãƒ†ãƒ æ•°
- `totalItems`: å…¨ä½“ã®ã‚¢ã‚¤ãƒ†ãƒ æ•°
- `totalPages`: å…¨ä½“ã®ãƒšãƒ¼ã‚¸æ•°
- `items`: ã‚¢ã‚¤ãƒ†ãƒ ã®ãƒªã‚¹ãƒˆ

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…

#### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒª

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹éš›ã«ã€ã‚ªãƒ•ã‚»ãƒƒãƒˆã¨ãƒªãƒŸãƒƒãƒˆã‚’ä½¿ç”¨ã—ã¦ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã‚’è¡Œã„ã¾ã™ã€‚

```sql
SELECT * FROM items LIMIT 20 OFFSET 0; -- 1ãƒšãƒ¼ã‚¸ç›®
SELECT * FROM items LIMIT 20 OFFSET 20; -- 2ãƒšãƒ¼ã‚¸ç›®
```

#### 2. ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼

```python
from flask import Flask, request, jsonify

app = Flask(__name__)

@app.route('/api/items', methods=['GET'])
def get_items():
    page = int(request.args.get('page', 1))
    limit = int(request.args.get('limit', 20))
    offset = (page - 1) * limit
    
    # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã®å®Ÿè¡Œï¼ˆä»®æƒ³ï¼‰
    items = query_database(limit=limit, offset=offset)
    total_items = count_total_items()  # å…¨ä½“ã®ã‚¢ã‚¤ãƒ†ãƒ æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ

    response = {
        "page": page,
        "limit": limit,
        "totalItems": total_items,
        "totalPages": (total_items + limit - 1) // limit,  # å…¨ä½“ã®ãƒšãƒ¼ã‚¸æ•°ã‚’è¨ˆç®—
        "items": items
    }
    
    return jsonify(response)

def query_database(limit, offset):
    # ã“ã“ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã—ã€ã‚¢ã‚¤ãƒ†ãƒ ãƒªã‚¹ãƒˆã‚’å–å¾—
    return [
        {"id": 1, "name": "Item 1", "description": "Description of Item 1"},
        # ä»–ã®ã‚¢ã‚¤ãƒ†ãƒ 
    ]

def count_total_items():
    # ã“ã“ã§å…¨ä½“ã®ã‚¢ã‚¤ãƒ†ãƒ æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
    return 100

if __name__ == '__main__':
    app.run(debug=True)
```

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®å®Ÿè£…

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ï¼ˆãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªï¼‰ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ãŸã¨ãã«æ¬¡ã®ãƒšãƒ¼ã‚¸ã‚’å–å¾—ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ ã—ã¾ã™ã€‚SwiftUIã§ã®ç°¡å˜ãªä¾‹ã‚’ç¤ºã—ã¾ã™ã€‚

```swift
import SwiftUI

struct ContentView: View {
    @State private var items: [Item] = []
    @State private var currentPage = 1
    @State private var isLoading = false

    var body: some View {
        List {
            ForEach(items) { item in
                Text(item.name)
            }
            if isLoading {
                ProgressView()
                    .onAppear(perform: loadMore)
            }
        }
        .onAppear(perform: loadMore)
    }

    func loadMore() {
        guard !isLoading else { return }
        isLoading = true
        let url = URL(string: "https://example.com/api/items?page=\(currentPage)&limit=20")!
        URLSession.shared.dataTask(with: url) { data, response, error in
            guard let data = data else { return }
            let response = try! JSONDecoder().decode(APIResponse.self, from: data)
            DispatchQueue.main.async {
                self.items.append(contentsOf: response.items)
                self.currentPage += 1
                self.isLoading = false
            }
        }.resume()
    }
}

struct Item: Identifiable, Decodable {
    let id: Int
    let name: String
    let description: String
}

struct APIResponse: Decodable {
    let page: Int
    let limit: Int
    let totalItems: Int
    let totalPages: Int
    let items: [Item]
}
```

ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒªã‚¹ãƒˆã‚’ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹ã¨ãã«è¿½åŠ ã®ãƒ‡ãƒ¼ã‚¿ãŒãƒ­ãƒ¼ãƒ‰ã•ã‚Œã€åŠ¹ç‡çš„ã«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã¾ã™ã€‚

---

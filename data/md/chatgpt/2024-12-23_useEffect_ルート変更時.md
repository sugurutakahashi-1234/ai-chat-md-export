# useEffect „É´„Éº„ÉàÂ§âÊõ¥ÊôÇ

Date: 2024-12-23

---

## üë§ User
*2024-12-23 20:48:03*

„Åì„ÅÆÁîªÈù¢„Åßpop„Å†„Å£„Åü„Çä„ÄÅË®™„Çå„Çã„Åü„Å≥„Å´useEffect„ÅÆÂá¶ÁêÜ„ÇíË°å„ÅÑ„Åü„ÅÑ

import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:go_router/go_router.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:snpit_guild_app/domain/screen.dart';
import 'package:snpit_guild_app/gen/assets.gen.dart';
import 'package:snpit_guild_app/presentation/design_token/color_token.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/guilds/get_guild_info.dart';

class GuildPage extends HookConsumerWidget {
  const GuildPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    useEffect(
      () {
        Future.microtask(() {
          ref.read(getGuildInfoNotifierProvider.notifier).executeRequest();
        });
        return null;
      },
      [],
    );

    final guildInfoAsync = ref.watch(getGuildInfoNotifierProvider);

    return Scaffold(
      body: guildInfoAsync.when(
        data: (guildInfo) {
          if (guildInfo != null) {
            return Center(
              child: Text('Guild Info: $guildInfo'),
            );
          } else {
            return const Padding(
              padding: EdgeInsets.symmetric(horizontal: 16),
              child: SingleChildScrollView(
                child: _NoGuildWidget(),
              ),
            );
          }
        },
        loading: () =&gt; const Center(child: CircularProgressIndicator()),
        error: (error, stackTrace) {
          WidgetsBinding.instance.addPostFrameCallback((_) {
            ScaffoldMessenger.of(context).showSnackBar(
              SnackBar(content: Text('Error: $error')),
            );
          });
          return Center(child: Text('An error occurred: $error'));
        },
      ),
    );
  }
}

class _NoGuildWidget extends StatelessWidget {
  const _NoGuildWidget();

  @override
  Widget build(BuildContext context) {
    return Column(
      children: [
        const SizedBox(height: 48),
        const Text(
          'No guild affiliation',
          style: TextStyle(
            fontSize: 28,
            fontWeight: FontWeight.bold,
          ),
          textAlign: TextAlign.center,
        ),
        const SizedBox(height: 20),
        const Text(
          'Join a guild or create a new one!',
          style: TextStyle(fontSize: 16),
          textAlign: TextAlign.center,
        ),
        const SizedBox(height: 56),
        Container(
          decoration: BoxDecoration(
            borderRadius: BorderRadius.circular(8),
            border: Border.all(color: ColorToken.secondary),
          ),
          padding: const EdgeInsets.all(24),
          child: Column(
            children: [
              Image.asset(
                // TODO: ÁîªÂÉè„ÇíÂ∑Æ„ÅóÊõø„Åà„Çã
                Assets.images.animalsLogin.path,
                width: 213,
                height: 70,
              ),
              const SizedBox(height: 24),
              ElevatedButton(
                onPressed: () {
                  context.push(Screen.guildCode.path);
                },
                child: const Stack(
                  alignment: Alignment.center,
                  children: [
                    Center(
                      child: Text(
                        'Join an existing guild',
                      ),
                    ),
                    Positioned(
                      right: 0,
                      child: Icon(
                        Icons.arrow_forward,
                        size: 24,
                        color: ColorToken.text,
                      ),
                    ),
                  ],
                ),
              ),
            ],
          ),
        ),
        const SizedBox(height: 16),
        Container(
          decoration: BoxDecoration(
            borderRadius: BorderRadius.circular(8),
            border: Border.all(color: ColorToken.secondary),
          ),
          padding: const EdgeInsets.all(24),
          child: Column(
            children: [
              Image.asset(
                // TODO: ÁîªÂÉè„ÇíÂ∑Æ„ÅóÊõø„Åà„Çã
                Assets.images.animalsLogin.path,
                width: 213,
                height: 70,
              ),
              const SizedBox(height: 24),
              ElevatedButton(
                onPressed: () {
                  context.push(Screen.guildCreate.path);
                },
                child: const Stack(
                  alignment: Alignment.center,
                  children: [
                    Center(
                      child: Text('Host a new guild'),
                    ),
                    Positioned(
                      right: 0,
                      child: Icon(
                        Icons.arrow_forward,
                        size: 24,
                        color: ColorToken.text,
                      ),
                    ),
                  ],
                ),
              ),
            ],
          ),
        ),
        const SizedBox(height: 48),
      ],
    );
  }
}

---

## ü§ñ Assistant
*2024-12-23 20:48:48*

Ë®™„Çå„Çã„Åü„Å≥„Å´ `useEffect` „ÅÆÂá¶ÁêÜ„ÇíË°å„ÅÜ„Å´„ÅØ„ÄÅÁîªÈù¢„ÅåË°®Á§∫„Åï„Çå„Çã„Åü„Å≥„Å´ÂÆüË°å„Åô„Çã‰ªïÁµÑ„Åø„Çí‰Ωú„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ„Åì„ÅÆÂ†¥Âêà„ÄÅ`GoRouter` „ÅÆ„É™„Çπ„Éä„Éº„ÇÑ„Éö„Éº„Ç∏„Çπ„Çø„ÉÉ„ÇØ„ÅÆÁÆ°ÁêÜ„ÇíÊ¥ªÁî®„Åó„Å¶„ÄÅ„Éö„Éº„Ç∏„Åå `pop` „Åï„Çå„Åü„Çä„ÄÅÂÜçË®™Âïè„Åï„Çå„Åü„Çø„Ç§„Éü„É≥„Ç∞„Åß `useEffect` „Çí„Éà„É™„Ç¨„Éº„Åô„ÇãÊñπÊ≥ï„ÅåËÄÉ„Åà„Çâ„Çå„Åæ„Åô„ÄÇ

‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å´ÂÆüË£Ö„Åß„Åç„Åæ„ÅôÔºö

### Â§âÊõ¥ÁÇπ

1. **`useEffect` „ÅÆ‰æùÂ≠òÈñ¢‰øÇ„ÇíÁÆ°ÁêÜ**: ‰æùÂ≠òÈñ¢‰øÇ„Å´ `GoRouter` „ÅÆ„É™„Çπ„Éä„Éº„ÇíËøΩÂä†„Åó„Å¶„ÄÅÁîªÈù¢„ÅåÂÜçË®™Âïè„Åï„Çå„ÅüÈöõ„Å´Âá¶ÁêÜ„ÇíÂÜçÂÆüË°å„Åô„Çã„Çà„ÅÜ„Å´Ë®≠ÂÆö„Åó„Åæ„Åô„ÄÇ
2. **`GoRouter` „ÅÆ„É™„Çπ„Éä„Éº„Çí‰ΩøÁî®**: ÁèæÂú®„ÅÆ„É´„Éº„Éà„Åå„Åì„ÅÆ„Éö„Éº„Ç∏„Å´‰∏ÄËá¥„Åó„ÅüÈöõ„Å´ `useEffect` „Çí„Éà„É™„Ç¨„Éº„Åó„Åæ„Åô„ÄÇ

‰ª•‰∏ã„ÅØ‰øÆÊ≠£Âæå„ÅÆ„Ç≥„Éº„Éâ‰æã„Åß„ÅôÔºö

```dart
import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:go_router/go_router.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:snpit_guild_app/domain/screen.dart';
import 'package:snpit_guild_app/gen/assets.gen.dart';
import 'package:snpit_guild_app/presentation/design_token/color_token.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/guilds/get_guild_info.dart';

class GuildPage extends HookConsumerWidget {
  const GuildPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final goRouter = GoRouter.of(context);

    useEffect(
      () {
        void handleRouteChange() {
          if (goRouter.location == Screen.guild.path) {
            // „Éö„Éº„Ç∏„ÅåË®™Âïè„Åï„Çå„Çã„Åü„Å≥„Å´ÂÜçÂÆüË°å
            ref.read(getGuildInfoNotifierProvider.notifier).executeRequest();
          }
        }

        // ÂàùÂõûÂÆüË°å
        handleRouteChange();

        // GoRouter „ÅÆ„É™„Çπ„Éä„Éº„ÇíËøΩÂä†
        goRouter.addListener(handleRouteChange);

        // „ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó: „É™„Çπ„Éä„Éº„ÇíÂâäÈô§
        return () => goRouter.removeListener(handleRouteChange);
      },
      [goRouter.location], // ÁèæÂú®„ÅÆ„É´„Éº„Éà„ÅåÂ§âÊõ¥„Åï„Çå„Åü„Å®„Åç„Å´ÂÜçÂÆüË°å
    );

    final guildInfoAsync = ref.watch(getGuildInfoNotifierProvider);

    return Scaffold(
      body: guildInfoAsync.when(
        data: (guildInfo) {
          if (guildInfo != null) {
            return Center(
              child: Text('Guild Info: $guildInfo'),
            );
          } else {
            return const Padding(
              padding: EdgeInsets.symmetric(horizontal: 16),
              child: SingleChildScrollView(
                child: _NoGuildWidget(),
              ),
            );
          }
        },
        loading: () => const Center(child: CircularProgressIndicator()),
        error: (error, stackTrace) {
          WidgetsBinding.instance.addPostFrameCallback((_) {
            ScaffoldMessenger.of(context).showSnackBar(
              SnackBar(content: Text('Error: $error')),
            );
          });
          return Center(child: Text('An error occurred: $error'));
        },
      ),
    );
  }
}

class _NoGuildWidget extends StatelessWidget {
  const _NoGuildWidget();

  @override
  Widget build(BuildContext context) {
    return Column(
      children: [
        const SizedBox(height: 48),
        const Text(
          'No guild affiliation',
          style: TextStyle(
            fontSize: 28,
            fontWeight: FontWeight.bold,
          ),
          textAlign: TextAlign.center,
        ),
        const SizedBox(height: 20),
        const Text(
          'Join a guild or create a new one!',
          style: TextStyle(fontSize: 16),
          textAlign: TextAlign.center,
        ),
        const SizedBox(height: 56),
        Container(
          decoration: BoxDecoration(
            borderRadius: BorderRadius.circular(8),
            border: Border.all(color: ColorToken.secondary),
          ),
          padding: const EdgeInsets.all(24),
          child: Column(
            children: [
              Image.asset(
                // TODO: ÁîªÂÉè„ÇíÂ∑Æ„ÅóÊõø„Åà„Çã
                Assets.images.animalsLogin.path,
                width: 213,
                height: 70,
              ),
              const SizedBox(height: 24),
              ElevatedButton(
                onPressed: () {
                  context.push(Screen.guildCode.path);
                },
                child: const Stack(
                  alignment: Alignment.center,
                  children: [
                    Center(
                      child: Text(
                        'Join an existing guild',
                      ),
                    ),
                    Positioned(
                      right: 0,
                      child: Icon(
                        Icons.arrow_forward,
                        size: 24,
                        color: ColorToken.text,
                      ),
                    ),
                  ],
                ),
              ),
            ],
          ),
        ),
        const SizedBox(height: 16),
        Container(
          decoration: BoxDecoration(
            borderRadius: BorderRadius.circular(8),
            border: Border.all(color: ColorToken.secondary),
          ),
          padding: const EdgeInsets.all(24),
          child: Column(
            children: [
              Image.asset(
                // TODO: ÁîªÂÉè„ÇíÂ∑Æ„ÅóÊõø„Åà„Çã
                Assets.images.animalsLogin.path,
                width: 213,
                height: 70,
              ),
              const SizedBox(height: 24),
              ElevatedButton(
                onPressed: () {
                  context.push(Screen.guildCreate.path);
                },
                child: const Stack(
                  alignment: Alignment.center,
                  children: [
                    Center(
                      child: Text('Host a new guild'),
                    ),
                    Positioned(
                      right: 0,
                      child: Icon(
                        Icons.arrow_forward,
                        size: 24,
                        color: ColorToken.text,
                      ),
                    ),
                  ],
                ),
              ),
            ],
          ),
        ),
        const SizedBox(height: 48),
      ],
    );
  }
}
```

### „Åì„ÅÆ‰øÆÊ≠£„ÅÆ„Éù„Ç§„É≥„Éà
1. **`useEffect` ÂÜÖ„Åß GoRouter „ÅÆ„É™„Çπ„Éä„Éº„ÇíËøΩÂä†**:
   - „É´„Éº„Éà„ÅåÂ§âÊõ¥„Åï„Çå„Çã„Åü„Å≥„Å´Âá¶ÁêÜ„ÇíÁ¢∫Ë™ç„Åó„ÄÅÂøÖË¶Å„Å´Âøú„Åò„Å¶ÂÜçÂÆüË°å„ÄÇ
2. **`goRouter.location` „Çí‰æùÂ≠òÈñ¢‰øÇ„Å´ËøΩÂä†**:
   - „É´„Éº„ÉàÂ§âÊõ¥ÊôÇ„Å´„É™„Çπ„Éä„Éº„Çí„Éà„É™„Ç¨„Éº„ÄÇ

„Åì„Çå„Åß `GuildPage` „Å´Ë®™„Çå„Çã„Åü„Å≥„Å´ `useEffect` „ÅåÊ≠£„Åó„ÅèÂãï‰Ωú„Åó„Åæ„Åô„ÄÇ

---

## üë§ User
*2024-12-23 20:49:27*

goRouter „Å´ location „ÇÇaddListener „ÇÇ„Å™„ÅÑ„Éª„ÄÇ

---

## ü§ñ Assistant
*2024-12-23 20:50:04*

`GoRouter` „Å´Áõ¥Êé• `location` „ÇÑ `addListener` „Åå„Å™„ÅÑÂ†¥Âêà„ÅØ„ÄÅFlutter Hooks „ÇíÊ¥ªÁî®„Åó„Å¶ÁîªÈù¢ÈÅ∑Áßª„ÇÑ„É™„Éì„Ç∏„ÉÉ„ÉàÊôÇ„ÅÆÂá¶ÁêÜ„ÇíÁÆ°ÁêÜ„Åô„ÇãÊñπÊ≥ï„Å´Â§âÊõ¥„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ

‰ª•‰∏ã„ÅØ `NavigatorObserver` „Çí‰ΩøÁî®„Åó„ÄÅÁîªÈù¢„ÅÆË®™Âïè„ÇíÊ§úÁü•„Åó„Å¶ `useEffect` „ÅÆÂá¶ÁêÜ„ÇíË°å„ÅÜÊñπÊ≥ï„Åß„Åô„ÄÇ

---

### ‰øÆÊ≠£Âæå„ÅÆ„Ç≥„Éº„Éâ

```dart
import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:go_router/go_router.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:snpit_guild_app/domain/screen.dart';
import 'package:snpit_guild_app/gen/assets.gen.dart';
import 'package:snpit_guild_app/presentation/design_token/color_token.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/guilds/get_guild_info.dart';

class GuildPage extends HookConsumerWidget {
  const GuildPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final navigatorObserver = useMemoized(() => _GuildNavigatorObserver(onVisit: () {
          ref.read(getGuildInfoNotifierProvider.notifier).executeRequest();
        }));

    // ÂàùÂõûÂÆüË°å
    useEffect(() {
      Future.microtask(() {
        ref.read(getGuildInfoNotifierProvider.notifier).executeRequest();
      });
      return null;
    }, []);

    final guildInfoAsync = ref.watch(getGuildInfoNotifierProvider);

    return Navigator(
      observers: [navigatorObserver],
      onGenerateRoute: (settings) => MaterialPageRoute(
        builder: (context) => Scaffold(
          body: guildInfoAsync.when(
            data: (guildInfo) {
              if (guildInfo != null) {
                return Center(
                  child: Text('Guild Info: $guildInfo'),
                );
              } else {
                return const Padding(
                  padding: EdgeInsets.symmetric(horizontal: 16),
                  child: SingleChildScrollView(
                    child: _NoGuildWidget(),
                  ),
                );
              }
            },
            loading: () => const Center(child: CircularProgressIndicator()),
            error: (error, stackTrace) {
              WidgetsBinding.instance.addPostFrameCallback((_) {
                ScaffoldMessenger.of(context).showSnackBar(
                  SnackBar(content: Text('Error: $error')),
                );
              });
              return Center(child: Text('An error occurred: $error'));
            },
          ),
        ),
      ),
    );
  }
}

class _GuildNavigatorObserver extends NavigatorObserver {
  final VoidCallback onVisit;

  _GuildNavigatorObserver({required this.onVisit});

  @override
  void didPush(Route<dynamic> route, Route<dynamic>? previousRoute) {
    super.didPush(route, previousRoute);
    onVisit();
  }

  @override
  void didPop(Route<dynamic> route, Route<dynamic>? previousRoute) {
    super.didPop(route, previousRoute);
    onVisit();
  }
}

class _NoGuildWidget extends StatelessWidget {
  const _NoGuildWidget();

  @override
  Widget build(BuildContext context) {
    return Column(
      children: [
        const SizedBox(height: 48),
        const Text(
          'No guild affiliation',
          style: TextStyle(
            fontSize: 28,
            fontWeight: FontWeight.bold,
          ),
          textAlign: TextAlign.center,
        ),
        const SizedBox(height: 20),
        const Text(
          'Join a guild or create a new one!',
          style: TextStyle(fontSize: 16),
          textAlign: TextAlign.center,
        ),
        const SizedBox(height: 56),
        Container(
          decoration: BoxDecoration(
            borderRadius: BorderRadius.circular(8),
            border: Border.all(color: ColorToken.secondary),
          ),
          padding: const EdgeInsets.all(24),
          child: Column(
            children: [
              Image.asset(
                // TODO: ÁîªÂÉè„ÇíÂ∑Æ„ÅóÊõø„Åà„Çã
                Assets.images.animalsLogin.path,
                width: 213,
                height: 70,
              ),
              const SizedBox(height: 24),
              ElevatedButton(
                onPressed: () {
                  context.push(Screen.guildCode.path);
                },
                child: const Stack(
                  alignment: Alignment.center,
                  children: [
                    Center(
                      child: Text(
                        'Join an existing guild',
                      ),
                    ),
                    Positioned(
                      right: 0,
                      child: Icon(
                        Icons.arrow_forward,
                        size: 24,
                        color: ColorToken.text,
                      ),
                    ),
                  ],
                ),
              ),
            ],
          ),
        ),
        const SizedBox(height: 16),
        Container(
          decoration: BoxDecoration(
            borderRadius: BorderRadius.circular(8),
            border: Border.all(color: ColorToken.secondary),
          ),
          padding: const EdgeInsets.all(24),
          child: Column(
            children: [
              Image.asset(
                // TODO: ÁîªÂÉè„ÇíÂ∑Æ„ÅóÊõø„Åà„Çã
                Assets.images.animalsLogin.path,
                width: 213,
                height: 70,
              ),
              const SizedBox(height: 24),
              ElevatedButton(
                onPressed: () {
                  context.push(Screen.guildCreate.path);
                },
                child: const Stack(
                  alignment: Alignment.center,
                  children: [
                    Center(
                      child: Text('Host a new guild'),
                    ),
                    Positioned(
                      right: 0,
                      child: Icon(
                        Icons.arrow_forward,
                        size: 24,
                        color: ColorToken.text,
                      ),
                    ),
                  ],
                ),
              ),
            ],
          ),
        ),
        const SizedBox(height: 48),
      ],
    );
  }
}
```

---

### ‰øÆÊ≠£„Éù„Ç§„É≥„Éà

1. **`NavigatorObserver` „ÇíÊ¥ªÁî®**: 
   - `NavigatorObserver` „Çí„Ç´„Çπ„Çø„Éû„Ç§„Ç∫„Åó„ÄÅ`didPush` „ÇÑ `didPop` „Ç§„Éô„É≥„Éà„Åß„Éö„Éº„Ç∏„ÅÆË®™Âïè„ÇíÊ§úÁü•„ÄÇ
2. **`useMemoized` „Å®„Åó„Å¶„É™„Çπ„Éä„Éº„ÇíÁÆ°ÁêÜ**:
   - `useEffect` „Å®„É™„Çπ„Éä„Éº„ÇíÁµÑ„ÅøÂêà„Çè„Åõ„Å¶ÂäπÁéáÁöÑ„Å´„É™„ÇΩ„Éº„Çπ„ÇíÁÆ°ÁêÜ„ÄÇ

---

„Åì„ÅÆÊñπÊ≥ï„Åß„ÄÅ`GuildPage` „Å´Êàª„Çã„Åü„Å≥„Å´Âá¶ÁêÜ„ÇíÂÆüË°å„Åô„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åô„ÄÇ

---

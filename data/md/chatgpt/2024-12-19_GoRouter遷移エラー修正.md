# GoRouteré·ç§»ã‚¨ãƒ©ãƒ¼ä¿®æ­£

Date: 2024-12-19

---

## ğŸ‘¤ User
*2024-12-19 16:27:11*

ã“ã®ç”»é¢ã«é·ç§»ã™ã‚‹ã¨ãªãœã‹ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹
@pragma('vm:entry-point')
void _drawFrame() {
  PlatformDispatcher.instance._drawFrame();
}

import 'package:flutter/material.dart';
import 'package:go_router/go_router.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:snpit_guild_app/domain/screen.dart';

class MyPage extends HookConsumerWidget {
  const MyPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final cameraList = List&lt;String&gt;.generate(10, (index) =&gt; 'Camera $index');

    return Scaffold(
      appBar: AppBar(title: const Text('MyPage')),
      body: Center(
        child: Column(
          mainAxisSize: MainAxisSize.min,
          children: [
            ElevatedButton(
              onPressed: () {
                context.push(Screen.profile.path);
              },
              child: const Text('Profile'),
            ),
            Expanded(
              child: ListView.builder(
                shrinkWrap: true,
                itemCount: cameraList.length,
                itemBuilder: (context, index) {
                  return ListTile(
                    title: Text(cameraList[index]),
                    onTap: () {
                      context.push(Screen.deckDetail.path);
                    },
                  );
                },
              ),
            ),
          ],
        ),
      ),
    );
  }
}

---

## ğŸ¤– Assistant
*2024-12-19 16:27:23*

ã“ã®ã‚³ãƒ¼ãƒ‰ã®ã‚¨ãƒ©ãƒ¼åŸå› ã¨ã—ã¦è€ƒãˆã‚‰ã‚Œã‚‹ãƒã‚¤ãƒ³ãƒˆã‚’ã„ãã¤ã‹æŒ™ã’ã¾ã™ã€‚

1. **`context.push`ã§ã®ãƒ‘ã‚¹ä¸ä¸€è‡´**  
   `Screen.profile.path`ã‚„`Screen.deckDetail.path`ãŒé©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚`GoRouter`ã®ãƒ«ãƒ¼ãƒˆè¨­å®šã«ã“ã‚Œã‚‰ã®ãƒ‘ã‚¹ãŒæ­£ã—ãå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚

   ```dart
   final router = GoRouter(
     routes: [
       GoRoute(
         path: '/profile',
         builder: (context, state) => const ProfilePage(),
       ),
       GoRoute(
         path: '/deckDetail',
         builder: (context, state) => const DeckDetailPage(),
       ),
     ],
   );
   ```

2. **`ListView.builder`ã§ã®`Expanded`ã®ä½¿ç”¨**  
   `ListView.builder`ãŒ`Expanded`ã§ãƒ©ãƒƒãƒ—ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€UIã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«å•é¡ŒãŒã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚`Column`å†…ã§`Expanded`ã‚’ä½¿ã†ã¨ã€ä»–ã®è¦ç´ ã¨è¡çªã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

   ```dart
   return Scaffold(
     appBar: AppBar(title: const Text('MyPage')),
     body: Column(
       children: [
         ElevatedButton(
           onPressed: () {
             context.push(Screen.profile.path);
           },
           child: const Text('Profile'),
         ),
         Expanded(
           child: ListView.builder(
             itemCount: cameraList.length,
             itemBuilder: (context, index) {
               return ListTile(
                 title: Text(cameraList[index]),
                 onTap: () {
                   context.push(Screen.deckDetail.path);
                 },
               );
             },
           ),
         ),
       ],
     ),
   );
   ```

3. **GoRouterã®åˆæœŸåŒ–**  
   `GoRouter`ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒé©åˆ‡ã«åˆæœŸåŒ–ã•ã‚Œã¦ã„ãªã„å ´åˆã€é·ç§»æ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚`MaterialApp.router`ã§`routerConfig`ã«`GoRouter`ã‚’æ¸¡ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚

   ```dart
   void main() {
     final router = GoRouter(
       routes: [
         GoRoute(
           path: '/profile',
           builder: (context, state) => const ProfilePage(),
         ),
         GoRoute(
           path: '/deckDetail',
           builder: (context, state) => const DeckDetailPage(),
         ),
       ],
     );

     runApp(ProviderScope(
       child: MaterialApp.router(
         routerConfig: router,
       ),
     ));
   }
   ```

4. **ãƒ—ãƒ©ã‚°ãƒã®å½±éŸ¿**  
   `_drawFrame`ã®è¨˜è¿°ãŒé–¢ä¿‚ã—ã¦ã„ã‚‹å¯èƒ½æ€§ã¯ä½ã„ã§ã™ãŒã€ã‚‚ã—ãã®éƒ¨åˆ†ãŒã‚¨ãƒ©ãƒ¼ã®ãƒˆãƒªã‚¬ãƒ¼ã«ãªã£ã¦ã„ã‚‹å ´åˆã¯ã€ãƒ•ãƒ¬ãƒ¼ãƒ æç”»ãŒFlutterã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã«ä¾å­˜ã—ã¦ã„ã‚‹å¯èƒ½æ€§ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚ã“ã®éƒ¨åˆ†ãŒä¸è¦ã§ã‚ã‚Œã°å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚

ä¸Šè¨˜ã®ä¿®æ­£ã‚’è©¦ã—ãŸå¾Œã‚‚ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å ´åˆã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¨ä½“ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚ãã‚Œã«åŸºã¥ã„ã¦è©³ç´°ãªåŸå› ã‚’ç‰¹å®šã—ã¾ã™ã€‚

---

## ğŸ‘¤ User
*2024-12-19 16:28:08*

{
  "content_type": "image_asset_pointer",
  "asset_pointer": "file-service://file-Xz7nXptAq9Dyf5Zdcb9QG5",
  "size_bytes": 132444,
  "width": 560,
  "height": 759,
  "fovea": null,
  "metadata": {
    "dalle": null,
    "gizmo": null,
    "generation": null,
    "container_pixel_height": null,
    "container_pixel_width": null,
    "emu_omit_glimpse_image": null,
    "emu_patches_override": null,
    "sanitized": true,
    "asset_pointer_link": null,
    "watermarked_asset_pointer": null
  }
}
ã“ã†ã„ã†ã‚¨ãƒ©ãƒ¼ãªã‚“ã 

---

## ğŸ¤– Assistant
*2024-12-19 16:28:36*

ã“ã®ã‚¨ãƒ©ãƒ¼ã«é–¢é€£ã—ã¦ã€ã€ŒHeroã€ã‚„ã€ŒvisitChildrenã€ã¨ã„ã†ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ã€Flutterã®`Hero`ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«é–¢é€£ã—ãŸå•é¡Œã§ã‚ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã§ã™ã€‚å…·ä½“çš„ãªå•é¡Œã¨è§£æ±ºç­–ã‚’ä»¥ä¸‹ã«èª¬æ˜ã—ã¾ã™ã€‚

### å•é¡Œã®å¯èƒ½æ€§
1. **`Hero`ã‚¿ã‚°ã®é‡è¤‡**
   - Flutterã®`Hero`ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã¯ã€`tag`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªå€¤ã‚’å¿…è¦ã¨ã—ã¾ã™ã€‚åŒã˜`tag`ã‚’æŒã¤`Hero`ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒè¤‡æ•°å­˜åœ¨ã™ã‚‹ã¨ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚
   - ä¾‹ãˆã°ã€ç”»é¢é–“ã§é·ç§»ã™ã‚‹ã¨ãã«ã€åŒã˜`tag`ã‚’æŒã¤`Hero`ãŒè¤‡æ•°å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã¨ã€`Hero`ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒæ­£ã—ãå‹•ä½œã›ãšã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

2. **`Hero`ã®ä½¿ã„æ–¹ã®ä¸æ•´åˆ**
   - é·ç§»å…ˆç”»é¢ã§å¯¾å¿œã™ã‚‹`Hero`ãŒå­˜åœ¨ã—ãªã„ã€ã¾ãŸã¯ä¸é©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã‚‚å•é¡ŒãŒç™ºç”Ÿã—ã¾ã™ã€‚

### è§£æ±ºç­–
1. **`Hero`ã‚¿ã‚°ã®ç¢ºèªã¨ä¿®æ­£**
   - ã‚¢ãƒ—ãƒªå†…ã®å…¨ã¦ã®`Hero`ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’ç¢ºèªã—ã€ãã‚Œãã‚Œã®`tag`ãŒãƒ¦ãƒ‹ãƒ¼ã‚¯ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
   - ä¾‹:
     ```dart
     Hero(
       tag: 'uniqueTag1',
       child: Image.asset('image1.png'),
     )
     ```
     é·ç§»å…ˆç”»é¢ã§ã‚‚åŒã˜`tag`ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
     ```dart
     Hero(
       tag: 'uniqueTag1',
       child: Image.asset('image1.png'),
     )
     ```

2. **`Hero`ãŒä¸è¦ã§ã‚ã‚Œã°å‰Šé™¤**
   - ç¾åœ¨ã®ç”»é¢ã‚„é·ç§»å…ˆã§`Hero`ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¿…è¦ãªã„å ´åˆã¯ã€`Hero`ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ã§å•é¡Œã‚’å›é¿ã§ãã¾ã™ã€‚

3. **ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ã•ã‚‰ã«ç¢ºèª**
   - ã‚¨ãƒ©ãƒ¼ã®å®Œå…¨ãªãƒ­ã‚°ã‚’ç¢ºèªã—ã€ã©ã®ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã¾ãŸã¯ã©ã®ç”»é¢ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ã‚‹ã®ã‹ã‚’ç‰¹å®šã—ã¦ãã ã•ã„ã€‚

### ä¿®æ­£ç‰ˆä¾‹
ä»¥ä¸‹ã¯ã€`Hero`ã‚¿ã‚°ãŒãƒ¦ãƒ‹ãƒ¼ã‚¯ã«ãªã‚‹ã‚ˆã†ã«èª¿æ•´ã—ãŸä¾‹ã§ã™ã€‚

```dart
ListView.builder(
  itemCount: cameraList.length,
  itemBuilder: (context, index) {
    return ListTile(
      title: Hero(
        tag: 'cameraHero$index', // å„ã‚«ãƒ¡ãƒ©ã«ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªtagã‚’å‰²ã‚Šå½“ã¦
        child: Text(cameraList[index]),
      ),
      onTap: () {
        context.push(Screen.deckDetail.path);
      },
    );
  },
)
```

é·ç§»å…ˆç”»é¢ã§ã‚‚åŒã˜`tag`ã‚’æŒã¤`Hero`ã‚’å®šç¾©ã—ã¦ãã ã•ã„ã€‚

```dart
class DeckDetailPage extends StatelessWidget {
  final int index;

  const DeckDetailPage({Key? key, required this.index}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('Deck Detail')),
      body: Center(
        child: Hero(
          tag: 'cameraHero$index', // é·ç§»å…ƒã¨åŒã˜tagã‚’ä½¿ç”¨
          child: Text('Detail of Camera $index'),
        ),
      ),
    );
  }
}
```

ã“ã‚Œã§`Hero`ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¨ãƒ©ãƒ¼ãŒè§£æ¶ˆã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚å•é¡ŒãŒç¶šãå ´åˆã¯ã€ã‚¨ãƒ©ãƒ¼ã®è©³ç´°ãƒ­ã‚°ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚

---

## ğŸ‘¤ User
*2024-12-19 16:31:05*

ä»¥ä¸‹ã®ã©ã‚Œã§ã‚‚ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã¿ãŸã„
context.push(Screen.myPage.path);
context.push(Screen.notificationList.path);
context.push(Screen.wallet.path);

import 'package:flutter/material.dart';
import 'package:go_router/go_router.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:snpit_guild_app/domain/screen.dart';
import 'package:snpit_guild_app/presentation/design_token/app_theme.dart';
import 'package:snpit_guild_app/presentation/pages/explorer_list_page.dart';
import 'package:snpit_guild_app/presentation/pages/shootable_spot_detail_page.dart';
import 'package:snpit_guild_app/presentation/providers/show_explorer_list.dart';
import 'package:snpit_guild_app/presentation/providers/show_shootable_spot_detail.dart';
import 'package:snpit_guild_app/presentation/providers/show_spot_list.dart';
import 'package:snpit_guild_app/presentation/router/spot_list_router.dart';

class TabPage extends HookConsumerWidget {
  const TabPage({required this.navigationShell, super.key});
  final StatefulNavigationShell navigationShell;

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    ref
      ..listen&lt;bool&gt;(showShootableSpotDetailNotifierProvider, (previous, next) {
        if (next) {
          _showShootableSpotDetailSheet(context, ref);
        }
      })
      ..listen&lt;bool&gt;(showExplorerListNotifierProvider, (previous, next) {
        if (next) {
          _showExploreListSheet(context, ref);
        }
      })
      ..listen&lt;bool&gt;(showSpotListNotifierProvider, (previous, next) {
        if (next) {
          _showSpotListSheet(context, ref);
        }
      });

    return Scaffold(
      appBar: AppBar(
        leadingWidth: 100,
        leading: Row(
          mainAxisSize: MainAxisSize.min,
          children: [
            IconButton(
              icon: const Icon(Icons.person),
              onPressed: () {
                context.push(Screen.myPage.path);
              },
            ),
            IconButton(
              icon: const Icon(Icons.notifications),
              onPressed: () {
                context.push(Screen.notificationList.path);
              },
            ),
          ],
        ),
        actions: [
          Padding(
            padding: const EdgeInsets.only(right: 16),
            child: InkWell(
              onTap: () {
                context.push(Screen.wallet.path);
              },
              child: const Row(
                children: [
                  Icon(Icons.token, size: 20),
                  SizedBox(width: 4),
                  Text('35.05 STP'), // TODO: ä»®ãƒ‡ãƒ¼ã‚¿
                ],
              ),
            ),
          ),
        ],
      ),
      body: navigationShell,
      bottomNavigationBar: BottomNavigationBar(
        currentIndex: navigationShell.currentIndex,
        onTap: navigationShell.goBranch,
        items: const [
          BottomNavigationBarItem(icon: Icon(Icons.map), label: 'Map'),
          BottomNavigationBarItem(icon: Icon(Icons.group), label: 'Guild'),
        ],
      ),
    );
  }

  void _showShootableSpotDetailSheet(BuildContext context, WidgetRef ref) {
    showModalBottomSheet&lt;void&gt;(
      context: context,
      isScrollControlled: true,
      builder: (context) {
        return const FractionallySizedBox(
          heightFactor: 0.5,
          child: ClipRRect(
            borderRadius: BorderRadius.vertical(top: Radius.circular(16)),
            child: ShootableSpotDetailPage(),
          ),
        );
      },
    ).then((_) {
      ref.read(showShootableSpotDetailNotifierProvider.notifier).hide();
    });
  }

  void _showExploreListSheet(BuildContext context, WidgetRef ref) {
    showModalBottomSheet&lt;void&gt;(
      context: context,
      isScrollControlled: true,
      builder: (context) {
        return const FractionallySizedBox(
          heightFactor: 0.5,
          child: ClipRRect(
            borderRadius: BorderRadius.vertical(top: Radius.circular(16)),
            child: ExplorerListPage(),
          ),
        );
      },
    ).then((_) {
      ref.read(showExplorerListNotifierProvider.notifier).hide();
    });
  }

  void _showSpotListSheet(BuildContext context, WidgetRef ref) {
    // sheet ãŒç«‹ã¡ä¸ŠãŒã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§æœ€åˆã®ç”»é¢ã«ãƒªã‚»ãƒƒãƒˆã—ãªã„ã¨ã€sheet ã‚’è¡¨ç¤ºã—ãŸã¨ãã«å‰å›é–‰ã˜ãŸç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹
    spotListRouter.go(Screen.spotList.path);

    showModalBottomSheet&lt;void&gt;(
      context: context,
      isScrollControlled: true,
      builder: (context) {
        return FractionallySizedBox(
          heightFactor: 0.5,
          child: ClipRRect(
            borderRadius: const BorderRadius.vertical(top: Radius.circular(16)),
            child: MaterialApp.router(
              theme: appTheme,
              routerConfig: spotListRouter,
              debugShowCheckedModeBanner: false,
            ),
          ),
        );
      },
    ).then((_) {
      ref.read(showSpotListNotifierProvider.notifier).hide();
    });
  }
}

---

## ğŸ¤– Assistant
*2024-12-19 16:31:35*

ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’åˆ†æã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªåŸå› ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚ç‰¹ã«ã€`context.push`ã‚’å‘¼ã³å‡ºã—ãŸéš›ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å ´åˆã€`GoRouter`ã«é–¢é€£ã™ã‚‹å•é¡ŒãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚

---

### è€ƒãˆã‚‰ã‚Œã‚‹åŸå› ã¨è§£æ±ºç­–

#### 1. **`Screen`ã®ãƒ‘ã‚¹ãŒGoRouterã«æ­£ã—ãå®šç¾©ã•ã‚Œã¦ã„ãªã„**
`Screen.myPage.path`, `Screen.notificationList.path`, `Screen.wallet.path`ã«å¯¾å¿œã™ã‚‹ãƒ‘ã‚¹ãŒã€`GoRouter`ã®ãƒ«ãƒ¼ãƒˆè¨­å®šã§æ­£ã—ãå®šç¾©ã•ã‚Œã¦ã„ãªã„å ´åˆã€ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

- **ç¢ºèªäº‹é …**:
  1. `Screen`ã®å„ãƒ‘ã‚¹ãŒGoRouterã§æ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
  2. å„ãƒ«ãƒ¼ãƒˆã«å¯¾ã—ã¦å¯¾å¿œã™ã‚‹ãƒšãƒ¼ã‚¸ãŒæ­£ã—ãå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

- **ä¾‹**:
```dart
final GoRouter router = GoRouter(
  routes: [
    GoRoute(
      path: '/myPage',
      builder: (context, state) => const MyPage(),
    ),
    GoRoute(
      path: '/notificationList',
      builder: (context, state) => const NotificationListPage(),
    ),
    GoRoute(
      path: '/wallet',
      builder: (context, state) => const WalletPage(),
    ),
  ],
);
```

---

#### 2. **NavigatorãŒæ··åœ¨ã—ã¦ã„ã‚‹**
ã‚³ãƒ¼ãƒ‰å†…ã§`MaterialApp.router`ã‚’ç”¨ã„ã¦`GoRouter`ã‚’è¨­å®šã—ã¦ã„ã¾ã™ãŒã€åŒã˜ã‚¢ãƒ—ãƒªå†…ã§ç•°ãªã‚‹`Navigator`ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ãƒ«ãƒ¼ãƒˆé·ç§»ã§å•é¡ŒãŒç™ºç”Ÿã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

- **ç¢ºèªäº‹é …**:
  - å…¨ã¦ã®ãƒ«ãƒ¼ãƒˆè¨­å®šãŒ`GoRouter`ã§çµ±ä¸€ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
  - ç‰¹ã«ã€`showModalBottomSheet`å†…ã§æ–°ã—ã„`MaterialApp.router`ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ãŒã€ã“ã‚ŒãŒç¾åœ¨ã®`GoRouter`ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨å¹²æ¸‰ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

- **è§£æ±ºç­–**:
  `showModalBottomSheet`å†…ã§æ–°ã—ã„`MaterialApp.router`ã‚’ä½¿ç”¨ã™ã‚‹ä»£ã‚ã‚Šã«ã€æ—¢å­˜ã®`GoRouter`ã‚’ä½¿ã£ã¦ãƒ«ãƒ¼ãƒˆé·ç§»ã‚’ç®¡ç†ã—ã¦ãã ã•ã„ã€‚

---

#### 3. **`StatefulNavigationShell`ã¨ã®äº’æ›æ€§**
`StatefulNavigationShell`ã¨`GoRouter`ã®è¨­å®šãŒç«¶åˆã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

- **ç¢ºèªäº‹é …**:
  - `StatefulNavigationShell`ãŒæ­£ã—ãåˆæœŸåŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚
  - ç¾åœ¨ã®`GoRouter`è¨­å®šã¨`navigationShell`ãŒé€£æºã—ã¦å‹•ä½œã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚

- **è§£æ±ºç­–**:
  `navigationShell`ã§ç®¡ç†ã—ã¦ã„ã‚‹çŠ¶æ…‹ã‚’`GoRouter`ã®çŠ¶æ…‹ã¨åŒæœŸã•ã›ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

---

#### 4. **`showModalBottomSheet`ã®å½±éŸ¿**
`showModalBottomSheet`ã‚’è¡¨ç¤ºä¸­ã«`context.push`ã‚’å‘¼ã³å‡ºã™ã¨ã€`Navigator`ã®ã‚¹ã‚¿ãƒƒã‚¯ãŒæ­£ã—ãå‡¦ç†ã•ã‚Œãªã„ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

- **è§£æ±ºç­–**:
  `context.push`ã‚’å‘¼ã³å‡ºã™éš›ã«ã€ç¾åœ¨ã®`Navigator`ãŒæœ‰åŠ¹ãªçŠ¶æ…‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ã¾ãŸã€ã‚·ãƒ¼ãƒˆè¡¨ç¤ºä¸­ã®é·ç§»ãŒå¿…è¦ãªã„å ´åˆã¯ã€ã‚·ãƒ¼ãƒˆã‚’é–‰ã˜ã¦ã‹ã‚‰é·ç§»ã‚’è¡Œã†ã‚ˆã†ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

---

#### 5. **`context`ãŒé©åˆ‡ã§ãªã„**
`context.push`ã§åˆ©ç”¨ã™ã‚‹`context`ãŒã€æ„å›³ã—ãŸ`GoRouter`ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

- **è§£æ±ºç­–**:
  `BuildContext`ã‚’ã‚¹ã‚³ãƒ¼ãƒ—å†…ã§é©åˆ‡ã«æ¸¡ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ã¾ãŸã€`GoRouter.of(context).push(...)`ã‚’æ˜ç¤ºçš„ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€`GoRouter`ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç›´æ¥æŒ‡å®šã—ã¦é·ç§»ã§ãã¾ã™ã€‚

---

### ä¿®æ­£ç‰ˆã®ä¾‹

ä»¥ä¸‹ã¯ã€ä¸Šè¨˜ã®å•é¡Œã‚’è€ƒæ…®ã—ãŸä¿®æ­£ç‰ˆã‚³ãƒ¼ãƒ‰ã®ä¾‹ã§ã™ã€‚

```dart
class TabPage extends HookConsumerWidget {
  const TabPage({required this.navigationShell, super.key});
  final StatefulNavigationShell navigationShell;

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    ref.listen<bool>(showShootableSpotDetailNotifierProvider, (previous, next) {
      if (next) {
        _showShootableSpotDetailSheet(context, ref);
      }
    });

    return Scaffold(
      appBar: AppBar(
        leadingWidth: 100,
        leading: Row(
          mainAxisSize: MainAxisSize.min,
          children: [
            IconButton(
              icon: const Icon(Icons.person),
              onPressed: () => GoRouter.of(context).push(Screen.myPage.path),
            ),
            IconButton(
              icon: const Icon(Icons.notifications),
              onPressed: () => GoRouter.of(context).push(Screen.notificationList.path),
            ),
          ],
        ),
        actions: [
          Padding(
            padding: const EdgeInsets.only(right: 16),
            child: InkWell(
              onTap: () => GoRouter.of(context).push(Screen.wallet.path),
              child: const Row(
                children: [
                  Icon(Icons.token, size: 20),
                  SizedBox(width: 4),
                  Text('35.05 STP'), // TODO: ä»®ãƒ‡ãƒ¼ã‚¿
                ],
              ),
            ),
          ),
        ],
      ),
      body: navigationShell,
      bottomNavigationBar: BottomNavigationBar(
        currentIndex: navigationShell.currentIndex,
        onTap: navigationShell.goBranch,
        items: const [
          BottomNavigationBarItem(icon: Icon(Icons.map), label: 'Map'),
          BottomNavigationBarItem(icon: Icon(Icons.group), label: 'Guild'),
        ],
      ),
    );
  }
}
```

---

### ãã®ä»–ã®èª¿æŸ»ãƒã‚¤ãƒ³ãƒˆ
1. ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®è©³ç´°ã‚’ç¢ºèªã—ã¦ã€å…·ä½“çš„ãªã‚¨ãƒ©ãƒ¼ç®‡æ‰€ã‚’ç‰¹å®šã—ã¦ãã ã•ã„ã€‚
2. `Screen`ã‚¯ãƒ©ã‚¹ã®å®Ÿè£…ãŒæ­£ã—ã„ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚

å•é¡ŒãŒè§£æ±ºã—ãªã„å ´åˆã¯ã€`Screen`ã‚¯ãƒ©ã‚¹ã‚„`GoRouter`è¨­å®šã®è©³ç´°ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚

---

## ğŸ‘¤ User
*2024-12-19 16:32:42*

â•â•â•â•â•â•â•â• Exception caught by scheduler library â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
The following assertion was thrown during a scheduler callback:
There are multiple heroes that share the same tag within a subtree.
Within each subtree for which heroes are to be animated (i.e. a PageRoute subtree), each Hero must have a unique non-null tag.
In this case, multiple heroes had the following tag: &lt;default FloatingActionButton tag&gt;
Here is the subtree for one of the offending heroes: Hero
    tag: &lt;default FloatingActionButton tag&gt;
    dependencies: [_ModalScopeStatus]
    state: _HeroState#141cb

When the exception was thrown, this was the stack:

import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:google_maps_flutter/google_maps_flutter.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:permission_handler/permission_handler.dart';
import 'package:snpit_guild_app/presentation/providers/current_location.dart';
import 'package:snpit_guild_app/presentation/providers/show_explorer_list.dart';
import 'package:snpit_guild_app/presentation/providers/show_shootable_spot_detail.dart';
import 'package:snpit_guild_app/presentation/providers/show_spot_list.dart';

class MapPage extends HookConsumerWidget {
  const MapPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final locationAsync = ref.watch(currentLocationNotifierProvider);
    final googleMapController = useState&lt;GoogleMapController?&gt;(null);

    useEffect(
      () {
        final observer = _LifecycleObserver(
          onResume: () async {
            // ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã«æˆ»ã£ã¦ããŸã‚‰ä½ç½®æƒ…å ±ã‚’å†å–å¾—
            final refreshedLocation =
                ref.refresh(currentLocationNotifierProvider);
            debugPrint('Location refreshed: $refreshedLocation');
          },
        );
        WidgetsBinding.instance.addObserver(observer);

        return () =&gt; WidgetsBinding.instance.removeObserver(observer);
      },
      [],
    );

    return Scaffold(
      body: locationAsync.when(
        data: (currentLocation) =&gt; Stack(
          children: [
            GoogleMap(
              initialCameraPosition: CameraPosition(
                target: currentLocation,
                zoom: 17,
              ),
              myLocationEnabled: true,
              myLocationButtonEnabled: false,
              onMapCreated: (controller) {
                googleMapController.value = controller;
              },
            ),
            Center(
              child: ElevatedButton(
                onPressed: () =&gt; _checkCameraPermission(context, ref),
                child: const Icon(Icons.camera_alt),
              ),
            ),
            Positioned(
              bottom: 16,
              left: 16,
              right: 16,
              child: Row(
                mainAxisAlignment: MainAxisAlignment.spaceBetween,
                children: [
                  FloatingActionButton(
                    onPressed: () async {
                      final refreshedLocation = await ref
                          .read(currentLocationNotifierProvider.future);
                      final controller = googleMapController.value;
                      if (controller != null) {
                        await controller.animateCamera(
                          CameraUpdate.newLatLng(refreshedLocation),
                        );
                      }
                    },
                    child: const Icon(Icons.my_location),
                  ),
                  ElevatedButton(
                    onPressed: () =&gt; ref
                        .read(showExplorerListNotifierProvider.notifier)
                        .show(),
                    style: ElevatedButton.styleFrom(
                      shape: RoundedRectangleBorder(
                        borderRadius: BorderRadius.circular(16),
                      ),
                      padding: const EdgeInsets.symmetric(
                        horizontal: 24,
                        vertical: 12,
                      ),
                    ),
                    child: const Row(
                      children: [
                        Icon(Icons.explore),
                        SizedBox(width: 8),
                        Text('Explore'),
                      ],
                    ),
                  ),
                  FloatingActionButton(
                    onPressed: () =&gt;
                        ref.read(showSpotListNotifierProvider.notifier).show(),
                    child: const Icon(Icons.photo),
                  ),
                ],
              ),
            ),
          ],
        ),
        loading: () =&gt; const Center(child: CircularProgressIndicator()),
        error: (error, stack) =&gt; Center(
          child: ElevatedButton(
            onPressed: () async {
              final _ = await openAppSettings();
            },
            child: const Text('è¨­å®šã‚¢ãƒ—ãƒªã‹ã‚‰ä½ç½®æƒ…å ±å–å¾—ã‚’ONã«ã—ã¦ãã ã•ã„'),
          ),
        ),
      ),
    );
  }

  Future&lt;void&gt; _checkCameraPermission(
    BuildContext context,
    WidgetRef ref,
  ) async {
    // ã‚«ãƒ¡ãƒ©ã®ä½¿ç”¨è¨±å¯ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹
    final status = await Permission.camera.request();

    if (status.isGranted) {
      // ã‚«ãƒ¡ãƒ©ã®ä½¿ç”¨ãŒè¨±å¯ã•ã‚ŒãŸå ´åˆ
      ref.read(showShootableSpotDetailNotifierProvider.notifier).show();
    } else if (status.isPermanentlyDenied) {
      // æ°¸ä¹…ã«æ‹’å¦ã•ã‚Œã¦ã„ã‚‹å ´åˆ
      if (context.mounted) {
        _showPermissionDialog(context);
      }
    } else {
      // ãã®ä»–ã®ã‚±ãƒ¼ã‚¹ï¼ˆæ‹’å¦ã•ã‚ŒãŸå ´åˆãªã©ï¼‰
      if (context.mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          const SnackBar(content: Text('ã‚«ãƒ¡ãƒ©ã®ä½¿ç”¨ãŒè¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚')),
        );
      }
    }
  }

  void _showPermissionDialog(BuildContext context) {
    showDialog&lt;void&gt;(
      context: context,
      builder: (context) =&gt; AlertDialog(
        title: const Text('ã‚«ãƒ¡ãƒ©ã®ä½¿ç”¨è¨±å¯ãŒå¿…è¦ã§ã™'),
        content: const Text('ã‚«ãƒ¡ãƒ©ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€è¨­å®šã§ã‚«ãƒ¡ãƒ©ã®ä½¿ç”¨è¨±å¯ã‚’ã‚ªãƒ³ã«ã—ã¦ãã ã•ã„ã€‚'),
        actions: [
          TextButton(
            onPressed: () {
              Navigator.of(context).pop();
            },
            child: const Text('ã‚­ãƒ£ãƒ³ã‚»ãƒ«'),
          ),
          TextButton(
            onPressed: () async {
              final _ = await openAppSettings();
            },
            child: const Text('è¨­å®šã‚’é–‹ã'),
          ),
        ],
      ),
    );
  }
}

class _LifecycleObserver extends WidgetsBindingObserver {
  _LifecycleObserver({this.onResume});
  final VoidCallback? onResume;

  @override
  void didChangeAppLifecycleState(AppLifecycleState state) {
    if (state == AppLifecycleState.resumed) {
      onResume?.call();
    }
  }
}

---

## ğŸ¤– Assistant
*2024-12-19 16:33:01*

ã“ã®ã‚¨ãƒ©ãƒ¼ã¯ã€`FloatingActionButton`ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒ`Hero`ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã¨ã—ã¦å†…éƒ¨çš„ã«ä½¿ç”¨ã—ã¦ãŠã‚Šã€åŒã˜`tag`ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯`<default FloatingActionButton tag>`ï¼‰ã‚’æŒã¤è¤‡æ•°ã®`FloatingActionButton`ãŒåŒã˜ãƒ„ãƒªãƒ¼å†…ã«å­˜åœ¨ã™ã‚‹ãŸã‚ã«ç™ºç”Ÿã—ã¦ã„ã¾ã™ã€‚`Hero`ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®`tag`ã¯ãƒ¦ãƒ‹ãƒ¼ã‚¯ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„ãŸã‚ã€ã“ã®ç«¶åˆãŒå•é¡Œã‚’å¼•ãèµ·ã“ã—ã¦ã„ã¾ã™ã€‚

### è§£æ±ºæ–¹æ³•

#### 1. **`FloatingActionButton`ã®`HeroTag`ã‚’æŒ‡å®šã™ã‚‹**
`FloatingActionButton`ã«ã¯ã€`heroTag`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ä½¿ç”¨ã—ã¦ä¸€æ„ã®å€¤ã‚’æŒ‡å®šã§ãã¾ã™ã€‚ã“ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ã€`Hero`ã‚¿ã‚°ã®ç«¶åˆã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚

ä¿®æ­£ç‰ˆã‚³ãƒ¼ãƒ‰:
```dart
Positioned(
  bottom: 16,
  left: 16,
  right: 16,
  child: Row(
    mainAxisAlignment: MainAxisAlignment.spaceBetween,
    children: [
      FloatingActionButton(
        heroTag: 'locationButton', // ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªã‚¿ã‚°ã‚’æŒ‡å®š
        onPressed: () async {
          final refreshedLocation = await ref
              .read(currentLocationNotifierProvider.future);
          final controller = googleMapController.value;
          if (controller != null) {
            await controller.animateCamera(
              CameraUpdate.newLatLng(refreshedLocation),
            );
          }
        },
        child: const Icon(Icons.my_location),
      ),
      ElevatedButton(
        onPressed: () => ref
            .read(showExplorerListNotifierProvider.notifier)
            .show(),
        style: ElevatedButton.styleFrom(
          shape: RoundedRectangleBorder(
            borderRadius: BorderRadius.circular(16),
          ),
          padding: const EdgeInsets.symmetric(
            horizontal: 24,
            vertical: 12,
          ),
        ),
        child: const Row(
          children: [
            Icon(Icons.explore),
            SizedBox(width: 8),
            Text('Explore'),
          ],
        ),
      ),
      FloatingActionButton(
        heroTag: 'photoButton', // ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªã‚¿ã‚°ã‚’æŒ‡å®š
        onPressed: () =>
            ref.read(showSpotListNotifierProvider.notifier).show(),
        child: const Icon(Icons.photo),
      ),
    ],
  ),
),
```

---

#### 2. **`Hero`ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹**
ã‚‚ã—`Hero`ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¿…è¦ãªã„å ´åˆã€`heroTag`ã«`null`ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç„¡åŠ¹åŒ–ã§ãã¾ã™ã€‚

ä¿®æ­£ç‰ˆã‚³ãƒ¼ãƒ‰:
```dart
FloatingActionButton(
  heroTag: null, // Heroã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç„¡åŠ¹åŒ–
  onPressed: () async {
    final refreshedLocation = await ref
        .read(currentLocationNotifierProvider.future);
    final controller = googleMapController.value;
    if (controller != null) {
      await controller.animateCamera(
        CameraUpdate.newLatLng(refreshedLocation),
      );
    }
  },
  child: const Icon(Icons.my_location),
),
```

---

### æ³¨æ„ç‚¹
- `FloatingActionButton`ã‚’è¤‡æ•°ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€**å…¨ã¦ã®ãƒœã‚¿ãƒ³ã«ãƒ¦ãƒ‹ãƒ¼ã‚¯ãª`heroTag`ã‚’è¨­å®šã™ã‚‹**ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¾ã™ã€‚
- `null`ã‚’æŒ‡å®šã™ã‚‹ã¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¯ç„¡åŠ¹åŒ–ã•ã‚Œã¾ã™ãŒã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆ©ç”¨ã—ãŸã‚¹ãƒ ãƒ¼ã‚ºãªç”»é¢é·ç§»ãŒä¸è¦ãªå ´åˆã«ã®ã¿é¸æŠã—ã¦ãã ã•ã„ã€‚

ã“ã‚Œã§ã‚¨ãƒ©ãƒ¼ã¯è§£æ¶ˆã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚å•é¡ŒãŒè§£æ±ºã—ãªã„å ´åˆã¯ã€ã•ã‚‰ã«è©³ç´°ãªçŠ¶æ³ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚

---

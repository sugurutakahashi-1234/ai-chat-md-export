# リリースシェルスクリプト作成

日付: 2024-06-12

---

## 👤 ユーザー
*2024/06/12 10:59:50*

以下のようなシェルスクリプトを作ってほしい。

実行引数0.1.0
直近のタグ 0.1.0-rc.1
リポジトリ名: crage-inc/Project-SoftBankSNS-iOS

(1)
実行引数が 数値.数値.数値 であること
実行しているブランチが release/実行引数 の形（例release/0.1.0）であることを確認する

(2)
実行引数と直近のタグが同じであればrc.以降の数字をインクリメントする 例：0.1.0-rc.1 → 0.1.0-rc.2
そうでなければ-rc.1を設定する

(3)
以下のURLを作成してopenする
https://github.com/crage-inc/Project-SoftBankSNS-iOS/releases/new?tag=0.1.0-rc.2&title=0.1.0-rc.2&target=release/0.1.0&prerelease=1

crage-inc/Project-SoftBankSNS-iOS は別のリポジトリでも採用できるように変数にしてほしい

---

## 🤖 アシスタント
*2024/06/12 11:00:07*

以下のようなシェルスクリプトを作成しました。このスクリプトは、実行引数の検証、現在のブランチの確認、タグのインクリメント、そしてリリースページのURLを作成してブラウザで開きます。

```sh
#!/bin/bash

# リポジトリ名の設定
REPOSITORY="crage-inc/Project-SoftBankSNS-iOS"

# 実行引数の検証
if [[ ! $1 =~ ^[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
  echo "エラー: 引数は数値.数値.数値の形式で指定してください。"
  exit 1
fi

VERSION=$1

# 現在のブランチ名の取得
CURRENT_BRANCH=$(git symbolic-ref --short HEAD)

# ブランチ名の検証
if [[ $CURRENT_BRANCH != release/$VERSION ]]; then
  echo "エラー: 現在のブランチは release/$VERSION である必要があります。"
  exit 1
fi

# 直近のタグの取得
LATEST_TAG=$(git describe --tags --match "$VERSION-rc.*" --abbrev=0 2>/dev/null)

# タグのインクリメント
if [[ $LATEST_TAG =~ $VERSION-rc\.([0-9]+) ]]; then
  RC_NUMBER=${BASH_REMATCH[1]}
  NEW_RC_NUMBER=$((RC_NUMBER + 1))
  NEW_TAG="$VERSION-rc.$NEW_RC_NUMBER"
else
  NEW_TAG="$VERSION-rc.1"
fi

# リリースURLの作成
RELEASE_URL="https://github.com/$REPOSITORY/releases/new?tag=$NEW_TAG&title=$NEW_TAG&target=release/$VERSION&prerelease=1"

# ブラウザでURLを開く
echo "ブラウザで以下のURLを開きます: $RELEASE_URL"
open "$RELEASE_URL"
```

このスクリプトをファイル（例：`release.sh`）として保存し、実行権限を付与してください。

```sh
chmod +x release.sh
```

その後、次のようにしてスクリプトを実行できます。

```sh
./release.sh 0.1.0
```

このスクリプトは、引数に指定されたバージョンとブランチ名を検証し、タグをインクリメントしてリリースページをブラウザで開きます。リポジトリ名は変数にしているため、他のリポジトリでも簡単に変更できます。

---

## 👤 ユーザー
*2024/06/12 11:06:45*

少し内容を変えたい。以下のようなシェルスクリプトを作ってほしい。

直近のタグ 0.1.0-rc.1
リポジトリ名: crage-inc/Project-SoftBankSNS-iOS

また、変数名は小文字を採用してほしい。

(1) 
Configs/AppVersion.xcconfig というパスから0.1.0のように値をバージョンを取得する


```Configs/AppVersion.xcconfig 
APP_VERSION = 0.1.0
```

(2)
取得したバージョンが 数値.数値.数値 であること
実行しているブランチが release/実行引数 の形（例release/0.1.0）であることを確認する

(3)
実行引数と直近のタグが同じであればrc.以降の数字をインクリメントする 例：0.1.0-rc.1 → 0.1.0-rc.2
そうでなければ-rc.1を設定する

(4)
以下のURLを作成してopenする
https://github.com/crage-inc/Project-SoftBankSNS-iOS/releases/new?tag=0.1.0-rc.2&title=0.1.0-rc.2&target=release/0.1.0&prerelease=1

crage-inc/Project-SoftBankSNS-iOS は別のリポジトリでも採用できるように変数にしてほしい

---

## 🤖 アシスタント
*2024/06/12 11:07:04*

以下のシェルスクリプトを作成しました。このスクリプトは、`Configs/AppVersion.xcconfig` ファイルからバージョンを取得し、バージョンとブランチ名の検証、タグのインクリメント、リリースページのURL作成とブラウザでのオープンを行います。

```sh
#!/bin/bash

# リポジトリ名の設定
repository="crage-inc/Project-SoftBankSNS-iOS"

# Configs/AppVersion.xcconfig からバージョンを取得
app_version=$(grep 'APP_VERSION' Configs/AppVersion.xcconfig | cut -d '=' -f2 | tr -d '[:space:]')

# バージョンの検証
if [[ ! $app_version =~ ^[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
  echo "エラー: Configs/AppVersion.xcconfig のバージョンは数値.数値.数値の形式で指定されている必要があります。"
  exit 1
fi

# 実行引数のバージョンの検証
if [[ ! $1 =~ ^[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
  echo "エラー: 引数は数値.数値.数値の形式で指定してください。"
  exit 1
fi

version=$1

# 現在のブランチ名の取得
current_branch=$(git symbolic-ref --short HEAD)

# ブランチ名の検証
if [[ $current_branch != release/$version ]]; then
  echo "エラー: 現在のブランチは release/$version である必要があります。"
  exit 1
fi

# 直近のタグの取得
latest_tag=$(git describe --tags --match "$version-rc.*" --abbrev=0 2>/dev/null)

# タグのインクリメント
if [[ $latest_tag =~ $version-rc\.([0-9]+) ]]; then
  rc_number=${BASH_REMATCH[1]}
  new_rc_number=$((rc_number + 1))
  new_tag="$version-rc.$new_rc_number"
else
  new_tag="$version-rc.1"
fi

# リリースURLの作成
release_url="https://github.com/$repository/releases/new?tag=$new_tag&title=$new_tag&target=release/$version&prerelease=1"

# ブラウザでURLを開く
echo "ブラウザで以下のURLを開きます: $release_url"
open "$release_url"
```

このスクリプトをファイル（例：`release.sh`）として保存し、実行権限を付与してください。

```sh
chmod +x release.sh
```

その後、次のようにしてスクリプトを実行できます。

```sh
./release.sh 0.1.0
```

このスクリプトは、`Configs/AppVersion.xcconfig` から取得したバージョンと引数に指定されたバージョンを使用して、ブランチ名を確認し、タグをインクリメントしてリリースページをブラウザで開きます。リポジトリ名は変数にしているため、他のリポジトリでも簡単に変更できます。

---

## 👤 ユーザー
*2024/06/12 11:09:18*

Configs/AppVersion.xcconfig も変数名に変えてほしい

---

## 🤖 アシスタント
*2024/06/12 11:09:39*

以下は、`Configs/AppVersion.xcconfig` のパスも変数にしたシェルスクリプトです。

```sh
#!/bin/bash

# リポジトリ名とバージョンファイルの設定
repository="crage-inc/Project-SoftBankSNS-iOS"
version_file="Configs/AppVersion.xcconfig"

# バージョンファイルからバージョンを取得
app_version=$(grep 'APP_VERSION' "$version_file" | cut -d '=' -f2 | tr -d '[:space:]')

# バージョンの検証
if [[ ! $app_version =~ ^[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
  echo "エラー: $version_file のバージョンは数値.数値.数値の形式で指定されている必要があります。"
  exit 1
fi

# 実行引数のバージョンの検証
if [[ ! $1 =~ ^[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
  echo "エラー: 引数は数値.数値.数値の形式で指定してください。"
  exit 1
fi

version=$1

# 現在のブランチ名の取得
current_branch=$(git symbolic-ref --short HEAD)

# ブランチ名の検証
if [[ $current_branch != release/$version ]]; then
  echo "エラー: 現在のブランチは release/$version である必要があります。"
  exit 1
fi

# 直近のタグの取得
latest_tag=$(git describe --tags --match "$version-rc.*" --abbrev=0 2>/dev/null)

# タグのインクリメント
if [[ $latest_tag =~ $version-rc\.([0-9]+) ]]; then
  rc_number=${BASH_REMATCH[1]}
  new_rc_number=$((rc_number + 1))
  new_tag="$version-rc.$new_rc_number"
else
  new_tag="$version-rc.1"
fi

# リリースURLの作成
release_url="https://github.com/$repository/releases/new?tag=$new_tag&title=$new_tag&target=release/$version&prerelease=1"

# ブラウザでURLを開く
echo "ブラウザで以下のURLを開きます: $release_url"
open "$release_url"
```

このスクリプトをファイル（例：`release.sh`）として保存し、実行権限を付与してください。

```sh
chmod +x release.sh
```

その後、次のようにしてスクリプトを実行できます。

```sh
./release.sh 0.1.0
```

このスクリプトは、`version_file` 変数に指定されたパスからバージョンを取得し、その他の処理を行います。これにより、バージョンファイルのパスも簡単に変更できます。

---

## 👤 ユーザー
*2024/06/12 11:47:59*

version=$1 のような引数は使わないのでは？app_versionがあるので

---

## 🤖 アシスタント
*2024/06/12 11:48:20*

なるほど、`app_version` 変数を使用してスクリプトを修正します。

```sh
#!/bin/bash

# リポジトリ名とバージョンファイルの設定
repository="crage-inc/Project-SoftBankSNS-iOS"
version_file="Configs/AppVersion.xcconfig"

# バージョンファイルからバージョンを取得
app_version=$(grep 'APP_VERSION' "$version_file" | cut -d '=' -f2 | tr -d '[:space:]')

# バージョンの検証
if [[ ! $app_version =~ ^[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
  echo "エラー: $version_file のバージョンは数値.数値.数値の形式で指定されている必要があります。"
  exit 1
fi

# 現在のブランチ名の取得
current_branch=$(git symbolic-ref --short HEAD)

# ブランチ名の検証
if [[ $current_branch != release/$app_version ]]; then
  echo "エラー: 現在のブランチは release/$app_version である必要があります。"
  exit 1
fi

# 直近のタグの取得
latest_tag=$(git describe --tags --match "$app_version-rc.*" --abbrev=0 2>/dev/null)

# タグのインクリメント
if [[ $latest_tag =~ $app_version-rc\.([0-9]+) ]]; then
  rc_number=${BASH_REMATCH[1]}
  new_rc_number=$((rc_number + 1))
  new_tag="$app_version-rc.$new_rc_number"
else
  new_tag="$app_version-rc.1"
fi

# リリースURLの作成
release_url="https://github.com/$repository/releases/new?tag=$new_tag&title=$new_tag&target=release/$app_version&prerelease=1"

# ブラウザでURLを開く
echo "ブラウザで以下のURLを開きます: $release_url"
open "$release_url"
```

このスクリプトをファイル（例：`release.sh`）として保存し、実行権限を付与してください。

```sh
chmod +x release.sh
```

その後、次のようにしてスクリプトを実行できます。

```sh
./release.sh
```

このスクリプトは、`Configs/AppVersion.xcconfig` から取得した `app_version` を使用して、ブランチ名を確認し、タグをインクリメントしてリリースページをブラウザで開きます。引数を使用せず、`app_version` に基づいて処理を行います。

---

## 👤 ユーザー
*2024/06/12 11:57:20*

以下になった。echo するする

#!/bin/sh

repository="crage-inc/Project-SoftBankSNS-iOS"
version_file="Configs/AppVersion.xcconfig"

# AppVersion.xcconfig から現在のバージョンを取得
app_version=$(grep 'APP_VERSION' "$version_file" | cut -d '=' -f2 | tr -d '[:space:]')
echo "App Version: $app_version"

# バージョンの検証
if [[ ! $app_version =~ ^[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
  echo "エラー: $version_file のバージョンは数値.数値.数値の形式で指定されている必要があります。"
  exit 1
fi

# 現在のブランチ名の取得
current_branch=$(git symbolic-ref --short HEAD)
echo "Current Branch: $current_branch"

# ブランチ名の検証
if [[ $current_branch != release/$app_version ]]; then
  echo "エラー: 現在のブランチは release/$app_version である必要があります。"
  exit 1
fi

# 直近のタグの取得
latest_tag=$(git describe --tags --match "$app_version-rc.*" --abbrev=0 2&gt;/dev/null)
echo "Latest Tag: $latest_tag"

# タグのインクリメント
if [[ $latest_tag =~ $app_version-rc\.([0-9]+) ]]; then
  rc_number=${BASH_REMATCH[1]}
  new_rc_number=$((rc_number + 1))
  new_tag="$app_version-rc.$new_rc_number"
else
  new_tag="$app_version-rc.1"
fi

echo "New Tag: $new_tag"

# リリースURLの作成
release_url="https://github.com/$repository/releases/new?tag=$new_tag&title=$new_tag&target=release/$app_version&prerelease=1"

echo "ブラウザで以下のURLを開きます"
echo $release_url
open "$release_url"

---

## 🤖 アシスタント
*2024/06/12 11:57:37*

スクリプトが正しく動作するように、以下の修正を行いました。

```sh
#!/bin/sh

repository="crage-inc/Project-SoftBankSNS-iOS"
version_file="Configs/AppVersion.xcconfig"

# AppVersion.xcconfig から現在のバージョンを取得
app_version=$(grep 'APP_VERSION' "$version_file" | cut -d '=' -f2 | tr -d '[:space:]')
echo "App Version: $app_version"

# バージョンの検証
if ! echo "$app_version" | grep -qE '^[0-9]+\.[0-9]+\.[0-9]+$'; then
  echo "エラー: $version_file のバージョンは数値.数値.数値の形式で指定されている必要があります。"
  exit 1
fi

# 現在のブランチ名の取得
current_branch=$(git symbolic-ref --short HEAD)
echo "Current Branch: $current_branch"

# ブランチ名の検証
if [ "$current_branch" != "release/$app_version" ]; then
  echo "エラー: 現在のブランチは release/$app_version である必要があります。"
  exit 1
fi

# 直近のタグの取得
latest_tag=$(git describe --tags --match "$app_version-rc.*" --abbrev=0 2>/dev/null)
echo "Latest Tag: $latest_tag"

# タグのインクリメント
if echo "$latest_tag" | grep -qE "$app_version-rc\.([0-9]+)"; then
  rc_number=$(echo "$latest_tag" | grep -oE '[0-9]+$')
  new_rc_number=$((rc_number + 1))
  new_tag="$app_version-rc.$new_rc_number"
else
  new_tag="$app_version-rc.1"
fi

echo "New Tag: $new_tag"

# リリースURLの作成
release_url="https://github.com/$repository/releases/new?tag=$new_tag&title=$new_tag&target=release/$app_version&prerelease=1"

echo "ブラウザで以下のURLを開きます"
echo $release_url
open "$release_url"
```

これでス

---

# 角丸シート実装方法

Date: 2024-12-20

---

## 👤 User
*2024-12-20 17:25:36*

このshowModalBottomSheetを角丸のシートにしたい

import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:go_router/go_router.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:snpit_guild_app/presentation/design_token/color_token.dart';
import 'package:snpit_guild_app/presentation/pages/camera_list_page.dart';

class DeckDetailPage extends HookConsumerWidget {
  const DeckDetailPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    // TODO: 全部仮データです
    final selectedCameras = useState&lt;List&lt;String&gt;&gt;(['A', 'B', 'C', 'D']);

    return Scaffold(
      appBar: AppBar(
        title: const Text('Edit Deck'),
      ),
      body: Padding(
        padding: const EdgeInsets.all(16),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Expanded(
              child: ListView.builder(
                itemCount: selectedCameras.value.length,
                itemBuilder: (context, index) {
                  final camera = selectedCameras.value[index];
                  return ListTile(
                    leading: const Icon(Icons.camera_alt),
                    title: Text(camera),
                    trailing: IconButton(
                      icon: const Icon(Icons.remove_circle),
                      onPressed: () {
                        selectedCameras.value = List.from(selectedCameras.value)
                          ..removeAt(index);
                      },
                    ),
                  );
                },
              ),
            ),
            const SizedBox(height: 16),
            OutlinedButton.icon(
              onPressed: () {
                _showCameraListBottomSheet(context);
              },
              icon: const Icon(Icons.add),
              label: const Text(
                'Put camera',
                style: TextStyle(color: ColorToken.text),
              ),
            ),
          ],
        ),
      ),
      bottomNavigationBar: SafeArea(
        child: Padding(
          padding: const EdgeInsets.all(16),
          child: ElevatedButton(
            onPressed: () {
              // TODO: Saveボタンの処理
              context.pop();
            },
            child: const Text('Save'),
          ),
        ),
      ),
    );
  }

  void _showCameraListBottomSheet(BuildContext context) {
    showModalBottomSheet&lt;void&gt;(
      context: context,
      builder: (context) {
        return const CameraListPage();
      },
    );
  }
}

---

## 🤖 Assistant
*2024-12-20 17:25:48*

`showModalBottomSheet` で角丸のシートを実現するには、`shape` プロパティを使用して `RoundedRectangleBorder` を設定する必要があります。以下のように `_showCameraListBottomSheet` メソッドを修正してください。

修正後のコードは次のとおりです:

```dart
void _showCameraListBottomSheet(BuildContext context) {
  showModalBottomSheet<void>(
    context: context,
    shape: const RoundedRectangleBorder(
      borderRadius: BorderRadius.vertical(
        top: Radius.circular(16), // 角丸の半径
      ),
    ),
    builder: (context) {
      return const CameraListPage();
    },
  );
}
```

これで、シートの上部が指定した角丸になります。さらに、シートの背景色を変更したい場合は、`backgroundColor` プロパティを設定することもできます。

### シートの背景色をカスタマイズする例
```dart
void _showCameraListBottomSheet(BuildContext context) {
  showModalBottomSheet<void>(
    context: context,
    shape: const RoundedRectangleBorder(
      borderRadius: BorderRadius.vertical(
        top: Radius.circular(16),
      ),
    ),
    backgroundColor: Colors.white, // シートの背景色
    builder: (context) {
      return const CameraListPage();
    },
  );
}
```

これで、デザインがさらに向上し、角丸のシートが表示されるようになります。

---

## 👤 User
*2024-12-20 17:26:46*

角丸にならなかった

---

## 🤖 Assistant
*2024-12-20 17:27:03*

`showModalBottomSheet`で角丸が適用されない場合、原因として以下が考えられます：

1. **親ウィジェットが `Scaffold` で覆われていない場合**  
   `showModalBottomSheet` を使用する際、親が必ず `Scaffold` に含まれている必要があります。

2. **`isScrollControlled` プロパティが必要**  
   `isScrollControlled` を `true` に設定して、シートの高さをコンテンツに合わせたり、適切なレイアウトが反映されるようにします。

以下は修正版です。これで角丸が適用されるはずです：

```dart
void _showCameraListBottomSheet(BuildContext context) {
  showModalBottomSheet<void>(
    context: context,
    isScrollControlled: true, // シートの高さを調整
    shape: const RoundedRectangleBorder(
      borderRadius: BorderRadius.vertical(
        top: Radius.circular(16), // 角丸の設定
      ),
    ),
    builder: (context) {
      return DraggableScrollableSheet(
        initialChildSize: 0.6, // 初期の高さ (画面の60%)
        minChildSize: 0.3, // 最小の高さ
        maxChildSize: 1.0, // 最大の高さ
        builder: (context, scrollController) {
          return CameraListPage(
            scrollController: scrollController, // スクロールコントローラーを渡す
          );
        },
      );
    },
  );
}
```

### `CameraListPage` の修正 (必要であれば)
`CameraListPage` に `scrollController` を渡してスクロール可能にする必要がある場合、以下のように修正します：

```dart
class CameraListPage extends StatelessWidget {
  final ScrollController scrollController;

  const CameraListPage({Key? key, required this.scrollController}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return ListView.builder(
      controller: scrollController, // スクロールを制御
      itemCount: 20, // ダミーデータ
      itemBuilder: (context, index) {
        return ListTile(
          title: Text('Camera $index'),
        );
      },
    );
  }
}
```

これで以下のポイントが解決できます：
- シートの角丸が適用される。
- コンテンツがシート内でスクロール可能になる。

再度確認していただき、もし角丸が適用されない場合は、さらに環境設定を見直す必要があるかもしれません。

---

## 👤 User
*2024-12-20 17:27:57*

こんな感じがいいかも

void _showExploreListSheet(BuildContext context, WidgetRef ref) {
    showModalBottomSheet&lt;void&gt;(
      context: context,
      isScrollControlled: true,
      builder: (context) {
        return const FractionallySizedBox(
          heightFactor: 0.5,
          child: ClipRRect(
            borderRadius: BorderRadius.vertical(top: Radius.circular(16)),
            child: 
          ),
        );

---

## 🤖 Assistant
*2024-12-20 17:28:15*

以下のように、`FractionallySizedBox` や `ClipRRect` を使って希望のデザインに近づける実装例を提供します。このコードでは、`showModalBottomSheet` を使用して、角丸のシートを表示し、コンテンツの高さを画面の50%に制限しています。

修正版:

```dart
void _showExploreListSheet(BuildContext context, WidgetRef ref) {
  showModalBottomSheet<void>(
    context: context,
    isScrollControlled: true, // 高さをコンテンツに合わせる
    backgroundColor: Colors.transparent, // 背景を透明にして角丸を適用
    builder: (context) {
      return FractionallySizedBox(
        heightFactor: 0.5, // 高さを画面の50%に制限
        child: ClipRRect(
          borderRadius: const BorderRadius.vertical(
            top: Radius.circular(16), // 上部に角丸を設定
          ),
          child: Container(
            color: Colors.white, // シートの背景色
            child: Column(
              children: [
                Container(
                  height: 4,
                  width: 40,
                  margin: const EdgeInsets.symmetric(vertical: 8),
                  decoration: BoxDecoration(
                    color: Colors.grey.shade300, // ハンドルの色
                    borderRadius: BorderRadius.circular(2),
                  ),
                ),
                const Expanded(
                  child: Center(
                    child: Text('Explore List Content'), // コンテンツを配置
                  ),
                ),
              ],
            ),
          ),
        ),
      );
    },
  );
}
```

### コードの説明
1. **`FractionallySizedBox`**
   - `heightFactor` を `0.5` に設定し、シートの高さを画面の50%に制限しています。

2. **`ClipRRect`**
   - `borderRadius` を設定して、シートの上部を角丸にしています。

3. **背景色の透明化**
   - `backgroundColor: Colors.transparent` を設定することで、`ClipRRect` の角丸が反映されるようにしています。

4. **ドラッグ用ハンドル**
   - `Container` を使用して、ドラッグ可能なハンドルを追加しています。

### 実行結果
- シートは画面の50%の高さで表示され、上部が角丸になります。
- 背景色やコンテンツもカスタマイズ可能です。
- ドラッグ可能なハンドルも追加され、ユーザー体験が向上します。

---

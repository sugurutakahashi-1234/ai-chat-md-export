# npmã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ”¹å–„æ–¹æ³•

æ—¥ä»˜: 2024-11-13

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/11/13 19:12:12*

ã“ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æ”¹å–„ã—ãŸã„ã€‚
ã¾ãšã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ã§npm install -gã—ã¦ã„ã‚‹ãŒã€ã“ã‚Œã¯ package.json ãŒã‚ã‚Œã°ã‚„ã‚‰ãªãã¦ã‚‚æ¸ˆã‚€æ°—ãŒã—ã¦ã„ã‚‹

name: Deploy Mermaid Diagram to GitHub Pages and Imgur

on:
  push:
    paths:
      - 'assets/mermaid/finance.mmd'
      - '.github/workflows/*.yml'

jobs:
  build:
    runs-on: ubuntu-latest

    permissions:
      contents: write

    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        persist-credentials: false

    - name: Set up Node.js environment
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: Install Mermaid CLI and Japanese font
      run: |
        npm install -g @mermaid-js/mermaid-cli
        sudo apt-get update
        sudo apt-get install -y fonts-noto-cjk

    - name: Generate Mermaid Diagram
      run: |
        mkdir -p ./docs/diagrams
        mmdc -i "assets/mermaid/finance.mmd" -o "./docs/diagrams/finance.png" -f "Noto Sans JP"

    - name: Verify image creation
      run: ls -la ./docs/diagrams/

    # Mermaidã‚³ãƒ¼ãƒ‰ã‚’READMEã«æ›´æ–°ã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—
    - name: Update README with mermaid diagram
      run: |
        # Mermaidã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ•°ã«æ ¼ç´
        mermaid_content=$(cat assets/mermaid/finance.mmd)

        # `README.md` ã® `mermaid` ãƒ–ãƒ­ãƒƒã‚¯å…¨ä½“ã‚’å‰Šé™¤ã—ã¦ã‹ã‚‰æ–°ã—ã„å†…å®¹ã‚’æŒ¿å…¥
        sed -i '/```mermaid/,/```/d' README.md
        
        # æ–°ã—ã„ `mermaid` ã‚³ãƒ¼ãƒ‰ã‚’æŒ¿å…¥
        printf "\n\`\`\`mermaid\n%s\n\`\`\`\n" "$mermaid_content" >> README.md
    # æ›´æ–°ã•ã‚ŒãŸREADMEã¨ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¦ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—
    - name: Commit and push updates
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        git add ./docs/diagrams/finance.png README.md
        git commit -m "Update README with latest Mermaid diagram and finance.png"
        git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git
        git push origin HEAD:${{ github.ref }}

  #   - name: Upload to Imgur
  #     uses: devicons/public-upload-to-imgur@v2.2.2
  #     with:
  #       path: './docs/diagrams/finance.png'
  #       client_id: ${{ secrets.IMGUR_CLIENT_ID }}
  #       description: "Images uploaded by public-upload-to-imgur GitHub Action"

  #   - name: Set up GitHub Pages
  #     uses: actions/configure-pages@v5

  #   - name: Upload Pages Artifact
  #     uses: actions/upload-pages-artifact@v3
  #     with:
  #       path: './docs'

  # deploy:
  #   needs: build
  #   runs-on: ubuntu-latest
  #   permissions:
  #     contents: read
  #     pages: write
  #     id-token: write
  #   environment:
  #     name: github-pages
  #   steps:
  #   - name: Deploy to GitHub Pages
  #     uses: actions/deploy-pages@v4

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/11/13 19:12:29*

`npm install -g`ã‚’ä½¿ã‚ãšã«ã€`package.json`ã§ä¾å­˜é–¢ä¿‚ã‚’ç®¡ç†ã™ã‚‹ã“ã¨ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã«`@mermaid-js/mermaid-cli`ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹æ–¹æ³•ã«æ”¹å–„ã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ä»–ã®é–‹ç™ºè€…ã‚„CI/CDç’°å¢ƒã§ã‚‚åŒã˜ä¾å­˜é–¢ä¿‚ãŒå†ç¾ã•ã‚Œã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒä¸è¦ã«ãªã‚Šã¾ã™ã€‚ä»¥ä¸‹ã«æ”¹å–„ã—ãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ç¤ºã—ã¾ã™ã€‚

### æ”¹å–„ã—ãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

1. `package.json`ã«`@mermaid-js/mermaid-cli`ã‚’è¿½åŠ ã—ã¾ã™ã€‚
2. ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å†…ã§`npm install`ã‚’å®Ÿè¡Œã—ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ã§ã¯ãªããƒ­ãƒ¼ã‚«ãƒ«ã§`mermaid-cli`ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```yaml
name: Deploy Mermaid Diagram to GitHub Pages and Imgur

on:
  push:
    paths:
      - 'assets/mermaid/finance.mmd'
      - '.github/workflows/*.yml'

jobs:
  build:
    runs-on: ubuntu-latest

    permissions:
      contents: write

    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        persist-credentials: false

    - name: Set up Node.js environment
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: Install dependencies
      run: npm install

    - name: Install Japanese font
      run: |
        sudo apt-get update
        sudo apt-get install -y fonts-noto-cjk

    - name: Generate Mermaid Diagram
      run: |
        mkdir -p ./docs/diagrams
        npx mmdc -i "assets/mermaid/finance.mmd" -o "./docs/diagrams/finance.png" -f "Noto Sans JP"

    - name: Verify image creation
      run: ls -la ./docs/diagrams/

    - name: Update README with mermaid diagram
      run: |
        # Mermaidã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ•°ã«æ ¼ç´
        mermaid_content=$(cat assets/mermaid/finance.mmd)

        # `README.md` ã® `mermaid` ãƒ–ãƒ­ãƒƒã‚¯å…¨ä½“ã‚’å‰Šé™¤ã—ã¦ã‹ã‚‰æ–°ã—ã„å†…å®¹ã‚’æŒ¿å…¥
        sed -i '/```mermaid/,/```/d' README.md
        
        # æ–°ã—ã„ `mermaid` ã‚³ãƒ¼ãƒ‰ã‚’æŒ¿å…¥
        printf "\n\`\`\`mermaid\n%s\n\`\`\`\n" "$mermaid_content" >> README.md

    - name: Commit and push updates
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        git add ./docs/diagrams/finance.png README.md
        git commit -m "Update README with latest Mermaid diagram and finance.png"
        git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git
        git push origin HEAD:${{ github.ref }}

  # Uncomment the following steps if needed for Imgur upload and GitHub Pages deployment.
  # - name: Upload to Imgur
  # - name: Set up GitHub Pages
  # - name: Upload Pages Artifact
  # - name: Deploy to GitHub Pages
```

### å¤‰æ›´ç‚¹

- `Install Mermaid CLI and Japanese font`ã‚¹ãƒ†ãƒƒãƒ—ã‚’åˆ†é›¢ã—ã€`Install dependencies`ã‚¹ãƒ†ãƒƒãƒ—ã§`npm install`ã‚’ä½¿ç”¨ã—ã¦ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚
- `Generate Mermaid Diagram`ã‚¹ãƒ†ãƒƒãƒ—ã§`npx mmdc`ã‚’ä½¿ç”¨ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸ`mermaid-cli`ã‚’å®Ÿè¡Œã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒä¸è¦ã¨ãªã‚Šã€ã‚ˆã‚Šç®¡ç†ãŒç°¡å˜ã§ä¸€è²«æ€§ã®ã‚ã‚‹è¨­å®šãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/11/13 19:12:51*

ã“ã‚Œã‚‚ã§ãã‚Œã°ãƒ­ãƒ¼ã‚«ãƒ«ã§ã‚‚è©¦ã—ãŸã„

sudo apt-get update
        sudo apt-get install -y fonts-noto-cjk

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/11/13 19:13:08*

User wants to try installing `fonts-noto-cjk` locally without using `sudo apt-get`.

---

## ğŸ”§ ãƒ„ãƒ¼ãƒ«
*2024/11/13 19:13:08*

Model set context updated.

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/11/13 19:13:08*

ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®`fonts-noto-cjk`ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’`apt-get`ä»¥å¤–ã§è¡Œã†ã«ã¯ã€ä»¥ä¸‹ã®æ–¹æ³•ã‚’è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

### 1. Homebrewã‚’åˆ©ç”¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆmacOSï¼‰
ã‚‚ã—macOSã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€[Homebrew](https://brew.sh/)ã§`noto-cjk`ãƒ•ã‚©ãƒ³ãƒˆã‚’ç°¡å˜ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š

```bash
brew tap homebrew/cask-fonts
brew install --cask font-noto-sans-cjk-jp
```

### 2. æ‰‹å‹•ã§ãƒ•ã‚©ãƒ³ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆmacOSãƒ»Windowsãƒ»Linuxï¼‰
1. [Noto CJKãƒ•ã‚©ãƒ³ãƒˆã®å…¬å¼ãƒšãƒ¼ã‚¸](https://fonts.google.com/noto/specimen/Noto+Sans+JP)ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ãƒ•ã‚©ãƒ³ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚
2. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.ttfã‚„.otfãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã‹ã€ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã«æ‰‹å‹•ã§è¿½åŠ ã—ã¾ã™ã€‚

### 3. Dockerã‚³ãƒ³ãƒ†ãƒŠã§ã®ãƒ†ã‚¹ãƒˆ
ã‚‚ã—Linuxç’°å¢ƒã«è¿‘ã„è¨­å®šã‚’è©¦ã—ãŸã„å ´åˆã¯ã€Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã§å®Ÿè¡Œã™ã‚‹æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«Dockerfileã‚’è¨­å®šã—ã€ã‚³ãƒ³ãƒ†ãƒŠã§ãƒ†ã‚¹ãƒˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

```dockerfile
FROM ubuntu:latest
RUN apt-get update && apt-get install -y fonts-noto-cjk
```

ãã®å¾Œã€ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ãƒ†ã‚¹ãƒˆã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€ãƒ•ã‚©ãƒ³ãƒˆã®è¡¨ç¤ºã‚„ç”Ÿæˆã‚’ç¢ºèªã§ãã¾ã™ã€‚

ã“ã®ã„ãšã‚Œã‹ã®æ–¹æ³•ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«ã§ã‚‚`fonts-noto-cjk`ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¯èƒ½ã§ã™ã€‚

---

# „Ç§„É≥„Éá„É≥„Éà„É™„Éï„Ç°„ÇØ„Çø„É™„É≥„Ç∞

Date: 2025-01-19

---

## üë§ User
*2025-01-19 16:06:19*

„Ç§„É≥„Éá„É≥„Éà„ÅåÊ∑±„Åô„Åé„ÇãÈÉ®ÂàÜ„ÇíÂàá„ÇäÂá∫„Åó„Å¶„É™„Éï„Ç°„ÇØ„Çø„É™„É≥„Ç∞„Åó„Å¶„Åª„Åó„ÅÑ„ÄÇ
„ÅÇ„Åæ„ÇäÁ¥∞„Åã„ÅèÂàÜ„Åë„Å™„Åè„Å¶„ÅÑ„ÅÑ„Åå„ÄÅÊÑèÂë≥„ÅÆ„ÅÇ„ÇãÂçò‰Ωç„ÅßÂàÜÂâ≤„Åó„Å¶„Ç§„É≥„Éá„É≥„Éà„ÅåÊ∑±„ÅÑ„ÅÆ„Çí„ÇÑ„ÇÅ„Åü„ÅÑ„ÄÇ


import 'package:flutter/material.dart';
import 'package:flutter/services.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:flutter_svg/svg.dart';
import 'package:go_router/go_router.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:intl/intl.dart';
import 'package:snpit_guild_app/domain/design/color_pallet.dart';
import 'package:snpit_guild_app/domain/design/color_token.dart';
import 'package:snpit_guild_app/domain/screen.dart';
import 'package:snpit_guild_app/gen/assets.gen.dart';
import 'package:snpit_guild_app/infrastructure/snapit_guild_api/snapit_guild_api.openapi.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/accounts/get_account.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/guilds/get_guild.dart';
import 'package:snpit_guild_app/utils/extensions/uri_extensions.dart';

class GuildPage extends HookConsumerWidget {
  const GuildPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final myUserId = ref.watch(getMyAccountNotifierProvider).value?.userId;
    final myGuildInfoState = ref.watch(getMyGuildNotifierProvider);

    useEffect(
      () {
        Future.microtask(() async {
          await ref.read(getMyGuildNotifierProvider.notifier).getMyGuild();
        });
        return null;
      },
      [],
    );

    return Scaffold(
      body: RefreshIndicator(
        onRefresh: () async {
          await ref.read(getMyGuildNotifierProvider.notifier).getMyGuild();
        },
        child: myGuildInfoState.when(
          data: (guildInfo) {
            if (guildInfo != null) {
              final isAdminOrOwner = guildInfo.guildMembers?.any(
                    (member) =&gt;
                        member.userId == myUserId &&
                        (member.role == GuildMemberDtoRole.ADMIN ||
                            member.role == GuildMemberDtoRole.OWNER),
                  ) ??
                  false;
              final guildId = guildInfo.guildId ?? 'Unknown';
              final guildName = guildInfo.guildName ?? 'Unknown';
              final guildMembersCount = guildInfo.guildMembers?.length ?? 0;

              // „ÇÆ„É´„ÉâÊÉÖÂ†±„Åå„ÅÇ„ÇãÂ†¥Âêà
              return DefaultTabController(
                length: 2, // Tab„ÅÆÊï∞
                child: Column(
                  children: [
                    Expanded(
                      child: NestedScrollView(
                        headerSliverBuilder: (context, innerBoxIsScrolled) {
                          return [
                            SliverToBoxAdapter(
                              child: Padding(
                                padding: const EdgeInsets.symmetric(
                                  horizontal: 24,
                                ),
                                child: Column(
                                  children: [
                                    const SizedBox(height: 24),
                                    DecoratedBox(
                                      decoration: BoxDecoration(
                                        borderRadius: BorderRadius.circular(8),
                                        border: Border.all(
                                          color: ColorToken.secondary,
                                        ),
                                      ),
                                      child: Column(
                                        children: [
                                          GestureDetector(
                                            onTap: () {
                                              Clipboard.setData(
                                                ClipboardData(
                                                  text: guildId,
                                                ),
                                              );
                                              ScaffoldMessenger.of(context)
                                                  .showSnackBar(
                                                SnackBar(
                                                  content: Text(
                                                    'Copied To Clipboard: '
                                                    '$guildId',
                                                  ),
                                                ),
                                              );
                                            },
                                            child: Container(
                                              padding:
                                                  const EdgeInsets.symmetric(
                                                vertical: 12,
                                                horizontal: 16,
                                              ),
                                              decoration: const BoxDecoration(
                                                color: ColorToken.secondary,
                                                borderRadius: BorderRadius.only(
                                                  bottomLeft:
                                                      Radius.circular(12),
                                                  bottomRight:
                                                      Radius.circular(12),
                                                ),
                                              ),
                                              child: Row(
                                                mainAxisSize: MainAxisSize.min,
                                                children: [
                                                  SvgPicture.asset(
                                                    Assets.images.triangleDots
                                                        .path,
                                                  ),
                                                  const SizedBox(width: 8),
                                                  Text(
                                                    guildId,
                                                    style: const TextStyle(
                                                      fontSize: 14,
                                                    ),
                                                  ),
                                                ],
                                              ),
                                            ),
                                          ),
                                          const SizedBox(height: 20),
                                          ClipRRect(
                                            borderRadius:
                                                BorderRadius.circular(8),
                                            child: guildInfo.guildAvatar != null
                                                ? Image.network(
                                                    guildInfo.guildAvatar!,
                                                    width: 64,
                                                    height: 64,
                                                    fit: BoxFit.cover,
                                                  )
                                                : Container(
                                                    width: 64,
                                                    height: 64,
                                                    color: ColorToken.bgDark,
                                                    child: const Icon(
                                                      Icons.hide_image_outlined,
                                                      size: 48,
                                                      color: ColorToken.text,
                                                    ),
                                                  ),
                                          ),
                                          const SizedBox(height: 16),
                                          Text(
                                            guildName,
                                            style: const TextStyle(
                                              fontWeight: FontWeight.bold,
                                              fontSize: 18,
                                            ),
                                          ),
                                          const SizedBox(height: 8),
                                          Row(
                                            mainAxisAlignment:
                                                MainAxisAlignment.center,
                                            children: [
                                              const Icon(
                                                Icons.people,
                                                size: 24,
                                                color: ColorToken.text,
                                              ),
                                              const SizedBox(width: 8),
                                              Text(
                                                '$guildMembersCount',
                                                style: const TextStyle(
                                                  fontSize: 14,
                                                ),
                                              ),
                                            ],
                                          ),
                                          const SizedBox(height: 24),
                                          const Padding(
                                            padding: EdgeInsets.symmetric(
                                              horizontal: 16,
                                            ),
                                            child: Divider(
                                              color: ColorToken.secondary,
                                              height: 0,
                                            ),
                                          ),
                                          const SizedBox(height: 24),
                                          Row(
                                            mainAxisAlignment:
                                                MainAxisAlignment.spaceEvenly,
                                            children: [
                                              _buildStatColumn(
                                                'Search',
                                                3879,
                                                'Q',
                                              ),
                                              _buildStatColumn(
                                                'Attack',
                                                1230,
                                                'E',
                                              ),
                                              _buildStatColumn(
                                                'Luck',
                                                893,
                                                'L',
                                              ),
                                              _buildStatColumn(
                                                'Defence',
                                                905,
                                                'B',
                                              ),
                                            ],
                                          ),
                                          const SizedBox(height: 24),
                                        ],
                                      ),
                                    ),
                                    const SizedBox(height: 24),

                                    // „ÇÆ„É´„Éâ„ÅÆÁÆ°ÁêÜËÄÖ„Åæ„Åü„ÅØÊâÄÊúâËÄÖ„ÅÆÂ†¥Âêà„ÅÆ„ÅøÁÆ°ÁêÜËÄÖÁîªÈù¢„Å∏„ÅÆÂ∞éÁ∑ö„ÇíË°®Á§∫
                                    if (isAdminOrOwner) ...[
                                      OutlinedButton(
                                        onPressed: () {
                                          context.push(Screen.guildManage.path);
                                        },
                                        child: const Stack(
                                          alignment: Alignment.center,
                                          children: [
                                            Center(
                                              child: Text(
                                                'Manage this guild',
                                              ),
                                            ),
                                            Positioned(
                                              right: 0,
                                              child: Icon(
                                                Icons.arrow_forward,
                                                size: 24,
                                                color: ColorToken.text,
                                              ),
                                            ),
                                          ],
                                        ),
                                      ),
                                      const SizedBox(height: 8),
                                    ],
                                  ],
                                ),
                              ),
                            ),
                            SliverPersistentHeader(
                              pinned: true,
                              delegate: _SliverTabBarDelegate(
                                TabBar(
                                  dividerColor: ColorToken.secondary,
                                  indicator: UnderlineTabIndicator(
                                    borderSide: const BorderSide(
                                      color: ColorToken.primary,
                                      width: 4,
                                    ),
                                    insets: EdgeInsets.symmetric(
                                      horizontal:
                                          MediaQuery.of(context).size.width / 4,
                                    ),
                                  ),
                                  labelColor: ColorToken.text,
                                  unselectedLabelColor: ColorToken.secondary,
                                  tabs: const [
                                    Tab(text: 'Members'),
                                    Tab(text: 'Spots'),
                                  ],
                                ),
                              ),
                            ),
                          ];
                        },
                        body: Padding(
                          padding: const EdgeInsets.only(
                            left: 24,
                            right: 24,
                            top: 24,
                          ),
                          child: TabBarView(
                            children: [
                              // Members Tab
                              RefreshIndicator(
                                onRefresh: () async {
                                  await ref
                                      .read(getMyGuildNotifierProvider.notifier)
                                      .getMyGuild();
                                },
                                child: ListView.builder(
                                  itemCount: guildInfo.guildMembers
                                          ?.where(
                                            (member) =&gt;
                                                member.memberStatus ==
                                                    GuildMemberDtoMemberStatus
                                                        .JOINED ||
                                                member.memberStatus ==
                                                    GuildMemberDtoMemberStatus
                                                        .INVITED,
                                          )
                                          .length ??
                                      0,
                                  itemBuilder: (context, index) {
                                    final filteredMembers =
                                        guildInfo.guildMembers!
                                            .where(
                                              (member) =&gt;
                                                  member.memberStatus ==
                                                      GuildMemberDtoMemberStatus
                                                          .JOINED ||
                                                  member.memberStatus ==
                                                      GuildMemberDtoMemberStatus
                                                          .INVITED,
                                            )
                                            .toList();
                                    final member = filteredMembers[index];
                                    final userName =
                                        member.username ?? 'Unknown';
                                    final userPhotoUrl = member.avatar;
                                    return Padding(
                                      padding: const EdgeInsets.only(bottom: 8),
                                      child: DecoratedBox(
                                        decoration: BoxDecoration(
                                          color: ColorToken.bg,
                                          borderRadius:
                                              BorderRadius.circular(4),
                                          border: Border.all(
                                            color: ColorToken.secondary,
                                          ),
                                        ),
                                        child: Padding(
                                          padding: const EdgeInsets.all(16),
                                          child: Row(
                                            children: [
                                              Expanded(
                                                child: Column(
                                                  crossAxisAlignment:
                                                      CrossAxisAlignment.start,
                                                  children: [
                                                    Row(
                                                      children: [
                                                        CircleAvatar(
                                                          radius: 16,
                                                          backgroundImage:
                                                              userPhotoUrl !=
                                                                      null
                                                                  ? NetworkImage(
                                                                      userPhotoUrl,
                                                                    )
                                                                  : AssetImage(
                                                                      Assets
                                                                          .images
                                                                          .defaultUserProfile
                                                                          .path,
                                                                    ),
                                                        ),
                                                        const SizedBox(
                                                          width: 12,
                                                        ),
                                                        Expanded(
                                                          child: Text(
                                                            userName,
                                                            maxLines: 1,
                                                            overflow:
                                                                TextOverflow
                                                                    .ellipsis,
                                                            style:
                                                                const TextStyle(
                                                              color:
                                                                  Colors.white,
                                                              fontSize: 16,
                                                              fontWeight:
                                                                  FontWeight
                                                                      .bold,
                                                            ),
                                                          ),
                                                        ),
                                                      ],
                                                    ),
                                                    const SizedBox(height: 10),
                                                    Row(
                                                      children: List.generate(
                                                        4,
                                                        (badgeIndex) =&gt; Padding(
                                                          padding:
                                                              const EdgeInsets
                                                                  .only(
                                                            right: 4,
                                                          ),
                                                          child: ClipRRect(
                                                            borderRadius:
                                                                BorderRadius
                                                                    .circular(
                                                              4,
                                                            ),
                                                            child: SizedBox(
                                                              width: 28,
                                                              height: 28,
                                                              child:
                                                                  Image.network(
                                                                UriExtensions
                                                                    .random
                                                                    .toString(),
                                                                fit: BoxFit
                                                                    .cover,
                                                              ),
                                                            ),
                                                          ),
                                                        ),
                                                      ),
                                                    ),
                                                  ],
                                                ),
                                              ),
                                              Expanded(
                                                child: Column(
                                                  crossAxisAlignment:
                                                      CrossAxisAlignment.end,
                                                  children: [
                                                    _buildStatRow('Q', 13),
                                                    _buildStatRow('E', 48),
                                                    _buildStatRow('L', 7),
                                                    _buildStatRow('B', 5),
                                                  ],
                                                ),
                                              ),
                                            ],
                                          ),
                                        ),
                                      ),
                                    );
                                  },
                                ),
                              ),

                              // Spots Tab
                              const Center(child: Text('COMING SOON...')),
                            ],
                          ),
                        ),
                      ),
                    ),
                  ],
                ),
              );
            } else {
              // „ÇÆ„É´„ÉâÊÉÖÂ†±„Åå„Å™„ÅÑÂ†¥Âêà
              return const SingleChildScrollView(
                physics: AlwaysScrollableScrollPhysics(),
                child: Padding(
                  padding: EdgeInsets.symmetric(horizontal: 16),
                  child: _NoGuildWidget(),
                ),
              );
            }
          },
          loading: () =&gt; const Center(child: CircularProgressIndicator()),
          error: (error, stackTrace) {
            WidgetsBinding.instance.addPostFrameCallback((_) {
              ScaffoldMessenger.of(context).showSnackBar(
                SnackBar(content: Text('Error: $error')),
              );
            });
            return SingleChildScrollView(
              physics: const AlwaysScrollableScrollPhysics(),
              child: Center(child: Text('An error occurred: $error')),
            );
          },
        ),
      ),
    );
  }

  Widget _buildStatColumn(String title, int value, String subtext) {
    return Column(
      children: [
        Text(
          title,
          style: const TextStyle(
            fontSize: 13,
          ),
        ),
        Text(
          NumberFormat('#,###').format(value),
          style: const TextStyle(
            fontSize: 16,
            color: ColorToken.primary,
          ),
        ),
        Text(
          '($subtext)',
          style: const TextStyle(
            fontSize: 12,
            color: ColorToken.secondary,
          ),
        ),
      ],
    );
  }

  Widget _buildStatRow(String label, int value) {
    return Row(
      mainAxisAlignment: MainAxisAlignment.end,
      children: [
        const SizedBox(
          width: 40,
        ),
        SizedBox(
          width: 20,
          child: Text(
            label,
            style: const TextStyle(
              fontSize: 13,
            ),
          ),
        ),
        const SizedBox(width: 4),
        SizedBox(
          width: 30,
          child: Text(
            NumberFormat('#,###').format(value),
            style: const TextStyle(
              color: ColorToken.primary,
              fontSize: 11,
            ),
          ),
        ),
        const SizedBox(width: 4),
        Expanded(
          child: LinearProgressIndicator(
            value: value / 100, // Max value is 100
            borderRadius: BorderRadius.circular(8),
          ),
        ),
      ],
    );
  }
}

class _NoGuildWidget extends StatelessWidget {
  const _NoGuildWidget();

  @override
  Widget build(BuildContext context) {
    return Column(
      children: [
        const SizedBox(height: 48),
        const Text(
          'No guild affiliation',
          style: TextStyle(
            fontSize: 28,
            fontWeight: FontWeight.bold,
          ),
          textAlign: TextAlign.center,
        ),
        const SizedBox(height: 20),
        const Text(
          'Join a guild or create a new one!',
          style: TextStyle(fontSize: 16),
          textAlign: TextAlign.center,
        ),
        const SizedBox(height: 56),
        Container(
          decoration: BoxDecoration(
            borderRadius: BorderRadius.circular(8),
            border: Border.all(color: ColorToken.secondary),
          ),
          padding: const EdgeInsets.all(24),
          child: Column(
            children: [
              Image.asset(
                Assets.images.joinGuildFig.path,
              ),
              const SizedBox(height: 24),
              ElevatedButton(
                onPressed: () {
                  context.push(Screen.guildCode.path);
                },
                child: const Stack(
                  alignment: Alignment.center,
                  children: [
                    Center(
                      child: Text(
                        'Join an existing guild',
                      ),
                    ),
                    Positioned(
                      right: 0,
                      child: Icon(
                        Icons.arrow_forward,
                        size: 24,
                        color: ColorToken.text,
                      ),
                    ),
                  ],
                ),
              ),
            ],
          ),
        ),
        const SizedBox(height: 16),
        Container(
          decoration: BoxDecoration(
            borderRadius: BorderRadius.circular(8),
            border: Border.all(color: ColorToken.secondary),
          ),
          padding: const EdgeInsets.all(24),
          child: Column(
            children: [
              Image.asset(
                Assets.images.createGuildFig.path,
              ),
              const SizedBox(height: 24),
              ElevatedButton(
                onPressed: () {
                  context.push(Screen.guildCreate.path);
                },
                child: const Stack(
                  alignment: Alignment.center,
                  children: [
                    Center(
                      child: Text('Host a new guild'),
                    ),
                    Positioned(
                      right: 0,
                      child: Icon(
                        Icons.arrow_forward,
                        size: 24,
                        color: ColorToken.text,
                      ),
                    ),
                  ],
                ),
              ),
            ],
          ),
        ),
        const SizedBox(height: 48),
      ],
    );
  }
}

class _SliverTabBarDelegate extends SliverPersistentHeaderDelegate {
  _SliverTabBarDelegate(this.tabBar);
  final TabBar tabBar;

  @override
  double get minExtent =&gt; tabBar.preferredSize.height;

  @override
  double get maxExtent =&gt; tabBar.preferredSize.height;

  @override
  Widget build(
    BuildContext context,
    double shrinkOffset,
    bool overlapsContent,
  ) {
    return ColoredBox(
      color: ColorPallet.gray800,
      child: tabBar,
    );
  }

  @override
  bool shouldRebuild(_SliverTabBarDelegate oldDelegate) {
    return oldDelegate.tabBar != tabBar;
  }
}

---

## üîß Tool
*2025-01-19 16:07:01*

**Refactoring the code**

I‚Äôm mapping out the deep indentation in the GuildPage widget. Breaking down GuildInfoSection and Member tab into separate widgets clarifies the implementation, making the code more comprehensible.

**Breaking down code**

I‚Äôm creating two to three sub-widgets to reduce indentation: the GuildHeader widget from SliverToBoxAdapter and the GuildMembersTabView from TabBarView to streamline the code.

**Streamlining structure**

Organizing the code with "GuildInfoHeader" and "GuildTabsView" sub-widgets, and within "GuildTabsView," incorporating a "MembersList" sub-widget to effectively reduce indentation.

**Refining widget flow**

I‚Äôm mapping out the widget structure to streamline indentation, using separate widget methods to define `_GuildContent` for `DefaultTabController` and `NestedScrollView` implementation.

**Refactoring for clarity**

I‚Äôm working on simplifying widget structures by refining `_buildHeaderSliverBuilder`, extracting tab bar views, and streamlining the members list code to enhance code clarity and reduce complexity.

**Organizing the code**

I‚Äôm working on guiding users through organizing their code with a few classes and methods to streamline the structure while ensuring clarity.

---

## ü§ñ Assistant
*2025-01-19 16:07:01*

‰ª•‰∏ã„ÅÆ‰æã„Åß„ÅØ„ÄÅÊ∑±„ÅÑ„Ç§„É≥„Éá„É≥„Éà„Å´„Å™„Çä„Åå„Å°„Å™ÁÆáÊâÄÔºàÁâπ„Å´„ÇÆ„É´„ÉâÊÉÖÂ†±„ÅÆË°®Á§∫ÈÉ®ÂàÜÔºâ„Çí„ÄÅ„ÅÑ„Åè„Å§„Åã„ÅÆWidget„Å´Âàá„ÇäÂá∫„Åó„Å¶„É™„Éï„Ç°„ÇØ„Çø„É™„É≥„Ç∞„Åó„Åü„ÇÇ„ÅÆ„Åß„Åô„ÄÇ  
„ÄåGuildPage„ÄçËá™‰Ωì„Åß„ÅØÂ§ßÊû†ÔºàScaffold „ÇÑ Future „ÅÆÂëº„Å≥Âá∫„Åó„Å™„Å©Ôºâ„ÇíË°å„ÅÑ„ÄÅÂÆüÈöõ„ÅÆË°®Á§∫„ÅØ„Äå_GuildContent„Äç„Äå_NoGuildWidget„Äç„Å™„Å©„ÅÆWidget„Å´‰ªª„Åõ„Å¶„ÅÑ„Åæ„Åô„ÄÇ  
„ÅÇ„Åæ„ÇäÁ¥∞„Åã„ÅèÂàÜÂâ≤„Åó„Åô„Åé„Åö„Å´„ÄÅÊÑèÂë≥„ÅÆ„ÅÇ„ÇãÂçò‰Ωç„Åß„Åæ„Å®„ÇÅ„Å¶„ÅÑ„Åæ„Åô„ÄÇ

```dart
import 'package:flutter/material.dart';
import 'package:flutter/services.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:flutter_svg/svg.dart';
import 'package:go_router/go_router.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:intl/intl.dart';
import 'package:snpit_guild_app/domain/design/color_pallet.dart';
import 'package:snpit_guild_app/domain/design/color_token.dart';
import 'package:snpit_guild_app/domain/screen.dart';
import 'package:snpit_guild_app/gen/assets.gen.dart';
import 'package:snpit_guild_app/infrastructure/snapit_guild_api/snapit_guild_api.openapi.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/accounts/get_account.dart';
import 'package:snpit_guild_app/presentation/providers/api_client/guilds/get_guild.dart';
import 'package:snpit_guild_app/utils/extensions/uri_extensions.dart';

class GuildPage extends HookConsumerWidget {
  const GuildPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final myUserId = ref.watch(getMyAccountNotifierProvider).value?.userId;
    final myGuildInfoState = ref.watch(getMyGuildNotifierProvider);

    useEffect(
      () {
        Future.microtask(() async {
          await ref.read(getMyGuildNotifierProvider.notifier).getMyGuild();
        });
        return null;
      },
      [],
    );

    return Scaffold(
      body: RefreshIndicator(
        onRefresh: () async {
          await ref.read(getMyGuildNotifierProvider.notifier).getMyGuild();
        },
        child: myGuildInfoState.when(
          data: (guildInfo) {
            if (guildInfo != null) {
              return _GuildContent(
                guildInfo: guildInfo,
                myUserId: myUserId,
              );
            } else {
              // „ÇÆ„É´„ÉâÊÉÖÂ†±„Åå„Å™„ÅÑÂ†¥Âêà
              return const SingleChildScrollView(
                physics: AlwaysScrollableScrollPhysics(),
                child: Padding(
                  padding: EdgeInsets.symmetric(horizontal: 16),
                  child: _NoGuildWidget(),
                ),
              );
            }
          },
          loading: () => const Center(child: CircularProgressIndicator()),
          error: (error, stackTrace) {
            WidgetsBinding.instance.addPostFrameCallback((_) {
              ScaffoldMessenger.of(context).showSnackBar(
                SnackBar(content: Text('Error: $error')),
              );
            });
            return SingleChildScrollView(
              physics: const AlwaysScrollableScrollPhysics(),
              child: Center(child: Text('An error occurred: $error')),
            );
          },
        ),
      ),
    );
  }
}

/// „ÇÆ„É´„ÉâÊÉÖÂ†±„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Çí„Åæ„Å®„ÇÅ„ÅüWidget
class _GuildContent extends StatelessWidget {
  const _GuildContent({
    required this.guildInfo,
    required this.myUserId,
  });

  final GuildDto guildInfo;
  final String? myUserId;

  @override
  Widget build(BuildContext context) {
    final guildId = guildInfo.guildId ?? 'Unknown';
    final guildName = guildInfo.guildName ?? 'Unknown';
    final guildMembersCount = guildInfo.guildMembers?.length ?? 0;
    final isAdminOrOwner = guildInfo.guildMembers?.any(
          (member) =>
              member.userId == myUserId &&
              (member.role == GuildMemberDtoRole.ADMIN ||
                  member.role == GuildMemberDtoRole.OWNER),
        ) ??
        false;

    return DefaultTabController(
      length: 2, // Tab„ÅÆÊï∞
      child: Column(
        children: [
          Expanded(
            child: NestedScrollView(
              headerSliverBuilder: (context, innerBoxIsScrolled) {
                return [
                  // „ÇÆ„É´„Éâ„Éò„ÉÉ„ÉÄ„ÉºÈÉ®ÂàÜ
                  SliverToBoxAdapter(
                    child: _GuildHeader(
                      guildInfo: guildInfo,
                      guildId: guildId,
                      guildName: guildName,
                      guildMembersCount: guildMembersCount,
                      isAdminOrOwner: isAdminOrOwner,
                    ),
                  ),
                  // „Çø„ÉñÈÉ®ÂàÜÔºàÂõ∫ÂÆö„Éò„ÉÉ„ÉÄ„ÉºÔºâ
                  SliverPersistentHeader(
                    pinned: true,
                    delegate: _SliverTabBarDelegate(
                      TabBar(
                        dividerColor: ColorToken.secondary,
                        indicator: UnderlineTabIndicator(
                          borderSide: const BorderSide(
                            color: ColorToken.primary,
                            width: 4,
                          ),
                          insets: EdgeInsets.symmetric(
                            horizontal: MediaQuery.of(context).size.width / 4,
                          ),
                        ),
                        labelColor: ColorToken.text,
                        unselectedLabelColor: ColorToken.secondary,
                        tabs: const [
                          Tab(text: 'Members'),
                          Tab(text: 'Spots'),
                        ],
                      ),
                    ),
                  ),
                ];
              },
              // „Çø„Éñ„Éì„É•„Éº
              body: Padding(
                padding: const EdgeInsets.only(
                  left: 24,
                  right: 24,
                  top: 24,
                ),
                child: TabBarView(
                  children: [
                    // Members Tab
                    _GuildMembersTab(guildInfo: guildInfo),
                    // Spots Tab
                    const Center(child: Text('COMING SOON...')),
                  ],
                ),
              ),
            ),
          ),
        ],
      ),
    );
  }
}

/// „ÇÆ„É´„Éâ„ÅÆ„Éò„ÉÉ„ÉÄ„ÉºÈÉ®ÂàÜÔºà„ÇÆ„É´„ÉâÂêç„ÇÑ„ÇÆ„É´„ÉâID„Å™„Å©„ÅÆË°®Á§∫Ôºâ
class _GuildHeader extends StatelessWidget {
  const _GuildHeader({
    required this.guildInfo,
    required this.guildId,
    required this.guildName,
    required this.guildMembersCount,
    required this.isAdminOrOwner,
  });

  final GuildDto guildInfo;
  final String guildId;
  final String guildName;
  final int guildMembersCount;
  final bool isAdminOrOwner;

  @override
  Widget build(BuildContext context) {
    return Padding(
      padding: const EdgeInsets.symmetric(horizontal: 24),
      child: Column(
        children: [
          const SizedBox(height: 24),
          DecoratedBox(
            decoration: BoxDecoration(
              borderRadius: BorderRadius.circular(8),
              border: Border.all(
                color: ColorToken.secondary,
              ),
            ),
            child: Column(
              children: [
                GestureDetector(
                  onTap: () {
                    Clipboard.setData(
                      ClipboardData(text: guildId),
                    );
                    ScaffoldMessenger.of(context).showSnackBar(
                      SnackBar(
                        content: Text('Copied To Clipboard: $guildId'),
                      ),
                    );
                  },
                  child: Container(
                    padding: const EdgeInsets.symmetric(
                      vertical: 12,
                      horizontal: 16,
                    ),
                    decoration: const BoxDecoration(
                      color: ColorToken.secondary,
                      borderRadius: BorderRadius.only(
                        bottomLeft: Radius.circular(12),
                        bottomRight: Radius.circular(12),
                      ),
                    ),
                    child: Row(
                      mainAxisSize: MainAxisSize.min,
                      children: [
                        SvgPicture.asset(
                          Assets.images.triangleDots.path,
                        ),
                        const SizedBox(width: 8),
                        Text(
                          guildId,
                          style: const TextStyle(fontSize: 14),
                        ),
                      ],
                    ),
                  ),
                ),
                const SizedBox(height: 20),
                ClipRRect(
                  borderRadius: BorderRadius.circular(8),
                  child: guildInfo.guildAvatar != null
                      ? Image.network(
                          guildInfo.guildAvatar!,
                          width: 64,
                          height: 64,
                          fit: BoxFit.cover,
                        )
                      : Container(
                          width: 64,
                          height: 64,
                          color: ColorToken.bgDark,
                          child: const Icon(
                            Icons.hide_image_outlined,
                            size: 48,
                            color: ColorToken.text,
                          ),
                        ),
                ),
                const SizedBox(height: 16),
                Text(
                  guildName,
                  style: const TextStyle(
                    fontWeight: FontWeight.bold,
                    fontSize: 18,
                  ),
                ),
                const SizedBox(height: 8),
                Row(
                  mainAxisAlignment: MainAxisAlignment.center,
                  children: [
                    const Icon(
                      Icons.people,
                      size: 24,
                      color: ColorToken.text,
                    ),
                    const SizedBox(width: 8),
                    Text(
                      '$guildMembersCount',
                      style: const TextStyle(fontSize: 14),
                    ),
                  ],
                ),
                const SizedBox(height: 24),
                const Padding(
                  padding: EdgeInsets.symmetric(horizontal: 16),
                  child: Divider(
                    color: ColorToken.secondary,
                    height: 0,
                  ),
                ),
                const SizedBox(height: 24),
                Row(
                  mainAxisAlignment: MainAxisAlignment.spaceEvenly,
                  children: [
                    _buildStatColumn('Search', 3879, 'Q'),
                    _buildStatColumn('Attack', 1230, 'E'),
                    _buildStatColumn('Luck', 893, 'L'),
                    _buildStatColumn('Defence', 905, 'B'),
                  ],
                ),
                const SizedBox(height: 24),
              ],
            ),
          ),
          const SizedBox(height: 24),
          // „ÇÆ„É´„Éâ„ÅÆÁÆ°ÁêÜËÄÖ„Åæ„Åü„ÅØÊâÄÊúâËÄÖ„ÅÆÂ†¥Âêà„ÅÆ„ÅøÁÆ°ÁêÜËÄÖÁîªÈù¢„Å∏„ÅÆÂ∞éÁ∑ö„ÇíË°®Á§∫
          if (isAdminOrOwner) ...[
            OutlinedButton(
              onPressed: () {
                context.push(Screen.guildManage.path);
              },
              child: const Stack(
                alignment: Alignment.center,
                children: [
                  Center(
                    child: Text('Manage this guild'),
                  ),
                  Positioned(
                    right: 0,
                    child: Icon(
                      Icons.arrow_forward,
                      size: 24,
                      color: ColorToken.text,
                    ),
                  ),
                ],
              ),
            ),
            const SizedBox(height: 8),
          ],
        ],
      ),
    );
  }

  Widget _buildStatColumn(String title, int value, String subtext) {
    return Column(
      children: [
        Text(
          title,
          style: const TextStyle(fontSize: 13),
        ),
        Text(
          NumberFormat('#,###').format(value),
          style: const TextStyle(
            fontSize: 16,
            color: ColorToken.primary,
          ),
        ),
        Text(
          '($subtext)',
          style: const TextStyle(
            fontSize: 12,
            color: ColorToken.secondary,
          ),
        ),
      ],
    );
  }
}

/// Members„Çø„Éñ„ÅÆ„É™„Çπ„ÉàÈÉ®ÂàÜ
class _GuildMembersTab extends ConsumerWidget {
  const _GuildMembersTab({
    required this.guildInfo,
  });

  final GuildDto guildInfo;

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    return RefreshIndicator(
      onRefresh: () async {
        await ref.read(getMyGuildNotifierProvider.notifier).getMyGuild();
      },
      child: ListView.builder(
        itemCount: guildInfo.guildMembers
                ?.where(
                  (member) =>
                      member.memberStatus == GuildMemberDtoMemberStatus.JOINED ||
                      member.memberStatus == GuildMemberDtoMemberStatus.INVITED,
                )
                .length ??
            0,
        itemBuilder: (context, index) {
          final filteredMembers = guildInfo.guildMembers!
              .where(
                (member) =>
                    member.memberStatus == GuildMemberDtoMemberStatus.JOINED ||
                    member.memberStatus == GuildMemberDtoMemberStatus.INVITED,
              )
              .toList();
          final member = filteredMembers[index];
          final userName = member.username ?? 'Unknown';
          final userPhotoUrl = member.avatar;

          return Padding(
            padding: const EdgeInsets.only(bottom: 8),
            child: DecoratedBox(
              decoration: BoxDecoration(
                color: ColorToken.bg,
                borderRadius: BorderRadius.circular(4),
                border: Border.all(
                  color: ColorToken.secondary,
                ),
              ),
              child: Padding(
                padding: const EdgeInsets.all(16),
                child: Row(
                  children: [
                    Expanded(
                      child: Column(
                        crossAxisAlignment: CrossAxisAlignment.start,
                        children: [
                          Row(
                            children: [
                              CircleAvatar(
                                radius: 16,
                                backgroundImage: userPhotoUrl != null
                                    ? NetworkImage(userPhotoUrl)
                                    : AssetImage(
                                        Assets.images.defaultUserProfile.path,
                                      ) as ImageProvider,
                              ),
                              const SizedBox(width: 12),
                              Expanded(
                                child: Text(
                                  userName,
                                  maxLines: 1,
                                  overflow: TextOverflow.ellipsis,
                                  style: const TextStyle(
                                    color: Colors.white,
                                    fontSize: 16,
                                    fontWeight: FontWeight.bold,
                                  ),
                                ),
                              ),
                            ],
                          ),
                          const SizedBox(height: 10),
                          Row(
                            children: List.generate(
                              4,
                              (badgeIndex) => Padding(
                                padding: const EdgeInsets.only(right: 4),
                                child: ClipRRect(
                                  borderRadius: BorderRadius.circular(4),
                                  child: SizedBox(
                                    width: 28,
                                    height: 28,
                                    child: Image.network(
                                      // ÈÅ©ÂÆúÂ§âÊõ¥„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                                      UriExtensions.random.toString(),
                                      fit: BoxFit.cover,
                                    ),
                                  ),
                                ),
                              ),
                            ),
                          ),
                        ],
                      ),
                    ),
                    Expanded(
                      child: Column(
                        crossAxisAlignment: CrossAxisAlignment.end,
                        children: [
                          _buildStatRow('Q', 13),
                          _buildStatRow('E', 48),
                          _buildStatRow('L', 7),
                          _buildStatRow('B', 5),
                        ],
                      ),
                    ),
                  ],
                ),
              ),
            ),
          );
        },
      ),
    );
  }

  Widget _buildStatRow(String label, int value) {
    return Row(
      mainAxisAlignment: MainAxisAlignment.end,
      children: [
        const SizedBox(width: 40),
        SizedBox(
          width: 20,
          child: Text(
            label,
            style: const TextStyle(
              fontSize: 13,
            ),
          ),
        ),
        const SizedBox(width: 4),
        SizedBox(
          width: 30,
          child: Text(
            NumberFormat('#,###').format(value),
            style: const TextStyle(
              color: ColorToken.primary,
              fontSize: 11,
            ),
          ),
        ),
        const SizedBox(width: 4),
        Expanded(
          child: LinearProgressIndicator(
            value: value / 100, // ‰ªÆ„Å´100„ÇíÊúÄÂ§ßÂÄ§„Å®„Åó„Å¶Êâ±„ÅÜ‰æã
            borderRadius: BorderRadius.circular(8),
          ),
        ),
      ],
    );
  }
}

/// „ÇÆ„É´„ÉâÊú™ÊâÄÂ±û„ÅÆÂ†¥Âêà„Å´Ë°®Á§∫„Åï„Çå„ÇãWidget
class _NoGuildWidget extends StatelessWidget {
  const _NoGuildWidget();

  @override
  Widget build(BuildContext context) {
    return Column(
      children: [
        const SizedBox(height: 48),
        const Text(
          'No guild affiliation',
          style: TextStyle(
            fontSize: 28,
            fontWeight: FontWeight.bold,
          ),
          textAlign: TextAlign.center,
        ),
        const SizedBox(height: 20),
        const Text(
          'Join a guild or create a new one!',
          style: TextStyle(fontSize: 16),
          textAlign: TextAlign.center,
        ),
        const SizedBox(height: 56),
        Container(
          decoration: BoxDecoration(
            borderRadius: BorderRadius.circular(8),
            border: Border.all(color: ColorToken.secondary),
          ),
          padding: const EdgeInsets.all(24),
          child: Column(
            children: [
              Image.asset(
                Assets.images.joinGuildFig.path,
              ),
              const SizedBox(height: 24),
              ElevatedButton(
                onPressed: () {
                  context.push(Screen.guildCode.path);
                },
                child: const Stack(
                  alignment: Alignment.center,
                  children: [
                    Center(
                      child: Text('Join an existing guild'),
                    ),
                    Positioned(
                      right: 0,
                      child: Icon(
                        Icons.arrow_forward,
                        size: 24,
                        color: ColorToken.text,
                      ),
                    ),
                  ],
                ),
              ),
            ],
          ),
        ),
        const SizedBox(height: 16),
        Container(
          decoration: BoxDecoration(
            borderRadius: BorderRadius.circular(8),
            border: Border.all(color: ColorToken.secondary),
          ),
          padding: const EdgeInsets.all(24),
          child: Column(
            children: [
              Image.asset(
                Assets.images.createGuildFig.path,
              ),
              const SizedBox(height: 24),
              ElevatedButton(
                onPressed: () {
                  context.push(Screen.guildCreate.path);
                },
                child: const Stack(
                  alignment: Alignment.center,
                  children: [
                    Center(child: Text('Host a new guild')),
                    Positioned(
                      right: 0,
                      child: Icon(
                        Icons.arrow_forward,
                        size: 24,
                        color: ColorToken.text,
                      ),
                    ),
                  ],
                ),
              ),
            ],
          ),
        ),
        const SizedBox(height: 48),
      ],
    );
  }
}

/// „Çø„Éñ„Éê„Éº„Çí SliverPersistentHeader „Å®„Åó„Å¶‰Ωø„ÅÜ„Åü„ÇÅ„ÅÆ„Éá„É™„Ç≤„Éº„Éà
class _SliverTabBarDelegate extends SliverPersistentHeaderDelegate {
  _SliverTabBarDelegate(this.tabBar);

  final TabBar tabBar;

  @override
  double get minExtent => tabBar.preferredSize.height;
  @override
  double get maxExtent => tabBar.preferredSize.height;

  @override
  Widget build(
    BuildContext context,
    double shrinkOffset,
    bool overlapsContent,
  ) {
    return ColoredBox(
      color: ColorPallet.gray800,
      child: tabBar,
    );
  }

  @override
  bool shouldRebuild(_SliverTabBarDelegate oldDelegate) {
    return oldDelegate.tabBar != tabBar;
  }
}
```

---

### „Éù„Ç§„É≥„Éà

1. **_GuildContent „Å®„ÅÑ„ÅÜWidget„Å´Âàá„ÇäÂá∫„Åó**  
   - „ÇÆ„É´„ÉâÊÉÖÂ†±„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„É¨„Ç§„Ç¢„Ç¶„ÉàÔºà`DefaultTabController` „ÇÑ `NestedScrollView`Ôºâ„Çí„Åæ„Å®„ÇÅ„Å¶„Åä„Åè„Åì„Å®„Åß„ÄÅÂÖÉ„ÅÆ `build` „É°„ÇΩ„ÉÉ„Éâ„ÅÆ„Ç§„É≥„Éá„É≥„Éà„ÇíÊµÖ„Åè„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ

2. **_GuildHeader „Å®„ÅÑ„ÅÜWidget„Å´Âàá„ÇäÂá∫„Åó**  
   - „ÇÆ„É´„ÉâID„ÇÑ„ÇÆ„É´„ÉâÂêç„ÄÅÁîªÂÉè„Å™„Å©„ÇíË°®Á§∫„Åô„ÇãÈÉ®ÂàÜ„Çí„Åï„Çâ„Å´„Åæ„Å®„ÇÅ„Çã„Åì„Å®„Åß„ÄÅÂÜóÈï∑„Å´Ê∑±„Åè„Å™„Çä„Åå„Å°„Å†„Å£„ÅüColumn„ÇÑË£ÖÈ£æ„Ç≥„Éº„Éâ„ÇíÊï¥ÁêÜ„Åó„Åæ„Åó„Åü„ÄÇ

3. **_GuildMembersTab „Å®„ÅÑ„ÅÜWidget„Å´Âàá„ÇäÂá∫„Åó**  
   - Members„Çø„Éñ„Å´Ë°®Á§∫„Åô„ÇãListView„Å™„Å©„Çí„Åæ„Å®„ÇÅ„Çã„Åì„Å®„Åß„ÄÅ„Åì„Åì„ÇÇ„Åã„Å™„ÇäÊ∑±„Åã„Å£„Åü„Ç§„É≥„Éá„É≥„Éà„ÇíËß£Ê∂à„Åß„Åç„Åæ„Åô„ÄÇ

4. **_NoGuildWidget „ÅØ„Åù„ÅÆ„Åæ„Åæ**  
   - ÂÖÉ„ÄÖÁã¨Á´ã„Åó„Å¶„ÅÑ„ÇãWidget„Å™„ÅÆ„Åß„ÄÅ‰ªäÂõûÁâπ„Å´Ëß¶„Å£„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇÂøÖË¶Å„Åß„ÅÇ„Çå„Å∞ÂêåÊßò„Å´Á¥∞ÂàÜÂåñ„ÇÇÂèØËÉΩ„Åß„Åô„ÄÇ

5. **TabBarDelegate „ÅÆÂÆöÁæ©„ÅØÊú´Â∞æ„Å´**  
   - „Åì„Å°„Çâ„ÅØ„Çø„ÉñÂõ∫ÂÆö„ÅÆ„Åü„ÇÅ„ÅÆ„ÇØ„É©„Çπ„Åß„Åô„Åå„ÄÅÂàÜÂâ≤„Åô„Çã„Åì„Å®„ÅßÊú¨‰Ωì„Åã„Çâ„ÅØ„Çπ„ÉÉ„Ç≠„É™Âàá„ÇäÈõ¢„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ

„Åì„ÅÆ„Çà„ÅÜ„Å´„ÄÅ**„Äå1ÁîªÈù¢„Å´ÂøÖË¶Å„Å™Ë¶ÅÁ¥†„Çí„É≠„Ç∏„Ç´„É´„Å´ÂàÜÂâ≤„Åó„Å§„Å§„ÄÅÁ¥∞„Åã„ÅèÂàÜ„Åë„Åô„Åé„Å™„ÅÑ„Äç**„Åì„Å®„ÇíÂøÉ„Åå„Åë„Çã„Åì„Å®„Åß„ÄÅ„Ç≥„Éº„Éâ„ÅÆÂèØË™≠ÊÄß„ÇÑ‰øùÂÆàÊÄß„Çí‰∏ä„Åí„Å§„Å§„Ç§„É≥„Éá„É≥„Éà„ÅÆÊ∑±„Åï„ÇíËß£Ê∂à„Åß„Åç„Åæ„Åô„ÄÇ

---

# コード改善提案

Date: 2024-12-23

---

## 👤 User
*2024-12-23 20:10:11*

{
  "content_type": "image_asset_pointer",
  "asset_pointer": "file-service://file-Ccf7ZTs1PfKviumH879oSS",
  "size_bytes": 98249,
  "width": 417,
  "height": 834,
  "fovea": null,
  "metadata": {
    "dalle": null,
    "gizmo": null,
    "generation": null,
    "container_pixel_height": null,
    "container_pixel_width": null,
    "emu_omit_glimpse_image": null,
    "emu_patches_override": null,
    "sanitized": true,
    "asset_pointer_link": null,
    "watermarked_asset_pointer": null
  }
}
前任者のコードを引き継いでいる。
SafeAreaはいらない気がしている。
GestureDetector onTapのFocusScope.of(context).unfocus();はhooksでどうにか表現できないのか。
 * 0.35, なども意味はなくアスペクト比を維持したまま治ればいいんだ。

import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:flutter_svg/flutter_svg.dart';
import 'package:go_router/go_router.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:snpit_guild_app/domain/screen.dart';
import 'package:snpit_guild_app/gen/assets.gen.dart';
import 'package:snpit_guild_app/presentation/design_token/color_token.dart';

class LoginPage extends HookConsumerWidget {
  const LoginPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final textEditingController = useTextEditingController();

    void handleLogin() {
      debugPrint(textEditingController.text);
      context.push(Screen.verificationCode.path);
    }

    return GestureDetector(
      onTap: () {
        FocusScope.of(context).unfocus();
      },
      child: Scaffold(
        body: SafeArea(
          child: Padding(
            padding: const EdgeInsets.symmetric(horizontal: 40),
            child: Builder(
              builder: (context) {
                return SingleChildScrollView(
                  child: SizedBox(
                    child: Column(
                      crossAxisAlignment: CrossAxisAlignment.stretch,
                      mainAxisAlignment: MainAxisAlignment.center,
                      children: [
                        SvgPicture.asset(Assets.images.logoLogin.path),
                        const SizedBox(
                          height: 38,
                        ),
                        Image.asset(
                          Assets.images.animalsLogin.path,
                          height: MediaQuery.of(context).size.height * 0.35,
                        ),
                        const SizedBox(height: 52),
                        SizedBox(
                          height: 48,
                          child: TextField(
                            controller: textEditingController,
                            decoration: const InputDecoration(
                              prefixIcon: Padding(
                                padding: EdgeInsets.all(12),
                                child: Icon(
                                  Icons.email_outlined,
                                  color: ColorToken.text,
                                  size: 24,
                                ),
                              ),
                              hintText: 'Enter your email',
                            ),
                          ),
                        ),
                        const SizedBox(height: 24),
                        ElevatedButton(
                          onPressed: handleLogin,
                          child: const Text('Login'),
                        ),
                        const SizedBox(height: 24),
                      ],
                    ),
                  ),
                );
              },
            ),
          ),
        ),
      ),
    );
  }
}

---

## 🤖 Assistant
*2024-12-23 20:10:30*

以下の内容を改善して、コードをより効率的で読みやすく、かつユーザーの意図に合うようにします。

### 改善点
1. **SafeAreaの削除**: 背景色が全体を覆うため、SafeAreaは不要かもしれません。
2. **GestureDetectorのリファクタリング**: `GestureDetector`の`onTap`をフックを使って管理する。
3. **アスペクト比の維持**: 固定値の`0.35`をAspectRatioウィジェットに置き換える。
4. **全体的な構造の見直し**: よりモジュール化してコードを簡潔にする。

以下は改善後のコードです：

```dart
import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:flutter_svg/flutter_svg.dart';
import 'package:go_router/go_router.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:snpit_guild_app/domain/screen.dart';
import 'package:snpit_guild_app/gen/assets.gen.dart';
import 'package:snpit_guild_app/presentation/design_token/color_token.dart';

class LoginPage extends HookConsumerWidget {
  const LoginPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final textEditingController = useTextEditingController();

    // フォーカスを外すためのフック
    final unfocus = useCallback(() {
      FocusScope.of(context).unfocus();
    }, [context]);

    void handleLogin() {
      debugPrint(textEditingController.text);
      context.push(Screen.verificationCode.path);
    }

    return Scaffold(
      body: GestureDetector(
        onTap: unfocus,
        child: Padding(
          padding: const EdgeInsets.symmetric(horizontal: 40),
          child: Center(
            child: SingleChildScrollView(
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.stretch,
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  SvgPicture.asset(Assets.images.logoLogin.path),
                  const SizedBox(height: 38),
                  AspectRatio(
                    aspectRatio: 1, // 正方形に近い比率にする
                    child: Image.asset(Assets.images.animalsLogin.path),
                  ),
                  const SizedBox(height: 52),
                  SizedBox(
                    height: 48,
                    child: TextField(
                      controller: textEditingController,
                      decoration: const InputDecoration(
                        prefixIcon: Padding(
                          padding: EdgeInsets.all(12),
                          child: Icon(
                            Icons.email_outlined,
                            color: ColorToken.text,
                            size: 24,
                          ),
                        ),
                        hintText: 'Enter your email',
                      ),
                    ),
                  ),
                  const SizedBox(height: 24),
                  ElevatedButton(
                    onPressed: handleLogin,
                    child: const Text('Login'),
                  ),
                  const SizedBox(height: 24),
                ],
              ),
            ),
          ),
        ),
      ),
    );
  }
}
```

### 改善点の詳細
1. **SafeAreaの削除**:
   - `SafeArea`は不要な場合は削除しました。

2. **GestureDetectorのリファクタリング**:
   - `useCallback`を使用して、`GestureDetector`の`onTap`をフックで管理しました。

3. **アスペクト比の維持**:
   - `AspectRatio`ウィジェットを使うことで、高さに対する幅の比率を簡単に制御しました。

4. **シンプルなレイアウト**:
   - `Builder`を削除し、コードをシンプルにしました。

これにより、コードの可読性が向上し、リファクタリングに適した構造になりました！

---

## 👤 User
*2024-12-23 20:12:34*

useCallback をする必要あるのかな？いまいちわかっていない。GestureDetectorを全体で囲むのはどうなのか？

---

## 🤖 Assistant
*2024-12-23 20:12:53*

`useCallback`を使う必要があるかどうか、また`GestureDetector`を全体で囲むべきかについて説明します。

---

### **1. `useCallback` の必要性**
`useCallback`は、関数が再生成されるのを防ぐために使用します。しかし、以下のような状況では使用しなくても問題ありません：
- 状態やプロパティに依存しないシンプルな関数。
- 再生成のコストが低い関数。

現在のコードでは`FocusScope.of(context).unfocus()`は非常に軽量で依存もありません。そのため、`useCallback`を使わずに、`GestureDetector`内で直接`onTap`に定義すれば十分です。

---

### **2. `GestureDetector`を全体で囲むべきか**
`GestureDetector`を`Scaffold`全体で囲むことについてですが、次のポイントを考えると良いです：

#### **メリット**
- **直感的**: 画面全体のタップでフォーカスを外す挙動を簡単に実現できる。
- **シンプルな実装**: `GestureDetector`を局所的に配置するよりも一貫性がある。

#### **デメリット**
- **意図しない動作**: 他のタップイベントが必要な部分（ボタンやリンク）にも影響を与える可能性がある。

ただし、現在のコードでは特に他のタップイベントに影響を与える箇所がないため、画面全体を`GestureDetector`で囲む方法は妥当です。

---

### **修正したコード**
以下は`useCallback`を省略し、`GestureDetector`で画面全体を囲んだコードです：

```dart
import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:flutter_svg/flutter_svg.dart';
import 'package:go_router/go_router.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:snpit_guild_app/domain/screen.dart';
import 'package:snpit_guild_app/gen/assets.gen.dart';
import 'package:snpit_guild_app/presentation/design_token/color_token.dart';

class LoginPage extends HookConsumerWidget {
  const LoginPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final textEditingController = useTextEditingController();

    void handleLogin() {
      debugPrint(textEditingController.text);
      context.push(Screen.verificationCode.path);
    }

    return GestureDetector(
      onTap: () {
        // フォーカスを外す
        FocusScope.of(context).unfocus();
      },
      child: Scaffold(
        body: Padding(
          padding: const EdgeInsets.symmetric(horizontal: 40),
          child: Center(
            child: SingleChildScrollView(
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.stretch,
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  SvgPicture.asset(Assets.images.logoLogin.path),
                  const SizedBox(height: 38),
                  AspectRatio(
                    aspectRatio: 1, // 正方形に近い比率に設定
                    child: Image.asset(Assets.images.animalsLogin.path),
                  ),
                  const SizedBox(height: 52),
                  SizedBox(
                    height: 48,
                    child: TextField(
                      controller: textEditingController,
                      decoration: const InputDecoration(
                        prefixIcon: Padding(
                          padding: EdgeInsets.all(12),
                          child: Icon(
                            Icons.email_outlined,
                            color: ColorToken.text,
                            size: 24,
                          ),
                        ),
                        hintText: 'Enter your email',
                      ),
                    ),
                  ),
                  const SizedBox(height: 24),
                  ElevatedButton(
                    onPressed: handleLogin,
                    child: const Text('Login'),
                  ),
                  const SizedBox(height: 24),
                ],
              ),
            ),
          ),
        ),
      ),
    );
  }
}
```

---

### **ポイントまとめ**
1. **`useCallback`は不要**:
   - 現在の`onTap`は軽量なため使わなくてOK。

2. **`GestureDetector`で全体を囲むのは良い選択**:
   - 特に他のタップイベントを追加しない場合、全体を囲むことでシンプルに実現できます。

3. **他の改善点**:
   - `SafeArea`を除去し、`AspectRatio`で画像の比率を管理することでコードをさらに簡潔にしました。

この構成で問題ないと思いますが、もし他の要件や制約があれば教えてください！

---

## 👤 User
*2024-12-23 20:14:28*

handleLogin は関数に分けなくていいです。
AspectRatio は 正方形とは限らない。Flutterでsvgの縦横比率を維持しながらコンテンツを広げる方法がわかっていない

---

## 🤖 Assistant
*2024-12-23 20:14:53*

SVG画像をFlutterで縦横比を維持しつつ、画面幅に応じて広げるには、`SvgPicture.asset`と`FittedBox`または`BoxFit`を使用するのが良い方法です。

以下は、コードをリファクタリングして、`AspectRatio`ではなく、`SvgPicture`を縦横比を維持したまま画面幅に応じて拡大・縮小する方法を実現した例です。

---

### 修正後のコード
```dart
import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:flutter_svg/flutter_svg.dart';
import 'package:go_router/go_router.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:snpit_guild_app/domain/screen.dart';
import 'package:snpit_guild_app/gen/assets.gen.dart';
import 'package:snpit_guild_app/presentation/design_token/color_token.dart';

class LoginPage extends HookConsumerWidget {
  const LoginPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final textEditingController = useTextEditingController();

    return GestureDetector(
      onTap: () {
        // フォーカスを外す
        FocusScope.of(context).unfocus();
      },
      child: Scaffold(
        body: Padding(
          padding: const EdgeInsets.symmetric(horizontal: 40),
          child: Center(
            child: SingleChildScrollView(
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.stretch,
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  // ロゴ (SVG画像を横幅いっぱいで表示)
                  SvgPicture.asset(
                    Assets.images.logoLogin.path,
                    fit: BoxFit.contain,
                    width: MediaQuery.of(context).size.width * 0.6,
                  ),
                  const SizedBox(height: 38),
                  // 動物イラスト (縦横比を維持しながら拡大)
                  SvgPicture.asset(
                    Assets.images.animalsLogin.path,
                    fit: BoxFit.contain,
                    width: MediaQuery.of(context).size.width * 0.8,
                  ),
                  const SizedBox(height: 52),
                  // メールアドレス入力フィールド
                  SizedBox(
                    height: 48,
                    child: TextField(
                      controller: textEditingController,
                      decoration: const InputDecoration(
                        prefixIcon: Padding(
                          padding: EdgeInsets.all(12),
                          child: Icon(
                            Icons.email_outlined,
                            color: ColorToken.text,
                            size: 24,
                          ),
                        ),
                        hintText: 'Enter your email',
                      ),
                    ),
                  ),
                  const SizedBox(height: 24),
                  // ログインボタン
                  ElevatedButton(
                    onPressed: () {
                      debugPrint(textEditingController.text);
                      context.push(Screen.verificationCode.path);
                    },
                    child: const Text('Login'),
                  ),
                  const SizedBox(height: 24),
                ],
              ),
            ),
          ),
        ),
      ),
    );
  }
}
```

---

### 修正点の詳細

1. **SVG画像の縦横比維持**:
   - `SvgPicture.asset`の`fit`プロパティを`BoxFit.contain`に設定することで、画像が縦横比を維持しつつ、親要素の領域内に収まるようにしました。

2. **幅の調整**:
   - `MediaQuery.of(context).size.width`を使って、画面幅に応じた大きさに調整しました。
   - ロゴの幅を60%、動物イラストの幅を80%に設定しています（必要に応じて変更可能）。

3. **`AspectRatio`の代わりに`BoxFit`**:
   - `AspectRatio`は固定の比率を適用するため、柔軟性がありません。
   - `BoxFit.contain`はコンテンツの縦横比を維持しながら領域に収めるため、用途に合っています。

---

### 補足
- **その他の`BoxFit`オプション**:
  - `BoxFit.fill`: 領域全体を埋める（縦横比は維持されない）。
  - `BoxFit.cover`: 領域全体を埋めつつ、縦横比を維持する（画像の一部が切れる可能性あり）。
  - `BoxFit.none`: 画像のサイズを変更せず表示。

- **SVGの制約**:
  FlutterではSVGがコンテナ内でどのように表示されるかを`BoxFit`で簡単に制御できます。ただし、元画像のビューサイズや比率が適切に設定されている必要があります。

---

### 動作確認
この方法で、SVG画像の縦横比が維持されながら、画面幅に合わせて適切に拡大・縮小されるはずです。必要に応じて`width`や`fit`の値を微調整してください。

---

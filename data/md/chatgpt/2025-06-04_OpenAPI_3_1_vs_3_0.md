# OpenAPI 3.1 vs 3.0

Date: 2025-06-04

---

## 👤 User
*2025-06-05 01:23:19*

OpenAPI 仕様 は 3.0.3 と 3.1.0 のどちらを使うべきか？また、世の中のエコシステムはどこまで 3.1.0に対応されているのか？

---

## 🤖 Assistant
*2025-06-05 01:24:38*

### 結論（ざっくり）
| 目的 | 無難にいくなら | 3.1 に挑戦したいなら |
| ---- | -------------- | -------------------- |
| **クラウド API ゲートウェイに取り込みたい**&lt;br&gt;（API Gateway, Azure APIM など） | **3.0.3** 一択 | △ まだ実運用は厳しい |
| **自前ツールチェーン（Swagger UI／Redoc／Stoplight／Postman／Spectral 等）で設計・ドキュメント・モック・テストを回す** | 3.0.3 でも 3.1 でも可 | **3.1** が快適 |
| **コード自動生成**&lt;br&gt;（openapi-generator, oapi-codegen, etc.） | 3.0.3 | 3.1 は β/部分対応 |
| **TypeScript エコシステム**&lt;br&gt;@hey-api/openapi-ts, zod-openapi など | どちらも可 | **3.1 完全対応** |

&gt; **新規開発で** SaaS やクラウド製品に spec をインポートする予定が無ければ 3.1.0 を選び、  
&gt; **既存サービス連携や AWS/Azure のインポートが必須** なら 3.0.3 を残しておく――という住み分けが 2025 年 6 月時点の現実解です。

---

## 1. 3.1.0 で追加・改善されたポイント

| 主な変更点 | 3.0.3 | 3.1.0 |
| ---------- | ------ | ------ |
| **JSON Schema 準拠** | 独自サブセット | Draft 2020-12 そのまま citeturn4search2 |
| **`$schema` ルート宣言** | なし | あり（方言を明示） citeturn4search2 |
| **`webhooks` オブジェクト** | なし | 標準化 citeturn4search2 |
| **`nullable`** | 独自キーワード | `type: [ ..., "null" ]` に統合 |
| **`$ref` と兄弟キー併用** | 禁止 | 許可（JSON Schema と同一） |

これにより **型表現の柔軟性** と **テスト／バリデーションの一貫性** が大幅に向上します。実装済みの Zod スキーマをそのまま移植したい場合など、3.1 の方がストレスがありません。

---

## 2. 現在のエコシステム対応状況（2025-06）

| カテゴリ | ツール例 | 3.1 対応状況 | 補足 |
| --- | --- | --- | --- |
| **エディタ / ビューア** | Swagger UI / Editor, Swagger Parser | **公式対応済み** citeturn0search1 | `swagger-editor` は v5 系で安定動作 |
|  | Redoc / Redocly | **公式対応済み** citeturn0search8 | Redoc CLI でも OK |
|  | Stoplight Studio / Elements / Spectral | **対応済み** citeturn3search0turn3search1 | Lint ルールも 3.1 方言で動作 |
|  | Postman | **インポート & 編集可** citeturn0search4 |
| **Lint / 変換ライブラリ** | `pb33f/libopenapi`, `@apidevtools/swagger-parser@10` | **フルサポート** citeturn5search9 |
| **TypeScript コードジェネレータ** | `@hey-api/openapi-ts` | **3.1 ネイティブ** citeturn7search0 |
|  | `openapi-zod-client` | 3.1 対応（v0.9 以降） |
| **多言語 SDK / サーバー Stub** | openapi-generator (CLI / Maven / Gradle) | **βレベル**（7.7 以降「部分対応」） citeturn6search1 |
|  | Swagger Codegen (旧) | 未サポート |
| **クラウド API ゲートウェイ** | AWS API Gateway | **v3.0 まで** citeturn8search1 |
|  | Azure API Management | **インポート制限あり**（内部は 3.0 検証） citeturn3search8turn8search0 |
|  | Google Cloud Endpoints / Apigee | **v2.0 / 3.0 のみ** citeturn8search2 |
| **VS Code 拡張** | 42Crunch, Swagger Viewer | 一部 3.1 未対応プラグインあり citeturn4search0 |

---

## 3. 選定ガイドライン

1. **社内完結・モダン TypeScript スタック（Hono + @hey-api/openapi-ts など）**  
   *→ **3.1.0** で問題なし。JSON Schema 2020-12 と Zod スキーマの相互運用も楽。*

2. **AWS / Azure に spec を直接インポートしてデプロイ**  
   *→ 2025-06 時点では **3.0.3 が安全**。3.1 を書くなら “ビルド時に 3.0.3 へダウングレード” する変換パイプを用意すると良い。*

3. **多言語 SDK を openapi-generator で量産**  
   *→ まだ 3.1 は edge ケースで生成失敗が散見。全ターゲット言語で動くことを確認できるまで 3.0.3 を推奨。*

4. **ドキュメント閲覧・モック・Lint を Stoplight / Redoc / Swagger で回すだけ**  
   *→ ほぼ全ツールが 3.1 対応済みなので **3.1 移行メリット大**。*

---

## 4. 実務で混在させるコツ

- **バージョンごとに CI ジョブを分離**  
  `main` ブランチは 3.1、`aws-release` ブランチで CI 変換（`libopenapi` + `oas@next convert --to 3.0.3` など）。
- **スキーマ変換ツールを使う**  
  `libopenapi`, `swagger-cli bundle` で `--oas=3.0` を指定してダウングレード。
- **IDE プラグインが 3.1 未対応なら**  
  Spectral CLI を使ったプリコミット lint で補完。

---

### まとめ

- **3.1.0** は *設計表現の自由度* と *JSON Schema 互換* が魅力。  
- とはいえ **クラウドゲートウェイと多言語コード生成はまだ完全追随していない**。  
- **「どこに spec を持ち込むのか」** を軸に、プロジェクトごとに 3.1 / 3.0.3 を使い分けるのが 2025 年のベストプラクティスです。

---

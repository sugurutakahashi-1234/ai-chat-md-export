# タブViewでのpush遷移

Date: 2023-06-07

---

## 👤 User
*2023-06-07 16:57:09*

SwiftUIでタブViewを実装していたのだけれども、とあるタブでpush遷移したらタブバーがなくなってしまった。タブバーの上でpush遷移したいのだけれどもそうすればいい？

---

## 🤖 Assistant
*2023-06-07 16:57:40*

SwiftUIでは、遷移（Navigation）を行う際に、ヒエラルキーの一部として `NavigationView` を使用します。しかし、この `NavigationView` を使って遷移した場合、遷移先のViewでは `TabView` が覆われてしまうため、タブバーが見えなくなってしまいます。

これを解決するためには、`TabView` 内部にそれぞれ `NavigationView` を設置することで、各タブが独立した `NavigationView` を持つようにします。これにより、タブ内部での遷移はそのタブ内で閉じるため、タブバーが見え続けます。

以下にそのコードを記述します：

```swift
struct ContentView: View {
    @State private var selectedTab = 0

    var body: some View {
        TabView(selection: $selectedTab) {
            NavigationView {
                Text("First View")
                .navigationBarTitle("First")
                .navigationBarItems(trailing: Button(action: {
                    // Put your action here
                }) {
                    Text("Push")
                })
            }
            .tabItem {
                Image(systemName: "1.square.fill")
                Text("First")
            }.tag(0)
            
            NavigationView {
                Text("Second View")
                .navigationBarTitle("Second")
            }
            .tabItem {
                Image(systemName: "2.square.fill")
                Text("Second")
            }.tag(1)
        }
    }
}
```

このようにすると、各タブが独立した `NavigationView` を持つため、タブ内部での遷移がそのタブ内で完結します。したがって、タブバーが常に表示され続けます。

---

## 👤 User
*2023-06-07 17:02:26*

これもしかして、tabViewの外側のナビゲーションViewで囲ってしまうと良くないよね？

---

## 🤖 Assistant
*2023-06-07 17:02:56*

その通りです。`TabView` を `NavigationView` で囲むと、タブ内で行う遷移が全体に影響を及ぼし、その結果タブバーが表示されなくなります。

正確には、SwiftUIでは `NavigationView` が新たな「ナビゲーションスタック」を作成します。そのため、`TabView` 全体を一つの `NavigationView` で囲むと、全てのタブが同じナビゲーションスタックを共有することになります。その結果、一つのタブで遷移を行うと、その遷移が他のタブにも影響を及ぼし、タブバーが消えるという問題が生じます。

これを解決するためには、前述のように各タブ内に独立した `NavigationView` を設置するのが最善の方法です。これにより各タブが独自のナビゲーションスタックを持ち、タブ内で行う遷移がそのタブ内で完結するため、タブバーが常に表示されるようになります。

---

## 👤 User
*2023-06-07 17:44:33*

sheetで表示したナビゲーションViewを閉じる方法をおしえてほしい

---

## 🤖 Assistant
*2023-06-07 17:45:11*

SwiftUIでは、`sheet`の表示や非表示を制御するために、Boolean型のState変数を使用します。`sheet`メソッドは、このState変数がtrueのときに表示され、falseのときに非表示になります。

以下に、NavigationViewを含むsheetを表示し、閉じる例を示します：

```swift
struct ContentView: View {
    @State private var isSheetPresented = false

    var body: some View {
        Button(action: {
            self.isSheetPresented.toggle()
        }) {
            Text("Open Sheet")
        }
        .sheet(isPresented: $isSheetPresented) {
            MySheetView(isPresented: $isSheetPresented)
        }
    }
}

struct MySheetView: View {
    @Binding var isPresented: Bool

    var body: some View {
        NavigationView {
            Text("This is a sheet with a NavigationView")
            .navigationBarTitle("Sheet Title")
            .navigationBarItems(trailing: Button("Done") {
                self.isPresented = false
            })
        }
    }
}
```

この例では、`ContentView`内のボタンが押されると、`isSheetPresented` Stateがtoggleされ、sheetが表示されます。表示されるsheetは、`MySheetView`であり、このView内に`NavigationView`が含まれています。

`MySheetView`の"Done"ボタンが押されると、引数として渡されている`isPresented` Bindingがfalseに設定され、それによりsheetが閉じます。`@Binding`を使用すると、`MySheetView`内から`ContentView`のState変数を変更することが可能になります。

---

## 👤 User
*2023-06-07 17:45:28*

dismissをつかってほしい。左上にcancel ボタンを設置して欲しい

---

## 🤖 Assistant
*2023-06-07 17:45:57*

NavigationViewの内部で `@Environment(\.dismiss) var dismiss` を使用して、左上にキャンセルボタンを設置することができます。これにより、sheetを閉じることが可能です。

以下にその例を示します：

```swift
struct ContentView: View {
    @State private var isSheetPresented = false

    var body: some View {
        Button(action: {
            self.isSheetPresented.toggle()
        }) {
            Text("Open Sheet")
        }
        .sheet(isPresented: $isSheetPresented) {
            MySheetView()
        }
    }
}

struct MySheetView: View {
    @Environment(\.dismiss) var dismiss

    var body: some View {
        NavigationView {
            Text("This is a sheet with a NavigationView")
            .navigationBarTitle("Sheet Title")
            .toolbar {
                ToolbarItem(placement: .cancellationAction) {
                    Button("Cancel") {
                        dismiss?.callAsFunction()
                    }
                }
            }
        }
    }
}
```

この例では、`MySheetView`内で `@Environment(\.dismiss)` を使用して `dismiss`を取得しています。この`dismiss`は、`Button` のアクション内で `callAsFunction()` を呼び出すことで、sheetを閉じることができます。キャンセルボタンは `toolbar` メソッドと `ToolbarItem` を使用して設置しています。

---

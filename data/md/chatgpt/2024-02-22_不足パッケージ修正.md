# 不足パッケージ修正

日付: 2024-02-22

---

## 👤 ユーザー
*2024/2/22 17:45:42*

足りないカンマなどを探してほしい


let package = Package(
    name: "DISampleAppPackage",
    defaultLocalization: "ja",
    platforms: [
        .iOS(.v17),
        .macOS(.v14),
    ],
    products: [
        .library(name: "DependencyInjectorLayer", targets: ["DependencyInjectorLayer"]),
        .library(name: "DomainLayer", targets: ["DomainLayer"]),
        .library(name: "PresentationLayer", targets: ["PresentationLayer"]),
        .library(name: "PreviewCatalogLayer", targets: ["PreviewCatalogLayer"]),
        .library(name: "ScenarioCatalogLayer", targets: ["ScenarioCatalogLayer"]),
    ],
    dependencies: [
        // Library
        .package(url: "https://github.com/firebase/firebase-ios-sdk.git", exact: "10.19.0"), // TODO: 10.22 以上がリリースされたらアップデートする（直らないかもしれないが） https://github.com/firebase/firebase-ios-sdk/issues/12390
        .package(url: "https://github.com/playbook-ui/playbook-ios.git", from: "0.3.5"),
        .package(url: "https://github.com/doordash-oss/swiftui-preview-snapshots", from: "1.1.1"),
        .package(url: "https://github.com/EmergeTools/SnapshotPreviews-iOS", from: "0.8.4"),

        // Plugin
        .package(url: "https://github.com/maiyama18/LicensesPlugin", from: "0.1.6"),
        
        // CLI
        .package(url: "https://github.com/uber/mockolo", from: "2.0.1"),
    ],
    targets: [
        // MARK: Dependency Injector layer
        .target(
            name: targetName(.dependencyInjector),
            dependencies: [
                .domainLayer,
                .presentationLayer,
                .licenseFramework,
                .loggerFramework,
                .cloudServiceFramework,
            ],
            path: sourcesPath(.dependencyInjector)
        ),
        
        // MARK: Domain layer
        .target(
            name: targetName(.domain),
            dependencies: [],
            path: sourcesPath(.domain)
        ),

        // MARK: Framework layer
        .target(
            name: "LoggerFramework",
            dependencies: [
                .domainLayer
            ],
            path: sourcesPath(.framework) + "Logger"
        ),
        .target(
            name: "LicenseFramework",
            dependencies: [
                .domainLayer
            ],
            path: sourcesPath(.framework) + "License",
            plugins: [
                .licensesPlugin,
            ]
        ),
        .target(
            name: "CloudServiceFramework",
            dependencies: [
                .domainLayer,
                .firebaseAnalytics,
            ],
            path: sourcesPath(.framework) + "CloudService"
        ),

        // MARK: Presentation layer
        .target(
            name: targetName(.presentation),
            dependencies: [
                .domainLayer,
                .previewSnapshots,
            ],
            path: sourcesPath(.presentation)
        ),
        
        // MARK: Preview Catalog layer
        .target(
            name: targetName(.previewCatalog),
            dependencies: [
                .presentationLayer, // PreviewGallery() 行うモジュールに依存させるとその Preview が生成される
                .previewGallery,
            ],
            path: sourcesPath(.previewCatalog)
        ),
        
        // MARK: Scenario Catalog layer
        .target(
            name: targetName(.scenarioCatalog),
            dependencies: [
                .playbook,
                .playbookUI,
                .domainLayer,
                .presentationLayer,
            ],
            path: sourcesPath(.scenarioCatalog)
        ),

        // MARK: Tests
        .testTarget(
            name: "SnapshotTests",
            dependencies: [
                .presentationLayer,
                .previewSnapshotsTesting,
            ]
        ),
    ]
)

---

## 🤖 アシスタント
*2024/2/22 17:46:43*

コードをチェックした結果、いくつかの不具合や足りないカンマを見つけました。以下、修正が必要なポイントです：

1. `targets` 内の `.target` と `.testTarget` の各 `dependencies` 配列で、依存関係を文字列で指定していますが、これらは `.product(name: "製品名", package: "パッケージ名")` の形式か、もしくは単純な文字列（ただし、同じパッケージ内のターゲットに限る）であるべきです。例えば、`.domainLayer` や `.presentationLayer` などが正しくない可能性があります。

2. 各 `.target` 内で使用されている `targetName(.domain)`, `sourcesPath(.domain)` などの関数や変数がコードの中で定義されていないため、これらが実際に存在するか確認する必要があります。これらはおそらくユーザー定義のヘルパー関数や変数でしょう。

3. また、`.licensesPlugin`, `.firebaseAnalytics`, `.previewSnapshots`, `.previewSnapshotsTesting`, `.previewGallery`, `.playbook`, および `.playbookUI` がどのように定義されているかについても同様の問題があります。これらは正しく依存関係を表すために、適切な形式（例えば、`.product(name: "製品名", package: "パッケージ名")`）に修正する必要があります。

4. コメント `// TODO: 10.22 以上がリリースされたらアップデートする（直らないかもしれないが） https://github.com/firebase/firebase-ios-sdk/issues/12390` はアクションアイテムとして残しておくべきで、この部分に関するコードの修正は必要ありません。

修正が必要な箇所を示すために、一部の `.target` と `.testTarget` の `dependencies` の正しい形式への修正例を示します：

```swift
// MARK: Dependency Injector layer
.target(
    name: targetName(.dependencyInjector),
    dependencies: [
        .product(name: "DomainLayer", package: "パッケージ名"),
        .product(name: "PresentationLayer", package: "パッケージ名"),
        // 他の依存関係も同様に修正
    ],
    path: sourcesPath(.dependencyInjector)
),
```

上記の修正は、実際には存在するパッケージ名に置き換える必要があります。また、このコードのコンテキストや、`targetName` や `sourcesPath` などのユーザー定義関数の実装に応じて、さらに修正が必要になるかもしれません。

---

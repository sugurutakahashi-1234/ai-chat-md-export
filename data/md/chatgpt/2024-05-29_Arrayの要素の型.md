# Arrayの要素の型

Date: 2024-05-29

---

## 👤 User
*2024-05-29 11:36:07*

\(type(of: subObjects)) のときに Array&lt;Any&gt; となってしまう。

---

## 🤖 Assistant
*2024-05-29 11:36:17*

`type(of:)` 関数を使うときに `Array<Any>` となってしまう場合、それは Swift が配列の要素の具体的な型情報を失ってしまっていることを意味します。具体的な型を取得するためには、配列の要素にアクセスしてその型を調べる必要があります。

以下の例で、配列の要素の型を取得する方法を示します。

```swift
let subObjects: [Any] = [1, "string", 3.14]

// 配列全体の型を取得すると Array<Any> になる
print(type(of: subObjects)) // Array<Any>

// 各要素の型を個別に取得する
for element in subObjects {
    print(type(of: element))
}
```

このコードでは、`subObjects` 配列の各要素の型を個別に出力しています。それぞれの要素の型が異なる場合、それぞれの型が正しく出力されることがわかります。

もし `subObjects` 配列が特定の型を持つことが期待されている場合、型を具体的に指定することができます：

```swift
let subObjects: [String] = ["one", "two", "three"]

print(type(of: subObjects)) // Array<String>

// 配列全体の型がわかる
if let firstElement = subObjects.first {
    print(type(of: firstElement)) // String
}
```

この場合、`subObjects` 配列が `Array<String>` 型であることがわかりますし、各要素の型も `String` であることが保証されます。

特定のクラスやプロトコルに準拠するオブジェクトの配列の場合も同様です：

```swift
class MyClass {}
let subObjects: [MyClass] = [MyClass(), MyClass()]

print(type(of: subObjects)) // Array<MyClass>

if let firstElement = subObjects.first {
    print(type(of: firstElement)) // MyClass
}
```

このようにして、配列の具体的な型情報を取得することができます。

---

## 👤 User
*2024-05-29 11:37:51*

以下の Text("\(type(of: subObjects))") を具体的な型名を取得したいんだ

import SwiftUI

struct PropertyView: View {
    var objects: [Any] = []
    
    init(objects: [Any]) {
        self.objects = objects
    }

    public var body: some View {
        List {
            ForEach(Array(objects.enumerated()), id: \.offset) { index, object in
                DisclosureGroup {
                    propertyView(object: object)
                } label: {
                    HStack {
                        Text("\(type(of: object))")
                        Spacer()
                        Text("\(type(of: object))[\(index)]")
                    }
                }
            }
        }
    }
    
    func propertyView(object: Any) -&gt; some View {
        AnyView(ForEach(Array(Mirror(reflecting: object).children.enumerated()), id: \.offset) { index, child in
            if let label = child.label {
                let childMirror = Mirror(reflecting: child.value)
                if childMirror.displayStyle == .struct || childMirror.displayStyle == .class {
                    DisclosureGroup {
                        propertyView(object: child.value)
                    } label: {
                        Text(label)
                    }
                } else if let subObjects = child.value as? [Any] {
                    DisclosureGroup {
                        ForEach(Array(subObjects.enumerated()), id: \.offset) { subIndex, subObject in
                            propertyView(object: subObject)
                        }
                    } label: {
                        HStack {
                            Text(label)
                            Spacer()
                            Text("\(type(of: subObjects))")
                        }
                    }
                } else {
                    Button {
                        UIPasteboard.general.string = "\(child.value)"
                        print("\(child.value)")
                    } label: {
                        HStack {
                            Text(label)
                            Spacer()
                            Text("\(child.value)")
                        }
                    }
                }
            }
        })
    }
}

struct Address {
    var city: [String]
    var postalCode: [Int]
}

struct Person {
    var name: String
    var age: Int
    var isEmployed: Bool
    var address: [Address]
}

#Preview {
    NavigationStack {
        PropertyView(objects: [
            Person(name: "John Doe", age: 30, isEmployed: true, address: [
                Address(city: ["New York", "トーキョー"], postalCode: [10001, 10002]),
                Address(city: ["New York", "トーキョー"], postalCode:[10001, 10002]),
            ]),
            Person(name: "John Doe", age: 30, isEmployed: true, address: [
                Address(city: ["New York", "トーキョー"], postalCode: [10001, 10002]),
                Address(city: ["New York", "トーキョー"], postalCode: [10001, 10002]),
            ])
        ])
    }
}

---

## 🤖 Assistant
*2024-05-29 11:38:07*

以下のコードでは、具体的な型名を表示するために、`type(of:)` を使用して得られた型名を `Text` ビューに表示しています。ここでは、型名をより詳細に取得するための方法を説明します。

```swift
import SwiftUI

struct PropertyView: View {
    var objects: [Any] = []
    
    init(objects: [Any]) {
        self.objects = objects
    }

    public var body: some View {
        List {
            ForEach(Array(objects.enumerated()), id: \.offset) { index, object in
                DisclosureGroup {
                    propertyView(object: object)
                } label: {
                    HStack {
                        Text(typeName(of: object))
                        Spacer()
                        Text("\(typeName(of: object))[\(index)]")
                    }
                }
            }
        }
    }
    
    func typeName(of object: Any) -> String {
        return String(describing: type(of: object))
    }

    func propertyView(object: Any) -> some View {
        AnyView(ForEach(Array(Mirror(reflecting: object).children.enumerated()), id: \.offset) { index, child in
            if let label = child.label {
                let childMirror = Mirror(reflecting: child.value)
                if childMirror.displayStyle == .struct || childMirror.displayStyle == .class {
                    DisclosureGroup {
                        propertyView(object: child.value)
                    } label: {
                        Text(label)
                    }
                } else if let subObjects = child.value as? [Any] {
                    DisclosureGroup {
                        ForEach(Array(subObjects.enumerated()), id: \.offset) { subIndex, subObject in
                            propertyView(object: subObject)
                        }
                    } label: {
                        HStack {
                            Text(label)
                            Spacer()
                            Text(typeName(of: subObjects))
                        }
                    }
                } else {
                    Button {
                        UIPasteboard.general.string = "\(child.value)"
                        print("\(child.value)")
                    } label: {
                        HStack {
                            Text(label)
                            Spacer()
                            Text("\(child.value)")
                        }
                    }
                }
            }
        })
    }
}

struct Address {
    var city: [String]
    var postalCode: [Int]
}

struct Person {
    var name: String
    var age: Int
    var isEmployed: Bool
    var address: [Address]
}

struct PropertyView_Previews: PreviewProvider {
    static var previews: some View {
        NavigationStack {
            PropertyView(objects: [
                Person(name: "John Doe", age: 30, isEmployed: true, address: [
                    Address(city: ["New York", "トーキョー"], postalCode: [10001, 10002]),
                    Address(city: ["New York", "トーキョー"], postalCode: [10001, 10002]),
                ]),
                Person(name: "Jane Doe", age: 25, isEmployed: false, address: [
                    Address(city: ["San Francisco", "大阪"], postalCode: [94105, 550001]),
                    Address(city: ["San Francisco", "大阪"], postalCode: [94105, 550001]),
                ])
            ])
        }
    }
}
```

このコードでは、`typeName(of:)` 関数を定義して、型の名前を取得しています。これにより、リストの各要素の型名を表示することができます。

プレビューも更新されており、`PropertyView` のプレビューが正常に動作します。新しい `typeName(of:)` 関数を使って、より詳細な型名を表示するようにしています。

---

## 👤 User
*2024-05-29 11:39:13*

変わらなかった

---

## 🤖 Assistant
*2024-05-29 11:39:35*

具体的な型名を取得するために、配列の要素の型情報をより詳細に扱うための方法を再度確認してみましょう。以下のコードでは、`Mirror` を使用してプロパティの型を取得し、それを `Text` に表示しています。

```swift
import SwiftUI

struct PropertyView: View {
    var objects: [Any] = []
    
    init(objects: [Any]) {
        self.objects = objects
    }

    public var body: some View {
        List {
            ForEach(Array(objects.enumerated()), id: \.offset) { index, object in
                DisclosureGroup {
                    propertyView(object: object)
                } label: {
                    HStack {
                        Text(typeName(of: object))
                        Spacer()
                        Text("\(typeName(of: object))[\(index)]")
                    }
                }
            }
        }
    }
    
    func typeName(of object: Any) -> String {
        let mirror = Mirror(reflecting: object)
        return "\(mirror.subjectType)"
    }

    func propertyView(object: Any) -> some View {
        AnyView(ForEach(Array(Mirror(reflecting: object).children.enumerated()), id: \.offset) { index, child in
            if let label = child.label {
                let childMirror = Mirror(reflecting: child.value)
                if childMirror.displayStyle == .struct || childMirror.displayStyle == .class {
                    DisclosureGroup {
                        propertyView(object: child.value)
                    } label: {
                        Text(label)
                    }
                } else if let subObjects = child.value as? [Any] {
                    DisclosureGroup {
                        ForEach(Array(subObjects.enumerated()), id: \.offset) { subIndex, subObject in
                            propertyView(object: subObject)
                        }
                    } label: {
                        HStack {
                            Text(label)
                            Spacer()
                            Text("\(typeName(of: subObjects))")
                        }
                    }
                } else {
                    Button {
                        UIPasteboard.general.string = "\(child.value)"
                        print("\(child.value)")
                    } label: {
                        HStack {
                            Text(label)
                            Spacer()
                            Text("\(child.value)")
                        }
                    }
                }
            }
        })
    }
}

struct Address {
    var city: [String]
    var postalCode: [Int]
}

struct Person {
    var name: String
    var age: Int
    var isEmployed: Bool
    var address: [Address]
}

struct PropertyView_Previews: PreviewProvider {
    static var previews: some View {
        NavigationStack {
            PropertyView(objects: [
                Person(name: "John Doe", age: 30, isEmployed: true, address: [
                    Address(city: ["New York", "トーキョー"], postalCode: [10001, 10002]),
                    Address(city: ["New York", "トーキョー"], postalCode: [10001, 10002]),
                ]),
                Person(name: "Jane Doe", age: 25, isEmployed: false, address: [
                    Address(city: ["San Francisco", "大阪"], postalCode: [94105, 550001]),
                    Address(city: ["San Francisco", "大阪"], postalCode: [94105, 550001]),
                ])
            ])
        }
    }
}
```

このコードで `typeName(of:)` 関数を修正し、`Mirror` を使ってオブジェクトの型名を取得しています。これにより、具体的な型名が `Text` に表示されるようになります。

---

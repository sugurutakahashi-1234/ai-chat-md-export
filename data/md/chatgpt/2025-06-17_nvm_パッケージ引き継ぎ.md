# nvm パッケージ引き継ぎ

Date: 2025-06-17

---

## 👤 User
*2025-06-18 00:01:42*

今ダウンロードしているNPMのグローバルインストールしているパッケージのリストを出したい。 

$ node -v
v24.0.2

これをv24.2.0 したときにそのまま引き継げるか？


nvm を使用している。

---

## 👤 User
*2025-06-18 00:06:38*

今ダウンロードしているNPMのグローバルインストールしているパッケージのリストを出したい。 

$ node -v
v24.0.2

これをv24.2.0 したときにそのまま引き継げるか？


nvm を使用している。

---

## 🤖 Assistant
*2025-06-18 00:06:42*

### 1. いま入っているグローバル npm パッケージを確認する

```bash
# 人間が読みやすい一覧
npm ls -g --depth=0

# アップデート状況も確認したいとき
npm outdated -g --depth=0

# 使い回し用に JSON で出力
npm ls -g --depth=0 --json > global-packages.json
```

&gt; **ポイント**  
&gt; * `--depth=0` を付けるとツリーの最上位（自分が直接 -g で入れたもの）だけが表示されます。  
&gt; * `global-packages.json` を作っておくと、あとで `jq` やスクリプトで再インストールコマンドを組み立てるのに便利です。

---

### 2. nvm と “グローバル” パッケージの関係

- **nvm は Node.js のバージョンごとに専用ディレクトリを作り、その中に個別の npm（node_modules）を置きます。**  
  つまり **Node 24.0.2** と **Node 24.2.0** では **グローバル領域が別々** です。  
- したがってバージョンを切り替えると、以前に -g で入れたパッケージは見えなくなります（壊れたわけではなく「別の場所」にあるだけ）。

---

### 3. 新バージョンへ引き継ぐ方法

#### ◎ nvm の便利オプションを使う（いちばんラク）

```bash
nvm install 24.2.0 --reinstall-packages-from=24.0.2
```

- `--reinstall-packages-from=<version>` が、指定した旧バージョンで -g インストールされているパッケージを **最新版に置き換えてくれる** 機能です。  
- インストール途中で Node 本体 → npm → 各パッケージの順に処理されるので、依存関係も自然に解決されます。  

&gt; **Tip**: 旧バージョンのパッケージが多い場合は少し時間がかかるので、ターミナルを開いたままにしておきましょう。

#### ◎ 手動で再インストールする（カスタムしたい場合）

1. 旧環境でリストを取る  
   ```bash
   nvm use 24.0.2
   npm ls -g --depth=0 --parseable | grep 'node_modules/' | awk -F/ '{print $NF}' > pkgs.txt
   ```

2. 新環境へ切り替える  
   ```bash
   nvm install 24.2.0
   nvm use 24.2.0
   ```

3. 再インストール  
   ```bash
   xargs npm i -g < pkgs.txt
   ```

（`pkgs.txt` を整形して不要なものを消したり、`npm i -g <package>@latest` に変えて最新版を入れ直すなど、自分好みに調整できます。）

---

### 4. アップグレード後の確認

```bash
node -v   # → v24.2.0 か確認
npm -v    # npm 10.x など、付属 npm も上がる
npm ls -g --depth=0
```

古い Node へ戻したいときは `nvm use 24.0.2` で瞬時に切り替えられます。  
（グローバルパッケージも 24.0.2 用のものに戻るので安心です。）

---

## まとめ

- グローバル npm パッケージは Node のバージョンごとに分かれている。  
- **`nvm install <new> --reinstall-packages-from=<old>`** が最も簡単な引き継ぎ方法。  
- こまめに `npm ls -g --depth=0` で現状を把握し、JSON やテキストにエクスポートしておくとトラブル時に復元しやすい。  

これで Node 24.0.2 → 24.2.0 への移行もスムーズに行えます👌

---

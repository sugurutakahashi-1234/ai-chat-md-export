# ã‚¢ãƒ³ãƒ©ãƒƒãƒ—ã¨æ¡ä»¶è©•ä¾¡

æ—¥ä»˜: 2024-08-20

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/8/20 18:10:27*

ã“ã“ã‚’ã†ã¾ãã‚¢ãƒ³ãƒ©ãƒƒãƒ—ã—ãŸã„
$account
            .map {
                $0.nickname.isNotEmpty && $0.birthDay.isPast && $0.gender != .noSelect
            }
            .assign(to: &$isValid)

final class ProfileEditPresenter: ObservableObject {
    @Published var account: Account?

    /// ç”»åƒ
    @Published var selectedImage: UIImage?

    @Published var isLoading: Bool = false
    @Published var appError: AppError?
    @Published var showAlert: Bool = false
    
    @Published var shouldDismiss: Bool = false
    
    @Published var isValid: Bool = false
    
    private let logDriver: any LogDriverProtocol
    private let apiRequestDriver: any ApiRequestDriverProtocol

    init(logDriver: any LogDriverProtocol = LogDriver(), apiRequestDriver: any ApiRequestDriverProtocol = ApiRequestDriver()) {
        self.logDriver = logDriver
        self.apiRequestDriver = apiRequestDriver

        logDriver.initLog()
        
        $account
            .map {
                $0.nickname.isNotEmpty && $0.birthDay.isPast && $0.gender != .noSelect
            }
            .assign(to: &$isValid)
    }
}

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/8/20 18:10:41*

`$account` ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ã®ãŸã‚ã€ã‚¢ãƒ³ãƒ©ãƒƒãƒ—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚`map` é–¢æ•°å†…ã§ã‚¢ãƒ³ãƒ©ãƒƒãƒ—ã™ã‚‹ãŸã‚ã«ã¯ã€`guard let` ã‚„ `if let` ã‚’ä½¿ç”¨ã™ã‚‹ã‹ã€`flatMap` ã‚’ä½¿ã£ã¦å®‰å…¨ã«ã‚¢ãƒ³ãƒ©ãƒƒãƒ—ã§ãã¾ã™ã€‚ã“ã“ã§ã¯ã€`flatMap` ã‚’ä½¿ã£ã¦ã‚¢ãƒ³ãƒ©ãƒƒãƒ—ã—ã¦ã€ã‚¢ãƒ³ãƒ©ãƒƒãƒ—ã•ã‚ŒãŸ `Account` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦æ¡ä»¶ã‚’è©•ä¾¡ã™ã‚‹æ–¹æ³•ã‚’ææ¡ˆã—ã¾ã™ã€‚

ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã§ `Account` ã‚’å®‰å…¨ã«ã‚¢ãƒ³ãƒ©ãƒƒãƒ—ã—ã€æ¡ä»¶ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

```swift
$account
    .flatMap { account in
        Just(account?.nickname.isNotEmpty == true && account?.birthDay.isPast == true && account?.gender != .noSelect)
    }
    .assign(to: &$isValid)
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€`flatMap` ã‚’ä½¿ã£ã¦ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ã® `account` ã‚’ã‚¢ãƒ³ãƒ©ãƒƒãƒ—ã—ã€`Just` ã‚’ä½¿ã£ã¦ `Bool` å€¤ã‚’è¿”ã—ã¾ã™ã€‚`account` ãŒ `nil` ã®å ´åˆã¯ `false` ã«ãªã‚Šã¾ã™ã€‚`isValid` ã¯ `account` ã®çŠ¶æ…‹ã«å¿œã˜ã¦è‡ªå‹•çš„ã«æ›´æ–°ã•ã‚Œã¾ã™ã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãª `Account` ã‚’å®‰å…¨ã«ã‚¢ãƒ³ãƒ©ãƒƒãƒ—ã—ã¤ã¤ã€æœŸå¾…ã™ã‚‹å‹•ä½œã‚’å®Ÿç¾ã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/8/20 18:11:30*

ã“ã‚“ãªæ„Ÿã˜ã«ã—ãŸã„ã‚“ã ã‘ã©

$account
            .flatMap { $0 }
            .map {
                $0.nickname.isNotEmpty && $0.birthDay.isPast && $0.gender != .noSelect
            }
            .assign(to: &$isValid)

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/8/20 18:11:41*

ãã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§é€²ã‚ã‚‹å ´åˆã€`$account` ãŒã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ã§ã‚ã‚‹ãŸã‚ã€`flatMap` ã‚’ä½¿ã£ã¦ã‚¢ãƒ³ãƒ©ãƒƒãƒ—ã—ã€æ¬¡ã« `map` ã‚’ä½¿ã£ã¦æ¡ä»¶ã‚’è©•ä¾¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè£…ã§ãã¾ã™ï¼š

```swift
$account
    .compactMap { $0 }  // Optional<Account> ã‚’ Account ã«ã‚¢ãƒ³ãƒ©ãƒƒãƒ—
    .map {
        $0.nickname.isNotEmpty && $0.birthDay.isPast && $0.gender != .noSelect
    }
    .assign(to: &$isValid)
```

ã“ã“ã§ã¯ã€`flatMap` ã®ä»£ã‚ã‚Šã« `compactMap` ã‚’ä½¿ã†ã“ã¨ã§ã€`nil` ã‚’é™¤å¤–ã—ã€ã‚¢ãƒ³ãƒ©ãƒƒãƒ—ã•ã‚ŒãŸ `Account` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦å‡¦ç†ã‚’é€²ã‚ã¦ã„ã¾ã™ã€‚`map` ã§æ¡ä»¶ã‚’è©•ä¾¡ã—ã€ãã®çµæœã‚’ `isValid` ã«ãƒã‚¤ãƒ³ãƒ‰ã—ã¾ã™ã€‚

ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯ã€`$account` ãŒ `nil` ã®å ´åˆã«ã¯å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã€ã‚¢ãƒ³ãƒ©ãƒƒãƒ—ã«æˆåŠŸã—ãŸå ´åˆã®ã¿æ¡ä»¶ã‚’è©•ä¾¡ã™ã‚‹ã¨ã„ã†æ„å›³ã«æ²¿ã£ã¦ã„ã¾ã™ã€‚

---

# SwiftUI æ–‡å­—èµ·ã“ã—ç”»é¢

æ—¥ä»˜: 2024-05-15

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/05/15 14:32:32*

SwiftUIã®TranscriptionViewã§audioUrl: URLã‚’å¼•æ•°ã§æ¸¡ã—ã¦ã€æ–‡å­—èµ·ã“ã—ã™ã‚‹ç”»é¢ã‚’ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã§ä½œæˆã—ã¦ã»ã—ã„ã€‚

import WhisperKit

import SwiftUI

struct TranscriptionView: View {
    
}

final class TranscriptionDriver {
    func transcribe(audioUrl: URL) async throws -&gt; [TranscriptionResult] {
        let whisper = try await WhisperKit()
        return try await whisper.transcribe(audioPath: audioUrl.path,decodeOptions:DecodingOptions.init(language: "ja"))
    }
}

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/05/15 14:32:40*

ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯ã€SwiftUIã‚’ä½¿ç”¨ã—ã¦TranscriptionViewã‚’ä½œæˆã—ã€éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®URLã‚’å—ã‘å–ã‚Šã€ãã®æ–‡å­—èµ·ã“ã—ã‚’è¡Œã†ç”»é¢ã§ã™ã€‚`WhisperKit`ã‚’ä½¿ç”¨ã—ã¦éŸ³å£°ã‚’æ–‡å­—èµ·ã“ã—ã™ã‚‹æ©Ÿèƒ½ã‚’æŒã¤`TranscriptionDriver`ã‚‚å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

```swift
import WhisperKit
import SwiftUI

struct TranscriptionView: View {
    let audioUrl: URL
    @State private var transcriptionResults: [TranscriptionResult] = []
    @State private var isLoading: Bool = false
    @State private var errorMessage: String? = nil

    var body: some View {
        VStack {
            if isLoading {
                ProgressView("Transcribing...")
            } else if let errorMessage = errorMessage {
                Text("Error: \(errorMessage)")
                    .foregroundColor(.red)
            } else {
                List(transcriptionResults, id: \.self) { result in
                    Text(result.text)
                }
            }
        }
        .onAppear {
            Task {
                await transcribeAudio()
            }
        }
    }

    private func transcribeAudio() async {
        isLoading = true
        errorMessage = nil
        let driver = TranscriptionDriver()
        
        do {
            transcriptionResults = try await driver.transcribe(audioUrl: audioUrl)
        } catch {
            errorMessage = error.localizedDescription
        }
        isLoading = false
    }
}

final class TranscriptionDriver {
    func transcribe(audioUrl: URL) async throws -> [TranscriptionResult] {
        let whisper = try await WhisperKit()
        return try await whisper.transcribe(audioPath: audioUrl.path, decodeOptions: DecodingOptions(language: "ja"))
    }
}
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€`TranscriptionView`ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ï¼š
- `audioUrl`ã¨ã„ã†ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®URLã‚’å—ã‘å–ã‚Šã¾ã™ã€‚
- `@State`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ä½¿ç”¨ã—ã¦ã€æ–‡å­—èµ·ã“ã—ã®çµæœã€èª­ã¿è¾¼ã¿çŠ¶æ…‹ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç®¡ç†ã—ã¾ã™ã€‚
- `body`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ã¯ã€èª­ã¿è¾¼ã¿ä¸­ã€ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã€æ­£å¸¸ã«æ–‡å­—èµ·ã“ã—çµæœã‚’è¡¨ç¤ºã™ã‚‹å ´åˆã®UIã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚
- `onAppear`ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢ã‚’ä½¿ç”¨ã—ã¦ã€ç”»é¢ãŒè¡¨ç¤ºã•ã‚ŒãŸã¨ãã«æ–‡å­—èµ·ã“ã—å‡¦ç†ã‚’éåŒæœŸã§é–‹å§‹ã—ã¾ã™ã€‚

`TranscriptionDriver`ã‚¯ãƒ©ã‚¹ã¯ã€`WhisperKit`ã‚’ä½¿ç”¨ã—ã¦æŒ‡å®šã•ã‚ŒãŸéŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ–‡å­—èµ·ã“ã—ã™ã‚‹æ©Ÿèƒ½ã‚’æŒã£ã¦ã„ã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/05/15 14:33:06*

TranscriptionViewModelã‚’ä½œã£ã¦ã»ã—ã„

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/05/15 14:33:14*

ä»¥ä¸‹ã¯ã€`TranscriptionViewModel`ã‚’ä½¿ç”¨ã—ã¦ã€`TranscriptionView`ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ViewModelã«åˆ†é›¢ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€Viewã¨ãƒ­ã‚¸ãƒƒã‚¯ã®åˆ†é›¢ãŒå®Ÿç¾ã•ã‚Œã€ãƒ†ã‚¹ãƒˆå¯èƒ½æ€§ãŒå‘ä¸Šã—ã¾ã™ã€‚

```swift
import WhisperKit
import SwiftUI
import Combine

class TranscriptionViewModel: ObservableObject {
    @Published var transcriptionResults: [TranscriptionResult] = []
    @Published var isLoading: Bool = false
    @Published var errorMessage: String? = nil
    
    private var cancellables = Set<AnyCancellable>()
    private let transcriptionDriver = TranscriptionDriver()

    func transcribe(audioUrl: URL) {
        isLoading = true
        errorMessage = nil
        
        Task {
            do {
                let results = try await transcriptionDriver.transcribe(audioUrl: audioUrl)
                DispatchQueue.main.async {
                    self.transcriptionResults = results
                    self.isLoading = false
                }
            } catch {
                DispatchQueue.main.async {
                    self.errorMessage = error.localizedDescription
                    self.isLoading = false
                }
            }
        }
    }
}

struct TranscriptionView: View {
    let audioUrl: URL
    @StateObject private var viewModel = TranscriptionViewModel()

    var body: some View {
        VStack {
            if viewModel.isLoading {
                ProgressView("Transcribing...")
            } else if let errorMessage = viewModel.errorMessage {
                Text("Error: \(errorMessage)")
                    .foregroundColor(.red)
            } else {
                List(viewModel.transcriptionResults, id: \.self) { result in
                    Text(result.text)
                }
            }
        }
        .onAppear {
            viewModel.transcribe(audioUrl: audioUrl)
        }
    }
}

final class TranscriptionDriver {
    func transcribe(audioUrl: URL) async throws -> [TranscriptionResult] {
        let whisper = try await WhisperKit()
        return try await whisper.transcribe(audioPath: audioUrl.path, decodeOptions: DecodingOptions(language: "ja"))
    }
}
```

### å¤‰æ›´ç‚¹

1. **`TranscriptionViewModel`ã®ä½œæˆ**
   - `TranscriptionViewModel`ã¯`ObservableObject`ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«æº–æ‹ ã—ã€`@Published`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æŒã¤ã“ã¨ã§ã€çŠ¶æ…‹ã®å¤‰åŒ–ã‚’Viewã«é€šçŸ¥ã—ã¾ã™ã€‚
   - `transcribe(audioUrl:)`ãƒ¡ã‚½ãƒƒãƒ‰ã§éŸ³å£°URLã‚’å—ã‘å–ã‚Šã€éåŒæœŸã§æ–‡å­—èµ·ã“ã—ã‚’è¡Œã„ã¾ã™ã€‚çµæœã‚„ã‚¨ãƒ©ãƒ¼ã‚’ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§æ›´æ–°ã—ã¾ã™ã€‚

2. **`TranscriptionView`ã®å¤‰æ›´**
   - `TranscriptionView`ã¯`@StateObject`ã¨ã—ã¦`TranscriptionViewModel`ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æŒã¡ã¾ã™ã€‚
   - `onAppear`ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢ã§ViewModelã®`transcribe(audioUrl:)`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã€æ–‡å­—èµ·ã“ã—ã‚’é–‹å§‹ã—ã¾ã™ã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€UIã®ãƒ­ã‚¸ãƒƒã‚¯ãŒViewModelã«ç§»å‹•ã—ã€ã‚³ãƒ¼ãƒ‰ã®åˆ†é›¢ã¨å¯èª­æ€§ãŒå‘ä¸Šã—ã¾ã™ã€‚

---

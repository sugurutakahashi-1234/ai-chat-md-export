# iOS ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ ã‚«ãƒ¡ãƒ©èµ·å‹•

æ—¥ä»˜: 2024-12-16

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/12/16 21:00:46*

ä»¥ä¸‹ã«ã¤ã„ã¦
// iOS ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®å ´åˆã¯ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ã›ãšã«ç¢ºèªç”»é¢ã¸é·ç§» ã®å‡¦ç†ã‚’initCameraã‹ã‚‰åˆ†é›¢ã—ã¦useEffectå†…ã§ã®ã¿èª­ã‚“ã§listenã§ã¯å‘¼ã‚“ã§å¹²ã—ã¦ããªã„

import 'dart:io';

import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:go_router/go_router.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:image_picker/image_picker.dart';
import 'package:snpit_guild_app/domain/screen.dart';
import 'package:snpit_guild_app/presentation/providers/on_pop_snap_confirm.dart';
import 'package:snpit_guild_app/presentation/providers/shoot_photo_path.dart';
import 'package:device_info_plus/device_info_plus.dart';

class ShootingPage extends HookConsumerWidget {
  const ShootingPage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    Future&lt;void&gt; initCamera() async {
      // iOS ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®å ´åˆã¯ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ã›ãšã«ç¢ºèªç”»é¢ã¸é·ç§»
      if (Platform.isIOS) {
        final deviceInfo = DeviceInfoPlugin();
        final iosInfo = await deviceInfo.iosInfo;

        // isPhysicalDeviceãŒfalseã®å ´åˆã¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼
        final isSimulator = !iosInfo.isPhysicalDevice;

        if (isSimulator) {
          if (context.mounted) {
            ref.read(onPopSnapConfirmNotifierProvider.notifier).reset();
            await context.push(Screen.snapConfirm.path);
          }
          return;
        }
      }

      // å®Ÿæ©Ÿ or Android ã‚·ãƒ¥ãƒŸãƒ¬ãƒ¼ã‚¿ãƒ¼ã®å ´åˆã¯ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•
      final picker = ImagePicker();
      final pickedFile = await picker.pickImage(source: ImageSource.camera);

      if (pickedFile != null) {
        ref
            .read(shootPhotoPathNotifierProvider.notifier)
            .updatePath(pickedFile.path);

        if (context.mounted) {
          // é·ç§»ã™ã‚‹å‰ã« notifier ã‚’ãƒªã‚»ãƒƒãƒˆ
          ref.read(onPopSnapConfirmNotifierProvider.notifier).reset();
          await context.push(Screen.snapConfirm.path);
        }
      } else {
        // å†™çœŸãŒé¸ã°ã‚Œãªã‹ã£ãŸå ´åˆã¯æˆ»ã‚‹
        if (context.mounted) {
          context.pop();
        }
      }
    }

    useEffect(
      () {
        // Widgets ã®æç”»ãŒçµ‚ã‚ã£ãŸå¾Œã« ref ã‹ã‚‰å€¤ã‚’æ›´æ–°ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„
        WidgetsBinding.instance.addPostFrameCallback((_) {
          ref.read(shootPhotoPathNotifierProvider.notifier).clear();
          initCamera();
        });
        return null;
      },
      [],
    );

    ref.listen&lt;bool&gt;(
      onPopSnapConfirmNotifierProvider,
      (_, next) {
        if (next) {
          initCamera();
        }
      },
    );

    return Scaffold(
      appBar: AppBar(title: const Text('ShootingPage')),
      body: const Center(
        child: CircularProgressIndicator(),
      ),
    );
  }
}

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/12/16 21:00:58*

ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã—ã€`initCamera` å‡¦ç†ã‚’ `useEffect` å†…ã§ã®ã¿å‘¼ã³å‡ºã™ã‚ˆã†ã«å¤‰æ›´ã—ã€`listen` ã§å‘¼ã³å‡ºã•ãªã„ã‚ˆã†ã«ã™ã‚‹å®Ÿè£…ä¾‹ã‚’æç¤ºã—ã¾ã™ã€‚`listen` ã®ä¸­ã§ã®ã‚«ãƒ¡ãƒ©èµ·å‹•ã‚’é˜²ãã“ã¨ã§ã€ä¸è¦ãªå‡¦ç†ãŒç™ºç”Ÿã—ãªã„ã‚ˆã†ã«ã§ãã¾ã™ã€‚

ä¿®æ­£ã®ãƒã‚¤ãƒ³ãƒˆ:
1. `initCamera` ã‚’ `useEffect` ã®ä¸­ã§ã®ã¿å‘¼ã³å‡ºã™ã€‚
2. `listen` ã§ã¯ã‚«ãƒ¡ãƒ©èµ·å‹•ã‚’è¡Œã‚ãšã€çŠ¶æ…‹ã®ç›£è¦–ã¨å¿…è¦ãªå‡¦ç†ã®ã¿ã«ç•™ã‚ã‚‹ã€‚

ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯ä¿®æ­£ç‰ˆã§ã™:

```dart
import 'dart:io';

import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:go_router/go_router.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:image_picker/image_picker.dart';
import 'package:snpit_guild_app/domain/screen.dart

---

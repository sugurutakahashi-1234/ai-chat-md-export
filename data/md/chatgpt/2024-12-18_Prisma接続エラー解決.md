# Prismaæ¥ç¶šã‚¨ãƒ©ãƒ¼è§£æ±º

æ—¥ä»˜: 2024-12-18

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/12/18 12:58:46*

ã‚¨ãƒ©ãƒ¼å†…å®¹

[3:58:20 AM] File change detected. Starting incremental compilation...
2024-12-18 12:58:20 
2024-12-18 12:58:20 [3:58:20 AM] Found 0 errors. Watching for file changes.
2024-12-18 12:58:20 
2024-12-18 12:58:20 Debugger listening on ws://127.0.0.1:9229/0a217521-f511-4226-93f9-79dbe7585d0d
2024-12-18 12:58:20 For help, see: https://nodejs.org/en/docs/inspector
2024-12-18 12:58:20 [Nest] 255  - 12/18/2024, 3:58:20 AM     LOG [NestFactory] Starting Nest application...
2024-12-18 12:58:20 [Nest] 255  - 12/18/2024, 3:58:20 AM     LOG [InstanceLoader] DatabaseModule dependencies initialized +6ms
2024-12-18 12:58:20 [Nest] 255  - 12/18/2024, 3:58:20 AM     LOG [InstanceLoader] AppModule dependencies initialized +1ms
2024-12-18 12:58:20 [Nest] 255  - 12/18/2024, 3:58:20 AM     LOG [InstanceLoader] GuildModule dependencies initialized +0ms
2024-12-18 12:58:20 [Nest] 255  - 12/18/2024, 3:58:20 AM     LOG [InstanceLoader] AccountModule dependencies initialized +0ms
2024-12-18 12:58:20 [Nest] 255  - 12/18/2024, 3:58:20 AM     LOG [RoutesResolver] AppController {/}: +29ms
2024-12-18 12:58:20 [Nest] 255  - 12/18/2024, 3:58:20 AM     LOG [RouterExplorer] Mapped {/, GET} route +1ms
2024-12-18 12:58:20 [Nest] 255  - 12/18/2024, 3:58:20 AM     LOG [RoutesResolver] AccountController {/v1/accounts}: +0ms
2024-12-18 12:58:20 [Nest] 255  - 12/18/2024, 3:58:20 AM     LOG [RouterExplorer] Mapped {/v1/accounts, POST} route +0ms
2024-12-18 12:58:20 [Nest] 255  - 12/18/2024, 3:58:20 AM     LOG [RouterExplorer] Mapped {/v1/accounts, GET} route +1ms
2024-12-18 12:58:20 [Nest] 255  - 12/18/2024, 3:58:20 AM     LOG [RouterExplorer] Mapped {/v1/accounts/:user_id, GET} route +0ms
2024-12-18 12:58:20 [Nest] 255  - 12/18/2024, 3:58:20 AM     LOG [RouterExplorer] Mapped {/v1/accounts/:user_id, PUT} route +0ms
2024-12-18 12:58:20 [Nest] 255  - 12/18/2024, 3:58:20 AM     LOG [RouterExplorer] Mapped {/v1/accounts/:user_id, DELETE} route +0ms
2024-12-18 12:58:20 [Nest] 255  - 12/18/2024, 3:58:20 AM     LOG [RoutesResolver] GuildController {/v1/guilds}: +0ms
2024-12-18 12:58:20 [Nest] 255  - 12/18/2024, 3:58:20 AM     LOG [RouterExplorer] Mapped {/v1/guilds, GET} route +1ms
2024-12-18 12:58:20 [Nest] 255  - 12/18/2024, 3:58:20 AM     LOG [RouterExplorer] Mapped {/v1/guilds, POST} route +0ms
2024-12-18 12:58:20 [Nest] 255  - 12/18/2024, 3:58:20 AM     LOG [RouterExplorer] Mapped {/v1/guilds/:guild_id/members/:user_id, POST} route +0ms
2024-12-18 12:58:20 [Nest] 255  - 12/18/2024, 3:58:20 AM     LOG [RouterExplorer] Mapped {/v1/guilds/:guild_id, PUT} route +0ms
2024-12-18 12:58:20 [Nest] 255  - 12/18/2024, 3:58:20 AM     LOG [RouterExplorer] Mapped {/v1/guilds/:guild_id, DELETE} route +0ms
2024-12-18 12:58:20 /SNPIT/guild_server/node_modules/@prisma/client/runtime/library.js:112
2024-12-18 12:58:20 You may have to run ${$e("prisma generate")} for your changes to take effect.`,this.config.clientVersion);return t}}parseEngineResponse(t){if(!t)throw new V("Response from the Engine was empty",{clientVersion:this.config.clientVersion});try{return JSON.parse(t)}catch{throw new V("Unable to JSON.parse response from engine",{clientVersion:this.config.clientVersion})}}async loadEngine(){if(!this.engine){this.QueryEngineConstructor||(this.library=await this.libraryLoader.loadLibrary(this.config),this.QueryEngineConstructor=this.library.QueryEngine);try{let t=new WeakRef(this),{adapter:r}=this.config;r&&Ae("Using driver adapter: %O",r),this.engine=new this.QueryEngineConstructor({datamodel:this.datamodel,env:process.env,logQueries:this.config.logQueries??!1,ignoreEnvVarErrors:!0,datasourceOverrides:this.datasourceOverrides??{},logLevel:this.logLevel,configDir:this.config.cwd,engineProtocol:"json"},n=&gt;{t.deref()?.logger(n)},r)}catch(t){let r=t,n=this.parseInitError(r.message);throw typeof n=="string"?r:new R(n.message,this.config.clientVersion,n.error_code)}}}logger(t){let r=this.parseEngineResponse(t);if(r){if("span"in r){this.config.tracingHelper.createEngineSpan(r);return}r.level=r?.level.toLowerCase()??"unknown",om(r)?this.logEmitter.emit("query",{timestamp:new Date,query:r.query,params:r.params,duration:Number(r.duration_ms),target:r.module_path}):sm(r)?this.loggerRustPanic=new le(oo(this,`${r.message}: ${r.reason} in ${r.file}:${r.line}:${r.column}`),this.config.clientVersion):this.logEmitter.emit(r.level,{timestamp:new Date,message:r.message,target:r.module_path})}}parseInitError(t){try{return JSON.parse(t)}catch{}return t}parseRequestError(t){try{return JSON.parse(t)}catch{}return t}onBeforeExit(){throw new Error('"beforeExit" hook is not applicable to the library engine since Prisma 5.0.0, it is only relevant and implemented for the binary engine. Please add your event listener to the `process` object directly instead.')}async start(){if(await this.libraryInstantiationPromise,await this.libraryStoppingPromise,this.libraryStartingPromise)return Ae(`library already starting, this.libraryStarted: ${this.libraryStarted}`),this.libraryStartingPromise;if(this.libraryStarted)return;let t=async()=&gt;{Ae("library starting");try{let r={traceparent:this.config.tracingHelper.getTraceParent()};await this.engine?.connect(JSON.stringify(r)),this.libraryStarted=!0,Ae("library started")}catch(r){let n=this.parseInitError(r.message);throw typeof n=="string"?r:new R(n.message,this.config.clientVersion,n.error_code)}finally{this.libraryStartingPromise=void 0}};return this.libraryStartingPromise=this.config.tracingHelper.runInChildSpan("connect",t),this.libraryStartingPromise}async stop(){if(await this.libraryStartingPromise,await this.executingQueryPromise,this.libraryStoppingPromise)return Ae("library is already stopping"),this.libraryStoppingPromise;if(!this.libraryStarted)return;let t=async()=&gt;{await new Promise(n=&gt;setTimeout(n,5)),Ae("library stopping");let r={traceparent:this.config.tracingHelper.getTraceParent()};await this.engine?.disconnect(JSON.stringify(r)),this.libraryStarted=!1,this.libraryStoppingPromise=void 0,Ae("library stopped")};return this.libraryStoppingPromise=this.config.tracingHelper.runInChildSpan("disconnect",t),this.libraryStoppingPromise}version(){return this.versionInfo=this.library?.version(),this.versionInfo?.version??"unknown"}debugPanic(t){return this.library?.debugPanic(t)}async request(t,{traceparent:r,interactiveTransaction:n}){Ae(`sending request, this.libraryStarted: ${this.libraryStarted}`);let i=JSON.stringify({traceparent:r}),o=JSON.stringify(t);try{await this.start(),this.executingQueryPromise=this.engine?.query(o,i,n?.id),this.lastQuery=o;let s=this.parseEngineResponse(await this.executingQueryPromise);if(s.errors)throw s.errors.length===1?this.buildQueryError(s.errors[0]):new V(JSON.stringify(s.errors),{clientVersion:this.config.clientVersion});if(this.loggerRustPanic)throw this.loggerRustPanic;return{data:s}}catch(s){if(s instanceof R)throw s;if(s.code==="GenericFailure"&&s.message?.startsWith("PANIC:"))throw new le(oo(this,s.message),this.config.clientVersion);let a=this.parseRequestError(s.message);throw typeof a=="string"?s:new V(`${a.message}
2024-12-18 12:58:20                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
2024-12-18 12:58:20 
2024-12-18 12:58:20 PrismaClientInitializationError: Can't reach database server at `localhost:5432`
2024-12-18 12:58:20 
2024-12-18 12:58:20 Please make sure your database server is running at `localhost:5432`.
2024-12-18 12:58:20     at t (/SNPIT/guild_server/node_modules/@prisma/client/runtime/library.js:112:2488)
2024-12-18 12:58:20     at Proxy.onModuleInit (/SNPIT/guild_server/src/database/database.service.ts:8:5)
2024-12-18 12:58:20     at async Promise.all (index 0)
2024-12-18 12:58:20     at async callModuleInitHook (/SNPIT/guild_server/node_modules/@nestjs/core/hooks/on-module-init.hook.js:43:5)
2024-12-18 12:58:20     at async NestApplication.callInitHook (/SNPIT/guild_server/node_modules/@nestjs/core/nest-application-context.js:234:13)
2024-12-18 12:58:20     at async NestApplication.init (/SNPIT/guild_server/node_modules/@nestjs/core/nest-application.js:100:9)
2024-12-18 12:58:20     at async NestApplication.listen (/SNPIT/guild_server/node_modules/@nestjs/core/nest-application.js:170:13)
2024-12-18 12:58:20     at bootstrap (/SNPIT/guild_server/src/main.ts:38:3) {
2024-12-18 12:58:20   clientVersion: '6.0.1',
2024-12-18 12:58:20   errorCode: 'P1001'
2024-12-18 12:58:20 }
2024-12-18 12:58:20 
2024-12-18 12:58:20 Node.js v18.20.5

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/12/18 12:59:04*

ã“ã®ã‚¨ãƒ©ãƒ¼ã¯ã€Prisma ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ããªã‹ã£ãŸã“ã¨ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€Prisma ã¯ `localhost:5432` ã«ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã—ã‚ˆã†ã¨ã—ã¾ã—ãŸãŒã€ã‚µãƒ¼ãƒãƒ¼ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ãªã„ã‹ã€æ¥ç¶šã§ããªã„çŠ¶æ…‹ã§ã™ã€‚

ã‚¨ãƒ©ãƒ¼ã®åŸå› ã¨å¯¾ç­–ã‚’ä»¥ä¸‹ã«ã¾ã¨ã‚ã¾ã™ï¼š

---

### **ã‚¨ãƒ©ãƒ¼åŸå› **
1. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒèµ·å‹•ã—ã¦ã„ãªã„**
   - PostgreSQL ã‚µãƒ¼ãƒãƒ¼ãŒ `localhost:5432` ã§å‹•ä½œã—ã¦ã„ãªã„ã€‚
   
2. **æ¥ç¶šè¨­å®šã®å•é¡Œ**
   - `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ Prisma ã‚¹ã‚­ãƒ¼ãƒã§ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ¥ç¶šæƒ…å ±ï¼ˆãƒ›ã‚¹ãƒˆã€ãƒãƒ¼ãƒˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åï¼‰ãŒé–“é•ã£ã¦ã„ã‚‹ã€‚

3. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚„ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã®å•é¡Œ**
   - ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ã§ãƒãƒ¼ãƒˆ `5432` ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ã€‚

4. **Prisma Client ã®ä¸é©åˆ‡ãªè¨­å®š**
   - Prisma ã®è¨­å®šã‚„ã‚¹ã‚­ãƒ¼ãƒãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ãªã„ã€‚

---

### **è§£æ±ºæ–¹æ³•**
#### **1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®èµ·å‹•ã‚’ç¢ºèª**
   - PostgreSQL ã‚µãƒ¼ãƒãƒ¼ãŒå®Ÿè¡Œä¸­ã‹ç¢ºèªã—ã¾ã™ã€‚
     ```bash
     sudo systemctl status postgresql
     ```
   - å®Ÿè¡Œã•ã‚Œã¦ã„ãªã„å ´åˆã€èµ·å‹•ã—ã¾ã™ã€‚
     ```bash
     sudo systemctl start postgresql
     ```

#### **2. `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª**
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ¥ç¶šæƒ…å ±ãŒæ­£ã—ã„ã‹ç¢ºèªã—ã¾ã™ã€‚
     ```
     DATABASE_URL="postgresql://<username>:<password>@localhost:5432/<database_name>"
     ```
   - `<username>`, `<password>`, `<database_name>` ãŒæ­£ã—ã„ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚

#### **3. Prisma ã‚¹ã‚­ãƒ¼ãƒã®ç¢ºèª**
   - `prisma/schema.prisma` ã«æŒ‡å®šã—ãŸãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ãŒ `.env` ã¨ä¸€è‡´ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚
     ```prisma
     datasource db {
       provider = "postgresql"
       url      = env("DATABASE_URL")
     }
     ```

#### **4. ãƒãƒ¼ãƒˆã®ç¢ºèª**
   - `localhost:5432` ãŒä»–ã®ãƒ—ãƒ­ã‚»ã‚¹ã«å æœ‰ã•ã‚Œã¦ã„ãªã„ã‹ç¢ºèªã—ã¾ã™ã€‚
     ```bash
     netstat -tuln | grep 5432
     ```

#### **5. Prisma ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å†ç”Ÿæˆ**
   - Prisma ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒæ­£ã—ãç”Ÿæˆã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
     ```bash
     npx prisma generate
     ```

#### **6. Prisma Migration ã®å®Ÿè¡Œ**
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é©ç”¨ã—ã¾ã™ã€‚
     ```bash
     npx prisma migrate dev
     ```

#### **7. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’èª­ã¿å–ã‚‹**
   - Prisma ãŒæç¤ºã—ã¦ã„ã‚‹ã‚ˆã†ã«ã€å¿…è¦ã«å¿œã˜ã¦å†åº¦ Prisma ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ç”Ÿæˆã—ã¾ã™ã€‚
     ```bash
     npx prisma generate
     ```

#### **8. ãƒ­ã‚°ã§å•é¡Œã‚’ã•ã‚‰ã«è¿½è·¡**
   - `prisma.logs` ã‚’æœ‰åŠ¹åŒ–ã—ã€è©³ç´°ãªãƒ­ã‚°ã‚’å–å¾—ã—ã¾ã™ã€‚

---

### **ç¢ºèªãŒå¿…è¦ãªãƒã‚¤ãƒ³ãƒˆ**
- PostgreSQL ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã§èµ·å‹•ã—ã¦ã„ã‚‹ã‹ã€‚
- `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ãŒæ­£ã—ã„ã‹ã€‚
- ä½¿ç”¨ã—ã¦ã„ã‚‹ Prisma ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒæœ€æ–°ã§ã‚ã‚‹ã‹ã€‚

ã“ã‚Œã‚‰ã‚’ç¢ºèªã™ã‚Œã°å•é¡Œã‚’è§£æ±ºã§ãã‚‹ã¯ãšã§ã™ã€‚ãã‚Œã§ã‚‚è§£æ±ºã—ãªã„å ´åˆã€è©³ç´°ãªãƒ­ã‚°ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/12/18 12:59:21*

```

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/12/18 12:59:24*

å†åº¦ç¢ºèªã—ãŸã„ç‚¹ã‚„ã‚¨ãƒ©ãƒ¼ã«é–¢ã™ã‚‹è¿½åŠ æƒ…å ±ãŒã‚ã‚Œã°ã€ãœã²æ•™ãˆã¦ãã ã•ã„ã€‚ãŸã¨ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæƒ…å ±ã‚’æä¾›ã„ãŸã ã‘ã‚‹ã¨ã€å…·ä½“çš„ãªè§£æ±ºæ–¹æ³•ã‚’ææ¡ˆã—ã‚„ã™ããªã‚Šã¾ã™ã€‚

1. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ç¨®é¡**ï¼ˆä¾‹: PostgreSQL, MySQL ãªã©ï¼‰
2. **ç’°å¢ƒ**ï¼ˆä¾‹: ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ, Docker ã‚³ãƒ³ãƒ†

---

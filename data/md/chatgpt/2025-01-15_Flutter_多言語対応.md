# Flutter 多言語対応

Date: 2025-01-15

---

## 👤 User
*2025-01-15 12:40:44*

flutter 多言語アプリ対応

---

## 🤖 Assistant
*2025-01-15 12:41:10*

Flutterでアプリを多言語対応するための基本的な手順を以下に示します。Flutterは`flutter_localizations`パッケージと`intl`パッケージを活用することで、多言語対応を簡単に実現できます。

---

### 1. 必要なパッケージをインストール
まず、`pubspec.yaml`ファイルに以下の依存関係を追加します。

```yaml
dependencies:
  flutter_localizations:
    sdk: flutter
  intl: ^0.18.0 # 最新バージョンを確認して使用してください
```

その後、コマンドを実行してパッケージをインストールします。

```bash
flutter pub get
```

---

### 2. `MaterialApp`でローカライゼーションを有効化
`MaterialApp`に必要な設定を追加します。

```dart
import 'package:flutter/material.dart';
import 'package:flutter_localizations/flutter_localizations.dart';
import 'generated/l10n.dart';

void main() {
  runApp(MyApp());
}

class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: '多言語対応アプリ',
      localizationsDelegates: [
        S.delegate, // 自動生成されたローカライゼーションファイルを使用
        GlobalMaterialLocalizations.delegate,
        GlobalWidgetsLocalizations.delegate,
        GlobalCupertinoLocalizations.delegate,
      ],
      supportedLocales: S.delegate.supportedLocales, // 対応するロケール
      locale: const Locale('ja'), // デフォルト言語を設定（例: 日本語）
      home: MyHomePage(),
    );
  }
}

class MyHomePage extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text(S.of(context).helloWorld),
      ),
      body: Center(
        child: Text(S.of(context).welcomeMessage),
      ),
    );
  }
}
```

---

### 3. `intl`でローカライズ用ファイルを生成
Flutterの標準ツールを使ってローカライズを管理します。

#### a. `arb`ファイルを作成
`lib/l10n`ディレクトリに以下のような`.arb`ファイルを作成します。

- **intl_en.arb**
  ```json
  {
    "helloWorld": "Hello World",
    "welcomeMessage": "Welcome to Flutter Localization"
  }
  ```

- **intl_ja.arb**
  ```json
  {
    "helloWorld": "こんにちは世界",
    "welcomeMessage": "Flutterの多言語対応へようこそ"
  }
  ```

#### b. `flutter pub get`でローカライズファイルを生成
以下のコマンドを実行してローカライズコードを自動生成します。

```bash
flutter gen-l10n
```

これにより、`lib/generated/l10n.dart`ファイルが生成されます。

---

### 4. 動作確認
アプリを実行し、`MaterialApp`の`locale`プロパティを変更して各言語の表示を確認します。

```dart
locale: const Locale('en'), // 英語
locale: const Locale('ja'), // 日本語
```

---

### 5. システム言語に応じた切り替え
`locale`プロパティを省略すると、システムの言語設定に従って言語が自動で切り替わります。

```dart
locale: null, // デフォルト設定（システム言語に応じて変更）
```

---

### 6. UIの動的言語切り替え（オプション）
アプリ内で言語を動的に変更したい場合、`Locale`を`StatefulWidget`で管理します。

#### a. `ChangeNotifier`でロケールを管理
```dart
class LocaleProvider with ChangeNotifier {
  Locale _locale = const Locale('ja');

  Locale get locale => _locale;

  void setLocale(Locale locale) {
    _locale = locale;
    notifyListeners();
  }
}
```

#### b. アプリで使用
```dart
void main() {
  runApp(
    ChangeNotifierProvider(
      create: (_) => LocaleProvider(),
      child: MyApp(),
    ),
  );
}

class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    final localeProvider = Provider.of<LocaleProvider>(context);

    return MaterialApp(
      locale: localeProvider.locale,
      localizationsDelegates: [
        S.delegate,
        GlobalMaterialLocalizations.delegate,
        GlobalWidgetsLocalizations.delegate,
        GlobalCupertinoLocalizations.delegate,
      ],
      supportedLocales: S.delegate.supportedLocales,
      home: MyHomePage(),
    );
  }
}
```

---

これで、Flutterアプリを多言語対応させる基本的な設定が完了です。必要に応じて、`intl`を使った日付や数値のフォーマットにも対応できます。

---

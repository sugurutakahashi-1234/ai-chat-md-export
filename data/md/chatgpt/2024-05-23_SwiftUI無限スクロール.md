# SwiftUI無限スクロール

日付: 2024-05-23

---

## 👤 ユーザー
*2024/05/23 14:43:17*

SwiftUI でスクロール View で refreshable のようにボトムが表示されたら無限スクロールにする方法

---

## 🤖 アシスタント
*2024/05/23 14:43:30*

SwiftUIでスクロールViewにおいて、ボトムが表示されたら無限スクロールを実現する方法の一例をご紹介します。この方法では、`ScrollView`と`GeometryReader`を使用して、スクロールの終わりを検知し、データを追加ロードします。

以下に、具体的なコード例を示します：

```swift
import SwiftUI

struct InfiniteScrollView: View {
    @State private var items: [String] = Array(1...20).map { "Item \($0)" }
    @State private var isLoading: Bool = false
    
    var body: some View {
        ScrollView {
            LazyVStack {
                ForEach(items, id: \.self) { item in
                    Text(item)
                        .padding()
                        .background(Color.gray.opacity(0.1))
                        .cornerRadius(8)
                }
                
                if isLoading {
                    ProgressView()
                        .padding()
                } else {
                    GeometryReader { geometry in
                        Color.clear
                            .onAppear {
                                if geometry.frame(in: .global).maxY < UIScreen.main.bounds.height {
                                    loadMoreData()
                                }
                            }
                    }
                    .frame(height: 50)
                }
            }
            .padding()
        }
    }
    
    private func loadMoreData() {
        guard !isLoading else { return }
        
        isLoading = true
        
        DispatchQueue.main.asyncAfter(deadline: .now() + 2) {
            let newItems = items.count + 1...items.count + 20
            items.append(contentsOf: newItems.map { "Item \($0)" })
            isLoading = false
        }
    }
}

struct InfiniteScrollView_Previews: PreviewProvider {
    static var previews: some View {
        InfiniteScrollView()
    }
}
```

### 解説

1. **Stateの定義**:
    - `items`にはリスト表示するデータを格納します。
    - `isLoading`はデータのロード状態を管理します。

2. **ScrollViewとLazyVStackの使用**:
    - `ScrollView`内に`LazyVStack`を配置し、各`item`をリスト表示します。

3. **GeometryReaderによるスクロールの終わりの検知**:
    - `GeometryReader`を使用して、スクロールがボトムに達したことを検知します。
    - `GeometryReader`の`onAppear`修飾子を使い、表示位置を確認します。スクロール位置がボトム近くになった場合に`loadMoreData()`を呼び出します。

4. **データの追加ロード**:
    - `loadMoreData()`関数で、データの追加ロードを行います。データのロードが終わるまで`isLoading`を`true`に設定し、ロード完了後に`false`に戻します。

この方法により、スクロールの終わりに自動的にデータを追加ロードする無限スクロールを実現できます。

---

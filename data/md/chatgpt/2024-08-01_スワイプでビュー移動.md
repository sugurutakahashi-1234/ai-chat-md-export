# スワイプでビュー移動

日付: 2024-08-01

---

## 👤 ユーザー
*2024/8/1 11:51:25*

SwiftUIで四角のViewを置く
その四角のViewは下スワイプによって下移動が可能である
その四角の下に全く同じサイズで四角のViewが裏に重なってて、その上部に「↓スワイプでコメント」と表示して、一定量スクロールしたことを検知して別のViewを立ち上げる処理をしたい

---

## 🤖 アシスタント
*2024/8/1 11:51:39*

SwiftUIで下スワイプによって別のViewを立ち上げる機能を実装するには、`DragGesture`と`GeometryReader`を組み合わせると効果的です。以下の例では、四角いViewをスワイプして、一定量スクロールされたことを検知して新しいViewを表示します。

```swift
import SwiftUI

struct ContentView: View {
    @State private var offsetY: CGFloat = 0
    @State private var showNewView: Bool = false

    var body: some View {
        ZStack {
            if showNewView {
                NewView()
                    .transition(.move(edge: .bottom))
            } else {
                VStack {
                    Spacer()
                    Text("↓スワイプでコメント")
                        .padding()
                        .background(Color.gray.opacity(0.5))
                        .cornerRadius(10)
                        .padding(.bottom, 20)
                }

                VStack {
                    Rectangle()
                        .fill(Color.blue)
                        .frame(height: 200)
                        .offset(y: offsetY)
                        .gesture(
                            DragGesture()
                                .onChanged { value in
                                    self.offsetY = value.translation.height
                                }
                                .onEnded { value in
                                    if value.translation.height > 100 {
                                        withAnimation {
                                            self.showNewView = true
                                        }
                                    } else {
                                        withAnimation {
                                            self.offsetY = 0
                                        }
                                    }
                                }
                        )
                    
                    Rectangle()
                        .fill(Color.green)
                        .frame(height: 200)
                        .offset(y: -200 + offsetY)
                }
            }
        }
    }
}

struct NewView: View {
    var body: some View {
        VStack {
            Text("新しいビューが表示されました")
                .font(.largeTitle)
                .padding()
            Spacer()
        }
        .background(Color.white)
    }
}

struct ContentView_Previews: PreviewProvider {
    static var previews: some View {
        ContentView()
    }
}
```

### 解説
1. `ContentView`には2つの`Rectangle`ビューを重ねています。
2. 最初の`Rectangle`は青色で、ドラッグ操作によって垂直方向に移動します。
3. 2つ目の`Rectangle`は緑色で、青い`Rectangle`の裏に隠れるように配置されています。
4. `DragGesture`を使用して、スワイプの動きを検知し、一定量（この例では100ポイント）スワイプされた場合に新しいビューを表示します。
5. `showNewView`が`true`になった場合、`NewView`が表示されます。

この例を元に、具体的な要件に合わせて調整してください。

---

## 👤 ユーザー
*2024/8/1 11:52:25*

ContentViewをTestViewとしてほしい

---

## 🤖 アシスタント
*2024/8/1 11:52:39*

了解しました。以下は、`ContentView`を`TestView`としてリネームし、同じ機能を持つSwiftUIのコードです。

```swift
import SwiftUI

struct TestView: View {
    @State private var offsetY: CGFloat = 0
    @State private var showNewView: Bool = false

    var body: some View {
        ZStack {
            if showNewView {
                NewView()
                    .transition(.move(edge: .bottom))
            } else {
                VStack {
                    Spacer()
                    Text("↓スワイプでコメント")
                        .padding()
                        .background(Color.gray.opacity(0.5))
                        .cornerRadius(10)
                        .padding(.bottom, 20)
                }

                VStack {
                    Rectangle()
                        .fill(Color.blue)
                        .frame(height: 200)
                        .offset(y: offsetY)
                        .gesture(
                            DragGesture()
                                .onChanged { value in
                                    self.offsetY = value.translation.height
                                }
                                .onEnded { value in
                                    if value.translation.height > 100 {
                                        withAnimation {
                                            self.showNewView = true
                                        }
                                    } else {
                                        withAnimation {
                                            self.offsetY = 0
                                        }
                                    }
                                }
                        )
                    
                    Rectangle()
                        .fill(Color.green)
                        .frame(height: 200)
                        .offset(y: -200 + offsetY)
                }
            }
        }
    }
}

struct NewView: View {
    var body: some View {
        VStack {
            Text("新しいビューが表示されました")
                .font(.largeTitle)
                .padding()
            Spacer()
        }
        .background(Color.white)
    }
}

struct TestView_Previews: PreviewProvider {
    static var previews: some View {
        TestView()
    }
}
```

### 解説
- `ContentView`の名前を`TestView`に変更しました。
- その他のコードは変更していませんので、同じ機能を持っています。

この`TestView`を使って、目的の機能を確認できます。

---

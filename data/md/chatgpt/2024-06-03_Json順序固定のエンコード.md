# Jsoné †åºå›ºå®šã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰

æ—¥ä»˜: 2024-06-03

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2024/6/3 19:12:46*

Swiftã§jsonã‚’ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹ãŒã€æ¯å›keyã®é †ç•ªãŒå›ºå®šã§ã¯ãªã„ã€‚å›ºå®šã«ã—ãŸã„å ´åˆã¯ã©ã†ã™ã‚Œã°ã„ã„ã‹ï¼Ÿ

class JSONHandleDriver {
    func encodeToJSONString(anyObject: Any) throws -&gt; String {
        guard let encodableObject = anyObject as? (any Encodable) else {
            OSLogger.debugLog("JSON Encode Error")
            throw AppError.customError("JSON Encode Error")
        }

        let encoder = JSONEncoder()
        encoder.outputFormatting = .prettyPrinted

        let data = try encoder.encode(encodableObject)

        guard let jsonString = String(data: data, encoding: .utf8) else {
            OSLogger.debugLog("JSON Encode Error")
            throw AppError.customError("JSON Encode Error")
        }

        return jsonString
    }

    func encodeToJSONString(object: some Encodable) throws -&gt; String {
        let encoder = JSONEncoder()
        encoder.outputFormatting = .prettyPrinted

        let data = try encoder.encode(object)

        guard let jsonString = String(data: data, encoding: .utf8) else {
            OSLogger.debugLog("JSON Encode Error")
            throw AppError.customError("JSON Encode Error")
        }

        return jsonString
    }

    func encodeToJSONString(objects: \[some Encodable\]) throws -&gt; String {
        let encoder = JSONEncoder()
        encoder.outputFormatting = .prettyPrinted

        let data = try encoder.encode(objects)
        guard let jsonString = String(data: data, encoding: .utf8) else {
            OSLogger.debugLog("JSON Encode Error")
            throw AppError.customError("JSON Encode Error")
        }

        return jsonString
    }
}

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2024/6/3 19:13:14*

Swiftã®`JSONEncoder`ã‚’ä½¿ç”¨ã—ã¦JSONã‚’ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹éš›ã€ã‚­ãƒ¼ã®é †åºã¯ä¿è¨¼ã•ã‚Œã¾ã›ã‚“ã€‚ã—ã‹ã—ã€ã‚­ãƒ¼ã®é †åºã‚’å›ºå®šã«ã™ã‚‹æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚JSONã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å‰ã«ã€è¾æ›¸å½¢å¼ã«å¤‰æ›ã—ã¦ã€ã‚­ãƒ¼ã‚’ã‚½ãƒ¼ãƒˆã—ã¦ã‹ã‚‰ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ãŒä¸€ã¤ã®è§£æ±ºç­–ã§ã™ã€‚

ä»¥ä¸‹ã¯ã€ã‚­ãƒ¼ã®é †åºã‚’å›ºå®šã«ã™ã‚‹ãŸã‚ã®ä¿®æ­£æ¡ˆã§ã™ï¼š

1. `JSONSerialization`ã‚’ä½¿ç”¨ã—ã¦ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¾æ›¸å½¢å¼ã«å¤‰æ›ã€‚
2. è¾æ›¸ã®ã‚­ãƒ¼ã‚’ã‚½ãƒ¼ãƒˆã—ã¦ã€æ–°ã—ã„è¾æ›¸ã‚’ä½œæˆã€‚
3. å†ã³ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã€‚

ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè£…ã—ã¾ã™ã€‚

```swift
class JSONHandleDriver {
    func encodeToJSONString(anyObject: Any) throws -> String {
        guard let encodableObject = anyObject as? (any Encodable) else {
            OSLogger.debugLog("JSON Encode Error")
            throw AppError.customError("JSON Encode Error")
        }

        let encoder = JSONEncoder()
        encoder.outputFormatting = .prettyPrinted

        let data = try encoder.encode(encodableObject)
        guard let jsonObject = try JSONSerialization.jsonObject(with: data) as? [String: Any] else {
            OSLogger.debugLog("JSON Encode Error")
            throw AppError.customError("JSON Encode Error")
        }

        let sortedJsonData = try JSONSerialization.data(withJSONObject: sortDictionary(jsonObject), options: .prettyPrinted)
        guard let jsonString = String(data: sortedJsonData, encoding: .utf8) else {
            OSLogger.debugLog("JSON Encode Error")
            throw AppError.customError("JSON Encode Error")
        }

        return jsonString
    }

    func encodeToJSONString(object: some Encodable) throws -> String {
        let encoder = JSONEncoder()
        encoder.outputFormatting = .prettyPrinted

        let data = try encoder.encode(object)
        guard let jsonObject = try JSONSerialization.jsonObject(with: data) as? [String: Any] else {
            OSLogger.debugLog("JSON Encode Error")
            throw AppError.customError("JSON Encode Error")
        }

        let sortedJsonData = try JSONSerialization.data(withJSONObject: sortDictionary(jsonObject), options: .prettyPrinted)
        guard let jsonString = String(data: sortedJsonData, encoding: .utf8) else {
            OSLogger.debugLog("JSON Encode Error")
            throw AppError.customError("JSON Encode Error")
        }

        return jsonString
    }

    func encodeToJSONString(objects: [some Encodable]) throws -> String {
        let encoder = JSONEncoder()
        encoder.outputFormatting = .prettyPrinted

        let data = try encoder.encode(objects)
        guard let jsonArray = try JSONSerialization.jsonObject(with: data) as? [[String: Any]] else {
            OSLogger.debugLog("JSON Encode Error")
            throw AppError.customError("JSON Encode Error")
        }

        let sortedJsonArray = jsonArray.map { sortDictionary($0) }
        let sortedJsonData = try JSONSerialization.data(withJSONObject: sortedJsonArray, options: .prettyPrinted)
        guard let jsonString = String(data: sortedJsonData, encoding: .utf8) else {
            OSLogger.debugLog("JSON Encode Error")
            throw AppError.customError("JSON Encode Error")
        }

        return jsonString
    }

    private func sortDictionary(_ dictionary: [String: Any]) -> [String: Any] {
        let sortedKeys = dictionary.keys.sorted()
        var sortedDictionary = [String: Any]()
        for key in sortedKeys {
            if let value = dictionary[key] as? [String: Any] {
                sortedDictionary[key] = sortDictionary(value)
            } else if let value = dictionary[key] as? [[String: Any]] {
                sortedDictionary[key] = value.map { sortDictionary($0) }
            } else {
                sortedDictionary[key] = dictionary[key]
            }
        }
        return sortedDictionary
    }
}
```

ã“ã®ä¿®æ­£ã«ã‚ˆã‚Šã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸJSONæ–‡å­—åˆ—ã®ã‚­ãƒ¼ã®é †åºãŒä¿è¨¼ã•ã‚Œã¾ã™ã€‚è¾æ›¸å†…ã®ã‚­ãƒ¼ã‚’ã‚½ãƒ¼ãƒˆã™ã‚‹ã“ã¨ã§ã€ä¸€å®šã®é †åºã‚’ç¶­æŒã—ã¾ã™ã€‚

---

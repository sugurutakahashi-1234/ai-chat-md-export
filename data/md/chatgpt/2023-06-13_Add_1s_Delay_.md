# Add 1s Delay.

æ—¥ä»˜: 2023-06-13

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2023/06/13 20:44:56*

ä»¥ä¸‹ã®Missionã¨Missionã®é…åˆ—ã‚’è¿”å´ã™ã‚‹é–¢æ•°ã®Handlerã«ã¤ã„ã¦ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™å‰ã«1ç§’ã®é…å»¶å‡¦ç†ã‚’å…¥ã‚ŒãŸã„ã®ã ã‘ã‚Œã©ã‚‚ã©ã†ã™ã‚Œã°ã„ã„ï¼Ÿ


import Combine
import Foundation

public final class ApiRequestManagerProtocolMock: ApiRequestManagerProtocol {
    public init() {}

    public private(set) var getUserCallCount = 0
    public var getUserHandler: (() async throws -&gt; (User))?
    public func getUser() async throws -&gt; User {
        getUserCallCount += 1
        if let getUserHandler {
            return try await getUserHandler()
        }
        fatalError("getUserHandler returns can't have a default value thus its handler must be set")
    }

    public private(set) var getUserAttributeContentsCallCount = 0
    public var getUserAttributeContentsHandler: (() async throws -&gt; (UserAttributeContents))?
    public func getUserAttributeContents() async throws -&gt; UserAttributeContents {
        getUserAttributeContentsCallCount += 1
        if let getUserAttributeContentsHandler {
            return try await getUserAttributeContentsHandler()
        }
        fatalError("getUserAttributeContentsHandler returns can't have a default value thus its handler must be set")
    }

    public private(set) var getUserAttributeCallCount = 0
    public var getUserAttributeHandler: (() async throws -&gt; (UserAttributes))?
    public func getUserAttribute() async throws -&gt; UserAttributes {
        getUserAttributeCallCount += 1
        if let getUserAttributeHandler {
            return try await getUserAttributeHandler()
        }
        fatalError("getUserAttributeHandler returns can't have a default value thus its handler must be set")
    }

    public private(set) var getMissionListCallCount = 0
    public var getMissionListHandler: ((MeasurementType?) async throws -&gt; ([Mission]))? = { _ in
        [.dummy, .dummy] // TODO: ä»®
    }
    public func getMissionList(measurementType: MeasurementType?) async throws -&gt; [Mission] {
        getMissionListCallCount += 1
        if let getMissionListHandler {
            return try await getMissionListHandler(measurementType)
        }
        return [Mission]()
    }

    public private(set) var getMissionCallCount = 0
    public var getMissionHandler: ((String) async throws -&gt; (Mission))? = { _ in
        .dummy // TODO: ä»®
    }
    public func getMission(id: String) async throws -&gt; Mission {
        getMissionCallCount += 1
        if let getMissionHandler {
            return try await getMissionHandler(id)
        }
        fatalError("getMissionHandler returns can't have a default value thus its handler must be set")
    }

    public private(set) var getVideoMeasurementCallCount = 0
    public var getVideoMeasurementHandler: ((String) async throws -&gt; (VideoMeasurement))?
    public func getVideoMeasurement(id: String) async throws -&gt; VideoMeasurement {
        getVideoMeasurementCallCount += 1
        if let getVideoMeasurementHandler {
            return try await getVideoMeasurementHandler(id)
        }
        fatalError("getVideoMeasurementHandler returns can't have a default value thus its handler must be set")
    }

    public private(set) var getWebsiteMeasurementCallCount = 0
    public var getWebsiteMeasurementHandler: ((String) async throws -&gt; (WebsiteMeasurement))?
    public func getWebsiteMeasurement(id: String) async throws -&gt; WebsiteMeasurement {
        getWebsiteMeasurementCallCount += 1
        if let getWebsiteMeasurementHandler {
            return try await getWebsiteMeasurementHandler(id)
        }
        fatalError("getWebsiteMeasurementHandler returns can't have a default value thus its handler must be set")
    }

    public private(set) var getPointHistoriesCallCount = 0
    public var getPointHistoriesHandler: (() async throws -&gt; ([PointHistory]))?
    public func getPointHistories() async throws -&gt; [PointHistory] {
        getPointHistoriesCallCount += 1
        if let getPointHistoriesHandler {
            return try await getPointHistoriesHandler()
        }
        return [PointHistory]()
    }

    public private(set) var getResearchesCallCount = 0
    public var getResearchesHandler: ((MeasurementType?) async throws -&gt; ([Research]))?
    public func getResearches(measurementType: MeasurementType?) async throws -&gt; [Research] {
        getResearchesCallCount += 1
        if let getResearchesHandler {
            return try await getResearchesHandler(measurementType)
        }
        return [Research]()
    }

    public private(set) var getResearchCallCount = 0
    public var getResearchHandler: ((String) async throws -&gt; (Research))?
    public func getResearch(id: String) async throws -&gt; Research {
        getResearchCallCount += 1
        if let getResearchHandler {
            return try await getResearchHandler(id)
        }
        fatalError("getResearchHandler returns can't have a default value thus its handler must be set")
    }
}

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2023/06/13 20:45:31*

Swiftã®`async/await`ã¯ã€éåŒæœŸå‡¦ç†ã‚’ç›´æ„Ÿçš„ã«ã‹ã¤é †åºç«‹ã¦ã¦å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ç‰¹æ€§ã§ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«é…å»¶å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

Swift 5.5ä»¥é™ã§ã¯`Task.sleep(nanoseconds:)`ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚’ä½¿ã£ã¦ã€æŒ‡å®šã—ãŸæ™‚é–“ï¼ˆãƒŠãƒç§’å˜ä½ï¼‰ã ã‘å‡¦ç†ã‚’åœæ­¢ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚1ç§’ã‚’ãƒŠãƒç§’ã«å¤‰æ›ã™ã‚‹ã¨1,000,000,000ãƒŠãƒç§’ã¨ãªã‚Šã¾ã™ã€‚

ä¾‹ãˆã°ã€`getMissionList`é–¢æ•°ã§1ç§’ã®é…å»¶ã‚’å…¥ã‚Œã‚‹ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```swift
public func getMissionList(measurementType: MeasurementType?) async throws -> [Mission] {
    getMissionListCallCount += 1
    if let getMissionListHandler {
        await Task.sleep(1_000_000_000) // 1ç§’ã®é…å»¶
        return try await getMissionListHandler(measurementType)
    }
    return [Mission]()
}
```

ã“ã®ã‚ˆã†ã«ã—ã¦å„é–¢æ•°ã«é…å»¶å‡¦ç†ã‚’æŒ¿å…¥ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®ã¨ãã€é…å»¶å‡¦ç†ã¯éåŒæœŸã®ãŸã‚ã€`await`ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦éåŒæœŸå‡¦ç†ãŒå®Œäº†ã™ã‚‹ã®ã‚’å¾…ã¤å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

---

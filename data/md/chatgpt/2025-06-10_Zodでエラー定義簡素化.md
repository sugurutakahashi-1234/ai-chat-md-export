# Zodã§ã‚¨ãƒ©ãƒ¼å®šç¾©ç°¡ç´ åŒ–

æ—¥ä»˜: 2025-06-10

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/10 10:26:51*

isolatedDeclarations: true ã«ã‚ˆã£ã¦ErrorDefinitionsãŒã“ã®ã‚ˆã†ãªé‡è¤‡ã—ãŸå®šç¾©ã«ãªã£ã¦ã—ã¾ã£ã¦ã„ã‚‹ã€‚
zodã‚’ä½¿ã†ã¨åŒã˜ã‚ˆã†ãªè¨˜è¿°isolatedDeclarations: true ã§ã‚‚ã‚ˆã‚Šç°¡ç´ ã«æ›¸ã‘ã‚‹ã‹ï¼Ÿ
ç°¡ç´ ã¨ã„ã£ã¦ã‚‚ã€å‹ã®è¨˜è¿°ã®é‡è¤‡ãã‚‰ã„ã§ã‚ã‚Œã°è¨±å®¹ã§ãã¾ã™ã€‚
ä»Šã¯"ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚"ãªã©ã®ãƒªãƒ†ãƒ©ãƒ«ãƒ¬ãƒ™ãƒ«ã§ä¸€è‡´ã—ã¦ã„ã‚‹ã“ã¨ã‚’è¨˜è¿°ã—ã¦ãŠã‚Šã¾ã™ã€‚

ææ¡ˆã™ã‚‹ã‚³ãƒ¼ãƒ‰ã®å¤‰æ•°å®£è¨€ã‚„é–¢æ•°ã®è¿”ã‚Šã«ã¤ã„ã¦å¿…ãšå‹ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚
ã“ã‚Œã¯å¿…ãšè¡Œãªã£ã¦ãã ã•ã„ã€‚

export enum ApiErrorType {
  // ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼
  Unknown = "Unknown",
  InternalServerError = "InternalServerError",

  // èªè¨¼ãƒ»èªå¯
  Unauthorized = "Unauthorized",
  Forbidden = "Forbidden",

  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  ValidationError = "ValidationError",
  BadRequest = "BadRequest",

  // ãƒªã‚½ãƒ¼ã‚¹
  NotFound = "NotFound",
  Conflict = "Conflict",

  // å…·ä½“çš„ãªãƒ“ã‚¸ãƒã‚¹ã‚¨ãƒ©ãƒ¼
  UserNotFound = "UserNotFound",
  EmailAlreadyExists = "EmailAlreadyExists",

  // è¤‡æ•°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒ†ã‚¹ãƒˆç”¨
  InvalidAgeRange = "InvalidAgeRange",
}


/\*\*
 \* ã‚¨ãƒ©ãƒ¼å®šç¾©ã‚’as constã§å®šç¾©
 \* å„ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—ã«å¯¾ã—ã¦ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã€å¿…è¦ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å®šç¾©
 \*/
export const ErrorDefinitions: {
  // ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼
  readonly Unknown: {
    readonly message: "äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
    readonly statusCode: 500;
    readonly params: Record&lt;string, never&gt;;
  };
  readonly InternalServerError: {
    readonly message: "ã‚µãƒ¼ãƒãƒ¼å†…éƒ¨ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
    readonly statusCode: 500;
    readonly params: Record&lt;string, never&gt;;
  };
  // èªè¨¼ãƒ»èªå¯
  readonly Unauthorized: {
    readonly message: "èªè¨¼ãŒå¿…è¦ã§ã™ã€‚";
    readonly statusCode: 401;
    readonly params: Record&lt;string, never&gt;;
  };
  readonly Forbidden: {
    readonly message: "ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚";
    readonly statusCode: 403;
    readonly params: Record&lt;string, never&gt;;
  };
  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  readonly ValidationError: {
    readonly message: "å…¥åŠ›å€¤ã®æ¤œè¨¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
    readonly statusCode: 400;
    readonly params: Record&lt;string, never&gt;;
  };
  readonly BadRequest: {
    readonly message: "ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚";
    readonly statusCode: 400;
    readonly params: Record&lt;string, never&gt;;
  };
  // ãƒªã‚½ãƒ¼ã‚¹
  readonly NotFound: {
    readonly message: "ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚";
    readonly statusCode: 404;
    readonly params: Record&lt;string, never&gt;;
  };
  readonly Conflict: {
    readonly message: "æ—¢ã«å­˜åœ¨ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚";
    readonly statusCode: 409;
    readonly params: Record&lt;string, never&gt;;
  };
  // å…·ä½“çš„ãªãƒ“ã‚¸ãƒã‚¹ã‚¨ãƒ©ãƒ¼
  readonly UserNotFound: {
    readonly message: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚";
    readonly statusCode: 404;
    readonly params: Record&lt;string, never&gt;;
  };
  readonly EmailAlreadyExists: {
    readonly message: "{email} ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚";
    readonly statusCode: 409;
    readonly params: { email: string };
  };
  // è¤‡æ•°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒ†ã‚¹ãƒˆç”¨
  readonly InvalidAgeRange: {
    readonly message: "å¹´é½¢ã¯{minAge}æ­³ã‹ã‚‰{maxAge}æ­³ã®é–“ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
    readonly statusCode: 400;
    readonly params: { minAge: string; maxAge: string };
  };
} = {
  // ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼
  \[ApiErrorType.Unknown\]: {
    message: "äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",
    statusCode: 500,
    params: {} as Record&lt;string, never&gt;,
  },
  \[ApiErrorType.InternalServerError\]: {
    message: "ã‚µãƒ¼ãƒãƒ¼å†…éƒ¨ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",
    statusCode: 500,
    params: {} as Record&lt;string, never&gt;,
  },

  // èªè¨¼ãƒ»èªå¯
  \[ApiErrorType.Unauthorized\]: {
    message: "èªè¨¼ãŒå¿…è¦ã§ã™ã€‚",
    statusCode: 401,
    params: {} as Record&lt;string, never&gt;,
  },
  \[ApiErrorType.Forbidden\]: {
    message: "ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚",
    statusCode: 403,
    params: {} as Record&lt;string, never&gt;,
  },

  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  \[ApiErrorType.ValidationError\]: {
    message: "å…¥åŠ›å€¤ã®æ¤œè¨¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",
    statusCode: 400,
    params: {} as Record&lt;string, never&gt;,
  },
  \[ApiErrorType.BadRequest\]: {
    message: "ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚",
    statusCode: 400,
    params: {} as Record&lt;string, never&gt;,
  },

  // ãƒªã‚½ãƒ¼ã‚¹
  \[ApiErrorType.NotFound\]: {
    message: "ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚",
    statusCode: 404,
    params: {} as Record&lt;string, never&gt;,
  },
  \[ApiErrorType.Conflict\]: {
    message: "æ—¢ã«å­˜åœ¨ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚",
    statusCode: 409,
    params: {} as Record&lt;string, never&gt;,
  },

  // å…·ä½“çš„ãªãƒ“ã‚¸ãƒã‚¹ã‚¨ãƒ©ãƒ¼
  \[ApiErrorType.UserNotFound\]: {
    message: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚",
    statusCode: 404,
    params: {} as Record&lt;string, never&gt;,
  },
  \[ApiErrorType.EmailAlreadyExists\]: {
    message: "{email} ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚",
    statusCode: 409,
    params: {} as { email: string },
  },

  // è¤‡æ•°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒ†ã‚¹ãƒˆç”¨
  \[ApiErrorType.InvalidAgeRange\]: {
    message: "å¹´é½¢ã¯{minAge}æ­³ã‹ã‚‰{maxAge}æ­³ã®é–“ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚",
    statusCode: 400,
    params: {} as { minAge: string; maxAge: string },
  },
} as const satisfies Record&lt;
  ApiErrorType,
  {
    message: string;
    statusCode: number;
    params: Record&lt;string, string&gt;;
  }
&gt;;

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/10 10:26:53*

ä»¥ä¸‹ã¯ **`isolatedDeclarations: true`** ã§ã‚‚ *d.ts ç”Ÿæˆæ™‚ã«é‡è¤‡ãŒç™ºç”Ÿã›ãš*ã€  
ã‹ã¤ **Zod ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å½¢ã‚’å‹å®‰å…¨ã«æ¤œè¨¼ã§ãã‚‹** æœ€å°é™ã®å®Ÿè£…ä¾‹ã§ã™ã€‚  
2 ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆ†é›¢ã—ã€**ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‹HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼‰** ã¨ **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒ** ã‚’åˆ¥ã€…ã«ç®¡ç†ã—ã¾ã™ã€‚

```ts
// errors.ts ---------------------------------------------------------------
import { z, ZodTypeAny } from "zod";

/* ---------- 1. ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥ ------------------------------------------------ */
export enum ApiErrorType {
  // ã‚·ã‚¹ãƒ†ãƒ 
  Unknown             = "Unknown",
  InternalServerError = "InternalServerError",

  // èªè¨¼ãƒ»èªå¯
  Unauthorized = "Unauthorized",
  Forbidden    = "Forbidden",

  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  ValidationError = "ValidationError",
  BadRequest      = "BadRequest",

  // ãƒªã‚½ãƒ¼ã‚¹
  NotFound = "NotFound",
  Conflict = "Conflict",

  // ãƒ“ã‚¸ãƒã‚¹
  UserNotFound        = "UserNotFound",
  EmailAlreadyExists  = "EmailAlreadyExists",
  InvalidAgeRange     = "InvalidAgeRange",
}

/* ---------- 2. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ & HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ ----------------------------- */
/** å‹æ³¨é‡ˆã‚’æ˜ç¤ºã—ã¦ isolatedDeclarations ã«å¯¾å¿œ */
export const errorMetaMap: Readonly<Record<ApiErrorType, { message: string; statusCode: number }>> = {
  // ã‚·ã‚¹ãƒ†ãƒ 
  [ApiErrorType.Unknown]            : { message: "äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",              statusCode: 500 },
  [ApiErrorType.InternalServerError]: { message: "ã‚µãƒ¼ãƒãƒ¼å†…éƒ¨ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",            statusCode: 500 },

  // èªè¨¼ãƒ»èªå¯
  [ApiErrorType.Unauthorized]: { message: "èªè¨¼ãŒå¿…è¦ã§ã™ã€‚",             statusCode: 401 },
  [ApiErrorType.Forbidden]   : { message: "ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚",     statusCode: 403 },

  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  [ApiErrorType.ValidationError]: { message: "å…¥åŠ›å€¤ã®æ¤œè¨¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚", statusCode: 400 },
  [ApiErrorType.BadRequest]      : { message: "ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚",   statusCode: 400 },

  // ãƒªã‚½ãƒ¼ã‚¹
  [ApiErrorType.NotFound] : { message: "ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚",           statusCode: 404 },
  [ApiErrorType.Conflict] : { message: "æ—¢ã«å­˜åœ¨ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚",           statusCode: 409 },

  // ãƒ“ã‚¸ãƒã‚¹
  [ApiErrorType.UserNotFound]       : { message: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚",                         statusCode: 404 },
  [ApiErrorType.EmailAlreadyExists] : { message: "{email} ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚",                  statusCode: 409 },
  [ApiErrorType.InvalidAgeRange]    : { message: "å¹´é½¢ã¯{minAge}æ­³ã‹ã‚‰{maxAge}æ­³ã®é–“ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚", statusCode: 400 },
};

/* ---------- 3. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒ --------------------------------------- */
export const errorParamSchemaMap: Readonly<Record<ApiErrorType, ZodTypeAny>> = {
  // ã‚·ã‚¹ãƒ†ãƒ 
  [ApiErrorType.Unknown]            : z.never(),
  [ApiErrorType.InternalServerError]: z.never(),

  // èªè¨¼ãƒ»èªå¯
  [ApiErrorType.Unauthorized]: z.never(),
  [ApiErrorType.Forbidden]   : z.never(),

  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  [ApiErrorType.ValidationError]: z.never(),
  [ApiErrorType.BadRequest]      : z.never(),

  // ãƒªã‚½ãƒ¼ã‚¹
  [ApiErrorType.NotFound] : z.never(),
  [ApiErrorType.Conflict] : z.never(),

  // ãƒ“ã‚¸ãƒã‚¹
  [ApiErrorType.UserNotFound]      : z.never(),
  [ApiErrorType.EmailAlreadyExists]: z.object({ email: z.string() }),
  [ApiErrorType.InvalidAgeRange]   : z.object({ minAge: z.string(), maxAge: z.string() }),
} as const;

/* ---------- 4. å‹ä»˜ã‘æ¸ˆã¿å®šç¾©ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ----------------------------- */
export type ErrorParams<T extends ApiErrorType> = z.infer<(typeof errorParamSchemaMap)[T]>;

export interface ErrorDefinition<T extends ApiErrorType> {
  readonly type: T;
  readonly message: (typeof errorMetaMap)[T]["message"];
  readonly statusCode: (typeof errorMetaMap)[T]["statusCode"];
  readonly params: ErrorParams<T>;
}

/**
 * å‹å®‰å…¨ã«ã‚¨ãƒ©ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹ãƒ•ã‚¡ã‚¯ãƒˆãƒªé–¢æ•°
 * @param type   ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥
 * @param params ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ (ä¸è¦ãªå ´åˆã¯ `undefined` ã‚’æ¸¡ã™)
 */
export function createError<T extends ApiErrorType>(
  type: T,
  params: ErrorParams<T> extends never ? undefined : ErrorParams<T>,
): ErrorDefinition<T> {
  // å®Ÿè¡Œæ™‚ã‚‚ Zod ã§æ¤œè¨¼ã—ã¦ãŠã
  const schema = errorParamSchemaMap[type];
  // @ts-expect-error â€” `never` ã®å ´åˆã¯ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼ä¸è¦
  if (schema !== z.never()) schema.parse(params);

  return {
    type,
    message: errorMetaMap[type].message,
    statusCode: errorMetaMap[type].statusCode,
    // çœç•¥æ™‚ã¯ {} ã«æ•´å½¢
    params: (params ?? ({} as ErrorParams<T>)) as ErrorParams<T>,
  };
}
```

---

## ä½¿ã„æ–¹ã‚µãƒ³ãƒ—ãƒ«

```ts
// sample.ts ---------------------------------------------------------------
import { ApiErrorType, createError } from "./errors";

// âœ”ï¸ å¿…è¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚ã‚Šï¼šã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚‚å®Ÿè¡Œã‚‚ OK
const err1 = createError(ApiErrorType.EmailAlreadyExists, { email: "foo@example.com" });

// âœ”ï¸ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸è¦ã®ã‚¨ãƒ©ãƒ¼ï¼šç¬¬äºŒå¼•æ•°ã¯ `undefined`
const err2 = createError(ApiErrorType.NotFound, undefined);

// âŒ å‹ä¸ä¸€è‡´ï¼šã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼
// const err3 = createError(ApiErrorType.EmailAlreadyExists, { mail: "ng@example.com" });

// âŒ ä¸è¦ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼šã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼
// const err4 = createError(ApiErrorType.NotFound, { anything: "ng" });
```

---

### ã“ã®æ§‹æˆã®ãƒã‚¤ãƒ³ãƒˆ

1. **é‡è¤‡ã‚’æœ€å°åŒ–**  
   - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¯ `errorMetaMap` ã« 1 å›ã ã‘è¨˜è¿°ã€‚  
   - ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å½¢ã¯ `errorParamSchemaMap` ã« 1 å›ã ã‘è¨˜è¿°ã€‚  
   - `isolatedDeclarations` ã§ã‚‚å„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«æ˜ç¤ºçš„ãªå‹æ³¨é‡ˆã‚’ä»˜ã‘ã¦ã„ã‚‹ãŸã‚ã€  
     `.d.ts` ç”Ÿæˆæ™‚ã«â€œå‹ãŒæ¨è«–ã§ããªã„â€ã¨ã„ã†è­¦å‘ŠãŒå‡ºã¾ã›ã‚“ã€‚

2. **Zod ã§ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼ + å‹å®‰å…¨**  
   - `createError` å†…ã§ Zod ã® `parse()` ã‚’å®Ÿè¡Œã—ã€é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸ä¸€è‡´ã‚’æ—©æœŸç™ºè¦‹ã€‚  
   - å‘¼ã³å‡ºã—å´ã¯ `ErrorParams<T>` ã«ã‚ˆã‚Šã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ã‚‚ãƒã‚§ãƒƒã‚¯ã•ã‚Œã¾ã™ã€‚

3. **ãƒªãƒ†ãƒ©ãƒ«ãƒ¬ãƒ™ãƒ«ã®å³å¯†ä¸€è‡´**  
   - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ–‡å­—åˆ—ã¯ `errorMetaMap` ã®å€¤ã¨ã—ã¦ä¿æŒã—ã¦ã„ã‚‹ãŸã‚ã€  
     ä¾‹ç¤ºã„ãŸã ã„ãŸã€Œ"ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚"ã€ãƒ¬ãƒ™ãƒ«ã§ã®ä¸€è‡´ã‚‚æ‹…ä¿ã§ãã¾ã™ã€‚

4. **æ‹¡å¼µã‚‚ç°¡å˜**  
   - æ–°ã—ã„ã‚¨ãƒ©ãƒ¼ç¨®ã‚’è¿½åŠ ã™ã‚‹å ´åˆã¯  
     1. `ApiErrorType` ã«åˆ—æŒ™å­ã‚’è¿½åŠ   
     2. `errorMetaMap` ã¨ `errorParamSchemaMap` ã«å¯¾å¿œã™ã‚‹ã‚¨ãƒ³ãƒˆãƒªã‚’ 1 è¡Œãšã¤è¿½åŠ   
     ã§å®Œäº†ã—ã¾ã™ã€‚  

ã“ã‚Œã§ **ã‚³ãƒ¼ãƒ‰ã®è¦‹é€šã—ã‚’æãªã‚ãšã«é‡è¤‡ã‚’å‰Šæ¸›ã—ã¤ã¤ã€`isolatedDeclarations: true` ã¨å‹å®‰å…¨æ€§ã‚’ä¸¡ç«‹** ã§ãã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/10 10:36:58*

ã“ã®å½¢ãŒãƒ€ãƒ¡ã ã£ãŸ
createError(ApiErrorType.Unknown, undefined); 


createError(ApiErrorType.Unknown); // 2 å€‹ã®å¼•æ•°ãŒå¿…è¦ã§ã™ãŒã€1 å€‹æŒ‡å®šã•ã‚Œã¾ã—ãŸã€‚ts(2554) api-error-type.ts(350, 3): 'params' ã®å¼•æ•°ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
createError(ApiErrorType.Unknown, undefined); // å‹ 'undefined' ã®å¼•æ•°ã‚’å‹ 'Record&lt;string, never&gt;' ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã«å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ts(2345)
createError(ApiErrorType.EmailAlreadyExists, { // OK
  email: "test@example.com",
});
createError(ApiErrorType.InvalidAgeRange, { // OK
  minAge: "18",
  maxAge: "65",
});

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/10 10:37:00*

`Unknown` ãªã© **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸è¦ã®ã‚¨ãƒ©ãƒ¼** ã¨  
`EmailAlreadyExists` ã®ã‚ˆã†ã« **å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒã‚ã‚‹ã‚¨ãƒ©ãƒ¼** ã‚’  
å®Œå…¨ã«å‹ãƒ¬ãƒ™ãƒ«ã§åˆ†ã‘ã¦æ‰±ãˆã‚‹ã‚ˆã†ã€`createError` ã‚’ **ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰** ã§å®šç¾©ã—ç›´ã—ã¾ã™ã€‚  

> **ãƒã‚¤ãƒ³ãƒˆ**  
> 1. **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸è¦ï¼å¿…é ˆã‚’é™çš„ã«åˆ†é¡**ã—ã€å„ã€…ã«åˆ¥ã‚·ã‚°ãƒãƒãƒ£ã‚’ä¸ãˆã‚‹  
> 2. å®Ÿè£…ã‚·ã‚°ãƒãƒãƒ£ã¯å…±é€š (`params?: unknown`) ã¨ã—ã€å†…éƒ¨ã§ Zod æ¤œè¨¼  
> 3. å‘¼ã³å‡ºã—å´ã§ã¯ã€Œä¸è¦ãªã‚‰ 2 å¼•æ•°ç›®ã‚’çœç•¥ã€ã€Œå¿…è¦ãªã‚‰å¿…ãšæ¸¡ã™ã€ã“ã¨ã‚’ TypeScript ãŒå¼·åˆ¶

---

### 1ï¸âƒ£ è¿½åŠ ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£å‹

```ts
// errors.tsï¼ˆå‰åŠã¯å‰å›ã¨åŒã˜ã€‚çœç•¥ï¼‰ ------------------------------------
type ErrorParams<T extends ApiErrorType> =
  z.infer<(typeof errorParamSchemaMap)[T]>;

// ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¦æ±‚ã™ã‚‹ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥ã¨ã—ãªã„ç¨®åˆ¥ã‚’æŠ½å‡º
type ErrorTypeWithParams = {
  [K in ApiErrorType]: ErrorParams<K> extends never ? never : K;
}[ApiErrorType];

type ErrorTypeWithoutParams = Exclude<ApiErrorType, ErrorTypeWithParams>;
```

---

### 2ï¸âƒ£ `createError` ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰å®Ÿè£…

```ts
/* ---------- 4. ã‚¨ãƒ©ãƒ¼ç”Ÿæˆãƒ•ã‚¡ã‚¯ãƒˆãƒª ------------------------------------ */
/**
 * ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸è¦ã®ã‚¨ãƒ©ãƒ¼
 */
export function createError<T extends ErrorTypeWithoutParams>(
  type: T,
): ErrorDefinition<T>;

/**
 * ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¿…é ˆã®ã‚¨ãƒ©ãƒ¼
 */
export function createError<T extends ErrorTypeWithParams>(
  type: T,
  params: ErrorParams<T>,
): ErrorDefinition<T>;

/* å®Ÿè£…ã‚·ã‚°ãƒãƒãƒ£ â€• ä¸Šè¨˜ 2 ã¤ã®ã©ã¡ã‚‰ã‹ã«ãƒãƒƒãƒã•ã›ã‚‹ */
export function createError(
  type: ApiErrorType,
  params?: unknown,
): ErrorDefinition<ApiErrorType> {
  const schema = errorParamSchemaMap[type];

  // never ä»¥å¤–ã¯ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼
  if (schema !== z.never()) {
    (schema as z.ZodTypeAny).parse(params);
  } else {
    // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸è¦ãªã®ã«æ¸¡ã•ã‚ŒãŸå ´åˆã¯é–‹ç™ºæ™‚ã«æ°—ã¥ã‘ã‚‹ã‚ˆã†ã«ã™ã‚‹
    if (params !== undefined) {
      throw new Error(`Error ${type} does not take parameters`);
    }
  }

  return {
    type,
    message: errorMetaMap[type].message,
    statusCode: errorMetaMap[type].statusCode,
    // params ã¯å­˜åœ¨ã—ãªã„å ´åˆã§ã‚‚ç©ºã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§çµ±ä¸€
    params: (params ?? {}) as never,
  };
}
```

---

## âœ… å‹•ä½œç¢ºèª

```ts
// sample.ts ---------------------------------------------------------------
import { ApiErrorType, createError } from "./errors";

// --- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸è¦ ----------------------
const e1 = createError(ApiErrorType.Unknown);          // âœ”ï¸ OK
// const e1x = createError(ApiErrorType.Unknown, {});  // âŒ ã‚¨ãƒ©ãƒ¼: params ã‚’å—ã‘ä»˜ã‘ãªã„

// --- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¿…é ˆ ----------------------
const e2 = createError(ApiErrorType.EmailAlreadyExists, {
  email: "foo@example.com",
}); // âœ”ï¸ OK

// const e2x = createError(ApiErrorType.EmailAlreadyExists);          // âŒ ã‚¨ãƒ©ãƒ¼: params å¿…é ˆ
// const e2y = createError(ApiErrorType.EmailAlreadyExists, {});      // âŒ ã‚¨ãƒ©ãƒ¼: email ãŒä¸è¶³
// const e2z = createError(ApiErrorType.EmailAlreadyExists, { mail: "ng" }); // âŒ ã‚¨ãƒ©ãƒ¼: ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å
```

---

### ã“ã‚Œã§è§£æ±ºã§ãã‚‹ã“ã¨

| èª²é¡Œ | è§£æ±ºãƒã‚¤ãƒ³ãƒˆ |
|------|--------------|
| **ã€Œundefinedã€ã‚’æ¸¡ã™ã¨å‹ä¸ä¸€è‡´** | ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã§ â€œä¸è¦ãªã‚‰å¼•æ•°è‡ªä½“ã‚’ä¸è¦â€ ã«å¤‰æ›´ |
| **`2 å€‹ã®å¼•æ•°ãŒå¿…è¦â€¦` ã‚¨ãƒ©ãƒ¼** | `ErrorTypeWithoutParams` ç”¨ã‚·ã‚°ãƒãƒãƒ£ã§ 1 å¼•æ•°ã‚’è¨±å¯ |
| **èª¤ã£ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¸¡ã—ã¦ã‚‚é€šã‚‹** | Zod ã® `parse()` ã«ã‚ˆã‚Šãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼ã‚‚ç¶™ç¶š |

---

> **æ‹¡å¼µæ‰‹é †**  
> æ–°ã—ã„ã‚¨ãƒ©ãƒ¼ã‚’è¿½åŠ ã™ã‚‹ã¨ãã¯å‰å›åŒæ§˜ **3 ã‹æ‰€**ï¼ˆ`enum`ï¼`errorMetaMap`ï¼`errorParamSchemaMap`ï¼‰ã‚’ 1 è¡Œãšã¤è¿½è¨˜ã™ã‚‹ã ã‘ã§ã€ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã®ä»•çµ„ã¿ã¯è‡ªå‹•çš„ã«è¿½å¾“ã—ã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/10 10:44:15*

ä»¥ä¸‹ã«ã¤ã„ã¦ã€minAgeã¨maxAgeãªã©Intã«ã§ãã‚‹ã‹ï¼Ÿ


/\* ---------- 2. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ & HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ ----------------------------- \*/
/\*\* å‹æ³¨é‡ˆã‚’æ˜ç¤ºã—ã¦ isolatedDeclarations ã«å¯¾å¿œ \*/
export const errorMetaMap: Readonly&lt;
  Record&lt;ApiErrorType, { message: string; statusCode: number }&gt;
&gt; = {
  // ã‚·ã‚¹ãƒ†ãƒ 
  \[ApiErrorType.Unknown\]: {
    message: "äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",
    statusCode: 500,
  },
  \[ApiErrorType.InternalServerError\]: {
    message: "ã‚µãƒ¼ãƒãƒ¼å†…éƒ¨ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",
    statusCode: 500,
  },

  // èªè¨¼ãƒ»èªå¯
  \[ApiErrorType.Unauthorized\]: { message: "èªè¨¼ãŒå¿…è¦ã§ã™ã€‚", statusCode: 401 },
  \[ApiErrorType.Forbidden\]: {
    message: "ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚",
    statusCode: 403,
  },

  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  \[ApiErrorType.ValidationError\]: {
    message: "å…¥åŠ›å€¤ã®æ¤œè¨¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",
    statusCode: 400,
  },
  \[ApiErrorType.BadRequest\]: {
    message: "ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚",
    statusCode: 400,
  },

  // ãƒªã‚½ãƒ¼ã‚¹
  \[ApiErrorType.NotFound\]: {
    message: "ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚",
    statusCode: 404,
  },
  \[ApiErrorType.Conflict\]: {
    message: "æ—¢ã«å­˜åœ¨ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚",
    statusCode: 409,
  },

  // ãƒ“ã‚¸ãƒã‚¹
  \[ApiErrorType.UserNotFound\]: {
    message: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚",
    statusCode: 404,
  },
  \[ApiErrorType.EmailAlreadyExists\]: {
    message: "{email} ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚",
    statusCode: 409,
  },
  \[ApiErrorType.InvalidAgeRange\]: {
    message: "å¹´é½¢ã¯{minAge}æ­³ã‹ã‚‰{maxAge}æ­³ã®é–“ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚",
    statusCode: 400,
  },
};

/\* ---------- 3. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒ --------------------------------------- \*/
export const errorParamSchemaMap: Readonly&lt;Record&lt;ApiErrorType, ZodTypeAny&gt;&gt; = {
  // ã‚·ã‚¹ãƒ†ãƒ 
  \[ApiErrorType.Unknown\]: z.never(),
  \[ApiErrorType.InternalServerError\]: z.never(),

  // èªè¨¼ãƒ»èªå¯
  \[ApiErrorType.Unauthorized\]: z.never(),
  \[ApiErrorType.Forbidden\]: z.never(),

  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  \[ApiErrorType.ValidationError\]: z.never(),
  \[ApiErrorType.BadRequest\]: z.never(),

  // ãƒªã‚½ãƒ¼ã‚¹
  \[ApiErrorType.NotFound\]: z.never(),
  \[ApiErrorType.Conflict\]: z.never(),

  // ãƒ“ã‚¸ãƒã‚¹
  \[ApiErrorType.UserNotFound\]: z.never(),
  \[ApiErrorType.EmailAlreadyExists\]: z.object({ email: z.string() }),
  \[ApiErrorType.InvalidAgeRange\]: z.object({
    minAge: z.string(),
    maxAge: z.string(),
  }),
} as const;

/\* ---------- 4. å‹ä»˜ã‘æ¸ˆã¿å®šç¾©ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ----------------------------- \*/
// errors.tsï¼ˆå‰åŠã¯å‰å›ã¨åŒã˜ã€‚çœç•¥ï¼‰ ------------------------------------
type MessageErrorParams&lt;T extends ApiErrorType&gt; = z.infer&lt;
  (typeof errorParamSchemaMap)\[T\]
&gt;;

// ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¦æ±‚ã™ã‚‹ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥ã¨ã—ãªã„ç¨®åˆ¥ã‚’æŠ½å‡º
type ErrorTypeWithParams = {
  \[K in ApiErrorType\]: MessageErrorParams&lt;K&gt; extends never ? never : K;
}\[ApiErrorType\];

type ErrorTypeWithoutParams = Exclude&lt;ApiErrorType, ErrorTypeWithParams&gt;;

export interface ErrorDefinition&lt;T extends ApiErrorType&gt; {
  readonly type: T;
  readonly message: (typeof errorMetaMap)\[T\]\["message"\];
  readonly statusCode: (typeof errorMetaMap)\[T\]\["statusCode"\];
  readonly params: ErrorParams&lt;T&gt;;
}

/\*\*
 \* ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸è¦ã®ã‚¨ãƒ©ãƒ¼
 \*/
export function createError&lt;T extends ErrorTypeWithoutParams&gt;(
  type: T,
): ErrorDefinition&lt;T&gt;;

/\*\*
 \* ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¿…é ˆã®ã‚¨ãƒ©ãƒ¼
 \*/
export function createError&lt;T extends ErrorTypeWithParams&gt;(
  type: T,
  params: ErrorParams&lt;T&gt;,
): ErrorDefinition&lt;T&gt;;

/\* å®Ÿè£…ã‚·ã‚°ãƒãƒãƒ£ â€• ä¸Šè¨˜ 2 ã¤ã®ã©ã¡ã‚‰ã‹ã«ãƒãƒƒãƒã•ã›ã‚‹ \*/
export function createError(
  type: ApiErrorType,
  params?: unknown,
): ErrorDefinition&lt;ApiErrorType&gt; {
  const schema = errorParamSchemaMap\[type\];

  // never ä»¥å¤–ã¯ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼
  if (schema !== z.never()) {
    (schema as z.ZodTypeAny).parse(params);
  } else {
    // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸è¦ãªã®ã«æ¸¡ã•ã‚ŒãŸå ´åˆã¯é–‹ç™ºæ™‚ã«æ°—ã¥ã‘ã‚‹ã‚ˆã†ã«ã™ã‚‹
    if (params !== undefined) {
      throw new Error(`Error ${type} does not take parameters`);
    }
  }

  return {
    type,
    message: errorMetaMap\[type\].message,
    statusCode: errorMetaMap\[type\].statusCode,
    // params ã¯å­˜åœ¨ã—ãªã„å ´åˆã§ã‚‚ç©ºã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§çµ±ä¸€
    params: (params ?? {}) as never,
  };
}

createError(ApiErrorType.Unknown, {}); // å‹ 'undefined' ã®å¼•æ•°ã‚’å‹ 'Record&lt;string, never&gt;' ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã«å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ts(2345)
createError(ApiErrorType.EmailAlreadyExists, {
  email: "test@example.com",
});
createError(ApiErrorType.InvalidAgeRange, {
  minAge: "18",
  maxAge: "65",
});

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/10 10:44:16*

ã¯ã„ã€`minAge` ã¨ `maxAge` ã‚’ **æ•´æ•° (int)** æ‰±ã„ã«ã§ãã¾ã™ã€‚  
ãƒã‚¤ãƒ³ãƒˆã¯ **Zod å´ã‚’ `z.number().int()` ã«å¤‰æ›´**ã™ã‚‹ã ã‘ã§ã€  
å‘¼ã³å‡ºã—å´ã§ã¯ `number` å‹ã¨ã—ã¦æ‰±ãˆã¾ã™ã€‚

---

## å¤‰æ›´ç‚¹ï¼ˆæŠœç²‹ï¼‰

```ts
/* ---------- 3. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒ --------------------------------------- */
export const errorParamSchemaMap: Readonly<Record<ApiErrorType, ZodTypeAny>> = {
  // â€¦çœç•¥â€¦

  // ãƒ“ã‚¸ãƒã‚¹
  [ApiErrorType.UserNotFound]: z.never(),
  [ApiErrorType.EmailAlreadyExists]: z.object({
    email: z.string(),
  }),
  [ApiErrorType.InvalidAgeRange]: z.object({
    /** æ•´æ•°ã®ã¿è¨±å¯ */
    minAge: z.number().int(),
    maxAge: z.number().int(),
  }),
} as const;

/* ---------- 4. å‹ä»˜ã‘ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ (æŠœç²‹) ------------------------------ */
type ErrorParams<T extends ApiErrorType> = z.infer<
  (typeof errorParamSchemaMap)[T]
>;
```

> **è£œè¶³**  
> - `z.number().int()` ã§ **å°æ•°ãƒ»NaNãƒ»Infinity ã‚’è‡ªå‹•ã§å¼¾ã** ãŸã‚ã€  
>   ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼ã§ã‚‚æ•´æ•°ã—ã‹é€šã‚Šã¾ã›ã‚“ã€‚  
> - TypeScript ã®å‹ã¯ `number` ã§ã™ãŒã€ã€Œæ•´æ•°ã‹ã©ã†ã‹ã€ã®ä¿è¨¼ã¯ Zod ãŒè¡Œã„ã¾ã™ã€‚  

---

## ä½¿ã„æ–¹ã‚µãƒ³ãƒ—ãƒ«ï¼ˆã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ç¢ºèªï¼‰

```ts
import { ApiErrorType, createError } from "./errors";

/* -------- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸è¦ ------------------------- */
const e0 = createError(ApiErrorType.Unknown); // âœ”ï¸ OK
// createError(ApiErrorType.Unknown, {});     // âŒ ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ï¼ˆparams ã¯ä¸è¦ï¼‰

/* -------- EmailAlreadyExists -------------------- */
const e1 = createError(ApiErrorType.EmailAlreadyExists, {
  email: "foo@example.com",
}); // âœ”ï¸ OK

/* -------- InvalidAgeRange (æ•´æ•°) ---------------- */
// âœ”ï¸ number å‹ã§ã‚ã‚Œã° OKï¼ˆå°æ•°ã¯å®Ÿè¡Œæ™‚ã« Zod ãŒå¼¾ãï¼‰
const e2 = createError(ApiErrorType.InvalidAgeRange, {
  minAge: 18,
  maxAge: 65,
});

// const e2x = createError(ApiErrorType.InvalidAgeRange, {
//   minAge: "18",            // âŒ ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ï¼ˆstring â†’ numberï¼‰
//   maxAge: "65",
// });
```

---

### ã¾ã¨ã‚

* `z.number().int()` ã«å¤‰æ›´ã™ã‚‹ã ã‘ã§ **æ•´æ•°å¿…é ˆ** ã‚’å‹ãƒ»ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ä¸¡é¢ã§ä¿è¨¼ã€‚  
* æ—¢å­˜ã® `createError` ãªã©ã¯ãã®ã¾ã¾å‹•ãã¾ã™ã€‚  
* ã“ã‚Œä»¥å¤–ã®å‹ï¼å®Ÿè£…éƒ¨åˆ†ã«å¤‰æ›´ã¯ä¸è¦ã§ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/10 10:52:23*

ã‚¨ãƒ©ãƒ¼ã«ãªã£ãŸ
// å‹ 'number' ã‚’å‹ 'string' ã«å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ts(2322)
// api-error-type.ts(101, 24): äºˆæœŸã•ã‚ŒãŸå‹ã¯ã€å‹ '{ minAge: string; maxAge: string; }' ã«å¯¾ã—ã¦ã“ã“ã§å®£è¨€ã•ã‚ŒãŸãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ 'minAge' ã‹ã‚‰å–å¾—ã•ã‚Œã¦ã„ã¾ã™
// api-error-type.ts(373, 17): å‘¼ã³å‡ºã—ã¯ã“ã®å®Ÿè£…ã«å¯¾ã—ã¦æˆåŠŸã—ãŸå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ãŒã€ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã®å®Ÿè£…ã‚·ã‚°ãƒãƒãƒ£ã¯å¤–éƒ¨ã‹ã‚‰ã¯å‚ç…§ã§ãã¾ã›ã‚“ã€‚
// (property) minAge: string
createError(ApiErrorType.InvalidAgeRange, {
  minAge: 18,
  maxAge: 65,
});

/\* ---------- 2. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ & HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ ----------------------------- \*/
/\*\* å‹æ³¨é‡ˆã‚’æ˜ç¤ºã—ã¦ isolatedDeclarations ã«å¯¾å¿œ \*/
export const errorMetaMap: Readonly&lt;
  Record&lt;ApiErrorType, { message: string; statusCode: number }&gt;
&gt; = {
  // ã‚·ã‚¹ãƒ†ãƒ 
  \[ApiErrorType.Unknown\]: {
    message: "äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",
    statusCode: 500,
  },
  \[ApiErrorType.InternalServerError\]: {
    message: "ã‚µãƒ¼ãƒãƒ¼å†…éƒ¨ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",
    statusCode: 500,
  },

  // èªè¨¼ãƒ»èªå¯
  \[ApiErrorType.Unauthorized\]: { message: "èªè¨¼ãŒå¿…è¦ã§ã™ã€‚", statusCode: 401 },
  \[ApiErrorType.Forbidden\]: {
    message: "ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚",
    statusCode: 403,
  },

  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  \[ApiErrorType.ValidationError\]: {
    message: "å…¥åŠ›å€¤ã®æ¤œè¨¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",
    statusCode: 400,
  },
  \[ApiErrorType.BadRequest\]: {
    message: "ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚",
    statusCode: 400,
  },

  // ãƒªã‚½ãƒ¼ã‚¹
  \[ApiErrorType.NotFound\]: {
    message: "ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚",
    statusCode: 404,
  },
  \[ApiErrorType.Conflict\]: {
    message: "æ—¢ã«å­˜åœ¨ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚",
    statusCode: 409,
  },

  // ãƒ“ã‚¸ãƒã‚¹
  \[ApiErrorType.UserNotFound\]: {
    message: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚",
    statusCode: 404,
  },
  \[ApiErrorType.EmailAlreadyExists\]: {
    message: "{email} ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚",
    statusCode: 409,
  },
  \[ApiErrorType.InvalidAgeRange\]: {
    message: "å¹´é½¢ã¯{minAge}æ­³ã‹ã‚‰{maxAge}æ­³ã®é–“ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚",
    statusCode: 400,
  },
};

/\* ---------- 3. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒ --------------------------------------- \*/
export const errorParamSchemaMap: Readonly&lt;Record&lt;ApiErrorType, ZodTypeAny&gt;&gt; = {
  // ã‚·ã‚¹ãƒ†ãƒ 
  \[ApiErrorType.Unknown\]: z.never(),
  \[ApiErrorType.InternalServerError\]: z.never(),

  // èªè¨¼ãƒ»èªå¯
  \[ApiErrorType.Unauthorized\]: z.never(),
  \[ApiErrorType.Forbidden\]: z.never(),

  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  \[ApiErrorType.ValidationError\]: z.never(),
  \[ApiErrorType.BadRequest\]: z.never(),

  // ãƒªã‚½ãƒ¼ã‚¹
  \[ApiErrorType.NotFound\]: z.never(),
  \[ApiErrorType.Conflict\]: z.never(),

  // ãƒ“ã‚¸ãƒã‚¹
  \[ApiErrorType.UserNotFound\]: z.never(),
  \[ApiErrorType.EmailAlreadyExists\]: z.object({ email: z.string() }),
  \[ApiErrorType.InvalidAgeRange\]: z.object({
    minAge: z.number().int(),
    maxAge: z.number().int(),
  }),
} as const;

/\* ---------- 4. å‹ä»˜ã‘æ¸ˆã¿å®šç¾©ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ----------------------------- \*/
// errors.tsï¼ˆå‰åŠã¯å‰å›ã¨åŒã˜ã€‚çœç•¥ï¼‰ ------------------------------------
type MessageErrorParams&lt;T extends ApiErrorType&gt; = z.infer&lt;
  (typeof errorParamSchemaMap)\[T\]
&gt;;

// ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¦æ±‚ã™ã‚‹ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥ã¨ã—ãªã„ç¨®åˆ¥ã‚’æŠ½å‡º
type ErrorTypeWithParams = {
  \[K in ApiErrorType\]: MessageErrorParams&lt;K&gt; extends never ? never : K;
}\[ApiErrorType\];

type ErrorTypeWithoutParams = Exclude&lt;ApiErrorType, ErrorTypeWithParams&gt;;

export interface ErrorDefinition&lt;T extends ApiErrorType&gt; {
  readonly type: T;
  readonly message: (typeof errorMetaMap)\[T\]\["message"\];
  readonly statusCode: (typeof errorMetaMap)\[T\]\["statusCode"\];
  readonly params: ErrorParams&lt;T&gt;;
}

/\*\*
 \* ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸è¦ã®ã‚¨ãƒ©ãƒ¼
 \*/
export function createError&lt;T extends ErrorTypeWithoutParams&gt;(
  type: T,
): ErrorDefinition&lt;T&gt;;

/\*\*
 \* ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¿…é ˆã®ã‚¨ãƒ©ãƒ¼
 \*/
export function createError&lt;T extends ErrorTypeWithParams&gt;(
  type: T,
  params: ErrorParams&lt;T&gt;,
): ErrorDefinition&lt;T&gt;;

/\* å®Ÿè£…ã‚·ã‚°ãƒãƒãƒ£ â€• ä¸Šè¨˜ 2 ã¤ã®ã©ã¡ã‚‰ã‹ã«ãƒãƒƒãƒã•ã›ã‚‹ \*/
export function createError(
  type: ApiErrorType,
  params?: unknown,
): ErrorDefinition&lt;ApiErrorType&gt; {
  const schema = errorParamSchemaMap\[type\];

  // never ä»¥å¤–ã¯ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼
  if (schema !== z.never()) {
    (schema as z.ZodTypeAny).parse(params);
  } else {
    // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸è¦ãªã®ã«æ¸¡ã•ã‚ŒãŸå ´åˆã¯é–‹ç™ºæ™‚ã«æ°—ã¥ã‘ã‚‹ã‚ˆã†ã«ã™ã‚‹
    if (params !== undefined) {
      throw new Error(`Error ${type} does not take parameters`);
    }
  }

  return {
    type,
    message: errorMetaMap\[type\].message,
    statusCode: errorMetaMap\[type\].statusCode,
    // params ã¯å­˜åœ¨ã—ãªã„å ´åˆã§ã‚‚ç©ºã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§çµ±ä¸€
    params: (params ?? {}) as never,
  };
}

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/10 10:52:23*

`minAge` / `maxAge` ã‚’ `number` ã«ã—ãŸã®ã«ã¾ã  **â€œstring ã‚’æœŸå¾…â€** ã¨è¨€ã‚ã‚Œã‚‹åŸå› ã¯ã€  
`errorParamSchemaMap` ã« **ä¸€å¾‹ `: Record<â€¦ , ZodTypeAny>` ã¨ã„ã†é™çš„å‹ã‚’ä»˜ã‘ã¦ã—ã¾ã„ã€  
å„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã”ã¨ã® Zod ã‚¹ã‚­ãƒ¼ãƒå‹æƒ…å ±ãŒå¤±ã‚ã‚Œã¦ã„ã‚‹** ãŸã‚ã§ã™ã€‚

> **è§£æ±ºç­–** â€“ `as const satisfies â€¦` ã‚’ä½¿ã£ã¦  
> *ã€Œå…¨ä½“ã¨ã—ã¦ Record<ApiErrorType, ZodTypeAny> ã‚’æº€ãŸã™ã€* ã“ã¨ã ã‘ä¿è¨¼ã—ã€  
> å„ã‚­ãƒ¼ã®å‹ã¯ **å®Ÿéš›ã® Zod ã‚¹ã‚­ãƒ¼ãƒå‹** ã‚’ä¿æŒã•ã›ã¾ã™ã€‚

---

## ä¿®æ­£ç‰ˆ

```ts
/* ---------- 3. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒ --------------------------------------- */
export const errorParamSchemaMap = {
  // ã‚·ã‚¹ãƒ†ãƒ 
  [ApiErrorType.Unknown]: z.never(),
  [ApiErrorType.InternalServerError]: z.never(),

  // èªè¨¼ãƒ»èªå¯
  [ApiErrorType.Unauthorized]: z.never(),
  [ApiErrorType.Forbidden]: z.never(),

  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  [ApiErrorType.ValidationError]: z.never(),
  [ApiErrorType.BadRequest]: z.never(),

  // ãƒªã‚½ãƒ¼ã‚¹
  [ApiErrorType.NotFound]: z.never(),
  [ApiErrorType.Conflict]: z.never(),

  // ãƒ“ã‚¸ãƒã‚¹
  [ApiErrorType.UserNotFound]: z.never(),
  [ApiErrorType.EmailAlreadyExists]: z.object({
    email: z.string(),
  }),
  [ApiErrorType.InvalidAgeRange]: z.object({
    /** æ•´æ•°ã®ã¿è¨±å¯ */
    minAge: z.number().int(),
    maxAge: z.number().int(),
  }),
} as const satisfies Record<ApiErrorType, ZodTypeAny>;
```

### å‹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚‚ 1 è¡Œã§ OK

```ts
type ErrorParams<T extends ApiErrorType> =
  z.infer<(typeof errorParamSchemaMap)[T]>;
```

> ã“ã‚Œã§ `InvalidAgeRange` ã® `ErrorParams` ã¯  
> ```ts
> { minAge: number; maxAge: number }
> ```  
> ã¨æ¨è«–ã•ã‚Œã¾ã™ã€‚

---

## å‹•ä½œç¢ºèª

```ts
/* âœ”ï¸ æ•´æ•°ã‚’æ¸¡ã›ã‚‹ */
createError(ApiErrorType.InvalidAgeRange, { minAge: 18, maxAge: 65 });

/* âœ”ï¸ 2 å¼•æ•°ç›®ã¯ä¸è¦ã‚¨ãƒ©ãƒ¼ãªã®ã§çœç•¥ */
createError(ApiErrorType.Unknown);

/* âŒ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‹é•ã„ï¼ˆstring ã‚’æ¸¡ã™ã¨ã‚¨ãƒ©ãƒ¼ï¼‰ */
// createError(ApiErrorType.InvalidAgeRange, { minAge: "18", maxAge: "65" });

/* âŒ ä¸è¦ã‚¨ãƒ©ãƒ¼ã« params ã‚’æ¸¡ã™ã¨ã‚¨ãƒ©ãƒ¼ */
// createError(ApiErrorType.Unknown, {});
```

### è£œè¶³

* **`as const satisfies`**â€ƒTS 4.9+ ã®æ§‹æ–‡ã§  
  * **`as const`** ã¨åŒã˜ã â€œå„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’èª­ã¿å–ã‚Šå°‚ç”¨ãƒ»ãƒªãƒ†ãƒ©ãƒ«åŒ–â€  
  * ãªãŠã‹ã¤å³å´å‹ (`Record<â€¦>`) ã‚’ **æº€ãŸã™ã‹ã©ã†ã‹ã ã‘** ã‚’ãƒã‚§ãƒƒã‚¯  
  * ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è‡ªèº«ã®è©³ã—ã„å‹ã¯å¤±ã‚ã‚Œãšä¿æŒã•ã‚Œã¾ã™  
* `isolatedDeclarations: true` ã§ã‚‚ `.d.ts` ã«å®Œå…¨ãªå‹æƒ…å ±ãŒå‡ºåŠ›ã•ã‚Œã€  
  **é‡è¤‡å®šç¾©ã‚¨ãƒ©ãƒ¼ã¯ç™ºç”Ÿã—ã¾ã›ã‚“**ã€‚  

ã“ã®ä¿®æ­£ã§ `minAge` / `maxAge` ã‚’ `number` ã¨ã—ã¦å®‰å…¨ã«æ‰±ãˆã¾ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/10 10:56:55*

isolatedDeclarations: trueãŒã†ã¾ãè§£æ±ºã—ãªã‹ã£ãŸã€‚ã‚€ã—ã‚å…¨éƒ¨stringã«æŒ‡å®šã—ã¦ã‚ã’ãŸæ–¹ãŒã‚€ã—ã‚è¦ªåˆ‡ã‹ï¼Ÿ

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/10 10:56:56*

### `isolatedDeclarations: true` ãŒå™›ã¿åˆã‚ãªã„ç†ç”±

`isolatedDeclarations` ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ **ã€Œå„ `export` ã«æ˜ç¤ºçš„ã§â€œãƒ«ãƒ¼ãƒ—ã—ãªã„â€å‹æ³¨é‡ˆãŒå¿…è¦ã€** ã«ãªã‚Šã¾ã™ã€‚  
`as const satisfies â€¦` ã¯ä¾¿åˆ©ã§ã™ãŒã€å†…éƒ¨ã§ â€œè‡ªå·±å‚ç…§â€ ã‚’å«ã‚€å ´åˆã«  
ã€Œ**å‹ãŒç™ºæ•£ã—ã¦ã„ã‚‹**ã€ã¨åˆ¤æ–­ã•ã‚Œã€`.d.ts` å‡ºåŠ›æ™‚ã«è­¦å‘Šã‚„ã‚¨ãƒ©ãƒ¼ãŒèµ·ããŒã¡ã§ã™ã€‚  
ï¼ˆç‰¹ã« **Zod ã‚¹ã‚­ãƒ¼ãƒ** ã®ã‚ˆã†ã«å·¨å¤§ãªæ§‹é€ ä½“ã‚’ãƒªãƒ†ãƒ©ãƒ«ã§ä¿æŒã™ã‚‹å ´åˆï¼‰

> *ã‚‚ã—å‹æ¨è«–ã‚’ãã®ã¾ã¾ .d.ts ã«è½ã¨ã—è¾¼ã¿ãŸã„ãªã‚‰*  
> - `isolatedDeclarations` ã‚’ **false** ã«ã™ã‚‹  
> - ã‚‚ã—ãã¯ **å„ã‚­ãƒ¼ã‚’å€‹åˆ¥ã® `export const ...`** ã«åˆ†å‰²ã™ã‚‹  
>   ï¼ˆâ†’ ç™ºæ•£ã›ãšã€å‹æ³¨é‡ˆã‚‚çŸ­ãæ¸ˆã‚€ï¼‰

---

## ã€Œå…¨éƒ¨ `string`ã€ã«æƒãˆã‚‹æ¡ˆã¯ã‚¢ãƒªï¼Ÿ

### âœ”ï¸ ãƒ¡ãƒªãƒƒãƒˆ

| é …ç›® | `string` ã§çµ±ä¸€ã—ãŸå ´åˆ |
|------|------------------------|
| **å‹æ³¨é‡ˆã®é‡** | ã™ã¹ã¦ `Record<string, string>` ç³»ã§æ¸ˆã‚€ã®ã§ã‚·ãƒ³ãƒ—ãƒ« |
| **`.d.ts` ç”Ÿæˆ** | â€œè‡ªå·±å‚ç…§ã®ãªã„ãƒªãƒ†ãƒ©ãƒ«â€ ã«ãªã‚‹ãŸã‚ `isolatedDeclarations` ã¨ç›¸æ€§ãŒã‚ˆã„ |
| **ãƒ•ãƒ­ãƒ³ãƒˆå®Ÿè£…** | ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°ãªã©ã§ **`${minAge}`** ã¨åŸ‹ã‚è¾¼ã‚€ã ã‘ã§ OK |
| **æ‹¡å¼µæ€§** | æ–°ã—ã„ã‚¨ãƒ©ãƒ¼è¿½åŠ æ™‚ã«ã€Œæ•°å€¤ã‹æ–‡å­—åˆ—ã‹ã€ã‚’è¿·ã‚ãªãã¦æ¸ˆã‚€ |

### âŒ ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ

| é …ç›® | å½±éŸ¿ |
|------|------|
| **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³** | å®Ÿè¡Œæ™‚ã« â€œæ•°å€¤ã£ã½ã„æ–‡å­—åˆ—â€ ã§ã‚‚ãã®ã¾ã¾é€šã‚‹<br>ï¼ˆä¾‹: `"18.5"` ã‚„ `"abc"`ï¼‰ |
| **IDE è£œå®Œ** | `minAge: string` ãªã®ã§ã€Œæœ¬å½“ã«æ•´æ•°ãŒæ¬²ã—ã„ã®ã‹ï¼Ÿã€ãŒèª­ã¿å–ã‚Œãªã„ |
| **å¾Œå·¥ç¨‹** | API å±¤ã‚„ DB å±¤ã§çµå±€ `parseInt()` / `Number()` ãŒå¿…è¦ã«ãªã‚‹ |

---

## æŠ˜è¡·æ¡ˆï¼š**å¤–å‘ãã¯ `string`ã€Zod ã§ã€Œæ•´æ•°å¤‰æ›ï¼‹æ¤œè¨¼ã€**

```ts
/* ---------- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒ (æŠœç²‹) ---------------------------------- */
[ApiErrorType.InvalidAgeRange]: z.object({
  minAge: z.coerce.number().int(),  // "18" â†’ 18 ã«å¤‰æ›ã—ã¤ã¤æ•´æ•°æ¤œè¨¼
  maxAge: z.coerce.number().int(),
}),
```

*å‘¼ã³å‡ºã—å´ã¯ã€Œ`string` ã§ã‚‚ `number` ã§ã‚‚ã€æ¸¡ã›ã‚‹* ã®ã§  
IDE è£œå®Œã¯ã‚·ãƒ³ãƒ—ãƒ« (`string`)ã€ã‹ã¤ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã§ã¯å³å¯†ã«æ•´æ•°åŒ–&æ¤œè¨¼ã§ãã¾ã™ã€‚

```ts
createError(ApiErrorType.InvalidAgeRange, {
  minAge: "18",      // OK
  maxAge: 65,        // OK
});
```

`.d.ts` ã«ã¯ **`minAge: string | number`** ã®ã‚ˆã†ã«å‡ºåŠ›ã•ã‚Œã‚‹ãŸã‚  
`isolatedDeclarations` çš„ã«ã‚‚å®‰å…¨ã§ã™ã€‚

---

## ã¾ã¨ã‚ â€• ã©ã¡ã‚‰ã‚’é¸ã¶ï¼Ÿ

| ã‚±ãƒ¼ã‚¹ | æ¨å¥¨å‹ |
|--------|-------|
| **å‹ã®å³å¯†ã• < è¨­å®šãƒ»ç”Ÿæˆã®å®¹æ˜“ã•**<br>ï¼ˆã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã‚’æœ€å°åŒ–ã—ãŸã„ã€`isolatedDeclarations` ã‚’â€œè€ƒãˆãšâ€ã«é€šã—ãŸã„ï¼‰ | **ã™ã¹ã¦ `string`** ã§æƒãˆã‚‹ |
| **æ•°å€¤ã§ã‚ã‚‹ä¿è¨¼ãŒé‡è¦**<br>ï¼ˆå¾Œæ®µã§ãã®ã¾ã¾è¨ˆç®—ã—ãŸã„ã€èª¤å…¥åŠ›ã‚’æ—©æœŸæ¤œçŸ¥ã—ãŸã„ï¼‰ | `number().int()` ã‚’ç¶­æŒã—ã€<br>`isolatedDeclarations` ã¯<br>â€ƒ- ç„¡åŠ¹åŒ–ã™ã‚‹<br>â€ƒ- ã‚‚ã—ãã¯ã‚¨ãƒ©ãƒ¼å®šç¾©ã‚’åˆ†å‰² export ã™ã‚‹ |
| **ã»ã©ã»ã©ã®å³å¯†ã•ï¼‹ç°¡æ½”ã•** | `z.coerce.number().int()` ã§<br>å¤–éƒ¨å…¥åŠ›ã¯ `string`ã€å†…éƒ¨å€¤ã¯ `number` |

ã‚‚ã— **ã€Œã‚¨ãƒ©ãƒ¼å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã¯å¯èª­æ€§ã‚’æœ€å„ªå…ˆã€** ãªã‚‰  
> *å…¨éƒ¨ `string` ã«å¯„ã›ã‚‹ â†’ å¿…è¦ãªæ‰€ã ã‘ `parseInt()`*  

ã§ã‚‚ååˆ†å®Ÿè·µçš„ã§ã™ã€‚  
é€†ã« **ã€Œå‹å®‰å…¨ãŒå£²ã‚Šã® SDK ã‚’é…å¸ƒã—ãŸã„ã€** å ´åˆã¯  
> *Zod ã§å³å¯†å‹ï¼‹ `isolatedDeclarations` ã¯ off*  

ãŒç„¡é›£ã§ã™ã€‚

---

## ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
*2025/6/10 10:59:41*

errorParamSchemaMapã§ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã¯å…¨éƒ¨ z.string() ã§å›ºå®šã«ã§ããªã„ã‹ï¼Ÿ

---

## ğŸ¤– ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
*2025/6/10 10:59:42*

ã¯ã„ã€**ã€Œã‚¨ãƒ©ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ã™ã¹ã¦æ–‡å­—åˆ—ã€** ã¨ã„ã†é‹ç”¨ã«çµ±ä¸€ã—ã¦ã—ã¾ãˆã°  
`errorParamSchemaMap` ã¯æ¬¡ã®ã‚ˆã†ã«ç°¡ç´ åŒ–ã§ãã¾ã™ã€‚  
ï¼ˆ`isolatedDeclarations: true` ã§ã‚‚ç¢ºå®Ÿã«å‹æ³¨é‡ˆãŒä»˜ãã‚ˆã†ã«ã—ã¦ã„ã¾ã™ï¼‰

```ts
/* ---------- 3. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒï¼ˆã™ã¹ã¦ z.string()ï¼‰ ------------------ */
import { z, ZodTypeAny } from "zod";
import { ApiErrorType } from "./api-error-type";

/**
 * æ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ 0 å€‹ ã€œ N å€‹ã‚’è¨±å®¹ã™ã‚‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
 * - ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸è¦ã®ã‚¨ãƒ©ãƒ¼ã¯ z.never()
 * - å¿…è¦ãªã‚¨ãƒ©ãƒ¼ã¯ z.object({ ...string }) ã«çµ±ä¸€
 */
export const errorParamSchemaMap = {
  // ----- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸è¦ --------------------------------
  [ApiErrorType.Unknown]: z.never(),
  [ApiErrorType.InternalServerError]: z.never(),

  [ApiErrorType.Unauthorized]: z.never(),
  [ApiErrorType.Forbidden]: z.never(),

  [ApiErrorType.ValidationError]: z.never(),
  [ApiErrorType.BadRequest]: z.never(),

  [ApiErrorType.NotFound]: z.never(),
  [ApiErrorType.Conflict]: z.never(),

  [ApiErrorType.UserNotFound]: z.never(),

  // ----- æ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚ã‚Š ----------------------------
  [ApiErrorType.EmailAlreadyExists]: z.object({
    email: z.string(),
  }),

  [ApiErrorType.InvalidAgeRange]: z.object({
    minAge: z.string(),   // ã“ã“ã‚‚æ–‡å­—åˆ—ã«çµ±ä¸€
    maxAge: z.string(),
  }),
} as const satisfies Record<ApiErrorType, ZodTypeAny>;

/* ---------- å‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆå¤‰æ›´ãªã—ã§åˆ©ç”¨å¯ï¼‰ ------------------------ */
export type ErrorParams<T extends ApiErrorType> =
  z.infer<(typeof errorParamSchemaMap)[T]>;
```

### å‘¼ã³å‡ºã—ä¾‹

```ts
// ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸è¦
createError(ApiErrorType.Unknown);                 // OK

// æ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
createError(ApiErrorType.EmailAlreadyExists, {
  email: "foo@example.com",
});                                                // OK

createError(ApiErrorType.InvalidAgeRange, {
  minAge: "18",    // æ•°å€¤ã¯å‘¼ã³å‡ºã—å´ã§ toString() ã™ã‚Œã°ã‚ˆã„
  maxAge: "65",
});                                                // OK
```

---

## ã“ã®æ–¹é‡ã®ãƒ¡ãƒªãƒƒãƒˆ / ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ

| | æ–‡å­—åˆ—ã«çµ±ä¸€ |
|---|---|
| **â— ãƒ¡ãƒªãƒƒãƒˆ** | * ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ãŒã‚·ãƒ³ãƒ—ãƒ«<br>* `isolatedDeclarations` ä¸‹ã§ã‚‚å‹æ¨è«–ãŒç™ºæ•£ã—ãªã„<br>* å¤‰æ›ãƒ»æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã‚’ 1 ç®‡æ‰€ï¼ˆä½¿ç”¨å´ï¼‰ã«é›†ç´„ã§ãã‚‹ |
| **â–³ ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ** | * ã€Œæ•´æ•°ã§ã‚ã‚‹ã‹ã€ã®ä¿è¨¼ã¯å‘¼ã³å‡ºã—å´ã«å§”ã­ã‚‹<br>* IDE è£œå®Œã§å‹ãƒ’ãƒ³ãƒˆãŒ â€œstringâ€ ã®ã¿ã«ãªã‚‹ |

> **ãƒã‚¤ãƒ³ãƒˆ**  
> - **æ•°å€¤ã‚’æ‰±ã†å ´é¢ã§ã¯ `Number(minAge)` ç­‰ã§ã‚­ãƒ£ã‚¹ãƒˆ** ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚  
> - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å³å¯†ã«è¡Œã„ãŸã„å ´åˆã¯ã€ã‚µãƒ¼ãƒ“ã‚¹å±¤ã‚„ãƒ•ã‚©ãƒ¼ãƒ å±¤ãªã© **åˆ¥ãƒ¬ã‚¤ãƒ¤ãƒ¼** ã§  
>   `z.string().regex(/^\d+$/)` ã‚„ `z.coerce.number().int()` ã‚’è¿½åŠ ã™ã‚‹æ–¹æ³•ãŒç¾å®Ÿçš„ã§ã™ã€‚

---

# Dateソート拡張関数

日付: 2024-05-17

---

## 👤 ユーザー
*2024/05/17 12:21:16*

Dateの配列のソートに以下を使うとどうなる


public extension Sequence {
    func sorted(by keyPath: KeyPath&lt;Element, some Comparable&gt;, order: SortOrder) -&gt; [Element] {
        switch order {
        case .ascending:
            sorted { $0[keyPath: keyPath] &lt; $1[keyPath: keyPath] }
        case .descending:
            sorted { $0[keyPath: keyPath] &gt; $1[keyPath: keyPath] }
        }
    }
}

---

## 🤖 アシスタント
*2024/05/17 12:21:25*

この拡張関数を使うと、任意の要素のプロパティを指定して、そのプロパティに基づいて配列を昇順または降順にソートすることができます。`Date`の配列のソートに使う場合の例を以下に示します。

まず、`SortOrder`というenumが定義されていることを前提としています。このenumは以下のように定義できます：

```swift
enum SortOrder {
    case ascending
    case descending
}
```

次に、`Date`の配列をソートする例を示します。以下に、`MyDateStruct`という構造体を定義し、その配列をソートする方法を示します。

```swift
import Foundation

struct MyDateStruct {
    let date: Date
}

let date1 = MyDateStruct(date: Date(timeIntervalSince1970: 10000))
let date2 = MyDateStruct(date: Date(timeIntervalSince1970: 5000))
let date3 = MyDateStruct(date: Date(timeIntervalSince1970: 15000))

let datesArray = [date1, date2, date3]

let sortedDatesAscending = datesArray.sorted(by: \.date, order: .ascending)
let sortedDatesDescending = datesArray.sorted(by: \.date, order: .descending)

print("Ascending:")
for dateStruct in sortedDatesAscending {
    print(dateStruct.date)
}

print("Descending:")
for dateStruct in sortedDatesDescending {
    print(dateStruct.date)
}
```

このコードを実行すると、`datesArray`が`date`プロパティに基づいて昇順および降順にソートされ、結果がコンソールに出力されます。

この拡張関数を使用することで、配列の要素が持つ任意の`Comparable`プロパティに基づいて簡単にソートを行うことができるようになります。例えば、`MyDateStruct`の他のプロパティや別の構造体のプロパティに対しても同様にソートを行うことができます。

---

## 👤 ユーザー
*2024/05/17 12:21:38*

MyDateStruct を使わない方法は？

---

## 🤖 アシスタント
*2024/05/17 12:21:48*

`MyDateStruct` を使わずに `Date` の配列を直接ソートする場合、以下のように拡張関数を使ってソートすることができます。

```swift
import Foundation

public extension Sequence {
    func sorted(by keyPath: KeyPath<Element, some Comparable>, order: SortOrder) -> [Element] {
        switch order {
        case .ascending:
            return sorted { $0[keyPath: keyPath] < $1[keyPath: keyPath] }
        case .descending:
            return sorted { $0[keyPath: keyPath] > $1[keyPath: keyPath] }
        }
    }
}

enum SortOrder {
    case ascending
    case descending
}

let date1 = Date(timeIntervalSince1970: 10000)
let date2 = Date(timeIntervalSince1970: 5000)
let date3 = Date(timeIntervalSince1970: 15000)

let datesArray = [date1, date2, date3]

let sortedDatesAscending = datesArray.sorted(by: \.self, order: .ascending)
let sortedDatesDescending = datesArray.sorted(by: \.self, order: .descending)

print("Ascending:")
for date in sortedDatesAscending {
    print(date)
}

print("Descending:")
for date in sortedDatesDescending {
    print(date)
}
```

この方法では、`Date` の配列を直接ソートします。`sorted(by: \.self, order: .ascending)` や `sorted(by: \.self, order: .descending)` とすることで、`Date` 型そのものを `Comparable` として扱い、配列を昇順または降順にソートします。

この例では、`Date` の配列 `datesArray` が `sorted(by: \.self, order: .ascending)` を使って昇順に、`sorted(by: \.self, order: .descending)` を使って降順にソートされ、それぞれの結果がコンソールに出力されます。

---

## 👤 ユーザー
*2024/05/17 12:22:21*

by: \.self,  をデフォルト引数に設定できないか？

---

## 🤖 アシスタント
*2024/05/17 12:22:35*

デフォルト引数として `keyPath` に `\.self` を設定することはできませんが、オーバーロードを使うことで、デフォルトの `keyPath` を提供する関数を追加できます。具体的には、`keyPath` を指定しない場合に `\.self` を使うバージョンの関数を作成します。

以下にその実装例を示します：

```swift
import Foundation

public extension Sequence {
    func sorted(by keyPath: KeyPath<Element, some Comparable>, order: SortOrder) -> [Element] {
        switch order {
        case .ascending:
            return sorted { $0[keyPath: keyPath] < $1[keyPath: keyPath] }
        case .descending:
            return sorted { $0[keyPath: keyPath] > $1[keyPath: keyPath] }
        }
    }

    // デフォルトの keyPath を使用するオーバーロード
    func sorted(order: SortOrder) -> [Element] where Element: Comparable {
        switch order {
        case .ascending:
            return sorted { $0 < $1 }
        case .descending:
            return sorted { $0 > $1 }
        }
    }
}

enum SortOrder {
    case ascending
    case descending
}

let date1 = Date(timeIntervalSince1970: 10000)
let date2 = Date(timeIntervalSince1970: 5000)
let date3 = Date(timeIntervalSince1970: 15000)

let datesArray = [date1, date2, date3]

// keyPath を使用したソート
let sortedDatesAscendingWithKeyPath = datesArray.sorted(by: \.self, order: .ascending)
let sortedDatesDescendingWithKeyPath = datesArray.sorted(by: \.self, order: .descending)

// デフォルトの keyPath (self) を使用したソート
let sortedDatesAscending = datesArray.sorted(order: .ascending)
let sortedDatesDescending = datesArray.sorted(order: .descending)

print("Ascending with keyPath:")
for date in sortedDatesAscendingWithKeyPath {
    print(date)
}

print("Descending with keyPath:")
for date in sortedDatesDescendingWithKeyPath {
    print(date)
}

print("Ascending with default keyPath:")
for date in sortedDatesAscending {
    print(date)
}

print("Descending with default keyPath:")
for date in sortedDatesDescending {
    print(date)
}
```

この実装では、`sorted(order:)` メソッドを追加して、`Element` が `Comparable` に準拠している場合に `keyPath` を指定せずにソートできるようにしています。これにより、`Date` の配列を `keyPath` を指定せずに昇順または降順にソートすることができます。

---

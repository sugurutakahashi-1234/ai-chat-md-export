# Prevent direct push to main
[ "$(git branch --show-current)" = "main" ] && echo "‚ùå No direct push to main!" && exit 1

bun run validate:branch
bun run ci

# Auto-update dependency graph
if git diff HEAD --name-only | grep -qE "^src/.*\.ts$"; then
  bun run dependency:graph:mermaid
  git diff --quiet docs/dependency-graphs/typescript-graph.md || {
    git add docs/dependency-graphs/typescript-graph.md
    git commit -m "chore: update dependency graph [auto-generated]" --no-verify
  }
fi
